(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[4691],{35099:function(It,$,U){"use strict";var ae=U(67294),re=U(83280),m=U(23185),ve=U(4322),Z=U(24770),le=U(89182),fe=function(J,Xe){var et={};for(var Ue in J)Object.prototype.hasOwnProperty.call(J,Ue)&&Xe.indexOf(Ue)<0&&(et[Ue]=J[Ue]);if(J!=null&&typeof Object.getOwnPropertySymbols=="function")for(var gt=0,Ue=Object.getOwnPropertySymbols(J);gt<Ue.length;gt++)Xe.indexOf(Ue[gt])<0&&Object.prototype.propertyIsEnumerable.call(J,Ue[gt])&&(et[Ue[gt]]=J[Ue[gt]]);return et},Le=(0,ae.forwardRef)(function(J,Xe){var et=J.chartRef,Ue=J.style,gt=Ue===void 0?{height:"inherit"}:Ue,rr=J.className,xt=J.loading,Yt=J.loadingTemplate,Et=J.errorTemplate,at=fe(J,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),it=(0,m.Z)(re.aC,at),Zt=it.chart,Y=it.container;return(0,ae.useEffect)(function(){(0,ve.J)(et,Zt.current)},[Zt.current]),(0,ae.useImperativeHandle)(Xe,function(){return{getChart:function(){return Zt.current}}}),ae.createElement(Z.Z,{errorTemplate:Et},xt&&ae.createElement(le.Z,{loadingTemplate:Yt,theme:J.theme}),ae.createElement("div",{className:rr,style:gt,ref:Y}))});$.Z=Le},65337:function(It,$,U){"use strict";var ae=U(67294),re=U(83280),m=U(23185),ve=U(4322),Z=U(24770),le=U(89182),fe=function(J,Xe){var et={};for(var Ue in J)Object.prototype.hasOwnProperty.call(J,Ue)&&Xe.indexOf(Ue)<0&&(et[Ue]=J[Ue]);if(J!=null&&typeof Object.getOwnPropertySymbols=="function")for(var gt=0,Ue=Object.getOwnPropertySymbols(J);gt<Ue.length;gt++)Xe.indexOf(Ue[gt])<0&&Object.prototype.propertyIsEnumerable.call(J,Ue[gt])&&(et[Ue[gt]]=J[Ue[gt]]);return et},Le=(0,ae.forwardRef)(function(J,Xe){var et=J.chartRef,Ue=J.style,gt=Ue===void 0?{height:"inherit"}:Ue,rr=J.className,xt=J.loading,Yt=J.loadingTemplate,Et=J.errorTemplate,at=fe(J,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),it=(0,m.Z)(re.Kj,at),Zt=it.chart,Y=it.container;return(0,ae.useEffect)(function(){(0,ve.J)(et,Zt.current)},[Zt.current]),(0,ae.useImperativeHandle)(Xe,function(){return{getChart:function(){return Zt.current}}}),ae.createElement(Z.Z,{errorTemplate:Et},xt&&ae.createElement(le.Z,{loadingTemplate:Yt,theme:J.theme}),ae.createElement("div",{className:rr,style:gt,ref:Y}))});$.Z=Le},90829:function(It,$,U){"use strict";var ae=U(67294),re=U(83280),m=U(23185),ve=U(4322),Z=U(24770),le=U(89182),fe=function(J,Xe){var et={};for(var Ue in J)Object.prototype.hasOwnProperty.call(J,Ue)&&Xe.indexOf(Ue)<0&&(et[Ue]=J[Ue]);if(J!=null&&typeof Object.getOwnPropertySymbols=="function")for(var gt=0,Ue=Object.getOwnPropertySymbols(J);gt<Ue.length;gt++)Xe.indexOf(Ue[gt])<0&&Object.prototype.propertyIsEnumerable.call(J,Ue[gt])&&(et[Ue[gt]]=J[Ue[gt]]);return et},Le=(0,ae.forwardRef)(function(J,Xe){var et=J.chartRef,Ue=J.style,gt=Ue===void 0?{height:"inherit"}:Ue,rr=J.className,xt=J.loading,Yt=J.loadingTemplate,Et=J.errorTemplate,at=fe(J,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),it=(0,m.Z)(re.TZ,at),Zt=it.chart,Y=it.container;return(0,ae.useEffect)(function(){(0,ve.J)(et,Zt.current)},[Zt.current]),(0,ae.useImperativeHandle)(Xe,function(){return{getChart:function(){return Zt.current}}}),ae.createElement(Z.Z,{errorTemplate:Et},xt&&ae.createElement(le.Z,{loadingTemplate:Yt,theme:J.theme}),ae.createElement("div",{className:rr,style:gt,ref:Y}))});$.Z=Le},93343:function(It,$,U){"use strict";var ae=U(67294),re=U(83280),m=U(23185),ve=U(4322),Z=U(24770),le=U(89182),fe=function(J,Xe){var et={};for(var Ue in J)Object.prototype.hasOwnProperty.call(J,Ue)&&Xe.indexOf(Ue)<0&&(et[Ue]=J[Ue]);if(J!=null&&typeof Object.getOwnPropertySymbols=="function")for(var gt=0,Ue=Object.getOwnPropertySymbols(J);gt<Ue.length;gt++)Xe.indexOf(Ue[gt])<0&&Object.prototype.propertyIsEnumerable.call(J,Ue[gt])&&(et[Ue[gt]]=J[Ue[gt]]);return et},Le=(0,ae.forwardRef)(function(J,Xe){var et=J.chartRef,Ue=J.style,gt=Ue===void 0?{height:"inherit"}:Ue,rr=J.className,xt=J.loading,Yt=J.loadingTemplate,Et=J.errorTemplate,at=fe(J,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),it=(0,m.Z)(re.m,at),Zt=it.chart,Y=it.container;return(0,ae.useEffect)(function(){(0,ve.J)(et,Zt.current)},[Zt.current]),(0,ae.useImperativeHandle)(Xe,function(){return{getChart:function(){return Zt.current}}}),ae.createElement(Z.Z,{errorTemplate:Et},xt&&ae.createElement(le.Z,{loadingTemplate:Yt,theme:J.theme}),ae.createElement("div",{className:rr,style:gt,ref:Y}))});$.Z=Le},92688:function(It,$,U){"use strict";var ae=U(67294),re=U(83280),m=U(23185),ve=U(4322),Z=U(24770),le=U(89182),fe=function(J,Xe){var et={};for(var Ue in J)Object.prototype.hasOwnProperty.call(J,Ue)&&Xe.indexOf(Ue)<0&&(et[Ue]=J[Ue]);if(J!=null&&typeof Object.getOwnPropertySymbols=="function")for(var gt=0,Ue=Object.getOwnPropertySymbols(J);gt<Ue.length;gt++)Xe.indexOf(Ue[gt])<0&&Object.prototype.propertyIsEnumerable.call(J,Ue[gt])&&(et[Ue[gt]]=J[Ue[gt]]);return et},Le=(0,ae.forwardRef)(function(J,Xe){var et=J.chartRef,Ue=J.style,gt=Ue===void 0?{height:"inherit"}:Ue,rr=J.className,xt=J.loading,Yt=J.loadingTemplate,Et=J.errorTemplate,at=fe(J,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),it=(0,m.Z)(re.kB,at),Zt=it.chart,Y=it.container;return(0,ae.useEffect)(function(){(0,ve.J)(et,Zt.current)},[Zt.current]),(0,ae.useImperativeHandle)(Xe,function(){return{getChart:function(){return Zt.current}}}),ae.createElement(Z.Z,{errorTemplate:Et},xt&&ae.createElement(le.Z,{loadingTemplate:Yt,theme:J.theme}),ae.createElement("div",{className:rr,style:gt,ref:Y}))});$.Z=Le},64335:function(It,$,U){"use strict";var ae=U(67294),re=(0,ae.createContext)({});$.Z=re},21349:function(It,$,U){"use strict";var ae=U(84305),re=U(75901),m=U(94184),ve=U.n(m),Z=U(67294),le=U(64335),fe=U(53645),Le=U.n(fe),J=function(et){var Ue=(0,Z.useContext)(le.Z),gt=et.children,rr=et.contentWidth,xt=et.className,Yt=et.style,Et=(0,Z.useContext)(re.ZP.ConfigContext),at=Et.getPrefixCls,it=et.prefixCls||at("pro"),Zt=rr||Ue.contentWidth,Y="".concat(it,"-grid-content");return Z.createElement("div",{className:ve()(Y,xt,{wide:Zt==="Fixed"}),style:Yt},Z.createElement("div",{className:"".concat(it,"-grid-content-children")},gt))};$.Z=J},70228:function(It,$,U){"use strict";U.d($,{zP:function(){return aP},JE:function(){return m3},ns:function(){return iP}});var ae={};U.r(ae),U.d(ae,{add:function(){return Ge},adjoint:function(){return Jr},clone:function(){return Un},copy:function(){return tr},create:function(){return zr},determinant:function(){return Ei},equals:function(){return nt},exactEquals:function(){return Fe},frob:function(){return ue},fromQuat:function(){return us},fromQuat2:function(){return Xo},fromRotation:function(){return ss},fromRotationTranslation:function(){return Wo},fromRotationTranslationScale:function(){return Yo},fromRotationTranslationScaleOrigin:function(){return ra},fromScaling:function(){return Zi},fromTranslation:function(){return no},fromValues:function(){return ir},fromXRotation:function(){return Ha},fromYRotation:function(){return as},fromZRotation:function(){return wo},frustum:function(){return oi},getRotation:function(){return Si},getScaling:function(){return io},getTranslation:function(){return bs},identity:function(){return Xr},invert:function(){return Hr},lookAt:function(){return mn},mul:function(){return xe},multiply:function(){return Gn},multiplyScalar:function(){return Lt},multiplyScalarAndAdd:function(){return Ke},ortho:function(){return Ut},orthoNO:function(){return Te},orthoZO:function(){return St},perspective:function(){return ua},perspectiveFromFieldOfView:function(){return wl},perspectiveNO:function(){return zi},perspectiveZO:function(){return To},rotate:function(){return ni},rotateX:function(){return ui},rotateY:function(){return Ni},rotateZ:function(){return Ga},scale:function(){return en},set:function(){return Sn},str:function(){return Se},sub:function(){return Ze},subtract:function(){return lt},targetTo:function(){return Hi},translate:function(){return jr},transpose:function(){return Sr}});var re=U(67294),m=(0,re.createContext)({});function ve(){return(0,re.useContext)(m)}var Z={},le={},fe=function(i){return le[i]},Le=function(i,r){le[i]=r},J=function(i){return Z[i]},Xe=function(i,r){Z[i]=r},et={},Ue={},gt=34,rr=10,xt=13;function Yt(e){return new Function("d","return {"+e.map(function(i,r){return JSON.stringify(i)+": d["+r+'] || ""'}).join(",")+"}")}function Et(e,i){var r=Yt(e);return function(n,a){return i(r(n),a,e)}}function at(e){var i=Object.create(null),r=[];return e.forEach(function(n){for(var a in n)a in i||r.push(i[a]=a)}),r}function it(e,i){var r=e+"",n=r.length;return n<i?new Array(i-n+1).join(0)+r:r}function Zt(e){return e<0?"-"+it(-e,6):e>9999?"+"+it(e,6):it(e,4)}function Y(e){var i=e.getUTCHours(),r=e.getUTCMinutes(),n=e.getUTCSeconds(),a=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":Zt(e.getUTCFullYear(),4)+"-"+it(e.getUTCMonth()+1,2)+"-"+it(e.getUTCDate(),2)+(a?"T"+it(i,2)+":"+it(r,2)+":"+it(n,2)+"."+it(a,3)+"Z":n?"T"+it(i,2)+":"+it(r,2)+":"+it(n,2)+"Z":r||i?"T"+it(i,2)+":"+it(r,2)+"Z":"")}function $t(e){var i=new RegExp('["'+e+`
\r]`),r=e.charCodeAt(0);function n(T,O){var k,j,X=a(T,function(te,be){if(k)return k(te,be-1);j=te,k=O?Et(te,O):Yt(te)});return X.columns=j||[],X}function a(T,O){var k=[],j=T.length,X=0,te=0,be,Ne=j<=0,$e=!1;T.charCodeAt(j-1)===rr&&--j,T.charCodeAt(j-1)===xt&&--j;function ot(){if(Ne)return Ue;if($e)return $e=!1,et;var _t,qt=X,ar;if(T.charCodeAt(qt)===gt){for(;X++<j&&T.charCodeAt(X)!==gt||T.charCodeAt(++X)===gt;);return(_t=X)>=j?Ne=!0:(ar=T.charCodeAt(X++))===rr?$e=!0:ar===xt&&($e=!0,T.charCodeAt(X)===rr&&++X),T.slice(qt+1,_t-1).replace(/""/g,'"')}for(;X<j;){if((ar=T.charCodeAt(_t=X++))===rr)$e=!0;else if(ar===xt)$e=!0,T.charCodeAt(X)===rr&&++X;else if(ar!==r)continue;return T.slice(qt,_t)}return Ne=!0,T.slice(qt,j)}for(;(be=ot())!==Ue;){for(var bt=[];be!==et&&be!==Ue;)bt.push(be),be=ot();O&&(bt=O(bt,te++))==null||k.push(bt)}return k}function s(T,O){return T.map(function(k){return O.map(function(j){return C(k[j])}).join(e)})}function f(T,O){return O==null&&(O=at(T)),[O.map(C).join(e)].concat(s(T,O)).join(`
`)}function v(T,O){return O==null&&(O=at(T)),s(T,O).join(`
`)}function g(T){return T.map(x).join(`
`)}function x(T){return T.map(C).join(e)}function C(T){return T==null?"":T instanceof Date?Y(T):i.test(T+="")?'"'+T.replace(/"/g,'""')+'"':T}return{parse:n,parseRows:a,format:f,formatBody:v,formatRows:g,formatRow:x,formatValue:C}}var ft=$t(","),Je=ft.parse,At=ft.parseRows,Qe=ft.format,Qt=ft.formatBody,Er=ft.formatRows,Nr=ft.formatRow,tn=ft.formatValue,A=U(96156),Ce=U(85061),De=U(38163),wt=U.n(De);function mt(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Bt(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?mt(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):mt(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Kt(e,i){var r=i.x,n=i.y,a=i.x1,s=i.y1,f=i.coordinates,v=[];return Array.isArray(e)?(e.forEach(function(g,x){var C=[];if(r&&n&&(C=[parseFloat(g[r]),parseFloat(g[n])]),r&&n&&a&&s){var T=[parseFloat(g[r]),parseFloat(g[n])],O=[parseFloat(g[a]),parseFloat(g[s])];C=[T,O]}if(f){var k="Polygon";Array.isArray(f[0])||(k="Point"),Array.isArray(f[0])&&!Array.isArray(f[0][0])&&(k="LineString");var j={type:k,coordinates:(0,Ce.Z)(g[f])};wt()(j,!0),C=j.coordinates}var X=Bt(Bt({},g),{},{_id:x,coordinates:C});v.push(X)}),{dataArray:v}):{dataArray:[]}}var Cr=[{lng1:100,lat1:30,lng2:130,lat2:30}],ei={parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}};function vn(e,i){var r=Je(e);return Kt(r,i)}var di=63710088e-1,Wn={centimeters:di*100,centimetres:di*100,degrees:di/111325,feet:di*3.28084,inches:di*39.37,kilometers:di/1e3,kilometres:di/1e3,meters:di,metres:di,miles:di/1609.344,millimeters:di*1e3,millimetres:di*1e3,nauticalmiles:di/1852,radians:1,yards:di*1.0936},si={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/di,yards:1.0936133},vi={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function qn(e,i,r){r===void 0&&(r={});var n={type:"Feature"};return(r.id===0||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=i||{},n.geometry=e,n}function mi(e,i,r){switch(r===void 0&&(r={}),e){case"Point":return aa(i).geometry;case"LineString":return oa(i).geometry;case"Polygon":return Oi(i).geometry;case"MultiPoint":return wi(i).geometry;case"MultiLineString":return $n(i).geometry;case"MultiPolygon":return ji(i).geometry;default:throw new Error(e+" is invalid")}}function aa(e,i,r){if(r===void 0&&(r={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!wn(e[0])||!wn(e[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:e};return qn(n,i,r)}function Wi(e,i,r){return r===void 0&&(r={}),da(e.map(function(n){return aa(n,i)}),r)}function Oi(e,i,r){r===void 0&&(r={});for(var n=0,a=e;n<a.length;n++){var s=a[n];if(s.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var f=0;f<s[s.length-1].length;f++)if(s[s.length-1][f]!==s[0][f])throw new Error("First and last Position are not equivalent.")}var v={type:"Polygon",coordinates:e};return qn(v,i,r)}function Ki(e,i,r){return r===void 0&&(r={}),da(e.map(function(n){return Oi(n,i)}),r)}function oa(e,i,r){if(r===void 0&&(r={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:e};return qn(n,i,r)}function Mi(e,i,r){return r===void 0&&(r={}),da(e.map(function(n){return oa(n,i)}),r)}function da(e,i){i===void 0&&(i={});var r={type:"FeatureCollection"};return i.id&&(r.id=i.id),i.bbox&&(r.bbox=i.bbox),r.features=e,r}function $n(e,i,r){r===void 0&&(r={});var n={type:"MultiLineString",coordinates:e};return qn(n,i,r)}function wi(e,i,r){r===void 0&&(r={});var n={type:"MultiPoint",coordinates:e};return qn(n,i,r)}function ji(e,i,r){r===void 0&&(r={});var n={type:"MultiPolygon",coordinates:e};return qn(n,i,r)}function $i(e,i,r){r===void 0&&(r={});var n={type:"GeometryCollection",geometries:e};return qn(n,i,r)}function zo(e,i){if(i===void 0&&(i=0),i&&!(i>=0))throw new Error("precision must be a positive number");var r=Math.pow(10,i||0);return Math.round(e*r)/r}function me(e,i){i===void 0&&(i="kilometers");var r=Wn[i];if(!r)throw new Error(i+" units is invalid");return e*r}function Dn(e,i){i===void 0&&(i="kilometers");var r=Wn[i];if(!r)throw new Error(i+" units is invalid");return e/r}function Za(e,i){return Nt(Dn(e,i))}function hs(e){var i=e%360;return i<0&&(i+=360),i}function Nt(e){var i=e%(2*Math.PI);return i*180/Math.PI}function nr(e){var i=e%360;return i*Math.PI/180}function Ar(e,i,r){if(i===void 0&&(i="kilometers"),r===void 0&&(r="kilometers"),!(e>=0))throw new Error("length must be a positive number");return me(Dn(e,i),r)}function rn(e,i,r){if(i===void 0&&(i="meters"),r===void 0&&(r="kilometers"),!(e>=0))throw new Error("area must be a positive number");var n=vi[i];if(!n)throw new Error("invalid original units");var a=vi[r];if(!a)throw new Error("invalid final units");return e/n*a}function wn(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function Fn(e){return!!e&&e.constructor===Object}function gi(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(e.length!==4&&e.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach(function(i){if(!wn(i))throw new Error("bbox must only contain numbers")})}function ti(e){if(!e)throw new Error("id is required");if(["string","number"].indexOf(typeof e)===-1)throw new Error("id must be a number or a string")}function fn(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Di(e){if(Array.isArray(e))return e;if(e.type==="Feature"){if(e.geometry!==null)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Ri(e){if(e.length>1&&isNumber(e[0])&&isNumber(e[1]))return!0;if(Array.isArray(e[0])&&e[0].length)return Ri(e[0]);throw new Error("coordinates must only contain numbers")}function to(e,i,r){if(!i||!r)throw new Error("type and name required");if(!e||e.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+e.type)}function Es(e,i,r){if(!e)throw new Error("No feature passed");if(!r)throw new Error(".featureOf() requires a name");if(!e||e.type!=="Feature"||!e.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!e.geometry||e.geometry.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+e.geometry.type)}function Ko(e,i,r){if(!e)throw new Error("No featureCollection passed");if(!r)throw new Error(".collectionOf() requires a name");if(!e||e.type!=="FeatureCollection")throw new Error("Invalid input to "+r+", FeatureCollection required");for(var n=0,a=e.features;n<a.length;n++){var s=a[n];if(!s||s.type!=="Feature"||!s.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!s.geometry||s.geometry.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+s.geometry.type)}}function Ba(e){return e.type==="Feature"?e.geometry:e}function xa(e,i){return e.type==="FeatureCollection"?"FeatureCollection":e.type==="GeometryCollection"?"GeometryCollection":e.type==="Feature"&&e.geometry!==null?e.geometry.type:e.type}function H(e,i,r){if(e!==null)for(var n,a,s,f,v,g,x,C=0,T=0,O,k=e.type,j=k==="FeatureCollection",X=k==="Feature",te=j?e.features.length:1,be=0;be<te;be++){x=j?e.features[be].geometry:X?e.geometry:e,O=x?x.type==="GeometryCollection":!1,v=O?x.geometries.length:1;for(var Ne=0;Ne<v;Ne++){var $e=0,ot=0;if(f=O?x.geometries[Ne]:x,f!==null){g=f.coordinates;var bt=f.type;switch(C=r&&(bt==="Polygon"||bt==="MultiPolygon")?1:0,bt){case null:break;case"Point":if(i(g,T,be,$e,ot)===!1)return!1;T++,$e++;break;case"LineString":case"MultiPoint":for(n=0;n<g.length;n++){if(i(g[n],T,be,$e,ot)===!1)return!1;T++,bt==="MultiPoint"&&$e++}bt==="LineString"&&$e++;break;case"Polygon":case"MultiLineString":for(n=0;n<g.length;n++){for(a=0;a<g[n].length-C;a++){if(i(g[n][a],T,be,$e,ot)===!1)return!1;T++}bt==="MultiLineString"&&$e++,bt==="Polygon"&&ot++}bt==="Polygon"&&$e++;break;case"MultiPolygon":for(n=0;n<g.length;n++){for(ot=0,a=0;a<g[n].length;a++){for(s=0;s<g[n][a].length-C;s++){if(i(g[n][a][s],T,be,$e,ot)===!1)return!1;T++}ot++}$e++}break;case"GeometryCollection":for(n=0;n<f.geometries.length;n++)if(H(f.geometries[n],i,r)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Q(e,i,r,n){var a=r;return H(e,function(s,f,v,g,x){f===0&&r===void 0?a=s:a=i(a,s,f,v,g,x)},n),a}function oe(e,i){var r;switch(e.type){case"FeatureCollection":for(r=0;r<e.features.length&&i(e.features[r].properties,r)!==!1;r++);break;case"Feature":i(e.properties,0);break}}function ye(e,i,r){var n=r;return oe(e,function(a,s){s===0&&r===void 0?n=a:n=i(n,a,s)}),n}function Pe(e,i){if(e.type==="Feature")i(e,0);else if(e.type==="FeatureCollection")for(var r=0;r<e.features.length&&i(e.features[r],r)!==!1;r++);}function He(e,i,r){var n=r;return Pe(e,function(a,s){s===0&&r===void 0?n=a:n=i(n,a,s)}),n}function rt(e){var i=[];return H(e,function(r){i.push(r)}),i}function pe(e,i){var r,n,a,s,f,v,g,x,C,T,O=0,k=e.type==="FeatureCollection",j=e.type==="Feature",X=k?e.features.length:1;for(r=0;r<X;r++){for(v=k?e.features[r].geometry:j?e.geometry:e,x=k?e.features[r].properties:j?e.properties:{},C=k?e.features[r].bbox:j?e.bbox:void 0,T=k?e.features[r].id:j?e.id:void 0,g=v?v.type==="GeometryCollection":!1,f=g?v.geometries.length:1,a=0;a<f;a++){if(s=g?v.geometries[a]:v,s===null){if(i(null,O,x,C,T)===!1)return!1;continue}switch(s.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(i(s,O,x,C,T)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<s.geometries.length;n++)if(i(s.geometries[n],O,x,C,T)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}O++}}function ke(e,i,r){var n=r;return pe(e,function(a,s,f,v,g){s===0&&r===void 0?n=a:n=i(n,a,s,f,v,g)}),n}function vt(e,i){pe(e,function(r,n,a,s,f){var v=r===null?null:r.type;switch(v){case null:case"Point":case"LineString":case"Polygon":return i(qn(r,a,{bbox:s,id:f}),n,0)===!1?!1:void 0}var g;switch(v){case"MultiPoint":g="Point";break;case"MultiLineString":g="LineString";break;case"MultiPolygon":g="Polygon";break}for(var x=0;x<r.coordinates.length;x++){var C=r.coordinates[x],T={type:g,coordinates:C};if(i(qn(T,a),n,x)===!1)return!1}})}function pr(e,i,r){var n=r;return vt(e,function(a,s,f){s===0&&f===0&&r===void 0?n=a:n=i(n,a,s,f)}),n}function Ft(e,i){vt(e,function(r,n,a){var s=0;if(!!r.geometry){var f=r.geometry.type;if(!(f==="Point"||f==="MultiPoint")){var v,g=0,x=0,C=0;if(H(r,function(T,O,k,j,X){if(v===void 0||n>g||j>x||X>C){v=T,g=n,x=j,C=X,s=0;return}var te=lineString([v,T],r.properties);if(i(te,n,a,X,s)===!1)return!1;s++,v=T})===!1)return!1}}})}function zt(e,i,r){var n=r,a=!1;return Ft(e,function(s,f,v,g,x){a===!1&&r===void 0?n=s:n=i(n,s,f,v,g,x),a=!0}),n}function vr(e,i){if(!e)throw new Error("geojson is required");vt(e,function(r,n,a){if(r.geometry!==null){var s=r.geometry.type,f=r.geometry.coordinates;switch(s){case"LineString":if(i(r,n,a,0,0)===!1)return!1;break;case"Polygon":for(var v=0;v<f.length;v++)if(i(lineString(f[v],r.properties),n,a,v)===!1)return!1;break}}})}function En(e,i,r){var n=r;return vr(e,function(a,s,f,v){s===0&&r===void 0?n=a:n=i(n,a,s,f,v)}),n}function pn(e,i){if(i=i||{},!isObject(i))throw new Error("options is invalid");var r=i.featureIndex||0,n=i.multiFeatureIndex||0,a=i.geometryIndex||0,s=i.segmentIndex||0,f=i.properties,v;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),f=f||e.features[r].properties,v=e.features[r].geometry;break;case"Feature":f=f||e.properties,v=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":v=e;break;default:throw new Error("geojson is invalid")}if(v===null)return null;var g=v.coordinates;switch(v.type){case"Point":case"MultiPoint":return null;case"LineString":return s<0&&(s=g.length+s-1),lineString([g[s],g[s+1]],f,i);case"Polygon":return a<0&&(a=g.length+a),s<0&&(s=g[a].length+s-1),lineString([g[a][s],g[a][s+1]],f,i);case"MultiLineString":return n<0&&(n=g.length+n),s<0&&(s=g[n].length+s-1),lineString([g[n][s],g[n][s+1]],f,i);case"MultiPolygon":return n<0&&(n=g.length+n),a<0&&(a=g[n].length+a),s<0&&(s=g[n][a].length-s-1),lineString([g[n][a][s],g[n][a][s+1]],f,i)}throw new Error("geojson is invalid")}function Ot(e,i){if(i=i||{},!isObject(i))throw new Error("options is invalid");var r=i.featureIndex||0,n=i.multiFeatureIndex||0,a=i.geometryIndex||0,s=i.coordIndex||0,f=i.properties,v;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),f=f||e.features[r].properties,v=e.features[r].geometry;break;case"Feature":f=f||e.properties,v=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":v=e;break;default:throw new Error("geojson is invalid")}if(v===null)return null;var g=v.coordinates;switch(v.type){case"Point":return point(g,f,i);case"MultiPoint":return n<0&&(n=g.length+n),point(g[n],f,i);case"LineString":return s<0&&(s=g.length+s),point(g[s],f,i);case"Polygon":return a<0&&(a=g.length+a),s<0&&(s=g[a].length+s),point(g[a][s],f,i);case"MultiLineString":return n<0&&(n=g.length+n),s<0&&(s=g[n].length+s),point(g[n][s],f,i);case"MultiPolygon":return n<0&&(n=g.length+n),a<0&&(a=g[n].length+a),s<0&&(s=g[n][a].length-s),point(g[n][a][s],f,i)}throw new Error("geojson is invalid")}function nn(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Zr(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?nn(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):nn(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Yr(e,i){var r=[],n={};if(!e.features)return e.features=[],{dataArray:[]};if(e.features=e.features.filter(function(s){var f=s.geometry;return s!=null&&f&&f.type&&f.coordinates&&f.coordinates.length>0}),wt()(e,!0),e.features.length===0)return{dataArray:[],featureKeys:n};var a=0;return vt(e,function(s,f){var v=Di(s),g=f,x=Zr(Zr({},s.properties),{},{coordinates:v,_id:g});r.push(x)}),{dataArray:r,featureKeys:n}}function _i(e){var i=131,r=137,n=0;e+="x";for(var a=Math.floor(9007199254740991/r),s=0;s<e.length;s++)n>a&&(n=Math.floor(n/r)),n=n*i+e.charCodeAt(s);return n}function an(e){e=e.toString();for(var i=5381,r=e.length;r;)i=i*33^e.charCodeAt(--r);return i>>>0}var on=U(28481),Xi="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function yi(e){this.message=e}yi.prototype=new Error,yi.prototype.name="InvalidCharacterError";function Pi(e){var i=String(e).replace(/=+$/,"");if(i.length%4==1)throw new yi("'atob' failed: The string to be decoded is not correctly encoded.");for(var r="",n=0,a,s,f=0;s=i.charAt(f++);~s&&(a=n%4?a*64+s:s,n++%4)?r+=String.fromCharCode(255&a>>(-2*n&6)):0)s=Xi.indexOf(s);return r}function bi(e){e=String(e);for(var i,r,n,a,s="",f=0,v=e.length%3;f<e.length;){if((r=e.charCodeAt(f++))>255||(n=e.charCodeAt(f++))>255||(a=e.charCodeAt(f++))>255)throw new TypeError("Failed to execute 'btoa' on 'Window': The string to be encoded contains characters outside of the Latin1 range.");i=r<<16|n<<8|a,s+=Xi.charAt(i>>18&63)+Xi.charAt(i>>12&63)+Xi.charAt(i>>6&63)+Xi.charAt(i&63)}return v?s.slice(0,v-3)+"===".substring(v):s}var ht=U(6610),Pt=U(5991),Aa=function(){function e(i,r){(0,ht.Z)(this,e),this.buffers=i,this.type=r}return(0,Pt.Z)(e,[{key:"arraybuffer",value:function(){return Promise.resolve(this.buffers[0])}},{key:"stream",value:function(){throw new Error("not implemented")}},{key:"text",value:function(){throw new Error("not implemented")}},{key:"slice",value:function(r,n,a){throw new Error("not implemented")}}]),e}(),qi,Ii=function(){return qi||(qi=typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:typeof U.g!="undefined"?U.g:{})};qi=Ii();var pi;typeof window=="undefined"?pi={devicePixelRatio:1,navigator:{userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36",browserLanguage:"zh-CN",language:"zh-CN",platform:""},location:"",document:{documentElement:{style:{}},createEvent:function(){return!0},getElementById:function(i){return!0},createElement:function(){return{className:"",classList:{add:function(){return""}}}},createElementNS:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},querySelector:function(){return!1}},performance:{mark:function(i){return null},clearMeasures:function(i){return null},clearMarks:function(i){return null},measure:function(i,r,n){return{duration:0}},now:function(){return new Date().getTime()}},Blob:"",dispatchEvent:function(i){return!0},Event:function(i,r){return!0},createElement:function(){return!0},createElementNS:function(){return!0},XMLHttpRequest:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},requestAnimationFrame:function(){return!0},cancelAnimationFrame:function(){return!0},clearTimeout:function(){return!0}}:pi=window;var wa=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,$s=wa?my.getSystemInfoSync().pixelRatio:pi.devicePixelRatio,Ir=U(10379),wr=U(46070),Mt=U(77608),bo=(0,Pt.Z)(function e(i,r){(0,ht.Z)(this,e),(0,A.Z)(this,"cancelBubble",void 0),(0,A.Z)(this,"cancelable",void 0),(0,A.Z)(this,"target",void 0),(0,A.Z)(this,"currentTarget",void 0),(0,A.Z)(this,"preventDefault",void 0),(0,A.Z)(this,"stopPropagation",void 0),(0,A.Z)(this,"type",void 0),(0,A.Z)(this,"timeStamp",void 0),this.cancelBubble=!1,this.cancelable=!1,this.target=null,this.currentTarget=null,this.preventDefault=function(){},this.stopPropagation=function(){},this.type=i,this.timeStamp=Date.now()}),ne=U(63349);function Fu(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=oo(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function oo(e,i){if(!!e){if(typeof e=="string")return Ra(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ra(e,i)}}function Ra(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var Ta=new WeakMap,Qi=function(){function e(){(0,ht.Z)(this,e),Ta.set(this,{})}return(0,Pt.Z)(e,[{key:"addEventListener",value:function(r,n){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=Ta.get(this);s||(s={}),s[r]||(s[r]=[]),s[r].push(n),Ta.set(this,s),a.capture,a.once,a.passive}},{key:"removeEventListener",value:function(r,n){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=Ta.get(this);if(s){var f=s[r];if(f&&f.length>0){for(var v=f.length;v--;v>0)if(f[v]===n){f.splice(v,1);break}}}}},{key:"dispatchEvent",value:function(r){var n=Ta.get(this)[r.type];if(n){var a=Fu(n),s;try{for(a.s();!(s=a.n()).done;){var f=s.value;f(r)}}catch(v){a.e(v)}finally{a.f()}}}}]),e}();function Uo(e){var i=$o();return function(){var n=(0,Mt.Z)(e),a;if(i){var s=(0,Mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,wr.Z)(this,a)}}function $o(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var xu=function(e){(0,Ir.Z)(r,e);var i=Uo(r);function r(){var n;return(0,ht.Z)(this,r),n=i.call(this),(0,A.Z)((0,ne.Z)(n),"childNodes",void 0),n.childNodes=[],n}return(0,Pt.Z)(r,[{key:"appendChild",value:function(a){this.childNodes.push(a)}},{key:"cloneNode",value:function(){var a=Object.create(this);return Object.assign(a,this),a}},{key:"removeChild",value:function(a){var s=this.childNodes.findIndex(function(f){return f===a});return s>-1?this.childNodes.splice(s,1):null}}]),r}(Qi);function Eo(e){var i=Zo();return function(){var n=(0,Mt.Z)(e),a;if(i){var s=(0,Mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,wr.Z)(this,a)}}function Zo(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var sa=function(e){(0,Ir.Z)(r,e);var i=Eo(r);function r(){var n;return(0,ht.Z)(this,r),n=i.call(this),(0,A.Z)((0,ne.Z)(n),"className",void 0),(0,A.Z)((0,ne.Z)(n),"children",void 0),n.className="",n.children=[],n}return(0,Pt.Z)(r,[{key:"setAttribute",value:function(a,s){this[a]=s}},{key:"getAttribute",value:function(a){return this[a]}},{key:"setAttributeNS",value:function(a,s){this[a]=s}},{key:"getAttributeNS",value:function(a){return this[a]}}]),r}(xu),so=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,jo,Ya,Gs,ll;if(so){var os=my.getSystemInfoSync();jo=os.screenWidth,Ya=os.screenHeight,Gs=os.windowWidth,ll=os.windowHeight}else{var ie=pi.innerWidth,Ee=pi.innerHeight;jo=ie,Ya=Ee,Gs=ie,ll=Ee}var qe={width:jo,height:Ya,availWidth:Gs,availHeight:ll,availLeft:0,availTop:0},Rt=qe.availWidth,Or=qe.availHeight,Tn={style:[]};function Ti(e,i){if(!("parentNode"in e)){var r;i===0?r=function(){return null}:i===1?r=function(){return Tn}:r=function(){return null},Object.defineProperty(e,"parentNode",{enumerable:!0,get:r})}if(!("parentElement"in e)){var n;i===0?n=function(){return null}:i===1?n=function(){return Tn}:n=function(){return null},Object.defineProperty(e,"parentElement",{enumerable:!0,get:n})}}function ro(e){e.style=e.style||{},Object.assign(e.style,{top:"0px",left:"0px",width:Rt+"px",height:Or+"px",margin:"0px",padding:"0px"})}function La(e){"clientLeft"in e||(e.clientLeft=0,e.clientTop=0),"clientWidth"in e||(e.clientWidth=Rt,e.clientHeight=Or),"getBoundingClientRect"in e||(e.getBoundingClientRect=function(){var i={x:0,y:0,top:0,left:0,width:this.clientWidth,height:this.clientHeight,right:this.clientWidth,bottom:this.clientHeight};return i})}function ja(e){"offsetLeft"in e||(e.offsetLeft=0,e.offsetTop=0),"offsetWidth"in e||(e.offsetWidth=Rt,e.offsetHeight=Or)}function Qo(e){"scrollLeft"in e||(e.scrollLeft=0,e.scrollTop=0),"scrollWidth"in e||(e.scrollWidth=Rt,e.scrollHeight=Or)}function ps(e){var i=function(){return!0};e.classList=[],e.classList.add=i,e.classList.remove=i,e.classList.contains=i,e.classList.toggle=i}function Jo(e){var i=Ss();return function(){var n=(0,Mt.Z)(e),a;if(i){var s=(0,Mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,wr.Z)(this,a)}}function Ss(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function Lo(){}var Vo=function(e){(0,Ir.Z)(r,e);var i=Jo(r);function r(){var n,a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",s=arguments.length>1?arguments[1]:void 0;return(0,ht.Z)(this,r),n=i.call(this),(0,A.Z)((0,ne.Z)(n),"className",void 0),(0,A.Z)((0,ne.Z)(n),"children",void 0),(0,A.Z)((0,ne.Z)(n),"focus",void 0),(0,A.Z)((0,ne.Z)(n),"blur",void 0),(0,A.Z)((0,ne.Z)(n),"insertBefore",void 0),(0,A.Z)((0,ne.Z)(n),"appendChild",void 0),(0,A.Z)((0,ne.Z)(n),"removeChild",void 0),(0,A.Z)((0,ne.Z)(n),"remove",void 0),(0,A.Z)((0,ne.Z)(n),"innerHTML",void 0),(0,A.Z)((0,ne.Z)(n),"tagName",void 0),n.className="",n.children=[],n.focus=Lo,n.blur=Lo,n.insertBefore=Lo,n.appendChild=Lo,n.removeChild=Lo,n.remove=Lo,n.innerHTML="",n.tagName=a.toUpperCase(),Ti((0,ne.Z)(n),s),ro((0,ne.Z)(n)),ps((0,ne.Z)(n)),La((0,ne.Z)(n)),ja((0,ne.Z)(n)),Qo((0,ne.Z)(n)),n}return(0,Pt.Z)(r)}(sa);function Qs(e){var i=ou();return function(){var n=(0,Mt.Z)(e),a;if(i){var s=(0,Mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,wr.Z)(this,a)}}function ou(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ds=function(e){(0,Ir.Z)(r,e);var i=Qs(r);function r(n){return(0,ht.Z)(this,r),i.call(this,n)}return(0,Pt.Z)(r,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),r}(Vo);function ga(e){var i=ko();return function(){var n=(0,Mt.Z)(e),a;if(i){var s=(0,Mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,wr.Z)(this,a)}}function ko(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Il=function(e){(0,Ir.Z)(r,e);var i=ga(r);function r(){return(0,ht.Z)(this,r),i.call(this,"video")}return(0,Pt.Z)(r)}(ds),vs={},es={};function of(e,i){vs=e,vs.id=i,"tagName"in vs||(vs.tagName="CANVAS"),vs.type="canvas",Mixin.parentNode(vs),Mixin.style(vs),Mixin.classList(vs),Mixin.clientRegion(vs),Mixin.offsetRegion(vs),vs.focus=function(){},vs.blur=function(){}}function rc(e,i){var r=1024,n=1024;es={width:r,height:n,clientWidth:r/devicePixelRatio,clientHeight:n/devicePixelRatio,id:i,type:"canvas"},"tagName"in es||(es.tagName="CANVAS"),Mixin.parentNode(es),Mixin.style(es),Mixin.classList(es),Mixin.clientRegion(es),Mixin.offsetRegion(es),es.getContext=function(a){if(a==="2d")return e},es.focus=function(){},es.blur=function(){}}function Cs(){return vs}function bu(){return es}var cl=(0,Pt.Z)(function e(){(0,ht.Z)(this,e);var i=Cs(),r=i.createImage&&i.createImage()||{};return"tagName"in r||(r.tagName="IMG",r.__proto__=e.prototype),Ti(r),ps(r),Object.assign(r,{addEventListener:function(a,s){r["on".concat(a)]=s.bind(r)},removeEventListener:function(a){r["on".concat(a)]=null}}),r}),_={href:"",protocol:"",host:""};function M(e){var i=F();return function(){var n=(0,Mt.Z)(e),a;if(i){var s=(0,Mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,wr.Z)(this,a)}}function F(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var R=function(e){(0,Ir.Z)(r,e);var i=M(r);function r(){return(0,ht.Z)(this,r),i.call(this,"body",0)}return(0,Pt.Z)(r,[{key:"addEventListener",value:function(a,s){var f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(a,s,f){}},{key:"dispatchEvent",value:function(a){}}]),r}(Vo),K=function(e){(0,Ir.Z)(r,e);var i=M(r);function r(){return(0,ht.Z)(this,r),i.call(this,"html",0)}return(0,Pt.Z)(r,[{key:"addEventListener",value:function(a,s){var f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(a,s){}},{key:"dispatchEvent",value:function(a){}}]),r}(Vo),_e={},je={readyState:"complete",visibilityState:"visible",hidden:!1,fullscreen:!0,scripts:[],style:{},location:_,ontouchstart:null,ontouchmove:null,ontouchend:null,onvisibilitychange:null,parentNode:null,parentElement:null,head:null,body:null,documentElement:{style:[]},createElement:function(i){return i=i.toLowerCase(),i==="canvas"?my.createOffscreenCanvas(1024,128,"2d"):i==="img"?new cl:i==="video"?new Il:new Vo(i)},createElementNS:function(i,r){return this.createElement(r)},createTextNode:function(i){return i},getElementById:function(i){return null},getElementsByTagName:function(i){return i=i.toLowerCase(),[]},getElementsByTagNameNS:function(i,r){return this.getElementsByTagName(r)},getElementsByName:function(i){return[]},querySelector:function(i){return null},querySelectorAll:function(i){return[]},addEventListener:function(i,r,n){_e[i]||(_e[i]=[]),_e[i].push(r)},removeEventListener:function(i,r){var n=_e[i];if(n&&n.length>0){for(var a=n.length;a--;a>0)if(n[a]===r){n.splice(a,1);break}}},dispatchEvent:function(i){var r=i.type,n=_e[r];if(n)for(var a=0;a<n.length;a++)n[a](i);i.target&&typeof i.target["on"+r]=="function"&&i.target["on"+r](i)},createEvent:function(i){return new bo(i)}};je.documentElement=new K,je.head=new Vo("head"),je.body=new R;var pt=Object,dt=U(90484),ur=function(){function e(){(0,ht.Z)(this,e),(0,A.Z)(this,"_w",void 0),(0,A.Z)(this,"_h",void 0),(0,A.Z)(this,"_data",void 0);var i=arguments.length;if(i===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){this._w=arguments[0],this._h=arguments[1],this._data=new Uint8ClampedArray(this._w*this._h*4);return}}else i===3&&(0,dt.Z)(arguments[0])==="object"&&typeof arguments[1]=="number"&&typeof arguments[2]=="number"&&(this._data=arguments[0],this._w=arguments[1],this._h=arguments[2]);throw new Error("ImageData: params error")}return(0,Pt.Z)(e,[{key:"width",get:function(){return this._w}},{key:"height",get:function(){return this._h}},{key:"data",get:function(){return this._data}}]),e}(),yr=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,In,Bn,Qn;if(yr){var Vi=my.getSystemInfoSync();In=Vi.system,Bn=Vi.platform,Qn=Vi.language}else{var Li={versions:function(){var e=pi.navigator.userAgent;return{trident:e.indexOf("Trident")>-1,presto:e.indexOf("Presto")>-1,webKit:e.indexOf("AppleWebKit")>-1,gecko:e.indexOf("Gecko")>-1&&e.indexOf("KHTML")===-1,mobile:!!e.match(/AppleWebKit.*Mobile.*/),ios:!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:e.indexOf("Android")>-1||e.indexOf("Linux")>-1,iPhone:e.indexOf("iPhone")>-1,iPad:e.indexOf("iPad")>-1,webApp:e.indexOf("Safari")===-1,weixin:e.indexOf("MicroMessenger")>-1,qq:e.match(/\sQQ/i)===" qq"}}(),language:(pi.navigator.browserLanguage||pi.navigator.language).toLowerCase()};Li.versions.android?Bn="android":Li.versions.trident?Bn="IE":Li.versions.presto?Bn="Opera":Li.versions.webKit?Bn="webKit":Li.versions.gecko?Bn="Firefox":Li.versions.mobile?Bn="mobile":Li.versions.ios?Bn="ios":Li.versions.iPhone?Bn="iPhone":Li.versions.iPad?Bn="ipad":Li.versions.webApp?Bn="webApp":Li.versions.weixin?Bn="weixin":Li.versions.qq&&(Bn="qq"),In=pi.navigator.userAgent,Qn=Li.language}var ba=In.toLowerCase().indexOf("android")!==-1,Gi=ba?"Android; CPU Android 6.0":"iPhone; CPU iPhone OS 10_3_1 like Mac OS X",As="Mozilla/5.0 (".concat(Gi,") AppleWebKit/603.1.30 (KHTML, like Gecko) Mobile/14E8301 MicroMessenger/6.6.0 MiniGame NetType/WIFI Language/").concat(Qn),Eu={platform:Bn,language:Qn,appVersion:"5.0 (".concat(Gi,") AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1"),userAgent:As},fl={mark:function(i){return null},clearMeasures:function(i){return null},clearMarks:function(i){return null},measure:function(i,r,n){return{duration:0}},now:function(){}},Rc=0,tl=0;function Lc(e){var i=Date.now(),r=Math.max(Rc+23,i);return tl=setTimeout(function(){e(Rc=r)},r-i),tl}function Bu(e){var i=Cs();return i.requestAnimationFrame?i.requestAnimationFrame(e):Lc(e)}function Nu(e){var i=Cs();return i.cancelAnimationFrame?i.cancelAnimationFrame(e):clearTimeout(e)}var zu=function(){function e(i){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if((0,ht.Z)(this,e),(0,A.Z)(this,"href",void 0),i.indexOf("http://")==0||i.indexOf("https://")==0){this.href=i;return}this.href=r+i}return(0,Pt.Z)(e,null,[{key:"createObjectURL",value:function(r){var n=r.buffers[0],a=r.type,s=uo(n),f="data:".concat(a,";base64, ");return f+s}}]),e}();function uo(e){for(var i="",r=new Uint8Array(e),n=r.byteLength,a=0;a<n;a++)i+=String.fromCharCode(r[a]);return bi(i)}var Bf={GCCSO_SHADER_BINARY_FJ:37472,_3DC_XY_AMD:34810,_3DC_X_AMD:34809,ACTIVE_ATTRIBUTES:35721,ACTIVE_ATTRIBUTE_MAX_LENGTH:35722,ACTIVE_PROGRAM_EXT:33369,ACTIVE_TEXTURE:34016,ACTIVE_UNIFORMS:35718,ACTIVE_UNIFORM_MAX_LENGTH:35719,ALIASED_LINE_WIDTH_RANGE:33902,ALIASED_POINT_SIZE_RANGE:33901,ALL_COMPLETED_NV:34034,ALL_SHADER_BITS_EXT:4294967295,ALPHA:6406,ALPHA16F_EXT:34844,ALPHA32F_EXT:34838,ALPHA8_EXT:32828,ALPHA8_OES:32828,ALPHA_BITS:3413,ALPHA_TEST_FUNC_QCOM:3009,ALPHA_TEST_QCOM:3008,ALPHA_TEST_REF_QCOM:3010,ALREADY_SIGNALED_APPLE:37146,ALWAYS:519,AMD_compressed_3DC_texture:1,AMD_compressed_ATC_texture:1,AMD_performance_monitor:1,AMD_program_binary_Z400:1,ANGLE_depth_texture:1,ANGLE_framebuffer_blit:1,ANGLE_framebuffer_multisample:1,ANGLE_instanced_arrays:1,ANGLE_pack_reverse_row_order:1,ANGLE_program_binary:1,ANGLE_texture_compression_dxt3:1,ANGLE_texture_compression_dxt5:1,ANGLE_texture_usage:1,ANGLE_translated_shader_source:1,ANY_SAMPLES_PASSED_CONSERVATIVE_EXT:36202,ANY_SAMPLES_PASSED_EXT:35887,APPLE_copy_texture_levels:1,APPLE_framebuffer_multisample:1,APPLE_rgb_422:1,APPLE_sync:1,APPLE_texture_format_BGRA8888:1,APPLE_texture_max_level:1,ARM_mali_program_binary:1,ARM_mali_shader_binary:1,ARM_rgba8:1,ARRAY_BUFFER:34962,ARRAY_BUFFER_BINDING:34964,ATC_RGBA_EXPLICIT_ALPHA_AMD:35987,ATC_RGBA_INTERPOLATED_ALPHA_AMD:34798,ATC_RGB_AMD:35986,ATTACHED_SHADERS:35717,BACK:1029,BGRA8_EXT:37793,BGRA_EXT:32993,BGRA_IMG:32993,BINNING_CONTROL_HINT_QCOM:36784,BLEND:3042,BLEND_COLOR:32773,BLEND_DST_ALPHA:32970,BLEND_DST_RGB:32968,BLEND_EQUATION:32777,BLEND_EQUATION_ALPHA:34877,BLEND_EQUATION_RGB:32777,BLEND_SRC_ALPHA:32971,BLEND_SRC_RGB:32969,BLUE_BITS:3412,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,BUFFER:33504,BUFFER_ACCESS_OES:35003,BUFFER_MAPPED_OES:35004,BUFFER_MAP_POINTER_OES:35005,BUFFER_OBJECT_EXT:37201,BUFFER_SIZE:34660,BUFFER_USAGE:34661,BYTE:5120,CCW:2305,CLAMP_TO_BORDER_NV:33069,CLAMP_TO_EDGE:33071,COLOR_ATTACHMENT0:36064,COLOR_ATTACHMENT0_NV:36064,COLOR_ATTACHMENT10_NV:36074,COLOR_ATTACHMENT11_NV:36075,COLOR_ATTACHMENT12_NV:36076,COLOR_ATTACHMENT13_NV:36077,COLOR_ATTACHMENT14_NV:36078,COLOR_ATTACHMENT15_NV:36079,COLOR_ATTACHMENT1_NV:36065,COLOR_ATTACHMENT2_NV:36066,COLOR_ATTACHMENT3_NV:36067,COLOR_ATTACHMENT4_NV:36068,COLOR_ATTACHMENT5_NV:36069,COLOR_ATTACHMENT6_NV:36070,COLOR_ATTACHMENT7_NV:36071,COLOR_ATTACHMENT8_NV:36072,COLOR_ATTACHMENT9_NV:36073,COLOR_ATTACHMENT_EXT:37104,COLOR_BUFFER_BIT:16384,COLOR_BUFFER_BIT0_QCOM:1,COLOR_BUFFER_BIT1_QCOM:2,COLOR_BUFFER_BIT2_QCOM:4,COLOR_BUFFER_BIT3_QCOM:8,COLOR_BUFFER_BIT4_QCOM:16,COLOR_BUFFER_BIT5_QCOM:32,COLOR_BUFFER_BIT6_QCOM:64,COLOR_BUFFER_BIT7_QCOM:128,COLOR_CLEAR_VALUE:3106,COLOR_EXT:6144,COLOR_WRITEMASK:3107,COMPARE_REF_TO_TEXTURE_EXT:34894,COMPILE_STATUS:35713,COMPRESSED_RGBA_ASTC_10x10_KHR:37819,COMPRESSED_RGBA_ASTC_10x5_KHR:37816,COMPRESSED_RGBA_ASTC_10x6_KHR:37817,COMPRESSED_RGBA_ASTC_10x8_KHR:37818,COMPRESSED_RGBA_ASTC_12x10_KHR:37820,COMPRESSED_RGBA_ASTC_12x12_KHR:37821,COMPRESSED_RGBA_ASTC_4x4_KHR:37808,COMPRESSED_RGBA_ASTC_5x4_KHR:37809,COMPRESSED_RGBA_ASTC_5x5_KHR:37810,COMPRESSED_RGBA_ASTC_6x5_KHR:37811,COMPRESSED_RGBA_ASTC_6x6_KHR:37812,COMPRESSED_RGBA_ASTC_8x5_KHR:37813,COMPRESSED_RGBA_ASTC_8x6_KHR:37814,COMPRESSED_RGBA_ASTC_8x8_KHR:37815,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGBA_PVRTC_2BPPV2_IMG:37175,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_4BPPV2_IMG:37176,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_ANGLE:33778,COMPRESSED_RGBA_S3TC_DXT5_ANGLE:33779,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:37853,COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:37847,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_NV:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_NV:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_NV:35919,COMPRESSED_SRGB_S3TC_DXT1_NV:35916,COMPRESSED_TEXTURE_FORMATS:34467,CONDITION_SATISFIED_APPLE:37148,CONSTANT_ALPHA:32771,CONSTANT_COLOR:32769,CONTEXT_FLAG_DEBUG_BIT:2,CONTEXT_ROBUST_ACCESS_EXT:37107,COUNTER_RANGE_AMD:35777,COUNTER_TYPE_AMD:35776,COVERAGE_ALL_FRAGMENTS_NV:36565,COVERAGE_ATTACHMENT_NV:36562,COVERAGE_AUTOMATIC_NV:36567,COVERAGE_BUFFERS_NV:36563,COVERAGE_BUFFER_BIT_NV:32768,COVERAGE_COMPONENT4_NV:36561,COVERAGE_COMPONENT_NV:36560,COVERAGE_EDGE_FRAGMENTS_NV:36566,COVERAGE_SAMPLES_NV:36564,CPU_OPTIMIZED_QCOM:36785,CULL_FACE:2884,CULL_FACE_MODE:2885,CURRENT_PROGRAM:35725,CURRENT_QUERY_EXT:34917,CURRENT_VERTEX_ATTRIB:34342,CW:2304,DEBUG_CALLBACK_FUNCTION:33348,DEBUG_CALLBACK_USER_PARAM:33349,DEBUG_GROUP_STACK_DEPTH:33389,DEBUG_LOGGED_MESSAGES:37189,DEBUG_NEXT_LOGGED_MESSAGE_LENGTH:33347,DEBUG_OUTPUT:37600,DEBUG_OUTPUT_SYNCHRONOUS:33346,DEBUG_SEVERITY_HIGH:37190,DEBUG_SEVERITY_LOW:37192,DEBUG_SEVERITY_MEDIUM:37191,DEBUG_SEVERITY_NOTIFICATION:33387,DEBUG_SOURCE_API:33350,DEBUG_SOURCE_APPLICATION:33354,DEBUG_SOURCE_OTHER:33355,DEBUG_SOURCE_SHADER_COMPILER:33352,DEBUG_SOURCE_THIRD_PARTY:33353,DEBUG_SOURCE_WINDOW_SYSTEM:33351,DEBUG_TYPE_DEPRECATED_BEHAVIOR:33357,DEBUG_TYPE_ERROR:33356,DEBUG_TYPE_MARKER:33384,DEBUG_TYPE_OTHER:33361,DEBUG_TYPE_PERFORMANCE:33360,DEBUG_TYPE_POP_GROUP:33386,DEBUG_TYPE_PORTABILITY:33359,DEBUG_TYPE_PUSH_GROUP:33385,DEBUG_TYPE_UNDEFINED_BEHAVIOR:33358,DECR:7683,DECR_WRAP:34056,DELETE_STATUS:35712,DEPTH24_STENCIL8_OES:35056,DEPTH_ATTACHMENT:36096,DEPTH_STENCIL_ATTACHMENT:33306,DEPTH_BITS:3414,DEPTH_BUFFER_BIT:256,DEPTH_BUFFER_BIT0_QCOM:256,DEPTH_BUFFER_BIT1_QCOM:512,DEPTH_BUFFER_BIT2_QCOM:1024,DEPTH_BUFFER_BIT3_QCOM:2048,DEPTH_BUFFER_BIT4_QCOM:4096,DEPTH_BUFFER_BIT5_QCOM:8192,DEPTH_BUFFER_BIT6_QCOM:16384,DEPTH_BUFFER_BIT7_QCOM:32768,DEPTH_CLEAR_VALUE:2931,DEPTH_COMPONENT:6402,DEPTH_COMPONENT16:33189,DEPTH_COMPONENT16_NONLINEAR_NV:36396,DEPTH_COMPONENT16_OES:33189,DEPTH_COMPONENT24_OES:33190,DEPTH_COMPONENT32_OES:33191,DEPTH_EXT:6145,DEPTH_FUNC:2932,DEPTH_RANGE:2928,DEPTH_STENCIL:34041,DEPTH_STENCIL_OES:34041,DEPTH_TEST:2929,DEPTH_WRITEMASK:2930,DITHER:3024,DMP_shader_binary:1,DONT_CARE:4352,DRAW_BUFFER0_NV:34853,DRAW_BUFFER10_NV:34863,DRAW_BUFFER11_NV:34864,DRAW_BUFFER12_NV:34865,DRAW_BUFFER13_NV:34866,DRAW_BUFFER14_NV:34867,DRAW_BUFFER15_NV:34868,DRAW_BUFFER1_NV:34854,DRAW_BUFFER2_NV:34855,DRAW_BUFFER3_NV:34856,DRAW_BUFFER4_NV:34857,DRAW_BUFFER5_NV:34858,DRAW_BUFFER6_NV:34859,DRAW_BUFFER7_NV:34860,DRAW_BUFFER8_NV:34861,DRAW_BUFFER9_NV:34862,DRAW_BUFFER_EXT:3073,DRAW_FRAMEBUFFER_ANGLE:36009,DRAW_FRAMEBUFFER_APPLE:36009,DRAW_FRAMEBUFFER_BINDING_ANGLE:36006,DRAW_FRAMEBUFFER_BINDING_APPLE:36006,DRAW_FRAMEBUFFER_BINDING_NV:36006,DRAW_FRAMEBUFFER_NV:36009,DST_ALPHA:772,DST_COLOR:774,DYNAMIC_DRAW:35048,ELEMENT_ARRAY_BUFFER:34963,ELEMENT_ARRAY_BUFFER_BINDING:34965,EQUAL:514,ES_VERSION_2_0:1,ETC1_RGB8_OES:36196,ETC1_SRGB8_NV:35054,EXTENSIONS:7939,EXT_blend_minmax:1,EXT_color_buffer_half_float:1,EXT_debug_label:1,EXT_debug_marker:1,EXT_discard_framebuffer:1,EXT_map_buffer_range:1,EXT_multi_draw_arrays:1,EXT_multisampled_render_to_texture:1,EXT_multiview_draw_buffers:1,EXT_occlusion_query_boolean:1,EXT_read_format_bgra:1,EXT_robustness:1,EXT_sRGB:1,EXT_separate_shader_objects:1,EXT_shader_framebuffer_fetch:1,EXT_shader_texture_lod:1,EXT_shadow_samplers:1,EXT_texture_compression_dxt1:1,EXT_texture_filter_anisotropic:1,EXT_texture_format_BGRA8888:1,EXT_texture_rg:1,EXT_texture_storage:1,EXT_texture_type_2_10_10_10_REV:1,EXT_unpack_subimage:1,FALSE:0,FASTEST:4353,FENCE_CONDITION_NV:34036,FENCE_STATUS_NV:34035,FIXED:5132,FJ_shader_binary_GCCSO:1,FLOAT:5126,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,FRAGMENT_SHADER:35632,FRAGMENT_SHADER_BIT_EXT:2,FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723,FRAGMENT_SHADER_DISCARDS_SAMPLES_EXT:35410,FRAMEBUFFER:36160,FRAMEBUFFER_ATTACHMENT_ANGLE:37795,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_TEXTURE_3D_ZOFFSET_OES:36052,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_SAMPLES_EXT:36204,FRAMEBUFFER_BINDING:36006,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_ANGLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_APPLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_EXT:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_IMG:37172,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_NV:36182,FRAMEBUFFER_UNDEFINED_OES:33305,FRAMEBUFFER_UNSUPPORTED:36061,FRONT:1028,FRONT_AND_BACK:1032,FRONT_FACE:2886,FUNC_ADD:32774,FUNC_REVERSE_SUBTRACT:32779,FUNC_SUBTRACT:32778,GENERATE_MIPMAP_HINT:33170,GEQUAL:518,GPU_OPTIMIZED_QCOM:36786,GREATER:516,GREEN_BITS:3411,GUILTY_CONTEXT_RESET_EXT:33363,HALF_FLOAT_OES:36193,HIGH_FLOAT:36338,HIGH_INT:36341,IMG_multisampled_render_to_texture:1,IMG_program_binary:1,IMG_read_format:1,IMG_shader_binary:1,IMG_texture_compression_pvrtc:1,IMG_texture_compression_pvrtc2:1,IMPLEMENTATION_COLOR_READ_FORMAT:35739,IMPLEMENTATION_COLOR_READ_TYPE:35738,INCR:7682,INCR_WRAP:34055,INFO_LOG_LENGTH:35716,INNOCENT_CONTEXT_RESET_EXT:33364,INT:5124,INT_10_10_10_2_OES:36343,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,INVALID_ENUM:1280,INVALID_FRAMEBUFFER_OPERATION:1286,INVALID_OPERATION:1282,INVALID_VALUE:1281,INVERT:5386,KEEP:7680,KHR_debug:1,KHR_texture_compression_astc_ldr:1,LEFT:1030,LEQUAL:515,LESS:513,LINEAR:9729,LINEAR_MIPMAP_LINEAR:9987,LINEAR_MIPMAP_NEAREST:9985,LINES:1,LINE_LOOP:2,LINE_STRIP:3,LINE_WIDTH:2849,LINK_STATUS:35714,LOSE_CONTEXT_ON_RESET_EXT:33362,LOW_FLOAT:36336,LOW_INT:36339,LUMINANCE:6409,LUMINANCE16F_EXT:34846,LUMINANCE32F_EXT:34840,LUMINANCE4_ALPHA4_OES:32835,LUMINANCE8_ALPHA8_EXT:32837,LUMINANCE8_ALPHA8_OES:32837,LUMINANCE8_EXT:32832,LUMINANCE8_OES:32832,LUMINANCE_ALPHA:6410,LUMINANCE_ALPHA16F_EXT:34847,LUMINANCE_ALPHA32F_EXT:34841,MALI_PROGRAM_BINARY_ARM:36705,MALI_SHADER_BINARY_ARM:36704,MAP_FLUSH_EXPLICIT_BIT_EXT:16,MAP_INVALIDATE_BUFFER_BIT_EXT:8,MAP_INVALIDATE_RANGE_BIT_EXT:4,MAP_READ_BIT_EXT:1,MAP_UNSYNCHRONIZED_BIT_EXT:32,MAP_WRITE_BIT_EXT:2,MAX_3D_TEXTURE_SIZE_OES:32883,MAX_COLOR_ATTACHMENTS_NV:36063,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_CUBE_MAP_TEXTURE_SIZE:34076,MAX_DEBUG_GROUP_STACK_DEPTH:33388,MAX_DEBUG_LOGGED_MESSAGES:37188,MAX_DEBUG_MESSAGE_LENGTH:37187,MAX_DRAW_BUFFERS_NV:34852,MAX_EXT:32776,MAX_FRAGMENT_UNIFORM_VECTORS:36349,MAX_LABEL_LENGTH:33512,MAX_MULTIVIEW_BUFFERS_EXT:37106,MAX_RENDERBUFFER_SIZE:34024,MAX_SAMPLES_ANGLE:36183,MAX_SAMPLES_APPLE:36183,MAX_SAMPLES_EXT:36183,MAX_SAMPLES_IMG:37173,MAX_SAMPLES_NV:36183,MAX_SERVER_WAIT_TIMEOUT_APPLE:37137,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,MAX_TEXTURE_SIZE:3379,MAX_VARYING_VECTORS:36348,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VIEWPORT_DIMS:3386,MEDIUM_FLOAT:36337,MEDIUM_INT:36340,MIN_EXT:32775,MIRRORED_REPEAT:33648,MULTISAMPLE_BUFFER_BIT0_QCOM:16777216,MULTISAMPLE_BUFFER_BIT1_QCOM:33554432,MULTISAMPLE_BUFFER_BIT2_QCOM:67108864,MULTISAMPLE_BUFFER_BIT3_QCOM:134217728,MULTISAMPLE_BUFFER_BIT4_QCOM:268435456,MULTISAMPLE_BUFFER_BIT5_QCOM:536870912,MULTISAMPLE_BUFFER_BIT6_QCOM:1073741824,MULTISAMPLE_BUFFER_BIT7_QCOM:2147483648,MULTIVIEW_EXT:37105,NEAREST:9728,NEAREST_MIPMAP_LINEAR:9986,NEAREST_MIPMAP_NEAREST:9984,NEVER:512,NICEST:4354,NONE:0,NOTEQUAL:517,NO_ERROR:0,NO_RESET_NOTIFICATION_EXT:33377,NUM_COMPRESSED_TEXTURE_FORMATS:34466,NUM_PROGRAM_BINARY_FORMATS_OES:34814,NUM_SHADER_BINARY_FORMATS:36345,NV_coverage_sample:1,NV_depth_nonlinear:1,NV_draw_buffers:1,NV_draw_instanced:1,NV_fbo_color_attachments:1,NV_fence:1,NV_framebuffer_blit:1,NV_framebuffer_multisample:1,NV_generate_mipmap_sRGB:1,NV_instanced_arrays:1,NV_read_buffer:1,NV_read_buffer_front:1,NV_read_depth:1,NV_read_depth_stencil:1,NV_read_stencil:1,NV_sRGB_formats:1,NV_shadow_samplers_array:1,NV_shadow_samplers_cube:1,NV_texture_border_clamp:1,NV_texture_compression_s3tc_update:1,NV_texture_npot_2D_mipmap:1,OBJECT_TYPE_APPLE:37138,OES_EGL_image:1,OES_EGL_image_external:1,OES_compressed_ETC1_RGB8_texture:1,OES_compressed_paletted_texture:1,OES_depth24:1,OES_depth32:1,OES_depth_texture:1,OES_element_index_uint:1,OES_fbo_render_mipmap:1,OES_fragment_precision_high:1,OES_get_program_binary:1,OES_mapbuffer:1,OES_packed_depth_stencil:1,OES_required_internalformat:1,OES_rgb8_rgba8:1,OES_standard_derivatives:1,OES_stencil1:1,OES_stencil4:1,OES_surfaceless_context:1,OES_texture_3D:1,OES_texture_float:1,OES_texture_float_linear:1,OES_texture_half_float:1,OES_texture_half_float_linear:1,OES_texture_npot:1,OES_vertex_array_object:1,OES_vertex_half_float:1,OES_vertex_type_10_10_10_2:1,ONE:1,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,OUT_OF_MEMORY:1285,PACK_ALIGNMENT:3333,PACK_REVERSE_ROW_ORDER_ANGLE:37796,PALETTE4_R5_G6_B5_OES:35730,PALETTE4_RGB5_A1_OES:35732,PALETTE4_RGB8_OES:35728,PALETTE4_RGBA4_OES:35731,PALETTE4_RGBA8_OES:35729,PALETTE8_R5_G6_B5_OES:35735,PALETTE8_RGB5_A1_OES:35737,PALETTE8_RGB8_OES:35733,PALETTE8_RGBA4_OES:35736,PALETTE8_RGBA8_OES:35734,PERCENTAGE_AMD:35779,PERFMON_GLOBAL_MODE_QCOM:36768,PERFMON_RESULT_AMD:35782,PERFMON_RESULT_AVAILABLE_AMD:35780,PERFMON_RESULT_SIZE_AMD:35781,POINTS:0,POLYGON_OFFSET_FACTOR:32824,POLYGON_OFFSET_FILL:32823,POLYGON_OFFSET_UNITS:10752,PROGRAM:33506,PROGRAM_BINARY_ANGLE:37798,PROGRAM_BINARY_FORMATS_OES:34815,PROGRAM_BINARY_LENGTH_OES:34625,PROGRAM_OBJECT_EXT:35648,PROGRAM_PIPELINE_BINDING_EXT:33370,PROGRAM_PIPELINE_OBJECT_EXT:35407,PROGRAM_SEPARABLE_EXT:33368,QCOM_alpha_test:1,QCOM_binning_control:1,QCOM_driver_control:1,QCOM_extended_get:1,QCOM_extended_get2:1,QCOM_perfmon_global_mode:1,QCOM_tiled_rendering:1,QCOM_writeonly_rendering:1,QUERY:33507,QUERY_OBJECT_EXT:37203,QUERY_RESULT_AVAILABLE_EXT:34919,QUERY_RESULT_EXT:34918,R16F_EXT:33325,R32F_EXT:33326,R8_EXT:33321,READ_BUFFER_EXT:3074,READ_BUFFER_NV:3074,READ_FRAMEBUFFER_ANGLE:36008,READ_FRAMEBUFFER_APPLE:36008,READ_FRAMEBUFFER_BINDING_ANGLE:36010,READ_FRAMEBUFFER_BINDING_APPLE:36010,READ_FRAMEBUFFER_BINDING_NV:36010,READ_FRAMEBUFFER_NV:36008,RED_BITS:3410,RED_EXT:6403,RENDERBUFFER:36161,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_BINDING:36007,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_SAMPLES_ANGLE:36011,RENDERBUFFER_SAMPLES_APPLE:36011,RENDERBUFFER_SAMPLES_EXT:36011,RENDERBUFFER_SAMPLES_IMG:37171,RENDERBUFFER_SAMPLES_NV:36011,RENDERBUFFER_STENCIL_SIZE:36181,RENDERBUFFER_WIDTH:36162,RENDERER:7937,RENDER_DIRECT_TO_FRAMEBUFFER_QCOM:36787,REPEAT:10497,REPLACE:7681,REQUIRED_TEXTURE_IMAGE_UNITS_OES:36200,RESET_NOTIFICATION_STRATEGY_EXT:33366,RG16F_EXT:33327,RG32F_EXT:33328,RG8_EXT:33323,RGB:6407,RGB10_A2_EXT:32857,RGB10_EXT:32850,RGB16F_EXT:34843,RGB32F_EXT:34837,RGB565:36194,RGB565_OES:36194,RGB5_A1:32855,RGB5_A1_OES:32855,RGB8_OES:32849,RGBA:6408,RGBA16F_EXT:34842,RGBA32F_EXT:34836,RGBA4:32854,RGBA4_OES:32854,RGBA8_OES:32856,RGB_422_APPLE:35359,RG_EXT:33319,RIGHT:1031,SAMPLER:33510,SAMPLER_2D:35678,SAMPLER_2D_ARRAY_SHADOW_NV:36292,SAMPLER_2D_SHADOW_EXT:35682,SAMPLER_3D_OES:35679,SAMPLER_CUBE:35680,SAMPLER_CUBE_SHADOW_NV:36293,SAMPLER_EXTERNAL_OES:36198,SAMPLES:32937,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_BUFFERS:32936,SAMPLE_COVERAGE:32928,SAMPLE_COVERAGE_INVERT:32939,SAMPLE_COVERAGE_VALUE:32938,SCISSOR_BOX:3088,SCISSOR_TEST:3089,SGX_BINARY_IMG:35850,SGX_PROGRAM_BINARY_IMG:37168,SHADER:33505,SHADER_BINARY_DMP:37456,SHADER_BINARY_FORMATS:36344,SHADER_BINARY_VIV:36804,SHADER_COMPILER:36346,SHADER_OBJECT_EXT:35656,SHADER_SOURCE_LENGTH:35720,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,SHORT:5122,SIGNALED_APPLE:37145,SLUMINANCE8_ALPHA8_NV:35909,SLUMINANCE8_NV:35911,SLUMINANCE_ALPHA_NV:35908,SLUMINANCE_NV:35910,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,SRGB8_ALPHA8_EXT:35907,SRGB8_NV:35905,SRGB_ALPHA_EXT:35906,SRGB_EXT:35904,STACK_OVERFLOW:1283,STACK_UNDERFLOW:1284,STATE_RESTORE:35804,STATIC_DRAW:35044,STENCIL_ATTACHMENT:36128,STENCIL_BACK_FAIL:34817,STENCIL_BACK_FUNC:34816,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,STENCIL_BITS:3415,STENCIL_BUFFER_BIT:1024,STENCIL_BUFFER_BIT0_QCOM:65536,STENCIL_BUFFER_BIT1_QCOM:131072,STENCIL_BUFFER_BIT2_QCOM:262144,STENCIL_BUFFER_BIT3_QCOM:524288,STENCIL_BUFFER_BIT4_QCOM:1048576,STENCIL_BUFFER_BIT5_QCOM:2097152,STENCIL_BUFFER_BIT6_QCOM:4194304,STENCIL_BUFFER_BIT7_QCOM:8388608,STENCIL_CLEAR_VALUE:2961,STENCIL_EXT:6146,STENCIL_FAIL:2964,STENCIL_FUNC:2962,STENCIL_INDEX1_OES:36166,STENCIL_INDEX4_OES:36167,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_TEST:2960,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STREAM_DRAW:35040,SUBPIXEL_BITS:3408,SYNC_CONDITION_APPLE:37139,SYNC_FENCE_APPLE:37142,SYNC_FLAGS_APPLE:37141,SYNC_FLUSH_COMMANDS_BIT_APPLE:1,SYNC_GPU_COMMANDS_COMPLETE_APPLE:37143,SYNC_OBJECT_APPLE:35411,SYNC_STATUS_APPLE:37140,TEXTURE:5890,TEXTURE0:33984,TEXTURE1:33985,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE2:33986,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE3:33987,TEXTURE30:34014,TEXTURE31:34015,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE_2D:3553,TEXTURE_3D_OES:32879,TEXTURE_BINDING_2D:32873,TEXTURE_BINDING_3D_OES:32874,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_BINDING_EXTERNAL_OES:36199,TEXTURE_BORDER_COLOR_NV:4100,TEXTURE_COMPARE_FUNC_EXT:34893,TEXTURE_COMPARE_MODE_EXT:34892,TEXTURE_CUBE_MAP:34067,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_DEPTH_QCOM:35796,TEXTURE_EXTERNAL_OES:36197,TEXTURE_FORMAT_QCOM:35798,TEXTURE_HEIGHT_QCOM:35795,TEXTURE_IMAGE_VALID_QCOM:35800,TEXTURE_IMMUTABLE_FORMAT_EXT:37167,TEXTURE_INTERNAL_FORMAT_QCOM:35797,TEXTURE_MAG_FILTER:10240,TEXTURE_MAX_ANISOTROPY_EXT:34046,TEXTURE_MAX_LEVEL_APPLE:33085,TEXTURE_MIN_FILTER:10241,TEXTURE_NUM_LEVELS_QCOM:35801,TEXTURE_OBJECT_VALID_QCOM:35803,TEXTURE_SAMPLES_IMG:37174,TEXTURE_TARGET_QCOM:35802,TEXTURE_TYPE_QCOM:35799,TEXTURE_USAGE_ANGLE:37794,TEXTURE_WIDTH_QCOM:35794,TEXTURE_WRAP_R_OES:32882,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TIMEOUT_EXPIRED_APPLE:37147,TIMEOUT_IGNORED_APPLE:18446744073709552e3,TRANSLATED_SHADER_SOURCE_LENGTH_ANGLE:37792,TRIANGLES:4,TRIANGLE_FAN:6,TRIANGLE_STRIP:5,TRUE:1,UNKNOWN_CONTEXT_RESET_EXT:33365,UNPACK_ALIGNMENT:3317,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_PIXELS:3316,UNPACK_SKIP_ROWS:3315,UNSIGNALED_APPLE:37144,UNSIGNED_BYTE:5121,UNSIGNED_INT:5125,UNSIGNED_INT64_AMD:35778,UNSIGNED_INT_10_10_10_2_OES:36342,UNSIGNED_INT_24_8_OES:34042,UNSIGNED_INT_2_10_10_10_REV_EXT:33640,UNSIGNED_NORMALIZED_EXT:35863,UNSIGNED_SHORT:5123,UNSIGNED_SHORT_1_5_5_5_REV_EXT:33638,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_4_4_4_4_REV_EXT:33637,UNSIGNED_SHORT_4_4_4_4_REV_IMG:33637,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,UNSIGNED_SHORT_8_8_APPLE:34234,UNSIGNED_SHORT_8_8_REV_APPLE:34235,VALIDATE_STATUS:35715,VENDOR:7936,VERSION:7938,VERTEX_ARRAY_BINDING_OES:34229,VERTEX_ARRAY_OBJECT_EXT:37204,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,VERTEX_ATTRIB_ARRAY_DIVISOR_NV:35070,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_SHADER:35633,VERTEX_SHADER_BIT_EXT:1,VIEWPORT:2978,VIV_shader_binary:1,WAIT_FAILED_APPLE:37149,WRITEONLY_RENDERING_QCOM:34851,WRITE_ONLY_OES:35001,Z400_BINARY_AMD:34624,ZERO:0,RASTERIZER_DISCARD:35977,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444},Nf={};function ws(e){var i=sf();return function(){var n=(0,Mt.Z)(e),a;if(i){var s=(0,Mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,wr.Z)(this,a)}}function sf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var su=new Map,Hs=new Map,uf=new Map,Ol={json:"application/json",text:"application/text",arraybuffer:"application/octet-stream"};function ya(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{target:this};typeof this["on".concat(e)]=="function"&&this["on".concat(e)].call(this,i)}function nc(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{readyState:e};this.readyState=e,ya.call(this,"readystatechange",i)}var Js=function(e){(0,Ir.Z)(r,e);var i=ws(r);function r(){var n;return(0,ht.Z)(this,r),n=i.call(this),(0,A.Z)((0,ne.Z)(n),"onabort",void 0),(0,A.Z)((0,ne.Z)(n),"onerror",void 0),(0,A.Z)((0,ne.Z)(n),"onload",void 0),(0,A.Z)((0,ne.Z)(n),"onloadstart",void 0),(0,A.Z)((0,ne.Z)(n),"onprogress",void 0),(0,A.Z)((0,ne.Z)(n),"ontimeout",void 0),(0,A.Z)((0,ne.Z)(n),"onloadend",void 0),(0,A.Z)((0,ne.Z)(n),"onreadystatechange",void 0),(0,A.Z)((0,ne.Z)(n),"readyState",void 0),(0,A.Z)((0,ne.Z)(n),"response",void 0),(0,A.Z)((0,ne.Z)(n),"responseText",void 0),(0,A.Z)((0,ne.Z)(n),"_responseType",void 0),(0,A.Z)((0,ne.Z)(n),"responseXML",void 0),(0,A.Z)((0,ne.Z)(n),"status",void 0),(0,A.Z)((0,ne.Z)(n),"statusText",void 0),(0,A.Z)((0,ne.Z)(n),"upload",void 0),(0,A.Z)((0,ne.Z)(n),"withCredentials",void 0),(0,A.Z)((0,ne.Z)(n),"timeout",void 0),(0,A.Z)((0,ne.Z)(n),"_url",void 0),(0,A.Z)((0,ne.Z)(n),"_method",void 0),n.onabort=null,n.onerror=null,n.onload=null,n.onloadstart=null,n.onprogress=null,n.ontimeout=null,n.onloadend=null,n.onreadystatechange=null,n.readyState=0,n.response=null,n.responseText=null,n._responseType="text",n.responseXML=null,n.status=0,n.statusText="",n.upload={},n.withCredentials=!1,su.set("requestHeader",{"content-type":"application/x-www-form-urlencoded"}),n}return(0,Pt.Z)(r,[{key:"responseType",set:function(a){this._responseType=a}},{key:"abort",value:function(){var a=uf.get("requestTask");a&&a.abort()}},{key:"getAllResponseHeaders",value:function(){var a=Hs.get("responseHeader");return Object.keys(a).map(function(s){return"".concat(s,": ").concat(a[s])}).join(`
`)}},{key:"getResponseHeader",value:function(a){return Hs.get("responseHeader")[a]}},{key:"open",value:function(a,s,f){this._method=a,this._url=s}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:""}},{key:"setRequestHeader",value:function(a,s){var f=su.get("requestHeader");f[a]=s,su.set("requestHeader",f)}},{key:"addEventListener",value:function(a,s){var f=this;typeof s=="function"&&(this["on"+a]=function(){var v=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};v.target=v.target||f,s.call(f,v)})}},{key:"removeEventListener",value:function(a,s){this["on"+a]===s&&(this["on"+a]=null)}}]),r}(Qi);(0,A.Z)(Js,"UNSEND",void 0),(0,A.Z)(Js,"OPENED",void 0),(0,A.Z)(Js,"HEADERS_RECEIVED",void 0),(0,A.Z)(Js,"LOADING",void 0),(0,A.Z)(Js,"DONE",void 0),Js.UNSEND=0,Js.OPENED=1,Js.HEADERS_RECEIVED=2,Js.LOADING=3,Js.DONE=4;function hl(e){var i=zf();return function(){var n=(0,Mt.Z)(e),a;if(i){var s=(0,Mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,wr.Z)(this,a)}}function zf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ep=function(e){(0,Ir.Z)(r,e);var i=hl(r);function r(n){var a;return(0,ht.Z)(this,r),a=i.call(this,n),(0,A.Z)((0,ne.Z)(a),"touches",void 0),(0,A.Z)((0,ne.Z)(a),"targetTouches",void 0),(0,A.Z)((0,ne.Z)(a),"changedTouches",void 0),a.touches=[],a.targetTouches=[],a.changedTouches=[],a.target=Cs(),a.currentTarget=Cs(),a}return(0,Pt.Z)(r)}(bo);function lf(e){var i=e||{},r=i.x,n=r===void 0?0:r,a=i.y,s=a===void 0?0:a,f=i.clientX,v=f===void 0?0:f,g=i.clientY,x=g===void 0?0:g;Object.keys(e).indexOf("x")!==-1?(e.pageX=e.clientX=n,e.pageY=e.clientY=s):(e.x=v,e.y=x)}function ic(e){return function(i){var r=new ep(e);r.changedTouches=i.changedTouches,r.touches=i.touches,r.targetTouches=Array.prototype.slice.call(i.touches),r.timeStamp=i.timeStamp,r.changedTouches.forEach(function(n){return lf(n)}),r.touches.forEach(function(n){return lf(n)}),r.targetTouches.forEach(function(n){return lf(n)}),je.dispatchEvent(r)}}function ac(e){return function(i){i.type=e,je.dispatchEvent(i)}}var oc=ic("touchstart"),sc=ic("touchmove"),uc=ic("touchend"),Rl=ac("mapCameaParams");function Ll(e){var i=pl();return function(){var n=(0,Mt.Z)(e),a;if(i){var s=(0,Mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,wr.Z)(this,a)}}function pl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var eu=function(e){(0,Ir.Z)(r,e);var i=Ll(r);function r(n){var a;return(0,ht.Z)(this,r),a=i.call(this,n),(0,A.Z)((0,ne.Z)(a),"buttons",void 0),(0,A.Z)((0,ne.Z)(a),"which",void 0),(0,A.Z)((0,ne.Z)(a),"pointerId",void 0),(0,A.Z)((0,ne.Z)(a),"bubbles",void 0),(0,A.Z)((0,ne.Z)(a),"button",void 0),(0,A.Z)((0,ne.Z)(a),"width",void 0),(0,A.Z)((0,ne.Z)(a),"height",void 0),(0,A.Z)((0,ne.Z)(a),"pressure",void 0),(0,A.Z)((0,ne.Z)(a),"isPrimary",void 0),(0,A.Z)((0,ne.Z)(a),"pointerType",void 0),(0,A.Z)((0,ne.Z)(a),"altKey",void 0),(0,A.Z)((0,ne.Z)(a),"ctrlKey",void 0),(0,A.Z)((0,ne.Z)(a),"metaKey",void 0),(0,A.Z)((0,ne.Z)(a),"shiftKey",void 0),a.target=Cs(),a.currentTarget=Cs(),a}return(0,Pt.Z)(r)}(bo),kc=["bubbles","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","pointerId","width","height","pressure","tiltX","tiltY","pointerType","hwTimestamp","isPrimary","pageX","pageY","timeStamp"],cf=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,0,0,0],Uf="touch";function dl(e,i,r){for(var n=new eu(e),a=0;a<kc.length;a++){var s=kc[a];n[s]=i[s]||cf[a]}return n.type=e,n.target=Cs(),n.currentTarget=Cs(),n.buttons=lc(e),n.which=n.buttons,n.pointerId=(i.identifier||0)+2,n.bubbles=!0,n.cancelable=!0,n.button=0,n.width=(i.radiusX||.5)*2,n.height=(i.radiusY||.5)*2,n.pressure=i.force||.5,n.isPrimary=ff(i),n.pointerType=Uf,n.altKey=r.altKey,n.ctrlKey=r.ctrlKey,n.metaKey=r.metaKey,n.shiftKey=r.shiftKey,r.preventDefault&&(n.preventDefault=function(){r.preventDefault()}),n}function lc(e){var i=0;return(e==="touchstart"||e==="touchmove"||e==="pointerdown"||e==="pointermove")&&(i=1),i}var rl=null;function ff(e){return rl===e.identifier}function Dc(e){rl===null&&(rl=e.identifier)}function bh(e){rl===e.identifier&&(rl=null)}function kl(e){return function(i){for(var r=i.changedTouches,n=0;n<r.length;n++){var a=r[n];n===0&&e==="pointerdown"?Dc(a):(e==="pointerup"||e==="pointercancel")&&bh(a);var s=dl(e,a,i);je.dispatchEvent(s)}}}var Dl=kl("pointerdown"),Zf=kl("pointermove"),jf=kl("pointerup");function vl(e){var i=Vf();return function(){var n=(0,Mt.Z)(e),a;if(i){var s=(0,Mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,wr.Z)(this,a)}}function Vf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Eh=function(e){(0,Ir.Z)(r,e);var i=vl(r);function r(n){return(0,ht.Z)(this,r),i.call(this,n)}return(0,Pt.Z)(r)}(bo);function Fc(e){return function(i){i.type=e,je.dispatchEvent(i)}}var cc=Fc("mousedown"),tp=Fc("mousemove"),fc=Fc("mouseup"),Va=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,hc=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined"),ts=Va||hc,Uu={atob:Pi,btoa:bi,devicePixelRatio:$s,Blob:Aa,document:je,Element:sa,Event:bo,EventTarget:Qi,HTMLCanvasElement:pt,HTMLElement:Vo,HTMLMediaElement:ds,HTMLVideoElement:Il,Image:cl,ImageData:ur,navigator:Eu,Node:xu,requestAnimationFrame:Bu,cancelAnimationFrame:Nu,screen:qe,XMLHttpRequest:Js,performance:fl,URL:zu,WebGLRenderingContext:Bf,WebGL2RenderingContext:Nf,addEventListener:function(i,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};je.addEventListener(i,r,n)},removeEventListener:function(i,r,n){je.removeEventListener(i,r)},dispatchEvent:function(i){je.dispatchEvent(i)},innerWidth:qe.availWidth,innerHeight:qe.availHeight,setTimeout,clearTimeout,setInterval,clearInterval},kn=ts?Uu:pi,Ma=ts?Js:pi.XMLHttpRequest,Ws=ts?_:pi.location;function Bc(e){var i=e;return typeof e=="string"&&(i=kn.document.getElementById(e)),i}function Zu(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function Nc(e){return Zu(e).split(/\s+/)}function rp(e){var i,r,n=kn==null||(i=kn.document)===null||i===void 0||(r=i.documentElement)===null||r===void 0?void 0:r.style;if(!n)return e[0];for(var a in e)if(e[a]&&e[a]in n)return e[a];return e[0]}function lo(e,i,r){var n=kn.document.createElement(e);return n.className=i||"",r&&r.appendChild(n),n}function ju(e){var i=e.parentNode;i&&i.removeChild(e)}function Su(e,i){if(e.classList!==void 0)for(var r=Nc(i),n=0,a=r.length;n<a;n++)e.classList.add(r[n]);else if(!Do(e,i)){var s=ml(e);Fl(e,(s?s+" ":"")+i)}}function tu(e,i){e.classList!==void 0?e.classList.remove(i):Fl(e,Zu((" "+ml(e)+" ").replace(" "+i+" "," ")))}function Do(e,i){if(e.classList!==void 0)return e.classList.contains(i);var r=ml(e);return r.length>0&&new RegExp("(^|\\s)"+i+"(\\s|$)").test(r)}function Fl(e,i){e instanceof HTMLElement?e.className=i:e.className.baseVal=i}function ml(e){return e instanceof SVGElement&&(e=e.correspondingElement),e.className.baseVal===void 0?e.className:e.className.baseVal}function ho(e){for(;e&&e.firstChild;)e.removeChild(e.firstChild)}var yn=rp(["transform","WebkitTransform"]);function qa(e,i){e.style[yn]=i}function nl(){if(typeof Event=="function")kn.dispatchEvent(new Event("resize"));else{var e=kn.document.createEvent("UIEvents");e.initUIEvent("resize",!0,!1,kn,0),kn.dispatchEvent(e)}}function pc(e){var i=["padding: "+(e.height/2-8)+"px "+e.width/2+"px;","line-height: "+e.height+"px;","background-image: url("+e.toDataURL()+");"];console.log(`%c
`,i.join(""))}function uu(){var e,i=kn.document.querySelector('meta[name="viewport"]');if(!i)return 1;var r=(e=i.content)===null||e===void 0?void 0:e.split(","),n=r.find(function(a){var s=a.split("="),f=(0,on.Z)(s,2),v=f[0],g=f[1];return v==="initial-scale"});return n?n.split("=")[1]*1:1}var na=uu()<1?1:kn.devicePixelRatio;function hf(e){if(e.length===0)throw new Error("max requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]>i&&(i=e[r]);return i*1}function Kr(e){if(e.length===0)throw new Error("min requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]<i&&(i=e[r]);return i*1}function zc(e){if(e.length===0)return 0;for(var i=e[0]*1,r=1;r<e.length;r++)i+=e[r]*1;return i}function pf(e){if(e.length===0)throw new Error("mean requires at least one data point");return zc(e)/e.length}function gl(e){if(e.length===0)throw new Error("mean requires at least one data point");if(e.length<3)return e[0];e.sort();for(var i=e[0],r=NaN,n=0,a=1,s=1;s<e.length+1;s++)e[s]!==i?(a>n&&(n=a,r=i),a=1,i=e[s]):a++;return r*1}var Ea={min:Kr,max:hf,mean:pf,sum:zc,mode:gl};function ms(e,i){return e.map(function(r){return r[i]})}function Uc(e,i){return Ea[e](i)}var Cu=U(14665);function ks(e){return Function.toString.call(e).indexOf("[native code]")!==-1}var Vu=U(51814);function Zc(e,i,r){return(0,Vu.Z)()?Zc=Reflect.construct.bind():Zc=function(a,s,f){var v=[null];v.push.apply(v,s);var g=Function.bind.apply(a,v),x=new g;return f&&(0,Cu.Z)(x,f.prototype),x},Zc.apply(null,arguments)}function Bl(e){var i=typeof Map=="function"?new Map:void 0;return Bl=function(n){if(n===null||!ks(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(typeof i!="undefined"){if(i.has(n))return i.get(n);i.set(n,a)}function a(){return Zc(n,arguments,(0,Mt.Z)(this).constructor)}return a.prototype=Object.create(n.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),(0,Cu.Z)(a,n)},Bl(e)}function Gf(e){var i=Hf();return function(){var n=(0,Mt.Z)(e),a;if(i){var s=(0,Mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,wr.Z)(this,a)}}function Hf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ds=function(e){(0,Ir.Z)(r,e);var i=Gf(r);function r(n,a,s){var f;return(0,ht.Z)(this,r),f=i.call(this,n),(0,A.Z)((0,ne.Z)(f),"status",void 0),(0,A.Z)((0,ne.Z)(f),"url",void 0),f.status=a,f.url=s,f.name=f.constructor.name,f.message=n,f}return(0,Pt.Z)(r,[{key:"toString",value:function(){return"".concat(this.name,": ").concat(this.message," (").concat(this.status,"): ").concat(this.url)}}]),r}(Bl(Error));function Fs(e){var i=new Ma;i.open("GET",e.url,!0);for(var r in e.headers)e.headers.hasOwnProperty(r)&&i.setRequestHeader(r,e.headers[r]);return i.withCredentials=e.credentials==="include",i}var Fi=function(i,r){var n=Fs(i);return n.setRequestHeader("Accept","application/json"),n.onerror=function(){r(new Error(n.statusText))},n.onload=function(){if(n.status>=200&&n.status<300&&n.response){var a;try{a=JSON.parse(n.response)}catch(s){return r(s)}r(null,a)}else n.status===401?r(new Ds("".concat(n.statusText),n.status,i.url)):r(new Ds(n.statusText,n.status,i.url))},n.send(),n},Au=function(i,r){var n=Fs(i);return n.responseType="arraybuffer",n.onerror=function(){r(new Error(n.statusText))},n.onload=function(){var a=n.response;if(a.byteLength===0&&n.status===200)return r(new Error("http status 200 returned without content."));n.status>=200&&n.status<300&&n.response?r(null,{data:a,cacheControl:n.getResponseHeader("Cache-Control"),expires:n.getResponseHeader("Expires")}):r(new Ds(n.statusText,n.status,i.url))},n.send(),n};function wu(e){var i=$window.document.createElement("a");return i.href=e,i.protocol===$window.document.location.protocol&&i.host===$window.document.location.host}var rs="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",Gu=function(i,r){return Au(i,function(n,a){if(n)r(n);else if(a){var s=new kn.Image;s.crossOrigin="anonymous";var f=kn.URL||kn.webkitURL;s.onload=function(){r(null,s),f.revokeObjectURL(s.src),s.onload=null},s.onerror=function(){return r(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var v=new kn.Blob([new Uint8Array(a.data)],{type:"image/png"});s.src=a.data.byteLength?f.createObjectURL(v):rs}})},Tu=2*Math.PI*6378137/2;function Xs(e){var i=[Infinity,Infinity,-Infinity,-Infinity];return e.forEach(function(r){var n=r.coordinates;gs(i,n)}),i}function gs(e,i){return Array.isArray(i[0])?i.forEach(function(r){gs(e,r)}):(e[0]>i[0]&&(e[0]=i[0]),e[1]>i[1]&&(e[1]=i[1]),e[2]<i[0]&&(e[2]=i[0]),e[3]<i[1]&&(e[3]=i[1])),e}function Mu(e,i){return Rn(e,i)}function Rn(e,i){return Array.isArray(e[0])?e.map(function(r){return Rn(r,i)}):i(e)}function Cn(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{enable:!0,decimal:1};e=ns(e,i);var n=e[0],a=e[1],s=n*Tu/180,f=Math.log(Math.tan((90+a)*Math.PI/360))/(Math.PI/180);return f=f*Tu/180,r.enable&&(s=Number(s.toFixed(r.decimal)),f=Number(f.toFixed(r.decimal))),e.length===3?[s,f,e[2]]:[s,f]}function df(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,r=e[0],n=e[1],a=r/Tu*180,s=n/Tu*180;return s=180/Math.PI*(2*Math.atan(Math.exp(s*Math.PI/180))-Math.PI/2),i!=null&&(a=Number(a.toFixed(i)),s=Number(s.toFixed(i))),e.length===3?[a,s,e[2]]:[a,s]}function ys(e){if(e==null)throw new Error("lng is required");return(e>180||e<-180)&&(e=e%360,e>180&&(e=-360+e),e<-180&&(e=360+e),e===0&&(e=0)),e}function lu(e){if(e==null)throw new Error("lat is required");return(e>90||e<-90)&&(e=e%180,e>90&&(e=-180+e),e<-90&&(e=180+e),e===0&&(e=0)),e}function ns(e,i){if(i===!1)return e;var r=ys(e[0]),n=lu(e[1]);return n>85&&(n=85),n<-85&&(n=-85),e.length===3?[r,n,e[2]]:[r,n]}function Go(e){var i=85.0511287798,r=Math.max(Math.min(i,e[1]),-i),n=256<<20,a=Math.PI/180,s=e[0]*a,f=r*a;f=Math.log(Math.tan(Math.PI/4+f/2));var v=.5/Math.PI,g=.5,x=-.5/Math.PI;return a=.5,s=n*(v*s+g),f=n*(x*f+a),[Math.floor(s),Math.floor(f)]}function Wf(e){var i=.5/Math.PI,r=.5,n=-.5/Math.PI,a=.5,s=256<<20,f=_slicedToArray(e,2),v=f[0],g=f[1];v=(v/s-r)/i,g=(g/s-a)/n,g=(Math.atan(Math.pow(Math.E,g))-Math.PI/4)*2,a=Math.PI/180;var x=g/a,C=v/a;return[C,x]}function vf(e,i){var r=85.0511287798,n=Math.PI/180,a=6378137;return i=Math.max(Math.min(r,i),-r),e*=n,i*=n,i=Math.log(Math.tan(Math.PI/4+i/2)),[e*a,i*a]}function ha(e,i,r){var n=nr(i[1]-e[1]),a=nr(i[0]-e[0]),s=nr(e[1]),f=nr(i[1]),v=Math.pow(Math.sin(n/2),2)+Math.pow(Math.sin(a/2),2)*Math.cos(s)*Math.cos(f);return me(2*Math.atan2(Math.sqrt(v),Math.sqrt(1-v)),r="meters")}function Na(e){var i=Math.PI/180,r=85.0511287798,n=6378137,a=Math.max(Math.min(r,e[1]),-r),s=Math.sin(a*i),f=n*e[0]*i,v=n*Math.log((1+s)/(1-s))/2;return[f,v]}function dc(e,i){var r=Math.abs(e[1][1]-e[0][1])*i,n=Math.abs(e[1][0]-e[0][0])*i;return[[e[0][0]-n,e[0][1]-r],[e[1][0]+n,e[1][1]+r]]}function yl(e,i){return e[0][0]<=i[0][0]&&e[0][1]<=i[0][1]&&e[1][0]>=i[1][0]&&e[1][1]>=i[1][1]}function Pu(e){return[[e[0],e[1]],[e[2],e[3]]]}function cu(e){var i=Fo(e,[0,0]);return[e[0]/i,e[1]/i]}function Fo(e,i){return Math.sqrt(Math.pow(e[0]-i[0],2)+Math.pow(e[1]-i[1],2))}function il(e,i){return e[0]*i[0]+e[1]*i[1]}function fu(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function mf(e,i){return Math.acos(il(e,i)/(fu(e)*fu(i)))*180/Math.PI}function Nl(e,i){return i[0]>0?i[1]>0?90-Math.atan(i[1]/i[0])*180/Math.PI:90+Math.atan(-i[1]/i[0])*180/Math.PI:i[1]<0?180+(90-Math.atan(i[1]/i[0])*180/Math.PI):270+Math.atan(i[1]/-i[0])*180/Math.PI}function jc(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:100;if(!(!e||e.length<2)){for(var r=[0,1],n=0,a=[],s=0;s<e.length-1;s++){var f=e[s],v=e[s+1],g=Fo(f,v);n+=g;var x=[f[0]-v[0],f[1]-v[1]],C=Nl(r,x);if(s>0){var T=a[s-1].rotation;T-C>360-T+C&&(C=C+360)}a.push({start:f,end:v,dis:g,rotation:C,duration:0})}return a.map(function(O){O.duration=i*(O.dis/n)}),a}}var gf=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,r=arguments.length>1?arguments[1]:void 0;(0,ht.Z)(this,e),(0,A.Z)(this,"limit",void 0),(0,A.Z)(this,"cache",void 0),(0,A.Z)(this,"destroy",void 0),(0,A.Z)(this,"order",void 0),this.limit=i,this.destroy=r||this.defaultDestroy,this.order=[],this.clear()}return(0,Pt.Z)(e,[{key:"clear",value:function(){var r=this;this.order.forEach(function(n){r.delete(n)}),this.cache={},this.order=[]}},{key:"get",value:function(r){var n=this.cache[r];return n&&(this.deleteOrder(r),this.appendOrder(r)),n}},{key:"set",value:function(r,n){this.cache[r]?(this.delete(r),this.cache[r]=n,this.appendOrder(r)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[r]=n,this.appendOrder(r))}},{key:"delete",value:function(r){var n=this.cache[r];n&&(this.deleteCache(r),this.deleteOrder(r),this.destroy(n,r))}},{key:"deleteCache",value:function(r){delete this.cache[r]}},{key:"deleteOrder",value:function(r){var n=this.order.findIndex(function(a){return a===r});n>=0&&this.order.splice(n,1)}},{key:"appendOrder",value:function(r){this.order.push(r)}},{key:"defaultDestroy",value:function(r,n){return null}}]),e}();function Iu(e,i){e.forEach(function(r){!i[r]||(i[r]=i[r].bind(i))})}var vc=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16;(0,ht.Z)(this,e),(0,A.Z)(this,"duration",16),(0,A.Z)(this,"timestamp",new Date().getTime()),this.duration=i}return(0,Pt.Z)(e,[{key:"run",value:function(r){var n=new Date().getTime(),a=n-this.timestamp;this.timestamp=n,a>=this.duration&&r()}}]),e}(),Vc=U(2650);function al(e){return typeof e=="string"?!!Vc.ZP(e):!1}function Ji(e){var i=Vc.ZP(e),r=[0,0,0,0];return i!=null&&(r[0]=i.r/255,r[1]=i.g/255,r[2]=i.b/255,r[3]=i.opacity),r}function ol(e){var i=e&&e[0],r=e&&e[1],n=e&&e[2],a=i+r*256+n*65536-1;return a}function hu(e){return[e+1&255,e+1>>8&255,e+1>>8>>8&255]}function Ts(e){var i=kn.document.createElement("canvas"),r=i.getContext("2d");i.width=256,i.height=1;for(var n=r.createLinearGradient(0,0,256,1),a=null,s=e.positions[0],f=e.positions[e.positions.length-1],v=0;v<e.colors.length;++v){var g=(e.positions[v]-s)/(f-s);n.addColorStop(g,e.colors[v])}if(r.fillStyle=n,r.fillRect(0,0,256,1),ts)return a=new Uint8ClampedArray(r.getImageData(0,0,256,1).data),{data:a,width:256,height:1};a=r.getImageData(0,0,256,1).data;for(var x=r.createImageData(256,1),C=0;C<x.data.length;C+=4)x.data[C+0]=a[C+0],x.data[C+1]=a[C+1],x.data[C+2]=a[C+2],x.data[C+3]=a[C+3];return x}var zl;(function(e){e.CENTER="center",e.TOP="top",e["TOP-LEFT"]="top-left",e["TOP-RIGHT"]="top-right",e.BOTTOM="bottom",e["BOTTOM-LEFT"]="bottom-left",e.LEFT="left",e.RIGHT="right"})(zl||(zl={}));var _l={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function yf(e,i,r){var n=e.classList;for(var a in _l)_l.hasOwnProperty(a)&&n.remove("l7-".concat(r,"-anchor-").concat(a));n.add("l7-".concat(r,"-anchor-").concat(i))}function Pa(e,i){return{enable:e,mask:255,func:{cmp:514,ref:i?1:0,mask:255}}}var l={BACK:1029,FRONT:1028};function h(e){switch(e){case"GAODE1.x":return l.BACK;case"GAODE2.x":return l.BACK;case"MAPBOX":return l.FRONT;case"SIMPLE":return l.FRONT;case"GLOBEL":return l.BACK;case"L7MAP":return l.FRONT;default:return l.FRONT}}function c(e){return/(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(e)}function d(e,i){if(!e||!e.length)throw new Error("url is not allowed to be empty");var r=i.x,n=i.y,a=i.z;if(Array.isArray(e)){var s=Math.abs(r+n)%e.length;e=e[s]}return e.replace(/\{x\}/g,r.toString()).replace(/\{y\}/g,n.toString()).replace(/\{z\}/g,a.toString()).replace(/\{-y\}/g,(Math.pow(2,a)-n-1).toString())}var E;(function(e){e.Overlap="overlap",e.Replace="replace"})(E||(E={}));var w;(function(e){e.Loading="Loading",e.Loaded="Loaded",e.Failure="Failure",e.Cancelled="Cancelled"})(w||(w={}));var P=U(92137),L=U(87757),N=U.n(L);function q(e,i){i===void 0&&(i={});var r=Number(e[0]),n=Number(e[1]),a=Number(e[2]),s=Number(e[3]);if(e.length===6)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var f=[r,n],v=[r,s],g=[a,s],x=[a,n];return Oi([[f,x,g,v,f]],i.properties,{bbox:e,id:i.id})}var ce=0,he=1,de=2;function Re(e){e.forEach(function(i){i.properties.state=ce}),e.forEach(function(i){i.isCurrent&&!We(i)&&we(i)}),e.forEach(function(i){i.isVisible=Boolean(i.properties.state&de)})}function Ie(e){e.forEach(function(r){r.properties.state=ce}),e.forEach(function(r){r.isCurrent&&We(r)});var i=e.slice().sort(function(r,n){return r.z-n.z});i.forEach(function(r){r.isVisible=Boolean(r.properties.state&de),r.children.length&&(r.isVisible||r.properties.state&he)?r.children.forEach(function(n){n.properties.state=he}):r.isCurrent&&we(r)})}function We(e){for(;e;){if(e.isLoaded)return e.properties.state|=de,!0;e=e.parent}return!1}function we(e){e.children.forEach(function(i){i.isLoaded?i.properties.state|=de:we(i)})}var Ve,tt=256,yt=[-Infinity,-Infinity,Infinity,Infinity],Wt=5,jt=(Ve={},(0,A.Z)(Ve,E.Overlap,Re),(0,A.Z)(Ve,E.Replace,Ie),Ve),Jt=function(){};function dr(e,i,r){var n=Math.floor((e+180)/360*Math.pow(2,r)),a=Math.floor((1-Math.log(Math.tan(i*Math.PI/180)+1/Math.cos(i*Math.PI/180))/Math.PI)/2*Math.pow(2,r));return[n,a]}function Fr(e,i,r){var n=e/Math.pow(2,r)*360-180,a=Math.PI-2*Math.PI*i/Math.pow(2,r),s=180/Math.PI*Math.atan(.5*(Math.exp(a)-Math.exp(-a)));return[n,s]}var kr=function(i,r,n){var a=Fr(i,r,n),s=(0,on.Z)(a,2),f=s[0],v=s[1],g=Fr(i+1,r+1,n),x=(0,on.Z)(g,2),C=x[0],T=x[1];return[f,T,C,v]};function ln(e){var i=e.zoom,r=e.latLonBounds,n=e.maxZoom,a=n===void 0?Infinity:n,s=e.minZoom,f=s===void 0?0:s,v=e.zoomOffset,g=v===void 0?0:v,x=e.extent,C=x===void 0?yt:x,T=Math.ceil(i)+g;T<f?T=f:T>a&&(T=a);for(var O=(0,on.Z)(r,4),k=O[0],j=O[1],X=O[2],te=O[3],be=[Math.max(k,C[0]),Math.max(j,C[1]),Math.min(X,C[2]),Math.min(te,C[3])],Ne=[],$e=dr(be[0],be[1],T),ot=(0,on.Z)($e,2),bt=ot[0],_t=ot[1],qt=dr(be[2],be[3],T),ar=(0,on.Z)(qt,2),Pr=ar[0],qr=ar[1],gr=bt;gr<=Pr;gr++)for(var un=qr;un<=_t;un++)Ne.push({x:gr,y:un,z:T});return Ne}var Nn=function(i,r,n){var a=Math.pow(2,n),s=a-1,f=a,v=i,g=r;return v<0?v=v+f:v>s&&(v=v%f),{warpX:v,warpY:g}},zn=function(){function e(i){(0,ht.Z)(this,e),(0,A.Z)(this,"x",void 0),(0,A.Z)(this,"y",void 0),(0,A.Z)(this,"z",void 0),(0,A.Z)(this,"tileSize",256),(0,A.Z)(this,"isVisible",!1),(0,A.Z)(this,"isCurrent",!1),(0,A.Z)(this,"layer",null),(0,A.Z)(this,"layers",[]),(0,A.Z)(this,"parent",null),(0,A.Z)(this,"children",[]),(0,A.Z)(this,"data",null),(0,A.Z)(this,"properties",{}),(0,A.Z)(this,"loadStatus",void 0),(0,A.Z)(this,"abortController",void 0),(0,A.Z)(this,"loadDataId",0);var r=i.x,n=i.y,a=i.z,s=i.tileSize;this.x=r,this.y=n,this.z=a,this.tileSize=s}return(0,Pt.Z)(e,[{key:"isLoading",get:function(){return this.loadStatus===w.Loading}},{key:"isLoaded",get:function(){return this.loadStatus===w.Loaded}},{key:"isCancelled",get:function(){return this.loadStatus===w.Cancelled}},{key:"isDone",get:function(){return[w.Loaded,w.Cancelled,w.Failure].includes(this.loadStatus)}},{key:"bounds",get:function(){return kr(this.x,this.y,this.z)}},{key:"bboxPolygon",get:function(){var r=(0,on.Z)(this.bounds,4),n=r[0],a=r[1],s=r[2],f=r[3],v=[(s-n)/2,(f-a)/2],g=q(this.bounds,{properties:{key:this.key,bbox:this.bounds,center:v,meta:`
      `.concat(this.key,`
      `)}});return g}},{key:"key",get:function(){var r="".concat(this.x,",").concat(this.y,",").concat(this.z);return r}},{key:"loadData",value:function(){var i=(0,P.Z)(N().mark(function n(a){var s,f,v,g,x,C,T,O,k,j,X,te,be,Ne,$e,ot;return N().wrap(function(_t){for(;;)switch(_t.prev=_t.next){case 0:return s=a.getData,f=a.onLoad,v=a.onError,this.loadDataId++,g=this.loadDataId,this.isLoading&&this.abortLoad(),this.abortController=new AbortController,this.loadStatus=w.Loading,x=null,_t.prev=7,T=this.x,O=this.y,k=this.z,j=this.bounds,X=this.tileSize,te=Nn(T,O,k),be=te.warpX,Ne=te.warpY,$e=this.abortController.signal,ot={x:be,y:Ne,z:k,bounds:j,tileSize:X,signal:$e},_t.next=14,s(ot);case 14:x=_t.sent,_t.next=20;break;case 17:_t.prev=17,_t.t0=_t.catch(7),C=_t.t0;case 20:if(g===this.loadDataId){_t.next=22;break}return _t.abrupt("return");case 22:if(!(this.isCancelled&&!x)){_t.next=24;break}return _t.abrupt("return");case 24:if(!(C||!x)){_t.next=28;break}return this.loadStatus=w.Failure,v(C,this),_t.abrupt("return");case 28:this.loadStatus=w.Loaded,this.data=x,f(this);case 31:case"end":return _t.stop()}},n,this,[[7,17]])}));function r(n){return i.apply(this,arguments)}return r}()},{key:"reloadData",value:function(r){this.isLoading&&this.abortLoad(),this.loadData(r)}},{key:"abortLoad",value:function(){this.isLoaded||this.isCancelled||(this.loadStatus=w.Cancelled,this.abortController.abort())}}]),e}(),Mn=U(26729),Bi=U.n(Mn);function Qr(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=li(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function li(e,i){if(!!e){if(typeof e=="string")return fi(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return fi(e,i)}}function fi(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function ii(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Xn(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?ii(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ii(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function xi(e){var i=ri();return function(){var n=(0,Mt.Z)(e),a;if(i){var s=(0,Mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,wr.Z)(this,a)}}function ri(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Kn=function(e){(0,Ir.Z)(r,e);var i=xi(r);function r(n){var a;return(0,ht.Z)(this,r),a=i.call(this),(0,A.Z)((0,ne.Z)(a),"currentTiles",[]),(0,A.Z)((0,ne.Z)(a),"options",void 0),(0,A.Z)((0,ne.Z)(a),"cacheTiles",new Map),(0,A.Z)((0,ne.Z)(a),"lastViewStates",void 0),(0,A.Z)((0,ne.Z)(a),"onTileLoad",function(s){a.emit("tile-loaded",s),a.updateTileVisible()}),(0,A.Z)((0,ne.Z)(a),"onTileError",function(s,f){a.emit("tile-error",{error:s,tile:f}),a.updateTileVisible()}),(0,A.Z)((0,ne.Z)(a),"onTileUnload",function(s){a.emit("tile-unload",s)}),a.options={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0,extent:yt,getTileData:Jt,updateStrategy:E.Overlap},a.updateOptions(n),a}return(0,Pt.Z)(r,[{key:"isLoaded",get:function(){return this.currentTiles.every(function(a){return a.isDone})}},{key:"tiles",get:function(){var a=Array.from(this.cacheTiles.values()).sort(function(s,f){return s.z-f.z});return a}},{key:"updateOptions",value:function(a){var s=a.minZoom===void 0?this.options.minZoom:Math.ceil(a.minZoom),f=a.maxZoom===void 0?this.options.maxZoom:Math.floor(a.maxZoom);this.options=Xn(Xn(Xn({},this.options),a),{},{minZoom:s,maxZoom:f})}},{key:"update",value:function(a,s){var f=this;if(!(this.lastViewStates&&this.lastViewStates.zoom===a&&this.lastViewStates.latLonBounds.toString()===s.toString())){this.lastViewStates={zoom:a,latLonBounds:s};var v=!1,g=this.getTileIndices(a,s);this.currentTiles=g.map(function(x){var C=x.x,T=x.y,O=x.z,k=f.getTile(C,T,O);return k||(k=f.createTile(C,T,O),v=!0,k)}),v&&(this.resizeCacheTiles(),this.rebuildTileTree()),this.updateTileVisible()}}},{key:"reloadAll",value:function(){var a=Qr(this.cacheTiles),s;try{for(a.s();!(s=a.n()).done;){var f=(0,on.Z)(s.value,2),v=f[0],g=f[1];this.currentTiles.includes(g)||(this.cacheTiles.delete(v),this.onTileUnload(g)),this.onTileUnload(g),g.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError})}}catch(x){a.e(x)}finally{a.f()}}},{key:"destroy",value:function(){var a=Qr(this.cacheTiles.values()),s;try{for(a.s();!(s=a.n()).done;){var f=s.value;f.isLoading&&f.abortLoad()}}catch(v){a.e(v)}finally{a.f()}this.cacheTiles.clear(),this.currentTiles=[],this.removeAllListeners()}},{key:"updateTileVisible",value:function(){var a=this.options.updateStrategy,s=new Map,f=Qr(this.cacheTiles.values()),v;try{for(f.s();!(v=f.n()).done;){var g=v.value;s.set(g.key,g.isVisible),g.isCurrent=!1,g.isVisible=!1}}catch(j){f.e(j)}finally{f.f()}var x=Qr(this.currentTiles),C;try{for(x.s();!(C=x.n()).done;){var T=C.value;T.isCurrent=!0,T.isVisible=!0}}catch(j){x.e(j)}finally{x.f()}var O=Array.from(this.cacheTiles.values());typeof a=="function"?a(O):jt[a](O);var k=Array.from(this.cacheTiles.values()).some(function(j){return j.isVisible!==s.get(j.key)});k&&this.emit("tile-update")}},{key:"getTileIndices",value:function(a,s){var f=this.options,v=f.tileSize,g=f.extent,x=f.zoomOffset,C=Math.floor(this.options.maxZoom),T=Math.ceil(this.options.minZoom),O=ln({maxZoom:C,minZoom:T,zoomOffset:x,tileSize:v,zoom:a,latLonBounds:s,extent:g});return O}},{key:"getTileId",value:function(a,s,f){var v="".concat(a,",").concat(s,",").concat(f);return v}},{key:"getTile",value:function(a,s,f){var v=this.getTileId(a,s,f),g=this.cacheTiles.get(v);return g}},{key:"createTile",value:function(a,s,f){var v=this.getTileId(a,s,f),g=new zn({x:a,y:s,z:f,tileSize:this.options.tileSize});return this.cacheTiles.set(v,g),g.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}),g}},{key:"resizeCacheTiles",value:function(){var a=Wt*this.currentTiles.length,s=this.cacheTiles.size>a;if(s){var f=Qr(this.cacheTiles),v;try{for(f.s();!(v=f.n()).done;){var g=(0,on.Z)(v.value,2),x=g[0],C=g[1];if(!C.isVisible&&!this.currentTiles.includes(C)&&(this.cacheTiles.delete(x),this.onTileUnload(C)),this.cacheTiles.size<=a)break}}catch(T){f.e(T)}finally{f.f()}}}},{key:"rebuildTileTree",value:function(){var a=Qr(this.cacheTiles.values()),s;try{for(a.s();!(s=a.n()).done;){var f=s.value;f.parent=null,f.children.length=0}}catch(T){a.e(T)}finally{a.f()}var v=Qr(this.cacheTiles.values()),g;try{for(v.s();!(g=v.n()).done;){var x=g.value,C=this.getNearestAncestor(x.x,x.y,x.z);x.parent=C,C!=null&&C.children&&C.children.push(x)}}catch(T){v.e(T)}finally{v.f()}}},{key:"getNearestAncestor",value:function(a,s,f){for(;f>this.options.minZoom;){a=Math.floor(a/2),s=Math.floor(s/2),f=f-1;var v=this.getTile(a,s,f);if(v)return v}return null}}]),r}(Bi());function po(e,i){var r=i.extent,n=r===void 0?[121.168,30.2828,121.384,30.4219]:r,a=new Promise(function(f){e instanceof HTMLImageElement?f([e]):Ka(e,function(v){f(v)})}),s={originData:e,images:a,_id:1,dataArray:[{_id:0,coordinates:[[n[0],n[1]],[n[2],n[3]]]}]};return s}function Ka(e,i){var r=e,n=[];if(typeof r=="string")Gu({url:r},function(f,v){n.push(v),i(n)});else{var a=r.length,s=0;r.forEach(function(f){Gu({url:f},function(v,g){s++,n.push(g),s===a&&i(n)})})}return po}function Ho(e,i){var r=i.extent,n=i.width,a=i.height,s=i.min,f=i.max,v={_id:1,dataArray:[{_id:1,data:Array.from(e),width:n,height:a,min:s,max:f,coordinates:[[r[0],r[1]],[r[2],r[3]]]}]};return v}function Bo(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function za(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Bo(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Bo(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var co={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0},Bs=function(){var e=(0,P.Z)(N().mark(function i(r,n){var a;return N().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return a=d(r,n),f.abrupt("return",new Promise(function(v,g){Gu({url:a},function(x,C){x?g(x):v(C)})}));case 2:case"end":return f.stop()}},i)}));return function(r,n){return e.apply(this,arguments)}}();function _s(e,i){var r=function(s){return Bs(e,s)},n=za(za(za({},co),i),{},{getTileData:r});return{data:e,dataArray:[],tilesetOptions:n}}var Hu=U(30236),xs=U.n(Hu),pu=U(47037),vo=U.n(pu),mc=U(23560),ru=U.n(mc),Wu=U(50361),du=U.n(Wu),xl=U(34155);/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function vu(e,i,r,n){function a(s){return s instanceof r?s:new r(function(f){f(s)})}return new(r||(r=Promise))(function(s,f){function v(C){try{x(n.next(C))}catch(T){f(T)}}function g(C){try{x(n.throw(C))}catch(T){f(T)}}function x(C){C.done?s(C.value):a(C.value).then(v,g)}x((n=n.apply(e,i||[])).next())})}function Ul(e,i){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,a,s,f;return f={next:v(0),throw:v(1),return:v(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function v(x){return function(C){return g([x,C])}}function g(x){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(s=x[0]&2?a.return:x[0]?a.throw||((s=a.return)&&s.call(a),0):a.next)&&!(s=s.call(a,x[1])).done)return s;switch(a=0,s&&(x=[x[0]&2,s.value]),x[0]){case 0:case 1:s=x;break;case 4:return r.label++,{value:x[1],done:!1};case 5:r.label++,a=x[1],x=[0];continue;case 7:x=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(x[0]===6||x[0]===2)){r=0;continue}if(x[0]===3&&(!s||x[1]>s[0]&&x[1]<s[3])){r.label=x[1];break}if(x[0]===6&&r.label<s[1]){r.label=s[1],s=x;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(x);break}s[2]&&r.ops.pop(),r.trys.pop();continue}x=i.call(e,r)}catch(C){x=[6,C],a=0}finally{n=s=0}if(x[0]&5)throw x[1];return{value:x[0]?x[1]:void 0,done:!0}}}function Ou(e,i){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),a,s=[],f;try{for(;(i===void 0||i-- >0)&&!(a=n.next()).done;)s.push(a.value)}catch(v){f={error:v}}finally{try{a&&!a.done&&(r=n.return)&&r.call(n)}finally{if(f)throw f.error}}return s}function So(){for(var e=[],i=0;i<arguments.length;i++)e=e.concat(Ou(arguments[i]));return e}function ka(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function Ua(e,i){return i={exports:{}},e(i,i.exports),i.exports}var mu=Ua(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){return n&&typeof n.length=="number"&&n.length>=0&&n.length%1==0}e.exports=i.default});ka(mu);var ta=Ua(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(r){return function(){for(var n=[],a=arguments.length;a--;)n[a]=arguments[a];var s=n.pop();return r.call(this,n,s)}},e.exports=i.default});ka(ta);var is=Ua(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.fallback=a,i.wrap=s;var r=i.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,n=i.hasNextTick=typeof xl=="object"&&typeof xl.nextTick=="function";function a(v){setTimeout(v,0)}function s(v){return function(g){for(var x=[],C=arguments.length-1;C-- >0;)x[C]=arguments[C+1];return v(function(){return g.apply(void 0,x)})}}var f;r?f=setImmediate:n?f=xl.nextTick:f=a,i.default=s(f)});ka(is);var Ms=is.fallback,bl=is.wrap,_f=is.hasSetImmediate,xf=is.hasNextTick,Gc=Ua(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=s;var r=a(ta),n=a(is);function a(g){return g&&g.__esModule?g:{default:g}}function s(g){return(0,mo.isAsync)(g)?function(){for(var x=[],C=arguments.length;C--;)x[C]=arguments[C];var T=x.pop(),O=g.apply(this,x);return f(O,T)}:(0,r.default)(function(x,C){var T;try{T=g.apply(this,x)}catch(O){return C(O)}if(T&&typeof T.then=="function")return f(T,C);C(null,T)})}function f(g,x){return g.then(function(C){v(x,null,C)},function(C){v(x,C&&C.message?C:new Error(C))})}function v(g,x,C){try{g(x,C)}catch(T){(0,n.default)(function(O){throw O},T)}}e.exports=i.default});ka(Gc);var mo=Ua(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.isAsyncIterable=i.isAsyncGenerator=i.isAsync=void 0;var r=n(Gc);function n(g){return g&&g.__esModule?g:{default:g}}function a(g){return g[Symbol.toStringTag]==="AsyncFunction"}function s(g){return g[Symbol.toStringTag]==="AsyncGenerator"}function f(g){return typeof g[Symbol.asyncIterator]=="function"}function v(g){if(typeof g!="function")throw new Error("expected a function");return a(g)?(0,r.default)(g):g}i.default=v,i.isAsync=a,i.isAsyncGenerator=s,i.isAsyncIterable=f});ka(mo);var Hc=mo.isAsyncIterable,Ru=mo.isAsyncGenerator,Zl=mo.isAsync,Xu=Ua(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n,a){if(a===void 0&&(a=n.length),!a)throw new Error("arity is undefined");function s(){for(var f=this,v=[],g=arguments.length;g--;)v[g]=arguments[g];return typeof v[a-1]=="function"?n.apply(this,v):new Promise(function(x,C){v[a-1]=function(T){for(var O=[],k=arguments.length-1;k-- >0;)O[k]=arguments[k+1];if(T)return C(T);x(O.length>1?O:O[0])},n.apply(f,v)})}return Object.defineProperty(s,"name",{configurable:!0,value:"awaitable("+n.name+")"}),s}e.exports=i.default});ka(Xu);var nu=Ua(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=s(mu),n=s(mo),a=s(Xu);function s(f){return f&&f.__esModule?f:{default:f}}i.default=(0,a.default)(function(f,v,g){var x=(0,r.default)(v)?[]:{};f(v,function(C,T,O){(0,n.default)(C)(function(k){for(var j,X=[],te=arguments.length-1;te-- >0;)X[te]=arguments[te+1];X.length<2&&(j=X,X=j[0]),x[T]=X,O(k)})},function(C){return g(C,x)})},3),e.exports=i.default});ka(nu);var go=Ua(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){function a(){for(var s=[],f=arguments.length;f--;)s[f]=arguments[f];if(n!==null){var v=n;n=null,v.apply(this,s)}}return Object.assign(a,n),a}e.exports=i.default});ka(go);var gc=Ua(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(r){return r[Symbol.iterator]&&r[Symbol.iterator]()},e.exports=i.default});ka(gc);var bf=Ua(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=g;var r=a(mu),n=a(gc);function a(x){return x&&x.__esModule?x:{default:x}}function s(x){var C=-1,T=x.length;return function(){return++C<T?{value:x[C],key:C}:null}}function f(x){var C=-1;return function(){var O=x.next();return O.done?null:(C++,{value:O.value,key:C})}}function v(x){var C=x?Object.keys(x):[],T=-1,O=C.length;return function(){var j=C[++T];return T<O?{value:x[j],key:j}:null}}function g(x){if((0,r.default)(x))return s(x);var C=(0,n.default)(x);return C?f(C):v(x)}e.exports=i.default});ka(bf);var Wc=Ua(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){return function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];if(n===null)throw new Error("Callback was already called.");var f=n;n=null,f.apply(this,a)}}e.exports=i.default});ka(Wc);var yc=Ua(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r={};i.default=r,e.exports=i.default});ka(yc);var Sh=Ua(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=a;var r=n(yc);function n(s){return s&&s.__esModule?s:{default:s}}function a(s,f,v,g){var x=!1,C=!1,T=!1,O=0,k=0;function j(){O>=f||T||x||(T=!0,s.next().then(function(be){var Ne=be.value,$e=be.done;if(!(C||x)){if(T=!1,$e){x=!0,O<=0&&g(null);return}O++,v(Ne,k,X),k++,j()}}).catch(te))}function X(be,Ne){if(O-=1,!C){if(be)return te(be);if(be===!1){x=!0,C=!0;return}if(Ne===r.default||x&&O<=0)return x=!0,g(null);j()}}function te(be){C||(T=!1,x=!0,g(be))}j()}e.exports=i.default});ka(Sh);var Ch=Ua(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=v(go),n=v(bf),a=v(Wc),s=v(Sh),f=v(yc);function v(g){return g&&g.__esModule?g:{default:g}}i.default=function(g){return function(x,C,T){if(T=(0,r.default)(T),g<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!x)return T(null);if((0,mo.isAsyncGenerator)(x))return(0,s.default)(x,g,C,T);if((0,mo.isAsyncIterable)(x))return(0,s.default)(x[Symbol.asyncIterator](),g,C,T);var O=(0,n.default)(x),k=!1,j=!1,X=0,te=!1;function be($e,ot){if(!j)if(X-=1,$e)k=!0,T($e);else if($e===!1)k=!0,j=!0;else{if(ot===f.default||k&&X<=0)return k=!0,T(null);te||Ne()}}function Ne(){for(te=!0;X<g&&!k;){var $e=O();if($e===null){k=!0,X<=0&&T(null);return}X+=1,C($e.value,$e.key,(0,a.default)(be))}te=!1}Ne()}},e.exports=i.default});ka(Ch);var El=Ua(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=s(Ch),n=s(mo),a=s(Xu);function s(v){return v&&v.__esModule?v:{default:v}}function f(v,g,x,C){return(0,r.default)(g)(v,(0,n.default)(x),C)}i.default=(0,a.default)(f,4),e.exports=i.default});ka(El);var Xc=Ua(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=a(El),n=a(Xu);function a(f){return f&&f.__esModule?f:{default:f}}function s(f,v,g){return(0,r.default)(f,1,v,g)}i.default=(0,n.default)(s,3),e.exports=i.default});ka(Xc);var Ah=Ua(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=s;var r=a(nu),n=a(Xc);function a(f){return f&&f.__esModule?f:{default:f}}function s(f,v){return(0,r.default)(n.default,f,v)}e.exports=i.default}),np=ka(Ah),Ps=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.args=[],this.tasks=[]}return e.prototype.call=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return this.args=r,np(this.tasks)},e.prototype.tap=function(i,r){var n=this;this.tasks.push(function(a){r.apply(void 0,So(n.args)),a(null,i)})},e}(),Yc=Ua(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=x(mu),n=x(yc),a=x(El),s=x(go),f=x(Wc),v=x(mo),g=x(Xu);function x(k){return k&&k.__esModule?k:{default:k}}function C(k,j,X){X=(0,s.default)(X);var te=0,be=0,Ne=k.length,$e=!1;Ne===0&&X(null);function ot(bt,_t){bt===!1&&($e=!0),$e!==!0&&(bt?X(bt):(++be===Ne||_t===n.default)&&X(null))}for(;te<Ne;te++)j(k[te],te,(0,f.default)(ot))}function T(k,j,X){return(0,a.default)(k,Infinity,j,X)}function O(k,j,X){var te=(0,r.default)(k)?C:T;return te(k,(0,v.default)(j),X)}i.default=(0,g.default)(O,3),e.exports=i.default});ka(Yc);var zp=Ua(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=s;var r=a(Yc),n=a(nu);function a(f){return f&&f.__esModule?f:{default:f}}function s(f,v){return(0,n.default)(r.default,f,v)}e.exports=i.default}),Td=ka(zp),Ef=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.tasks=[]}return e.prototype.promise=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return Td(this.tasks)},e.prototype.tapPromise=function(i,r){var n=this;this.tasks.push(function(a){return vu(n,void 0,void 0,function(){return Ul(this,function(s){switch(s.label){case 0:return[4,r()];case 1:return s.sent(),a(null,i),[2]}})})})},e}(),ip=Ua(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=f(go),n=f(Wc),a=f(mo),s=f(Xu);function f(g){return g&&g.__esModule?g:{default:g}}function v(g,x){if(x=(0,r.default)(x),!Array.isArray(g))return x(new Error("First argument to waterfall must be an array of functions"));if(!g.length)return x();var C=0;function T(k){var j=(0,a.default)(g[C++]);j.apply(void 0,k.concat([(0,n.default)(O)]))}function O(k){for(var j=[],X=arguments.length-1;X-- >0;)j[X]=arguments[X+1];if(k!==!1){if(k||C===g.length)return x.apply(void 0,[k].concat(j));T(j)}}T([])}i.default=(0,s.default)(v),e.exports=i.default}),Md=ka(ip),Pd=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.tasks=[]}return e.prototype.call=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return Md(this.tasks)},e.prototype.tap=function(i,r){this.tasks.length===0?this.tasks.push(function(n){var a=r();n(a?null:!1,a)}):this.tasks.push(function(n,a){var s=r();a(s?null:!1,i)})},e}(),wh=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.tasks=[]}return e.prototype.call=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return np(this.tasks)},e.prototype.tap=function(i,r){this.tasks.push(function(n){var a=r();n(a,i)})},e}(),ap=U(69848),Up=U.n(ap);function qc(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Zp(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?qc(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):qc(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Co(e,i){var r=i.radius,n=r===void 0?40:r,a=i.maxZoom,s=a===void 0?18:a,f=i.minZoom,v=f===void 0?0:f,g=i.zoom,x=g===void 0?2:g;if(e.pointIndex){var C=e.pointIndex.getClusters(e.extent,Math.floor(x));return e.dataArray=Th(C),e}var T=new(Up())({radius:n,minZoom:v,maxZoom:s}),O={type:"FeatureCollection",features:[]};return O.features=e.dataArray.map(function(k){return{type:"Feature",geometry:{type:"Point",coordinates:k.coordinates},properties:Zp({},k)}}),T.load(O.features),T}function Th(e){return e.map(function(i,r){return Zp({coordinates:i.geometry.coordinates,_id:r+1},i.properties)})}function jp(e){if(e.length===0)throw new Error("max requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]>i&&(i=e[r]);return i}function Mh(e){if(e.length===0)throw new Error("min requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]<i&&(i=e[r]);return i}function Xf(e){if(e.length===0)return 0;for(var i=e[0],r=0,n,a=1;a<e.length;a++)n=i+e[a]*1,Math.abs(i)>=Math.abs(e[a])?r+=i-n+e[a]:r+=e[a]-n+i,i=n;return i+r*1}function Yf(e){if(e.length===0)throw new Error("mean requires at least one data point");return Xf(e)/e.length}var Ph={min:Mh,max:jp,mean:Yf,sum:Xf};function qf(e,i){return e.map(function(r){return r[i]*1})}function jl(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Sl(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?jl(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):jl(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Kf(e){var i=Ih();return function(){var n=(0,Mt.Z)(e),a;if(i){var s=(0,Mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,wr.Z)(this,a)}}function Ih(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function _c(e,i){if(Array.isArray(i))return i}var Oh=function(e){(0,Ir.Z)(r,e);var i=Kf(r);function r(n,a){var s;return(0,ht.Z)(this,r),s=i.call(this),(0,A.Z)((0,ne.Z)(s),"data",void 0),(0,A.Z)((0,ne.Z)(s),"center",void 0),(0,A.Z)((0,ne.Z)(s),"extent",void 0),(0,A.Z)((0,ne.Z)(s),"hooks",{init:new Ps}),(0,A.Z)((0,ne.Z)(s),"parser",{type:"geojson"}),(0,A.Z)((0,ne.Z)(s),"transforms",[]),(0,A.Z)((0,ne.Z)(s),"cluster",!1),(0,A.Z)((0,ne.Z)(s),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),(0,A.Z)((0,ne.Z)(s),"tileset",void 0),(0,A.Z)((0,ne.Z)(s),"mapService",void 0),(0,A.Z)((0,ne.Z)(s),"invalidExtent",!1),(0,A.Z)((0,ne.Z)(s),"dataArrayChanged",!1),(0,A.Z)((0,ne.Z)(s),"originData",void 0),(0,A.Z)((0,ne.Z)(s),"rawData",void 0),(0,A.Z)((0,ne.Z)(s),"cfg",{}),(0,A.Z)((0,ne.Z)(s),"clusterIndex",void 0),s.originData=n,s.initCfg(a),s.hooks.init.tap("parser",function(){s.excuteParser()}),s.hooks.init.tap("cluster",function(){s.initCluster()}),s.hooks.init.tap("transform",function(){s.executeTrans()}),s.init(),s}return(0,Pt.Z)(r,[{key:"getClusters",value:function(a){return this.clusterIndex.getClusters(this.caculClusterExtent(2),a)}},{key:"getClustersLeaves",value:function(a){return this.clusterIndex.getLeaves(a,Infinity)}},{key:"updateClusterData",value:function(a){var s=this,f=this.clusterOptions,v=f.method,g=v===void 0?"sum":v,x=f.field,C=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(a));this.clusterOptions.zoom=a,C.forEach(function(T){T.id||(T.properties.point_count=1)}),(x||ru()(g))&&(C=C.map(function(T){var O=T.id;if(O){var k=s.clusterIndex.getLeaves(O,Infinity),j=k.map(function(be){return be.properties}),X;if(vo()(g)&&x){var te=qf(j,x);X=Ph[g](te)}ru()(g)&&(X=g(j)),T.properties.stat=X}else T.properties.point_count=1;return T})),this.data=fe("geojson")({type:"FeatureCollection",features:C}),this.executeTrans()}},{key:"getFeatureById",value:function(a){var s=this.parser.type,f=s===void 0?"geojson":s;if(f==="geojson"&&!this.cluster){var v=a<this.originData.features.length?this.originData.features[a]:"null",g=du()(v);if(this.transforms.length!==0||this.dataArrayChanged){var x=this.data.dataArray.find(function(C){return C._id===a});g.properties=x}return g}else return a<this.data.dataArray.length?this.data.dataArray[a]:"null"}},{key:"updateFeaturePropertiesById",value:function(a,s){this.data.dataArray=this.data.dataArray.map(function(f){return f._id===a?Sl(Sl({},f),s):f}),this.dataArrayChanged=!0,this.emit("update")}},{key:"getFeatureId",value:function(a,s){var f=this.data.dataArray.find(function(v){return v[a]===s});return f==null?void 0:f._id}},{key:"setData",value:function(a,s){this.originData=a,this.dataArrayChanged=!1,this.initCfg(s),this.init(),this.emit("update")}},{key:"destroy",value:function(){var a;this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null,(a=this.tileset)===null||a===void 0||a.destroy()}},{key:"initCfg",value:function(a){this.cfg=xs()(this.cfg,a,_c);var s=this.cfg;s&&(s.parser&&(this.parser=s.parser),s.transforms&&(this.transforms=s.transforms),this.cluster=s.cluster||!1,s.clusterOptions&&(this.cluster=!0,this.clusterOptions=Sl(Sl({},this.clusterOptions),s.clusterOptions)))}},{key:"init",value:function(){this.hooks.init.call(this)}},{key:"excuteParser",value:function(){var a=this.parser,s=a.type||"geojson",f=fe(s);this.data=f(this.originData,a),this.extent=Xs(this.data.dataArray),this.setCenter(this.extent),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3],this.tileset=this.initTileset()}},{key:"setCenter",value:function(a){this.center=[(a[0]+a[2])/2,(a[1]+a[3])/2],(isNaN(this.center[0])||isNaN(this.center[1]))&&(this.center=[108.92361111111111,34.54083333333333])}},{key:"initTileset",value:function(){var a=this.data.tilesetOptions;if(!!a){if(this.tileset)return this.tileset.updateOptions(a),this.tileset;var s=new Kn(Sl({},a));return s}}},{key:"executeTrans",value:function(){var a=this,s=this.transforms;s.forEach(function(f){var v=f.type,g=J(v)(a.data,f);Object.assign(a.data,g)})}},{key:"initCluster",value:function(){if(!!this.cluster){var a=this.clusterOptions||{};this.clusterIndex=Co(this.data,a)}}},{key:"caculClusterExtent",value:function(a){var s=[[-Infinity,-Infinity],[Infinity,Infinity]];return this.invalidExtent||(s=dc(Pu(this.extent),a)),s[0].concat(s[1])}}]),r}(Mn.EventEmitter);function $f(e,i){var r=i.callback;return r&&(e.dataArray=e.dataArray.filter(r)),e}function Qf(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Sf(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function Sf(e,i){if(!!e){if(typeof e=="string")return Kc(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Kc(e,i)}}function Kc(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var Ns=6378e3;function Jf(e,i){var r=e.dataArray,n=i.size,a=n===void 0?10:n,s=a/(2*Math.PI*Ns)*(256<<20)/2,f=eh(r,a),v=f.gridHash,g=f.gridOffset,x=Cl(v,g,i);return{yOffset:s,xOffset:s,radius:s,type:"grid",dataArray:x}}function eh(e,i){var r=Infinity,n=-Infinity,a,s=Qf(e),f;try{for(s.s();!(f=s.n()).done;){var v=f.value;a=v.coordinates[1],Number.isFinite(a)&&(r=a<r?a:r,n=a>n?a:n)}}catch($e){s.e($e)}finally{s.f()}var g=(r+n)/2,x=th(i,g);if(x.xOffset<=0||x.yOffset<=0)return{gridHash:{},gridOffset:x};var C={},T=Qf(e),O;try{for(T.s();!(O=T.n()).done;){var k=O.value,j=k.coordinates[1],X=k.coordinates[0];if(Number.isFinite(j)&&Number.isFinite(X)){var te=Math.floor((j+90)/x.yOffset),be=Math.floor((X+180)/x.xOffset),Ne="".concat(te,"-").concat(be);C[Ne]=C[Ne]||{count:0,points:[]},C[Ne].count+=1,C[Ne].points.push(k)}}}catch($e){T.e($e)}finally{T.f()}return{gridHash:C,gridOffset:x}}function th(e,i){var r=rh(e),n=Rh(i,e);return{yOffset:r,xOffset:n}}function rh(e){return e/Ns*(180/Math.PI)}function Rh(e,i){return i/Ns*(180/Math.PI)/Math.cos(e*Math.PI/180)}function Cl(e,i,r){return Object.keys(e).reduce(function(n,a,s){var f=a.split("-"),v=parseInt(f[0],10),g=parseInt(f[1],10),x={};if(r.field&&r.method){var C=ms(e[a].points,r.field);x[r.method]=Ea[r.method](C)}return Object.assign(x,{_id:s,coordinates:Go([-180+i.xOffset*(g+.5),-90+i.yOffset*(v+.5)]),rawData:e[a].points,count:e[a].count}),n.push(x),n},[])}var Yu=Math.PI/3,Vp=[0,Yu,2*Yu,3*Yu,4*Yu,5*Yu];function Lh(e){return e[0]}function Gp(e){return e[1]}function Id(){var e=0,i=0,r=1,n=1,a=Lh,s=Gp,f,v,g;function x(T){var O={},k=[],j,X=T.length;for(j=0;j<X;++j)if(!(isNaN(be=+a.call(null,te=T[j],j,T))||isNaN(Ne=+s.call(null,te,j,T)))){var te,be,Ne,$e=Math.round(Ne=Ne/g),ot=Math.round(be=be/v-($e&1)/2),bt=Ne-$e;if(Math.abs(bt)*3>1){var _t=be-ot,qt=ot+(be<ot?-1:1)/2,ar=$e+(Ne<$e?-1:1),Pr=be-qt,qr=Ne-ar;_t*_t+bt*bt>Pr*Pr+qr*qr&&(ot=qt+($e&1?1:-1)/2,$e=ar)}var gr=ot+"-"+$e,un=O[gr];un?un.push(te):(k.push(un=O[gr]=[te]),un.x=(ot+($e&1)/2)*v,un.y=$e*g)}return k}function C(T){var O=0,k=0;return Vp.map(function(j){var X=Math.sin(j)*T,te=-Math.cos(j)*T,be=X-O,Ne=te-k;return O=X,k=te,[be,Ne]})}return x.hexagon=function(T){return"m"+C(T==null?f:+T).join("l")+"z"},x.centers=function(){for(var T=[],O=Math.round(i/g),k=Math.round(e/v),j=O*g;j<n+f;j+=g,++O)for(var X=k*v+(O&1)*v/2;X<r+v/2;X+=v)T.push([X,j]);return T},x.mesh=function(){var T=C(f).slice(0,4).join("l");return x.centers().map(function(O){return"M"+O+"m"+T}).join("")},x.x=function(T){return arguments.length?(a=T,x):a},x.y=function(T){return arguments.length?(s=T,x):s},x.radius=function(T){return arguments.length?(f=+T,v=f*2*Math.sin(Yu),g=f*1.5,x):f},x.size=function(T){return arguments.length?(e=i=0,r=+T[0],n=+T[1],x):[r-e,n-i]},x.extent=function(T){return arguments.length?(e=+T[0][0],i=+T[0][1],r=+T[1][0],n=+T[1][1],x):[[e,i],[r,n]]},x.radius(1)}function Hp(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function gu(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Hp(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Hp(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Wp=6378e3;function kh(e,i){var r=e.dataArray,n=i.size,a=n===void 0?10:n,s=i.method,f=s===void 0?"sum":s,v=a/(2*Math.PI*Wp)*(256<<20)/2,g=r.map(function(O){var k=Go(O.coordinates),j=(0,on.Z)(k,2),X=j[0],te=j[1];return gu(gu({},O),{},{coordinates:[X,te]})}),x=Id().radius(v).x(function(O){return O.coordinates[0]}).y(function(O){return O.coordinates[1]}),C=x(g),T={dataArray:C.map(function(O,k){var j;if(i.field&&f){var X=ms(O,i.field);O[f]=Ea[f](X)}return j={},(0,A.Z)(j,i.method,O[f]),(0,A.Z)(j,"count",O.length),(0,A.Z)(j,"rawData",O),(0,A.Z)(j,"coordinates",[O.x,O.y]),(0,A.Z)(j,"_id",k),j}),radius:v,xOffset:v,yOffset:v,type:"hexagon"};return T}function $c(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function qu(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?$c(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$c(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Xp(e,i){var r=i.sourceField,n=i.targetField,a=i.data,s={};return a.forEach(function(f){s[f[r]]=f}),e.dataArray=e.dataArray.map(function(f){var v=f[n];return qu(qu({},f),s[v])}),e}function Od(e,i){var r=i.callback;return r&&(e.dataArray=e.dataArray.map(r)),e}Le("rasterTile",_s),Le("geojson",Yr),Le("image",po),Le("csv",vn),Le("json",Kt),Le("raster",Ho),Xe("cluster",Co),Xe("filter",$f),Xe("join",Xp),Xe("map",Od),Xe("grid",Jf),Xe("hexagon",kh);var Al=Cr,Cf=ei,Vl=Oh,Qc=U(28660),Wr=U(86700),op=U(84879),Ht={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")},sp=U(31745),va=U.n(sp);function Gl(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Ao(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Gl(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Gl(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Ys(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Yp(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function Yp(e,i){if(!!e){if(typeof e=="string")return up(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return up(e,i)}}function up(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var nh=30;function Rd(e){var i=e.characterSet,r=e.getFontWidth,n=e.fontHeight,a=e.buffer,s=e.maxCanvasWidth,f=e.mapping,v=f===void 0?{}:f,g=e.xOffset,x=g===void 0?0:g,C=e.yOffset,T=C===void 0?0:C,O=0,k=x;Array.from(i).forEach(function(X,te){if(!v[X]){var be=r(X,te);k+nh>s&&(k=0,O++),v[X]={x:k,y:T+O*nh,width:nh,height:nh,advance:be},k+=nh}});var j=n+a*2;return{mapping:v,xOffset:k,yOffset:T+O*j,canvasHeight:qp(T+(O+1)*j)}}function Ld(e,i,r){var n=0,a=0,s=0,f=[],v={},g=Ys(e),x;try{for(g.s();!(x=g.n()).done;){var C=x.value;if(!v[C.id]){var T=C.size;n+T+i>r&&(Dh(v,f,a),n=0,a=s+a+i,s=0,f=[]),f.push({icon:C,xOffset:n}),n=n+T+i,s=Math.max(s,T)}}}catch(k){g.e(k)}finally{g.f()}f.length>0&&Dh(v,f,a);var O=qp(s+a+i);return{mapping:v,canvasHeight:O}}function Dh(e,i,r){var n=Ys(i),a;try{for(n.s();!(a=n.n()).done;){var s=a.value,f=s.icon,v=s.xOffset;e[f.id]=Ao(Ao({},f),{},{x:v,y:r,image:f.image,width:f.width,height:f.height})}}catch(g){n.e(g)}finally{n.f()}}function qp(e){return Math.pow(2,Math.ceil(Math.log2(e)))}var Kp,Af;function lp(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=$p(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function $p(e,i){if(!!e){if(typeof e=="string")return wf(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return wf(e,i)}}function wf(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function Sa(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function ih(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Sa(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Sa(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Hl=mr(),Tf="sans-serif",cp="normal",kd=24,B=3,ge=.25,Be=8,Dt=1024,sr=1,kt=1,er=3,hr=null;function mr(){for(var e=[],i=32;i<128;i++)e.push(String.fromCharCode(i));return e}function xr(e,i,r,n){e.font="".concat(n," ").concat(r,"px ").concat(i),e.fillStyle="black",e.textBaseline="middle"}function Tr(e,i){for(var r=0;r<e.length;r++)i.data[4*r+3]=e[r]}var Rr=(Kp=(0,Wr.b2)(),Kp(Af=function(){function e(){(0,ht.Z)(this,e),(0,A.Z)(this,"fontAtlas",void 0),(0,A.Z)(this,"iconFontMap",void 0),(0,A.Z)(this,"iconFontGlyphs",{}),(0,A.Z)(this,"fontOptions",void 0),(0,A.Z)(this,"key",void 0),(0,A.Z)(this,"cache",new gf(er))}return(0,Pt.Z)(e,[{key:"scale",get:function(){return kt}},{key:"canvas",get:function(){var r=this.cache.get(this.key);return r&&r.data}},{key:"mapping",get:function(){var r=this.cache.get(this.key);return r&&r.mapping}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:Tf,fontWeight:cp,characterSet:Hl,fontSize:kd,buffer:B,sdf:!0,cutoff:ge,radius:Be,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(r){var n=this;r.forEach(function(a){n.iconFontGlyphs[a.name]=a.unicode})}},{key:"addIconFont",value:function(r,n){this.iconFontMap.set(r,n)}},{key:"getIconFontKey",value:function(r){return this.iconFontMap.get(r)||r}},{key:"getGlyph",value:function(r){return this.iconFontGlyphs[r]?String.fromCharCode(parseInt(this.iconFontGlyphs[r],16)):""}},{key:"setFontOptions",value:function(r){this.fontOptions=ih(ih({},this.fontOptions),r),this.key=this.getKey();var n=this.getNewChars(this.key,this.fontOptions.characterSet),a=this.cache.get(this.key);if(!(a&&n.length===0)){var s=this.generateFontAtlas(this.key,n,a);this.fontAtlas=s,this.cache.set(this.key,s)}}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(r,n,a){var s=this.fontOptions,f=s.fontFamily,v=s.fontWeight,g=s.fontSize,x=s.buffer,C=s.sdf,T=s.radius,O=s.cutoff,k=s.iconfont,j=a&&a.data;j||(j=kn.document.createElement("canvas"),j.width=Dt);var X=j.getContext("2d");xr(X,f,g,v);var te=Rd(ih({getFontWidth:function(Ls){return X.measureText(Ls).width},fontHeight:g*kt,buffer:x,characterSet:n,maxCanvasWidth:Dt},a&&{mapping:a.mapping,xOffset:a.xOffset,yOffset:a.yOffset})),be=te.mapping,Ne=te.canvasHeight,$e=te.xOffset,ot=te.yOffset,bt=X.getImageData(0,0,j.width,j.height);if(j.height=Ne,X.putImageData(bt,0,0),xr(X,f,g,v),C){var _t=new(va())(g,x,T,O,f,v),qt=X.getImageData(0,0,_t.size,_t.size),ar=lp(n),Pr;try{for(ar.s();!(Pr=ar.n()).done;){var qr=Pr.value;if(k){var gr=String.fromCharCode(parseInt(qr.replace("&#x","").replace(";",""),16)),un=_t.draw(gr);Tr(un,qt)}else Tr(_t.draw(qr),qt);X.putImageData(qt,be[qr].x,be[qr].y)}}catch(Ro){ar.e(Ro)}finally{ar.f()}}else{var Ln=lp(n),Vn;try{for(Ln.s();!(Vn=Ln.n()).done;){var Fa=Vn.value;X.fillText(Fa,be[Fa].x,be[Fa].y+g*sr)}}catch(Ro){Ln.e(Ro)}finally{Ln.f()}}return{xOffset:$e,yOffset:ot,mapping:be,data:j,width:j.width,height:j.height}}},{key:"getKey",value:function(){return"key";var r,n,a,s,f,v,g,x}},{key:"getNewChars",value:function(r,n){var a=this.cache.get(r);if(!a)return n;var s=[],f=a.mapping,v=new Set(Object.keys(f)),g=new Set(n);return g.forEach(function(x){v.has(x)||s.push(x)}),s}}]),e}())||Af),Gr,_r;function Mr(e){var i=ut();return function(){var n=(0,Mt.Z)(e),a;if(i){var s=(0,Mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,wr.Z)(this,a)}}function ut(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Gt=3,br=1024,Br=64,cr=(Gr=(0,Wr.b2)(),Gr(_r=function(e){(0,Ir.Z)(r,e);var i=Mr(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ne.Z)(n),"canvasHeight",128),(0,A.Z)((0,ne.Z)(n),"texture",void 0),(0,A.Z)((0,ne.Z)(n),"canvas",void 0),(0,A.Z)((0,ne.Z)(n),"iconData",void 0),(0,A.Z)((0,ne.Z)(n),"iconMap",void 0),(0,A.Z)((0,ne.Z)(n),"ctx",void 0),(0,A.Z)((0,ne.Z)(n),"loadingImageCount",0),n}return(0,Pt.Z)(r,[{key:"isLoading",value:function(){return this.loadingImageCount===0}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=kn.document.createElement("canvas"),this.canvas.width=128,this.canvas.height=128,this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(a,s){var f=this,v=new Image;if(this.loadingImageCount++,this.hasImage(a))throw new Error("Image Id already exists");this.iconData.push({id:a,size:Br}),this.updateIconMap(),this.loadImage(s).then(function(g){v=g;var x=f.iconData.find(function(C){return C.id===a});x&&(x.image=v,x.width=v.width,x.height=v.height),f.update()})}},{key:"addImageMini",value:function(a,s,f){var v=this,g=f.getSceneConfig().canvas,x=g.createImage();if(this.loadingImageCount++,this.hasImage(a))throw new Error("Image Id already exists");this.iconData.push({id:a,size:Br}),this.updateIconMap(),this.loadImageMini(s,g).then(function(C){x=C;var T=v.iconData.find(function(O){return O.id===a});T&&(T.image=x,T.width=x.width,T.height=x.height),v.update()})}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(a){return this.iconMap.hasOwnProperty(a)}},{key:"removeImage",value:function(a){this.hasImage(a)&&(this.iconData=this.iconData.filter(function(s){return s.id!==a}),delete this.iconMap[a],this.update())}},{key:"destroy",value:function(){this.removeAllListeners("imageUpdate"),this.iconData=[],this.iconMap={}}},{key:"loadImage",value:function(a){return new Promise(function(s,f){if(a instanceof HTMLImageElement){s(a);return}var v=new Image;v.crossOrigin="anonymous",v.onload=function(){s(v)},v.onerror=function(){f(new Error("Could not load image at "+a))},v.src=a instanceof File?URL.createObjectURL(a):a})}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var a=this;this.canvas.width=br,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(function(s){var f=a.iconMap[s],v=f.x,g=f.y,x=f.image,C=f.width,T=C===void 0?64:C,O=f.height,k=O===void 0?64:O,j=Math.max(T,k),X=j/Br,te=k/X,be=T/X;x&&a.ctx.drawImage(x,v+(Br-be)/2,g+(Br-te)/2,be,te)})}},{key:"updateIconMap",value:function(){var a=Ld(this.iconData,Gt,br),s=a.mapping,f=a.canvasHeight;this.iconMap=s,this.canvasHeight=f}},{key:"loadImageMini",value:function(a,s){return new Promise(function(f,v){var g=s.createImage();g.crossOrigin="anonymous",g.onload=function(){f(g)},g.onerror=function(){v(new Error("Could not load image at "+a))},g.src=a})}}]),r}(Mn.EventEmitter))||_r),or=U(49685);function zr(){var e=new or.WT(16);return or.WT!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function Un(e){var i=new or.WT(16);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i}function tr(e,i){return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e}function ir(e,i,r,n,a,s,f,v,g,x,C,T,O,k,j,X){var te=new or.WT(16);return te[0]=e,te[1]=i,te[2]=r,te[3]=n,te[4]=a,te[5]=s,te[6]=f,te[7]=v,te[8]=g,te[9]=x,te[10]=C,te[11]=T,te[12]=O,te[13]=k,te[14]=j,te[15]=X,te}function Sn(e,i,r,n,a,s,f,v,g,x,C,T,O,k,j,X,te){return e[0]=i,e[1]=r,e[2]=n,e[3]=a,e[4]=s,e[5]=f,e[6]=v,e[7]=g,e[8]=x,e[9]=C,e[10]=T,e[11]=O,e[12]=k,e[13]=j,e[14]=X,e[15]=te,e}function Xr(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Sr(e,i){if(e===i){var r=i[1],n=i[2],a=i[3],s=i[6],f=i[7],v=i[11];e[1]=i[4],e[2]=i[8],e[3]=i[12],e[4]=r,e[6]=i[9],e[7]=i[13],e[8]=n,e[9]=s,e[11]=i[14],e[12]=a,e[13]=f,e[14]=v}else e[0]=i[0],e[1]=i[4],e[2]=i[8],e[3]=i[12],e[4]=i[1],e[5]=i[5],e[6]=i[9],e[7]=i[13],e[8]=i[2],e[9]=i[6],e[10]=i[10],e[11]=i[14],e[12]=i[3],e[13]=i[7],e[14]=i[11],e[15]=i[15];return e}function Hr(e,i){var r=i[0],n=i[1],a=i[2],s=i[3],f=i[4],v=i[5],g=i[6],x=i[7],C=i[8],T=i[9],O=i[10],k=i[11],j=i[12],X=i[13],te=i[14],be=i[15],Ne=r*v-n*f,$e=r*g-a*f,ot=r*x-s*f,bt=n*g-a*v,_t=n*x-s*v,qt=a*x-s*g,ar=C*X-T*j,Pr=C*te-O*j,qr=C*be-k*j,gr=T*te-O*X,un=T*be-k*X,Ln=O*be-k*te,Vn=Ne*Ln-$e*un+ot*gr+bt*qr-_t*Pr+qt*ar;return Vn?(Vn=1/Vn,e[0]=(v*Ln-g*un+x*gr)*Vn,e[1]=(a*un-n*Ln-s*gr)*Vn,e[2]=(X*qt-te*_t+be*bt)*Vn,e[3]=(O*_t-T*qt-k*bt)*Vn,e[4]=(g*qr-f*Ln-x*Pr)*Vn,e[5]=(r*Ln-a*qr+s*Pr)*Vn,e[6]=(te*ot-j*qt-be*$e)*Vn,e[7]=(C*qt-O*ot+k*$e)*Vn,e[8]=(f*un-v*qr+x*ar)*Vn,e[9]=(n*qr-r*un-s*ar)*Vn,e[10]=(j*_t-X*ot+be*Ne)*Vn,e[11]=(T*ot-C*_t-k*Ne)*Vn,e[12]=(v*Pr-f*gr-g*ar)*Vn,e[13]=(r*gr-n*Pr+a*ar)*Vn,e[14]=(X*$e-j*bt-te*Ne)*Vn,e[15]=(C*bt-T*$e+O*Ne)*Vn,e):null}function Jr(e,i){var r=i[0],n=i[1],a=i[2],s=i[3],f=i[4],v=i[5],g=i[6],x=i[7],C=i[8],T=i[9],O=i[10],k=i[11],j=i[12],X=i[13],te=i[14],be=i[15];return e[0]=v*(O*be-k*te)-T*(g*be-x*te)+X*(g*k-x*O),e[1]=-(n*(O*be-k*te)-T*(a*be-s*te)+X*(a*k-s*O)),e[2]=n*(g*be-x*te)-v*(a*be-s*te)+X*(a*x-s*g),e[3]=-(n*(g*k-x*O)-v*(a*k-s*O)+T*(a*x-s*g)),e[4]=-(f*(O*be-k*te)-C*(g*be-x*te)+j*(g*k-x*O)),e[5]=r*(O*be-k*te)-C*(a*be-s*te)+j*(a*k-s*O),e[6]=-(r*(g*be-x*te)-f*(a*be-s*te)+j*(a*x-s*g)),e[7]=r*(g*k-x*O)-f*(a*k-s*O)+C*(a*x-s*g),e[8]=f*(T*be-k*X)-C*(v*be-x*X)+j*(v*k-x*T),e[9]=-(r*(T*be-k*X)-C*(n*be-s*X)+j*(n*k-s*T)),e[10]=r*(v*be-x*X)-f*(n*be-s*X)+j*(n*x-s*v),e[11]=-(r*(v*k-x*T)-f*(n*k-s*T)+C*(n*x-s*v)),e[12]=-(f*(T*te-O*X)-C*(v*te-g*X)+j*(v*O-g*T)),e[13]=r*(T*te-O*X)-C*(n*te-a*X)+j*(n*O-a*T),e[14]=-(r*(v*te-g*X)-f*(n*te-a*X)+j*(n*g-a*v)),e[15]=r*(v*O-g*T)-f*(n*O-a*T)+C*(n*g-a*v),e}function Ei(e){var i=e[0],r=e[1],n=e[2],a=e[3],s=e[4],f=e[5],v=e[6],g=e[7],x=e[8],C=e[9],T=e[10],O=e[11],k=e[12],j=e[13],X=e[14],te=e[15],be=i*f-r*s,Ne=i*v-n*s,$e=i*g-a*s,ot=r*v-n*f,bt=r*g-a*f,_t=n*g-a*v,qt=x*j-C*k,ar=x*X-T*k,Pr=x*te-O*k,qr=C*X-T*j,gr=C*te-O*j,un=T*te-O*X;return be*un-Ne*gr+$e*qr+ot*Pr-bt*ar+_t*qt}function Gn(e,i,r){var n=i[0],a=i[1],s=i[2],f=i[3],v=i[4],g=i[5],x=i[6],C=i[7],T=i[8],O=i[9],k=i[10],j=i[11],X=i[12],te=i[13],be=i[14],Ne=i[15],$e=r[0],ot=r[1],bt=r[2],_t=r[3];return e[0]=$e*n+ot*v+bt*T+_t*X,e[1]=$e*a+ot*g+bt*O+_t*te,e[2]=$e*s+ot*x+bt*k+_t*be,e[3]=$e*f+ot*C+bt*j+_t*Ne,$e=r[4],ot=r[5],bt=r[6],_t=r[7],e[4]=$e*n+ot*v+bt*T+_t*X,e[5]=$e*a+ot*g+bt*O+_t*te,e[6]=$e*s+ot*x+bt*k+_t*be,e[7]=$e*f+ot*C+bt*j+_t*Ne,$e=r[8],ot=r[9],bt=r[10],_t=r[11],e[8]=$e*n+ot*v+bt*T+_t*X,e[9]=$e*a+ot*g+bt*O+_t*te,e[10]=$e*s+ot*x+bt*k+_t*be,e[11]=$e*f+ot*C+bt*j+_t*Ne,$e=r[12],ot=r[13],bt=r[14],_t=r[15],e[12]=$e*n+ot*v+bt*T+_t*X,e[13]=$e*a+ot*g+bt*O+_t*te,e[14]=$e*s+ot*x+bt*k+_t*be,e[15]=$e*f+ot*C+bt*j+_t*Ne,e}function jr(e,i,r){var n=r[0],a=r[1],s=r[2],f,v,g,x,C,T,O,k,j,X,te,be;return i===e?(e[12]=i[0]*n+i[4]*a+i[8]*s+i[12],e[13]=i[1]*n+i[5]*a+i[9]*s+i[13],e[14]=i[2]*n+i[6]*a+i[10]*s+i[14],e[15]=i[3]*n+i[7]*a+i[11]*s+i[15]):(f=i[0],v=i[1],g=i[2],x=i[3],C=i[4],T=i[5],O=i[6],k=i[7],j=i[8],X=i[9],te=i[10],be=i[11],e[0]=f,e[1]=v,e[2]=g,e[3]=x,e[4]=C,e[5]=T,e[6]=O,e[7]=k,e[8]=j,e[9]=X,e[10]=te,e[11]=be,e[12]=f*n+C*a+j*s+i[12],e[13]=v*n+T*a+X*s+i[13],e[14]=g*n+O*a+te*s+i[14],e[15]=x*n+k*a+be*s+i[15]),e}function en(e,i,r){var n=r[0],a=r[1],s=r[2];return e[0]=i[0]*n,e[1]=i[1]*n,e[2]=i[2]*n,e[3]=i[3]*n,e[4]=i[4]*a,e[5]=i[5]*a,e[6]=i[6]*a,e[7]=i[7]*a,e[8]=i[8]*s,e[9]=i[9]*s,e[10]=i[10]*s,e[11]=i[11]*s,e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e}function ni(e,i,r,n){var a=n[0],s=n[1],f=n[2],v=Math.hypot(a,s,f),g,x,C,T,O,k,j,X,te,be,Ne,$e,ot,bt,_t,qt,ar,Pr,qr,gr,un,Ln,Vn,Fa;return v<or.Ib?null:(v=1/v,a*=v,s*=v,f*=v,g=Math.sin(r),x=Math.cos(r),C=1-x,T=i[0],O=i[1],k=i[2],j=i[3],X=i[4],te=i[5],be=i[6],Ne=i[7],$e=i[8],ot=i[9],bt=i[10],_t=i[11],qt=a*a*C+x,ar=s*a*C+f*g,Pr=f*a*C-s*g,qr=a*s*C-f*g,gr=s*s*C+x,un=f*s*C+a*g,Ln=a*f*C+s*g,Vn=s*f*C-a*g,Fa=f*f*C+x,e[0]=T*qt+X*ar+$e*Pr,e[1]=O*qt+te*ar+ot*Pr,e[2]=k*qt+be*ar+bt*Pr,e[3]=j*qt+Ne*ar+_t*Pr,e[4]=T*qr+X*gr+$e*un,e[5]=O*qr+te*gr+ot*un,e[6]=k*qr+be*gr+bt*un,e[7]=j*qr+Ne*gr+_t*un,e[8]=T*Ln+X*Vn+$e*Fa,e[9]=O*Ln+te*Vn+ot*Fa,e[10]=k*Ln+be*Vn+bt*Fa,e[11]=j*Ln+Ne*Vn+_t*Fa,i!==e&&(e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e)}function ui(e,i,r){var n=Math.sin(r),a=Math.cos(r),s=i[4],f=i[5],v=i[6],g=i[7],x=i[8],C=i[9],T=i[10],O=i[11];return i!==e&&(e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[4]=s*a+x*n,e[5]=f*a+C*n,e[6]=v*a+T*n,e[7]=g*a+O*n,e[8]=x*a-s*n,e[9]=C*a-f*n,e[10]=T*a-v*n,e[11]=O*a-g*n,e}function Ni(e,i,r){var n=Math.sin(r),a=Math.cos(r),s=i[0],f=i[1],v=i[2],g=i[3],x=i[8],C=i[9],T=i[10],O=i[11];return i!==e&&(e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[0]=s*a-x*n,e[1]=f*a-C*n,e[2]=v*a-T*n,e[3]=g*a-O*n,e[8]=s*n+x*a,e[9]=f*n+C*a,e[10]=v*n+T*a,e[11]=g*n+O*a,e}function Ga(e,i,r){var n=Math.sin(r),a=Math.cos(r),s=i[0],f=i[1],v=i[2],g=i[3],x=i[4],C=i[5],T=i[6],O=i[7];return i!==e&&(e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[0]=s*a+x*n,e[1]=f*a+C*n,e[2]=v*a+T*n,e[3]=g*a+O*n,e[4]=x*a-s*n,e[5]=C*a-f*n,e[6]=T*a-v*n,e[7]=O*a-g*n,e}function no(e,i){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}function Zi(e,i){return e[0]=i[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=i[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ss(e,i,r){var n=r[0],a=r[1],s=r[2],f=Math.hypot(n,a,s),v,g,x;return f<or.Ib?null:(f=1/f,n*=f,a*=f,s*=f,v=Math.sin(i),g=Math.cos(i),x=1-g,e[0]=n*n*x+g,e[1]=a*n*x+s*v,e[2]=s*n*x-a*v,e[3]=0,e[4]=n*a*x-s*v,e[5]=a*a*x+g,e[6]=s*a*x+n*v,e[7]=0,e[8]=n*s*x+a*v,e[9]=a*s*x-n*v,e[10]=s*s*x+g,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function Ha(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function as(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=n,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function wo(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=n,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Wo(e,i,r){var n=i[0],a=i[1],s=i[2],f=i[3],v=n+n,g=a+a,x=s+s,C=n*v,T=n*g,O=n*x,k=a*g,j=a*x,X=s*x,te=f*v,be=f*g,Ne=f*x;return e[0]=1-(k+X),e[1]=T+Ne,e[2]=O-be,e[3]=0,e[4]=T-Ne,e[5]=1-(C+X),e[6]=j+te,e[7]=0,e[8]=O+be,e[9]=j-te,e[10]=1-(C+k),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function Xo(e,i){var r=new or.WT(3),n=-i[0],a=-i[1],s=-i[2],f=i[3],v=i[4],g=i[5],x=i[6],C=i[7],T=n*n+a*a+s*s+f*f;return T>0?(r[0]=(v*f+C*n+g*s-x*a)*2/T,r[1]=(g*f+C*a+x*n-v*s)*2/T,r[2]=(x*f+C*s+v*a-g*n)*2/T):(r[0]=(v*f+C*n+g*s-x*a)*2,r[1]=(g*f+C*a+x*n-v*s)*2,r[2]=(x*f+C*s+v*a-g*n)*2),Wo(e,i,r),e}function bs(e,i){return e[0]=i[12],e[1]=i[13],e[2]=i[14],e}function io(e,i){var r=i[0],n=i[1],a=i[2],s=i[4],f=i[5],v=i[6],g=i[8],x=i[9],C=i[10];return e[0]=Math.hypot(r,n,a),e[1]=Math.hypot(s,f,v),e[2]=Math.hypot(g,x,C),e}function Si(e,i){var r=new or.WT(3);io(r,i);var n=1/r[0],a=1/r[1],s=1/r[2],f=i[0]*n,v=i[1]*a,g=i[2]*s,x=i[4]*n,C=i[5]*a,T=i[6]*s,O=i[8]*n,k=i[9]*a,j=i[10]*s,X=f+C+j,te=0;return X>0?(te=Math.sqrt(X+1)*2,e[3]=.25*te,e[0]=(T-k)/te,e[1]=(O-g)/te,e[2]=(v-x)/te):f>C&&f>j?(te=Math.sqrt(1+f-C-j)*2,e[3]=(T-k)/te,e[0]=.25*te,e[1]=(v+x)/te,e[2]=(O+g)/te):C>j?(te=Math.sqrt(1+C-f-j)*2,e[3]=(O-g)/te,e[0]=(v+x)/te,e[1]=.25*te,e[2]=(T+k)/te):(te=Math.sqrt(1+j-f-C)*2,e[3]=(v-x)/te,e[0]=(O+g)/te,e[1]=(T+k)/te,e[2]=.25*te),e}function Yo(e,i,r,n){var a=i[0],s=i[1],f=i[2],v=i[3],g=a+a,x=s+s,C=f+f,T=a*g,O=a*x,k=a*C,j=s*x,X=s*C,te=f*C,be=v*g,Ne=v*x,$e=v*C,ot=n[0],bt=n[1],_t=n[2];return e[0]=(1-(j+te))*ot,e[1]=(O+$e)*ot,e[2]=(k-Ne)*ot,e[3]=0,e[4]=(O-$e)*bt,e[5]=(1-(T+te))*bt,e[6]=(X+be)*bt,e[7]=0,e[8]=(k+Ne)*_t,e[9]=(X-be)*_t,e[10]=(1-(T+j))*_t,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function ra(e,i,r,n,a){var s=i[0],f=i[1],v=i[2],g=i[3],x=s+s,C=f+f,T=v+v,O=s*x,k=s*C,j=s*T,X=f*C,te=f*T,be=v*T,Ne=g*x,$e=g*C,ot=g*T,bt=n[0],_t=n[1],qt=n[2],ar=a[0],Pr=a[1],qr=a[2],gr=(1-(X+be))*bt,un=(k+ot)*bt,Ln=(j-$e)*bt,Vn=(k-ot)*_t,Fa=(1-(O+be))*_t,Ro=(te+Ne)*_t,Ls=(j+$e)*qt,au=(te-Ne)*qt,Vs=(1-(O+X))*qt;return e[0]=gr,e[1]=un,e[2]=Ln,e[3]=0,e[4]=Vn,e[5]=Fa,e[6]=Ro,e[7]=0,e[8]=Ls,e[9]=au,e[10]=Vs,e[11]=0,e[12]=r[0]+ar-(gr*ar+Vn*Pr+Ls*qr),e[13]=r[1]+Pr-(un*ar+Fa*Pr+au*qr),e[14]=r[2]+qr-(Ln*ar+Ro*Pr+Vs*qr),e[15]=1,e}function us(e,i){var r=i[0],n=i[1],a=i[2],s=i[3],f=r+r,v=n+n,g=a+a,x=r*f,C=n*f,T=n*v,O=a*f,k=a*v,j=a*g,X=s*f,te=s*v,be=s*g;return e[0]=1-T-j,e[1]=C+be,e[2]=O-te,e[3]=0,e[4]=C-be,e[5]=1-x-j,e[6]=k+X,e[7]=0,e[8]=O+te,e[9]=k-X,e[10]=1-x-T,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function oi(e,i,r,n,a,s,f){var v=1/(r-i),g=1/(a-n),x=1/(s-f);return e[0]=s*2*v,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s*2*g,e[6]=0,e[7]=0,e[8]=(r+i)*v,e[9]=(a+n)*g,e[10]=(f+s)*x,e[11]=-1,e[12]=0,e[13]=0,e[14]=f*s*2*x,e[15]=0,e}function zi(e,i,r,n,a){var s=1/Math.tan(i/2),f;return e[0]=s/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,a!=null&&a!==Infinity?(f=1/(n-a),e[10]=(a+n)*f,e[14]=2*a*n*f):(e[10]=-1,e[14]=-2*n),e}var ua=zi;function To(e,i,r,n,a){var s=1/Math.tan(i/2),f;return e[0]=s/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,a!=null&&a!==Infinity?(f=1/(n-a),e[10]=a*f,e[14]=a*n*f):(e[10]=-1,e[14]=-n),e}function wl(e,i,r,n){var a=Math.tan(i.upDegrees*Math.PI/180),s=Math.tan(i.downDegrees*Math.PI/180),f=Math.tan(i.leftDegrees*Math.PI/180),v=Math.tan(i.rightDegrees*Math.PI/180),g=2/(f+v),x=2/(a+s);return e[0]=g,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=x,e[6]=0,e[7]=0,e[8]=-((f-v)*g*.5),e[9]=(a-s)*x*.5,e[10]=n/(r-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*r/(r-n),e[15]=0,e}function Te(e,i,r,n,a,s,f){var v=1/(i-r),g=1/(n-a),x=1/(s-f);return e[0]=-2*v,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*g,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*x,e[11]=0,e[12]=(i+r)*v,e[13]=(a+n)*g,e[14]=(f+s)*x,e[15]=1,e}var Ut=Te;function St(e,i,r,n,a,s,f){var v=1/(i-r),g=1/(n-a),x=1/(s-f);return e[0]=-2*v,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*g,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=x,e[11]=0,e[12]=(i+r)*v,e[13]=(a+n)*g,e[14]=s*x,e[15]=1,e}function mn(e,i,r,n){var a,s,f,v,g,x,C,T,O,k,j=i[0],X=i[1],te=i[2],be=n[0],Ne=n[1],$e=n[2],ot=r[0],bt=r[1],_t=r[2];return Math.abs(j-ot)<or.Ib&&Math.abs(X-bt)<or.Ib&&Math.abs(te-_t)<or.Ib?Xr(e):(C=j-ot,T=X-bt,O=te-_t,k=1/Math.hypot(C,T,O),C*=k,T*=k,O*=k,a=Ne*O-$e*T,s=$e*C-be*O,f=be*T-Ne*C,k=Math.hypot(a,s,f),k?(k=1/k,a*=k,s*=k,f*=k):(a=0,s=0,f=0),v=T*f-O*s,g=O*a-C*f,x=C*s-T*a,k=Math.hypot(v,g,x),k?(k=1/k,v*=k,g*=k,x*=k):(v=0,g=0,x=0),e[0]=a,e[1]=v,e[2]=C,e[3]=0,e[4]=s,e[5]=g,e[6]=T,e[7]=0,e[8]=f,e[9]=x,e[10]=O,e[11]=0,e[12]=-(a*j+s*X+f*te),e[13]=-(v*j+g*X+x*te),e[14]=-(C*j+T*X+O*te),e[15]=1,e)}function Hi(e,i,r,n){var a=i[0],s=i[1],f=i[2],v=n[0],g=n[1],x=n[2],C=a-r[0],T=s-r[1],O=f-r[2],k=C*C+T*T+O*O;k>0&&(k=1/Math.sqrt(k),C*=k,T*=k,O*=k);var j=g*O-x*T,X=x*C-v*O,te=v*T-g*C;return k=j*j+X*X+te*te,k>0&&(k=1/Math.sqrt(k),j*=k,X*=k,te*=k),e[0]=j,e[1]=X,e[2]=te,e[3]=0,e[4]=T*te-O*X,e[5]=O*j-C*te,e[6]=C*X-T*j,e[7]=0,e[8]=C,e[9]=T,e[10]=O,e[11]=0,e[12]=a,e[13]=s,e[14]=f,e[15]=1,e}function Se(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function ue(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function Ge(e,i,r){return e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e[3]=i[3]+r[3],e[4]=i[4]+r[4],e[5]=i[5]+r[5],e[6]=i[6]+r[6],e[7]=i[7]+r[7],e[8]=i[8]+r[8],e[9]=i[9]+r[9],e[10]=i[10]+r[10],e[11]=i[11]+r[11],e[12]=i[12]+r[12],e[13]=i[13]+r[13],e[14]=i[14]+r[14],e[15]=i[15]+r[15],e}function lt(e,i,r){return e[0]=i[0]-r[0],e[1]=i[1]-r[1],e[2]=i[2]-r[2],e[3]=i[3]-r[3],e[4]=i[4]-r[4],e[5]=i[5]-r[5],e[6]=i[6]-r[6],e[7]=i[7]-r[7],e[8]=i[8]-r[8],e[9]=i[9]-r[9],e[10]=i[10]-r[10],e[11]=i[11]-r[11],e[12]=i[12]-r[12],e[13]=i[13]-r[13],e[14]=i[14]-r[14],e[15]=i[15]-r[15],e}function Lt(e,i,r){return e[0]=i[0]*r,e[1]=i[1]*r,e[2]=i[2]*r,e[3]=i[3]*r,e[4]=i[4]*r,e[5]=i[5]*r,e[6]=i[6]*r,e[7]=i[7]*r,e[8]=i[8]*r,e[9]=i[9]*r,e[10]=i[10]*r,e[11]=i[11]*r,e[12]=i[12]*r,e[13]=i[13]*r,e[14]=i[14]*r,e[15]=i[15]*r,e}function Ke(e,i,r,n){return e[0]=i[0]+r[0]*n,e[1]=i[1]+r[1]*n,e[2]=i[2]+r[2]*n,e[3]=i[3]+r[3]*n,e[4]=i[4]+r[4]*n,e[5]=i[5]+r[5]*n,e[6]=i[6]+r[6]*n,e[7]=i[7]+r[7]*n,e[8]=i[8]+r[8]*n,e[9]=i[9]+r[9]*n,e[10]=i[10]+r[10]*n,e[11]=i[11]+r[11]*n,e[12]=i[12]+r[12]*n,e[13]=i[13]+r[13]*n,e[14]=i[14]+r[14]*n,e[15]=i[15]+r[15]*n,e}function Fe(e,i){return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]&&e[3]===i[3]&&e[4]===i[4]&&e[5]===i[5]&&e[6]===i[6]&&e[7]===i[7]&&e[8]===i[8]&&e[9]===i[9]&&e[10]===i[10]&&e[11]===i[11]&&e[12]===i[12]&&e[13]===i[13]&&e[14]===i[14]&&e[15]===i[15]}function nt(e,i){var r=e[0],n=e[1],a=e[2],s=e[3],f=e[4],v=e[5],g=e[6],x=e[7],C=e[8],T=e[9],O=e[10],k=e[11],j=e[12],X=e[13],te=e[14],be=e[15],Ne=i[0],$e=i[1],ot=i[2],bt=i[3],_t=i[4],qt=i[5],ar=i[6],Pr=i[7],qr=i[8],gr=i[9],un=i[10],Ln=i[11],Vn=i[12],Fa=i[13],Ro=i[14],Ls=i[15];return Math.abs(r-Ne)<=or.Ib*Math.max(1,Math.abs(r),Math.abs(Ne))&&Math.abs(n-$e)<=or.Ib*Math.max(1,Math.abs(n),Math.abs($e))&&Math.abs(a-ot)<=or.Ib*Math.max(1,Math.abs(a),Math.abs(ot))&&Math.abs(s-bt)<=or.Ib*Math.max(1,Math.abs(s),Math.abs(bt))&&Math.abs(f-_t)<=or.Ib*Math.max(1,Math.abs(f),Math.abs(_t))&&Math.abs(v-qt)<=or.Ib*Math.max(1,Math.abs(v),Math.abs(qt))&&Math.abs(g-ar)<=or.Ib*Math.max(1,Math.abs(g),Math.abs(ar))&&Math.abs(x-Pr)<=or.Ib*Math.max(1,Math.abs(x),Math.abs(Pr))&&Math.abs(C-qr)<=or.Ib*Math.max(1,Math.abs(C),Math.abs(qr))&&Math.abs(T-gr)<=or.Ib*Math.max(1,Math.abs(T),Math.abs(gr))&&Math.abs(O-un)<=or.Ib*Math.max(1,Math.abs(O),Math.abs(un))&&Math.abs(k-Ln)<=or.Ib*Math.max(1,Math.abs(k),Math.abs(Ln))&&Math.abs(j-Vn)<=or.Ib*Math.max(1,Math.abs(j),Math.abs(Vn))&&Math.abs(X-Fa)<=or.Ib*Math.max(1,Math.abs(X),Math.abs(Fa))&&Math.abs(te-Ro)<=or.Ib*Math.max(1,Math.abs(te),Math.abs(Ro))&&Math.abs(be-Ls)<=or.Ib*Math.max(1,Math.abs(be),Math.abs(Ls))}var xe=Gn,Ze=lt,Ae,ct,Ct=(Ae=(0,Wr.b2)(),Ae(ct=function(){function e(){(0,ht.Z)(this,e),(0,A.Z)(this,"viewport",void 0),(0,A.Z)(this,"overridedViewProjectionMatrix",void 0),(0,A.Z)(this,"jitteredViewProjectionMatrix",void 0),(0,A.Z)(this,"jitteredProjectionMatrix",void 0),(0,A.Z)(this,"viewMatrixInverse",void 0),(0,A.Z)(this,"cameraPosition",void 0)}return(0,Pt.Z)(e,[{key:"init",value:function(){}},{key:"update",value:function(r){this.viewport=r,this.viewMatrixInverse=zr(),Hr(this.viewMatrixInverse,r.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getModelMatrix",value:function(){return this.viewport.getModelMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var r=this.viewport.getCenter(),n=(0,on.Z)(r,2),a=n[0],s=n[1];return[a,s]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(r,n){return this.viewport.projectFlat(r,n)}},{key:"setViewProjectionMatrix",value:function(r){this.overridedViewProjectionMatrix=r}},{key:"jitterProjectionMatrix",value:function(r,n){var a=no(zr(),[r,n,0]);this.jitteredProjectionMatrix=Gn(zr(),a,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=Gn(zr(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),e}())||ct),fr,Ur;function Vr(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=sn(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function sn(e,i){if(!!e){if(typeof e=="string")return Dr(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Dr(e,i)}}function Dr(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var An=(fr=(0,Wr.b2)(),fr(Ur=function(){function e(){(0,ht.Z)(this,e),(0,A.Z)(this,"container",void 0),(0,A.Z)(this,"controlCorners",void 0),(0,A.Z)(this,"controlContainer",void 0),(0,A.Z)(this,"scene",void 0),(0,A.Z)(this,"mapsService",void 0),(0,A.Z)(this,"controls",[]),(0,A.Z)(this,"unAddControls",[])}return(0,Pt.Z)(e,[{key:"init",value:function(r,n){this.container=r.container,this.scene=n,this.mapsService=n.get(Ht.IMapService),this.initControlPos()}},{key:"addControl",value:function(r,n){var a=n.get(Ht.IMapService);a.map?(r.addTo(this.scene),this.controls.push(r)):this.unAddControls.push(r)}},{key:"getControlByName",value:function(r){return this.controls.find(function(n){return n.controlOption.name===r})}},{key:"removeControl",value:function(r){var n=this.controls.indexOf(r);return n>-1&&this.controls.splice(n,1),r.remove(),this}},{key:"addControls",value:function(){var r=this;this.unAddControls.forEach(function(n){n.addTo(r.scene),r.controls.push(n)}),this.unAddControls=[]}},{key:"destroy",value:function(){var r=Vr(this.controls),n;try{for(r.s();!(n=r.n()).done;){var a=n.value;a.remove()}}catch(s){r.e(s)}finally{r.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var r=this.controlCorners={},n="l7-",a=this.controlContainer=lo("div",n+"control-container",this.container);function s(){var f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],v=f.map(function(g){return n+g}).join(" ");r[f.join("")]=lo("div",v,a)}s(["top","left"]),s(["top","right"]),s(["bottom","left"]),s(["bottom","right"]),s(["top","center"]),s(["right","center"]),s(["left","center"]),s(["bottom","center"])}},{key:"clearControlPos",value:function(){for(var r in this.controlCorners)this.controlCorners[r]&&ju(this.controlCorners[r]);this.controlContainer&&ju(this.controlContainer),delete this.controlCorners,delete this.controlContainer}}]),e}())||Ur),cn,xn,bn=(cn=(0,Wr.b2)(),cn(xn=function(){function e(){(0,ht.Z)(this,e),(0,A.Z)(this,"container",void 0),(0,A.Z)(this,"scene",void 0),(0,A.Z)(this,"mapsService",void 0),(0,A.Z)(this,"markers",[]),(0,A.Z)(this,"markerLayers",[]),(0,A.Z)(this,"unAddMarkers",[]),(0,A.Z)(this,"unAddMarkerLayers",[])}return(0,Pt.Z)(e,[{key:"addMarkerLayer",value:function(r){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(r),r.addTo(this.scene)):this.unAddMarkerLayers.push(r)}},{key:"removeMarkerLayer",value:function(r){r.destroy(),this.markerLayers.indexOf(r);var n=this.markerLayers.indexOf(r);n>-1&&this.markerLayers.splice(n,1)}},{key:"addMarker",value:function(r){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(r),r.addTo(this.scene)):this.unAddMarkers.push(r)}},{key:"addMarkers",value:function(){var r=this;this.unAddMarkers.forEach(function(n){n.addTo(r.scene),r.markers.push(n)}),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var r=this;this.unAddMarkerLayers.forEach(function(n){r.markerLayers.push(n),n.addTo(r.scene)}),this.unAddMarkers=[]}},{key:"removeMarker",value:function(r){r.remove(),this.markers.indexOf(r);var n=this.markers.indexOf(r);n>-1&&this.markers.splice(n,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(r){this.scene=r,this.mapsService=r.get(Ht.IMapService)}},{key:"destroy",value:function(){this.markers.forEach(function(r){r.remove()}),this.markers=[],this.markerLayers.forEach(function(r){r.destroy()}),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(r){r.destroy()}}]),e}())||xn),dn,Jn,_a=(dn=(0,Wr.b2)(),dn(Jn=function(){function e(){(0,ht.Z)(this,e),(0,A.Z)(this,"scene",void 0),(0,A.Z)(this,"popup",void 0),(0,A.Z)(this,"mapsService",void 0),(0,A.Z)(this,"unAddPopup",void 0)}return(0,Pt.Z)(e,[{key:"removePopup",value:function(r){r.remove()}},{key:"destroy",value:function(){this.popup.remove()}},{key:"addPopup",value:function(r){this.popup&&this.popup.remove(),this.mapsService.map&&this.mapsService.getMarkerContainer()?(r.addTo(this.scene),this.popup=r):this.unAddPopup=r}},{key:"initPopup",value:function(){this.unAddPopup&&(this.addPopup(this.unAddPopup),this.unAddPopup=null)}},{key:"init",value:function(r){this.scene=r,this.mapsService=r.get(Ht.IMapService)}}]),e}())||Jn),ls=U(82492),Ia=U.n(ls),pa={MapToken:"\u60A8\u6B63\u5728\u4F7F\u7528 Demo\u6D4B\u8BD5\u5730\u56FEtoken\uFF0C\u5982\u679C\u751F\u4EA7\u73AF\u5883\u4E2D\u4F7F\u7528\u53BB\u5BF9\u5E94\u5730\u56FE\u8BF7\u6CE8\u518CToken",SDK:"\u8BF7\u786E\u8BA4\u5F15\u5165\u4E86mapbox-gl api\u4E14\u5728L7\u4E4B\u524D\u5F15\u5165"},Tl=pa,Is,Ku;function yu(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function ah(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?yu(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):yu(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Lu={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},xc={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",activeMix:0,selectColor:"blue",selectMix:0,enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},oh=(Is=(0,Wr.b2)(),Is(Ku=function(){function e(){(0,ht.Z)(this,e),(0,A.Z)(this,"sceneConfigCache",{}),(0,A.Z)(this,"layerConfigCache",{})}return(0,Pt.Z)(e,[{key:"getSceneConfig",value:function(r){return this.sceneConfigCache[r]}},{key:"getSceneWarninfo",value:function(r){return Tl[r]}},{key:"setSceneConfig",value:function(r,n){this.sceneConfigCache[r]=ah(ah({},Lu),n)}},{key:"getLayerConfig",value:function(r){return this.layerConfigCache[r]}},{key:"setLayerConfig",value:function(r,n,a){this.layerConfigCache[n]=ah({},Ia()({},this.sceneConfigCache[r],xc,a))}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),e}())||Ku);function Ui(e,i,r,n){!r||Object.defineProperty(e,i,{enumerable:r.enumerable,configurable:r.configurable,writable:r.writable,value:r.initializer?r.initializer.call(n):void 0})}function jn(e,i,r,n,a){var s={};return Object.keys(n).forEach(function(f){s[f]=n[f]}),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=r.slice().reverse().reduce(function(f,v){return v(e,i,f)||f},s),a&&s.initializer!==void 0&&(s.value=s.initializer?s.initializer.call(a):void 0,s.initializer=void 0),s.initializer===void 0&&(Object.defineProperty(e,i,s),s=null),s}function Fh(){var e=new or.WT(4);return or.WT!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Mf(e){var i=new glMatrix.ARRAY_TYPE(4);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i}function Qp(e,i,r,n){var a=new or.WT(4);return a[0]=e,a[1]=i,a[2]=r,a[3]=n,a}function Dd(e,i){return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e}function wv(e,i,r,n,a){return e[0]=i,e[1]=r,e[2]=n,e[3]=a,e}function fp(e,i,r){return e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e[3]=i[3]+r[3],e}function Pf(e,i,r){return e[0]=i[0]-r[0],e[1]=i[1]-r[1],e[2]=i[2]-r[2],e[3]=i[3]-r[3],e}function y0(e,i,r){return e[0]=i[0]*r[0],e[1]=i[1]*r[1],e[2]=i[2]*r[2],e[3]=i[3]*r[3],e}function _0(e,i,r){return e[0]=i[0]/r[0],e[1]=i[1]/r[1],e[2]=i[2]/r[2],e[3]=i[3]/r[3],e}function ym(e,i){return e[0]=Math.ceil(i[0]),e[1]=Math.ceil(i[1]),e[2]=Math.ceil(i[2]),e[3]=Math.ceil(i[3]),e}function Os(e,i){return e[0]=Math.floor(i[0]),e[1]=Math.floor(i[1]),e[2]=Math.floor(i[2]),e[3]=Math.floor(i[3]),e}function sh(e,i,r){return e[0]=Math.min(i[0],r[0]),e[1]=Math.min(i[1],r[1]),e[2]=Math.min(i[2],r[2]),e[3]=Math.min(i[3],r[3]),e}function x0(e,i,r){return e[0]=Math.max(i[0],r[0]),e[1]=Math.max(i[1],r[1]),e[2]=Math.max(i[2],r[2]),e[3]=Math.max(i[3],r[3]),e}function t(e,i){return e[0]=Math.round(i[0]),e[1]=Math.round(i[1]),e[2]=Math.round(i[2]),e[3]=Math.round(i[3]),e}function o(e,i,r){return e[0]=i[0]*r,e[1]=i[1]*r,e[2]=i[2]*r,e[3]=i[3]*r,e}function u(e,i,r,n){return e[0]=i[0]+r[0]*n,e[1]=i[1]+r[1]*n,e[2]=i[2]+r[2]*n,e[3]=i[3]+r[3]*n,e}function p(e,i){var r=i[0]-e[0],n=i[1]-e[1],a=i[2]-e[2],s=i[3]-e[3];return Math.hypot(r,n,a,s)}function y(e,i){var r=i[0]-e[0],n=i[1]-e[1],a=i[2]-e[2],s=i[3]-e[3];return r*r+n*n+a*a+s*s}function b(e){var i=e[0],r=e[1],n=e[2],a=e[3];return Math.hypot(i,r,n,a)}function S(e){var i=e[0],r=e[1],n=e[2],a=e[3];return i*i+r*r+n*n+a*a}function I(e,i){return e[0]=-i[0],e[1]=-i[1],e[2]=-i[2],e[3]=-i[3],e}function D(e,i){return e[0]=1/i[0],e[1]=1/i[1],e[2]=1/i[2],e[3]=1/i[3],e}function z(e,i){var r=i[0],n=i[1],a=i[2],s=i[3],f=r*r+n*n+a*a+s*s;return f>0&&(f=1/Math.sqrt(f)),e[0]=r*f,e[1]=n*f,e[2]=a*f,e[3]=s*f,e}function V(e,i){return e[0]*i[0]+e[1]*i[1]+e[2]*i[2]+e[3]*i[3]}function W(e,i,r,n){var a=r[0]*n[1]-r[1]*n[0],s=r[0]*n[2]-r[2]*n[0],f=r[0]*n[3]-r[3]*n[0],v=r[1]*n[2]-r[2]*n[1],g=r[1]*n[3]-r[3]*n[1],x=r[2]*n[3]-r[3]*n[2],C=i[0],T=i[1],O=i[2],k=i[3];return e[0]=T*x-O*g+k*v,e[1]=-(C*x)+O*f-k*s,e[2]=C*g-T*f+k*a,e[3]=-(C*v)+T*s-O*a,e}function ee(e,i,r,n){var a=i[0],s=i[1],f=i[2],v=i[3];return e[0]=a+n*(r[0]-a),e[1]=s+n*(r[1]-s),e[2]=f+n*(r[2]-f),e[3]=v+n*(r[3]-v),e}function se(e,i){i=i||1;var r,n,a,s,f,v;do r=glMatrix.RANDOM()*2-1,n=glMatrix.RANDOM()*2-1,f=r*r+n*n;while(f>=1);do a=glMatrix.RANDOM()*2-1,s=glMatrix.RANDOM()*2-1,v=a*a+s*s;while(v>=1);var g=Math.sqrt((1-f)/v);return e[0]=i*r,e[1]=i*n,e[2]=i*a*g,e[3]=i*s*g,e}function Me(e,i,r){var n=i[0],a=i[1],s=i[2],f=i[3];return e[0]=r[0]*n+r[4]*a+r[8]*s+r[12]*f,e[1]=r[1]*n+r[5]*a+r[9]*s+r[13]*f,e[2]=r[2]*n+r[6]*a+r[10]*s+r[14]*f,e[3]=r[3]*n+r[7]*a+r[11]*s+r[15]*f,e}function Oe(e,i,r){var n=i[0],a=i[1],s=i[2],f=r[0],v=r[1],g=r[2],x=r[3],C=x*n+v*s-g*a,T=x*a+g*n-f*s,O=x*s+f*a-v*n,k=-f*n-v*a-g*s;return e[0]=C*x+k*-f+T*-g-O*-v,e[1]=T*x+k*-v+O*-f-C*-g,e[2]=O*x+k*-g+C*-v-T*-f,e[3]=i[3],e}function Ye(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function ze(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function st(e,i){return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]&&e[3]===i[3]}function Tt(e,i){var r=e[0],n=e[1],a=e[2],s=e[3],f=i[0],v=i[1],g=i[2],x=i[3];return Math.abs(r-f)<=glMatrix.EPSILON*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(n-v)<=glMatrix.EPSILON*Math.max(1,Math.abs(n),Math.abs(v))&&Math.abs(a-g)<=glMatrix.EPSILON*Math.max(1,Math.abs(a),Math.abs(g))&&Math.abs(s-x)<=glMatrix.EPSILON*Math.max(1,Math.abs(s),Math.abs(x))}var Vt=null,Xt=null,lr=null,Lr=null,$r=null,Zn=null,gn=null,Yn=function(){var e=Fh();return function(i,r,n,a,s,f){var v,g;for(r||(r=4),n||(n=0),a?g=Math.min(a*r+n,i.length):g=i.length,v=n;v<g;v+=r)e[0]=i[v],e[1]=i[v+1],e[2]=i[v+2],e[3]=i[v+3],s(e,e,f),i[v]=e[0],i[v+1]=e[1],i[v+2]=e[2],i[v+3]=e[3];return i}}(),hn=Math.PI/180,ki=512,ai=4003e4;function Pn(e){var i=e.latitude,r=i===void 0?0:i,n=e.zoom,a=n===void 0?0:n,s=e.scale,f=e.highPrecision,v=f===void 0?!1:f,g=e.flipY,x=g===void 0?!1:g;s=s!==void 0?s:Math.pow(2,a);var C={},T=ki*s,O=Math.cos(r*hn),k=T/360,j=k/O,X=T/ai/O;if(C.pixelsPerMeter=[X,-X,X],C.metersPerPixel=[1/X,-1/X,1/X],C.pixelsPerDegree=[k,-j,X],C.degreesPerPixel=[1/k,-1/j,1/X],v){var te=hn*Math.tan(r*hn)/O,be=k*te/2,Ne=T/ai*te,$e=Ne/j*X;C.pixelsPerDegree2=[0,-be,Ne],C.pixelsPerMeter2=[$e,0,$e],x&&(C.pixelsPerDegree2[1]=-C.pixelsPerDegree2[1],C.pixelsPerMeter2[1]=-C.pixelsPerMeter2[1])}return x&&(C.pixelsPerMeter[1]=-C.pixelsPerMeter[1],C.metersPerPixel[1]=-C.metersPerPixel[1],C.pixelsPerDegree[1]=-C.pixelsPerDegree[1],C.degreesPerPixel[1]=-C.degreesPerPixel[1]),C}var Ai;(function(e){e[e.LNGLAT=1]="LNGLAT",e[e.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",e[e.VECTOR_TILE=3]="VECTOR_TILE",e[e.IDENTITY=4]="IDENTITY",e[e.P20=5]="P20",e[e.P20_OFFSET=6]="P20_OFFSET",e[e.METER_OFFSET=7]="METER_OFFSET",e[e.P20_2=8]="P20_2"})(Ai||(Ai={}));var hi={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"},ea,Hn,la,Wa,yo,_o=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],ao=(ea=(0,Wr.b2)(),Hn=(0,Wr.f3)(Ht.ICameraService),ea(la=(Wa=function(){function e(){(0,ht.Z)(this,e),(0,A.Z)(this,"needRefresh",!0),Ui(this,"cameraService",yo,this),(0,A.Z)(this,"coordinateSystem",void 0),(0,A.Z)(this,"viewportCenter",void 0),(0,A.Z)(this,"viewportCenterProjection",void 0),(0,A.Z)(this,"pixelsPerDegree",void 0),(0,A.Z)(this,"pixelsPerDegree2",void 0),(0,A.Z)(this,"pixelsPerMeter",void 0)}return(0,Pt.Z)(e,[{key:"refresh",value:function(){var r=this.cameraService.getZoom(),n=this.cameraService.getZoomScale(),a=this.cameraService.getCenter(),s=Pn({latitude:a[1],zoom:r}),f=s.pixelsPerMeter,v=s.pixelsPerDegree;this.viewportCenter=a,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=f,this.pixelsPerDegree=v,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===Ai.LNGLAT||this.coordinateSystem===Ai.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===Ai.LNGLAT_OFFSET?this.calculateLnglatOffset(a,r):this.coordinateSystem===Ai.P20_OFFSET&&this.calculateLnglatOffset(a,r,n,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(r){this.coordinateSystem=r}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(r,n,a,s){var f=Pn({latitude:r[1],zoom:n,scale:a,flipY:s,highPrecision:!0}),v=f.pixelsPerMeter,g=f.pixelsPerDegree,x=f.pixelsPerDegree2,C=this.cameraService.getViewMatrix(),T=this.cameraService.getProjectionMatrix(),O=Gn([],T,C),k=this.cameraService.projectFlat([Math.fround(r[0]),Math.fround(r[1])],Math.pow(2,n));this.viewportCenterProjection=Me([],[k[0],k[1],0,1],O),C=this.cameraService.getViewMatrixUncentered()||C,O=Gn([],T,C),O=Gn([],O,_o),this.cameraService.setViewProjectionMatrix(O),this.pixelsPerMeter=v,this.pixelsPerDegree=g,this.pixelsPerDegree2=x}}]),e}(),yo=jn(Wa.prototype,"cameraService",[Hn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wa))||la),Mo=U(20396),Po=U.n(Mo),ma;(function(e){e.Hover="hover",e.Click="click",e.Select="select",e.Active="active",e.Drag="drag"})(ma||(ma={}));var zs,cs,Us,xo,fs;function Yi(e){var i=Da();return function(){var n=(0,Mt.Z)(e),a;if(i){var s=(0,Mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,wr.Z)(this,a)}}function Da(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ca={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},ia=(zs=(0,Wr.b2)(),cs=(0,Wr.f3)(Ht.IMapService),zs(Us=(xo=function(e){(0,Ir.Z)(r,e);var i=Yi(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ne.Z)(n),"indragging",!1),Ui((0,ne.Z)(n),"mapService",fs,(0,ne.Z)(n)),(0,A.Z)((0,ne.Z)(n),"hammertime",void 0),(0,A.Z)((0,ne.Z)(n),"lastClickTime",0),(0,A.Z)((0,ne.Z)(n),"lastClickXY",[-1,-1]),(0,A.Z)((0,ne.Z)(n),"clickTimer",void 0),(0,A.Z)((0,ne.Z)(n),"$containter",void 0),(0,A.Z)((0,ne.Z)(n),"onDrag",function(v){var g=n.interactionEvent(v);g.type=Ca[g.type],g.type==="dragging"?n.indragging=!0:n.indragging=!1,n.emit(ma.Drag,g)}),(0,A.Z)((0,ne.Z)(n),"onHammer",function(v){v.srcEvent.stopPropagation();var g=n.interactionEvent(v);n.emit(ma.Hover,g)}),(0,A.Z)((0,ne.Z)(n),"onTouch",function(v){var g=v.touches[0];n.onHover({x:g.pageX,y:g.pageY,type:"touch"})}),(0,A.Z)((0,ne.Z)(n),"onHover",function(v){var g=v.clientX,x=v.clientY,C=g,T=x,O=v.type,k=n.mapService.getMapContainer();if(k)if(ts)C=C-k.left-0,T=T-k.top-0;else{var j=k.getBoundingClientRect(),X=j.top,te=j.left;C=C-te-k.clientLeft,T=T-X-k.clientTop}var be=n.mapService.containerToLngLat([C,T]);if(O==="click"){if(!ts&&"ontouchstart"in document.documentElement)return;n.isDoubleTap(C,T,be);return}if(O==="touch"){n.isDoubleTap(C,T,be);return}O!=="click"&&O!=="dblclick"&&n.emit(ma.Hover,{x:C,y:T,lngLat:be,type:O,target:v})}),n}return(0,Pt.Z)(r,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(ma.Hover)}},{key:"triggerHover",value:function(a){var s=a.x,f=a.y;this.emit(ma.Hover,{x:s,y:f})}},{key:"triggerSelect",value:function(a){this.emit(ma.Select,{featureId:a})}},{key:"triggerActive",value:function(a){this.emit(ma.Active,{featureId:a})}},{key:"handleMiniEvent",value:function(a){this.onHover({clientX:a.touches[0].pageX,clientY:a.touches[0].pageY,type:"touch"})}},{key:"addEventListenerOnMap",value:function(){var a=this.mapService.getMapContainer();if(a)if(ts)kn.document.addEventListener("touchstart",this.handleMiniEvent.bind(this));else{var s=new(Po()).Manager(a);s.add(new(Po()).Tap({event:"dblclick",taps:2})),s.add(new(Po()).Tap({event:"click"})),s.add(new(Po()).Pan({threshold:0,pointers:0})),s.add(new(Po()).Press({})),s.on("dblclick click",this.onHammer),s.on("panstart panmove panend pancancel",this.onDrag),a.addEventListener("mousemove",this.onHover),a.addEventListener("mousedown",this.onHover,!0),a.addEventListener("mouseup",this.onHover),a.addEventListener("contextmenu",this.onHover),this.hammertime=s}}},{key:"removeEventListenerOnMap",value:function(){if(ts)kn.document.removeEventListener("touchstart",this.handleMiniEvent.bind(this));else{var a=this.mapService.getMapContainer();a&&(a.removeEventListener("mousemove",this.onHover),this.hammertime.off("dblclick click",this.onHammer),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),a.removeEventListener("mousedown",this.onHover),a.removeEventListener("mouseup",this.onHover),a.removeEventListener("contextmenu",this.onHover))}}},{key:"interactionEvent",value:function(a){var s=a.type,f=a.pointerType,v,g;f==="touch"?(g=Math.floor(a.pointers[0].clientY),v=Math.floor(a.pointers[0].clientX)):(g=Math.floor(a.srcEvent.y),v=Math.floor(a.srcEvent.x));var x=this.mapService.getMapContainer();if(x){var C=x.getBoundingClientRect(),T=C.top,O=C.left;v-=O,g-=T}var k=this.mapService.containerToLngLat([v,g]);return{x:v,y:g,lngLat:k,type:s,target:a.srcEvent}}},{key:"isDoubleTap",value:function(a,s,f){var v=this,g=new Date().getTime(),x="click";g-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-a)<10&&Math.abs(this.lastClickXY[1]-s)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),x="dblclick",this.emit(ma.Hover,{x:a,y:s,lngLat:f,type:x})):(this.lastClickTime=g,this.lastClickXY=[a,s],this.clickTimer=setTimeout(function(){x="click",v.emit(ma.Hover,{x:a,y:s,lngLat:f,type:x})},400))}}]),r}(Bi()),fs=jn(xo.prototype,"mapService",[cs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xo))||Us),iu=0;function Zs(e){if(ts)return null;var i=e;if(typeof e=="string"&&(i=document.getElementById(e)),i){var r=document.createElement("div");return r.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,r.id="l7-scene-".concat(iu++),r.classList.add("l7-scene"),i.appendChild(r),r}return null}function $a(e){var i,r,n=!0;return e==null||(i=e.target)===null||i===void 0||(r=i.path)===null||r===void 0||r.map(function(a){if(a!=null&&a.classList){var s;a==null||(s=a.classList)===null||s===void 0||s.forEach(function(f){(f==="l7-marker"||f==="l7-popup")&&(n=!1)})}}),n}var G;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.CULL_FACE=2884]="CULL_FACE",e[e.BLEND=3042]="BLEND",e[e.DITHER=3024]="DITHER",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.TEXTURE1=33985]="TEXTURE1",e[e.TEXTURE2=33986]="TEXTURE2",e[e.TEXTURE3=33987]="TEXTURE3",e[e.TEXTURE4=33988]="TEXTURE4",e[e.TEXTURE5=33989]="TEXTURE5",e[e.TEXTURE6=33990]="TEXTURE6",e[e.TEXTURE7=33991]="TEXTURE7",e[e.TEXTURE8=33992]="TEXTURE8",e[e.TEXTURE9=33993]="TEXTURE9",e[e.TEXTURE10=33994]="TEXTURE10",e[e.TEXTURE11=33995]="TEXTURE11",e[e.TEXTURE12=33996]="TEXTURE12",e[e.TEXTURE13=33997]="TEXTURE13",e[e.TEXTURE14=33998]="TEXTURE14",e[e.TEXTURE15=33999]="TEXTURE15",e[e.TEXTURE16=34e3]="TEXTURE16",e[e.TEXTURE17=34001]="TEXTURE17",e[e.TEXTURE18=34002]="TEXTURE18",e[e.TEXTURE19=34003]="TEXTURE19",e[e.TEXTURE20=34004]="TEXTURE20",e[e.TEXTURE21=34005]="TEXTURE21",e[e.TEXTURE22=34006]="TEXTURE22",e[e.TEXTURE23=34007]="TEXTURE23",e[e.TEXTURE24=34008]="TEXTURE24",e[e.TEXTURE25=34009]="TEXTURE25",e[e.TEXTURE26=34010]="TEXTURE26",e[e.TEXTURE27=34011]="TEXTURE27",e[e.TEXTURE28=34012]="TEXTURE28",e[e.TEXTURE29=34013]="TEXTURE29",e[e.TEXTURE30=34014]="TEXTURE30",e[e.TEXTURE31=34015]="TEXTURE31",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL"})(G||(G={}));var Rs,ca,Wl,ku,Xl,Io,Yl,qs,uh,If,lh,bc,ch;function hp(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Jc(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?hp(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):hp(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var pp=(Rs=(0,Wr.b2)(),ca=(0,Wr.f3)(Ht.IMapService),Wl=(0,Wr.f3)(Ht.IRendererService),ku=(0,Wr.f3)(Ht.IGlobalConfigService),Xl=(0,Wr.f3)(Ht.IInteractionService),Io=(0,Wr.f3)(Ht.ILayerService),Rs(Yl=(qs=function(){function e(){var i=this;(0,ht.Z)(this,e),Ui(this,"mapService",uh,this),Ui(this,"rendererService",If,this),Ui(this,"configService",lh,this),Ui(this,"interactionService",bc,this),Ui(this,"layerService",ch,this),(0,A.Z)(this,"pickingFBO",void 0),(0,A.Z)(this,"width",0),(0,A.Z)(this,"height",0),(0,A.Z)(this,"alreadyInPicking",!1),(0,A.Z)(this,"pickBufferScale",1),(0,A.Z)(this,"pickedLayers",[]),(0,A.Z)(this,"pickFromPickingFBO",function(r,n){var a,s=n.x,f=n.y,v=n.lngLat,g=n.type,x=n.target,C=!1,T=i.rendererService,O=T.getViewportSize,k=T.readPixels,j=T.getContainer,X=i.getContainerSize(j()),te=X.width,be=X.height;te*=na,be*=na;var Ne=r.getLayerConfig(),$e=Ne.enableHighlight,ot=Ne.enableSelect,bt=s*na,_t=f*na;if(bt>te-1*na||bt<0||_t>be-1*na||_t<0)return!1;var qt;if(qt=k({x:Math.floor(bt/i.pickBufferScale),y:Math.floor((be-(f+1)*na)/i.pickBufferScale),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:i.pickingFBO}),qt[0]!==0||qt[1]!==0||qt[2]!==0){var ar=ol(qt),Pr=r.getSource().getFeatureById(ar);ar!==r.getCurrentPickId()&&g==="mousemove"&&(g="mouseenter");var qr={x:s,y:f,type:g,lngLat:v,featureId:ar,feature:Pr,target:x};Pr&&(C=!0,r.setCurrentPickId(ar),i.pickedLayers=[r],i.triggerHoverOnLayer(r,qr))}else{var gr={x:s,y:f,lngLat:v,type:r.getCurrentPickId()!==null&&g==="mousemove"?"mouseout":"un"+g,featureId:null,target:x,feature:null};i.triggerHoverOnLayer(r,Jc(Jc({},gr),{},{type:"unpick"})),i.triggerHoverOnLayer(r,gr),r.setCurrentPickId(null),i.pickedLayers=[]}if($e&&i.highlightPickedFeature(r,qt),ot&&g==="click"&&((a=qt)===null||a===void 0?void 0:a.toString())!==[0,0,0,0].toString()){var un=ol(qt);r.getCurrentSelectedId()===null||un!==r.getCurrentSelectedId()?(i.selectFeature(r,qt),r.setCurrentSelectedId(un)):(i.selectFeature(r,new Uint8Array([0,0,0,0])),r.setCurrentSelectedId(null))}return C})}return(0,Pt.Z)(e,[{key:"init",value:function(r){var n=this.rendererService,a=n.createTexture2D,s=n.createFramebuffer,f=n.getViewportSize,v=n.getContainer,g=this.getContainerSize(v()),x=g.width,C=g.height;x*=na,C*=na,this.pickBufferScale=this.configService.getSceneConfig(r).pickBufferScale||1,this.pickingFBO=s({color:a({width:Math.round(x/this.pickBufferScale),height:Math.round(C/this.pickBufferScale),wrapS:G.CLAMP_TO_EDGE,wrapT:G.CLAMP_TO_EDGE})}),this.interactionService.on(ma.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:function(){var i=(0,P.Z)(N().mark(function n(a,s,f){var v=this,g,x,C,T;return N().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:g=this.rendererService,x=g.useFramebuffer,C=g.clear,T=g.getContainer,this.resizePickingFBO(),x(this.pickingFBO,function(){C({framebuffer:v.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),a.hooks.beforePickingEncode.call(),a.renderModels(),a.hooks.afterPickingEncode.call();var j=v.pickBox(a,s);f(j)});case 3:case"end":return k.stop()}},n,this)}));function r(n,a,s){return i.apply(this,arguments)}return r}()},{key:"pickBox",value:function(r,n){var a=this,s=n.map(function(gr){var un=gr<0?0:gr;return Math.floor(un*na/a.pickBufferScale)}),f=(0,on.Z)(s,4),v=f[0],g=f[1],x=f[2],C=f[3],T=this.rendererService,O=T.getViewportSize,k=T.readPixels,j=T.getContainer,X=this.getContainerSize(j()),te=X.width,be=X.height;if(te*=na,be*=na,v>(te-1)*na/this.pickBufferScale||x<0||g>(be-1)*na/this.pickBufferScale||C<0)return[];var Ne,$e=Math.min(te/this.pickBufferScale,x)-v,ot=Math.min(be/this.pickBufferScale,C)-g;Ne=k({x:v,y:Math.floor(be/this.pickBufferScale-(C+1)),width:$e,height:ot,data:new Uint8Array($e*ot*4),framebuffer:this.pickingFBO});for(var bt=[],_t={},qt=0;qt<Ne.length/4;qt=qt+1){var ar=Ne.slice(qt*4,qt*4+4),Pr=ol(ar);if(Pr!==-1&&!_t[Pr]){var qr=r.getSource().getFeatureById(Pr);bt.push(Jc(Jc({},qr),{},{pickedFeatureIdx:Pr})),_t[Pr]=!0}}return bt}},{key:"handleCursor",value:function(r,n){var a=r.getLayerConfig(),s=a.cursor,f=s===void 0?"":s,v=a.cursorEnabled;if(v){var g=this.mapService.version,x=g==="GAODE2.x"?this.mapService.getMapContainer():this.mapService.getMarkerContainer(),C=x==null?void 0:x.style.getPropertyValue("cursor");n==="unmousemove"&&C!==""?x==null||x.style.setProperty("cursor",""):n==="mousemove"&&(x==null||x.style.setProperty("cursor",f))}}},{key:"destroy",value:function(){this.pickingFBO.destroy(),this.pickingFBO=null}},{key:"getContainerSize",value:function(r){return r.getContext?{width:r.width/na,height:r.height/na}:r.getBoundingClientRect()}},{key:"pickingAllLayer",value:function(){var i=(0,P.Z)(N().mark(function n(a){return N().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(!(this.alreadyInPicking||this.layerService.alreadyInRendering||this.interactionService.indragging||!this.layerService.getShaderPickStat())){f.next=2;break}return f.abrupt("return");case 2:return this.alreadyInPicking=!0,f.next=5,this.pickingLayers(a);case 5:this.layerService.renderLayers(),this.alreadyInPicking=!1;case 7:case"end":return f.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"resizePickingFBO",value:function(){var r=this.rendererService.getContainer,n=this.getContainerSize(r()),a=n.width,s=n.height;a*=na,s*=na,(this.width!==a||this.height!==s)&&(this.pickingFBO.resize({width:Math.round(a/this.pickBufferScale),height:Math.round(s/this.pickBufferScale)}),this.width=a,this.height=s)}},{key:"pickingLayers",value:function(){var i=(0,P.Z)(N().mark(function n(a){var s=this,f,v,g,x,C;return N().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:f=this.rendererService,v=f.getViewportSize,g=f.useFramebuffer,x=f.clear,C=f.getContainer,this.resizePickingFBO(),g(this.pickingFBO,function(){var k=s.layerService.getRenderList();k.filter(function(j){return j.needPick(a.type)}).reverse().some(function(j){x({framebuffer:s.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),j.hooks.beforePickingEncode.call(),j.masks.length>0&&j.masks.map(function(te){te.hooks.beforeRenderData.call(),te.hooks.beforeRender.call(),te.render(),te.hooks.afterRender.call()}),j.renderModels(!0),j.hooks.afterPickingEncode.call(),s.pickedLayers.map(function(te){s.selectFeature(te,new Uint8Array([0,0,0,0]))});var X=s.pickFromPickingFBO(j,a);return s.layerService.pickedLayerId=X?+j.id:-1,X&&!j.getLayerConfig().enablePropagation})});case 3:case"end":return O.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"triggerHoverOnLayer",value:function(r,n){$a(n)&&(this.handleCursor(r,n.type),r.emit(n.type,n))}},{key:"highlightPickedFeature",value:function(r,n){var a=(0,on.Z)(n,3),s=a[0],f=a[1],v=a[2];r.hooks.beforeHighlight.call([s,f,v])}},{key:"selectFeature",value:function(r,n){var a=(0,on.Z)(n,3),s=a[0],f=a[1],v=a[2];r.hooks.beforeSelect.call([s,f,v])}}]),e}(),uh=jn(qs.prototype,"mapService",[ca],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),If=jn(qs.prototype,"rendererService",[Wl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lh=jn(qs.prototype,"configService",[ku],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bc=jn(qs.prototype,"interactionService",[Xl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ch=jn(qs.prototype,"layerService",[Io],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qs))||Yl),Jp=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;(0,ht.Z)(this,e),(0,A.Z)(this,"autoStart",void 0),(0,A.Z)(this,"startTime",0),(0,A.Z)(this,"oldTime",0),(0,A.Z)(this,"running",!1),(0,A.Z)(this,"elapsedTime",0),this.autoStart=i}return(0,Pt.Z)(e,[{key:"start",value:function(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var r=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var n=(typeof performance=="undefined"?Date:performance).now();r=(n-this.oldTime)/1e3,this.oldTime=n,this.elapsedTime+=r}return r}}]),e}(),dp,Ec,Bh,fh,ef,Sc,vp,mp,Nh;function gp(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=ed(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function ed(e,i){if(!!e){if(typeof e=="string")return zh(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return zh(e,i)}}function zh(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var yp=(dp=(0,Wr.b2)(),Ec=(0,Wr.f3)(Ht.IRendererService),Bh=(0,Wr.f3)(Ht.IMapService),fh=(0,Wr.f3)(Ht.IGlobalConfigService),dp(ef=(Sc=function(){function e(){(0,ht.Z)(this,e),(0,A.Z)(this,"pickedLayerId",-1),(0,A.Z)(this,"clock",new Jp),(0,A.Z)(this,"alreadyInRendering",!1),(0,A.Z)(this,"layers",[]),(0,A.Z)(this,"layerList",[]),(0,A.Z)(this,"layerRenderID",void 0),(0,A.Z)(this,"sceneInited",!1),(0,A.Z)(this,"animateInstanceCount",0),(0,A.Z)(this,"shaderPicking",!0),(0,A.Z)(this,"enableRender",!0),Ui(this,"renderService",vp,this),Ui(this,"mapService",mp,this),Ui(this,"configService",Nh,this)}return(0,Pt.Z)(e,[{key:"add",value:function(r){this.sceneInited&&r.init(),this.layers.push(r),this.updateLayerRenderList()}},{key:"addMask",value:function(r){this.sceneInited&&r.init()}},{key:"initLayers",value:function(){this.sceneInited=!0,this.layers.forEach(function(r){r.inited||r.init()}),this.updateLayerRenderList()}},{key:"getSceneInited",value:function(){return this.sceneInited}},{key:"getRenderList",value:function(){return this.layerList}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(r){return this.layers.find(function(n){return n.id===r})}},{key:"getLayerByName",value:function(r){return this.layers.find(function(n){return n.name===r})}},{key:"cleanRemove",value:function(r,n){if(n){var a=n.layerChildren.indexOf(r);a>-1&&n.layerChildren.splice(a,1)}else{var s=this.layers.indexOf(r);s>-1&&this.layers.splice(s,1)}this.updateLayerRenderList(),this.renderLayers()}},{key:"remove",value:function(r,n){if(n){var a=n.layerChildren.indexOf(r);a>-1&&n.layerChildren.splice(a,1)}else{var s=this.layers.indexOf(r);s>-1&&this.layers.splice(s,1)}this.updateLayerRenderList(),r.destroy(),this.renderLayers()}},{key:"removeAllLayers",value:function(){this.destroy()}},{key:"setEnableRender",value:function(r){this.enableRender=r}},{key:"renderLayers",value:function(){var i=(0,P.Z)(N().mark(function n(){var a,s,f;return N().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(!(this.alreadyInRendering||!this.enableRender)){g.next=2;break}return g.abrupt("return");case 2:this.alreadyInRendering=!0,this.clear(),a=gp(this.layerList),g.prev=5,a.s();case 7:if((s=a.n()).done){g.next=21;break}if(f=s.value,f.hooks.beforeRenderData.call(),f.hooks.beforeRender.call(),!f.isLayerGroup&&f.masks.length>0&&(this.renderService.clear({stencil:0,depth:1,framebuffer:null}),f.masks.map(function(x){x.hooks.beforeRenderData.call(),x.hooks.beforeRender.call(),x.render(),x.hooks.afterRender.call()})),!f.getLayerConfig().enableMultiPassRenderer){g.next=17;break}return g.next=15,f.renderMultiPass();case 15:g.next=18;break;case 17:f.render();case 18:f.hooks.afterRender.call();case 19:g.next=7;break;case 21:g.next=26;break;case 23:g.prev=23,g.t0=g.catch(5),a.e(g.t0);case 26:return g.prev=26,a.f(),g.finish(26);case 29:this.alreadyInRendering=!1;case 30:case"end":return g.stop()}},n,this,[[5,23,26,29]])}));function r(){return i.apply(this,arguments)}return r}()},{key:"updateLayerRenderList",value:function(){var r=this;this.layerList=[],this.layers.filter(function(n){return n.inited}).filter(function(n){return n.isVisible()}).sort(function(n,a){return n.zIndex-a.zIndex}).forEach(function(n){n.isLayerGroup?n.layerChildren.filter(function(a){return a.inited}).filter(function(a){return a.isVisible()}).sort(function(a,s){return a.zIndex-s.zIndex}).forEach(function(a){r.layerList.push(a)}):r.layerList.push(n)})}},{key:"destroy",value:function(){this.layers.forEach(function(r){r.destroy()}),this.layers=[],this.layerList=[],this.renderLayers()}},{key:"startAnimate",value:function(){this.animateInstanceCount++==0&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){--this.animateInstanceCount==0&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"enableShaderPick",value:function(){this.shaderPicking=!0}},{key:"disableShaderPick",value:function(){this.shaderPicking=!1}},{key:"getShaderPickStat",value:function(){return this.shaderPicking}},{key:"clear",value:function(){var r=Ji(this.mapService.bgColor);this.renderService.clear({color:r,depth:1,stencil:0,framebuffer:null})}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=kn.requestAnimationFrame(this.runRender.bind(this))}},{key:"stopRender",value:function(){kn.cancelAnimationFrame(this.layerRenderID)}}]),e}(),vp=jn(Sc.prototype,"renderService",[Ec],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mp=jn(Sc.prototype,"mapService",[Bh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nh=jn(Sc.prototype,"configService",[fh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sc))||ef),Cc=U(81253),td=U(14293),$u=U.n(td),rd=function(){function e(i){var r=this;(0,ht.Z)(this,e),(0,A.Z)(this,"name",void 0),(0,A.Z)(this,"type",void 0),(0,A.Z)(this,"scale",void 0),(0,A.Z)(this,"descriptor",void 0),(0,A.Z)(this,"featureBufferLayout",[]),(0,A.Z)(this,"needRescale",!1),(0,A.Z)(this,"needRemapping",!1),(0,A.Z)(this,"needRegenerateVertices",!1),(0,A.Z)(this,"featureRange",{startIndex:0,endIndex:Infinity}),(0,A.Z)(this,"vertexAttribute",void 0),(0,A.Z)(this,"defaultCallback",function(n){if(n.length===0){var a;return((a=r.scale)===null||a===void 0?void 0:a.defaultValues)||[]}return n.map(function(s,f){var v,g=(v=r.scale)===null||v===void 0?void 0:v.scalers[f].func,x=g(s);return x})}),this.setProps(i)}return(0,Pt.Z)(e,[{key:"setProps",value:function(r){Object.assign(this,r)}},{key:"mapping",value:function(r){var n;if((n=this.scale)!==null&&n!==void 0&&n.callback){var a,s=(a=this.scale)===null||a===void 0?void 0:a.callback.apply(a,(0,Ce.Z)(r));if(!$u()(s))return[s]}return this.defaultCallback(r)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),e}(),Uh=["buffer","update","name"],_p=["buffer","update","name"],ql,Zh,hh,nd,id,ad;function Fd(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function jh(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Fd(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Fd(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function _m(e){return new Promise(function(i){return setTimeout(i,e)})}var xp=(ql={},(0,A.Z)(ql,G.FLOAT,4),(0,A.Z)(ql,G.UNSIGNED_BYTE,1),(0,A.Z)(ql,G.UNSIGNED_SHORT,2),ql),No=(Zh=(0,Wr.b2)(),hh=(0,Wr.f3)(Ht.IRendererService),Zh(nd=(id=function(){function e(){(0,ht.Z)(this,e),(0,A.Z)(this,"attributesAndIndices",void 0),Ui(this,"rendererService",ad,this),(0,A.Z)(this,"attributes",[]),(0,A.Z)(this,"triangulation",void 0),(0,A.Z)(this,"featureLayout",{sizePerElement:0,elements:[]})}return(0,Pt.Z)(e,[{key:"registerStyleAttribute",value:function(r){var n=this.getLayerStyleAttribute(r.name||"");return n?n.setProps(r):(n=new rd(r),this.attributes.push(n)),n}},{key:"updateStyleAttribute",value:function(r,n,a){var s=this.getLayerStyleAttribute(r);s||(s=this.registerStyleAttribute(jh(jh({},n),{},{name:r})));var f=n.scale;f&&s&&(s.scale=f,s.needRescale=!0,s.needRemapping=!0,s.needRegenerateVertices=!0,a&&a.featureRange&&(s.featureRange=a.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(r){return this.attributes.find(function(n){return n.name===r})}},{key:"getLayerAttributeScale",value:function(r){var n,a=this.getLayerStyleAttribute(r),s=a==null||(n=a.scale)===null||n===void 0?void 0:n.scalers;return s&&s[0]?s[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(r,n){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=arguments.length>3?arguments[3]:void 0,f=this.attributes.find(function(ot){return ot.name===r});if(f&&f.descriptor){var v=f.descriptor,g=v.update,x=v.buffer,C=v.size,T=C===void 0?0:C,O=xp[x.type||G.FLOAT];if(g){var k=this.featureLayout,j=k.elements,X=k.sizePerElement,te=j.slice(a,s);if(!te.length)return;var be=te[0].offset,Ne=be*T*O,$e=te.map(function(ot,bt){for(var _t=ot.featureIdx,qt=ot.vertices,ar=ot.normals,Pr=qt.length/X,qr=[],gr=0;gr<Pr;gr++){var un=ar?ar.slice(gr*3,gr*3+3):[];qr.push.apply(qr,(0,Ce.Z)(g(n[_t],_t,qt.slice(gr*X,gr*X+X),bt,un)))}return qr}).reduce(function(ot,bt){return ot.push.apply(ot,(0,Ce.Z)(bt)),ot},[]);f.vertexAttribute.updateBuffer({data:$e,offset:Ne})}}}},{key:"createAttributesAndIndices",value:function(r,n,a){var s=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var f=this.attributes.map(function(Ne){return Ne.resetDescriptor(),Ne.descriptor}),v=0,g=[],x=[],C=[],T=3;r.forEach(function(Ne,$e){var ot=s.triangulation(Ne,a),bt=ot.indices,_t=ot.vertices,qt=ot.normals,ar=ot.size,Pr=ot.indexes;bt.forEach(function(Ln){x.push(Ln+v)}),T=ar;var qr=_t.length/ar;s.featureLayout.sizePerElement=T,s.featureLayout.elements.push({featureIdx:$e,vertices:_t,normals:qt,offset:v}),v+=qr;for(var gr=function(Vn){var Fa=(qt==null?void 0:qt.slice(Vn*3,Vn*3+3))||[],Ro=_t.slice(Vn*ar,Vn*ar+ar),Ls=0;Pr&&Pr[Vn]!==void 0&&(Ls=Pr[Vn]),f.forEach(function(au,Vs){if(au&&au.update){var Oc;(Oc=au.buffer.data).push.apply(Oc,(0,Ce.Z)(au.update(Ne,$e,Ro,Vn,Fa,Ls)))}})},un=0;un<qr;un++)gr(un)});var O=this.rendererService,k=O.createAttribute,j=O.createBuffer,X=O.createElements,te={};f.forEach(function(Ne,$e){if(Ne){var ot=Ne.buffer,bt=Ne.update,_t=Ne.name,qt=(0,Cc.Z)(Ne,Uh),ar=k(jh({buffer:j(ot)},qt));te[Ne.name||""]=ar,s.attributes[$e].vertexAttribute=ar}});var be=X({data:x,type:G.UNSIGNED_INT,count:x.length});return this.attributesAndIndices={attributes:te,elements:be},this.attributesAndIndices}},{key:"createAttributes",value:function(r,n){var a=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var s=this.attributes.map(function(k){return k.resetDescriptor(),k.descriptor}),f=0,v=[],g=3;r.forEach(function(k,j){var X=a.triangulation(k),te=X.indices,be=X.vertices,Ne=X.normals,$e=X.size,ot=X.indexes;te.forEach(function(ar){v.push(ar+f)}),g=$e;var bt=be.length/$e;a.featureLayout.sizePerElement=g,a.featureLayout.elements.push({featureIdx:j,vertices:be,normals:Ne,offset:f}),f+=bt;for(var _t=function(Pr){var qr=(Ne==null?void 0:Ne.slice(Pr*3,Pr*3+3))||[],gr=be.slice(Pr*$e,Pr*$e+$e),un=0;ot&&ot[Pr]!==void 0&&(un=ot[Pr]),s.forEach(function(Ln,Vn){if(Ln&&Ln.update){var Fa;(Fa=Ln.buffer.data).push.apply(Fa,(0,Ce.Z)(Ln.update(k,j,gr,Pr,qr,un)))}})},qt=0;qt<bt;qt++)_t(qt)});var x=this.rendererService,C=x.createAttribute,T=x.createBuffer,O={};return s.forEach(function(k,j){if(k){var X=k.buffer,te=k.update,be=k.name,Ne=(0,Cc.Z)(k,_p),$e=C(jh({buffer:T(X)},Ne));O[k.name||""]=$e,a.attributes[j].vertexAttribute=$e}}),{attributes:O}}},{key:"clearAllAttributes",value:function(){var r;this.attributes.forEach(function(n){n.vertexAttribute&&n.vertexAttribute.destroy()}),(r=this.attributesAndIndices)===null||r===void 0||r.elements.destroy(),this.attributes=[]}}]),e}(),ad=jn(id.prototype,"rendererService",[hh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),id))||nd),Ml=U(67709),b0=U.n(Ml),tf,od,Bd,bp,Kl,Ep,Vh,Sp,Cp,sd,Nd,Gh,zd,Ud,Zd,jd,Vd,Qa,Ap,Gd,$l,Tv,Hd,Of,ph,dh,vh,mh,Wd,Xd,Yd,qd,ud;function Kd(e){var i=rf();return function(){var n=(0,Mt.Z)(e),a;if(i){var s=(0,Mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,wr.Z)(this,a)}}function rf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Mv=(tf=(0,Wr.b2)(),od=(0,Wr.f3)(Ht.SceneID),Bd=(0,Wr.f3)(Ht.IIconService),bp=(0,Wr.f3)(Ht.IFontService),Kl=(0,Wr.f3)(Ht.IControlService),Ep=(0,Wr.f3)(Ht.IGlobalConfigService),Vh=(0,Wr.f3)(Ht.IMapService),Sp=(0,Wr.f3)(Ht.ICoordinateSystemService),Cp=(0,Wr.f3)(Ht.IRendererService),sd=(0,Wr.f3)(Ht.ILayerService),Nd=(0,Wr.f3)(Ht.ICameraService),Gh=(0,Wr.f3)(Ht.IInteractionService),zd=(0,Wr.f3)(Ht.IPickingService),Ud=(0,Wr.f3)(Ht.IShaderModuleService),Zd=(0,Wr.f3)(Ht.IMarkerService),jd=(0,Wr.f3)(Ht.IPopupService),tf(Vd=(Qa=function(e){(0,Ir.Z)(r,e);var i=Kd(r);function r(){var n;return(0,ht.Z)(this,r),n=i.call(this),(0,A.Z)((0,ne.Z)(n),"destroyed",!1),(0,A.Z)((0,ne.Z)(n),"loaded",!1),(0,A.Z)((0,ne.Z)(n),"loadFont",!1),(0,A.Z)((0,ne.Z)(n),"fontFamily",""),Ui((0,ne.Z)(n),"id",Ap,(0,ne.Z)(n)),Ui((0,ne.Z)(n),"iconService",Gd,(0,ne.Z)(n)),Ui((0,ne.Z)(n),"fontService",$l,(0,ne.Z)(n)),Ui((0,ne.Z)(n),"controlService",Tv,(0,ne.Z)(n)),Ui((0,ne.Z)(n),"configService",Hd,(0,ne.Z)(n)),Ui((0,ne.Z)(n),"map",Of,(0,ne.Z)(n)),Ui((0,ne.Z)(n),"coordinateSystemService",ph,(0,ne.Z)(n)),Ui((0,ne.Z)(n),"rendererService",dh,(0,ne.Z)(n)),Ui((0,ne.Z)(n),"layerService",vh,(0,ne.Z)(n)),Ui((0,ne.Z)(n),"cameraService",mh,(0,ne.Z)(n)),Ui((0,ne.Z)(n),"interactionService",Wd,(0,ne.Z)(n)),Ui((0,ne.Z)(n),"pickingService",Xd,(0,ne.Z)(n)),Ui((0,ne.Z)(n),"shaderModuleService",Yd,(0,ne.Z)(n)),Ui((0,ne.Z)(n),"markerService",qd,(0,ne.Z)(n)),Ui((0,ne.Z)(n),"popupService",ud,(0,ne.Z)(n)),(0,A.Z)((0,ne.Z)(n),"inited",!1),(0,A.Z)((0,ne.Z)(n),"initPromise",void 0),(0,A.Z)((0,ne.Z)(n),"rendering",!1),(0,A.Z)((0,ne.Z)(n),"$container",void 0),(0,A.Z)((0,ne.Z)(n),"canvas",void 0),(0,A.Z)((0,ne.Z)(n),"markerContainer",void 0),(0,A.Z)((0,ne.Z)(n),"hooks",void 0),(0,A.Z)((0,ne.Z)(n),"handleWindowResized",function(){n.emit("resize"),n.$container&&(n.initContainer(),nl(),n.coordinateSystemService.needRefresh=!0,n.render())}),(0,A.Z)((0,ne.Z)(n),"handleMapCameraChanged",function(a){n.cameraService.update(a),n.render()}),n.hooks={init:new Ef},n}return(0,Pt.Z)(r,[{key:"init",value:function(a){var s=this;this.configService.setSceneConfig(this.id,a),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return s.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,P.Z)(N().mark(function f(){return N().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,new Promise(function(x){s.map.onCameraChanged(function(C){s.cameraService.init(),s.cameraService.update(C),s.map.version!=="GAODE2.x"&&x()}),s.map.version!=="GAODE2.x"?s.map.init():x()});case 2:if(!(s.map.version==="GAODE2.x"&&s.map.initViewPort)){g.next=6;break}return g.next=5,s.map.init();case 5:s.map.initViewPort();case 6:s.map.onCameraChanged(s.handleMapCameraChanged),s.map.addMarkerContainer(),s.markerService.addMarkers(),s.markerService.addMarkerLayers(),s.popupService.initPopup(),s.interactionService.init(),s.interactionService.on(ma.Drag,s.addSceneEvent.bind(s));case 13:case"end":return g.stop()}},f)}))),this.hooks.init.tapPromise("initRenderer",(0,P.Z)(N().mark(function f(){var v,g;return N().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(v=Zs(s.configService.getSceneConfig(s.id).id||""),s.$container=v,!v){C.next=11;break}return s.canvas=lo("canvas","",v),s.setCanvas(),C.next=7,s.rendererService.init(s.canvas,s.configService.getSceneConfig(s.id));case 7:b0()(s.$container,s.handleWindowResized),kn.matchMedia&&((g=kn.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)"))===null||g===void 0||g.addListener(s.handleWindowResized)),C.next=12;break;case 11:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 12:s.pickingService.init(s.id);case 13:case"end":return C.stop()}},f)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"initMiniScene",value:function(a){var s=this;this.configService.setSceneConfig(this.id,a),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return s.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,P.Z)(N().mark(function f(){return N().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,new Promise(function(x){s.map.onCameraChanged(function(C){s.cameraService.init(),s.cameraService.update(C),s.map.version!=="GAODE2.x"&&x()}),s.map.initMiniMap()});case 2:s.map.onCameraChanged(s.handleMapCameraChanged),s.interactionService.init(),s.interactionService.on(ma.Drag,s.addSceneEvent.bind(s));case 5:case"end":return g.stop()}},f)}))),this.hooks.init.tapPromise("initRenderer",(0,P.Z)(N().mark(function f(){var v;return N().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(v=a.canvas,s.$container=v||null,!s.$container){x.next=7;break}return x.next=5,s.rendererService.init(a.canvas,s.configService.getSceneConfig(s.id));case 5:x.next=8;break;case 7:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 8:s.pickingService.init(s.id);case 9:case"end":return x.stop()}},f)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(a){this.layerService.sceneService=this,this.layerService.add(a),this.render()}},{key:"addMask",value:function(a){this.layerService.sceneService=this,this.layerService.addMask(a),this.render()}},{key:"render",value:function(){var n=(0,P.Z)(N().mark(function s(){return N().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(!(this.rendering||this.destroyed)){v.next=2;break}return v.abrupt("return");case 2:if(this.rendering=!0,this.inited){v.next=23;break}return v.next=6,this.initPromise;case 6:if(this.destroyed&&this.destroy(),!(this.loadFont&&document.fonts)){v.next=18;break}return v.prev=8,v.next=11,document.fonts.load("24px ".concat(this.fontFamily),"L7text");case 11:v.next=18;break;case 13:v.prev=13,v.t0=v.catch(8),console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 document.fonts !"),console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 iconfont !"),console.warn(v.t0);case 18:this.layerService.initLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0;case 23:this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this.rendering=!1;case 26:case"end":return v.stop()}},s,this,[[8,13]])}));function a(){return n.apply(this,arguments)}return a}()},{key:"addFontFace",value:function(a,s){this.fontFamily=a;var f=document.createElement("style");f.type="text/css",f.innerText=`
        @font-face{
            font-family: '`.concat(a,`';
            src: url('`).concat(s,`') format('woff2'),
            url('`).concat(s,`') format('woff'),
            url('`).concat(s,`') format('truetype');
        }`),document.getElementsByTagName("head")[0].appendChild(f),this.loadFont=!0}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(a){var s,f=(s=this.$container)===null||s===void 0?void 0:s.getElementsByTagName("canvas")[0];this.render();var v=a==="jpg"?f==null?void 0:f.toDataURL("image/jpeg"):f==null?void 0:f.toDataURL("image/png");return v}},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"getPointSizeRange",value:function(){return this.rendererService.getPointSizeRange()}},{key:"addMarkerContainer",value:function(){var a=this.$container.parentElement;a!==null&&(this.markerContainer=lo("div","l7-marker-container",a))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){var a=this,s,f;if(!this.inited){this.destroyed=!0;return}if(this.emit("destroy"),this.pickingService.destroy(),this.layerService.destroy(),setTimeout(function(){var g;(g=a.$container)===null||g===void 0||g.removeChild(a.canvas),a.canvas=null,a.rendererService.destroy()}),this.map.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.fontService.destroy(),this.iconService.destroy(),(s=this.$container)===null||s===void 0||(f=s.parentNode)===null||f===void 0||f.removeChild(this.$container),this.removeAllListeners(),this.inited=!1,(0,Ml.unbind)(this.$container,this.handleWindowResized),kn.matchMedia){var v;(v=kn.matchMedia("screen and (min-resolution: 2dppx)"))===null||v===void 0||v.removeListener(this.handleWindowResized)}}},{key:"initContainer",value:function(){var a,s,f=na,v=((a=this.$container)===null||a===void 0?void 0:a.clientWidth)||400,g=((s=this.$container)===null||s===void 0?void 0:s.clientHeight)||300,x=this.canvas;x&&(x.width=v*f,x.height=g*f),this.rendererService.viewport({x:0,y:0,width:f*v,height:f*g})}},{key:"setCanvas",value:function(){var a,s,f=na,v=((a=this.$container)===null||a===void 0?void 0:a.clientWidth)||400,g=((s=this.$container)===null||s===void 0?void 0:s.clientHeight)||300,x=this.canvas;x.width=v*f,x.height=g*f,x.style.width="100%",x.style.height="100%"}},{key:"addSceneEvent",value:function(a){this.emit(a.type,a)}}]),r}(Mn.EventEmitter),Ap=jn(Qa.prototype,"id",[od],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gd=jn(Qa.prototype,"iconService",[Bd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$l=jn(Qa.prototype,"fontService",[bp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tv=jn(Qa.prototype,"controlService",[Kl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hd=jn(Qa.prototype,"configService",[Ep],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Of=jn(Qa.prototype,"map",[Vh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ph=jn(Qa.prototype,"coordinateSystemService",[Sp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dh=jn(Qa.prototype,"rendererService",[Cp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vh=jn(Qa.prototype,"layerService",[sd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mh=jn(Qa.prototype,"cameraService",[Nd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wd=jn(Qa.prototype,"interactionService",[Gh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xd=jn(Qa.prototype,"pickingService",[zd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yd=jn(Qa.prototype,"shaderModuleService",[Ud],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qd=jn(Qa.prototype,"markerService",[Zd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ud=jn(Qa.prototype,"popupService",[jd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qa))||Vd),$d=U(44908),ld=U.n($d);function Pv(e){var i=0;switch(e){case"vec2":case"ivec2":i=2;break;case"vec3":case"ivec3":i=3;break;case"vec4":case"ivec4":case"mat2":i=4;break;case"mat3":i=9;break;case"mat4":i=16;break;default:}return i}var Qd=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function Jd(e){var i={};return e=e.replace(Qd,function(r,n,a){var s=a.split(":"),f=s[0].trim(),v="";switch(s.length>1&&(v=s[1].trim()),n){case"bool":v=v==="true";break;case"float":case"int":v=Number(v);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":v?v=v.replace("[","").replace("]","").split(",").reduce(function(g,x){return g.push(Number(x.trim())),g},[]):v=new Array(Pv(n)).fill(0);break;default:}return i[f]=v,"uniform ".concat(n," ").concat(f,`;
`)}),{content:e,uniforms:i}}var ev,cd;function tv(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function nf(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?tv(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):tv(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var rv="#define PI 3.14159265359",fd=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,E0=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,Iv=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}

// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {
//   vec3 lightDir = normalize(light.position - fragPos);
//   // diffuse shading
//   float diff = max(dot(normal, lightDir), 0.0);
//   // specular shading
//   vec3 reflectDir = reflect(-lightDir, normal);
//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);
//   // attenuation
//   float distance = length(light.position - fragPos);
//   float attenuation = 1.0 / (light.constant + light.linear * distance +
//           light.quadratic * (distance * distance));

//   vec3 ambient = light.ambient * u_Ambient;
//   vec3 diffuse = light.diffuse * diff * u_Diffuse;
//   vec3 specular = light.specular * spec * u_Specular;

//   float spotEffect = dot(normalize(light.direction), -lightDir);
//   float spotCosCutoff = cos(light.angle / 180.0 * PI);
//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);
//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);
//   if (spotEffect > spotCosCutoff) {
//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);
//   } else {
//     spotEffect = 0.0;
//   }

//   return ambient + attenuation * (spotEffect * diffuse + specular);
// }

vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {
  //   if (i >= u_NumOfSpotLights) {
  //     break;
  //   }
  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);
  // }
  return weight;
}
`,S0=`varying vec4 v_PickingResult;
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_shaderPick;

uniform float u_activeMix: 0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define HIGHLIGHT 1.0
#define SELECT 2.0

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color, float weight) {
  // float selected = v_PickingResult.a;
  bool selected = bool(v_PickingResult.a);

  // if (selected == SELECT) {
  if (selected) {
  //   // \u70B9\u51FB\u9009\u4E2D\u72B6\u6001
  //   vec4 selectColor = u_SelectColor * COLOR_SCALE;
  //   return selectColor;
  // } else if (selected == HIGHLIGHT) {
  //   // hover \u9AD8\u4EAE\u72B6\u6001
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(mix(resultRGB * weight, color.rgb, u_activeMix), color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, 1.0));
  }
  
}

vec4 filterColorAlpha(vec4 color, float alpha) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, alpha));
  }
}

`,C0=`attribute vec3 a_PickingColor;
varying vec4 v_PickingResult;

uniform vec3 u_PickingColor : [0, 0, 0];
uniform vec3 u_CurrentSelectedId : [0, 0, 0];
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_PickingThreshold : 1.0;
uniform float u_PickingBuffer: 0.0;
uniform float u_shaderPick;
uniform float u_EnableSelect: 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define NORMAL 0.0
#define HIGHLIGHT 1.0
#define SELECT 2.0

bool isVertexPicked(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;
}

// \u5224\u65AD\u5F53\u524D\u70B9\u662F\u5426\u5DF2\u7ECF\u88AB select \u9009\u4E2D
bool isVertexSelected(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_CurrentSelectedId.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_CurrentSelectedId.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_CurrentSelectedId.b) < u_PickingThreshold;
}

void setPickingColor(vec3 pickingColor) {
  if(u_shaderPick < 0.5) {
    return;
  }
  // compares only in highlight stage

  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));

  // if (u_EnableSelect == 1.0 && u_PickingStage == PICKING_HIGHLIGHT && isVertexSelected(pickingColor)) {
  //   // \u9009\u4E2D\u6001
  //   v_PickingResult.a = SELECT;
  // } else if (u_PickingStage == PICKING_HIGHLIGHT && isVertexPicked(pickingColor)) {
  //   // \u9AD8\u4EAE\u6001
  //   v_PickingResult.a = HIGHLIGHT;
  // } else {
  //   v_PickingResult.a = NORMAL;
  // }

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,A0=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // \u7ECF\u7EAC\u5EA6 => \u5E73\u9762\u5750\u6807
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // \u5E73\u9762\u5750\u6807 => \u7ECF\u7EAC\u5EA6
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,w0=`#define TILE_SIZE 512.0
#define PI 3.1415926536
#define WORLD_SCALE TILE_SIZE / (PI * 2.0)

#define COORDINATE_SYSTEM_LNGLAT 1.0        // mapbox
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0 // mapbox offset
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0           // amap
#define COORDINATE_SYSTEM_P20_OFFSET 6.0    // amap offset
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0         // amap2.0

uniform mat4 u_ViewMatrix;
uniform mat4 u_ProjectionMatrix;
uniform mat4 u_ViewProjectionMatrix;
uniform float u_Zoom : 1;
uniform float u_ZoomScale : 1;

uniform float u_CoordinateSystem;
uniform vec2 u_ViewportCenter;
uniform vec4 u_ViewportCenterProjection;
uniform vec3 u_PixelsPerDegree;
uniform vec3 u_PixelsPerDegree2;
uniform vec3 u_PixelsPerMeter;

uniform vec2 u_ViewportSize;
uniform float u_DevicePixelRatio;
uniform float u_FocalDistance;
uniform vec3 u_CameraPosition;

// uniform mat4 u_Mvp;

// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
  float x = lnglat.x;
  return vec2(
    radians(x) + PI,
    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))
  );
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}


// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1., 1.);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01
    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}
// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01
// reverse Y
vec3 reverse_offset_normal(vec3 vector) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {
    return vector * vec3(1.0, -1.0, 1.0);
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return vector;
  }
  return vector;
}

vec4 project_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(vec4(X, Y, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return vec4(
      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),
      project_scale(position.z),
      position.w
    );
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // return vec4(
    //   (position.xy * WORLD_SCALE * u_ZoomScale) * vec2(1., -1.), 
    //   project_scale(position.z), 
    //   position.w);

     return vec4(
      position.xy, 
      project_scale(position.z), 
      position.w);
  }
  return position;

  // TODO: \u74E6\u7247\u5750\u6807\u7CFB & \u5E38\u89C4\u4E16\u754C\u5750\u6807\u7CFB
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}

float project_pixel_allmap(float pixel) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    return pixel * pow(2.0, u_Zoom);
  }
  return pixel;
}

// \u9002\u914D\u7EB9\u7406\u8D34\u56FE\u7684\u7B49\u50CF\u7D20\u5927\u5C0F
float project_pixel_texture(float pixel) {
  // mapbox zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    return pixel * pow(0.5, u_Zoom);
  }

  // amap2 zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }

  // amap zoom > 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return pixel * pow(0.5, u_Zoom);
  }
  
  // amap zoom < 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return pixel * pow(2.0, (20.0 - u_Zoom));
  }
  return pixel * 2.0;
}

// \u5728\u4E0D\u8BBA\u4EC0\u4E48\u5E95\u56FE\u4E0B\u9700\u8981\u7EDF\u4E00\u5904\u7406\u7684\u65F6\u5019\u4F7F\u7528
float project_float_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // mapbox P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}

float project_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}
vec2 project_pixel(vec2 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}
vec3 project_pixel(vec3 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
     pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}


bool isEqual( float a,  float b) {
    return  a< b + 0.001 && a > b - 0.001;
}`,T0=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,M0=`attribute float a_vertexId;

uniform mat4 u_cellTypeLayout;      // \u63CF\u8FF0\u6570\u636E\u7EB9\u7406 cell \u7ED3\u6784\u7684\u77E9\u9635
uniform sampler2D u_dataTexture;    // \u6570\u636E\u7EB9\u7406

bool hasOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 opacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeOpacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeWidth() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeWidth \u7684\u6570\u636E
  return u_cellTypeLayout[1][2] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStroke() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 stroke \u7684\u6570\u636E
  return u_cellTypeLayout[1][3] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasOffsets() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 offsets \u7684\u6570\u636E
  return u_cellTypeLayout[2][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasThetaOffset() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 thetaOffset \u7684\u6570\u636E
  return u_cellTypeLayout[2][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

// \u6839\u636E\u5750\u6807\u4F4D\u7F6E\u5148\u662F\u8BA1\u7B97 uv \uFF0C\u7136\u540E\u6839\u636E uv \u4ECE\u6570\u636E\u7EB9\u7406\u4E2D\u53D6\u503C
float pos2value(vec2 pos, float columnWidth, float rowHeight) {
  float u = (pos.r - 1.0) * columnWidth + columnWidth/2.0;
  float v = 1.0 - ((pos.g - 1.0) * rowHeight + rowHeight/2.0);
  return texture2D(u_dataTexture, vec2(u, v)).r;
}

/*
  currentRow \u5F53\u524D\u884C
  currentColumn \u5F53\u524D\u5217
  columnCount \u6709\u591A\u5C11\u5217
  nextStep \u9700\u8981\u8BA1\u7B97\u5F53\u524D cell \u540E\u7684\u7B2C\u51E0\u4E2A cell \uFF08\u5F53\u524D cell \u5219 nextStep = 0\uFF09
*/
vec2 nextPos(float currentRow, float currentColumn, float columnCount, float nextStep) {
  float nextColumn = currentColumn;
  float nextRow = currentRow;
  if(currentColumn + nextStep <= columnCount){
    nextColumn = currentColumn + nextStep;
  } else {
    nextColumn = mod(currentColumn + nextStep, columnCount); // \u4E0D\u4F1A\u51FA\u73B0\u8DE8\u4E24\u884C
    nextRow = currentRow + 1.0;
  }
  return vec2(nextColumn, nextRow);
}

// \u8BA1\u7B97\u5F53\u524D\u5355\u4E2A cell \u7684\u5927\u5C0F
float calCellCount() { 
  //   u_cellTypeLayout
  //   cal_height, WIDTH, 0.0, 0.0, // rowCount columnCount - \u51E0\u884C\u51E0\u5217
  //   1.0, 1.0, 1.0, 0.0, // opacity strokeOpacity strokeWidth stroke - 1.0 \u8868\u793A\u6709\u6570\u636E\u6620\u5C04\u30010.0 \u8868\u793A\u6CA1\u6709
  //   1.0, 1.0, 0.0, 0.0, // offsets thetaOffset
  //   0.0, 0.0, 0.0, 0.0
  
  return  u_cellTypeLayout[1][0] +        // opacity
          u_cellTypeLayout[1][1] +        // strokeOpacity
          u_cellTypeLayout[1][2] +        // strokeWidth
          u_cellTypeLayout[1][3] * 4.0 +  // stroke
          u_cellTypeLayout[2][0] * 2.0 +  // offsets
          u_cellTypeLayout[2][1];         // thetaOffset
}`,P0=`
// \u8BA1\u7B97 opacity \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasOpacity()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 opacity \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureOpacity, textureOffset + 1.0);
  }
}
`,I0=`
// \u8BA1\u7B97 strokeOpaicty \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeOpacity()) {
    return vec2(u_stroke_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeOpacity, textureOffset + 1.0);
  }
}
`,Ac=`
// \u8BA1\u7B97 strokeWidth \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeWidthAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeWidth()) {
    return vec2(u_stroke_width, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeWidth = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeWidth, textureOffset + 1.0);
  }
}
`,hd=`
// \u8BA1\u7B97 thetaOffset \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calThetaOffsetAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasThetaOffset()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 thetaOffset \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_thetaOffset, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureThetaOffset = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureThetaOffset, textureOffset + 1.0);
  }
}
`,Ov=/precision\s+(high|low|medium)p\s+float/,wp=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,Rv=/#pragma include (["^+"]?["\ "[a-zA-Z_0-9](.*)"]*?)/g,pb=(ev=(0,Wr.b2)(),ev(cd=function(){function e(){(0,ht.Z)(this,e),(0,A.Z)(this,"moduleCache",{}),(0,A.Z)(this,"rawContentCache",{})}return(0,Pt.Z)(e,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:rv,fs:rv}),this.registerModule("decode",{vs:fd,fs:""}),this.registerModule("projection",{vs:w0,fs:""}),this.registerModule("project",{vs:A0,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:T0}),this.registerModule("lighting",{vs:Iv,fs:""}),this.registerModule("light",{vs:E0,fs:""}),this.registerModule("picking",{vs:C0,fs:S0}),this.registerModule("styleMapping",{vs:M0,fs:""}),this.registerModule("styleMappingCalThetaOffset",{vs:hd,fs:""}),this.registerModule("styleMappingCalOpacity",{vs:P0,fs:""}),this.registerModule("styleMappingCalStrokeOpacity",{vs:I0,fs:""}),this.registerModule("styleMappingCalStrokeWidth",{vs:Ac,fs:""})}},{key:"registerModule",value:function(r,n){if(!this.rawContentCache[r]){var a=n.vs,s=n.fs,f=n.uniforms,v=Jd(a),g=v.content,x=v.uniforms,C=Jd(s),T=C.content,O=C.uniforms;this.rawContentCache[r]={fs:T,uniforms:nf(nf(nf({},x),O),f),vs:g}}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(r){var n=this;if(this.moduleCache[r])return this.moduleCache[r];var a=this.rawContentCache[r].vs,s=this.rawContentCache[r].fs,f=this.processModule(a,[],"vs"),v=f.content,g=f.includeList,x=this.processModule(s,[],"fs"),C=x.content,T=x.includeList,O=C,k=ld()(g.concat(T).concat(r)).reduce(function(j,X){return nf(nf({},j),n.rawContentCache[X].uniforms)},{});return Ov.test(C)||(O=wp+C),this.moduleCache[r]={fs:O.trim(),uniforms:k,vs:v.trim()},this.moduleCache[r]}},{key:"processModule",value:function(r,n,a){var s=this,f=r.replace(Rv,function(v,g){var x=g.split(" "),C=x[0].replace(/"/g,"");if(n.indexOf(C)>-1)return"";var T=s.rawContentCache[C][a];n.push(C);var O=s.processModule(T,n,a),k=O.content;return k});return{content:f,includeList:n}}}]),e}())||cd),Lv=U(66213),Hh;(function(e){e.Normal="normal",e.PostProcessing="post-processing"})(Hh||(Hh={}));var xm,bm,kv=(xm=(0,Wr.b2)(),xm(bm=function(){function e(){(0,ht.Z)(this,e),(0,A.Z)(this,"shaderModuleService",void 0),(0,A.Z)(this,"rendererService",void 0),(0,A.Z)(this,"cameraService",void 0),(0,A.Z)(this,"mapService",void 0),(0,A.Z)(this,"interactionService",void 0),(0,A.Z)(this,"layerService",void 0),(0,A.Z)(this,"config",void 0)}return(0,Pt.Z)(e,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return Hh.Normal}},{key:"init",value:function(r,n){this.config=n,this.rendererService=r.getContainer().get(Ht.IRendererService),this.cameraService=r.getContainer().get(Ht.ICameraService),this.mapService=r.getContainer().get(Ht.IMapService),this.interactionService=r.getContainer().get(Ht.IInteractionService),this.layerService=r.getContainer().get(Ht.ILayerService),this.shaderModuleService=r.getContainer().get(Ht.IShaderModuleService)}},{key:"render",value:function(r){}}]),e}())||bm),Em,Sm;function db(e){var i=vb();return function(){var n=(0,Mt.Z)(e),a;if(i){var s=(0,Mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,wr.Z)(this,a)}}function vb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var mb=(Em=(0,Wr.b2)(),Em(Sm=function(e){(0,Ir.Z)(r,e);var i=db(r);function r(){return(0,ht.Z)(this,r),i.apply(this,arguments)}return(0,Pt.Z)(r,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(a,s){(0,Lv.Z)((0,Mt.Z)(r.prototype),"init",this).call(this,a,s)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),r}(kv))||Sm),Cm,Am,wm,O0,Tm;function gb(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=yb(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function yb(e,i){if(!!e){if(typeof e=="string")return Mm(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Mm(e,i)}}function Mm(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var _b=(Cm=(0,Wr.b2)(),Am=(0,Wr.f3)(Ht.IPostProcessor),Cm(wm=(O0=function(){function e(){(0,ht.Z)(this,e),(0,A.Z)(this,"passes",[]),Ui(this,"postProcessor",Tm,this),(0,A.Z)(this,"layer",void 0),(0,A.Z)(this,"renderFlag",void 0),(0,A.Z)(this,"width",0),(0,A.Z)(this,"height",0)}return(0,Pt.Z)(e,[{key:"setLayer",value:function(r){this.layer=r}},{key:"setRenderFlag",value:function(r){this.renderFlag=r}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:function(){var i=(0,P.Z)(N().mark(function n(){var a,s,f;return N().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:a=gb(this.passes),g.prev=1,a.s();case 3:if((s=a.n()).done){g.next=9;break}return f=s.value,g.next=7,f.render(this.layer);case 7:g.next=3;break;case 9:g.next=14;break;case 11:g.prev=11,g.t0=g.catch(1),a.e(g.t0);case 14:return g.prev=14,a.f(),g.finish(14);case 17:return g.next=19,this.postProcessor.render(this.layer);case 19:case"end":return g.stop()}},n,this,[[1,11,14,17]])}));function r(){return i.apply(this,arguments)}return r}()},{key:"resize",value:function(r,n){(this.width!==r||this.height!==n)&&(this.postProcessor.resize(r,n),this.width=r,this.height=n)}},{key:"add",value:function(r,n){r.getType()===Hh.PostProcessing?this.postProcessor.add(r,this.layer,n):(r.init(this.layer,n),this.passes.push(r))}},{key:"insert",value:function(r,n,a){r.init(this.layer,n),this.passes.splice(a,0,r)}},{key:"destroy",value:function(){this.passes.length=0}}]),e}(),Tm=jn(O0.prototype,"postProcessor",[Am],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),O0))||wm),Pm,Im;function Om(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Rm(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Om(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Om(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function xb(e){var i=bb();return function(){var n=(0,Mt.Z)(e),a;if(i){var s=(0,Mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,wr.Z)(this,a)}}function bb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Eb=(Pm=(0,Wr.b2)(),Pm(Im=function(e){(0,Ir.Z)(r,e);var i=xb(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ne.Z)(n),"pickingFBO",void 0),(0,A.Z)((0,ne.Z)(n),"layer",void 0),(0,A.Z)((0,ne.Z)(n),"width",0),(0,A.Z)((0,ne.Z)(n),"height",0),(0,A.Z)((0,ne.Z)(n),"alreadyInRendering",!1),(0,A.Z)((0,ne.Z)(n),"pickFromPickingFBO",function(v){var g=v.x,x=v.y,C=v.lngLat,T=v.type;if(!(!n.layer.isVisible()||!n.layer.needPick(T))){var O=n.rendererService,k=O.getViewportSize,j=O.readPixels,X=O.useFramebuffer,te=k(),be=te.width,Ne=te.height,$e=n.layer.getLayerConfig(),ot=$e.enableHighlight,bt=$e.enableSelect,_t=g*na,qt=x*na;if(!(_t>be||_t<0||qt>Ne||qt<0)){var ar;X(n.pickingFBO,function(){var Pr;if(ar=j({x:Math.round(_t),y:Math.round(Ne-(x+1)*na),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:n.pickingFBO}),ar[0]!==0||ar[1]!==0||ar[2]!==0){var qr=ol(ar),gr=n.layer.getSource().getFeatureById(qr),un={x:g,y:x,type:T,lngLat:C,featureId:qr,feature:gr};gr&&(n.layer.setCurrentPickId(qr),n.triggerHoverOnLayer(un))}else{var Ln={x:g,y:x,lngLat:C,type:n.layer.getCurrentPickId()===null?"un"+T:"mouseout",featureId:null,feature:null};n.triggerHoverOnLayer(Rm(Rm({},Ln),{},{type:"unpick"})),n.triggerHoverOnLayer(Ln),n.layer.setCurrentPickId(null)}ot&&n.highlightPickedFeature(ar),bt&&T==="click"&&((Pr=ar)===null||Pr===void 0?void 0:Pr.toString())!==[0,0,0,0].toString()&&n.selectFeature(ar)})}}}),n}return(0,Pt.Z)(r,[{key:"getType",value:function(){return Hh.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(a,s){(0,Lv.Z)((0,Mt.Z)(r.prototype),"init",this).call(this,a,s),this.layer=a;var f=this.rendererService,v=f.createTexture2D,g=f.createFramebuffer,x=f.getViewportSize,C=x(),T=C.width,O=C.height;this.pickingFBO=g({color:v({width:T,height:O,wrapS:G.CLAMP_TO_EDGE,wrapT:G.CLAMP_TO_EDGE})}),this.interactionService.on(ma.Hover,this.pickFromPickingFBO),this.interactionService.on(ma.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(ma.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(a){var s=this;if(!this.alreadyInRendering){var f=this.rendererService,v=f.getViewportSize,g=f.useFramebuffer,x=f.clear,C=v(),T=C.width,O=C.height;this.alreadyInRendering=!0,(this.width!==T||this.height!==O)&&(this.pickingFBO.resize({width:T,height:O}),this.width=T,this.height=O),g(this.pickingFBO,function(){x({framebuffer:s.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var k=s.layer.multiPassRenderer.getRenderFlag();s.layer.multiPassRenderer.setRenderFlag(!1),a.hooks.beforePickingEncode.call(),a.render(),a.hooks.afterPickingEncode.call(),s.layer.multiPassRenderer.setRenderFlag(k),s.alreadyInRendering=!1})}}},{key:"triggerHoverOnLayer",value:function(a){this.layer.emit(a.type,a)}},{key:"highlightPickedFeature",value:function(a){var s=(0,on.Z)(a,3),f=s[0],v=s[1],g=s[2];this.layer.hooks.beforeHighlight.call([f,v,g]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(a){var s=(0,on.Z)(a,3),f=s[0],v=s[1],g=s[2];this.layer.hooks.beforeSelect.call([f,v,g]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(a){var s=a.featureId,f=hu(s);this.selectFeature(new Uint8Array(f))}},{key:"highlightFeatureHandle",value:function(a){var s=a.featureId,f=hu(s);this.highlightPickedFeature(new Uint8Array(f))}}]),r}(kv))||Im),Sb=U(11700),Cb=U.n(Sb),Ab=U(68929),wb=U.n(Ab),Lm,km,Dm,R0,Fm;function Bm(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function nv(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Bm(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Bm(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Tb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,gh=(Lm=(0,Wr.b2)(),km=(0,Wr.f3)(Ht.IShaderModuleService),Lm(Dm=(R0=function(){function e(){(0,ht.Z)(this,e),Ui(this,"shaderModuleService",Fm,this),(0,A.Z)(this,"rendererService",void 0),(0,A.Z)(this,"config",void 0),(0,A.Z)(this,"quad",Tb),(0,A.Z)(this,"enabled",!0),(0,A.Z)(this,"renderToScreen",!1),(0,A.Z)(this,"model",void 0),(0,A.Z)(this,"name",void 0),(0,A.Z)(this,"optionsToUpdate",{})}return(0,Pt.Z)(e,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(r){this.name=r}},{key:"getType",value:function(){return Hh.PostProcessing}},{key:"init",value:function(r,n){this.config=n,this.rendererService=r.getContainer().get(Ht.IRendererService),this.shaderModuleService=r.getContainer().get(Ht.IShaderModuleService);var a=this.rendererService,s=a.createAttribute,f=a.createBuffer,v=a.createModel,g=this.setupShaders(),x=g.vs,C=g.fs,T=g.uniforms;this.model=v({vs:x,fs:C,attributes:{a_Position:s({buffer:f({data:[-4,-4,4,-4,0,4],type:G.FLOAT}),size:2})},uniforms:nv(nv({u_Texture:null},T),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}},{key:"render",value:function(r,n){var a=this,s=r.multiPassRenderer.getPostProcessor(),f=this.rendererService,v=f.useFramebuffer,g=f.getViewportSize,x=f.clear,C=g(),T=C.width,O=C.height;v(this.renderToScreen?null:s.getWriteFBO(),function(){x({framebuffer:s.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0});var k=nv({u_BloomFinal:0,u_Texture:s.getReadFBO(),u_ViewportSize:[T,O]},a.convertOptionsToUniforms(a.optionsToUpdate));n&&(k.u_BloomFinal=1,k.u_Texture2=n),a.model.draw({uniforms:k})})}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(r){this.enabled=r}},{key:"setRenderToScreen",value:function(r){this.renderToScreen=r}},{key:"updateOptions",value:function(r){this.optionsToUpdate=nv(nv({},this.optionsToUpdate),r)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(r){var n={};return Object.keys(r).forEach(function(a){$u()(r[a])||(n["u_".concat(Cb()(wb()(a)))]=r[a])}),n}}]),e}(),Fm=jn(R0.prototype,"shaderModuleService",[km],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),R0))||Dm),Nm,zm;function Um(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Zm(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Um(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Um(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Mb(e){var i=Pb();return function(){var n=(0,Mt.Z)(e),a;if(i){var s=(0,Mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,wr.Z)(this,a)}}function Pb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ib=`varying vec2 v_UV;

uniform float u_BloomFinal: 0.0;
uniform sampler2D u_Texture;
uniform sampler2D u_Texture2;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_radius: 5.0;
uniform float u_intensity: 0.3;
uniform float u_baseRadio: 0.5;

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

float luminance(vec4 color) {
  return  0.2125 * color.r + 0.7154 * color.g + 0.0721 * color.b;
}

void main() {
  // vec4 baseColor = texture2D(u_Texture, v_UV);

  float r = sqrt(u_radius);

  vec4 c1 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(u_radius, 0.0));
  // c1 *= luminance(c1);
  vec4 c2 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(0.0, u_radius));
  // c2 *= luminance(c2);
  vec4 c3 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, r));
  // c3 *= luminance(c3);
  vec4 c4 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, -r));
  // c4 *= luminance(c4);
  vec4 inbloomColor = (c1 + c2 + c3 + c4) * 0.25;

  // float lum = luminance(inbloomColor);
  // inbloomColor.rgb *= lum;

  if(u_BloomFinal > 0.0) {
    vec4 baseColor = texture2D(u_Texture2, v_UV);
    float baselum = luminance(baseColor);
    gl_FragColor = mix(inbloomColor, baseColor, u_baseRadio);
    if(baselum <= 0.2) {
      gl_FragColor = inbloomColor * u_intensity;
    }
  } else {
    gl_FragColor = inbloomColor;
  }
}`,Ob=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Rb=(Nm=(0,Wr.b2)(),Nm(zm=function(e){(0,Ir.Z)(r,e);var i=Mb(r);function r(){return(0,ht.Z)(this,r),i.apply(this,arguments)}return(0,Pt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:Ob,fs:Ib});var a=this.shaderModuleService.getModule("blur-pass"),s=a.vs,f=a.fs,v=a.uniforms,g=this.rendererService.getViewportSize(),x=g.width,C=g.height;return{vs:s,fs:f,uniforms:Zm(Zm({},v),{},{u_ViewportSize:[x,C]})}}},{key:"convertOptionsToUniforms",value:function(a){var s={};return $u()(a.bloomRadius)||(s.u_radius=a.bloomRadius),$u()(a.bloomIntensity)||(s.u_intensity=a.bloomIntensity),$u()(a.bloomBaseRadio)||(s.u_baseRadio=a.bloomBaseRadio),s}}]),r}(gh))||zm),jm,Vm;function Gm(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Hm(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Gm(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Gm(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Lb(e){var i=kb();return function(){var n=(0,Mt.Z)(e),a;if(i){var s=(0,Mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,wr.Z)(this,a)}}function kb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Db=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,Fb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Bb=(jm=(0,Wr.b2)(),jm(Vm=function(e){(0,Ir.Z)(r,e);var i=Lb(r);function r(){return(0,ht.Z)(this,r),i.apply(this,arguments)}return(0,Pt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:Fb,fs:Db});var a=this.shaderModuleService.getModule("blur-pass"),s=a.vs,f=a.fs,v=a.uniforms,g=this.rendererService.getViewportSize(),x=g.width,C=g.height;return{vs:s,fs:f,uniforms:Hm(Hm({},v),{},{u_ViewportSize:[x,C]})}}},{key:"convertOptionsToUniforms",value:function(a){var s={};return $u()(a.blurRadius)||(s.u_BlurDir=[a.blurRadius,0]),s}}]),r}(gh))||Vm),Wm,Xm;function Ym(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function qm(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Ym(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ym(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Nb(e){var i=zb();return function(){var n=(0,Mt.Z)(e),a;if(i){var s=(0,Mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,wr.Z)(this,a)}}function zb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ub=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,Zb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,jb=(Wm=(0,Wr.b2)(),Wm(Xm=function(e){(0,Ir.Z)(r,e);var i=Nb(r);function r(){return(0,ht.Z)(this,r),i.apply(this,arguments)}return(0,Pt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:Zb,fs:Ub});var a=this.shaderModuleService.getModule("blur-pass"),s=a.vs,f=a.fs,v=a.uniforms,g=this.rendererService.getViewportSize(),x=g.width,C=g.height;return{vs:s,fs:f,uniforms:qm(qm({},v),{},{u_ViewportSize:[x,C]})}}},{key:"convertOptionsToUniforms",value:function(a){var s={};return $u()(a.blurRadius)||(s.u_BlurDir=[0,a.blurRadius]),s}}]),r}(gh))||Xm),Km,$m;function Qm(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Jm(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Qm(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Qm(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Vb(e){var i=Gb();return function(){var n=(0,Mt.Z)(e),a;if(i){var s=(0,Mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,wr.Z)(this,a)}}function Gb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Hb=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,Wb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Xb=(Km=(0,Wr.b2)(),Km($m=function(e){(0,Ir.Z)(r,e);var i=Vb(r);function r(){return(0,ht.Z)(this,r),i.apply(this,arguments)}return(0,Pt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:Wb,fs:Hb});var a=this.shaderModuleService.getModule("colorhalftone-pass"),s=a.vs,f=a.fs,v=a.uniforms,g=this.rendererService.getViewportSize(),x=g.width,C=g.height;return{vs:s,fs:f,uniforms:Jm(Jm({},v),{},{u_ViewportSize:[x,C]})}}}]),r}(gh))||$m),eg,tg;function Yb(e){var i=qb();return function(){var n=(0,Mt.Z)(e),a;if(i){var s=(0,Mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,wr.Z)(this,a)}}function qb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Kb=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,$b=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Qb=(eg=(0,Wr.b2)(),eg(tg=function(e){(0,Ir.Z)(r,e);var i=Yb(r);function r(){return(0,ht.Z)(this,r),i.apply(this,arguments)}return(0,Pt.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:$b,fs:Kb}),this.shaderModuleService.getModule("copy-pass")}}]),r}(gh))||tg),rg,ng;function ig(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function ag(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?ig(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ig(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Jb(e){var i=e2();return function(){var n=(0,Mt.Z)(e),a;if(i){var s=(0,Mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,wr.Z)(this,a)}}function e2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var t2=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,r2=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,n2=(rg=(0,Wr.b2)(),rg(ng=function(e){(0,Ir.Z)(r,e);var i=Jb(r);function r(){return(0,ht.Z)(this,r),i.apply(this,arguments)}return(0,Pt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:r2,fs:t2});var a=this.shaderModuleService.getModule("hexagonalpixelate-pass"),s=a.vs,f=a.fs,v=a.uniforms,g=this.rendererService.getViewportSize(),x=g.width,C=g.height;return{vs:s,fs:f,uniforms:ag(ag({},v),{},{u_ViewportSize:[x,C]})}}}]),r}(gh))||ng),og,sg;function ug(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function lg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?ug(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ug(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function i2(e){var i=a2();return function(){var n=(0,Mt.Z)(e),a;if(i){var s=(0,Mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,wr.Z)(this,a)}}function a2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var o2=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,s2=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,u2=(og=(0,Wr.b2)(),og(sg=function(e){(0,Ir.Z)(r,e);var i=i2(r);function r(){return(0,ht.Z)(this,r),i.apply(this,arguments)}return(0,Pt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:s2,fs:o2});var a=this.shaderModuleService.getModule("ink-pass"),s=a.vs,f=a.fs,v=a.uniforms,g=this.rendererService.getViewportSize(),x=g.width,C=g.height;return{vs:s,fs:f,uniforms:lg(lg({},v),{},{u_ViewportSize:[x,C]})}}}]),r}(gh))||sg),cg,fg;function l2(e){var i=c2();return function(){var n=(0,Mt.Z)(e),a;if(i){var s=(0,Mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,wr.Z)(this,a)}}function c2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var f2=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,h2=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,p2=(cg=(0,Wr.b2)(),cg(fg=function(e){(0,Ir.Z)(r,e);var i=l2(r);function r(){return(0,ht.Z)(this,r),i.apply(this,arguments)}return(0,Pt.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:h2,fs:f2}),this.shaderModuleService.getModule("noise-pass")}}]),r}(gh))||fg),hg,pg;function d2(e){var i=v2();return function(){var n=(0,Mt.Z)(e),a;if(i){var s=(0,Mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,wr.Z)(this,a)}}function v2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var m2=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,g2=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`,y2=(hg=(0,Wr.b2)(),hg(pg=function(e){(0,Ir.Z)(r,e);var i=d2(r);function r(){return(0,ht.Z)(this,r),i.apply(this,arguments)}return(0,Pt.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:m2,fs:g2}),this.shaderModuleService.getModule("sepia-pass")}}]),r}(gh))||pg),dg,vg,mg,gg,pd,yg,_2=(dg=(0,Wr.b2)(),vg=(0,Wr.f3)(Ht.IRendererService),mg=(0,Wr.zY)(),dg(gg=(pd=function(){function e(){(0,ht.Z)(this,e),Ui(this,"rendererService",yg,this),(0,A.Z)(this,"passes",[]),(0,A.Z)(this,"readFBO",void 0),(0,A.Z)(this,"writeFBO",void 0)}return(0,Pt.Z)(e,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"getCurrentFBOTex",value:function(){var r=this.rendererService,n=r.getViewportSize,a=r.createTexture2D,s=n(),f=s.width,v=s.height;return a({x:0,y:0,width:f,height:v,copy:!0})}},{key:"getReadFBOTex",value:function(){var r=this,n=this.rendererService.useFramebuffer;return new Promise(function(a,s){n(r.readFBO,(0,P.Z)(N().mark(function f(){return N().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:a(r.getCurrentFBOTex());case 1:case"end":return g.stop()}},f)})))})}},{key:"renderBloomPass",value:function(){var i=(0,P.Z)(N().mark(function n(a,s){var f,v;return N().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.next=2,this.getReadFBOTex();case 2:f=x.sent,v=0;case 4:if(!(v<4)){x.next=11;break}return x.next=7,s.render(a,f);case 7:this.swap(),v++,x.next=4;break;case 11:case"end":return x.stop()}},n,this)}));function r(n,a){return i.apply(this,arguments)}return r}()},{key:"render",value:function(){var i=(0,P.Z)(N().mark(function n(a){var s,f;return N().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:s=0;case 1:if(!(s<this.passes.length)){g.next=15;break}if(f=this.passes[s],f.setRenderToScreen(this.isLastEnabledPass(s)),f.getName()!=="bloom"){g.next=9;break}return g.next=7,this.renderBloomPass(a,f);case 7:g.next=12;break;case 9:return g.next=11,f.render(a);case 11:s!==this.passes.length-1&&this.swap();case 12:s++,g.next=1;break;case 15:case"end":return g.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"resize",value:function(r,n){this.readFBO.resize({width:r,height:n}),this.writeFBO.resize({width:r,height:n})}},{key:"add",value:function(r,n,a){r.init(n,a),this.passes.push(r)}},{key:"insert",value:function(r,n,a,s){r.init(a,s),this.passes.splice(n,0,r)}},{key:"getPostProcessingPassByName",value:function(r){return this.passes.find(function(n){return n.getName()===r})}},{key:"init",value:function(){var r=this.rendererService,n=r.createFramebuffer,a=r.createTexture2D;this.readFBO=n({color:a({width:1,height:1,wrapS:G.CLAMP_TO_EDGE,wrapT:G.CLAMP_TO_EDGE})}),this.writeFBO=n({color:a({width:1,height:1,wrapS:G.CLAMP_TO_EDGE,wrapT:G.CLAMP_TO_EDGE})})}},{key:"isLastEnabledPass",value:function(r){for(var n=r+1;n<this.passes.length;n++)if(this.passes[n].isEnabled())return!1;return!0}},{key:"swap",value:function(){var r=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=r}}]),e}(),yg=jn(pd.prototype,"rendererService",[vg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jn(pd.prototype,"init",[mg],Object.getOwnPropertyDescriptor(pd.prototype,"init"),pd.prototype),pd))||gg),_g,xg;function x2(e){var i=b2();return function(){var n=(0,Mt.Z)(e),a;if(i){var s=(0,Mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,wr.Z)(this,a)}}function b2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var E2=(_g=(0,Wr.b2)(),_g(xg=function(e){(0,Ir.Z)(r,e);var i=x2(r);function r(){return(0,ht.Z)(this,r),i.apply(this,arguments)}return(0,Pt.Z)(r,[{key:"getType",value:function(){return Hh.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(a,s){(0,Lv.Z)((0,Mt.Z)(r.prototype),"init",this).call(this,a,s)}},{key:"render",value:function(a){var s=this.rendererService,f=s.useFramebuffer,v=s.clear,g=a.multiPassRenderer.getPostProcessor().getReadFBO();f(g,function(){v({color:[0,0,0,0],depth:1,stencil:0,framebuffer:g}),a.multiPassRenderer.setRenderFlag(!1),a.models.forEach(function(x){x.draw({uniforms:a.layerModel.getUninforms()})}),a.multiPassRenderer.setRenderFlag(!0)})}}]),r}(kv))||xg),bg,Eg,Sg,L0,Cg;function Ag(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function wg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Ag(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ag(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function S2(e){var i=C2();return function(){var n=(0,Mt.Z)(e),a;if(i){var s=(0,Mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,wr.Z)(this,a)}}function C2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var A2=`uniform float u_opacity : 1.0;
uniform float u_MixRatio : 0.5;

uniform sampler2D u_Diffuse1;
uniform sampler2D u_Diffuse2;

varying vec2 v_UV;

void main() {
  vec4 texel1 = texture2D(u_Diffuse1, v_UV);
  vec4 texel2 = texture2D(u_Diffuse2, v_UV);
  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);
}
`,Tg=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,w2=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;function Mg(e,i){for(var r=0,n=1/i,a=e;a>0;)r=r+n*(a%i),a=Math.floor(a/i),n=n/i;return r}var T2=1,M2=(bg=(0,Wr.b2)(),Eg=(0,Wr.f3)(Ht.IShaderModuleService),bg(Sg=(L0=function(e){(0,Ir.Z)(r,e);var i=S2(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),Ui((0,ne.Z)(n),"shaderModuleService",Cg,(0,ne.Z)(n)),(0,A.Z)((0,ne.Z)(n),"haltonSequence",[]),(0,A.Z)((0,ne.Z)(n),"accumulatingId",0),(0,A.Z)((0,ne.Z)(n),"frame",0),(0,A.Z)((0,ne.Z)(n),"timer",void 0),(0,A.Z)((0,ne.Z)(n),"sampleRenderTarget",void 0),(0,A.Z)((0,ne.Z)(n),"prevRenderTarget",void 0),(0,A.Z)((0,ne.Z)(n),"outputRenderTarget",void 0),(0,A.Z)((0,ne.Z)(n),"copyRenderTarget",void 0),(0,A.Z)((0,ne.Z)(n),"blendModel",void 0),(0,A.Z)((0,ne.Z)(n),"outputModel",void 0),(0,A.Z)((0,ne.Z)(n),"copyModel",void 0),n}return(0,Pt.Z)(r,[{key:"getType",value:function(){return Hh.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(a,s){(0,Lv.Z)((0,Mt.Z)(r.prototype),"init",this).call(this,a,s);var f=this.rendererService,v=f.createFramebuffer,g=f.createTexture2D;this.sampleRenderTarget=v({color:g({width:1,height:1,wrapS:G.CLAMP_TO_EDGE,wrapT:G.CLAMP_TO_EDGE})}),this.prevRenderTarget=v({color:g({width:1,height:1,wrapS:G.CLAMP_TO_EDGE,wrapT:G.CLAMP_TO_EDGE})}),this.outputRenderTarget=v({color:g({width:1,height:1,wrapS:G.CLAMP_TO_EDGE,wrapT:G.CLAMP_TO_EDGE})}),this.copyRenderTarget=v({color:g({width:1,height:1,wrapS:G.CLAMP_TO_EDGE,wrapT:G.CLAMP_TO_EDGE})});for(var x=0;x<30;x++)this.haltonSequence.push([Mg(x,2),Mg(x,3)]);this.blendModel=this.createTriangleModel("blend-pass",A2),this.outputModel=this.createTriangleModel("copy-pass",Tg,{blend:{enable:!0,func:{srcRGB:G.ONE,dstRGB:G.ONE_MINUS_SRC_ALPHA,srcAlpha:G.ONE,dstAlpha:G.ONE_MINUS_SRC_ALPHA},equation:{rgb:G.FUNC_ADD,alpha:G.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",Tg)}},{key:"render",value:function(a){var s=this,f=this.rendererService,v=f.clear,g=f.getViewportSize,x=f.useFramebuffer,C=g(),T=C.width,O=C.height;this.sampleRenderTarget.resize({width:T,height:O}),this.prevRenderTarget.resize({width:T,height:O}),this.outputRenderTarget.resize({width:T,height:O}),this.copyRenderTarget.resize({width:T,height:O}),this.resetFrame(),this.stopAccumulating();var k=a.multiPassRenderer.getPostProcessor().getReadFBO();x(k,function(){v({color:[0,0,0,0],depth:1,stencil:0,framebuffer:k}),a.multiPassRenderer.setRenderFlag(!1),a.render(),a.multiPassRenderer.setRenderFlag(!0)});var j=function X(te){!s.accumulatingId||te!==s.accumulatingId||s.isFinished()||(s.doRender(a),kn.requestAnimationFrame(function(){X(te)}))};this.accumulatingId=T2++,this.timer=kn.setTimeout(function(){j(s.accumulatingId)},50)}},{key:"doRender",value:function(a){var s=this,f=this.rendererService,v=f.clear,g=f.getViewportSize,x=f.useFramebuffer,C=g(),T=C.width,O=C.height,k=a.getLayerConfig(),j=k.jitterScale,X=j===void 0?1:j,te=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((te[0]*2-1)/T*X,(te[1]*2-1)/O*X),a.multiPassRenderer.setRenderFlag(!1),a.hooks.beforeRender.call(),x(this.sampleRenderTarget,function(){v({color:[0,0,0,0],depth:1,stencil:0,framebuffer:s.sampleRenderTarget}),a.render()}),a.hooks.afterRender.call(),a.multiPassRenderer.setRenderFlag(!0);var be=a.getLayerConfig();x(this.outputRenderTarget,function(){s.blendModel.draw({uniforms:{u_opacity:be.opacity||1,u_MixRatio:s.frame===0?1:.9,u_Diffuse1:s.sampleRenderTarget,u_Diffuse2:s.frame===0?a.multiPassRenderer.getPostProcessor().getReadFBO():s.prevRenderTarget}})}),this.frame===0&&v({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(x(this.copyRenderTarget,function(){s.outputModel.draw({uniforms:{u_Texture:s.outputRenderTarget}})}),x(a.multiPassRenderer.getPostProcessor().getReadFBO(),function(){s.copyModel.draw({uniforms:{u_Texture:s.copyRenderTarget}})}),a.multiPassRenderer.getPostProcessor().render(a));var Ne=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=Ne,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,kn.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(a,s,f){this.shaderModuleService.registerModule(a,{vs:w2,fs:s});var v=this.shaderModuleService.getModule(a),g=v.vs,x=v.fs,C=v.uniforms,T=this.rendererService,O=T.createAttribute,k=T.createBuffer,j=T.createModel;return j(wg({vs:g,fs:x,attributes:{a_Position:O({buffer:k({data:[-4,-4,4,-4,0,4],type:G.FLOAT}),size:2})},uniforms:wg({},C),depth:{enable:!1},count:3},f))}}]),r}(kv),Cg=jn(L0.prototype,"shaderModuleService",[Eg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),L0))||Sg),iv=new Wr.W2;iv.bind(Ht.IGlobalConfigService).to(oh).inSingletonScope(),(0,Wr.GW)((0,Wr.b2)(),Mn.EventEmitter),iv.bind(Ht.IEventEmitter).to(Mn.EventEmitter);var Pg=(0,op.Z)(iv,!1),k0=function(i){var r=Pg.lazyInject(i);return function(n,a,s){r.call(this,n,a),s&&(s.initializer=function(){return n[a]})}},TP=function(i){var r=Pg.lazyMultiInject(i);return function(n,a,s){r.call(this,n,a),s&&(s.initializer=function(){return n[a]})}},Ql=iv,P2=0;function I2(){var e=new Wr.W2;return e.parent=iv,e.bind(Ht.SceneID).toConstantValue("".concat(P2++)),e.bind(Ht.IShaderModuleService).to(pb).inSingletonScope(),e.bind(Ht.ILayerService).to(yp).inSingletonScope(),e.bind(Ht.ISceneService).to(Mv).inSingletonScope(),e.bind(Ht.ICameraService).to(Ct).inSingletonScope(),e.bind(Ht.ICoordinateSystemService).to(ao).inSingletonScope(),e.bind(Ht.IInteractionService).to(ia).inSingletonScope(),e.bind(Ht.IPickingService).to(pp).inSingletonScope(),e.bind(Ht.IControlService).to(An).inSingletonScope(),e.bind(Ht.IMarkerService).to(bn).inSingletonScope(),e.bind(Ht.IIconService).to(cr).inSingletonScope(),e.bind(Ht.IFontService).to(Rr).inSingletonScope(),e.bind(Ht.IPopupService).to(_a).inSingletonScope(),e.bind(Ht.INormalPass).to(mb).whenTargetNamed("clear"),e.bind(Ht.INormalPass).to(Eb).whenTargetNamed("pixelPicking"),e.bind(Ht.INormalPass).to(E2).whenTargetNamed("render"),e.bind(Ht.INormalPass).to(M2).whenTargetNamed("taa"),e.bind(Ht.IFactoryNormalPass).toFactory(function(i){return function(r){return i.container.getNamed(Ht.INormalPass,r)}}),e.bind(Ht.IPostProcessingPass).to(Qb).whenTargetNamed("copy"),e.bind(Ht.IPostProcessingPass).to(Rb).whenTargetNamed("bloom"),e.bind(Ht.IPostProcessingPass).to(Bb).whenTargetNamed("blurH"),e.bind(Ht.IPostProcessingPass).to(jb).whenTargetNamed("blurV"),e.bind(Ht.IPostProcessingPass).to(p2).whenTargetNamed("noise"),e.bind(Ht.IPostProcessingPass).to(y2).whenTargetNamed("sepia"),e.bind(Ht.IPostProcessingPass).to(Xb).whenTargetNamed("colorHalftone"),e.bind(Ht.IPostProcessingPass).to(n2).whenTargetNamed("hexagonalPixelate"),e.bind(Ht.IPostProcessingPass).to(u2).whenTargetNamed("ink"),e.bind(Ht.IFactoryPostProcessingPass).toFactory(function(i){return function(r){var n=i.container.getNamed(Ht.IPostProcessingPass,r);return n.setName(r),n}}),e}function av(e){var i=new Wr.W2;return i.parent=e,i.bind(Ht.IStyleAttributeService).to(No).inSingletonScope(),i.bind(Ht.IMultiPassRenderer).to(_b).inSingletonScope(),i.bind(Ht.IPostProcessor).to(_2).inSingletonScope(),i}var MP=U(74691),O2=null;function PP(e){return O2.indexOf(e)}var R2=2,IP=4,L2=64,OP=128,k2=256,D2=512,RP=8192,LP=16384,kP=32768,F2=null,Ig=131072,DP=262144,B2=524288,FP=1048576,N2=2097152,BP=4194304,z2=8388608,U2=16777216,Z2=null;function Dv(e,i){return e=_clamp(Math.floor(e),0,255),i=_clamp(Math.floor(i),0,255),256*e+i}function NP(e){var i=e.color,r=e.radius,n=e.tileX,a=e.tileY,s=e.shape,f=e.opacity,v=e.stroke,g=e.strokeWidth,x=e.strokeOpacity,C=[],T=[],O=[],k=[Dv(i[0],i[1]),Dv(i[2],i[3])],j=[Dv(v[0],v[1]),Dv(v[2],v[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(function(X){var te=_slicedToArray(X,2),be=te[0],Ne=te[1];C.push([].concat(k,[(be+1)*z2+(Ne+1)*N2+getShapeIndex(s)*Ig+r,(n+512)*B2+(a+512)*L2])),T.push([].concat(j,[g,x])),O.push([f,0,0,0])}),{packedBuffer:C,packedBuffer2:T,packedBuffer3:O}}function zP(e,i){if(e===0&&!i)return 0;if(e===1&&i)return 4294967295;var r=i?1:0,n=Math.floor(e*127);return n*Z2+r*U2+n*Ig+r*F2+n*D2+r*k2+n*R2+r}var wc;(function(e){e.normal="normal",e.additive="additive",e.subtractive="subtractive",e.min="min",e.max="max",e.none="none"})(wc||(wc={}));var Oo;(function(e){e.LINEAR="linear",e.SEQUENTIAL="sequential",e.POWER="power",e.LOG="log",e.IDENTITY="identity",e.TIME="time",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.CAT="cat",e.DIVERGING="diverging"})(Oo||(Oo={}));var Wh;(function(e){e.CONSTANT="constant",e.VARIABLE="variable"})(Wh||(Wh={}));var On;(function(e){e[e.Attribute=0]="Attribute",e[e.InstancedAttribute=1]="InstancedAttribute",e[e.Uniform=2]="Uniform"})(On||(On={}));var j2=["mapload","mapchange","mapAfterFrameChange"],Tp={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"},D0=["loaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"],Xh;(function(e){e.TOPRIGHT="topright",e.TOPLEFT="topleft",e.BOTTOMRIGHT="bottomright",e.BOTTOMLEFT="bottomleft",e.TOPCENTER="topcenter",e.BOTTOMCENTER="bottomcenter",e.LEFTCENTER="leftcenter",e.RIGHTCENTER="rightcenter"})(Xh||(Xh={}));function Og(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Rg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Og(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Og(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function V2(e){var i=G2();return function(){var n=(0,Mt.Z)(e),a;if(i){var s=(0,Mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,wr.Z)(this,a)}}function G2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var H2=0,Fv=function(e){(0,Ir.Z)(r,e);var i=V2(r);function r(n){var a;return(0,ht.Z)(this,r),a=i.call(this),(0,A.Z)((0,ne.Z)(a),"controlOption",void 0),(0,A.Z)((0,ne.Z)(a),"container",void 0),(0,A.Z)((0,ne.Z)(a),"sceneContainer",void 0),(0,A.Z)((0,ne.Z)(a),"mapsService",void 0),(0,A.Z)((0,ne.Z)(a),"renderService",void 0),(0,A.Z)((0,ne.Z)(a),"layerService",void 0),(0,A.Z)((0,ne.Z)(a),"controlService",void 0),(0,A.Z)((0,ne.Z)(a),"isShow",void 0),a.controlOption=Rg(Rg({},a.getDefault()),n||{}),a}return(0,Pt.Z)(r,[{key:"getDefault",value:function(){return{position:Xh.TOPRIGHT,name:"".concat(H2++)}}},{key:"setPosition",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Xh.BOTTOMRIGHT,s=this.controlService;return s&&s.removeControl(this),this.controlOption.position=a,s&&s.addControl(this,this.sceneContainer),this}},{key:"addTo",value:function(a){this.mapsService=a.get(Ht.IMapService),this.renderService=a.get(Ht.IRendererService),this.layerService=a.get(Ht.ILayerService),this.controlService=a.get(Ht.IControlService),this.sceneContainer=a,this.isShow=!0,this.container=this.onAdd();var s=this.container,f=this.controlOption.position,v=this.controlService.controlCorners[f];return Su(s,"l7-control"),f.indexOf("bottom")!==-1?v.insertBefore(s,v.firstChild):v.appendChild(s),this}},{key:"onAdd",value:function(){throw new Error("Method not implemented.")}},{key:"onRemove",value:function(){throw new Error("Method not implemented.")}},{key:"hide",value:function(){var a=this.container;Su(a,"l7-control-hide"),this.isShow=!1}},{key:"show",value:function(){var a=this.container;tu(a,"l7-control-hide"),this.isShow=!0}},{key:"remove",value:function(){if(!this.mapsService)return this;ju(this.container),this.onRemove()}},{key:"_refocusOnMap",value:function(a){if(this.mapsService&&a&&a.screenX>0&&a.screenY>0){var s=this.mapsService.getContainer();s!==null&&s.focus()}}}]),r}(Mn.EventEmitter);function W2(e){var i=X2();return function(){var n=(0,Mt.Z)(e),a;if(i){var s=(0,Mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,wr.Z)(this,a)}}function X2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var UP=function(e){(0,Ir.Z)(r,e);var i=W2(r);function r(n){var a;return(0,ht.Z)(this,r),a=i.call(this,n),(0,A.Z)((0,ne.Z)(a),"layerControlInputs",void 0),(0,A.Z)((0,ne.Z)(a),"layers",void 0),(0,A.Z)((0,ne.Z)(a),"lastZIndex",void 0),(0,A.Z)((0,ne.Z)(a),"handlingClick",void 0),(0,A.Z)((0,ne.Z)(a),"layersLink",void 0),(0,A.Z)((0,ne.Z)(a),"baseLayersList",void 0),(0,A.Z)((0,ne.Z)(a),"separator",void 0),(0,A.Z)((0,ne.Z)(a),"overlaysList",void 0),(0,A.Z)((0,ne.Z)(a),"form",void 0),a.layerControlInputs=[],a.layers=[],a.lastZIndex=0,a.handlingClick=!1,a.initLayers(),Iu(["checkDisabledLayers","onLayerChange","collapse","extend","expand","onInputClick"],(0,ne.Z)(a)),a}return(0,Pt.Z)(r,[{key:"getDefault",value:function(){return{collapsed:!0,position:Xh.TOPRIGHT,autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,name:"layers"}}},{key:"onAdd",value:function(){var a=this;return this.initLayout(),this.update(),this.mapsService.on("zoomend",this.checkDisabledLayers),this.layers.forEach(function(s){s.layer.on("remove",a.onLayerChange),s.layer.on("add",a.onLayerChange)}),this.container}},{key:"addVisualLayer",value:function(a,s){return this.addLayer(a,s,!0),this.mapsService?this.update():this}},{key:"expand",value:function(){var a=this.renderService.getViewportSize(),s=a.height;Su(this.container,"l7-control-layers-expanded"),this.form.style.height="null";var f=s-(this.container.offsetTop+50);return f<this.form.clientHeight?(Su(this.form,"l7-control-layers-scrollbar"),this.form.style.height=f+"px"):tu(this.form,"l7-control-layers-scrollbar"),this.checkDisabledLayers(),this}},{key:"collapse",value:function(){return tu(this.container,"l7-control-layers-expanded"),this}},{key:"onRemove",value:function(){var a=this;!this.mapsService||(this.mapsService.off("click",this.collapse),this.layers.forEach(function(s){s.layer.off("remove",a.onLayerChange),s.layer.off("add",a.onLayerChange)}))}},{key:"initLayout",value:function(){var a="l7-control-layers",s=this.container=lo("div",a),f=this.controlOption.collapsed;s.setAttribute("aria-haspopup","true");var v=this.form=lo("form",a+"-list");f&&(this.mapsService.on("click",this.collapse),s.addEventListener("mouseenter",this.expand),s.addEventListener("mouseleave",this.collapse)),this.layersLink=lo("a",a+"-toggle",s);var g=this.layersLink;g.title="Layers",f||this.expand(),this.baseLayersList=lo("div",a+"-base",v),this.separator=lo("div",a+"-separator",v),this.overlaysList=lo("div",a+"-overlays",v),s.appendChild(v)}},{key:"initLayers",value:function(){var a=this,s=this.controlOption,f=s.baseLayers,v=f===void 0?{}:f,g=s.overlayers,x=g===void 0?{}:g;Object.keys(v).forEach(function(C,T){a.addLayer(v[C],C,!1)}),Object.keys(x).forEach(function(C,T){a.addLayer(x[C],C,!0)})}},{key:"update",value:function(){if(!this.container)return this;ho(this.baseLayersList),ho(this.overlaysList),this.layerControlInputs=[];var a,s,f,v,g=0;for(f=0;f<this.layers.length;f++)v=this.layers[f],this.addItem(v),s=s||v.overlay,a=a||!v.overlay,g+=v.overlay?0:1;return this.controlOption.hideSingleBase&&(a=a&&g>1,this.baseLayersList.style.display=a?"":"none"),this.separator.style.display=s&&a?"":"none",this}},{key:"checkDisabledLayers",value:function(){for(var a=this.layerControlInputs,s,f,v=this.mapsService.getZoom(),g=a.length-1;g>=0;g--)if(s=a[g],f=this.layerService.getLayer(s.layerId),f&&f.inited){var x=f.getMinZoom(),C=f.getMaxZoom();s.disabled=v<x||v>C}}},{key:"addLayer",value:function(a,s,f){this.mapsService&&(a.on("add",this.onLayerChange),a.on("remove",this.onLayerChange)),this.layers.push({layer:a,name:s,overlay:f});var v=this.controlOption,g=v.sortLayers,x=v.sortFunction,C=v.autoZIndex;g&&this.layers.sort(function(T,O){return x(T.layer,O.layer,T.name,O.name)}),C&&a.setZIndex&&(this.lastZIndex++,a.setZIndex(this.lastZIndex)),this.expandIfNotCollapsed()}},{key:"expandIfNotCollapsed",value:function(){return this.mapsService&&!this.controlOption.collapsed&&this.expand(),this}},{key:"onLayerChange",value:function(a){this.handlingClick||this.update();var s=this.layerService.getLayer(a.target.layerId),f=s!=null&&s.overlay?a.type==="add"?"overlayadd":"overlayremove":a.type==="add"?"baselayerchange":null;f&&this.emit(f,s)}},{key:"createRadioElement",value:function(a,s){var f='<input type="radio" class="l7-control-layers-selector" name="'+a+'"'+(s?' checked="checked"':"")+"/>",v=document.createElement("div");return v.innerHTML=f,v.firstChild}},{key:"addItem",value:function(a){var s=document.createElement("label"),f=this.layerService.getLayer(a.layer.id),v=f&&f.inited&&a.layer.isVisible(),g;a.overlay?(g=document.createElement("input"),g.type="checkbox",g.className="l7-control-layers-selector",g.defaultChecked=v):g=this.createRadioElement("l7-base-layers",v),this.layerControlInputs.push(g),g.layerId=a.layer.id,g.addEventListener("click",this.onInputClick);var x=document.createElement("span");x.innerHTML=" "+a.name;var C=document.createElement("div");s.appendChild(C),C.appendChild(g),C.appendChild(x);var T=a.overlay?this.overlaysList:this.baseLayersList;return T.appendChild(s),this.checkDisabledLayers(),s}},{key:"onInputClick",value:function(){var a=this.layerControlInputs,s,f,v=[],g=[];this.handlingClick=!0;for(var x=a.length-1;x>=0;x--)s=a[x],f=this.layerService.getLayer(s.layerId),s.checked?v.push(f):s.checked||g.push(f);g.forEach(function(C){C.hide()}),v.forEach(function(C){C.show()}),this.handlingClick=!1}}]),r}(Fv);function Y2(e){var i=q2();return function(){var n=(0,Mt.Z)(e),a;if(i){var s=(0,Mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,wr.Z)(this,a)}}function q2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var K2=function(e){(0,Ir.Z)(r,e);var i=Y2(r);function r(){return(0,ht.Z)(this,r),i.apply(this,arguments)}return(0,Pt.Z)(r,[{key:"getDefault",value:function(){return{position:Xh.BOTTOMLEFT,name:"logo"}}},{key:"onAdd",value:function(){var a="l7-control-logo",s=lo("div",a),f=lo("a","l7-ctrl-logo");return f.target="_blank",f.rel="noopener nofollow",f.href="https://antv.alipay.com/l7",f.setAttribute("aria-label","AntV logo"),f.setAttribute("rel","noopener nofollow"),s.appendChild(f),s}},{key:"onRemove",value:function(){return null}}]),r}(Fv);function $2(e){var i=Q2();return function(){var n=(0,Mt.Z)(e),a;if(i){var s=(0,Mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,wr.Z)(this,a)}}function Q2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ZP=function(e){(0,Ir.Z)(r,e);var i=$2(r);function r(n){var a;return(0,ht.Z)(this,r),a=i.call(this,n),(0,A.Z)((0,ne.Z)(a),"mScale",void 0),(0,A.Z)((0,ne.Z)(a),"iScale",void 0),Iu(["update"],(0,ne.Z)(a)),a}return(0,Pt.Z)(r,[{key:"getDefault",value:function(){return{position:Xh.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,name:"scale"}}},{key:"onAdd",value:function(){var a="l7-control-scale",s=lo("div",a);this.addScales(a+"-line",s);var f=this.controlOption.updateWhenIdle;return this.mapsService.on(f?"moveend":"mapmove",this.update),this.mapsService.on(f?"zoomend":"zoomchange",this.update),this.update(),s}},{key:"onRemove",value:function(){var a=this.controlOption.updateWhenIdle;this.mapsService.off(a?"zoomend":"zoomchange",this.update),this.mapsService.off(a?"moveend":"mapmove",this.update)}},{key:"update",value:function(){var a=this.mapsService,s=this.controlOption.maxWidth,f=a.getSize()[1]/2,v=a.containerToLngLat([0,f]),g=a.containerToLngLat([s,f]),x=ha([v.lng,v.lat],[g.lng,g.lat]);this.updateScales(x)}},{key:"updateScales",value:function(a){var s=this.controlOption,f=s.metric,v=s.imperial;f&&a&&this.updateMetric(a),v&&a&&this.updateImperial(a)}},{key:"updateMetric",value:function(a){var s=this.getRoundNum(a),f=s<1e3?s+" m":s/1e3+" km";this.updateScale(this.mScale,f,s/a)}},{key:"updateImperial",value:function(a){var s=a*3.2808399,f,v,g;s>5280?(f=s/5280,v=this.getRoundNum(f),this.updateScale(this.iScale,v+" mi",v/f)):(g=this.getRoundNum(s),this.updateScale(this.iScale,g+" ft",g/s))}},{key:"updateScale",value:function(a,s,f){var v=this.controlOption.maxWidth;a.style.width=Math.round(v*f)+"px",a.innerHTML=s}},{key:"getRoundNum",value:function(a){var s=Math.pow(10,(Math.floor(a)+"").length-1),f=a/s;return f=f>=10?10:f>=5?5:f>=3?3:f>=2?2:1,s*f}},{key:"addScales",value:function(a,s){var f=this.controlOption,v=f.metric,g=f.imperial;v&&(this.mScale=lo("div",a,s)),g&&(this.iScale=lo("div",a,s))}}]),r}(Fv);function J2(e){var i=eE();return function(){var n=(0,Mt.Z)(e),a;if(i){var s=(0,Mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,wr.Z)(this,a)}}function eE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var jP=function(e){(0,Ir.Z)(r,e);var i=J2(r);function r(n){var a;return(0,ht.Z)(this,r),a=i.call(this,n),(0,A.Z)((0,ne.Z)(a),"disabled",void 0),(0,A.Z)((0,ne.Z)(a),"zoomInButton",void 0),(0,A.Z)((0,ne.Z)(a),"zoomOutButton",void 0),Iu(["updateDisabled","zoomIn","zoomOut"],(0,ne.Z)(a)),a}return(0,Pt.Z)(r,[{key:"getDefault",value:function(){return{position:Xh.TOPLEFT,zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"&#x2212;",zoomOutTitle:"Zoom out",name:"zoom"}}},{key:"onAdd",value:function(){var a="l7-control-zoom",s=lo("div",a+" l7-bar");return this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,a+"-in",s,this.zoomIn),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,a+"-out",s,this.zoomOut),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),this.updateDisabled(),s}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"zoomIn",value:function(){!this.disabled&&this.mapsService.getZoom()<this.mapsService.getMaxZoom()&&this.mapsService.zoomIn()}},{key:"zoomOut",value:function(){!this.disabled&&this.mapsService.getZoom()>this.mapsService.getMinZoom()&&this.mapsService.zoomOut()}},{key:"createButton",value:function(a,s,f,v,g){var x=lo("a",f,v);return x.innerHTML=a,x.title=s,x.href="javascript:void(0)",x.addEventListener("click",g),x}},{key:"updateDisabled",value:function(){var a=this.mapsService,s="l7-disabled";tu(this.zoomInButton,s),tu(this.zoomOutButton,s),(this.disabled||a.getZoom()<=a.getMinZoom())&&Su(this.zoomOutButton,s),(this.disabled||a.getZoom()>=a.getMaxZoom())&&Su(this.zoomInButton,s)}}]),r}(Fv);function Lg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function kg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Lg(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Lg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function tE(e){var i=rE();return function(){var n=(0,Mt.Z)(e),a;if(i){var s=(0,Mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,wr.Z)(this,a)}}function rE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Dg=function(e){(0,Ir.Z)(r,e);var i=tE(r);function r(n){var a;return(0,ht.Z)(this,r),a=i.call(this),(0,A.Z)((0,ne.Z)(a),"markerOption",void 0),(0,A.Z)((0,ne.Z)(a),"defaultMarker",void 0),(0,A.Z)((0,ne.Z)(a),"popup",void 0),(0,A.Z)((0,ne.Z)(a),"mapsService",void 0),(0,A.Z)((0,ne.Z)(a),"sceneSerive",void 0),(0,A.Z)((0,ne.Z)(a),"lngLat",void 0),(0,A.Z)((0,ne.Z)(a),"scene",void 0),(0,A.Z)((0,ne.Z)(a),"added",!1),(0,A.Z)((0,ne.Z)(a),"eventHandle",function(s){a.emit(s.type,{target:s,data:a.markerOption.extData,lngLat:a.lngLat})}),a.markerOption=kg(kg({},a.getDefault()),n),Iu(["update","onMove","onUp","addDragHandler","onMapClick"],(0,ne.Z)(a)),a.init(),a}return(0,Pt.Z)(r,[{key:"getDefault",value:function(){return{element:void 0,anchor:zl.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(a){this.scene=a,this.mapsService=a.get(Ht.IMapService),this.sceneSerive=a.get(Ht.ISceneService);var s=this.markerOption,f=s.element,v=s.draggable;return this.mapsService.getMarkerContainer().appendChild(f),this.registerMarkerEvent(f),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("mousedown",this.addDragHandler),this.mapsService.off("touchstart",this.addDragHandler),this.mapsService.off("mouseup",this.onUp),this.mapsService.off("touchend",this.onUp)),this.unRegisterMarkerEvent(),this.removeAllListeners();var a=this.markerOption.element;return a&&ju(a),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(a){return this.lngLat=a,Array.isArray(a)&&(this.lngLat={lng:a[0],lat:a[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(a){var s=this;if(!this.added)return this.once("added",function(){s.setElement(a)}),this;var f=this.markerOption.element;return f&&ju(f),this.markerOption.element=a,this.init(),this.mapsService.getMarkerContainer().appendChild(a),this.registerMarkerEvent(a),this.update(),this}},{key:"openPopup",value:function(){var a=this;if(!this.added)return this.once("added",function(){a.openPopup()}),this;var s=this.popup;return s?(s.isOpen()||s.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var a=this;this.added||this.once("added",function(){a.closePopup()});var s=this.popup;return s&&s.remove(),this}},{key:"setPopup",value:function(a){return this.popup=a,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var a=this.popup;if(a)a.isOpen()?a.remove():a.addTo(this.scene);else return this;return this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(a){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(a){this.markerOption.extData=a}},{key:"update",value:function(){if(!!this.mapsService){var a=this.markerOption,s=a.element,f=a.anchor;this.updatePosition(),qa(s,"".concat(_l[f]))}}},{key:"onMapClick",value:function(a){var s=this.markerOption.element;this.popup&&s&&this.togglePopup()}},{key:"updatePosition",value:function(){if(!!this.mapsService){var a=this.markerOption,s=a.element,f=a.offsets,v=this.lngLat,g=v.lng,x=v.lat,C=this.mapsService.getBounds(),T=this.mapsService.lngLatToContainer([g,x]);if(s){s.style.display="block",s.style.whiteSpace="nowrap";var O=this.mapsService.getContainer(),k=0,j=0;if(O&&(k=O.scrollWidth,j=O.scrollHeight),Math.abs(C[0][0])>180||Math.abs(C[1][0])>180){if(T.x>k){var X=this.mapsService.lngLatToContainer([g-360,x]);T.x=X.x}if(T.x<0){var te=this.mapsService.lngLatToContainer([g+360,x]);T.x=te.x}}(T.x>k||T.x<0||T.y>j||T.y<0)&&(s.style.display="none"),s.style.left=T.x+f[0]+"px",s.style.top=T.y-f[1]+"px"}}}},{key:"init",value:function(){var a=this,s=this.markerOption.element,f=this.markerOption,v=f.color,g=f.anchor;if(!s){this.defaultMarker=!0,s=lo("div"),this.markerOption.element=s;var x=document.createElementNS("http://www.w3.org/2000/svg","svg");x.setAttributeNS(null,"display","block"),x.setAttributeNS(null,"height","48px"),x.setAttributeNS(null,"width","48px"),x.setAttributeNS(null,"viewBox","0 0 1024 1024");var C=document.createElementNS("http://www.w3.org/2000/svg","path");C.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),C.setAttributeNS(null,"fill",v),x.appendChild(C),s.appendChild(x)}Su(s,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(function(T){var O,k,j=((O=a.markerOption)===null||O===void 0?void 0:O.style)&&((k=a.markerOption)===null||k===void 0?void 0:k.style[T]);s&&(s.style[T]=j)}),s.addEventListener("click",function(T){a.onMapClick(T)}),s.addEventListener("click",this.eventHandle),yf(s,g,"marker")}},{key:"registerMarkerEvent",value:function(a){a.addEventListener("mousemove",this.eventHandle),a.addEventListener("click",this.eventHandle),a.addEventListener("mousedown",this.eventHandle),a.addEventListener("mouseup",this.eventHandle),a.addEventListener("dblclick",this.eventHandle),a.addEventListener("contextmenu",this.eventHandle),a.addEventListener("mouseover",this.eventHandle),a.addEventListener("mouseout",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var a=this.getElement();a.removeEventListener("mousemove",this.eventHandle),a.removeEventListener("click",this.eventHandle),a.removeEventListener("mousedown",this.eventHandle),a.removeEventListener("mouseup",this.eventHandle),a.removeEventListener("dblclick",this.eventHandle),a.removeEventListener("contextmenu",this.eventHandle),a.removeEventListener("mouseover",this.eventHandle),a.removeEventListener("mouseout",this.eventHandle)}},{key:"addDragHandler",value:function(a){throw new Error("Method not implemented.")}},{key:"onUp",value:function(a){throw new Error("Method not implemented.")}}]),r}(Mn.EventEmitter);function Fg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Bg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Fg(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Fg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function nE(e){var i=iE();return function(){var n=(0,Mt.Z)(e),a;if(i){var s=(0,Mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,wr.Z)(this,a)}}function iE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var VP=function(e){(0,Ir.Z)(r,e);var i=nE(r);function r(n){var a,s;return(0,ht.Z)(this,r),s=i.call(this),(0,A.Z)((0,ne.Z)(s),"markers",[]),(0,A.Z)((0,ne.Z)(s),"markerLayerOption",void 0),(0,A.Z)((0,ne.Z)(s),"clusterIndex",void 0),(0,A.Z)((0,ne.Z)(s),"points",[]),(0,A.Z)((0,ne.Z)(s),"clusterMarkers",[]),(0,A.Z)((0,ne.Z)(s),"mapsService",void 0),(0,A.Z)((0,ne.Z)(s),"scene",void 0),(0,A.Z)((0,ne.Z)(s),"zoom",void 0),(0,A.Z)((0,ne.Z)(s),"bbox",void 0),s.markerLayerOption=Ia()(s.getDefault(),n),Iu(["update"],(0,ne.Z)(s)),s.zoom=((a=s.markerLayerOption.clusterOption)===null||a===void 0?void 0:a.zoom)||-99,s}return(0,Pt.Z)(r,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(a){return this.scene=a,this.mapsService=a.get(Ht.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.addMarkers(),this}},{key:"addMarker",value:function(a){var s=this.markerLayerOption.cluster;if(s&&(this.addPoint(a,this.markers.length),this.mapsService)){var f=this.mapsService.getZoom(),v=this.mapsService.getBounds();this.bbox=dc(v,.5),this.zoom=Math.floor(f),this.getClusterMarker(this.bbox,this.zoom)}this.markers.push(a)}},{key:"removeMarker",value:function(a){this.markers.indexOf(a);var s=this.markers.indexOf(a);s>-1&&this.markers.splice(s,1)}},{key:"hide",value:function(){this.markers.map(function(a){a.getElement().style.opacity="0"}),this.clusterMarkers.map(function(a){a.getElement().style.opacity="0"})}},{key:"show",value:function(){this.markers.map(function(a){a.getElement().style.opacity="1"}),this.clusterMarkers.map(function(a){a.getElement().style.opacity="1"})}},{key:"getMarkers",value:function(){var a=this.markerLayerOption.cluster;return a?this.clusterMarkers:this.markers}},{key:"addMarkers",value:function(){var a=this;this.getMarkers().forEach(function(s){s.addTo(a.scene)})}},{key:"clear",value:function(){this.markers.forEach(function(a){a.remove()}),this.clusterMarkers.forEach(function(a){a.remove()}),this.mapsService.off("camerachange",this.update),this.markers=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"addPoint",value:function(a,s){var f=a.getLnglat(),v=f.lng,g=f.lat,x={geometry:{type:"Point",coordinates:[v,g]},properties:Bg(Bg({},a.getExtData()),{},{marker_id:s})};this.points.push(x),this.clusterIndex&&this.clusterIndex.load(this.points)}},{key:"initCluster",value:function(){if(!!this.markerLayerOption.cluster){var a=this.markerLayerOption.clusterOption,s=a.radius,f=a.minZoom,v=f===void 0?0:f,g=a.maxZoom;this.clusterIndex=new(Up())({radius:s,minZoom:v,maxZoom:g}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(a,s){var f=this,v=a[0].concat(a[1]),g=this.clusterIndex.getClusters(v,s);this.clusterMarkers.forEach(function(x){x.remove()}),this.clusterMarkers=[],g.forEach(function(x){var C,T=f.markerLayerOption.clusterOption,O=T.field,k=T.method;if(x.properties&&(C=x.properties)!==null&&C!==void 0&&C.cluster_id){var j,X=f.getLeaves((j=x.properties)===null||j===void 0?void 0:j.cluster_id);if(x.properties.clusterData=X,O&&k){var te=X==null?void 0:X.map(function(bt){var _t=(0,A.Z)({},O,bt.properties[O]);return _t}),be=ms(te,O),Ne=Uc(k,be),$e="point_"+k;x.properties[$e]=Ne.toFixed(2)}}var ot=f.clusterMarker(x);f.clusterMarkers.push(ot),ot.addTo(f.scene)})}},{key:"getLeaves",value:function(a){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Infinity,f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return a?this.clusterIndex.getLeaves(a,s,f):null}},{key:"clusterMarker",value:function(a){var s=this.markerLayerOption.clusterOption,f=s,v=f.element,g=v===void 0?this.generateElement.bind(this):v,x=new Dg({element:g(a)}).setLnglat({lng:a.geometry.coordinates[0],lat:a.geometry.coordinates[1]});return x}},{key:"normalMarker",value:function(a){var s=a.properties.marker_id;return this.markers[s]}},{key:"update",value:function(){if(!!this.mapsService){var a=this.mapsService.getZoom(),s=this.mapsService.getBounds();(!this.bbox||Math.abs(a-this.zoom)>=1||!yl(this.bbox,s))&&(this.bbox=dc(s,.5),this.zoom=Math.floor(a),this.getClusterMarker(this.bbox,this.zoom))}}},{key:"generateElement",value:function(a){var s=lo("div","l7-marker-cluster"),f=lo("div","",s),v=lo("span","",f),g=this.markerLayerOption.clusterOption,x=g.field,C=g.method;a.properties.point_count=a.properties.point_count||1;var T=x&&C?a.properties["point_"+C]||a.properties[x]:a.properties.point_count;return v.textContent=T,s}}]),r}(Mn.EventEmitter);function Ng(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function zg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Ng(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ng(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function aE(e){var i=oE();return function(){var n=(0,Mt.Z)(e),a;if(i){var s=(0,Mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,wr.Z)(this,a)}}function oE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ug=function(e){(0,Ir.Z)(r,e);var i=aE(r);function r(n){var a;return(0,ht.Z)(this,r),a=i.call(this),(0,A.Z)((0,ne.Z)(a),"popupOption",void 0),(0,A.Z)((0,ne.Z)(a),"mapsService",void 0),(0,A.Z)((0,ne.Z)(a),"sceneSerive",void 0),(0,A.Z)((0,ne.Z)(a),"lngLat",void 0),(0,A.Z)((0,ne.Z)(a),"content",void 0),(0,A.Z)((0,ne.Z)(a),"closeButton",void 0),(0,A.Z)((0,ne.Z)(a),"timeoutInstance",void 0),(0,A.Z)((0,ne.Z)(a),"container",void 0),(0,A.Z)((0,ne.Z)(a),"tip",void 0),(0,A.Z)((0,ne.Z)(a),"scene",void 0),a.popupOption=zg(zg({},a.getdefault()),n),Iu(["update","onClickClose","remove"],(0,ne.Z)(a)),a}return(0,Pt.Z)(r,[{key:"addTo",value:function(a){var s=this;return this.mapsService=a.get(Ht.IMapService),this.sceneSerive=a.get(Ht.ISceneService),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=a,this.update(),this.popupOption.closeOnClick&&(this.timeoutInstance=setTimeout(function(){s.mapsService.on("click",s.onClickClose)},30)),this.emit("open"),this}},{key:"close",value:function(){this.remove()}},{key:"open",value:function(){this.addTo(this.scene)}},{key:"setHTML",value:function(a){var s=window.document.createDocumentFragment(),f=window.document.createElement("body"),v;for(f.innerHTML=a;v=f.firstChild,!!v;)s.appendChild(v);return this.setDOMContent(s)}},{key:"setLnglat",value:function(a){return this.lngLat=a,Array.isArray(a)&&(this.lngLat={lng:a[0],lat:a[1]}),this.mapsService&&(this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setText",value:function(a){return this.setDOMContent(window.document.createTextNode(a))}},{key:"setMaxWidth",value:function(a){return this.popupOption.maxWidth=a,this.update(),this}},{key:"setDOMContent",value:function(a){return this.createContent(),this.content.appendChild(a),this.update(),this}},{key:"remove",value:function(){return this.content&&this.removeDom(this.content),this.container&&(this.removeDom(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.off("click",this.onClickClose),delete this.mapsService),clearTimeout(this.timeoutInstance),this.emit("close"),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"createContent",value:function(){this.content&&ju(this.content),this.content=lo("div","l7-popup-content",this.container),this.popupOption.closeButton&&(this.closeButton=lo("button","l7-popup-close-button",this.content),this.popupOption.closeButtonOffsets&&(this.closeButton.style.right=this.popupOption.closeButtonOffsets[0]+"px",this.closeButton.style.top=this.popupOption.closeButtonOffsets[1]+"px"),this.closeButton.setAttribute("aria-label","Close popup"),this.closeButton.innerHTML="&#215;",this.closeButton.addEventListener("click",this.onClickClose))}},{key:"creatDom",value:function(a,s,f){var v=window.document.createElement(a);return s!==void 0&&(v.className=s),f&&f.appendChild(v),v}},{key:"removeDom",value:function(a){a.parentNode&&a.parentNode.removeChild(a)}},{key:"getdefault",value:function(){return{closeButton:!0,closeOnClick:!0,maxWidth:"240px",offsets:[0,0],anchor:zl.BOTTOM,className:"",stopPropagation:!0}}},{key:"onClickClose",value:function(a){a.stopPropagation&&a.stopPropagation(),this.remove()}},{key:"update",value:function(){var a=this,s=this.lngLat,f=this.popupOption,v=f.className,g=f.maxWidth,x=f.anchor;if(!(!this.mapsService||!s||!this.content)){var C=this.mapsService.getMarkerContainer();if(!this.container&&C){this.container=this.creatDom("div","l7-popup",C),this.tip=this.creatDom("div","l7-popup-tip",this.container),this.container.appendChild(this.content),v&&v.split(" ").forEach(function(O){return a.container.classList.add(O)});var T=this.popupOption.stopPropagation;T&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(function(O){a.container.addEventListener(O,function(k){k.stopPropagation()})}),this.container.style.whiteSpace="nowrap"}g&&this.container.style.maxWidth!==g&&(this.container.style.maxWidth=g),this.updatePosition(),qa(this.container,"".concat(_l[x])),yf(this.container,x,"popup")}}},{key:"updatePosition",value:function(){if(!!this.mapsService){var a=this.lngLat,s=a.lng,f=a.lat,v=this.popupOption.offsets,g=this.mapsService.lngLatToContainer([s,f]);this.container.style.left=g.x+v[0]+"px",this.container.style.top=g.y-v[1]+"px"}}}]),r}(Mn.EventEmitter);function sE(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var a=i.head||i.getElementsByTagName("head")[0];if(!a){a=i.createElement("head");var s=i.body||i.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(a,s):i.documentElement.appendChild(a)}var f=i.createElement("style");return f.type="text/css",f.styleSheet?f.styleSheet.cssText=e:f.appendChild(i.createTextNode(e)),a.appendChild(f),f}}sE(`.l7-marker-container {
  width: 100%;
  height: 100%;
  overflow: hidden;
  position: absolute;
}

.l7-marker {
  position: absolute !important;
  top: 0;
  left: 0;
  z-index: 5;
  cursor: pointer;
}

.l7-marker-cluster {
  background-clip: padding-box;
  border-radius: 20px;
  background-color: rgba(181, 226, 140, 0.6);
  width: 40px;
  height: 40px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-left: 5px;
  margin-top: 5px;
  text-align: center;
  border-radius: 15px;
  font: 12px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  background-color: rgba(110, 204, 57, 0.6);
}
.l7-marker-cluster span {
  line-height: 30px;
}

.l7-popup-anchor-bottom,
.l7-popup-anchor-bottom-left,
.l7-popup-anchor-bottom-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 5px;
}
.l7-popup-anchor-top,
.l7-popup-anchor-top-left,
.l7-popup-anchor-top-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-popup-anchor-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}

.l7-popup-anchor-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  will-change: transform;
  pointer-events: none;
  z-index: 5;
}
.l7-popup-tip {
  width: 0;
  height: 0;
  border: 10px solid transparent;
  z-index: 1;
}
.l7-popup-anchor-top .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top: none;
  border-left: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top: none;
  border-right: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-bottom .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-bottom: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-bottom: none;
  border-left: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-bottom: none;
  border-right: none;
  border-top-color: #fff;
}

.l7-popup-anchor-left .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-left: none;
  border-right-color: #fff;
}

.l7-popup-anchor-right .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right: none;
  border-left-color: #fff;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  padding: 0;
  font-size: 25px;
  line-height: 20px;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

.l7-popup-anchor-top-left .l7-popup-content {
  border-top-left-radius: 0;
}

.l7-popup-anchor-top-right .l7-popup-content {
  border-top-right-radius: 0;
}

.l7-popup-anchor-bottom-left .l7-popup-content {
  border-bottom-left-radius: 0;
}

.l7-popup-anchor-bottom-right .l7-popup-content {
  border-bottom-right-radius: 0;
}

.l7-popup-track-pointer {
  display: none;
}

.l7-popup-track-pointer * {
  pointer-events: none;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}

.l7-map:hover .l7-popup-track-pointer {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
}

.l7-map:active .l7-popup-track-pointer {
  display: none;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* general toolbar styles */

.l7-bar {
  -webkit-box-shadow: 0 0 1px rgba(0, 0, 0, 0.3);
          box-shadow: 0 0 1px rgba(0, 0, 0, 0.3);
  border-radius: 4px;
}
.l7-bar a,
.l7-bar a:hover {
  background-color: #fff;
  width: 30px;
  height: 30px;
  font-size: 20px;
  display: block;
  text-align: center;
  text-decoration: none;
  color: #8e9dab;
}
.l7-bar a,
.l7-control-layers-toggle {
  background-position: 50% 50%;
  background-repeat: no-repeat;
  display: block;
}
.l7-bar a:hover {
  background-color: #f4f4f4;
}
.l7-bar a:first-child {
  border-top-left-radius: 2px;
  border-top-right-radius: 2px;
}
.l7-bar a:last-child {
  border-bottom-left-radius: 2px;
  border-bottom-right-radius: 2px;
  border-bottom: none;
}
.l7-bar a.l7-disabled {
  cursor: default;
  background-color: #f4f4f4;
  color: #bbb;
}

/* control positioning */

.l7-control-container {
  font: 12px/1.5 'Helvetica Neue', Arial, Helvetica, sans-serif;
}
.l7-control-hide {
  display: none;
}
.l7-control {
  position: relative;
  z-index: 800;
  pointer-events: visiblePainted; /* IE 9-10 doesn't have auto */
  pointer-events: auto;
}
.l7-control {
  float: left;
  clear: both;
}
.l7-top,
.l7-bottom {
  position: absolute;
  z-index: 1000;
  pointer-events: none;
}
.l7-top {
  top: 0;
}
.l7-right {
  right: 0;
}
.l7-bottom {
  bottom: 0;
}
.l7-left {
  left: 0;
}
.l7-center {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
}
.l7-bottom.l7-center,
.l7-top.l7-center {
  width: 100%;
}
.l7-right.l7-center,
.l7-left.l7-center {
  height: 100%;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-top.l7-center,
.l7-left.l7-center {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}

.l7-bottom.l7-center,
.l7-right.l7-center {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}

.l7-center .l7-control {
  margin-right: 10px;
  margin-bottom: 10px;
}

.l7-control {
  float: left;
  clear: both;
}
.l7-right .l7-control {
  float: right;
}
.l7-top .l7-control {
  margin-top: 10px;
}
.l7-bottom .l7-control {
  margin-bottom: 10px;
}
.l7-left .l7-control {
  margin-left: 10px;
}
.l7-right .l7-control {
  margin-right: 10px;
}

/* attribution and scale controls */

.l7-control-container .l7-control-attribution {
  background: #fff;
  background: rgba(59, 58, 58, 0.7);
  margin: 0;
}
.l7-control-attribution,
.l7-control-scale-line {
  padding: 0 5px;
  color: #333;
}
.l7-control-attribution a {
  text-decoration: none;
}
.l7-control-attribution a:hover {
  text-decoration: underline;
}
.l7-container .l7-control-attribution,
.l7-container .l7-control-scale {
  font-size: 11px;
  padding: 5px 5px 2px 5px;
  background: rgba(255, 255, 255, 0.7);
}
.l7-left .l7-control-scale {
  margin-left: 5px;
}
.l7-bottom .l7-control-scale {
  margin-bottom: 5px;
}
.l7-control-scale-line {
  border: 2px solid #000;
  border-top: none;
  color: #000;
  line-height: 1.1;
  padding: 2px 5px 1px;
  font-size: 11px;
  white-space: nowrap;
  overflow: hidden;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;

  background: #fff;
}
.l7-control-scale-line:not(:first-child) {
  border-top: 2px solid #777;
  border-bottom: none;
  margin-top: -2px;
}
.l7-control-scale-line:not(:first-child):not(:last-child) {
  border-bottom: 2px solid #777;
}

.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  -webkit-box-shadow: none;
          box-shadow: none;
}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  border: 2px solid rgba(0, 0, 0, 0.2);
  background-clip: padding-box;
}
/*logo */

.l7-ctrl-logo {
  background-size: 100% 100%;
  width: 89px;
  height: 16px;
  margin: 0 0 -3px -3px;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  background-repeat: no-repeat;
  cursor: pointer;
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALIAAAAgCAYAAAHBIxK2AAAABGdBTUEAALGPC/xhBQAAIJZJREFUeAHtfAl8Tkf3/9z7PNmDRFbZSawhQcRSaqva1xCqpataqrT2UkuUUiqlaKtafe1VS1pUiypB0dIgIkpKRPZIELI/2/zO98akN48nltL3838//84nNzNzzpkzc+eee+bMOXMfxijNaMJ7LOrGO/HdYfZ8fb12gD2JJINJdR8WNHVQnRtSn7hilpz0u2DMKaEcFhZmhdzLNbiPyNVlwPxcm4Qh93Fr0gO4Ol5hfqiz6Q14G+QzGpYzQ9nXrUl7X/fgbrXdG3skX7m26+bNW2fQqJ5XmCs6RQKd6EQwB0zgtKgsvCidGF+N8wV/SBLqSKnXzx2WKIHw1xNxq2xtrKsBXqgrbePt1rivJFmloa5OoD129NcVQwa9Phxwaflw3ifvHCus1YIVjW7fwEF66dIhdYO/XV7Qk+9HY/5F7RA+w0G5TdRxq7gw10FBPWwA+3r9jpkYGcoJ5/7YiFxMiYCjLspsekOeCiJ1AhJJNER+8rfTX/j4BNcUMNCLMmhF+wC3cE9RZmMd/0IQjeTtGdwJjURD5EajsRQN1EwEHjAkUVce2LLhnKf8xGId3ZhkX4uxmj7MMKqJz0ZmMr3MJNZBmphV8WDBOCCgo+2QiE7DF3005wvU75e8vMLs4+P3HwwN7do5MzOu2NcjpPHRX/csCqjt2wvtxEAy8xJ3o+7j3jjkcurpn2xtrT0EPiS0oQPKSOfi/ygqL9H/qNbls8EXuer4+65xUa149QnBvGYFgapAN21EZ+pnuH3rrrnKdNA/zCRmjoqGzu36RoL21q38BLAAjRgo6iir63g1QAOcOoU27DAgwKtpPzVMKU+qBWIuve3Jx0zw4j/eQ0CASeNnjUi5mrYH72ZxUfFV0emJ479/BvrM9KxDAgZZEjziTp1d8+pL415sEdJloIAhF7QCZmnQoCkuLkkXNPfkozU8b4wVb30P4i4ADNQ41P08mtSBogHc27Vx70CPEHeUgRNwgUOuTqBR8wwODraGSIkrKipKxqVuI300mntri1jz9OOs0IHeHUdvms2t0iG+vn5nxmnan5QeUff6GGWttpidSjvGbCSZJdAAGTMwtjWSH2G5XrOp3oEv9wuWxqdeUPchZkW8OGqcedmcdujgUcMOH/zltmgL2YW2Fu22fbMz6q2xM+IEvmvHiCGyRq7AK3QLe959+T6v46co0uVBisLk0/9SqIIhcnQiVBPqULJ4dPVd2ypLg6Dx8wxuhAGDHrCOHTtqUfZ2b6KsYYIOuUiXL1/dKW4SMJRxkbbpG9nv5ecVutlt+PSoNvw7VPg8V4X5wqf4YQVp9g+NDQZDITr2cm/8lNIGlbvp+edGD/946eqJqOKmoBJRhjyjrclk0qlZAqeumw8YOEwE6ILdgh0raN9pcHeWx9n3mViPh9IKnlmBVBWI4bfoePDAEcOGPz9WWUDBzMe1cUdft5CnUfb2DvFR8rsz2avrkOdmT18wJisz5zDaqthVWjwAtzRgtBF9VbSdVofXIPWmB2CCouYqUBUFH59QbwwEqg0XykAi96/VuCEetRrm59msEfA+nqEtAUeqNEt324JGJEsDxpMi26gnaCpUxqJk6bahkGFp3akrZO8IBurcVGponpGW+VOdQP++uIAznzE1/cBBvRRZTc+OP0miUBJ78OiyxNxE6uX+KSP3vDIZuEE/z9BgWZZtHHj1oxZbkS6uJFNqIn+SWSy1AubjFtLd171xoHrQooyFQJRB7+0eHBrk2cxNtBW5mgYwoYNFXg5r7CvoFXWxajQ3mjiTc84wVkB2kTWt5NYk3lZ02SCvzphDDVrNZOY2p3mdA0wrhQoGSm5ig6SRyTsqwSxUaMKk+t4tXJIy4/IsoP82yNu7pYusKwk2WdslZmScvGHOyNs1tJ5GNrjVaeT2W2xsLCnuv5J6woQq/QtbXoLCMJqYtbWj208pKbGK4aamgWJR19XlCvpFEdxn6SDOl0byAjXB/cp8rlM/PteZ83k1T92PTuAw0Ly8GychmosWLB/v7xFSW+AeJQ/0auyLiYFEBgQ0dYKdDRsJfFOvpe0V76fgCVrgkNQTao63hAONr2vjFtAFltoTTFLzB415Al7RFdNipHRviWlLbzCHhZ05HxfEy9e7T/zX8FV+XLk+96e8Tl0xOJZfOpjdKp4kzboZXgGrouDj1rTunHnTQl1caoZ/unLNlKnTx32sNxobR0ZGakQTDCY8tEtEkG+LfihDg+NC2ccjpBXoyMTqVaLjTaFLduxe219XqH+67HYGKU5D0pbN30X5+vl0a9m6mZOPTxvFUIayPRAbM1RpS1uztp0a/SD6e9hcYlKVqgi7QEg/DAyRsAUsKSlNLyvT56Bs8e2Ias4LZzfnfEowJyOOVocZDs9jt8YnMDvUZzblZ+jis1rwtqg/KMHgwEThCUOCUS64U/An6iiL9oIGcFjwqMOQQB0JdTyEXd/tfR/1rMzsWCrPBxwPCxJMfJMELVYq0KO+fNkXk6CHRV/qXPSLXA0XZejpqiRZ0IgcY7hzu+AS2TB3quInaNnU2vzSlNqcT/fhHSqAVJgawAunEXxCPU4W9MMlcRN0ryZMAl2XcOHm6YlnYgMAToIOuxks+YBBErGrAa0YtKDDDkeYAaBFErjSUl2uKOfm5v1GE9y1nOLe/4IO+b3YchfKw0wy3lZ6m2arxyr4KV4RURH54qtS/fGufEMZZ7Hja/Ko0ptsgYML0+kKGM+4wbTbmGQUtPfLMfBrWWc3gIZenX4aJmUp9OQdqunk4nv2QmzMus0rO730wtj0qu2DqnuQjCYbrOjYrINq5JuRe/CKQp3QtRMweivm0yur+FBQf9xk6WFQX99Tvw2GDO0390jssWXW1vKf6n4q7Dc1EOXledJwQxF7RV/EomQbptMXssJlNyT5YSe4dq1m/s907eik1WprNKjdur9sW/1AWt7535Ur6/zvN2/lpcds/37eM892mEgTXGHuHD1y4qLRYK0YvrJsMly5knKu0tg0csmObbvfC2/ZbETK9bOnW4TU7xtGEw0a2geZbKysz/Xu9txQvV6fX6VOrMTw/hVsdF8b/tbGgX1feqF1m7Bq5hda+/o+pVgXm9Ztmzk0ctTBlMyEi/fnaoZ9g3HH1xmv5GgwI/m3+oAZUOzkj4fx7rQBt7qdxnhJDiuj/YlBe9dG1pLNbF9D8c2dem2xVMA3NQhjBk6WMyVaelmZVaL0+vmcB/Tz/zVa+8lIPlWW2SLMQh559ZSNCE2sbCq/FBuLyrrbLJVHsYZMr/sdfpiKJOv1pOxtyISp0tQRtHXqhNWQZffSy5d/LBOwJ5H71mrcAnzSSA2Z84ObJPlCbiujSZubkRefZI5X61hL5pavbzMvY4kuTCuzm6nXE4+Ztwf/lBRmcW1zcSkwxsXF6bWmEnbQSPJsoqWMZumwUqYC7QCVi3Y6tMmnCZdYDItiJezj0v3MaLJmRmXX58w0zKJ3w3ww2IwE+fk7JSUll9b2Crl4NfPcJXOav1OH7fyfdSs6cS7zl18Y65GRd36Pmk/S+dwex0/tHTN54pxNJ0/I2tTsM5WccqDFQgn9rW4nyphg4J95ut9gZis7p6Ym3BI4L9eQ+sS/ntrbLXDIE8/fLKaHVP7goyN5whKyKKMHcsWboSasqsznORfSRYEaz3v29uZt4JiDxMC8QVJLjzntg+ow+dBe7BhRJ1MwQ/AVkRbwQbBj7OtTXgVu49qt79LDrW/OX4yrqjEJ/OIPVrwlfM2CB/rW6XQ3wd9SgjsM41SsC9pLt+H0AptK2fdRjFdYHHwdhY0QOsL1VZDimkIHfLLD8xThcmCF+p3SjOxc0WlV+Zervm2x68dN/QQ+MLC2DVSHqOOVw6ZFXDRgCXjUBQ1y7Py+3bO+HyQLO0bArGV2auRrkxRv1orPPgjXF6XVARxJz0vCPvz4vbkoT50899yTenvAD0ljLx0L8Gr2Et4C9XXnTkEiecNKv/xiU/q1nHNXlQmN2iYVlpWwL0qLmSR3ZNFgQCpCogXuLDMa45WrTH8AcCVpTL8Q7ChbVDhAgO6XmwwGj7AWoa9lZ+UcBt3ufZvn6Ar0bUSbP/+42cJQ7NhbNjj3ybpW2p0G3LtP966DUIYk0TbZDr4Kk9Ho7lXLw1+0g6qo6Wtz8+f9sfmARQzqPZNWiCCBJ/NLtrOz9SkoKPxDlmT1SiJIHiuH6oAeF5e1o9XRGjWqa6pXrxbcqlm3YY7Wtifu6WDeU1xHF59an1cDki9wm8nnU7h3AV0fergDNrsln0+BtKUoP0yizYJr/57DhuJ1wnY5/mziepTVr6e3R0hrsbPLyck7BrxIZO/eAi2uuwE4I3Aok5rIAtzPPbjtxQuXtgCOOtQTwkqrPvlqMmBd2vcfDGeSpfGCXrS7H96SujCnBy+oj6LComSoEoGvUA0A6EvZ8DLaO9nYsUOoSzNy57Oi4mJyBu2SpuRcj2rGvZievUsRgleBf5gk6cpabd62egFoaYtr6NFl8DaUoz96LzTAq0kDlNWppLhE2UTg9Tuf8MdG2sw4DRjQU9H7e3b/FE2vomLoU3nJjm92rYSEwoXZuX3EJvDZsWtdz/+sjGlqMJqCXx/90jzALlz4syQl5awi7aj/EwnxPfC1srJy7ti232Sb6jZHRT+VJvm909I3pjKWayxjYdODeLkO1hnC2OLC/mhQWsJO6UvInCtjHQWDB+XKK2tvF3Dq5JkvVR4t/tzwiHk6namuefunwruvEq9ft86RW4Ef9sqQcK2WXRkzYtKBgtsFGYCNHjHpt3enzd+cnpvwo8pHbKQd2Wg9M3qDhjz9tqd+O7tao2XZqP+TKf8Ga3vyzP630EdGRpY+OTnutuiv0iQDqDOxVgaaSDLpjqMuResukoXHpwTw7jT5XnQlfHBBOgPcgxIiEqu+jG4NuoYN63a4mHzio0vJvy7Blhcwa2srWW0NAFZVgh0uaTSKj0LQYFERZVmy+WP1Z2uno25vZyd/tX5FO5T79x72faoF+xm4J5m4geLOPl7PHPvl1CeyLF1T875nkpdckq7qdOwIqY4aEz35i+XEXCYJ30MXs7dnSghSzaSqMunN2n36dZsBfG7uzYt3r0vpaVm/AHbkxJ4xJYWpD80PbapK6bmnL8+dvURRJXsPbXu5W49OU6n/ItA/zEapKr4PA8fC7OVVS1EXgwe8sq9Nh4aJ6nYWdyrFmayLvQsrIwleF8n4Jk9ntlCvo00gZ6ujE6UHBujQAZw2ZY52Cv8fvj/wwahXJu6VGFdu2sh4rdTs+M6+fl7dSAI+kTS0yfkbCWEndbhJIzPdjRu3TgcGBijqbcHc6Km21iz+b7C22KTEaGxFi1slHDyLsrGgKHr5kvYCsW3btkpeynskGYSrmaQnvTufLubhyL6WDGwK0zH9ypvSKMHoQXmuoaztz0diJoHu9VfePp6el3BYeOGstVYJ0Ys/VSR81OjhPmQqKAvbg3hqZNOd9PTsZNAt/3Rhi+5dW/cmy6SzaGfv7HS817NDlUUWsFWfrU9LzkxMFfjHyadMe3MZ7HPzCwJjMnK/8JbNI6rib1GSQfxpoTT7TRs+mYzLSJJoWkTYsKqYWIIbTNzWuaZTA0iWOT4l+2zKxx99fpXCUKxXv+5hn6/akP7n5eRztbw9O5rToi7cnx5+0rWIvi/uSU4/M2BgZJ/ZAwb2KiO9HynaXLp0rIAkTZeff/tc7MFju2Qm0T7r8RPcnJa43MjL1+PtocUif8SrE2ZkpWWX0Tmbex4q5q/KNFLLO8mcHSTXRc7nRsmzSkILCOzWsJkAypLjBXE4U+mdtmSCGclC+AEbC8US0Wh+u5Jz7jraIWREYfRGuJG064n7AAvxCHHIMxorpLcac4q9lHesYjLRb06qrgtZMoVpuecqzCi0tZRg2wq4pXEiKCDwlnIRMMD9WFvrjGqrwhK9RRj5kp+bwLgS37NI8C/wgTOgSPLyV7ibxoa9Rp7kV8nrVo1E3qSjJSr/CuNlBUxHTswSZmLFkhWTtLSGUqSEjO7yXEN1DZW1FBuQrQllxzK5FVuTc5HtnnOIwlRf1X6Waa1GM24KoNGQT69SkpiGFtIyYwwrMK1jb1+9/U9bApV6/7fyxGYAwewzZ1IdiosNBvF2PzHmD8FIWfcoKPIV7ZZ7Q8rImmJGPWPpR0jqdMxEAs5IgEkWCUm6mf6YRITIOXIFUC6heCvIyguhPIR5s1PE9TYrMixlWkM9ZqRwC2jLkywKSm4tPc005KKeOxe+qb+oKhE9fAUOvLLi0ubYH6AVNpoaLU++lnWezs8/OLbw8D09GUp8HkB7wHCEEwVHjBkOxqvX7x906kgOzMvn89qZWLm7SbSXmXwnqLHLMdVmWKAq5eolSY2wtDyp8aIcFNSqekl+Uftjhy5IbduGV0tKulrCdMEGrcRupeYm/iLoLOXkMpJqe4fUN+hZHRM3keQ9Wip3IGiSEIupmLjooXwByeoUA2daCrSw4nx2Kucye86qhJUq7MUKSznt+SqSHcq0KAqY1okZxqySrlcQUIEvJ7e+RDocW2JdmR3T8K0UT2lOwk1viKQnh2oUuaIqrFt120ct4ySGwaALHDPuVb8ZM9+OxjlFOh95oGXzrsvpxk2e/jb7ERB6VL6PQw9hS79427lUqzOOGBGZj5i64IcPYUp1paHDXxzs+UH07NUCvnrVumlzZ334h0ajuZqWc+68gKtz+Bq//CSmq4kbrRL/PDbPyalGKPDJySm7n27V+wtJywozshMPqduYl4Ugw/oHDm455A8ryDjEhp3CkV+/HxEYGKC0/XDRyreXLVmVbKeyE8HTPOE0DNmONhS3Gu0f4NPTHP+gOj7JGRwx4icYzRU7kUlfSzMW9+PJJMTLS03MztqahXs1YuuK8tmAqFgp70FM74eXxpeHTvhkR3eKY2wic6K5YmRoWBE51UdI825tuV/7h8Uh1qQzFAf26vusy8zZE1eKdt6+Xl1ooovbt+795fVUXRuC03rzzyecisZBYwoCsvETRgbcupFfunrl1mwSHtIW7EpqduKF5My4VBIG9w3rt7L+g3qtggsRI3t91IvzNq7d/sKVK1drk8bOtaSZ16zc3pw0sdV332/sLYSYzofd7tdj+H/Aw1O2/S0DhX8wlWvFv7eI0jpJqs1gs33brv09ej6TT7wqFKulIbt7utalw5RKxJwO4+yCEGMDFdjILbFCkNFw6k7py0XP8qu0Fm8nl4UTcW1nY81ORHXjPaL2SZcFcxq2xNbUXsSstB0oiCbA5TkWCCMvYQbda9KotCuVkCbTQGYyNCFb3ESh72wmayOlRbePV6L5m5UAOh+sK8wNh4tzxaeLF99lY6KjunGuri7h0BZf/GfZBfhQfDyaNEnPSUgw70o5bm8yuZrDUcdSTXftYL4EaiT5tobZJqXknsq+p52e+wB28vT+cfQyPYtyxOA+nw/oPXwPyiKl5ibE+Xs06UJb9x/OJB4OdXd3aUMmkPX2XWsnNAvu8EGZJDWhZfi62izyouPDRh2v9cabr/iGt2o6UvCa9c7CqfQFo0Gy0ZyJyyg/uiZw/0SuNocelX9qbvwv8F5+suxzv6VLPo211J6EvRZWnCXL5jUb+sKAoaDBh5SYKzyT1JxzRzAvlQQZRNN+kn6Oepq3JXn8gar+JKZBRPQbffnSJ+qEpAgdCTjnt/UbGCt7jkq+lbZwVmQqGPlcaVJWhRBHPcXd6ciG29xDbOecNtIGCm3VkKJLnqiy0JfcbIvxxx7fOc7Gxkpx6G3ZEDNn1rsLEy5cOb6GIkIuPXt3eef5FwaO3LxpByNteTM9Pb7yGO7az7+fPTBR+Km2bIyZPWPa/Pi1m1b0b0FONnt7Oz/0g0Su6oLLSVd+GP/G9G9154uLtZL2lsnGPo6XFjyDB0wx33JCC/8NBoavKQKBogB8noskH89jxs5dOw78MC7h5/VkUjiSQD+1fvPKDi8+/+ZhX0/lawzl5bv70jZ1dHTQTJ0xfr5gv+/HQ4vXr/smC/GC9Ixz6QL+T+aPo5ExrvT0E/BwX7I0RoR9TSajFebgmWc7TgINjk6OG/POKVnLctKzE06SECtNK2+67nKLOipdIEEOp7jI73QKg+lKWE3aDB56N5wPuUvCpInpCazEEM7yS86wQloh7tBVXFLEbpa8REL8fjkdl2Y158NItDOp/XnZimXM/ZW3lJY+WSH2dwttRt5o+6+3r+6C4A/6Tkq6EjNp4uz44pIS05wZi94V4164ZNYSN1cXKyz54hyowFnK+0X0GJGccXpneKuwQRcvJB3YvXPfAgSX6CPVeBK2avUb1huy79COLecuHp1Dx5fgU+wCId70zapnhNdZaGPwb9mq2SgBRx45uK87p1Xgjh3NjrV0FmHm92YtnirGggfYp09XV5PRFIBNIeDGohstke/9edtrCNmifC0l/YdXXxz3Cxy76dfPVz4DC4L/sYQvkhFh+HT1h62EEP+45+dFEGJ8xp6enXhSfUsWBRkEM45KubIDe5qE+DsE9XSlNM2lbMv0YP4OxaJIzsm+ePd6DivMb8vu6GKYviyJFRq7Se/d+hq4KMa104PZLBLgDXRiRkPhbU5h7s03PNgx4J9UCvBsGqDnBh/YoO07PDUefEtLyzK7tI9Yh80dQtTr1m7JPHL4+HLg6GxB9f2Hy0M1CNtg5wx4VUnWaO1bNn12YJBfizf69hr+5Zujpqx5PnLUp43rtZvVtFHHCBFAdHFxDlu28v1w8JEljf6FIaN/FseJ8DGe4I9wvYAj37Z113XZVnsaZxUyM8+nkYJJw5Gjn386/JFos3Tl+3NQ1nMpDB/aGbmpxkfL329Wu46fcqiD7je7U9u+n0M72jr5nhDt/ldzH7fgIJOJ+0+aNjaw34AeihI6ezph7YiX3zpGk3sjI/fsWfN7q1KQQUibvNIF51kECfMysmuNlFPUjy2sHchWvhzAyXNM9aWshDTsQOmD0vrShwWKkI704vZFddkXRDuXhJgsELKYS9n7CxKkF1b8KNFr8WQS3Gw6g74JztRNeefNDwXXyeNnzSIBI88gl40GpkRyhg4aeeD69RvKQ8aSHbNrfS+Exvy8yn9OQ7Q1z2kCd+D8BDZnGdcTTqTmJCTjRKgky3nQntezc0+JNl7etRT7WqM1XcOuX9ZoKnlvBB1yrdb6CmhwqU2cjNzEs/A2vPj82Nj0tMz9oLWzt/Pfd3DbYNjntJmr06x5Ywf6ZEIRbuBHvz5lWplOp7jrnvRxZPD/byZ8IE0u3IZ16wbaTpw8Zgn6pjBiQq9uQ2Po6/SyjJwEiy/qfQW5/AYkvviyNIEEcgIFqstweou07GgXA4sZ6cxrlNP89X9MDe7sILM9JK4v60CrYyUlejZy0Z/SrL+oHr8EB7w4q7hr78ZZcLMJritXL16jXr5FGZsoQdOqTfNRM2ZNrGvU81pVfXUGWnoZlN2seqOl8PgH/dFWtm4noF07te33KX0GmIv+GjdpOIzs4SCUN2xZ9Q5lyrPbuuW7uT/tPXjLykq6bMmzAfr/pVQs3WmG8W785rMRlCkr//w50eWrKWPx9zyHuzenvZs/MItOl1a85cGvajjbpJNYdYpd97C3YkfH2fGeK0qkdDCg3x4JoI3fXknH6hMNRnFLx9igZTnSwQd28IgExw9fpO9PTVbQVOR6CkFzslvP0pI/+36scLwRp+9A88a4Vxbt2bV3WHz8hUb0uzm3yn9i4H6tVbgHmCQqykcuptBX2/6uYXFk37d4+413pn62Jvo/YPLm+Nfmt+/QZouzs5PiL066dHnrhHEz4xB8QLDnkTv6hxuQtyWAPESKXV9VV5JReyM193QWBNTXlT4Y4boaeGF9fL26og3cbF9vjsmRtdqcq9nxVX6R9NCCDKYf50jfv+3EO5gYHYbjzItATZg1OzVG5t3IFrWmjeGPpL9cCQ8HXYpGw3rQB38XUX2SCd8ilOmMrouXzAmBpgJvsnUNg/u/shBlnMC2dD7Wzy24HTaAzVuFxtSrFxhBk6fd+u1X8+rXaT2Jlcmt6ZzVHQMYPKEk0SecYEVnd/WCpZNzjZoKjII28FrgvK9tDftjly//dkfQIL+WF5dF9nDyrl37WLeYZ+b3j+g5kzaX9s2aN3kV+OLC4iud2vXfiMMqdYJdfk2NBfT/jfTc0P49unXrVKXQiVEWFhUXvT12xgHaK+jpxf3doNH7IUjWf0DPZwXNvh8OHkFZMsiKshRw8/yRBBmNl+VLZ0fb8ZayzH4krdyEnpQnudbiKRxMAbry9Y5gJwnfOzpfUpZF804fp46dOwlxvY5dnnZ64aVIRbOC39ovN8/GAW9ZsrpoSYhBU82dnczPkbpiI5iUcrK1ra2Nl2M1x7oHf/lueOd2/TeYmEnxAID2iSSDdQbZVp6ff7J214IPZ3YnnnLdunUiyNSJuMvfSC/fi8eOnepAp6EOnss5Rydc/kp0EDORfuXOZeyoqSeDmzSIQVtg8Q3K4IGvzkSZW9vd87sdgP+3Ejw05n3hFxroMgffU6f7KBs4uM8fy5euTjFKRkf6ks4FRJ61PJojL7hTePH99z5Kwsuael3R2gBbTPcMwiKVBeBkxh0KtGw7mQ/dhbeUynihvrU2sKEr2JPb1Km7h238a+ylp4zc6IRNXsdObV3JTswqKCw0kUeCNmLxiWp68zLOBpTeLm5LGydt377dXJycnazhewUd/K/YLZPmk8aOf80/LSW96Ntvf8jFRGodXA5iyRf88Es5xQZda0GbkZZVtGP77ntocaKXlRW3wQOv5ugot+vUyqluUGB18CGT5hZ+jwuOfRx0FbzVOcLQaz7Z0Q6eCsDRHzayiodCI58URwXVbR6l/Lghavw6hYGZsDr/rYSNLSKQcfS7AwiOSGWF4eJewRAmRVAD59MPOjPytwUZncAN5yyzhVacDSFlbDJIbO1qkzQXuP9Gql+/bTXj7WLbUq1t4V3H+kN3q5zWOnq5Jn05Jdm6GvMTExPJnC9PCDgYC2/X1Mp6o38j1xv3m0Q1LT5wu985DghlzGcxdqUaKzvSRpLJXtaFhdUpND8mLsZhKQcPuhSTxRL+UWFCkM3bPexZC/N2/9b/nYF/Z+AxZuD/AA8zEhkTLyOGAAAAAElFTkSuQmCC');
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 2px;
}
.l7-control-layers-toggle {
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAkCAYAAAGf7Ah0AAAABGdBTUEAALGPC/xhBQAABzdJREFUWAnVV3lslEUUn/l2F0tpwdAih1HEqCReDcphNCo1EkgFkXa5PNpuC0Fo2e7Wgko8KiaKWrvbK5672xYFpNtiRRuNiY0aURA14BGviBcVlaKltVa6+42/N9v5Mrtt05rwj/PHzjt+8743b+a9N8vYwKgMNlUQyemnMtAkaJajvb3dToQSGp8e6boopkr4VYgEMYwO0vhCTfMVzBcMf8bx086YyODcuM80zTqp9IWat+7evW8sMdIxIqqCLa6oiAaJpuEtcBqcc2HEWMZ0JclgZR/Nchf++ubrzKjJSguXS4tVjXvPjfb3/UAAacGTn/MOMb7QnjNpNqP/bKZ50Ai0tqYmCi0n4zbM+W+lBc7JBOa+QPhDwcTsxJXE2+32edKCL9h8hRDmRzpIOWydAylhrcMfDN+ugBRKSdP3KwPhsFJIPth02FISIYQwYsDYcVfWhy/Bon4JgumffMGmiGTwQ0B/sHml4q2ZFAD3WQIQVhx0IdFw8B189lolN+w8w5PnjPmlhJgtA8/vfn3iye7u3yGzDljDxZEG4097Cp3rSSjBtMHunp6vFR+HHoIxmbgTe1xHKssDHecLNFUjMzbqMs5ZlHF7ute17M84+TMHDzr+OvR9JwKdCms9yRkzJq6bPTsWXh05QOPUN+PUHyPWMPhm6UHd7vaUohWZPSRE8OqxpTyibQa/qcTlbEP0vwF7AWUAT3JM9dy69FfSNza+MU4awNE8iQtXSkJuGLleV852ov2h5jkwVof0mUs8aO4LhTuYYFOAjExId0wcFIPahpaLTkWiX9ECfHG/sLNi1i8+HODfgLFFRI96+INNi0cNTgTS1obKQh03aAuk9DeELzcj4pACYivvwvXrFK/PcQZiQWo+hmidpYMUjQC7EOB6xdNsGfAHwk/RDdOVw9Dm+NTUSWtWLDohDVQ37JkbiUT2DwMeVswZP+gtdM4x3HnLDhjcGM2XLWOISaenIGee9MCSgqgMht/H/q/SZYk0qviV3oKcj5XcioESyOoqIseFYDYloxnAGm/hcrcuk3JV2XBMl+pKqn6mENux11+w12m6jpqMMFn7rPPTHdwfCm8yTfG4tMaNu+GepPUFiqbM7T105ARSPQU+dY/LOC/N2gI65WEkyWUEtjmSppfkLvlRLaQ5VnZFDtGGzbheNRROKZmbu/AvUvh3tE4Wff2/0IUC+y2q+4VVoXBW1BSvkR7Rb8BW84lWJQBdlGozcs7GLy3Nd35OSqTxBqtfgkc1+sPjcqbDgEl6xK0dH5lv545LOCVL1/F+3CoY4eyY1+WcBiC2KYEHQBd5XDkyndE17xCm2Ug6BLcSwb3LigE1AlOYu6TS4HUwVEw0Df1osfBnLDwnpiFDCQPuvQ73Fkqxg8/hEVYLXt66MXbbzOK8bKre1hhkgDT0RDja3fEHytwZxCMLH0YWPkD0fxqjqUZDejDSV3z1LbexqPkEPJxKWLqtKOGbvPnZL460NlE/KgfkIZiRrfjShsQcG2QQDUwwXjcuZcID61Ys6ErUJ/LDOiCfLUzUjVQdEg0O4jn/ABEq0iuIjrEcwE0x/KGWNbjPj4BO00Gni0ZOoIPzLR5X9vMqqaQDqDzzENra4V5zp8sBZQcROYjsLvYUOPdbEVBKeiZ193QjCmwtZCM+ldS6EWYTH3wuNSV1i+pFCj/IAaWgGUfBq0N78qPM3DZcp9TxcTQeyzZm3ON2LatXpSlOP8BIB6qDLddHmHnFrBlpNZmZmdZbNXEB9XsRlZXFennqGHzoXW5DaId4iSoc/Q365EjnRjszPnYXZL9NDWUtGsqzCjAw7xprTypbn7fkaILcYqkInzzeX06C8emO8sKlS7stZQLxVMPes/+O9FVAvEpXob+utY6gZmfrtMjf/RUI+2odhF7wJbq+Gzf3zTj5CAwyaoEwozVoCzN1KKK00z7WUbZx9dIOklsO6CAZpu87i5gpHoJ8gtLh9vZixSO2KckV7qysf5Sc5uq2tjOix3rL0FW3IJuSNV0XM/iDs85LqxvqeKUD8n3LxUobt5WVuLJlS9IM4O9i09VRwWtxLWfpcix+hXjs8mZdjn19YuOiuKRgufzXqOuqQi2r8O+yAk/tl2Q/RMW7ETe8UdX1GJhHDM5qjDHJ5e7bs07qBp7ZsTe9t6/vUXykkLKEdLFbLgLJSUn3rrt1yXEdX/1C23jzVG+5Keg/B5r2wJD9g/NcaUAJq4MvXxxl/TWoATcoGc0Av4eUKnIXZlsvXpLHO0CS2KgOtGQgdeuwqWuUjGbUgrdszLHRXXDLF0oe54AS0kyPnc5Iz/2CmV7EeIzSwcjvsHQPXkUhld/kCP6Xu+DRNjg/SWHh+SnODF+aPeVh9XCydAPEsA4kAqsCzcuiTPiw7+maTj6SwGsVk/9gY9xbUpizR8MNS47aAd0C7s35CG8VdrxYyjl/FcdUgo73nY77X9D/Au9RDMh+aBoVAAAAAElFTkSuQmCC');
  width: 30px;
  height: 30px;
  background-size: 20px 20px;
}

.l7-touch .l7-control-layers-toggle {
  width: 44px;
  height: 44px;
}
.l7-control-layers .l7-control-layers-list,
.l7-control-layers-expanded .l7-control-layers-toggle {
  display: none;
}
.l7-control-layers-expanded .l7-control-layers-list {
  display: block;
  position: relative;
}
.l7-control-layers-expanded {
  padding: 6px 10px 6px 6px;
  color: #59626b;
  background: #fff;
}
.l7-control-layers-scrollbar {
  overflow-y: scroll;
  overflow-x: hidden;
  padding-right: 5px;
}
.l7-control-layers-selector {
  margin-top: 2px;
  position: relative;
  top: 1px;
}
.l7-control-layers label {
  display: block;
  padding: 8px;
}
.l7-control-layers label input[type='radio'],
.l7-control-layers label input[type='checkbox'] {
  width: 14px;
  height: 14px;
  margin: 0;
}
.l7-control-layers-separator {
  height: 0;
  border-top: 1px solid #d8d8d8;
  margin: 5px -10px 5px -6px;
}
.mapboxgl-ctrl-logo {
  display: none !important;
}
.amap-logo {
  display: none !important;
}
`);var uE=U(52353),lE=U.n(uE),cE=U(13218),Qu=U.n(cE),Yh,Zg=(Yh={},(0,A.Z)(Yh,wc.additive,{enable:!0,func:{srcRGB:G.ONE,dstRGB:G.ONE,srcAlpha:1,dstAlpha:1}}),(0,A.Z)(Yh,wc.none,{enable:!1}),(0,A.Z)(Yh,wc.normal,{enable:!0,func:{srcRGB:G.SRC_ALPHA,dstRGB:G.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),(0,A.Z)(Yh,wc.subtractive,{enable:!0,func:{srcRGB:G.ONE,dstRGB:G.ONE,srcAlpha:G.ZERO,dstAlpha:G.ONE_MINUS_SRC_COLOR},equation:{rgb:G.FUNC_SUBTRACT,alpha:G.FUNC_SUBTRACT}}),(0,A.Z)(Yh,wc.max,{enable:!0,func:{srcRGB:G.ONE,dstRGB:G.ONE},equation:{rgb:G.MAX_EXT}}),(0,A.Z)(Yh,wc.min,{enable:!0,func:{srcRGB:G.ONE,dstRGB:G.ONE},equation:{rgb:G.MIN_EXT}}),Yh),fE=U(81763),fa=U.n(fE),GP=1024;function sl(e,i,r,n,a){i.updateStyleAttribute(e,r,n,a)}function hE(e,i){e.opacity&&Bv("opacity",i,e.opacity),e.strokeWidth&&Bv("strokeWidth",i,e.strokeWidth),e.strokeOpacity&&Bv("strokeOpacity",i,e.strokeOpacity),e.stroke&&pE("stroke",i,e.stroke),e.offsets&&jg("offsets",i,e.offsets),e.textOffset&&jg("textOffset",i,e.textOffset),e.thetaOffset&&Bv("thetaOffset",i,e.thetaOffset)}function Bv(e,i,r){vo()(r)?sl(e,i,r,function(n){return n}):fa()(r)?sl(e,i,[r],void 0):Array.isArray(r)&&r.length===2?vo()(r[0])&&ru()(r[1])||vo()(r[0])&&Array.isArray(r[1])&&fa()(r[1][0])&&fa()(r[1][1])?sl(e,i,r[0],r[1]):sl(e,i,[1],void 0):sl(e,i,[1],void 0)}function jg(e,i,r){vo()(r)?sl(e,i,r,function(n){return n}):Array.isArray(r)&&r.length===2&&vo()(r[0])&&ru()(r[1])?sl(e,i,r[0],r[1]):Array.isArray(r)&&r.length===2&&fa()(r[0])&&fa()(r[1])?sl(e,i,r,void 0):sl(e,i,[0,0],void 0)}function pE(e,i,r){vo()(r)?sl(e,i,r,void 0):Array.isArray(r)&&r.length===2&&(vo()(r[0])&&ru()(r[1])||vo()(r[0])&&Array.isArray(r[1])&&r[1].length>0)?sl(e,i,r[0],r[1]):sl(e,i,"#fff",void 0)}var js;(function(e){e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.L7MAP="L7MAP",e.SIMPLE="SIMPLE",e.GLOBEL="GLOBEL"})(js||(js={}));function dE(e,i){var r=[i[0]-e[0],i[1]-e[1]],n=cu(r),a=[e[0]+n[0]*1e-4,e[1]+n[1]*1e-4];return a}function vE(e,i){var r=this;e.length>0&&i.version===js["GAODE2.x"]&&(typeof e[0].coordinates[0]=="number"?e.filter(function(n){return!n.originCoordinates}).map(function(n){n.version=js["GAODE2.x"],n.originCoordinates=cloneDeep(n.coordinates),n.coordinates=r.mapService.lngLatToCoord(n.coordinates)}):e.filter(function(n){return!n.originCoordinates}).map(function(n){n.version=js["GAODE2.x"],n.originCoordinates=cloneDeep(n.coordinates),n.coordinates=r.mapService.lngLatToCoords(n.coordinates)}))}function mE(e,i){e.length>0&&i.version===js.SIMPLE&&e.map(function(r){r.simpleCoordinate||(r.coordinates=gE(r.coordinates,i),r.simpleCoordinate=!0)})}function gE(e,i){if(typeof e[0]=="number")return i.simpleMapCoord.unproject(e);if(e[0]&&e[0][0]instanceof Array){var r=[];return e.map(function(a){var s=[];a.map(function(f){s.push(i.simpleMapCoord.unproject(f))}),r.push(s)}),r}else{var n=[];return e.map(function(a){n.push(i.simpleMapCoord.unproject(a))}),n}}function yE(e,i,r){var n;if(!e.scale)return[];var a=(e==null||(n=e.scale)===null||n===void 0?void 0:n.scalers)||[],s=[];a.forEach(function(v){var g,x=v.field;(i.hasOwnProperty(x)||((g=e.scale)===null||g===void 0?void 0:g.type)==="variable")&&s.push(i[x])});var f=e.mapping?e.mapping(s):[];return e.name==="color"&&!al(f[0])?[r]:f}function _E(e,i,r,n,a,s){var f=s==null?void 0:s.getLayerConfig(),v=f.arrow,g=v===void 0?{enable:!1}:v,x=i.map(function(C){var T={id:C._id,coordinates:C.coordinates};if(e.filter(function(j){return j.scale!==void 0}).forEach(function(j){var X=yE(j,C,a);j.needRemapping=!1,j.name==="color"&&(X=X.map(function(te){return Ji(te)})),T[j.name]=Array.isArray(X)&&X.length===1?X[0]:X,j.name==="shape"&&(T.shape=r.getIconFontKey(T[j.name]))}),T.shape==="line"&&g.enable){var O=T.coordinates,k=dE(O[0],O[1]);T.coordinates.splice(1,0,k,k)}return T});return vE(x,n),mE(x,n),x}function xE(e,i,r,n,a,s){var f=new Vl(a,s),v=e.getBottomColor(),g=n.getLayerStyleAttributes()||[],x=f.data.dataArray,C=x,T=_E(g,C,i,r,v,e);return f.destroy(),T}function Vg(e){return e.map(function(i){return typeof i=="string"&&(i=[i,{}]),i})}function Gg(e,i,r,n){var a=e.multiPassRenderer,s=e.getLayerConfig(),f=s.enablePicking,v=s.enableTAA;return v?a.add(n("taa")):a.add(n("render")),Vg(i).forEach(function(g){var x=(0,on.Z)(g,2),C=x[0],T=x[1];a.add(r(C),T)}),a.add(r("copy")),a}var bE=[["circle","cylinder"],["square","cylinder"],["triangle","cylinder"],["pentagon","cylinder"],["hexagon","cylinder"],["octogon","cylinder"],["hexagram","cylinder"],["rhombus","cylinder"],["vesica","cylinder"]];function EE(e,i,r){if(typeof i=="string"&&typeof r=="string"&&i!==r){if(e.type==="PointLayer"){e.dataState.dataSourceNeedUpdate=!0;return}bE.map(function(n){if(n.includes(i)&&n.includes(r)){e.dataState.dataSourceNeedUpdate=!0;return}})}}var SE=["passes"],CE=["moduleName","vertexShader","fragmentShader","triangulation","segmentNumber"],Hg,F0,Wg;function AE(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=wE(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function wE(e,i){if(!!e){if(typeof e=="string")return Xg(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Xg(e,i)}}function Xg(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function Yg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Ju(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Yg(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Yg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function TE(e){var i=ME();return function(){var n=(0,Mt.Z)(e),a;if(i){var s=(0,Mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,wr.Z)(this,a)}}function ME(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var qg=0,qh=(Hg=k0(Ht.IGlobalConfigService),F0=function(e){(0,Ir.Z)(r,e);var i=TE(r);function r(){var n,a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,ht.Z)(this,r),n=i.call(this),(0,A.Z)((0,ne.Z)(n),"id","".concat(qg++)),(0,A.Z)((0,ne.Z)(n),"name","".concat(qg)),(0,A.Z)((0,ne.Z)(n),"type",void 0),(0,A.Z)((0,ne.Z)(n),"visible",!0),(0,A.Z)((0,ne.Z)(n),"zIndex",0),(0,A.Z)((0,ne.Z)(n),"minZoom",void 0),(0,A.Z)((0,ne.Z)(n),"maxZoom",void 0),(0,A.Z)((0,ne.Z)(n),"inited",!1),(0,A.Z)((0,ne.Z)(n),"layerModelNeedUpdate",!1),(0,A.Z)((0,ne.Z)(n),"pickedFeatureID",null),(0,A.Z)((0,ne.Z)(n),"selectedFeatureID",null),(0,A.Z)((0,ne.Z)(n),"styleNeedUpdate",!1),(0,A.Z)((0,ne.Z)(n),"rendering",void 0),(0,A.Z)((0,ne.Z)(n),"clusterZoom",0),(0,A.Z)((0,ne.Z)(n),"layerType",void 0),(0,A.Z)((0,ne.Z)(n),"isLayerGroup",!1),(0,A.Z)((0,ne.Z)(n),"triangulation",void 0),(0,A.Z)((0,ne.Z)(n),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),(0,A.Z)((0,ne.Z)(n),"hooks",{init:new wh,afterInit:new wh,beforeRender:new wh,beforeRenderData:new Pd,afterRender:new Ps,beforePickingEncode:new Ps,afterPickingEncode:new Ps,beforeHighlight:new Ps(["pickedColor"]),afterHighlight:new Ps,beforeSelect:new Ps(["pickedColor"]),afterSelect:new Ps,beforeDestroy:new Ps,afterDestroy:new Ps}),(0,A.Z)((0,ne.Z)(n),"models",[]),(0,A.Z)((0,ne.Z)(n),"multiPassRenderer",void 0),(0,A.Z)((0,ne.Z)(n),"plugins",void 0),(0,A.Z)((0,ne.Z)(n),"sourceOption",void 0),(0,A.Z)((0,ne.Z)(n),"layerModel",void 0),(0,A.Z)((0,ne.Z)(n),"shapeOption",void 0),(0,A.Z)((0,ne.Z)(n),"sceneContainer",void 0),(0,A.Z)((0,ne.Z)(n),"layerChildren",[]),(0,A.Z)((0,ne.Z)(n),"masks",[]),Ui((0,ne.Z)(n),"configService",Wg,(0,ne.Z)(n)),(0,A.Z)((0,ne.Z)(n),"shaderModuleService",void 0),(0,A.Z)((0,ne.Z)(n),"cameraService",void 0),(0,A.Z)((0,ne.Z)(n),"coordinateService",void 0),(0,A.Z)((0,ne.Z)(n),"iconService",void 0),(0,A.Z)((0,ne.Z)(n),"fontService",void 0),(0,A.Z)((0,ne.Z)(n),"pickingService",void 0),(0,A.Z)((0,ne.Z)(n),"rendererService",void 0),(0,A.Z)((0,ne.Z)(n),"layerService",void 0),(0,A.Z)((0,ne.Z)(n),"interactionService",void 0),(0,A.Z)((0,ne.Z)(n),"mapService",void 0),(0,A.Z)((0,ne.Z)(n),"styleAttributeService",void 0),(0,A.Z)((0,ne.Z)(n),"layerSource",void 0),(0,A.Z)((0,ne.Z)(n),"postProcessingPassFactory",void 0),(0,A.Z)((0,ne.Z)(n),"normalPassFactory",void 0),(0,A.Z)((0,ne.Z)(n),"animateOptions",{enable:!1}),(0,A.Z)((0,ne.Z)(n),"container",void 0),(0,A.Z)((0,ne.Z)(n),"encodedData",void 0),(0,A.Z)((0,ne.Z)(n),"configSchema",void 0),(0,A.Z)((0,ne.Z)(n),"currentPickId",null),(0,A.Z)((0,ne.Z)(n),"rawConfig",void 0),(0,A.Z)((0,ne.Z)(n),"needUpdateConfig",void 0),(0,A.Z)((0,ne.Z)(n),"pendingStyleAttributes",[]),(0,A.Z)((0,ne.Z)(n),"scaleOptions",{}),(0,A.Z)((0,ne.Z)(n),"animateStartTime",void 0),(0,A.Z)((0,ne.Z)(n),"aniamateStatus",!1),(0,A.Z)((0,ne.Z)(n),"bottomColor","rgba(0, 0, 0, 0)"),(0,A.Z)((0,ne.Z)(n),"isDestroied",!1),(0,A.Z)((0,ne.Z)(n),"sourceEvent",function(){n.dataState.dataSourceNeedUpdate=!0;var s=n.getLayerConfig(),f=s.autoFit,v=s.fitBoundsOptions;f&&n.fitBounds(v),n.reRender()}),n.name=a.name||n.id,n.zIndex=a.zIndex||0,n.rawConfig=a,n}return(0,Pt.Z)(r,[{key:"addMaskLayer",value:function(a){this.masks.push(a)}},{key:"removeMaskLayer",value:function(a){var s=this.masks.indexOf(a);s>-1&&this.masks.splice(s,1),a.destroy()}},{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(a){if(!this.inited)this.needUpdateConfig=Ju(Ju({},this.needUpdateConfig),a);else{var s=this.container.get(Ht.SceneID);hE(a,this),this.configService.setLayerConfig(s,this.id,Ju(Ju(Ju({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),a)),this.needUpdateConfig={}}}},{key:"setContainer",value:function(a,s){this.container=a,this.sceneContainer=s}},{key:"getContainer",value:function(){return this.container}},{key:"setBottomColor",value:function(a){this.bottomColor=a}},{key:"getBottomColor",value:function(){return this.bottomColor}},{key:"addPlugin",value:function(a){return this.plugins.push(a),this}},{key:"init",value:function(){var a=this,s=this.container.get(Ht.SceneID);this.configService.setLayerConfig(s,this.id,this.rawConfig),this.layerType=this.rawConfig.layerType,this.iconService=this.container.get(Ht.IIconService),this.fontService=this.container.get(Ht.IFontService),this.rendererService=this.container.get(Ht.IRendererService),this.layerService=this.container.get(Ht.ILayerService),this.interactionService=this.container.get(Ht.IInteractionService),this.pickingService=this.container.get(Ht.IPickingService),this.mapService=this.container.get(Ht.IMapService);var f=this.getLayerConfig(),v=f.enableMultiPassRenderer,g=f.passes;v&&g!==null&&g!==void 0&&g.length&&g.length>0&&this.mapService.on("mapAfterFrameChange",function(){a.renderLayers()}),this.cameraService=this.container.get(Ht.ICameraService),this.coordinateService=this.container.get(Ht.ICoordinateSystemService),this.shaderModuleService=this.container.get(Ht.IShaderModuleService),this.postProcessingPassFactory=this.container.get(Ht.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(Ht.IFactoryNormalPass),this.styleAttributeService=this.container.get(Ht.IStyleAttributeService),this.multiPassRenderer=this.container.get(Ht.IMultiPassRenderer),this.multiPassRenderer.setLayer(this),this.pendingStyleAttributes.forEach(function(O){var k=O.attributeName,j=O.attributeField,X=O.attributeValues,te=O.updateOptions;a.styleAttributeService.updateStyleAttribute(k,{scale:Ju({field:j},a.splitValuesAndCallbackInAttribute(X,a.getLayerConfig()[k]))},te)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(Ht.ILayerPlugin);var x=AE(this.plugins),C;try{for(x.s();!(C=x.n()).done;){var T=C.value;T.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}}catch(O){x.e(O)}finally{x.f()}return this.hooks.init.call(),this.hooks.afterInit.call(),this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this}},{key:"updateModelData",value:function(a){a.attributes&&a.elements?this.models.map(function(s){s.updateAttributesAndElements(a.attributes,a.elements)}):console.warn("data error")}},{key:"createModelData",value:function(a,s){if(this.layerModel.createModelData)return this.layerModel.createModelData(s);var f=this.calculateEncodeData(a,s),v=this.triangulation;return f&&v?this.styleAttributeService.createAttributesAndIndices(f,v):{attributes:void 0,elements:void 0}}},{key:"calculateEncodeData",value:function(a,s){return this.inited?xE(this,this.fontService,this.mapService,this.styleAttributeService,a,s):(console.warn("layer not inited!"),null)}},{key:"prepareBuildModel",value:function(){this.inited=!0,this.updateLayerConfig(Ju(Ju({},this.getDefaultConfig()),this.rawConfig));var a=this.getLayerConfig(),s=a.animateOption;s!=null&&s.enable&&(this.layerService.startAnimate(),this.aniamateStatus=!0)}},{key:"color",value:function(a,s,f){return this.updateStyleAttribute("color",a,s,f),this}},{key:"texture",value:function(a,s,f){return this.updateStyleAttribute("texture",a,s,f),this}},{key:"rotate",value:function(a,s,f){return this.updateStyleAttribute("rotate",a,s,f),this}},{key:"size",value:function(a,s,f){return this.updateStyleAttribute("size",a,s,f),this}},{key:"filter",value:function(a,s,f){return this.updateStyleAttribute("filter",a,s,f),this}},{key:"shape",value:function(a,s,f){var v,g,x,C=(v=this.styleAttributeService)===null||v===void 0||(g=v.getLayerStyleAttribute("shape"))===null||g===void 0||(x=g.scale)===null||x===void 0?void 0:x.field,T=a;return this.shapeOption={field:a,values:s},this.updateStyleAttribute("shape",a,s,f),EE(this,C,T),this}},{key:"label",value:function(a,s,f){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:a,attributeValues:s,updateOptions:f}),this}},{key:"animate",value:function(a){var s={};return Qu()(a)?(s.enable=!0,s=Ju(Ju({},s),a)):s.enable=a,this.updateLayerConfig({animateOption:s}),this}},{key:"source",value:function(a,s){return a!=null&&a.data?(this.setSource(a),this):(this.sourceOption={data:a,options:s},this.clusterZoom=0,this)}},{key:"setData",value:function(a,s){var f=this;return this.inited?this.layerSource.setData(a,s):this.on("inited",function(){var v=f.getSource();v?f.layerSource.setData(a,s):(f.source(new Vl(a,s)),f.sourceEvent())}),this}},{key:"style",value:function(a){var s=this,f=this.getLayerConfig(),v=a.passes,g=(0,Cc.Z)(a,SE);return v&&Vg(v).forEach(function(x){var C=s.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(x[0]);C&&C.updateOptions(x[1])}),this.rawConfig=Ju(Ju({},this.rawConfig),g),this.container&&(this.updateLayerConfig(this.rawConfig),this.styleNeedUpdate=!0),f&&f.mask===!0&&a.mask===!1&&(this.clearModels(),this.models=this.layerModel.buildModels()),this}},{key:"scale",value:function(a,s){return Qu()(a)?this.scaleOptions=Ju(Ju({},this.scaleOptions),a):this.scaleOptions[a]=s,this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.renderLayers(),this.rendering=!1}},{key:"render",value:function(){return this.getEncodedData().length!==0&&this.renderModels(),this}},{key:"renderMultiPass",value:function(){var n=(0,P.Z)(N().mark(function s(){return N().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(this.getEncodedData().length===0){v.next=7;break}if(!(this.multiPassRenderer&&this.multiPassRenderer.getRenderFlag())){v.next=6;break}return v.next=4,this.multiPassRenderer.render();case 4:v.next=7;break;case 6:this.multiPassRenderer?this.renderModels():this.renderModels();case 7:case"end":return v.stop()}},s,this)}));function a(){return n.apply(this,arguments)}return a}()},{key:"active",value:function(a){var s={};return s.enableHighlight=Qu()(a)?!0:a,Qu()(a)?(s.enableHighlight=!0,a.color&&(s.highlightColor=a.color),a.mix&&(s.activeMix=a.mix)):s.enableHighlight=!!a,this.updateLayerConfig(s),this}},{key:"setActive",value:function(a,s){var f=this;if(Qu()(a)){var v=a.x,g=v===void 0?0:v,x=a.y,C=x===void 0?0:x;this.updateLayerConfig({highlightColor:Qu()(s)?s.color:this.getLayerConfig().highlightColor,activeMix:Qu()(s)?s.mix:this.getLayerConfig().activeMix}),this.pick({x:g,y:C})}else this.updateLayerConfig({pickedFeatureID:a,highlightColor:Qu()(s)?s.color:this.getLayerConfig().highlightColor,activeMix:Qu()(s)?s.mix:this.getLayerConfig().activeMix}),this.hooks.beforeSelect.call(hu(a)).then(function(){setTimeout(function(){f.reRender()},1)})}},{key:"select",value:function(a){var s={};return s.enableSelect=Qu()(a)?!0:a,Qu()(a)?(s.enableSelect=!0,a.color&&(s.selectColor=a.color),a.mix&&(s.selectMix=a.mix)):s.enableSelect=!!a,this.updateLayerConfig(s),this}},{key:"setSelect",value:function(a,s){var f=this;if(Qu()(a)){var v=a.x,g=v===void 0?0:v,x=a.y,C=x===void 0?0:x;this.updateLayerConfig({selectColor:Qu()(s)?s.color:this.getLayerConfig().selectColor,selectMix:Qu()(s)?s.mix:this.getLayerConfig().selectMix}),this.pick({x:g,y:C})}else this.updateLayerConfig({pickedFeatureID:a,selectColor:Qu()(s)?s.color:this.getLayerConfig().selectColor,selectMix:Qu()(s)?s.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call(hu(a)).then(function(){setTimeout(function(){f.reRender()},1)})}},{key:"setBlend",value:function(a){return this.updateLayerConfig({blend:a}),this.layerModelNeedUpdate=!0,this.reRender(),this}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this}},{key:"hide",value:function(){return this.type==="CanvasLayer"&&this.layerModel.clearCanvas&&this.layerModel.clearCanvas(),this.updateLayerConfig({visible:!1}),this.reRender(),this}},{key:"setIndex",value:function(a){return this.zIndex=a,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}},{key:"setCurrentPickId",value:function(a){this.currentPickId=a}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(a){this.selectedFeatureID=a}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var a=this.mapService.getZoom(),s=this.getLayerConfig(),f=s.visible,v=s.minZoom,g=v===void 0?-Infinity:v,x=s.maxZoom,C=x===void 0?Infinity:x;return!!f&&a>=g&&a<=C}},{key:"setMultiPass",value:function(a,s){if(this.updateLayerConfig({enableMultiPassRenderer:a}),s&&this.updateLayerConfig({passes:s}),a){var f=this.getLayerConfig(),v=f.passes,g=v===void 0?[]:v;this.multiPassRenderer=Gg(this,g,this.postProcessingPassFactory,this.normalPassFactory),this.multiPassRenderer.setRenderFlag(!0);var x=this.rendererService.getViewportSize(),C=x.width,T=x.height;this.multiPassRenderer.resize(C,T)}return this}},{key:"setMinZoom",value:function(a){return this.updateLayerConfig({minZoom:a}),this}},{key:"getMinZoom",value:function(){var a=this.getLayerConfig(),s=a.minZoom;return s}},{key:"getMaxZoom",value:function(){var a=this.getLayerConfig(),s=a.maxZoom;return s}},{key:"get",value:function(a){var s=this.getLayerConfig();return s[a]}},{key:"setMaxZoom",value:function(a){return this.updateLayerConfig({maxZoom:a}),this}},{key:"setAutoFit",value:function(a){return this.updateLayerConfig({autoFit:a}),this}},{key:"fitBounds",value:function(a){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var s=this.getSource(),f=s.extent,v=f.some(function(g){return Math.abs(g)===Infinity});return v?this:(this.mapService.fitBounds([[f[0],f[1]],[f[2],f[3]]],a),this)}},{key:"destroy",value:function(){var a;this.isDestroied||(this.layerChildren.map(function(s){return s.destroy()}),this.layerChildren=[],this.masks.map(function(s){return s.destroy()}),this.masks=[],this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),this.multiPassRenderer.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),(a=this.layerModel)===null||a===void 0||a.clearModels(),this.models=[],this.layerService.cleanRemove(this),this.emit("remove",{target:this,type:"remove"}),this.emit("destroy",{target:this,type:"destroy"}),this.removeAllListeners(),this.isDestroied=!0)}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){this.models.forEach(function(a){return a.destroy()}),this.layerModel.clearModels(),this.models=[]}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(a){return a.needRescale||a.needRemapping||a.needRegenerateVertices}).length}},{key:"setSource",value:function(a){if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=a,this.clusterZoom=0,this.inited&&this.layerSource.cluster){var s=this.mapService.getZoom();this.layerSource.updateClusterData(s)}this.layerSource.on("update",this.sourceEvent)}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(a){this.encodedData=a}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getScale",value:function(a){return this.styleAttributeService.getLayerAttributeScale(a)}},{key:"getLegendItems",value:function(a){var s=this.styleAttributeService.getLayerAttributeScale(a);if(!s)return[];if(s.invertExtent){var f=s.range().map(function(x){return(0,A.Z)({value:s.invertExtent(x)},a,x)});return f}else if(s.ticks){var v=s.ticks().map(function(x){return(0,A.Z)({value:x},a,s(x))});return v}else if(s!=null&&s.domain){var g=s.domain().filter(function(x){return!lE()(x)}).map(function(x){return(0,A.Z)({value:x},a,s(x))});return g}return[]}},{key:"pick",value:function(a){var s=a.x,f=a.y;this.interactionService.triggerHover({x:s,y:f})}},{key:"boxSelect",value:function(a,s){this.pickingService.boxPickLayer(this,a,s)}},{key:"buildLayerModel",value:function(a){var s=a.moduleName,f=a.vertexShader,v=a.fragmentShader,g=a.triangulation,x=a.segmentNumber,C=(0,Cc.Z)(a,CE);this.shaderModuleService.registerModule(s,{vs:f,fs:v});var T=this.shaderModuleService.getModule(s),O=T.vs,k=T.fs,j=T.uniforms,X=this.rendererService.createModel,te=this.styleAttributeService.createAttributesAndIndices(this.encodedData,g,x),be=te.attributes,Ne=te.elements;return X(Ju({attributes:be,uniforms:j,fs:k,vs:O,elements:Ne,blend:Zg[wc.normal]},C))}},{key:"createAttrubutes",value:function(a){var s=a.triangulation,f=this.styleAttributeService.createAttributes(this.encodedData,s),v=f.attributes;return v}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.aniamateStatus&&(this.layerService.stopAnimate(),this.aniamateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(a){var s=this.getLayerConfig(),f=s.enableHighlight,v=f===void 0?!0:f,g=s.enableSelect,x=g===void 0?!0:g,C=this.eventNames().indexOf(a)!==-1||this.eventNames().indexOf("un"+a)!==-1;return(a==="click"||a==="dblclick")&&x&&(C=!0),a==="mousemove"&&(v||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(C=!0),this.isVisible()&&C}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"rebuildModels",value:function(){throw new Error("Method not implemented.")}},{key:"renderMulPass",value:function(){var n=(0,P.Z)(N().mark(function s(f){return N().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,f.render();case 2:case"end":return g.stop()}},s)}));function a(s){return n.apply(this,arguments)}return a}()},{key:"renderModels",value:function(a){var s=this;return this.getEncodedData().length>0&&(this.layerModelNeedUpdate&&this.layerModel&&(this.models=this.layerModel.buildModels(),this.hooks.beforeRender.call(),this.layerModelNeedUpdate=!1),this.layerModel.renderUpdate&&this.layerModel.renderUpdate(),this.models.forEach(function(f){f.draw({uniforms:s.layerModel.getUninforms()},a)})),this}},{key:"updateStyleAttribute",value:function(a,s,f,v){this.inited?this.styleAttributeService.updateStyleAttribute(a,{scale:Ju({field:s},this.splitValuesAndCallbackInAttribute(f,this.getLayerConfig()[s]))},v):this.pendingStyleAttributes.push({attributeName:a,attributeField:s,attributeValues:f,updateOptions:v})}},{key:"getShaderPickStat",value:function(){return this.layerService.getShaderPickStat()}},{key:"setEarthTime",value:function(a){console.warn("empty fn")}},{key:"getConfigSchema",value:function(){throw new Error("Method not implemented.")}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"reRender",value:function(){this.inited&&(this.layerService.updateLayerRenderList(),this.layerService.renderLayers())}},{key:"splitValuesAndCallbackInAttribute",value:function(a,s){return{values:ru()(a)?void 0:a||s,callback:ru()(a)?a:void 0}}}]),r}(Mn.EventEmitter),Wg=jn(F0.prototype,"configService",[Hg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),F0),PE=U(18446),dd=U.n(PE),Kg,B0,$g;function IE(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=OE(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function OE(e,i){if(!!e){if(typeof e=="string")return Qg(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Qg(e,i)}}function Qg(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var fo=(Kg=k0(Ht.IGlobalConfigService),B0=function(){function e(i){(0,ht.Z)(this,e),(0,A.Z)(this,"triangulation",void 0),(0,A.Z)(this,"createTexture2D",void 0),(0,A.Z)(this,"layer",void 0),(0,A.Z)(this,"dataTexture",void 0),(0,A.Z)(this,"DATA_TEXTURE_WIDTH",void 0),(0,A.Z)(this,"rowCount",void 0),(0,A.Z)(this,"cacheStyleProperties",void 0),(0,A.Z)(this,"cellLength",void 0),(0,A.Z)(this,"cellProperties",void 0),(0,A.Z)(this,"cellTypeLayout",void 0),(0,A.Z)(this,"stylePropertyesExist",void 0),(0,A.Z)(this,"dataTextureTest",void 0),Ui(this,"configService",$g,this),(0,A.Z)(this,"shaderModuleService",void 0),(0,A.Z)(this,"rendererService",void 0),(0,A.Z)(this,"iconService",void 0),(0,A.Z)(this,"fontService",void 0),(0,A.Z)(this,"styleAttributeService",void 0),(0,A.Z)(this,"mapService",void 0),(0,A.Z)(this,"cameraService",void 0),(0,A.Z)(this,"layerService",void 0),this.layer=i,this.rendererService=i.getContainer().get(Ht.IRendererService),this.shaderModuleService=i.getContainer().get(Ht.IShaderModuleService),this.styleAttributeService=i.getContainer().get(Ht.IStyleAttributeService),this.mapService=i.getContainer().get(Ht.IMapService),this.iconService=i.getContainer().get(Ht.IIconService),this.fontService=i.getContainer().get(Ht.IFontService),this.cameraService=i.getContainer().get(Ht.ICameraService),this.layerService=i.getContainer().get(Ht.ILayerService),this.registerBuiltinAttributes(),this.startModelAnimate();var r=this.rendererService.createTexture2D;this.createTexture2D=r,this.DATA_TEXTURE_WIDTH=1024,this.rowCount=1,this.cellLength=0,this.cellProperties=[],this.cacheStyleProperties={thetaOffset:void 0,opacity:void 0,strokeOpacity:void 0,strokeWidth:void 0,stroke:void 0,offsets:void 0},this.stylePropertyesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0},this.dataTextureTest=this.layerService.getOESTextureFloat(),this.dataTextureTest||(this.dataTexture=this.createTexture2D({data:new Uint8Array(4),mag:G.NEAREST,min:G.NEAREST,width:1,height:1}))}return(0,Pt.Z)(e,[{key:"clearLastCalRes",value:function(){this.cellProperties=[],this.cellLength=0,this.stylePropertyesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0}}},{key:"getCellTypeLayout",value:function(){return this.dataTextureTest?[this.rowCount,this.DATA_TEXTURE_WIDTH,0,0,this.stylePropertyesExist.hasOpacity,this.stylePropertyesExist.hasStrokeOpacity,this.stylePropertyesExist.hasStrokeWidth,this.stylePropertyesExist.hasStroke,this.stylePropertyesExist.hasOffsets,this.stylePropertyesExist.hasThetaOffset,0,0,0,0,0,1]:[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,-1]}},{key:"dataTextureNeedUpdate",value:function(r){var n=!1;return dd()(r.thetaOffset,this.cacheStyleProperties.thetaOffset)||(n=!0,this.cacheStyleProperties.thetaOffset=r.thetaOffset),dd()(r.opacity,this.cacheStyleProperties.opacity)||(n=!0,this.cacheStyleProperties.opacity=r.opacity),dd()(r.strokeOpacity,this.cacheStyleProperties.strokeOpacity)||(n=!0,this.cacheStyleProperties.strokeOpacity=r.strokeOpacity),dd()(r.strokeWidth,this.cacheStyleProperties.strokeWidth)||(n=!0,this.cacheStyleProperties.strokeWidth=r.strokeWidth),dd()(r.stroke,this.cacheStyleProperties.stroke)||(n=!0,this.cacheStyleProperties.stroke=r.stroke),dd()(r.offsets,this.cacheStyleProperties.offsets)||(n=!0,this.cacheStyleProperties.offsets=r.offsets),this.dataTexture===void 0&&(n=!0),n}},{key:"judgeStyleAttributes",value:function(r){this.clearLastCalRes(),r.opacity!==void 0&&!fa()(r.opacity)&&(this.cellProperties.push({attr:"opacity",count:1}),this.stylePropertyesExist.hasOpacity=1,this.cellLength+=1),r.strokeOpacity!==void 0&&!fa()(r.strokeOpacity)&&(this.cellProperties.push({attr:"strokeOpacity",count:1}),this.stylePropertyesExist.hasStrokeOpacity=1,this.cellLength+=1),r.strokeWidth!==void 0&&!fa()(r.strokeWidth)&&(this.cellProperties.push({attr:"strokeWidth",count:1}),this.stylePropertyesExist.hasStrokeWidth=1,this.cellLength+=1),r.stroke!==void 0&&!this.isStaticColor(r.stroke)&&(this.cellProperties.push({attr:"stroke",count:4}),this.stylePropertyesExist.hasStroke=1,this.cellLength+=4),r.offsets!==void 0&&!this.isOffsetStatic(r.offsets)&&(this.cellProperties.push({attr:"offsets",count:2}),this.stylePropertyesExist.hasOffsets=1,this.cellLength+=2),r.thetaOffset!==void 0&&!fa()(r.thetaOffset)&&(this.cellProperties.push({attr:"thetaOffset",count:1}),this.stylePropertyesExist.hasThetaOffset=1,this.cellLength+=1)}},{key:"isStaticColor",value:function(r){return vo()(r)?!!(0,Vc.ZP)(r):!1}},{key:"getStrokeColor",value:function(r){if(this.isStaticColor(r)){var n=Ji(r);return n[0]=n[0]?n[0]:0,n[1]=n[1]?n[1]:0,n[2]=n[2]?n[2]:0,n[3]=n[3]?n[3]:0,n}else return[0,0,0,0]}},{key:"isOffsetStatic",value:function(r){return!!(Array.isArray(r)&&r.length===2&&fa()(r[0])&&fa()(r[1]))}},{key:"patchMod",value:function(r,n){for(var a=0;a<n;a++)r.push(-1)}},{key:"patchData",value:function(r,n,a){var s=IE(a),f;try{for(s.s();!(f=s.n()).done;){var v=f.value,g=v.attr,x=v.count,C=n[g];C!==void 0?g==="stroke"?r.push.apply(r,(0,Ce.Z)(Ji(C))):g==="offsets"?this.isOffsetStatic(C)?r.push(-C[0],C[1]):r.push(0,0):r.push(fa()(C)?C:1):this.patchMod(r,x)}}catch(T){s.e(T)}finally{s.f()}}},{key:"calDataFrame",value:function(r,n,a){for(var s=n.length,f=Math.ceil(s*r/this.DATA_TEXTURE_WIDTH),v=f*this.DATA_TEXTURE_WIDTH,g=[],x=0;x<s;x++){var C=n[x];this.patchData(g,C,a)}for(var T=g.length;T<v;T++)g.push(-1);return{data:g,width:this.DATA_TEXTURE_WIDTH,height:f}}},{key:"getBlend",value:function(){var r=this.layer.getLayerConfig(),n=r.blend,a=n===void 0?"normal":n;return Zg[wc[a]]}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){return!1}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){throw new Error("Method not implemented.")}},{key:"clearModels",value:function(){}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(r){return[r.enable?0:1,r.duration||4,r.interval||.2,r.trailLength||.1]}},{key:"startModelAnimate",value:function(){var r=this.layer.getLayerConfig(),n=r.animateOption;n.enable&&this.layer.setAnimateStartTime()}}]),e}(),$g=jn(B0.prototype,"configService",[Kg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),B0),RE=U(9187),Rf=U.n(RE),Jg=100,HP=36,WP=40;function ey(e){return e/180*Math.acos(-1)}function ty(e){var i=ey(e[0])+Math.PI/2,r=ey(e[1]),n=Jg+Math.random()*.4,a=n*Math.cos(r)*Math.cos(i),s=n*Math.cos(r)*Math.sin(i),f=n*Math.sin(r);return[s,f,a]}function XP(e,i){var r=mat4.create(),n=mat4.create(),a=vec3.fromValues(0,1,0),s=vec3.fromValues(0,0,0);i=i||{},e=typeof e!="undefined"?e:1;for(var f=typeof i.segments!="undefined"?i.segments:32,v=2+f,g=2*v,x=[],C=[],T=[],O=[],k=[],j=[],X=0;X<=v;X++){for(var te=X/v,be=te*Math.PI,Ne=0;Ne<=g;Ne++){var $e=Ne/g,ot=$e*Math.PI*2;mat4.identity(n),mat4.rotateZ(n,n,-be),mat4.identity(r),mat4.rotateY(r,r,ot),vec3.transformMat4(s,a,n),vec3.transformMat4(s,s,r),vec3.scale(s,s,-e),T.push(s.slice()),O.push.apply(O,_toConsumableArray(s.slice())),vec3.normalize(s,s),k.push.apply(k,_toConsumableArray(s.slice())),j.push([$e,1-te]),O.push($e,1-te)}if(X>0)for(var bt=T.length,_t=bt-2*(g+1);_t+g+2<bt;_t++)x.push([_t,_t+1,_t+g+1]),C.push(_t,_t+1,_t+g+1),x.push([_t+g+1,_t+1,_t+g+2]),C.push(_t+g+1,_t+1,_t+g+2)}return{cells:x,positions:T,uvs:j,positionsArr:O,indicesArr:C,normalArr:k}}var Ci=U(31437),Nv=Ci.Ue(),YP=Ci.Ue(),Ks=Ci.Ue(),Kh=Ci.Ue(),vd=Ci.Ue();function N0(e,i,r,n,a){Ci.IH(e,r,n),Ci.Fv(e,e),i=Ci.al(-e[1],e[0]);var s=Ci.al(-r[1],r[0]);return[a/Ci.AK(i,s),i]}function $h(e,i){return Ci.t8(e,-i[1],i[0])}function md(e,i,r){return Ci.lu(e,i,r),Ci.Fv(e,e),e}function z0(e,i){return e[0]===i[0]&&e[1]===i[1]}function qP(e){for(var i=new Map,r=0;r<e.length;r++){var n=e[0].toString()+"-"+e[1].toString();i.get(n)?(e.splice(r,1),r++):i.set(n,n)}return e}var ry=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,ht.Z)(this,e),(0,A.Z)(this,"complex",void 0),(0,A.Z)(this,"join",void 0),(0,A.Z)(this,"cap",void 0),(0,A.Z)(this,"miterLimit",void 0),(0,A.Z)(this,"thickness",void 0),(0,A.Z)(this,"normal",void 0),(0,A.Z)(this,"lastFlip",-1),(0,A.Z)(this,"miter",Ci.al(0,0)),(0,A.Z)(this,"started",!1),(0,A.Z)(this,"dash",!1),(0,A.Z)(this,"totalDistance",0),(0,A.Z)(this,"currentIndex",0),this.join=i.join||"miter",this.cap=i.cap||"butt",this.miterLimit=i.miterLimit||10,this.thickness=i.thickness||1,this.dash=i.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return(0,Pt.Z)(e,[{key:"extrude_gaode2",value:function(r,n){var a=this.complex;if(r.length<=1)return a;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var s=r.length,f=a.startIndex,v=1;v<s;v++){var g,x,C,T=r[v-1];T.push((g=n[v-1][2])!==null&&g!==void 0?g:0);var O=n[v-1],k=r[v];k.push((x=n[v][2])!==null&&x!==void 0?x:0);var j=n[v],X=v<r.length-1?[].concat((0,Ce.Z)(r[v+1]),[(C=n[v+1][2])!==null&&C!==void 0?C:0]):null,te=v<n.length-1?n[v+1]:null,be=this.segment_gaode2(a,f,T,k,X,O,j,te);f+=be}if(this.dash)for(var Ne=0;Ne<a.positions.length/6;Ne++)a.positions[Ne*6+5]=this.totalDistance;return a.startIndex=a.positions.length/6,a}},{key:"simpleExtrude_gaode2",value:function(r,n){var a=this.complex;if(r.length<=1)return a;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var s=r.length,f=a.startIndex,v=1;v<s;v++){var g,x,C,T=r[v-1];T.push((g=n[v-1][2])!==null&&g!==void 0?g:0);var O=n[v-1],k=r[v];k.push((x=n[v][2])!==null&&x!==void 0?x:0);var j=n[v],X=v<r.length-1?[].concat((0,Ce.Z)(r[v+1]),[(C=n[v+1][2])!==null&&C!==void 0?C:0]):null,te=v<n.length-1?n[v+1]:null,be=this.simpleSegment(a,f,T,k,X,O,j,te);f+=be}if(this.dash)for(var Ne=0;Ne<a.positions.length/6;Ne++)a.positions[Ne*6+5]=this.totalDistance;return a.startIndex=a.positions.length/6,a}},{key:"extrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var a=r.length,s=n.startIndex,f=1;f<a;f++){var v=r[f-1],g=r[f],x=f<r.length-1?r[f+1]:null,C=this.segment(n,s,v,g,x);s+=C}if(this.dash)for(var T=0;T<n.positions.length/6;T++)n.positions[T*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleExtrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var a=r.length,s=n.startIndex,f=1;f<a;f++){var v=r[f-1],g=r[f],x=f<r.length-1?r[f+1]:null,C=this.simpleSegment(n,s,v,g,x);s+=C}if(this.dash)for(var T=0;T<n.positions.length/6;T++)n.positions[T*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"segment_gaode2",value:function(r,n,a,s,f,v,g,x){var C=0,T=r.indices,O=r.positions,k=r.normals,j=this.cap==="square",X=this.join==="bevel",te=Go([g[0],g[1]]),be=Go([v[0],v[1]]);md(Ks,s,a);var Ne=0;if(this.dash&&(Ne=this.lineSegmentDistance(te,be),this.totalDistance+=Ne),this.normal||(this.normal=Ci.Ue(),$h(this.normal,Ks)),!this.started)if(this.started=!0,j){var $e=Ci.Ue(),ot=Ci.Ue();Ci.IH($e,this.normal,Ks),Ci.IH(ot,this.normal,Ks),k.push(ot[0],ot[1],0),k.push($e[0],$e[1],0),O.push(a[0],a[1],a[2]|0,this.totalDistance-Ne,-this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),O.push(a[0],a[1],a[2]|0,this.totalDistance-Ne,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(O,k,a,this.normal,this.thickness,this.totalDistance-Ne);if(T.push(n+0,n+1,n+2),f){z0(s,f)&&Ci.IH(f,s,Ci.Fv(f,Ci.$X(f,s,a))),md(Kh,f,s);var qt=N0(vd,Ci.Ue(),Ks,Kh,this.thickness),ar=(0,on.Z)(qt,2),Pr=ar[0],qr=ar[1],gr=Ci.AK(vd,this.normal)<0?-1:1,un=X;if(!un&&this.join==="miter"){var Ln=Pr;Ln>this.miterLimit&&(un=!0)}un?(k.push(this.normal[0],this.normal[1],0),k.push(qr[0],qr[1],0),O.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*gr,s[2]|0),this.complex.indexes.push(this.currentIndex),O.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness*gr,s[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,T.push.apply(T,(0,Ce.Z)(this.lastFlip!==-gr?[n,n+2,n+3]:[n+2,n+1,n+3])),T.push(n+2,n+3,n+4),$h(Nv,Kh),Ci.JG(this.normal,Nv),k.push(this.normal[0],this.normal[1],0),O.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*gr,s[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,C+=3):(this.extrusions(O,k,s,qr,Pr,this.totalDistance),T.push.apply(T,(0,Ce.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),gr=-1,Ci.JG(this.normal,qr),C+=2),this.lastFlip=gr}else{if($h(this.normal,Ks),j){var bt=Ci.Ue(),_t=Ci.Ue();Ci.lu(_t,Ks,this.normal),Ci.IH(bt,Ks,this.normal),k.push(_t[0],_t[1],0),k.push(bt[0],bt[1],0),O.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0),this.complex.indexes.push(this.currentIndex),O.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(O,k,s,this.normal,this.thickness,this.totalDistance);T.push.apply(T,(0,Ce.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),C+=2}return C}},{key:"simpleSegment",value:function(r,n,a,s,f){var v=0,g=r.indices,x=r.positions,C=r.normals,T=Go([s[0],s[1]]),O=Go([a[0],a[1]]);md(Ks,T,O);var k=0;if(this.dash&&(k=this.lineSegmentDistance(T,O),this.totalDistance+=k),this.normal||(this.normal=Ci.Ue(),$h(this.normal,Ks)),this.started||(this.started=!0,this.extrusions(x,C,a,this.normal,this.thickness,this.totalDistance-k)),g.push(n+0,n+1,n+2),!f)$h(this.normal,Ks),this.extrusions(x,C,s,this.normal,this.thickness,this.totalDistance),g.push.apply(g,(0,Ce.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),v+=2;else{var j=Go([f[0],f[1]]);z0(T,j)&&Ci.IH(j,T,Ci.Fv(j,Ci.$X(j,T,O))),md(Kh,j,T);var X=N0(vd,Ci.Ue(),Ks,Kh,this.thickness),te=(0,on.Z)(X,2),be=te[0],Ne=te[1],$e=Ci.AK(vd,this.normal)<0?-1:1;this.extrusions(x,C,s,Ne,be,this.totalDistance),g.push.apply(g,(0,Ce.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),$e=-1,Ci.JG(this.normal,Ne),v+=2,this.lastFlip=$e}return v}},{key:"segment",value:function(r,n,a,s,f){var v=0,g=r.indices,x=r.positions,C=r.normals,T=this.cap==="square",O=this.join==="bevel",k=Go([s[0],s[1]]),j=Go([a[0],a[1]]);md(Ks,k,j);var X=0;if(this.dash&&(X=this.lineSegmentDistance(k,j),this.totalDistance+=X),this.normal||(this.normal=Ci.Ue(),$h(this.normal,Ks)),!this.started)if(this.started=!0,T){var te=Ci.Ue(),be=Ci.Ue();Ci.IH(te,this.normal,Ks),Ci.IH(be,this.normal,Ks),C.push(be[0],be[1],0),C.push(te[0],te[1],0),x.push(a[0],a[1],a[2]|0,this.totalDistance-X,-this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),x.push(a[0],a[1],a[2]|0,this.totalDistance-X,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(x,C,a,this.normal,this.thickness,this.totalDistance-X);if(g.push(n+0,n+1,n+2),f){var ot=Go([f[0],f[1]]);z0(k,ot)&&Ci.IH(ot,k,Ci.Fv(ot,Ci.$X(ot,k,j))),md(Kh,ot,k);var bt=N0(vd,Ci.Ue(),Ks,Kh,this.thickness),_t=(0,on.Z)(bt,2),qt=_t[0],ar=_t[1],Pr=Ci.AK(vd,this.normal)<0?-1:1,qr=O;if(!qr&&this.join==="miter"){var gr=qt;gr>this.miterLimit&&(qr=!0)}qr?(C.push(this.normal[0],this.normal[1],0),C.push(ar[0],ar[1],0),x.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*Pr,s[2]|0),this.complex.indexes.push(this.currentIndex),x.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness*Pr,s[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,g.push.apply(g,(0,Ce.Z)(this.lastFlip!==-Pr?[n,n+2,n+3]:[n+2,n+1,n+3])),g.push(n+2,n+3,n+4),$h(Nv,Kh),Ci.JG(this.normal,Nv),C.push(this.normal[0],this.normal[1],0),x.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*Pr,s[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,v+=3):(this.extrusions(x,C,s,ar,qt,this.totalDistance),g.push.apply(g,(0,Ce.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),Pr=-1,Ci.JG(this.normal,ar),v+=2),this.lastFlip=Pr}else{if($h(this.normal,Ks),T){var Ne=Ci.Ue(),$e=Ci.Ue();Ci.lu($e,Ks,this.normal),Ci.IH(Ne,Ks,this.normal),C.push($e[0],$e[1],0),C.push(Ne[0],Ne[1],0),x.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0),this.complex.indexes.push(this.currentIndex),x.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(x,C,s,this.normal,this.thickness,this.totalDistance);g.push.apply(g,(0,Ce.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),v+=2}return v}},{key:"extrusions",value:function(r,n,a,s,f,v){n.push(s[0],s[1],0),n.push(s[0],s[1],0),r.push(a[0],a[1],a[2]|0,v,-f,a[2]|0),this.complex.indexes.push(this.currentIndex),r.push(a[0],a[1],a[2]|0,v,f,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(r,n){var a=n[0]-r[0],s=n[1]-r[1];return Math.sqrt(a*a+s*s)}}]),e}();function Mp(e){if(fa()(e[0]))return e;if(fa()(e[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(fa()(e[0][0][0])){var i=e,r=0,n=0,a=0;return i.forEach(function(s){s.forEach(function(f){r+=f[0],n+=f[1],a++})}),[r/a,n/a,0]}else throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}function LE(e){for(var i=e[0],r=e[1],n=e[0],a=e[1],s=0,f=0,v=0,g=0;g<e.length;g+=2){var x=e[g],C=e[g+1];x&&C&&(i=Math.max(x,i),r=Math.max(C,r),n=Math.min(x,n),a=Math.min(C,a),s+=x,f+=C,v++)}return{center:[s/v,f/v],radius:Math.sqrt(Math.pow(i-n,2)+Math.pow(r-a,2))/2}}var Xa=U(77160);function kE(e){var i=e[0][0],r=e[0][e[0].length-1];i[0]===r[0]&&i[1]===r[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var n=e[0].length,a=Rf().flatten(e),s=a.vertices,f=a.dimensions,v=[],g=[],x=0;x<s.length/f;x++)f===2?v.push(s[x*2],s[x*2+1],1):v.push(s[x*3],s[x*3+1],1);var C=Rf()(a.vertices,a.holes,a.dimensions);g.push.apply(g,(0,Ce.Z)(C));for(var T=function(j){var X=a.vertices.slice(j*f,(j+1)*f),te=a.vertices.slice((j+1)*f,(j+2)*f);te.length===0&&(te=a.vertices.slice(0,f));var be=v.length/3;v.push(X[0],X[1],1,te[0],te[1],1,X[0],X[1],0,te[0],te[1],0),g.push.apply(g,(0,Ce.Z)([0,2,1,2,3,1].map(function(Ne){return Ne+be})))},O=0;O<n;O++)T(O);return{positions:v,index:g}}function DE(e){var i=Rf().flatten(e),r=Rf()(i.vertices,i.holes,i.dimensions);return{positions:i.vertices,index:r}}function ny(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=e[0][0],n=e[0][e[0].length-1];r[0]===n[0]&&r[1]===n[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var a=e[0].length,s=Rf().flatten(e),f=s.vertices,v=s.dimensions,g=[],x=[],C=[],T=0;T<f.length/v;T++)v===2?g.push(f[T*2],f[T*2+1],1,-1,-1):g.push(f[T*3],f[T*3+1],1,-1,-1),C.push(0,0,1);var O=Rf()(s.vertices,s.holes,s.dimensions);x.push.apply(x,(0,Ce.Z)(O));for(var k=function(te){var be=s.vertices.slice(te*v,(te+1)*v),Ne=s.vertices.slice((te+1)*v,(te+2)*v);Ne.length===0&&(Ne=s.vertices.slice(0,v));var $e=g.length/5;g.push(be[0],be[1],1,0,0,Ne[0],Ne[1],1,.1,0,be[0],be[1],0,0,.8,Ne[0],Ne[1],0,.1,.8);var ot=FE([Ne[0],Ne[1],1],[be[0],be[1],0],[be[0],be[1],1],i);C.push.apply(C,(0,Ce.Z)(ot).concat((0,Ce.Z)(ot),(0,Ce.Z)(ot),(0,Ce.Z)(ot))),x.push.apply(x,(0,Ce.Z)([1,2,0,3,2,1].map(function(bt){return bt+$e})))},j=0;j<a;j++)k(j);return{positions:g,index:x,normals:C}}function FE(e,i,r){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,a=Xa.create(),s=Xa.create(),f=Xa.create();n&&(e=Cn(e),i=Cn(i),r=Cn(r));var v=Xa.fromValues.apply(Xa,(0,Ce.Z)(e)),g=Xa.fromValues.apply(Xa,(0,Ce.Z)(i)),x=Xa.fromValues.apply(Xa,(0,Ce.Z)(r));Xa.sub(a,x,g),Xa.sub(s,v,g),Xa.cross(f,a,s);var C=Xa.create();return Xa.normalize(C,f),C}var Tc,Pp;(function(e){e.CYLINDER="cylinder",e.SQUARECOLUMN="squareColumn",e.TRIANGLECOLUMN="triangleColumn",e.HEXAGONCOLUMN="hexagonColumn",e.PENTAGONCOLUMN="pentagonColumn"})(Pp||(Pp={}));var Ip;(function(e){e.CIRCLE="circle",e.SQUARE="square",e.TRIANGLE="triangle",e.HEXAGON="hexagon",e.PENTAGON="pentagon"})(Ip||(Ip={}));function ov(e){for(var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=Math.PI*2/e,n=[],a=0;a<e;a++)n.push(r*a+i*Math.PI/12);var s=n.map(function(f){var v=Math.sin(f+Math.PI/4),g=Math.cos(f+Math.PI/4);return[v,g,0]});return s}function iy(){return ov(30)}function ay(){return ov(4)}function oy(){return ov(3)}function sy(){return ov(6,1)}function uy(){return ov(5)}var gd=(Tc={},(0,A.Z)(Tc,Ip.CIRCLE,iy),(0,A.Z)(Tc,Ip.HEXAGON,sy),(0,A.Z)(Tc,Ip.TRIANGLE,oy),(0,A.Z)(Tc,Ip.SQUARE,ay),(0,A.Z)(Tc,Ip.PENTAGON,uy),(0,A.Z)(Tc,Pp.CYLINDER,iy),(0,A.Z)(Tc,Pp.HEXAGONCOLUMN,sy),(0,A.Z)(Tc,Pp.TRIANGLECOLUMN,oy),(0,A.Z)(Tc,Pp.SQUARECOLUMN,ay),(0,A.Z)(Tc,Pp.PENTAGONCOLUMN,uy),Tc),zv={};function Op(e){var i=Mp(e.coordinates);return{vertices:[].concat((0,Ce.Z)(i),(0,Ce.Z)(i),(0,Ce.Z)(i),(0,Ce.Z)(i)),indices:[0,1,2,2,3,0],size:i.length}}function ly(e){var i=Mp(e.coordinates),r=ty(i);return{vertices:[].concat((0,Ce.Z)(r),(0,Ce.Z)(r),(0,Ce.Z)(r),(0,Ce.Z)(r)),indices:[0,1,2,2,3,0],size:r.length}}function cy(e){var i=e.shape,r=UE(i,!1),n=r.positions,a=r.index,s=r.normals;return{vertices:n,indices:a,normals:s,size:5}}function fy(e){var i=Mp(e.coordinates);return{vertices:(0,Ce.Z)(i),indices:[0],size:i.length}}function sv(e){var i=e.coordinates,r=e.originCoordinates,n=e.version,a=new ry({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var s=i;Array.isArray(s[0][0])||(s=[i]);var f=r;Array.isArray(f[0][0])||(f=[r]);for(var v=0;v<s.length;v++){var g=s[v],x=f[v];a.extrude_gaode2(g,x)}}else{var C=i;C[0]&&!Array.isArray(C[0][0])&&(C=[i]),C.forEach(function(O){a.extrude(O)})}var T=a.complex;return{vertices:T.positions,indices:T.indices,normals:T.normals,indexes:T.indexes,size:6}}function BE(e){var i=e.coordinates,r=e.originCoordinates,n=e.version,a=new ry({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var s=i;Array.isArray(s[0][0])||(s=[i]);var f=r;Array.isArray(f[0][0])||(f=[r]);for(var v=0;v<s.length;v++){var g=s[v],x=f[v];a.simpleExtrude_gaode2(g,x)}}else{var C=i;C[0]&&!Array.isArray(C[0][0])&&(C=[i]),C.forEach(function(O){a.simpleExtrude(O)})}var T=a.complex;return{vertices:T.positions,indices:T.indices,normals:T.normals,size:6}}function Uv(e){var i=e.coordinates,r=Rf().flatten(i),n=r.vertices,a=r.dimensions,s=r.holes;return{indices:Rf()(n,s,a),vertices:n,size:a}}function NE(e){var i=e.coordinates,r=Rf().flatten(i),n=r.vertices,a=r.dimensions,s=r.holes;return{indices:Rf()(n,s,a),vertices:zE(n),size:a+4}}function zE(e){for(var i=[],r=LE(e),n=r.center,a=r.radius,s=0;s<e.length;s+=2){var f=e[s],v=e[s+1];i.push.apply(i,[f,v,0].concat((0,Ce.Z)(n),[a]))}return i}function hy(e){var i=e.coordinates,r=ny(i,!0),n=r.positions,a=r.index,s=r.normals;return{vertices:n,indices:a,normals:s,size:5}}function py(e){var i=e.shape,r=jE(i),n=r.positions,a=r.index;return{vertices:n,indices:a,size:3}}function dy(e){var i=e.coordinates,r=[].concat((0,Ce.Z)(i[0]),[0,0,1,i[1][0],i[0][1],0,1,1],(0,Ce.Z)(i[1]),[0,1,0],(0,Ce.Z)(i[0]),[0,0,1],(0,Ce.Z)(i[1]),[0,1,0,i[0][0],i[1][1],0,0,0]),n=[0,1,2,3,4,5];return{vertices:r,indices:n,size:5}}function Zv(e,i){for(var r=i||30,n=e.coordinates,a=[],s=[],f=function(x){a.push(x,1,x,n[0][0],n[0][1],n[1][0],n[1][1],x,-1,x,n[0][0],n[0][1],n[1][0],n[1][1]),x!==r-1&&s.push.apply(s,(0,Ce.Z)([0,1,2,1,3,2].map(function(C){return x*2+C})))},v=0;v<r;v++)f(v);return{vertices:a,indices:s,size:7}}function vy(e){var i=e.coordinates;i.length===2&&i.push(0);var r=e.size,n=jv(-1,1),a=jv(1,1),s=jv(-1,-1),f=jv(1,-1),v=[].concat((0,Ce.Z)(i),(0,Ce.Z)(n),(0,Ce.Z)(i),(0,Ce.Z)(s),(0,Ce.Z)(i),(0,Ce.Z)(f),(0,Ce.Z)(i),(0,Ce.Z)(a)),g=[0,1,2,3,0,2];return{vertices:v,indices:g,size:5}}function UE(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(zv&&zv[e])return zv[e];var r=gd[e]?gd[e]():gd.cylinder(),n=ny([r],i);return zv[e]=n,n}function KP(e,i){for(var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,a=new Float32Array(e.length/r*3),s,f,v,g=vec3.create(),x=vec3.create(),C=vec3.create(),T=0,O=i.length;T<O;T+=3){s=i[T+0]*3,f=i[T+1]*3,v=i[T+2]*3;var k=[e[s],e[s+1]],j=[e[f],e[f+1]],X=[e[v],e[v+1]];n&&(k=lngLatToMeters(k),j=lngLatToMeters(j),X=lngLatToMeters(X));var te=k,be=_slicedToArray(te,2),Ne=be[0],$e=be[1],ot=vec3.fromValues(Ne,$e,e[s+2]),bt=j,_t=_slicedToArray(bt,2),qt=_t[0],ar=_t[1],Pr=vec3.fromValues(qt,ar,e[f+2]),qr=X,gr=_slicedToArray(qr,2),un=gr[0],Ln=gr[1],Vn=vec3.fromValues(un,Ln,e[v+2]);vec3.sub(g,Vn,Pr),vec3.sub(x,ot,Pr),vec3.cross(C,g,x),a[s]+=g[0],a[s+1]+=g[1],a[s+2]+=g[2],a[f]+=g[0],a[f+1]+=g[1],a[f+2]+=g[2],a[v]+=g[0],a[v+1]+=g[1],a[v+2]+=g[2]}return ZE(a),a}function ZE(e){for(var i=0,r=e.length;i<r;i+=3){var n=vec3.fromValues(e[i],e[i+1],e[i+2]),a=vec3.create();vec3.normalize(a,n),e.set(a,i)}}function $P(e){var i=e[0][0],r=e[0][e[0].length-1];return i[0]===r[0]&&i[1]===r[1]}function jE(e){var i=["cylinder","triangleColumn","hexagonColumn","squareColumn"],r=gd[e]?gd[e]():gd.circle(),n=i.indexOf(e)===-1?DE([r]):kE([r]);return n}function jv(e,i){var r=(e+1)/2,n=(i+1)/2;return[r,n]}function QP(){var e=primitiveSphere(EARTH_RADIUS,{segments:EARTH_SEGMENTS}),i=e.positionsArr,r=e.indicesArr,n=e.normalArr;return{vertices:i,indices:r,size:5,normals:n}}function JP(){var e=primitiveSphere(EARTH_RADIUS+EARTH_RADIUS_OUTER,{segments:EARTH_SEGMENTS}),i=e.positionsArr,r=e.indicesArr,n=e.normalArr;return{vertices:i,indices:r,size:5,normals:n}}function VE(e){var i=GE();return function(){var n=(0,Mt.Z)(e),a;if(i){var s=(0,Mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,wr.Z)(this,a)}}function GE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var HE=`uniform float u_opacity: 1.0;
uniform vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
uniform float u_near : 0;
uniform float u_far : 1;
varying vec4 v_Color;
varying vec2 v_texCoord;
uniform float u_Zoom : 1;
uniform float u_time;

uniform float u_circleSweep;
uniform float u_cityMinSize;
uniform vec3 u_circleSweepColor;
uniform float u_circleSweepSpeed;

varying float v_worldDis;

#pragma include "picking"

vec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {
    float s = step(hot, n);
    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);

    return mix(darkColor, color, s);
}
float random (vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);
}

float LinearizeDepth()
{
    float z = gl_FragCoord.z * 2.0 - 1.0;
    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));
}

vec3 fog(vec3 color, vec3 fogColor, float depth){
    float fogFactor=clamp(depth,0.0,1.0);
    vec3 output_color=mix(fogColor,color,fogFactor);
    return output_color;
}

float sdRect(vec2 p, vec2 sz) {
  vec2 d = abs(p) - sz;
  float outside = length(max(d, 0.));
  float inside = min(max(d.x, d.y), 0.);
  return outside + inside;
}

void main() {
  gl_FragColor = v_Color;
  vec3 baseColor = u_baseColor.xyz;
  vec3 brightColor = u_brightColor.xyz;
  vec3 windowColor = u_windowColor.xyz;
  float targetColId = 5.;
  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;
  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);
  if(v_texCoord.x < 0.) { //\u9876\u90E8\u989C\u8272
       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);
       gl_FragColor = vec4( foggedColor, v_Color.w);
  }else { // \u4FA7\u9762\u989C\u8272
        vec2 st = v_texCoord;
        vec2  UvScale = v_texCoord;
        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));
        float tStart = 0.25 * tStep;
        float tEnd = 0.75 * tStep;
        float u = mod(UvScale.x, tStep);
        float v = mod(UvScale.y, tStep);
        float ux = floor(UvScale.x/tStep);
        float uy = floor(UvScale.y/tStep);
        float n = random(vec2(ux,uy));
        float lightP = u_time;
        float head = 1.0- step(0.005,st.y);
        /*step3*/
        // \u5C06\u7A97\u6237\u989C\u8272\u548C\u5899\u9762\u989C\u8272\u533A\u522B\u5F00\u6765
        float sU = step(tStart, u) - step(tEnd, u);
        float sV = step(tStart, v) - step(tEnd, v);
        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));
        float dist = sdRect(vec2(u,v), windowSize);
        float s = sU * sV;

        float curColId = floor(UvScale.x / tStep);
        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);

        float mLightP = mod(lightP, 2.);
        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);
        if(ux == targetColId){
            n =0.;
        }
        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );
        float hot = smoothstep(1.0,0.0,timeP);
        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);
        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);
        float sFinal = s * sCol * sRow;
        color += mix(baseColor, brightColor, sFinal*n);
        if (st.y<0.01){
        color = baseColor;
         }
        if(head ==1.0) { // \u9876\u90E8\u4EAE\u7EBF
            color = brightColor;
        }
        color = color * v_Color.rgb;

        vec3 foggedColor = fog(color,fogColor,depth);

        gl_FragColor = vec4(foggedColor,1.0);
  }


  if(u_circleSweep > 0.0 && v_worldDis < u_cityMinSize) {
    float r = fract(((v_worldDis/u_cityMinSize) - u_time * u_circleSweepSpeed) * 2.0);
    gl_FragColor.rgb += r * r * u_circleSweepColor;
  }
   
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,WE=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

attribute vec2 a_Uv;
varying vec2 v_texCoord;

varying vec4 v_Color;
uniform mat4 u_Mvp;

uniform float u_circleSweep;
uniform vec2 u_cityCenter;

varying float v_worldDis;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"


void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

   v_texCoord = a_Uv;

  if(u_circleSweep > 0.0) {
     vec2 lnglatscale = vec2(0.0);
    if(u_CoordinateSystem != COORDINATE_SYSTEM_P20_2) {
      lnglatscale = (a_Position.xy - u_cityCenter) * vec2(0.0, 0.135);
    }
    v_worldDis = length(a_Position.xy + lnglatscale - u_cityCenter);
  }
 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,XE=function(e){(0,Ir.Z)(r,e);var i=VE(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ne.Z)(n),"cityCenter",void 0),(0,A.Z)((0,ne.Z)(n),"cityMinSize",void 0),n}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.baseColor,g=v===void 0?"rgb(16,16,16)":v,x=a.brightColor,C=x===void 0?"rgb(255,176,38)":x,T=a.windowColor,O=T===void 0?"rgb(30,60,89)":T,k=a.time,j=k===void 0?0:k,X=a.sweep,te=X===void 0?{enable:!1,sweepRadius:1,sweepColor:"rgb(255, 255, 255)",sweepSpeed:.4,sweepCenter:this.cityCenter}:X;return{u_cityCenter:te.sweepCenter||this.cityCenter,u_cityMinSize:this.cityMinSize*te.sweepRadius,u_circleSweep:te.enable?1:0,u_circleSweepColor:Ji(te.sweepColor).slice(0,3),u_circleSweepSpeed:te.sweepSpeed,u_opacity:f,u_baseColor:Ji(g),u_brightColor:Ji(C),u_windowColor:Ji(O),u_time:this.layer.getLayerAnimateTime()||j}}},{key:"calCityGeo",value:function(){var a=(0,on.Z)(this.layer.getSource().extent,4),s=a[0],f=a[1],v=a[2],g=a[3];if(this.mapService.version==="GAODE2.x"){this.cityCenter=this.mapService.lngLatToCoord([(v+s)/2,(g+f)/2]);var x=this.mapService.lngLatToCoord([v,g]),C=this.mapService.lngLatToCoord([s,f]);this.cityMinSize=Math.sqrt(Math.pow(x[0]-C[0],2)+Math.pow(x[1]-C[1],2))/4}else{var T=v-s,O=g-f;this.cityCenter=[(v+s)/2,(g+f)/2],this.cityMinSize=Math.sqrt(Math.pow(T,2)+Math.pow(O,2))/4}}},{key:"initModels",value:function(){return this.calCityGeo(),this.startModelAnimate(),[this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:WE,fragmentShader:HE,triangulation:hy,cull:{enable:!0,face:G.BACK}})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:On.Attribute,descriptor:{name:"a_Normal",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:3,update:function(s,f,v,g,x){return x}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(s,f,v,g){var x=s.size,C=x===void 0?10:x;return Array.isArray(C)?[C[0]]:[C]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:On.Attribute,descriptor:{name:"a_Uv",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(s,f,v,g){var x=s.size;return[v[3],v[4]]}}})}}]),r}(fo);function YE(e){var i=qE();return function(){var n=(0,Mt.Z)(e),a;if(i){var s=(0,Mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,wr.Z)(this,a)}}function qE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var KE=function(e){(0,Ir.Z)(r,e);var i=YE(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ne.Z)(n),"type","PolygonLayer"),n}return(0,Pt.Z)(r,[{key:"buildModels",value:function(){this.layerModel=new XE(this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"setLight",value:function(a){this.updateLayerConfig({time:a})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"citybuilding"}}]),r}(qh);function $E(e){var i=QE();return function(){var n=(0,Mt.Z)(e),a;if(i){var s=(0,Mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,wr.Z)(this,a)}}function QE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var JE=`precision highp float;\r
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807\r
attribute vec3 a_Position;\r
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807\r
attribute vec3 a_Pos;\r
attribute float a_Size;\r
attribute vec4 a_Color;\r
uniform vec2 u_radius;\r
uniform float u_coverage: 0.9;\r
uniform float u_angle: 0;\r
uniform mat4 u_ModelMatrix;\r
uniform mat4 u_Mvp;\r
varying vec4 v_color;\r
\r
uniform vec2 u_SceneCenterMKT;\r
\r
#pragma include "projection"\r
#pragma include "project"\r
#pragma include "picking"\r
\r
void main() {\r
  v_color = a_Color;\r
\r
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r
  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
  // gl_Position = project_common_position_to_clipspace(project_pos);\r
\r
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807\r
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r
    gl_Position = u_Mvp * (project_pos);\r
  } else {\r
     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
    gl_Position = project_common_position_to_clipspace(project_pos);\r
  }\r
\r
  setPickingColor(a_PickingColor);\r
}\r
`,eS=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,tS=function(e){(0,Ir.Z)(r,e);var i=$E(r);function r(){return(0,ht.Z)(this,r),i.apply(this,arguments)}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=a.coverage,v=a.angle;return{u_opacity:s||1,u_coverage:f||.9,u_angle:v||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"gridheatmap",vertexShader:JE,fragmentShader:eS,triangulation:py,depth:{enable:!1},primitive:G.TRIANGLES,blend:this.getBlend(),stencil:Pa(f,g)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:On.Attribute,descriptor:{name:"a_Pos",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:3,update:function(s,f){var v=s.version==="GAODE2.x"?s.originCoordinates:s.coordinates;return[v[0],v[1],0]}}})}}]),r}(fo);function rS(e){var i=nS();return function(){var n=(0,Mt.Z)(e),a;if(i){var s=(0,Mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,wr.Z)(this,a)}}function nS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var iS=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;

attribute vec3 a_Normal;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "light"
#pragma include "picking"


void main() {
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
  // vec2 lnglat = (a_Pos.xy + offset); 
  // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
  // gl_Position = project_common_position_to_clipspace(project_pos);
  // float lightWeight = calc_lighting(project_pos);
  // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 lnglat = (a_Pos.xy + offset); 
    // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));

    // float lightWeight = calc_lighting(project_pos);
    // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    // gl_Position = u_Mvp * vec4(lnglat , a_Position.z * a_Size, 1.0);
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u7ECF\u7EAC\u5EA6
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807
    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));

    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);
  } else {
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
    
    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
    
    gl_Position = project_common_position_to_clipspace(project_pos);
  }



  setPickingColor(a_PickingColor);
}
`,aS=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,oS=function(e){(0,Ir.Z)(r,e);var i=rS(r);function r(){return(0,ht.Z)(this,r),i.apply(this,arguments)}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=a.coverage,v=a.angle;return{u_opacity:s||1,u_coverage:f||1,u_angle:v||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"grid3dheatmap",vertexShader:iS,fragmentShader:aS,triangulation:cy,depth:{enable:!0},blend:this.getBlend(),stencil:Pa(f,g)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(s,f,v,g){var x=s.size;return Array.isArray(x)?[x[0]]:[x]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:On.Attribute,descriptor:{name:"a_Normal",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:3,update:function(s,f,v,g,x){return x}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:On.Attribute,descriptor:{name:"a_Pos",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:3,update:function(s,f){var v=s.version==="GAODE2.x"?s.originCoordinates:s.coordinates;return[v[0],v[1],0]}}})}}]),r}(fo);function sS(e,i){for(var r=[],n=[],a=[],s=e+1,f=i+1,v=e/2,g=i/2,x=0;x<f;x++)for(var C=x-g,T=0;T<s;T++){var O=T-v;n.push(O/v,-C/g,0),a.push(T/e),a.push(1-x/i)}for(var k=0;k<i;k++)for(var j=0;j<e;j++){var X=j+s*k,te=j+s*(k+1),be=j+1+s*(k+1),Ne=j+1+s*k;r.push(X,te,Ne),r.push(te,be,Ne)}return{vertices:n,indices:r,uvs:a}}var gy,yy;function _y(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function xy(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?_y(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_y(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function uS(e){var i=lS();return function(){var n=(0,Mt.Z)(e),a;if(i){var s=(0,Mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,wr.Z)(this,a)}}function lS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var cS=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
   
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor = color;
    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;
     gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,fS=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
uniform mat4 u_ModelMatrix;
uniform mat4 u_InverseViewProjectionMatrix;
uniform mat4 u_ViewProjectionMatrixUncentered;
varying float v_intensity;


vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {
    float t2 = t * t;
    float one_minus_t = 1.0 - t;
    float one_minus_t2 = one_minus_t * one_minus_t;
    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);
}
vec2 toBezier(float t, vec4 p){
    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));
}
#pragma include "projection"
void main() {
  v_texCoord = a_Uv;

  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // \u5C06\u539F\u672C 0 -> 1 \u7684 uv \u8F6C\u6362\u4E3A -1 -> 1 \u7684\u6807\u51C6\u5750\u6807\u7A7A\u95F4\uFF08NDC\uFF09

  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y \u5E73\u9762\u4E0A\u7684\u70B9\uFF08z == 0\uFF09\u53EF\u4EE5\u8BA4\u4E3A\u662F\u4E09\u7EF4\u4E0A\u7684\u70B9\u88AB\u6295\u5F71\u5230\u5E73\u9762\u540E\u7684\u70B9
	vec4 p2 = vec4(pos, 1.0, 1.0); // \u5E73\u884C\u4E8Ex/y\u5E73\u9762\u3001z==1 \u7684\u5E73\u9762\u4E0A\u7684\u70B9

	vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // \u6839\u636E\u89C6\u56FE\u6295\u5F71\u77E9\u9635\u7684\u9006\u77E9\u9635\u5E73\u9762\u4E0A\u7684\u53CD\u7B97\u51FA\u4E09\u7EF4\u7A7A\u95F4\u4E2D\u7684\u70B9\uFF08p1\u5E73\u9762\u4E0A\u7684\u70B9\uFF09
	vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;

  inverseP1 = inverseP1 / inverseP1.w; // \u5F52\u4E00\u5316\u64CD\u4F5C\uFF08\u5F52\u4E00\u5316\u540E\u4E3A\u4E16\u754C\u5750\u6807\uFF09
	inverseP2 = inverseP2 / inverseP2.w;

	float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??
	vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);

  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);
  float fh;

  v_intensity = texture2D(u_texture, v_texCoord).r;
  fh = toBezier(v_intensity, b).y;
  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);
 
}
`,hS=`uniform sampler2D u_texture;        // \u70ED\u529B\u5F3A\u5EA6\u56FE
uniform sampler2D u_colorTexture;   // \u6839\u636E\u5F3A\u5EA6\u5206\u5E03\u7684\u8272\u5E26
uniform float u_opacity;
varying vec2 v_texCoord;

uniform vec2 u_ViewportSize;

float getBlurIndusty() {
    float vW = 2.0/u_ViewportSize.x;
    float vH = 2.0/u_ViewportSize.y;
    vec2 vUv = v_texCoord;
    float i11 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y + 1.0 * vH) ).r;
    float i12 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y + 1.0 * vH) ).r;
    float i13 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y + 1.0 * vH) ).r;

    float i21 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y) ).r;
    float i22 = texture2D( u_texture, vec2( vUv.x , vUv.y) ).r;
    float i23 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y) ).r;

    float i31 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y-1.0*vH) ).r;
    float i32 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y-1.0*vH) ).r;
    float i33 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y-1.0*vH) ).r;

    return(
        i11 + 
        i12 + 
        i13 + 
        i21 + 
        i21 + 
        i22 + 
        i23 + 
        i31 + 
        i32 + 
        i33
        )/9.0;
}


void main(){
    // float intensity = texture2D(u_texture, v_texCoord).r;
    float intensity = getBlurIndusty();
    vec4 color = texture2D(u_colorTexture, vec2(intensity, 0.0));

    gl_FragColor =color;
    gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;

}
`,pS=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;

void main() {
  v_texCoord = a_Uv;

  gl_Position = vec4(a_Position.xy, 0, 1.);
}
`,dS=`precision highp float;
uniform float u_intensity;
varying float v_weight;
varying vec2 v_extrude;
#define GAUSS_COEF  0.3989422804014327
void main(){
    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);
    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);
    gl_FragColor = vec4(val, 1., 1., 1.);
}
`,vS=`precision highp float;
attribute vec3 a_Position;
attribute float a_Size;
attribute vec2 a_Dir;
uniform float u_intensity;
uniform float u_radius;
varying vec2 v_extrude;
varying float v_weight;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#define GAUSS_COEF  0.3989422804014327

#pragma include "projection"

void main(){
    v_weight = a_Size;
    float ZERO = 1.0 / 255.0 / 16.0;
    float extrude_x = a_Dir.x * 2.0 -1.0;
    float extrude_y = a_Dir.y * 2.0 -1.0;
    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));
    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 2.5;
    v_extrude = extrude_dir * S;

    vec2 offset = project_pixel(v_extrude * u_radius);
    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
    } else {
        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
    }
}
`,by=(gy=(0,Wr.b2)(),gy(yy=function(e){(0,Ir.Z)(r,e);var i=uS(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ne.Z)(n),"texture",void 0),(0,A.Z)((0,ne.Z)(n),"colorTexture",void 0),(0,A.Z)((0,ne.Z)(n),"heatmapFramerBuffer",void 0),(0,A.Z)((0,ne.Z)(n),"intensityModel",void 0),(0,A.Z)((0,ne.Z)(n),"colorModel",void 0),(0,A.Z)((0,ne.Z)(n),"shapeType",void 0),n}return(0,Pt.Z)(r,[{key:"render",value:function(){var a=this,s=this.rendererService,f=s.clear,v=s.useFramebuffer;v(this.heatmapFramerBuffer,function(){f({color:[0,0,0,0],depth:1,stencil:0,framebuffer:a.heatmapFramerBuffer}),a.drawIntensityMode()}),this.layer.styleNeedUpdate&&this.updateColorTexture(),this.shapeType==="heatmap"?this.drawColorMode():this.draw3DHeatMap()}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var a,s=this.rendererService,f=s.createFramebuffer,v=s.clear,g=s.getViewportSize,x=s.createTexture2D,C=s.useFramebuffer,T=this.styleAttributeService.getLayerStyleAttribute("shape"),O=(T==null||(a=T.scale)===null||a===void 0?void 0:a.field)||"heatmap";this.shapeType=O,this.intensityModel=this.buildHeatMapIntensity(),this.colorModel=O==="heatmap"?this.buildHeatmapColor():this.build3dHeatMap();var k=g(),j=k.width,X=k.height;return this.heatmapFramerBuffer=f({color:x({width:Math.floor(j/4),height:Math.floor(X/4),wrapS:G.CLAMP_TO_EDGE,wrapT:G.CLAMP_TO_EDGE,min:G.LINEAR,mag:G.LINEAR}),depth:!1}),this.updateColorTexture(),[this.intensityModel,this.colorModel]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:On.Attribute,descriptor:{name:"a_Dir",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(s,f,v,g){return[v[3],v[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(s,f,v,g){var x=s.size,C=x===void 0?1:x;return[C]}}})}},{key:"buildHeatMapIntensity",value:function(){return this.layer.triangulation=vy,this.layer.buildLayerModel({moduleName:"heatmapintensity",vertexShader:vS,fragmentShader:dS,triangulation:vy,depth:{enable:!1},cull:{enable:!0,face:h(this.mapService.version)},blend:{enable:!0,func:{srcRGB:G.ONE,srcAlpha:1,dstRGB:G.ONE,dstAlpha:1}}})}},{key:"buildHeatmapColor",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;this.shaderModuleService.registerModule("heatmapColor",{vs:pS,fs:hS});var x=this.shaderModuleService.getModule("heatmapColor"),C=x.vs,T=x.fs,O=x.uniforms,k=this.rendererService,j=k.createAttribute,X=k.createElements,te=k.createBuffer,be=k.createModel;return be({vs:C,fs:T,attributes:{a_Position:j({buffer:te({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:G.FLOAT}),size:3}),a_Uv:j({buffer:te({data:[0,1,1,1,0,0,1,0],type:G.FLOAT}),size:2})},uniforms:xy({},O),depth:{enable:!1},blend:this.getBlend(),count:6,elements:X({data:[0,2,1,2,3,1],type:G.UNSIGNED_INT,count:6}),stencil:Pa(f,g)})}},{key:"drawIntensityMode",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=a.intensity,v=f===void 0?10:f,g=a.radius,x=g===void 0?5:g;this.intensityModel.draw({uniforms:{u_opacity:s||1,u_radius:x,u_intensity:v}})}},{key:"drawColorMode",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity;this.colorModel.draw({uniforms:{u_opacity:s||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer}})}},{key:"draw3DHeatMap",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=zr();Hr(f,this.cameraService.getViewProjectionMatrixUncentered()),this.colorModel.draw({uniforms:{u_opacity:s||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:(0,Ce.Z)(f)}})}},{key:"build3dHeatMap",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v,x=this.rendererService.getViewportSize,C=x(),T=C.width,O=C.height,k=sS(T/4,O/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:fS,fs:cS});var j=this.shaderModuleService.getModule("heatmap3dColor"),X=j.vs,te=j.fs,be=j.uniforms,Ne=this.rendererService,$e=Ne.createAttribute,ot=Ne.createElements,bt=Ne.createBuffer,_t=Ne.createModel;return _t({vs:X,fs:te,attributes:{a_Position:$e({buffer:bt({data:k.vertices,type:G.FLOAT}),size:3}),a_Uv:$e({buffer:bt({data:k.uvs,type:G.FLOAT}),size:2})},primitive:G.TRIANGLES,uniforms:xy({},be),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:G.SRC_ALPHA,srcAlpha:1,dstRGB:G.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:ot({data:k.indices,type:G.UNSIGNED_INT,count:k.indices.length}),stencil:Pa(f,g)})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var a=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var s=this.layer.getLayerConfig(),f=s.rampColors,v=Ts(f);this.colorTexture=a({data:new Uint8Array(v.data),width:v.width,height:v.height,wrapS:G.CLAMP_TO_EDGE,wrapT:G.CLAMP_TO_EDGE,min:G.NEAREST,mag:G.NEAREST,flipY:!1})}}]),r}(fo))||yy);function mS(e){var i=gS();return function(){var n=(0,Mt.Z)(e),a;if(i){var s=(0,Mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,wr.Z)(this,a)}}function gS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var yS=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,_S=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
    
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);
 
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));
    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT;
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));
    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,xS=function(e){(0,Ir.Z)(r,e);var i=mS(r);function r(){return(0,ht.Z)(this,r),i.apply(this,arguments)}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=a.coverage,v=a.angle;return{u_opacity:s||1,u_coverage:f||.9,u_angle:v||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"hexagonheatmap",vertexShader:_S,fragmentShader:yS,triangulation:py,depth:{enable:!1},primitive:G.TRIANGLES,blend:this.getBlend(),stencil:Pa(f,g)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:On.Attribute,descriptor:{name:"a_Pos",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:3,update:function(s,f){var v=s.version==="GAODE2.x"?s.originCoordinates:s.coordinates;return[v[0],v[1],0]}}})}}]),r}(fo),bS={heatmap:by,heatmap3d:by,grid:tS,grid3d:oS,hexagon:xS},ES=bS;function SS(e){var i=CS();return function(){var n=(0,Mt.Z)(e),a;if(i){var s=(0,Mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,wr.Z)(this,a)}}function CS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var AS=function(e){(0,Ir.Z)(r,e);var i=SS(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ne.Z)(n),"type","HeatMapLayer"),n}return(0,Pt.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new ES[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"renderModels",value:function(){var a=this,s=this.getModelType();return s==="heatmap"?(this.layerModel&&this.layerModel.render(),this):(this.layerModelNeedUpdate&&(this.models=this.layerModel.buildModels(),this.layerModelNeedUpdate=!1),this.models.forEach(function(f){return f.draw({uniforms:a.layerModel.getUninforms()})}),this)}},{key:"updateModelData",value:function(a){a.attributes&&a.elements?this.models[0].updateAttributesAndElements(a.attributes,a.elements):console.warn("data error")}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var a,s=this.styleAttributeService.getLayerStyleAttribute("shape"),f=this.getLayerConfig(),v=f.shape3d,g=this.getSource(),x=g.data.type,C=(s==null||(a=s.scale)===null||a===void 0?void 0:a.field)||"heatmap";return C==="heatmap"||C==="heatmap3d"?"heatmap":x==="hexagon"?(v==null?void 0:v.indexOf(C))===-1?"hexagon":"grid3d":x==="grid"?(v==null?void 0:v.indexOf(C))===-1?"grid":"grid3d":"heatmap"}}]),r}(qh);function wS(e){var i=TS();return function(){var n=(0,Mt.Z)(e),a;if(i){var s=(0,Mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,wr.Z)(this,a)}}function TS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var MS=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
void main() {
  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));
  gl_FragColor = color;
  gl_FragColor.a *= u_opacity;
}
`,PS=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,IS=function(e){(0,Ir.Z)(r,e);var i=wS(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ne.Z)(n),"texture",void 0),n}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity;return{u_opacity:s||1,u_texture:this.texture}}},{key:"initModels",value:function(){var a=this,s=this.layer.getLayerConfig(),f=s.mask,v=f===void 0?!1:f,g=s.maskInside,x=g===void 0?!0:g,C=this.layer.getSource(),T=this.rendererService.createTexture2D;if(this.texture=T({height:0,width:0}),ts){var O=this.layerService.sceneService.getSceneConfig().canvas,k=O.createImage();k.crossOrigin="anonymous",k.src=C.data.originData,k.onload=function(){a.texture=T({data:k,width:k.width,height:k.height}),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()}}else C.data.images.then(function(j){a.texture=T({data:j[0],width:j[0].width,height:j[0].height}),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()});return[this.layer.buildLayerModel({moduleName:"RasterImage",vertexShader:PS,fragmentShader:MS,triangulation:dy,primitive:G.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:Pa(v,x)})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:On.Attribute,descriptor:{name:"a_Uv",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(s,f,v,g){return[v[3],v[4]]}}})}}]),r}(fo),OS={image:IS},RS=OS;function LS(e){var i=kS();return function(){var n=(0,Mt.Z)(e),a;if(i){var s=(0,Mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,wr.Z)(this,a)}}function kS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ey=function(e){(0,Ir.Z)(r,e);var i=LS(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ne.Z)(n),"type","ImageLayer"),n}return(0,Pt.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new RS[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var a=this.getModelType(),s={image:{}};return s[a]}},{key:"getModelType",value:function(){return"image"}}]),r}(qh);function DS(e){var i=FS();return function(){var n=(0,Mt.Z)(e),a;if(i){var s=(0,Mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,wr.Z)(this,a)}}function FS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var BS=`
uniform float u_opacity;

varying vec4 v_dash_array;
varying vec4 v_color;

uniform float segmentNumber;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  gl_FragColor = v_color;
  gl_FragColor.a *= opacity;

  float flag = 0.;
  float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    flag = 1.;
  }
  gl_FragColor.a *=flag;
  
  gl_FragColor = filterColor(gl_FragColor);
}`,NS=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
varying vec4 v_color;


uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_lineDir: 1.0;
varying vec4 v_dash_array;

uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);

  vec2 s = source;
  vec2 t = target;
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    s = unProjCustomCoord(source);
    t = unProjCustomCoord(target);
  }
  float total_Distance = pixelDistance(s, t) / 2.0 * PI;
  
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  

   styleMappingMat[3].b = segmentIndex / segmentNumber;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,zS=`
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_segmentIndex = styleMappingMat[3].r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  float d_distance_ratio = styleMappingMat[3].b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  gl_FragColor = v_color;
  
  gl_FragColor.a *= opacity;

  if(u_aimate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  // \u5F53\u5B58\u5728\u8D34\u56FE\u65F6\u5728\u5E95\u8272\u4E0A\u8D34\u4E0A\u8D34\u56FE
  if(u_line_texture == LineTexture) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);

    float count = styleMappingMat[3].g; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_aimate.x == Animate) {
      time = u_time / u_aimate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);
    float v = styleMappingMat[3].a; // \u6A2A\u5411 v
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture2D(u_texture, uv);

    if(u_aimate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_aimate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    
  } else {
     gl_FragColor = filterColor(gl_FragColor);
  }
  // gl_FragColor = filterColor(gl_FragColor);
}`,US=`#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_lineDir: 1.0;

uniform float u_thetaOffset: 0.314;
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;
  
  if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        d_distance_ratio = 1.0 - d_distance_ratio;
      }
  }

   styleMappingMat[3].b = d_distance_ratio;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  styleMappingMat[3].r = d_segmentIndex;

  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    float arcDistrance = length(source - target); // \u8D77\u59CB\u70B9\u548C\u7EC8\u70B9\u7684\u8DDD\u79BB
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      arcDistrance *= 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      // arcDistrance *= 8.0;
      arcDistrance = project_pixel_allmap(arcDistrance);
    }
    v_iconMapUV = a_iconMapUV;

    float pixelLen = project_pixel_texture(u_icon_step); // \u8D34\u56FE\u6CBF\u5F27\u7EBF\u65B9\u5411\u7684\u957F\u5EA6 - \u968F\u5730\u56FE\u7F29\u653E\u6539\u53D8
    float texCount = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
     styleMappingMat[3].g = texCount;

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size); // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB
     styleMappingMat[3].a = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,ZS=`#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float d_segmentIndex = styleMappingMat[3].r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}`,jS=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
varying vec4 v_color;

uniform float u_lineDir: 1.0;

uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;

   styleMappingMat[3].b = d_distance_ratio;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  styleMappingMat[3].r = d_segmentIndex;

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,VS={solid:0,dash:1},GS=function(e){(0,Ir.Z)(r,e);var i=DS(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ne.Z)(n),"texture",void 0),(0,A.Z)((0,ne.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=v({data:n.iconService.getCanvas(),mag:G.NEAREST,min:G.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.sourceColor,g=a.targetColor,x=a.textureBlend,C=x===void 0?"normal":x,T=a.lineType,O=T===void 0?"solid":T,k=a.dashArray,j=k===void 0?[10,5]:k,X=a.forward,te=X===void 0?!0:X,be=a.lineTexture,Ne=be===void 0?!1:be,$e=a.iconStep,ot=$e===void 0?100:$e,bt=a.segmentNumber,_t=bt===void 0?30:bt,qt=a.thetaOffset,ar=qt===void 0?.314:qt;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f,thetaOffset:ar})){this.judgeStyleAttributes({opacity:f,thetaOffset:ar});var Pr=this.layer.getEncodedData(),qr=this.calDataFrame(this.cellLength,Pr,this.cellProperties),gr=qr.data,un=qr.width,Ln=qr.height;this.rowCount=Ln,this.dataTexture=this.cellLength>0&&gr.length>0?this.createTexture2D({flipY:!0,data:gr,format:G.LUMINANCE,type:G.FLOAT,width:un,height:Ln}):this.createTexture2D({flipY:!0,data:[1],format:G.LUMINANCE,type:G.FLOAT,width:1,height:1})}j.length===2&&j.push(0,0);var Vn=0,Fa=[0,0,0,0],Ro=[0,0,0,0];return v&&g&&(Fa=Ji(v),Ro=Ji(g),Vn=1),this.rendererService.getDirty()&&this.texture.bind(),{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_thetaOffset:fa()(ar)?ar:0,u_opacity:fa()(f)?f:1,u_textureBlend:C==="normal"?0:1,segmentNumber:_t,u_line_type:VS[O||"solid"],u_dash_array:j,u_blur:.9,u_lineDir:te?1:-1,u_texture:this.texture,u_line_texture:Ne?1:0,u_icon_step:ot,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Vn,u_sourceColor:Fa,u_targetColor:Ro}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var a=this.layer.getLayerConfig(),s=a.sourceColor,f=a.targetColor,v=a.lineType;return v==="dash"?{frag:BS,vert:NS,type:"dash"}:s&&f?{frag:ZS,vert:jS,type:"linear"}:{frag:zS,vert:US,type:"normal"}}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.segmentNumber,f=s===void 0?30:s,v=a.mask,g=v===void 0?!1:v,x=a.maskInside,C=x===void 0?!0:x,T=this.getShaders(),O=T.frag,k=T.vert,j=T.type;return[this.layer.buildLayerModel({moduleName:"arc2dline"+j,vertexShader:k,fragmentShader:O,triangulation:Zv,depth:{enable:!1},blend:this.getBlend(),segmentNumber:f,stencil:Pa(g,C)})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(f,v,g,x){var C=f.size,T=C===void 0?1:C;return Array.isArray(T)?[T[0]]:[T]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:On.Attribute,descriptor:{name:"a_Instance",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:4,update:function(f,v,g,x){return[g[3],g[4],g[5],g[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:On.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(f,v,g,x){var C=a.iconService.getIconMap(),T=f.texture,O=C[T]||{x:0,y:0},k=O.x,j=O.y;return[k,j]}}})}}]),r}(fo);function HS(e){var i=WS();return function(){var n=(0,Mt.Z)(e),a;if(i){var s=(0,Mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,wr.Z)(this,a)}}function WS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var XS=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;

  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_aimate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_aimate.x == Animate) {
      time = u_time / u_aimate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_aimate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_aimate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,YS=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // TODO: + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // TODO: \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,qS=`
#define Animate 0.0

uniform float u_opacity;
uniform float u_blur : 0.9;
varying float v_segmentIndex;
uniform float segmentNumber;


uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);

  gl_FragColor.a *= opacity;

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_aimate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,KS=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // TODO: + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // TODO: \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,$S={solid:0,dash:1},QS=function(e){(0,Ir.Z)(r,e);var i=HS(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ne.Z)(n),"texture",void 0),(0,A.Z)((0,ne.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=v({data:n.iconService.getCanvas(),mag:G.NEAREST,min:G.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.sourceColor,g=a.targetColor,x=a.textureBlend,C=x===void 0?"normal":x,T=a.lineType,O=T===void 0?"solid":T,k=a.dashArray,j=k===void 0?[10,5]:k,X=a.lineTexture,te=X===void 0?!1:X,be=a.iconStep,Ne=be===void 0?100:be,$e=a.segmentNumber,ot=$e===void 0?30:$e,bt=a.globalArcHeight,_t=bt===void 0?10:bt;j.length===2&&j.push(0,0);var qt=0,ar=[0,0,0,0],Pr=[0,0,0,0];if(v&&g&&(ar=Ji(v),Pr=Ji(g),qt=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f})){this.judgeStyleAttributes({opacity:f});var qr=this.layer.getEncodedData(),gr=this.calDataFrame(this.cellLength,qr,this.cellProperties),un=gr.data,Ln=gr.width,Vn=gr.height;this.rowCount=Vn,this.dataTexture=this.cellLength>0&&un.length>0?this.createTexture2D({flipY:!0,data:un,format:G.LUMINANCE,type:G.FLOAT,width:Ln,height:Vn}):this.createTexture2D({flipY:!0,data:[1],format:G.LUMINANCE,type:G.FLOAT,width:1,height:1})}return{u_globel:this.mapService.version==="GLOBEL"?1:0,u_globel_radius:Jg,u_global_height:_t,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:fa()(f)?f:1,u_textureBlend:C==="normal"?0:1,segmentNumber:ot,u_line_type:$S[O]||0,u_dash_array:j,u_texture:this.texture,u_line_texture:te?1:0,u_icon_step:Ne,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:qt,u_sourceColor:ar,u_targetColor:Pr}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var a=this.layer.getLayerConfig(),s=a.sourceColor,f=a.targetColor;return s&&f?{frag:qS,vert:KS,type:"linear"}:{frag:XS,vert:YS,type:"normal"}}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.segmentNumber,f=s===void 0?30:s,v=a.mask,g=v===void 0?!1:v,x=a.maskInside,C=x===void 0?!0:x,T=this.getShaders(),O=T.frag,k=T.vert,j=T.type;return[this.layer.buildLayerModel({moduleName:"arc3Dline"+j,vertexShader:k,fragmentShader:O,triangulation:Zv,blend:this.getBlend(),segmentNumber:f,stencil:Pa(g,C)})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(f,v,g,x){var C=f.size,T=C===void 0?1:C;return Array.isArray(T)?[T[0]]:[T]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:On.Attribute,descriptor:{name:"a_Instance",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:4,update:function(f,v,g,x){return[g[3],g[4],g[5],g[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:On.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(f,v,g,x){var C=a.iconService.getIconMap(),T=f.texture,O=C[T]||{x:0,y:0},k=O.x,j=O.y;return[k,j]}}})}}]),r}(fo);function JS(e){var i=eC();return function(){var n=(0,Mt.Z)(e),a;if(i){var s=(0,Mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,wr.Z)(this,a)}}function eC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var tC=`#define Animate 0.0

uniform float u_opacity;
uniform float u_blur : 0.9;
// varying vec2 v_normal;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float segmentNumber;
varying float v_distance_ratio;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }
  
 
  gl_FragColor.a *= u_opacity;

  if(u_aimate.x == Animate) {
      float animateSpeed = u_time / u_aimate.y; // \u8FD0\u52A8\u901F\u5EA6
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }
}`,rC=`#define Animate 0.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_lineDir: 1.0;

// \u504F\u79FB\u91CF
uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying float v_distance_ratio;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = u_thetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;
  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);

  v_distance_ratio = segmentIndex / segmentNumber;
  
  if(u_aimate.x == Animate && u_lineDir != 1.0) {
      v_distance_ratio = 1.0 - v_distance_ratio;
  }

  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
}
`,nC=function(e){(0,Ir.Z)(r,e);var i=JS(r);function r(){return(0,ht.Z)(this,r),i.apply(this,arguments)}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.sourceColor,g=a.targetColor,x=a.forward,C=x===void 0?!0:x,T=a.segmentNumber,O=T===void 0?30:T,k=a.thetaOffset,j=k===void 0?.314:k,X=0,te=[0,0,0,0],be=[0,0,0,0];return v&&g&&(te=Ji(v),be=Ji(g),X=1),{u_thetaOffset:j,u_opacity:fa()(f)?f:1,segmentNumber:O,u_blur:.9,u_lineDir:C?1:-1,u_linearColor:X,u_sourceColor:te,u_targetColor:be}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.segmentNumber,f=s===void 0?30:s;return[this.layer.buildLayerModel({moduleName:"arc2dminiline",vertexShader:rC,fragmentShader:tC,triangulation:Zv,depth:{enable:!1},blend:this.getBlend(),segmentNumber:f})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(s,f,v,g){var x=s.size,C=x===void 0?1:x;return Array.isArray(C)?[C[0]]:[C]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:On.Attribute,descriptor:{name:"a_Instance",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:4,update:function(s,f,v,g){return[v[3],v[4],v[5],v[6]]}}})}}]),r}(fo);function iC(e){var i=aC();return function(){var n=(0,Mt.Z)(e),a;if(i){var s=(0,Mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,wr.Z)(this,a)}}function aC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var oC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0;
  float d_segmentIndex = styleMappingMat[3].g;
  
  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u52A8\u753B\u6A21\u5F0F
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- smoothstep(0.0, 1.0, v_distance_ratio), u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u8D34\u56FE
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { 
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }

    float v = styleMappingMat[3].a; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);
    
    // \u8BBE\u7F6E\u8D34\u56FE\u548C\u5E95\u8272\u7684\u53E0\u52A0\u6A21\u5F0F
    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}`,sC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
    vec2 x = mix(source, target, ratio);
    vec2 center = mix(source, target, 0.5);
    float dSourceCenter = distance(source, center);
    float dXCenter = distance(x, center);
    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
     float vertex_height = paraboloid(source, target, segmentRatio);

    return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
    );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) *
    sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 mid = midPoint(source, target);
    vec3 x = vec3(source.x, mid.x, target.x);
    vec3 y = vec3(source.y, mid.y, target.y);
    return vec2(bezier3(x ,t), bezier3(y,t));
  }else {
    if(abs(angularDist - PI) < 0.001) {
      return (1.0 - t) * source + t * target;
    }
    float a = sin((1.0 - t) * angularDist) / sin(angularDist);
    float b = sin(t * angularDist) / sin(angularDist);
    vec2 sin_source = sin(source);
    vec2 cos_source = cos(source);
    vec2 sin_target = sin(target);
    vec2 cos_target = cos(target);
    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
    float z = a * sin_source.y + b * sin_target.y;
    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));
  }
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    total_Distance = total_Distance*8.0;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba);
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
  if(u_aimate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;
  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

  styleMappingMat[3].g = a_Position.x; // \u8BE5\u9876\u70B9\u5728\u5F27\u7EBF\u4E0A\u7684\u5206\u6BB5\u6392\u5E8F
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;
    float d_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      d_arcDistrance = d_arcDistrance * 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      d_arcDistrance = project_pixel_allmap(d_arcDistrance);
    }
    float d_pixelLen = project_pixel(u_icon_step)/8.0;
    styleMappingMat[3].b = floor(d_arcDistrance/d_pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}

`,uC={solid:0,dash:1},lC=function(e){(0,Ir.Z)(r,e);var i=iC(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ne.Z)(n),"texture",void 0),(0,A.Z)((0,ne.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=v({data:n.iconService.getCanvas(),mag:G.NEAREST,min:G.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.sourceColor,g=a.targetColor,x=a.textureBlend,C=x===void 0?"normal":x,T=a.lineType,O=T===void 0?"solid":T,k=a.dashArray,j=k===void 0?[10,5]:k,X=a.lineTexture,te=X===void 0?!1:X,be=a.iconStep,Ne=be===void 0?100:be,$e=a.segmentNumber,ot=$e===void 0?30:$e;j.length===2&&j.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var bt=0,_t=[0,0,0,0],qt=[0,0,0,0];if(v&&g&&(_t=Ji(v),qt=Ji(g),bt=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f})){this.judgeStyleAttributes({opacity:f});var ar=this.layer.getEncodedData(),Pr=this.calDataFrame(this.cellLength,ar,this.cellProperties),qr=Pr.data,gr=Pr.width,un=Pr.height;this.rowCount=un,this.dataTexture=this.cellLength>0&&qr.length>0?this.createTexture2D({flipY:!0,data:qr,format:G.LUMINANCE,type:G.FLOAT,width:gr,height:un}):this.createTexture2D({flipY:!0,data:[1],format:G.LUMINANCE,type:G.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:fa()(f)?f:1,u_textureBlend:C==="normal"?0:1,segmentNumber:ot,u_line_type:uC[O]||0,u_dash_array:j,u_texture:this.texture,u_line_texture:te?1:0,u_icon_step:Ne,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:bt,u_sourceColor:_t,u_targetColor:qt}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"greatcircleline",vertexShader:sC,fragmentShader:oC,triangulation:Zv,depth:{enable:!1},blend:this.getBlend(),stencil:Pa(f,g)})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(f,v,g,x){var C=f.size,T=C===void 0?1:C;return Array.isArray(T)?[T[0]]:[T]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:On.Attribute,descriptor:{name:"a_Instance",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:4,update:function(f,v,g,x){return[g[3],g[4],g[5],g[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:On.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(f,v,g,x){var C=a.iconService.getIconMap(),T=f.texture,O=C[T]||{x:0,y:0},k=O.x,j=O.y;return[k,j]}}})}}]),r}(fo);function cC(e){var i=fC();return function(){var n=(0,Mt.Z)(e),a;if(i){var s=(0,Mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,wr.Z)(this,a)}}function fC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var hC=`#define LineTypeSolid 0.0
uniform float u_opacity : 1.0;

varying vec4 v_color;

// dash
varying vec4 v_dash_array;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
 // dash line
 
  float flag = 0.;
  float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    flag = 1.;
  }
  gl_FragColor.a *=flag;

  gl_FragColor = filterColor(gl_FragColor);
}
`,pC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];

uniform float u_vertexScale: 1.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;
varying vec4 v_dash_array;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  vec2 offset = project_pixel(size.xy);

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = a_DistanceAndIndex.x / a_Total_Distance; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = a_DistanceAndIndex.x;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, project_pixel(a_Size.y), 1.0));
  } else {
    float lineHeight = a_Size.y;
 
    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,dC=`#define Animate 0.0
#define LineTexture 1.0
uniform float u_blur : 0.99;
uniform float u_opacity : 1.0;
uniform float u_textureBlend;

uniform float u_borderWidth: 0.0;
uniform vec4 u_borderColor;
varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

varying vec2 v_iconMapUV;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, vec2(u, v)));
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor += pattern;
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = pattern;
    }
  } 

  float v = styleMappingMat[3].a;
  float borderWidth = min(0.5, u_borderWidth);
  // \u7ED8\u5236 border
  if(borderWidth > 0.01) {
    float borderOuterWidth = borderWidth/2.0;

    if(v >= 1.0 - borderWidth || v <= borderWidth) {
      if(v > borderWidth) {
        float linear = smoothstep(0.0, 1.0, (v - (1.0 - borderWidth))/borderWidth);
        gl_FragColor.rgb = mix(gl_FragColor.rgb, u_borderColor.rgb, linear);
      } else if(v <= borderWidth) {
        float linear = smoothstep(0.0, 1.0, v/borderWidth);
        gl_FragColor.rgb = mix(u_borderColor.rgb, gl_FragColor.rgb, linear);
      }
    }

    if(v < borderOuterWidth) {
      gl_FragColor.a = mix(0.0, gl_FragColor.a, v/borderOuterWidth);
    } else if(v > 1.0 - borderOuterWidth) {
      gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);
    }
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,Sy=`
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;

uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;
uniform float u_raisingHeight: 0.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;


uniform float u_linearColor: 0;
uniform float u_arrow: 0.0;
uniform float u_arrowHeight: 3.0;
uniform float u_arrowWidth: 2.0;
uniform float u_tailWidth: 1.0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

vec2 calculateArrow(vec2 offset) {
  /*
  * \u5728\u652F\u6301\u7BAD\u5934\u7684\u65F6\u5019\uFF0C\u7B2C\u4E8C\u3001\u7B2C\u4E09\u7EC4\u9876\u70B9\u662F\u989D\u5916\u63D2\u5165\u7528\u4E8E\u6784\u5EFA\u9876\u70B9\u7684
  */
  float arrowFlag = -1.0;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // \u9AD8\u5FB7 2.0 \u7684\u65CB\u8F6C\u89D2\u5EA6\u4E0D\u540C
    arrowFlag = 1.0;
  }
  float pi = arrowFlag * 3.1415926/2.;
  if(a_Miter < 0.) {
    // \u6839\u636E\u7EBF\u7684\u4E24\u4FA7\u504F\u79FB\u4E0D\u540C\u3001\u65CB\u8F6C\u7684\u65B9\u5411\u76F8\u53CD
    pi = -pi;
  }
  highp float angle_sin = sin(pi);
  highp float angle_cos = cos(pi);
  // \u8BA1\u7B97\u5782\u76F4\u4E0E\u7EBF\u65B9\u5411\u7684\u65CB\u8F6C\u77E9\u9635
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  float arrowWidth = u_arrowWidth;
  float arrowHeight = u_arrowHeight;

  vec2 arrowOffset = vec2(0.0);
  /*
  * a_DistanceAndIndex.y \u7528\u4E8E\u6807\u8BB0\u5F53\u524D\u9876\u70B9\u5C5E\u4E8E\u54EA\u4E00\u7EC4\uFF08\u4E24\u4E2A\u9876\u70B9\u4E00\u7EC4\uFF0C\u6784\u6210\u7EBF\u7684\u5176\u5B9E\u662F\u77E9\u5F62\uFF0C\u6700\u7B80\u9700\u8981\u56DB\u4E2A\u9876\u70B9\u3001\u4E24\u7EC4\u9876\u70B9\u6784\u6210\uFF09
  */
  if(a_DistanceAndIndex.y == 0.0) {
    // \u7BAD\u5934\u5C16\u90E8
    offset = vec2(0.0);
  } else if(a_DistanceAndIndex.y == 1.0) {
    // \u7BAD\u5934\u4E24\u4FA7
    arrowOffset = rotation_matrix*(offset * arrowHeight);
    offset += arrowOffset; // \u6CBF\u7EBF\u504F\u79FB
    offset = offset * arrowWidth; // \u5782\u76F4\u7EBF\u5411\u5916\u504F\u79FB\uFF08\u662F\u6784\u5EFA\u7BAD\u5934\u4E24\u4FA7\u7684\u9876\u70B9\uFF09
  } else if(a_DistanceAndIndex.y == 2.0 || a_DistanceAndIndex.y == 3.0 || a_DistanceAndIndex.y == 4.0) {
    // \u504F\u79FB\u5176\u4F59\u7684\u70B9\u4F4D\uFF08\u5C06\u957F\u5EA6\u8BA9\u4F4D\u7ED9\u7BAD\u5934\uFF09
    arrowOffset = rotation_matrix*(offset * arrowHeight) * arrowWidth;
    offset += arrowOffset;// \u6CBF\u7EBF\u504F\u79FB
  }

  return offset;
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_float_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 
  if(u_arrow > 0.0) {
      //  \u8BA1\u7B97\u7BAD\u5934
    offset = calculateArrow(offset);

    if(a_DistanceAndIndex.y > 4.0) {
      offset *= mix(1.0, u_tailWidth, currentLinePointRatio);
    }
  }

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = lineDistance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = texV;             // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,vC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
uniform float u_blur : 0.99;
uniform float u_line_type: 0.0;
uniform float u_opacity : 1.0;

varying vec4 v_color;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"


varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,mC={solid:0,dash:1},Cy=function(e){(0,Ir.Z)(r,e);var i=cC(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ne.Z)(n),"texture",void 0),(0,A.Z)((0,ne.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=v({data:n.iconService.getCanvas(),mag:G.NEAREST,min:G.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.sourceColor,g=a.targetColor,x=a.textureBlend,C=x===void 0?"normal":x,T=a.lineType,O=T===void 0?"solid":T,k=a.dashArray,j=k===void 0?[10,5,0,0]:k,X=a.lineTexture,te=X===void 0?!1:X,be=a.iconStep,Ne=be===void 0?100:be,$e=a.vertexHeightScale,ot=$e===void 0?20:$e,bt=a.borderWidth,_t=bt===void 0?0:bt,qt=a.borderColor,ar=qt===void 0?"#ccc":qt,Pr=a.raisingHeight,qr=Pr===void 0?0:Pr,gr=a.heightfixed,un=gr===void 0?!1:gr,Ln=a.arrow,Vn=Ln===void 0?{enable:!1,arrowWidth:2,arrowHeight:3,tailWidth:1}:Ln;j.length===2&&j.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var Fa=0,Ro=[0,0,0,0],Ls=[0,0,0,0];if(v&&g&&(Ro=Ji(v),Ls=Ji(g),Fa=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f})){this.judgeStyleAttributes({opacity:f});var au=this.layer.getEncodedData(),Vs=this.calDataFrame(this.cellLength,au,this.cellProperties),Oc=Vs.data,gm=Vs.width,g0=Vs.height;this.rowCount=g0,this.dataTexture=this.cellLength>0&&Oc.length>0?this.createTexture2D({flipY:!0,data:Oc,format:G.LUMINANCE,type:G.FLOAT,width:gm,height:g0}):this.createTexture2D({flipY:!0,data:[1],format:G.LUMINANCE,type:G.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:fa()(f)?f:1,u_textureBlend:C==="normal"?0:1,u_line_type:mC[O],u_dash_array:j,u_texture:this.texture,u_line_texture:te?1:0,u_icon_step:Ne,u_textSize:[1024,this.iconService.canvasHeight||128],u_borderWidth:_t,u_borderColor:Ji(ar),u_linearColor:Fa,u_sourceColor:Ro,u_targetColor:Ls,u_heightfixed:Number(un),u_vertexScale:ot,u_raisingHeight:Number(qr),u_arrow:Number(Vn.enable),u_arrowHeight:Vn.arrowHeight||3,u_arrowWidth:Vn.arrowWidth||2,u_tailWidth:Vn.tailWidth===void 0?1:Vn.tailWidth}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v,x=a.depth,C=x===void 0?!1:x,T=this.getShaders(),O=T.frag,k=T.vert,j=T.type;return this.layer.triangulation=sv,[this.layer.buildLayerModel({moduleName:"line_"+j,vertexShader:k,fragmentShader:O,triangulation:sv,primitive:G.TRIANGLES,blend:this.getBlend(),depth:{enable:C},stencil:Pa(f,g)})]}},{key:"getShaders",value:function(){var a=this.layer.getLayerConfig(),s=a.sourceColor,f=a.targetColor,v=a.lineType;return v==="dash"?{frag:hC,vert:pC,type:"dash"}:s&&f?{frag:vC,vert:Sy,type:"linear"}:{frag:dC,vert:Sy,type:"normal"}}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:On.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(f,v,g,x,C,T){return T===void 0?[g[3],10]:[g[3],T]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:On.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(f,v,g,x){return[g[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(f,v,g,x){var C=f.size,T=C===void 0?1:C;return Array.isArray(T)?[T[0],T[1]]:[T,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:On.Attribute,descriptor:{name:"a_Normal",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:3,update:function(f,v,g,x,C){return C}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:On.Attribute,descriptor:{name:"a_Miter",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(f,v,g,x){return[g[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:On.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(f,v,g,x){var C=a.iconService.getIconMap(),T=f.texture,O=C[T]||{x:0,y:0},k=O.x,j=O.y;return[k,j]}}})}}]),r}(fo);function gC(e){var i=yC();return function(){var n=(0,Mt.Z)(e),a;if(i){var s=(0,Mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,wr.Z)(this,a)}}function yC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var _C=`uniform float u_opacity : 1.0;
uniform sampler2D u_texture;

#pragma include "picking"

varying mat4 styleMappingMat;

void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = texture2D(u_texture, vec2(d_distance_ratio, 0.5));

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,xC=`
attribute float a_Miter;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;
uniform float u_raisingHeight: 0.0;

uniform float u_opacity: 1.0;

#pragma include "projection"
#pragma include "picking"

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,bC=function(e){(0,Ir.Z)(r,e);var i=gC(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ne.Z)(n),"colorTexture",void 0),(0,A.Z)((0,ne.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;n.colorTexture&&n.colorTexture.destroy();var g=n.layer.getLayerConfig(),x=g.rampColors,C=Ts(x);n.colorTexture=v({data:new Uint8Array(C.data),width:C.width,height:C.height,wrapS:G.CLAMP_TO_EDGE,wrapT:G.CLAMP_TO_EDGE,min:G.NEAREST,mag:G.NEAREST,flipY:!1})}),n}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.vertexHeightScale,g=v===void 0?20:v,x=a.raisingHeight,C=x===void 0?0:x,T=a.heightfixed,O=T===void 0?!1:T;if(this.rendererService.getDirty()&&this.colorTexture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f})){this.judgeStyleAttributes({opacity:f});var k=this.layer.getEncodedData(),j=this.calDataFrame(this.cellLength,k,this.cellProperties),X=j.data,te=j.width,be=j.height;this.rowCount=be,this.dataTexture=this.cellLength>0&&X.length>0?this.createTexture2D({flipY:!0,data:X,format:G.LUMINANCE,type:G.FLOAT,width:te,height:be}):this.createTexture2D({flipY:!0,data:[1],format:G.LUMINANCE,type:G.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:fa()(f)?f:1,u_texture:this.colorTexture,u_heightfixed:Number(O),u_vertexScale:g,u_raisingHeight:Number(C)}}},{key:"initModels",value:function(){return this.updateTexture(),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.colorTexture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v,x=a.depth,C=x===void 0?!1:x,T=this.getShaders(),O=T.frag,k=T.vert,j=T.type;return this.layer.triangulation=sv,[this.layer.buildLayerModel({moduleName:"line_"+j,vertexShader:k,fragmentShader:O,triangulation:sv,primitive:G.TRIANGLES,blend:this.getBlend(),depth:{enable:C},stencil:Pa(f,g)})]}},{key:"getShaders",value:function(){return{frag:_C,vert:xC,type:"linear_rampColors"}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:On.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(s,f,v,g,x,C){return C===void 0?[v[3],10]:[v[3],C]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:On.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(s,f,v,g){return[v[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(s,f,v,g){var x=s.size,C=x===void 0?1:x;return Array.isArray(C)?[C[0],C[1]]:[C,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:On.Attribute,descriptor:{name:"a_Normal",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:3,update:function(s,f,v,g,x){return x}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:On.Attribute,descriptor:{name:"a_Miter",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(s,f,v,g){return[v[4]]}}})}}]),r}(fo);function EC(e){var i=SC();return function(){var n=(0,Mt.Z)(e),a;if(i){var s=(0,Mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,wr.Z)(this,a)}}function SC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var CC=`uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
}
`,AC=`
varying vec4 v_color;
varying mat4 styleMappingMat;
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = v_color;
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
}
`,Ay=`attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Position;

attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_opacity: 1.0;
uniform float u_vertexScale: 1.0;

#pragma include "projection"

varying vec4 v_color;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  v_color = a_Color;  

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, project_pixel(a_Size.y) + h * 0.2, 1.0));
  } else {
    float lineHeight = a_Size.y;
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      h *= 2.0/pow(2.0, 20.0 - u_Zoom);
    }

    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, lineHeight + h, 1.0));
  }
}
`,wC=function(e){(0,Ir.Z)(r,e);var i=EC(r);function r(){return(0,ht.Z)(this,r),i.apply(this,arguments)}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.sourceColor,g=a.targetColor,x=a.vertexHeightScale,C=x===void 0?20:x,T=0,O=[0,0,0,0],k=[0,0,0,0];if(v&&g&&(O=Ji(v),k=Ji(g),T=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f})){this.judgeStyleAttributes({opacity:f});var j=this.layer.getEncodedData(),X=this.calDataFrame(this.cellLength,j,this.cellProperties),te=X.data,be=X.width,Ne=X.height;this.rowCount=Ne,this.dataTexture=this.cellLength>0&&te.length>0?this.createTexture2D({flipY:!0,data:te,format:G.LUMINANCE,type:G.FLOAT,width:be,height:Ne}):this.createTexture2D({flipY:!0,data:[1],format:G.LUMINANCE,type:G.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:fa()(f)?f:1,u_linearColor:T,u_sourceColor:O,u_targetColor:k,u_vertexScale:C}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"getShaders",value:function(){var a=this.layer.getLayerConfig(),s=a.sourceColor,f=a.targetColor;return s&&f?{frag:CC,vert:Ay,type:"simple_linear"}:{frag:AC,vert:Ay,type:"simple_normal"}}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v,x=this.getShaders(),C=x.frag,T=x.vert,O=x.type;return[this.layer.buildLayerModel({moduleName:O,vertexShader:T,fragmentShader:C,triangulation:BE,primitive:G.LINES,blend:this.getBlend(),depth:{enable:!1},stencil:Pa(f,g)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distance",type:On.Attribute,descriptor:{name:"a_Distance",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(s,f,v,g){return[v[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:On.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(s,f,v,g){return[v[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(s,f,v,g){var x=s.size,C=x===void 0?1:x;return Array.isArray(C)?[C[0],C[1]]:[C,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:On.Attribute,descriptor:{name:"a_Normal",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:3,update:function(s,f,v,g,x){return x}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:On.Attribute,descriptor:{name:"a_Miter",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(s,f,v,g){return[v[4]]}}})}}]),r}(fo);function TC(e){var i=MC();return function(){var n=(0,Mt.Z)(e),a;if(i){var s=(0,Mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,wr.Z)(this,a)}}function MC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var PC=`#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity : 1.0;
uniform float u_textureBlend;
uniform float u_iconStepCount;

varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

varying vec2 v_iconMapUV;
varying float v_blur;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float v = styleMappingMat[3].a;

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 start
    float flag = 0.0;
    if(u > 1.0/u_iconStepCount) {
      flag = 1.0;
    }
    u = fract(u*u_iconStepCount);
    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 end

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    // Tip: \u5224\u65AD\u7EB9\u7406\u95F4\u9694
    if(flag > 0.0) {
      pattern = vec4(0.0);
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  }
  

  // blur - AA
  if(v < v_blur) {
    gl_FragColor.a = mix(0.0, gl_FragColor.a, v/v_blur);
  } else if(v > 1.0 - v_blur) {
    gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - v_blur))/v_blur);
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,IC=`#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;
attribute vec2 a_iconMapUV;

attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;
uniform float u_heightfixed;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

varying vec4 v_color;
varying float v_blur;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "light"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    d_texPixelLen = project_pixel(u_icon_step);
  } else {
    d_texPixelLen = u_icon_step;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  if(u_aimate.x == Animate || u_linearColor == 1.0) {
      d_distance_ratio = a_Distance / a_Total_Distance;
  }

  float miter = (a_Miter + 1.0)/2.0;
  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = miter;          // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C 0 - 1

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float originSize = a_Size.x;  // \u56FA\u5B9A\u9AD8\u5EA6
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    originSize = project_float_pixel(a_Size.x);
  }

  float wallHeight = originSize * miter;
  float lightWeight = calc_lighting(vec4(project_pos.xy, wallHeight, 1.0));

  v_blur = min(project_float_pixel(2.0) / originSize, 0.05);

  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w);
  // v_color = a_Color;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, wallHeight, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, wallHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,OC=function(e){(0,Ir.Z)(r,e);var i=TC(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ne.Z)(n),"texture",void 0),(0,A.Z)((0,ne.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=v({data:n.iconService.getCanvas(),mag:G.NEAREST,min:G.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.sourceColor,g=a.targetColor,x=a.textureBlend,C=x===void 0?"normal":x,T=a.heightfixed,O=T===void 0?!1:T,k=a.lineTexture,j=k===void 0?!1:k,X=a.iconStep,te=X===void 0?100:X,be=a.iconStepCount,Ne=be===void 0?1:be;this.rendererService.getDirty()&&this.texture.bind();var $e=0,ot=[0,0,0,0],bt=[0,0,0,0];if(v&&g&&(ot=Ji(v),bt=Ji(g),$e=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f})){this.judgeStyleAttributes({opacity:f});var _t=this.layer.getEncodedData(),qt=this.calDataFrame(this.cellLength,_t,this.cellProperties),ar=qt.data,Pr=qt.width,qr=qt.height;this.rowCount=qr,this.dataTexture=this.cellLength>0&&ar.length>0?this.createTexture2D({flipY:!0,data:ar,format:G.LUMINANCE,type:G.FLOAT,width:Pr,height:qr}):this.createTexture2D({flipY:!0,data:[1],format:G.LUMINANCE,type:G.FLOAT,width:1,height:1})}return{u_heightfixed:Number(O),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:fa()(f)?f:1,u_textureBlend:C==="normal"?0:1,u_texture:this.texture,u_line_texture:j?1:0,u_iconStepCount:Ne,u_icon_step:te,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:$e,u_sourceColor:ot,u_targetColor:bt}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"linewall",vertexShader:IC,fragmentShader:PC,triangulation:sv,primitive:G.TRIANGLES,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"distance",type:On.Attribute,descriptor:{name:"a_Distance",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(f,v,g,x){return[g[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:On.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(f,v,g,x){return[g[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(f,v,g,x){var C=f.size,T=C===void 0?1:C;return Array.isArray(T)?[T[0],T[1]]:[T,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:On.Attribute,descriptor:{name:"a_Normal",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:3,update:function(f,v,g,x,C){return C}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:On.Attribute,descriptor:{name:"a_Miter",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(f,v,g,x){return[g[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:On.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(f,v,g,x){var C=a.iconService.getIconMap(),T=f.texture,O=C[T]||{x:0,y:0},k=O.x,j=O.y;return[k,j]}}})}}]),r}(fo),RC={arc:GS,arcmini:nC,arc3d:QS,greatcircle:lC,wall:OC,line:Cy,simple:wC,linearline:bC},LC=RC;function kC(e){var i=DC();return function(){var n=(0,Mt.Z)(e),a;if(i){var s=(0,Mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,wr.Z)(this,a)}}function DC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var wy=function(e){(0,Ir.Z)(r,e);var i=kC(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ne.Z)(n),"type","LineLayer"),n}return(0,Pt.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new LC[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var a=this.getModelType(),s={line:{},linearline:{},simple:{},wall:{},arc3d:{blend:"additive"},arc:{blend:"additive"},arcmini:{blend:"additive"},greatcircle:{blend:"additive"}};return s[a]}},{key:"getModelType",value:function(){var a,s=this.styleAttributeService.getLayerStyleAttribute("shape"),f=s==null||(a=s.scale)===null||a===void 0?void 0:a.field;return f||"line"}}]),r}(qh);function FC(e){var i=BC();return function(){var n=(0,Mt.Z)(e),a;if(i){var s=(0,Mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,wr.Z)(this,a)}}function BC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var NC=`varying vec4 v_color;
uniform float u_opacity: 1.0;

uniform float u_pickLight: 0.0;

#pragma include "picking"

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_opacitylinear: 0.0;
uniform float u_opacitylinear_dir: 1.0;

void main() {
  float opacity = styleMappingMat[0][0];
  float lightWeight = styleMappingMat[1][3];
  float barLinearZ = styleMappingMat[2][3];

  // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, barLinearZ);
    gl_FragColor.rgb *= lightWeight;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // \u5E94\u7528\u900F\u660E\u5EA6
  gl_FragColor.a *= opacity;

  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - barLinearZ): barLinearZ;
  }

  // picking
  if(u_pickLight > 0.0) {
    gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,zC=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_globel;
uniform float u_r;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform float u_lightEnable: 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA - lightWeight
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - linearZ(\u5782\u76F4\u65B9\u5411 0 - 1 \u7684\u503C)
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  // a_Position.z \u662F\u5728\u6784\u5EFA\u7F51\u683C\u7684\u65F6\u5019\u4F20\u5165\u7684\u6807\u51C6\u503C 0 - 1\uFF0C\u5728\u63D2\u503C\u5668\u63D2\u503C\u53EF\u4EE5\u83B7\u53D6 0\uFF5E1 \u7EBF\u6027\u6E10\u53D8\u7684\u503C
  styleMappingMat[2][3] =  a_Position.z;

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB
  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // \u5706\u67F1\u5149\u7167\u6548\u679C
  float lightWeight = 1.0;
  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }
  styleMappingMat[1][3] = lightWeight;

  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);

  // gl_Position = project_common_position_to_clipspace(pos);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * pos;
  } else {
    gl_Position = project_common_position_to_clipspace(pos);
  }
  
  if(u_globel > 0.0) {
    // \u5728\u5730\u7403\u6A21\u5F0F\u4E0B\uFF0C\u5C06\u539F\u672C\u5782\u76F4\u4E8E xy \u5E73\u9762\u7684\u5706\u67F1\u8C03\u6574\u59FF\u6001\u5230\u9002\u5E94\u5706\u7684\u89D2\u5EA6
    //\u65CB\u8F6C\u77E9\u9635mx\uFF0C\u521B\u5EFA\u7ED5x\u8F74\u65CB\u8F6C\u77E9\u9635
    float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);
    float xRadian = getXRadian(a_Pos.y, r);
    float xcos = cos(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
    float xsin = sin(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
    mat4 mx = mat4(
      1,0,0,0,  
      0,xcos,-xsin,0,  
      0,xsin,xcos,0,  
      0,0,0,1);

    //\u65CB\u8F6C\u77E9\u9635my\uFF0C\u521B\u5EFA\u7ED5y\u8F74\u65CB\u8F6C\u77E9\u9635
    float yRadian = getYRadian(a_Pos.x, a_Pos.z);
    float ycos = cos(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
    float ysin = sin(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
    mat4 my = mat4(
      ycos,0,-ysin,0,  
      0,1,0,0,  
      ysin,0,ycos,0,  
      0,0,0,1);

    gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);
  }

  setPickingColor(a_PickingColor);
}
`,Ty=function(e){(0,Ir.Z)(r,e);var i=FC(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ne.Z)(n),"raiseCount",0),(0,A.Z)((0,ne.Z)(n),"raiserepeat",0),n}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption,f=s===void 0?{enable:!1,speed:.01,repeat:!1}:s,v=a.opacity,g=v===void 0?1:v,x=a.sourceColor,C=a.targetColor,T=a.pickLight,O=T===void 0?!1:T,k=a.heightfixed,j=k===void 0?!1:k,X=a.opacityLinear,te=X===void 0?{enable:!1,dir:"up"}:X,be=a.lightEnable,Ne=be===void 0?!0:be;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:g})){this.judgeStyleAttributes({opacity:g});var $e=this.layer.getEncodedData(),ot=this.calDataFrame(this.cellLength,$e,this.cellProperties),bt=ot.data,_t=ot.width,qt=ot.height;this.rowCount=qt,this.dataTexture=this.cellLength>0&&bt.length>0?this.createTexture2D({flipY:!0,data:bt,format:G.LUMINANCE,type:G.FLOAT,width:_t,height:qt}):this.createTexture2D({flipY:!0,data:[1],format:G.LUMINANCE,type:G.FLOAT,width:1,height:1})}var ar=0,Pr=[0,0,0,0],qr=[0,0,0,0];if(x&&C&&(Pr=Ji(x),qr=Ji(C),ar=1),this.raiseCount<1&&this.raiserepeat>0&&f.enable){var gr=f.speed,un=gr===void 0?.01:gr,Ln=f.repeat,Vn=Ln===void 0?!1:Ln;this.raiseCount+=un,this.raiseCount>=1&&(this.raiserepeat>1?(this.raiseCount=0,this.raiserepeat--):this.raiseCount=1)}return{u_pickLight:Number(O),u_heightfixed:Number(j),u_r:f.enable&&this.raiserepeat>0?this.raiseCount:1,u_globel:this.mapService.version==="GLOBEL"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:fa()(g)?g:1,u_linearColor:ar,u_sourceColor:Pr,u_targetColor:qr,u_opacitylinear:Number(te.enable),u_opacitylinear_dir:te.dir==="up"?1:0,u_lightEnable:Number(Ne)}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.depth,f=s===void 0?!0:s,v=a.animateOption.repeat,g=v===void 0?1:v;return this.raiserepeat=g,[this.layer.buildLayerModel({moduleName:"pointExtrude2",vertexShader:zC,fragmentShader:NC,triangulation:cy,blend:this.getBlend(),cull:{enable:!0,face:h(this.mapService.version)},depth:{enable:f}})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.mapService.version==="GLOBEL";this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:3,update:function(f,v,g,x){var C=f.size;if(C){var T=[];return Array.isArray(C)&&(T=C.length===2?[C[0],C[0],C[1]]:C),Array.isArray(C)||(T=[C,C,C]),T}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:On.Attribute,descriptor:{name:"a_Normal",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:3,update:function(f,v,g,x,C){return C}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:On.Attribute,descriptor:{name:"a_Pos",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:3,update:function(f,v){var g=Mp(f.coordinates);return a?ty([g[0],g[1]]):[g[0],g[1],0]}}})}}]),r}(fo);function UC(e){var i=ZC();return function(){var n=(0,Mt.Z)(e),a;if(i){var s=(0,Mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,wr.Z)(this,a)}}function ZC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var My=`
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

#pragma include "sdf_2d"
#pragma include "picking"

void main() {

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  
  outer_df = sdCircle(v_data.xy, 1.0);
  inner_df = sdCircle(v_data.xy, r);


  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );
  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

 gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);

  float d = length(v_data.xy);
  if(d > 0.5) {
    discard;
  }
  float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_aimate.z - u_aimate.y * u_time)), 0.0, 1.0);
  
  // TODO: \u6839\u636E\u53E0\u52A0\u6A21\u5F0F\u9009\u62E9\u6548\u679C
  if(u_additive > 0.0) {
    gl_FragColor *= intensity;
    // TODO: \u4F18\u5316\u6C34\u6CE2\u70B9 blend additive \u6A21\u5F0F\u4E0B\u6709\u7684\u62FE\u53D6\u6548\u679C 
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor = vec4(gl_FragColor.xyz, gl_FragColor.a * intensity);
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,jC=`
uniform float u_globel;
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  if(u_globel > 0.0) {
    // TODO: \u5730\u7403\u6A21\u5F0F\u4E0B\u907F\u514D\u591A\u4F59\u7247\u5143\u7ED8\u5236\uFF0C\u540C\u65F6\u4E5F\u80FD\u907F\u514D\u6709\u7528\u7247\u5143\u5728\u900F\u660E\u4E14\u91CD\u53E0\u7684\u60C5\u51B5\u4E0B\u65E0\u6CD5\u5199\u5165
    // \u4ED8\u51FA\u7684\u4EE3\u4EF7\u662F\u8FB9\u7F18\u4F1A\u6709\u4E00\u4E9B\u952F\u9F7F
    if(outer_df > antialiasblur + 0.018) discard;
  }
  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(strokeWidth < 0.01) {
    gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);
  } else {
    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor.a *= opacity_t;
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,U0=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_globel;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_isMeter;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;
uniform float u_raisingHeight: 0.0;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // TODO: billboard
  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, u_blur);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    antialiasblur *= pow(19.0 - u_Zoom, 2.0);
    antialiasblur = max(antialiasblur, -0.01);
    // offset *= 0.5;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }

  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);


  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  float raiseHeight = u_raisingHeight;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    raiseHeight = u_raisingHeight * mapboxZoomScale;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, raiseHeight, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, u_raisingHeight, 1.0));
  }

  if(u_globel > 0.0) {
    gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1, 1.0);
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,Py=function(e){(0,Ir.Z)(r,e);var i=UC(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ne.Z)(n),"meter2coord",1),(0,A.Z)((0,ne.Z)(n),"isMeter",!1),n}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.strokeOpacity,g=v===void 0?1:v,x=a.strokeWidth,C=x===void 0?0:x,T=a.stroke,O=T===void 0?"rgba(0,0,0,0)":T,k=a.offsets,j=k===void 0?[0,0]:k,X=a.blend,te=a.blur,be=te===void 0?0:te,Ne=a.raisingHeight,$e=Ne===void 0?0:Ne;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f,strokeOpacity:g,strokeWidth:C,stroke:O,offsets:j})){this.judgeStyleAttributes({opacity:f,strokeOpacity:g,strokeWidth:C,stroke:O,offsets:j});var ot=this.layer.getEncodedData(),bt=this.calDataFrame(this.cellLength,ot,this.cellProperties),_t=bt.data,qt=bt.width,ar=bt.height;this.rowCount=ar,this.dataTexture=this.cellLength>0&&_t.length>0?this.createTexture2D({flipY:!0,data:_t,format:G.LUMINANCE,type:G.FLOAT,width:qt,height:ar}):this.createTexture2D({flipY:!0,data:[1],format:G.LUMINANCE,type:G.FLOAT,width:1,height:1})}return{u_raisingHeight:Number($e),u_isMeter:Number(this.isMeter),u_blur:be,u_additive:X==="additive"?1:0,u_globel:this.mapService.version===js.GLOBEL?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:fa()(f)?f:1,u_stroke_opacity:fa()(g)?g:1,u_stroke_width:fa()(C)?C:1,u_stroke_color:this.getStrokeColor(O),u_offsets:this.isOffsetStatic(j)?j:[0,0]}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption,f=s===void 0?{enable:!1}:s;return{u_aimate:this.animateOption2Array(f),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Op)}},{key:"initModels",value:function(){var a=this.layer.getLayerConfig(),s=a.unit,f=s===void 0?"l7size":s,v=this.mapService.version;return f==="meter"&&v!==js.L7MAP&&v!==js.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels()}},{key:"calMeter2Coord",value:function(){var a=(0,on.Z)(this.layer.getSource().extent,4),s=a[0],f=a[1],v=a[2],g=a[3],x=[(s+v)/2,(f+g)/2],C=this.mapService.version;if(C===js.MAPBOX&&window.mapboxgl.MercatorCoordinate){var T=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:x[0],lat:x[1]},0),O=1,k=O*T.meterInMercatorCoordinateUnits(),j=new window.mapboxgl.MercatorCoordinate(T.x-k,T.y,T.z),X=j.toLngLat();this.meter2coord=x[0]-X.lng;return}var te=this.mapService.meterToCoord(x,[s,f]),be=this.mapService.meterToCoord(x,[v===s?v+.1:v,g===f?f+.1:g]);this.meter2coord=(te+be)/2,Boolean(this.meter2coord)||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v,x=a.animateOption,C=x===void 0?{enable:!1}:x,T=this.getShaders(C),O=T.frag,k=T.vert,j=T.type,X=this.mapService.version==="GLOBEL";return this.layer.triangulation=X?ly:Op,[this.layer.buildLayerModel({moduleName:"pointfill_"+j,vertexShader:k,fragmentShader:O,triangulation:X?ly:Op,depth:{enable:X},blend:this.getBlend(),stencil:Pa(f,g),cull:{enable:!0,face:h(this.mapService.version)}})]}},{key:"getShaders",value:function(a){if(a.enable)switch(a.type){case"wave":return{frag:My,vert:U0,type:"wave"};default:return{frag:My,vert:U0,type:"wave"}}else return{frag:jC,vert:U0,type:"normal"}}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"animateOption2Array",value:function(a){return[a.enable?0:1,a.speed||1,a.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var a=this,s=this.mapService.version==="GLOBEL";this.styleAttributeService.registerStyleAttribute({name:"extrude",type:On.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:3,update:function(v,g,x,C){var T;if(s){var O=(0,on.Z)(x,3),k=O[0],j=O[1],X=O[2],te=Xa.fromValues(0,0,1),be=Xa.fromValues(k,0,X),Ne=k>=0?Xa.angle(te,be):Math.PI*2-Xa.angle(te,be),$e=Math.PI*2-Math.asin(j/100),ot=zr();Ni(ot,ot,Ne),ui(ot,ot,$e);var bt=Xa.fromValues(1,1,0);Xa.transformMat4(bt,bt,ot),Xa.normalize(bt,bt);var _t=Xa.fromValues(-1,1,0);Xa.transformMat4(_t,_t,ot),Xa.normalize(_t,_t);var qt=Xa.fromValues(-1,-1,0);Xa.transformMat4(qt,qt,ot),Xa.normalize(qt,qt);var ar=Xa.fromValues(1,-1,0);Xa.transformMat4(ar,ar,ot),Xa.normalize(ar,ar),T=[].concat((0,Ce.Z)(bt),(0,Ce.Z)(_t),(0,Ce.Z)(qt),(0,Ce.Z)(ar))}else T=[1,1,0,-1,1,0,-1,-1,0,1,-1,0];var Pr=C%4*3;return[T[Pr],T[Pr+1],T[Pr+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(v,g,x,C){var T=v.size,O=T===void 0?5:T;return Array.isArray(O)?[O[0]*a.meter2coord]:[O*a.meter2coord]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:On.Attribute,descriptor:{name:"a_Shape",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(v,g,x,C){var T=v.shape,O=T===void 0?2:T,k=a.layer.getLayerConfig().shape2d,j=k.indexOf(O);return[j]}}})}}]),r}(fo);function VC(e){var i=GC();return function(){var n=(0,Mt.Z)(e),a;if(i){var s=(0,Mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,wr.Z)(this,a)}}function GC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var HC=`uniform sampler2D u_texture;
uniform vec2 u_textSize;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "sdf_2d"
#pragma include "picking"
varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv;

void main() {

  float opacity = styleMappingMat[0][0];

  vec2 pos = v_Iconuv / u_textSize + v_uv / u_textSize * 64.;
  gl_FragColor = texture2D(u_texture, pos);
  gl_FragColor.a *= opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,WC=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute vec2 a_Uv;
attribute float a_Rotate;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform mat2 u_RotateMatrix;
uniform float u_isMeter;

varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv; // icon \u8D34\u56FE\u7684 uv \u5750\u6807

uniform float u_opacity : 1;
uniform vec2 u_offsets;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_Extrude;

  v_uv = (a_Extrude.xy + 1.0)/2.0;
  v_uv.y = 1.0 - v_uv.y;
  v_Iconuv = a_Uv;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // empty - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);

  // vec2 offset = (u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec2 offset = (rotation_matrix * u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }


  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,XC=function(e){(0,Ir.Z)(r,e);var i=VC(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ne.Z)(n),"meter2coord",1),(0,A.Z)((0,ne.Z)(n),"texture",void 0),(0,A.Z)((0,ne.Z)(n),"isMeter",!1),(0,A.Z)((0,ne.Z)(n),"radian",0),(0,A.Z)((0,ne.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),n.layer.renderLayers();return}n.texture=v({data:n.iconService.getCanvas(),mag:G.LINEAR,min:G.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0})}),n}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.offsets,g=v===void 0?[0,0]:v,x=a.rotation;this.rendererService.getDirty()&&this.texture.bind();var C=1;if((this.mapService.version==="GAODE2.x"||this.mapService.version==="GAODE1.x")&&(C=-1),this.radian=x!==void 0?C*Math.PI*x/180:C*Math.PI*(this.mapService.getRotation()%360)/180,this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f,offsets:g})){this.judgeStyleAttributes({opacity:f,offsets:g});var T=this.layer.getEncodedData(),O=this.calDataFrame(this.cellLength,T,this.cellProperties),k=O.data,j=O.width,X=O.height;this.rowCount=X,this.dataTexture=this.cellLength>0&&k.length>0?this.createTexture2D({flipY:!0,data:k,format:G.LUMINANCE,type:G.FLOAT,width:j,height:X}):this.createTexture2D({flipY:!0,data:[1],format:G.LUMINANCE,type:G.FLOAT,width:1,height:1})}return{u_isMeter:Number(this.isMeter),u_RotateMatrix:new Float32Array([Math.cos(this.radian),Math.sin(this.radian),-Math.sin(this.radian),Math.cos(this.radian)]),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:fa()(f)?f:1,u_offsets:this.isOffsetStatic(g)?g:[0,0]}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Op)}},{key:"initModels",value:function(){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture);var a=this.layer.getLayerConfig(),s=a.unit,f=s===void 0?"l7size":s,v=this.mapService.version;return f==="meter"&&v!==js.L7MAP&&v!==js.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels()}},{key:"calMeter2Coord",value:function(){var a=(0,on.Z)(this.layer.getSource().extent,4),s=a[0],f=a[1],v=a[2],g=a[3],x=[(s+v)/2,(f+g)/2],C=this.mapService.version;if(C===js.MAPBOX&&window.mapboxgl.MercatorCoordinate){var T=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:x[0],lat:x[1]},0),O=1,k=O*T.meterInMercatorCoordinateUnits(),j=new window.mapboxgl.MercatorCoordinate(T.x-k,T.y,T.z),X=j.toLngLat();this.meter2coord=x[0]-X.lng;return}var te=this.mapService.meterToCoord(x,[s,f]),be=this.mapService.meterToCoord(x,[v===s?v+.1:v,g===f?f+.1:g]);this.meter2coord=(te+be)/2,Boolean(this.meter2coord)||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v,x=this.getShaders(),C=x.frag,T=x.vert,O=x.type;return[this.layer.buildLayerModel({moduleName:O,vertexShader:T,fragmentShader:C,triangulation:Op,depth:{enable:!1},blend:this.getBlend(),stencil:Pa(f,g),cull:{enable:!0,face:h(this.mapService.version)}})]}},{key:"getShaders",value:function(){return{frag:HC,vert:WC,type:"point_fillImage"}}},{key:"clearModels",value:function(){var a,s;this.iconService.off("imageUpdate",this.updateTexture),(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"rotate",type:On.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(f,v,g,x){var C=f.rotate,T=C===void 0?0:C;return Array.isArray(T)?[T[0]]:[T]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:On.Attribute,descriptor:{name:"a_Uv",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(f,v,g,x){var C=a.iconService.getIconMap(),T=f.shape,O=C[T]||{x:0,y:0},k=O.x,j=O.y;return[k,j]}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:On.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:3,update:function(f,v,g,x){var C=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],T=x%4*3;return[C[T],C[T+1],C[T+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(f,v,g,x){var C=f.size,T=C===void 0?5:C;return Array.isArray(T)?[T[0]*a.meter2coord]:[T*a.meter2coord]}}})}}]),r}(fo);function YC(e){var i=qC();return function(){var n=(0,Mt.Z)(e),a;if(i){var s=(0,Mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,wr.Z)(this,a)}}function qC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var KC=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main(){
      float opacity = styleMappingMat[0][0];
      float size = styleMappingMat[1][0];
      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor;

      // Y = 0.299R + 0.587G + 0.114B // \u4EAE\u5EA6\u63D0\u53D6
     
      textureColor = texture2D(u_texture, pos);

      // Tip: \u53BB\u9664\u8FB9\u7F18\u90E8\u5206 mipmap \u5BFC\u81F4\u7684\u6DF7\u5408\u53D8\u6697
      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
      if(fragmengTocenter >= 0.5) {
            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
            textureColor.a *= luma;
      }
      
      

      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }

      gl_FragColor.a = gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,$C=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec2 u_offsets;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  styleMappingMat[1][0] = a_Size;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
  }
  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);
}
`,QC=function(e){(0,Ir.Z)(r,e);var i=YC(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ne.Z)(n),"texture",void 0),n}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity;return{u_opacity:s||1,u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128]}}},{key:"initModels",value:function(){var a=this;return this.initIconFontGlyphs(),this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",function(){a.updateTexture(),a.layer.render()}),[this.layer.buildLayerModel({moduleName:"pointiconImage",vertexShader:$C,fragmentShader:KC,triangulation:fy,primitive:G.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(f,v,g,x){var C=f.size;return Array.isArray(C)?[C[0]]:[C]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:On.Attribute,descriptor:{name:"a_Uv",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(f,v,g,x){var C=a.fontService.mapping,T=f.shape,O=a.fontService.getGlyph(T),k=C[O],j=k.x,X=k.y;return[j,X]}}})}},{key:"updateTexture",value:function(){var a=this.rendererService.createTexture2D,s=this.fontService.canvas;this.texture=a({data:s,mag:G.LINEAR,min:G.LINEAR,width:s.width,height:s.height})}},{key:"initIconFontGlyphs",value:function(){var a=this,s=this.layer.getLayerConfig(),f=s.fontWeight,v=f===void 0?"normal":f,g=s.fontFamily,x=g===void 0?"sans-serif":g,C=this.layer.getEncodedData(),T=[];C.forEach(function(O){var k=O.shape,j=k===void 0?"":k;j=j.toString();var X=a.fontService.getGlyph(j);T.indexOf(X)===-1&&T.push(X)}),this.fontService.setFontOptions({characterSet:T,fontWeight:v,fontFamily:x,fontSize:48})}}]),r}(fo);function JC(e){var i=eA();return function(){var n=(0,Mt.Z)(e),a;if(i){var s=(0,Mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,wr.Z)(this,a)}}function eA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var tA=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main(){
      float opacity = styleMappingMat[0][0];
      float size = styleMappingMat[1][0];
      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor;

      // Y = 0.299R + 0.587G + 0.114B // \u4EAE\u5EA6\u63D0\u53D6
     
      textureColor = texture2D(u_texture, pos);

      // Tip: \u53BB\u9664\u8FB9\u7F18\u90E8\u5206 mipmap \u5BFC\u81F4\u7684\u6DF7\u5408\u53D8\u6697
      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
      if(fragmengTocenter >= 0.5) {
            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
            textureColor.a *= luma;
      }
      
      

      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }

      gl_FragColor.a = gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,rA=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec2 u_offsets;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  styleMappingMat[1][0] = a_Size;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
  }
  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);
}
`,Iy=function(e){(0,Ir.Z)(r,e);var i=JC(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ne.Z)(n),"texture",void 0),(0,A.Z)((0,ne.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),n.layer.renderLayers();return}n.texture=v({data:n.iconService.getCanvas(),mag:G.LINEAR,min:G.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0})}),n}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.offsets,g=v===void 0?[0,0]:v;if(this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f,offsets:g})){this.judgeStyleAttributes({opacity:f,offsets:g});var x=this.layer.getEncodedData(),C=this.calDataFrame(this.cellLength,x,this.cellProperties),T=C.data,O=C.width,k=C.height;this.rowCount=k,this.dataTexture=this.cellLength>0&&T.length>0?this.createTexture2D({flipY:!0,data:T,format:G.LUMINANCE,type:G.FLOAT,width:O,height:k}):this.createTexture2D({flipY:!0,data:[1],format:G.LUMINANCE,type:G.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:fa()(f)?f:1,u_offsets:this.isOffsetStatic(g)?g:[0,0]}}},{key:"initModels",value:function(){return this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:rA,fragmentShader:tA,triangulation:fy,primitive:G.POINTS,depth:{enable:!1},blend:this.getBlend(),stencil:Pa(f,g)})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(f,v,g,x){var C=f.size,T=C===void 0?5:C;return Array.isArray(T)?[T[0]]:[T]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:On.Attribute,descriptor:{name:"a_Uv",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(f,v,g,x){var C=a.iconService.getIconMap(),T=f.shape,O=C[T]||{x:0,y:0},k=O.x,j=O.y;return[k,j]}}})}}]),r}(fo);function nA(e){var i=iA();return function(){var n=(0,Mt.Z)(e),a;if(i){var s=(0,Mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,wr.Z)(this,a)}}function iA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var aA=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  float opacity = styleMappingMat[0][0];

  gl_FragColor = v_color;
  // gl_FragColor.a =gl_FragColor.a * u_opacity;
  gl_FragColor.a =gl_FragColor.a * opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,oA=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  // vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);
  // vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
  // gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\\
  // 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 offset = project_pixel((u_offsets));
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    // vec2 offset = project_pixel(u_offsets);
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function Oy(e){var i=e.coordinates;return{vertices:(0,Ce.Z)(i),indices:[0],size:i.length}}var Ry=function(e){(0,Ir.Z)(r,e);var i=nA(r);function r(){return(0,ht.Z)(this,r),i.apply(this,arguments)}return(0,Pt.Z)(r,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.offsets,g=v===void 0?[0,0]:v;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f,offsets:g})){this.judgeStyleAttributes({opacity:f,offsets:g});var x=this.layer.getEncodedData(),C=this.calDataFrame(this.cellLength,x,this.cellProperties),T=C.data,O=C.width,k=C.height;this.rowCount=k,this.dataTexture=this.cellLength>0&&T.length>0?this.createTexture2D({flipY:!0,data:T,format:G.LUMINANCE,type:G.FLOAT,width:O,height:k}):this.createTexture2D({flipY:!0,data:[1],format:G.LUMINANCE,type:G.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:fa()(f)?f:1,u_offsets:this.isOffsetStatic(g)?g:[0,0]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;return this.layer.triangulation=Oy,[this.layer.buildLayerModel({moduleName:"normalpoint",vertexShader:oA,fragmentShader:aA,triangulation:Oy,depth:{enable:!1},primitive:G.POINTS,blend:this.getBlend(),stencil:Pa(f,g)})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(s,f,v,g){var x=s.size,C=x===void 0?1:x;return Array.isArray(C)?[C[0]]:[C]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:wc.additive}}}]),r}(fo);function sA(e){var i=uA();return function(){var n=(0,Mt.Z)(e),a;if(i){var s=(0,Mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,wr.Z)(this,a)}}function uA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var lA=`
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"

void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df = sdCircle(v_data.xy, 1.0);
  float inner_df = sdCircle(v_data.xy, r);

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
  } else {
    gl_FragColor.a *= opacity_t;
  }

  if(gl_FragColor.a > 0.0) {
    gl_FragColor = filterColor(gl_FragColor);
  }

  vec2 extrude =  styleMappingMat[2].ba;
  vec2 dir = normalize(extrude);
  vec2 baseDir = vec2(1.0, 0.0);
  float pi = 3.14159265359;
  // full circle
  // float rades = dot(dir, baseDir);
  // float flag = sign(dir.y);
  // float radar_v = (flag - 1.0) * -0.5 + flag * acos(rades)/pi/2.0;
  
  // half circle
  float flag = sign(dir.y);
  float rades = dot(dir, baseDir);
  float radar_v = (flag - 1.0) * -0.5 * acos(rades)/pi;
  // simple AA
  if(radar_v > 0.99) {
    radar_v = 1.0 - (radar_v - 0.99)/0.01;
  }

  gl_FragColor.a *= radar_v;
}
`,cA=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;
uniform float u_speed: 1.0;
uniform float u_time;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_isMeter;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform vec2 u_offsets;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // empty - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - a_Extrude.x - a_Extrude.y
    0.0, 0.0, 0.0, 0.0  // 
  );

  float time = u_time * u_speed;
  mat2 rotateMatrix = mat2( 
    cos(time), sin(time), 
    -sin(time), cos(time)
  );
  styleMappingMat[2].ba = rotateMatrix * a_Extrude.xy;

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> empty -> empty ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;


  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // anti-alias
  float blur = 0.0;
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, blur);

  vec2 offset = (extrude.xy * (newSize) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    antialiasblur *= pow(19.0 - u_Zoom, 2.0);
    antialiasblur = max(antialiasblur, -0.01);
    // offset *= 0.5;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }

  v_data = vec4(extrude.x, extrude.y, antialiasblur,shape_type);

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,fA=function(e){(0,Ir.Z)(r,e);var i=sA(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ne.Z)(n),"meter2coord",1),(0,A.Z)((0,ne.Z)(n),"isMeter",!1),n}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.offsets,g=v===void 0?[0,0]:v,x=a.blend,C=a.speed,T=C===void 0?1:C;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f,offsets:g})){this.judgeStyleAttributes({opacity:f,offsets:g});var O=this.layer.getEncodedData(),k=this.calDataFrame(this.cellLength,O,this.cellProperties),j=k.data,X=k.width,te=k.height;this.rowCount=te,this.dataTexture=this.cellLength>0&&j.length>0?this.createTexture2D({flipY:!0,data:j,format:G.LUMINANCE,type:G.FLOAT,width:X,height:te}):this.createTexture2D({flipY:!0,data:[1],format:G.LUMINANCE,type:G.FLOAT,width:1,height:1})}return{u_isMeter:Number(this.isMeter),u_speed:T,u_additive:x==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:fa()(f)?f:1,u_offsets:this.isOffsetStatic(g)?g:[0,0]}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption,f=s===void 0?{enable:!1}:s;return{u_aimate:this.animateOption2Array(f),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Op)}},{key:"initModels",value:function(){var a=this.layer.getLayerConfig(),s=a.unit,f=s===void 0?"l7size":s,v=this.mapService.version;return f==="meter"&&v!==js.L7MAP&&v!==js.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels()}},{key:"calMeter2Coord",value:function(){var a=(0,on.Z)(this.layer.getSource().extent,4),s=a[0],f=a[1],v=a[2],g=a[3],x=[(s+v)/2,(f+g)/2],C=this.mapService.version;if(C===js.MAPBOX&&window.mapboxgl.MercatorCoordinate){var T=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:x[0],lat:x[1]},0),O=1,k=O*T.meterInMercatorCoordinateUnits(),j=new window.mapboxgl.MercatorCoordinate(T.x-k,T.y,T.z),X=j.toLngLat();this.meter2coord=x[0]-X.lng;return}var te=this.mapService.meterToCoord(x,[s,f]),be=this.mapService.meterToCoord(x,[v===s?v+.1:v,g===f?f+.1:g]);this.meter2coord=(te+be)/2,Boolean(this.meter2coord)||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v,x=this.getShaders(),C=x.frag,T=x.vert,O=x.type;return[this.layer.buildLayerModel({moduleName:O,vertexShader:T,fragmentShader:C,triangulation:Op,depth:{enable:!1},blend:this.getBlend(),stencil:Pa(f,g),cull:{enable:!0,face:h(this.mapService.version)}})]}},{key:"getShaders",value:function(){return{frag:lA,vert:cA,type:"point_radar"}}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"animateOption2Array",value:function(a){return[a.enable?0:1,a.speed||1,a.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:On.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:3,update:function(f,v,g,x){var C;C=[1,1,0,-1,1,0,-1,-1,0,1,-1,0];var T=x%4*3;return[C[T],C[T+1],C[T+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(f,v,g,x){var C=f.size,T=C===void 0?5:C;return Array.isArray(T)?[T[0]*a.meter2coord]:[T*a.meter2coord]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:On.Attribute,descriptor:{name:"a_Shape",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(f,v,g,x){var C=f.shape,T=C===void 0?2:C,O=a.layer.getLayerConfig().shape2d,k=O.indexOf(T);return[k]}}})}}]),r}(fo);function hA(e){var i=pA();return function(){var n=(0,Mt.Z)(e),a;if(i){var s=(0,Mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,wr.Z)(this,a)}}function pA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var dA=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_additive;

uniform float u_stroke_opacity : 1;

uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
varying float v_blur;
varying float v_innerRadius;

#pragma include "picking"
void main() {
  vec2 center = vec2(0.5);

  float opacity = styleMappingMat[0][0];
  // Tip: \u7247\u5143\u5230\u4E2D\u5FC3\u70B9\u7684\u8DDD\u79BB 0 - 1
  float fragmengTocenter = distance(center, gl_PointCoord) * 2.0;
  // Tip: \u7247\u5143\u7684\u526A\u5207\u6210\u5706\u5F62
  float circleClipOpacity = 1.0 - smoothstep(v_blur, 1.0, fragmengTocenter);


  if(v_innerRadius < 0.99) {
    // \u5F53\u5B58\u5728 stroke \u4E14 stroke > 0.01
    float blurWidth = (1.0 - v_blur)/2.0;
    vec4 stroke = vec4(u_stroke_color.rgb, u_stroke_opacity);
    if(fragmengTocenter > v_innerRadius + blurWidth) {
      gl_FragColor = stroke;
    } else if(fragmengTocenter > v_innerRadius - blurWidth){
      float mixR = (fragmengTocenter - (v_innerRadius - blurWidth)) / (blurWidth * 2.0);
      gl_FragColor = mix(v_color, stroke, mixR);
    } else {
      gl_FragColor = v_color;
    }
  } else {
    // \u5F53\u4E0D\u5B58\u5728 stroke \u6216 stroke <= 0.01
    gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity;

  gl_FragColor = filterColor(gl_FragColor);
  
  if(u_additive > 0.0) {
    gl_FragColor *= circleClipOpacity;
  } else {
    gl_FragColor.a *= circleClipOpacity;
  }

}
`,vA=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_stroke_width;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143
varying float v_blur;
varying float v_innerRadius;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;
  v_blur = 1.0 - max(2.0/a_Size, 0.05);
  v_innerRadius = max((a_Size - u_stroke_width) / a_Size, 0.0);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  vec2 offset = project_pixel(textrueOffsets);
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function Ly(e){var i=e.coordinates;return{vertices:(0,Ce.Z)(i),indices:[0],size:i.length}}var mA=function(e){(0,Ir.Z)(r,e);var i=hA(r);function r(){return(0,ht.Z)(this,r),i.apply(this,arguments)}return(0,Pt.Z)(r,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.offsets,g=v===void 0?[0,0]:v,x=a.blend,C=a.strokeOpacity,T=C===void 0?1:C,O=a.strokeWidth,k=O===void 0?0:O,j=a.stroke,X=j===void 0?"#fff":j;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f,offsets:g})){this.judgeStyleAttributes({opacity:f,offsets:g});var te=this.layer.getEncodedData(),be=this.calDataFrame(this.cellLength,te,this.cellProperties),Ne=be.data,$e=be.width,ot=be.height;this.rowCount=ot,this.dataTexture=this.cellLength>0&&Ne.length>0?this.createTexture2D({flipY:!0,data:Ne,format:G.LUMINANCE,type:G.FLOAT,width:$e,height:ot}):this.createTexture2D({flipY:!0,data:[1],format:G.LUMINANCE,type:G.FLOAT,width:1,height:1})}return{u_additive:x==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:fa()(f)?f:1,u_offsets:this.isOffsetStatic(g)?g:[0,0],u_stroke_opacity:fa()(T)?T:1,u_stroke_width:fa()(k)?k:1,u_stroke_color:this.getStrokeColor(X)}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;return this.layer.triangulation=Ly,[this.layer.buildLayerModel({moduleName:"simplepoint",vertexShader:vA,fragmentShader:dA,triangulation:Ly,depth:{enable:!1},primitive:G.POINTS,blend:this.getBlend(),stencil:Pa(f,g)})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(s,f,v,g){var x=s.size,C=x===void 0?1:x;return Array.isArray(C)?[C[0]]:[C]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:wc.additive}}}]),r}(fo);function gA(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=yA(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function yA(e,i){if(!!e){if(typeof e=="string")return ky(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ky(e,i)}}function ky(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var _A=function(){function e(i,r,n){(0,ht.Z)(this,e),(0,A.Z)(this,"boxCells",[]),(0,A.Z)(this,"xCellCount",void 0),(0,A.Z)(this,"yCellCount",void 0),(0,A.Z)(this,"boxKeys",void 0),(0,A.Z)(this,"bboxes",void 0),(0,A.Z)(this,"width",void 0),(0,A.Z)(this,"height",void 0),(0,A.Z)(this,"xScale",void 0),(0,A.Z)(this,"yScale",void 0),(0,A.Z)(this,"boxUid",void 0);var a=this.boxCells;this.xCellCount=Math.ceil(i/n),this.yCellCount=Math.ceil(r/n);for(var s=0;s<this.xCellCount*this.yCellCount;s++)a.push([]);this.boxKeys=[],this.bboxes=[],this.width=i,this.height=r,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/r,this.boxUid=0}return(0,Pt.Z)(e,[{key:"insert",value:function(r,n,a,s,f){this.forEachCell(n,a,s,f,this.insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(n),this.bboxes.push(a),this.bboxes.push(s),this.bboxes.push(f)}},{key:"query",value:function(r,n,a,s,f){return this.queryHitTest(r,n,a,s,!1,f)}},{key:"hitTest",value:function(r,n,a,s,f){return this.queryHitTest(r,n,a,s,!0,f)}},{key:"insertBoxCell",value:function(r,n,a,s,f,v){this.boxCells[f].push(v)}},{key:"queryHitTest",value:function(r,n,a,s,f,v){if(a<0||r>this.width||s<0||n>this.height)return f?!1:[];var g=[];if(r<=0&&n<=0&&this.width<=a&&this.height<=s){if(f)return!0;for(var x=0;x<this.boxKeys.length;x++)g.push({key:this.boxKeys[x],x1:this.bboxes[x*4],y1:this.bboxes[x*4+1],x2:this.bboxes[x*4+2],y2:this.bboxes[x*4+3]});return v?g.filter(v):g}var C={hitTest:f,seenUids:{box:{},circle:{}}};return this.forEachCell(r,n,a,s,this.queryCell,g,C,v),f?g.length>0:g}},{key:"queryCell",value:function(r,n,a,s,f,v,g,x){var C=g.seenUids,T=this.boxCells[f];if(T!==null){var O=this.bboxes,k=gA(T),j;try{for(k.s();!(j=k.n()).done;){var X=j.value;if(!C.box[X]){C.box[X]=!0;var te=X*4;if(r<=O[te+2]&&n<=O[te+3]&&a>=O[te+0]&&s>=O[te+1]&&(!x||x(this.boxKeys[X]))){if(g.hitTest)return v.push(!0),!0;v.push({key:this.boxKeys[X],x1:O[te],y1:O[te+1],x2:O[te+2],y2:O[te+3]})}}}}catch(be){k.e(be)}finally{k.f()}}return!1}},{key:"forEachCell",value:function(r,n,a,s,f,v,g,x){for(var C=this.convertToXCellCoord(r),T=this.convertToYCellCoord(n),O=this.convertToXCellCoord(a),k=this.convertToYCellCoord(s),j=C;j<=O;j++)for(var X=T;X<=k;X++){var te=this.xCellCount*X+j;if(f.call(this,r,n,a,s,te,v,g,x))return}}},{key:"convertToXCellCoord",value:function(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}},{key:"convertToYCellCoord",value:function(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}}]),e}(),xA=_A,bA=function(){function e(i,r){(0,ht.Z)(this,e),(0,A.Z)(this,"width",void 0),(0,A.Z)(this,"height",void 0),(0,A.Z)(this,"grid",void 0),(0,A.Z)(this,"viewportPadding",100),(0,A.Z)(this,"screenRightBoundary",void 0),(0,A.Z)(this,"screenBottomBoundary",void 0),(0,A.Z)(this,"gridRightBoundary",void 0),(0,A.Z)(this,"gridBottomBoundary",void 0),this.width=i,this.height=r,this.viewportPadding=Math.max(i,r),this.grid=new xA(i+this.viewportPadding,r+this.viewportPadding,25),this.screenRightBoundary=i+this.viewportPadding,this.screenBottomBoundary=r+this.viewportPadding,this.gridRightBoundary=i+2*this.viewportPadding,this.gridBottomBoundary=r+2*this.viewportPadding}return(0,Pt.Z)(e,[{key:"placeCollisionBox",value:function(r){var n=r.x1+r.anchorPointX+this.viewportPadding,a=r.y1+r.anchorPointY+this.viewportPadding,s=r.x2+r.anchorPointX+this.viewportPadding,f=r.y2+r.anchorPointY+this.viewportPadding;return!this.isInsideGrid(n,a,s,f)||this.grid.hitTest(n,a,s,f)?{box:[]}:{box:[n,a,s,f]}}},{key:"insertCollisionBox",value:function(r,n){var a={featureIndex:n};this.grid.insert(a,r[0],r[1],r[2],r[3])}},{key:"project",value:function(r,n,a){var s=Qp(n,a,0,1),f=Fh(),v=ir.apply(ae,(0,Ce.Z)(r));return Me(f,s,v),{x:(f[0]/f[3]+1)/2*this.width+this.viewportPadding,y:(-f[1]/f[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(r,n,a,s){return a>=0&&r<this.gridRightBoundary&&s>=0&&n<this.gridBottomBoundary}}]),e}();function Dy(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=EA(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function EA(e,i){if(!!e){if(typeof e=="string")return Fy(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Fy(e,i)}}function Fy(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function By(e){var i=.5,r=.5;switch(e){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0;break;default:i=.5}switch(e){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0;break;default:r=.5}return{horizontalAlign:i,verticalAlign:r}}function Ny(e,i,r,n,a){if(!!a){var s=e[n],f=s.glyph;if(f)for(var v=i[f].advance*s.scale,g=(e[n].x+v)*a,x=r;x<=n;x++)e[x].x-=g}}function zy(e,i,r,n,a,s,f){var v=(i-r)*a,g=(-n*f+.5)*s,x=Dy(e),C;try{for(x.s();!(C=x.n()).done;){var T=C.value;T.x+=v,T.y+=g}}catch(O){x.e(O)}finally{x.f()}}function SA(e,i,r,n,a,s,f){var v=-8,g=0,x=v,C=0,T=e.positionedGlyphs,O=s==="right"?1:s==="left"?0:.5,k=T.length;r.forEach(function(Ne){if(Ne.split("").forEach(function(ot){var bt=i[ot],_t=0;bt&&(T.push({glyph:ot,x:g,y:x+_t,vertical:!1,scale:1,metrics:bt}),g+=bt.advance+f)}),T.length!==k){var $e=g-f;C=Math.max($e,C),Ny(T,i,k,T.length-1,O)}g=0,x-=n+5});var j=By(a),X=j.horizontalAlign,te=j.verticalAlign;zy(T,O,X,te,C,n,r.length);var be=x-v;e.top+=-te*be,e.bottom=e.top-be,e.left+=-X*C,e.right=e.left+C}function CA(e,i,r,n,a,s,f){var v=-8,g=0,x=v,C=0,T=e.positionedGlyphs,O=s==="right"?1:s==="left"?0:.5,k=T.length;r.forEach(function(Ne){var $e=i[Ne],ot=0;if($e&&(T.push({glyph:Ne,x:$e.advance/2,y:x+ot,vertical:!1,scale:1,metrics:$e}),g+=$e.advance+f),T.length!==k){var bt=g-f;C=Math.max(bt,C),Ny(T,i,k,T.length-1,O)}g=0,x-=n+5});var j=By(a),X=j.horizontalAlign,te=j.verticalAlign;zy(T,O,X,te,C,n,r.length);var be=x-v;e.top+=-te*be,e.bottom=e.top-be,e.left+=-X*C,e.right=e.left+C}function AA(e,i,r,n,a,s){var f=arguments.length>6&&arguments[6]!==void 0?arguments[6]:[0,0],v=arguments.length>7?arguments[7]:void 0,g=e.split(`
`),x=[],C={positionedGlyphs:x,top:f[1],bottom:f[1],left:f[0],right:f[0],lineCount:g.length,text:e};return v?CA(C,i,g,r,n,a,s):SA(C,i,g,r,n,a,s),x.length?C:!1}function wA(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],r=arguments.length>2?arguments[2]:void 0,n=e.positionedGlyphs,a=n===void 0?[]:n,s=[],f=Dy(a),v;try{for(f.s();!(v=f.n()).done;){var g=v.value,x=g.metrics,C=4,T=x.advance*g.scale/2,O=r?[g.x+T,g.y]:[0,0],k=r?[0,0]:[g.x+T+i[0],g.y+i[1]],j=(0-C)*g.scale-T+k[0],X=(0-C)*g.scale+k[1],te=j+x.width*g.scale,be=X+x.height*g.scale,Ne={x:j,y:X},$e={x:te,y:X},ot={x:j,y:be},bt={x:te,y:be};s.push({tl:Ne,tr:$e,bl:ot,br:bt,tex:x,glyphOffset:O})}}catch(_t){f.e(_t)}finally{f.f()}return s}function TA(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=MA(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function MA(e,i){if(!!e){if(typeof e=="string")return Uy(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Uy(e,i)}}function Uy(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function PA(e){var i=IA();return function(){var n=(0,Mt.Z)(e),a;if(i){var s=(0,Mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,wr.Z)(this,a)}}function IA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Zy=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
// uniform float u_font_size : 24.0;
uniform float u_opacity : 1.0;
uniform vec4 u_stroke_color : [0, 0, 0, 1];
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  // get style data mapping
  float opacity = styleMappingMat[0][0];
  float strokeWidth = styleMappingMat[0][2];
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  // float fontScale = u_font_size / FONT_SIZE;

  // lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  lowp float buff = (6.0 - strokeWidth / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);
  // gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), vec4(textrueStroke.rgb, textrueStroke.a * opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor.a= gl_FragColor.a * alpha;
  gl_FragColor = filterColor(gl_FragColor);
}
`,jy=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;
attribute float a_Rotate;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_raisingHeight: 0.0;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

   vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  v_uv = a_tex / u_sdf_map_size;

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  float raiseHeight = u_raisingHeight;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    raiseHeight = u_raisingHeight * mapboxZoomScale;
  }

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp * (vec4(a_Position.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));
  }

  gl_Position = vec4(
    projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`;function Vy(e){var i=this,r=e.id,n=[],a=[];if(!i.glyphInfoMap||!i.glyphInfoMap[r])return{vertices:[],indices:[],size:7};var s=i.glyphInfoMap[r].centroid,f=s.length===2?[s[0],s[1],0]:s;return i.glyphInfoMap[r].glyphQuads.forEach(function(v,g){n.push.apply(n,(0,Ce.Z)(f).concat([v.tex.x,v.tex.y+v.tex.height,v.tl.x,v.tl.y],(0,Ce.Z)(f),[v.tex.x+v.tex.width,v.tex.y+v.tex.height,v.tr.x,v.tr.y],(0,Ce.Z)(f),[v.tex.x+v.tex.width,v.tex.y,v.br.x,v.br.y],(0,Ce.Z)(f),[v.tex.x,v.tex.y,v.bl.x,v.bl.y])),a.push(0+g*4,1+g*4,2+g*4,2+g*4,3+g*4,0+g*4)}),{vertices:n,indices:a,size:7}}var Gy=function(e){(0,Ir.Z)(r,e);var i=PA(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ne.Z)(n),"glyphInfo",void 0),(0,A.Z)((0,ne.Z)(n),"glyphInfoMap",{}),(0,A.Z)((0,ne.Z)(n),"texture",void 0),(0,A.Z)((0,ne.Z)(n),"currentZoom",-1),(0,A.Z)((0,ne.Z)(n),"extent",void 0),(0,A.Z)((0,ne.Z)(n),"textureHeight",0),(0,A.Z)((0,ne.Z)(n),"textCount",0),(0,A.Z)((0,ne.Z)(n),"preTextStyle",{}),(0,A.Z)((0,ne.Z)(n),"buildModels",function(){var v=n.layer.getLayerConfig(),g=v.mask,x=g===void 0?!1:g,C=v.maskInside,T=C===void 0?!0:C;return n.initGlyph(),n.updateTexture(),n.filterGlyphs(),n.reBuildModel(),[n.layer.buildLayerModel({moduleName:"pointText",vertexShader:jy,fragmentShader:Zy,triangulation:Vy.bind((0,ne.Z)(n)),depth:{enable:!1},blend:n.getBlend(),stencil:Pa(x,T)})]}),n}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.stroke,g=v===void 0?"#fff":v,x=a.strokeWidth,C=x===void 0?0:x,T=a.textAnchor,O=T===void 0?"center":T,k=a.textAllowOverlap,j=k===void 0?!1:k,X=a.halo,te=X===void 0?.5:X,be=a.gamma,Ne=be===void 0?2:be,$e=a.raisingHeight,ot=$e===void 0?0:$e,bt=this.fontService,_t=bt.canvas,qt=bt.mapping;if(Object.keys(qt).length!==this.textCount&&(this.updateTexture(),this.textCount=Object.keys(qt).length),this.preTextStyle={textAnchor:O,textAllowOverlap:j},this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f,strokeWidth:C,stroke:g})){this.judgeStyleAttributes({opacity:f,strokeWidth:C,stroke:g});var ar=this.layer.getEncodedData(),Pr=this.calDataFrame(this.cellLength,ar,this.cellProperties),qr=Pr.data,gr=Pr.width,un=Pr.height;this.rowCount=un,this.dataTexture=this.cellLength>0&&qr.length>0?this.createTexture2D({flipY:!0,data:qr,format:G.LUMINANCE,type:G.FLOAT,width:gr,height:un}):this.createTexture2D({flipY:!0,data:[1],format:G.LUMINANCE,type:G.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(ot),u_opacity:fa()(f)?f:1,u_stroke_width:fa()(C)?C:1,u_stroke_color:this.getStrokeColor(g),u_sdf_map:this.texture,u_halo_blur:te,u_gamma_scale:Ne,u_sdf_map_size:[_t.width,_t.height]}}},{key:"initModels",value:function(){this.layer.on("remapping",this.buildModels),this.extent=this.textExtent();var a=this.layer.getLayerConfig(),s=a.textAnchor,f=s===void 0?"center":s,v=a.textAllowOverlap,g=v===void 0?!0:v;return this.preTextStyle={textAnchor:f,textAllowOverlap:g},this.buildModels()}},{key:"needUpdate",value:function(){var a=this.layer.getLayerConfig(),s=a.textAllowOverlap,f=s===void 0?!1:s,v=this.mapService.getZoom(),g=this.mapService.getBounds(),x=yl(this.extent,g);return!f&&(Math.abs(this.currentZoom-v)>1||!x)||f!==this.preTextStyle.textAllowOverlap?(this.reBuildModel(),!0):!1}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.layer.off("remapping",this.buildModels)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:On.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(s,f,v,g){var x=s.rotate,C=x===void 0?0:x;return Array.isArray(C)?[C[0]]:[C]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:On.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(s,f,v,g){return[v[5],v[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(s,f,v,g){var x=s.size,C=x===void 0?12:x;return Array.isArray(C)?[C[0]]:[C]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:On.Attribute,descriptor:{name:"a_tex",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(s,f,v,g){return[v[3],v[4]]}}})}},{key:"textExtent",value:function(){var a=this.mapService.getBounds();return dc(a,.5)}},{key:"initTextFont",value:function(){var a=this.layer.getLayerConfig(),s=a.fontWeight,f=s===void 0?"400":s,v=a.fontFamily,g=v===void 0?"sans-serif":v,x=this.layer.getEncodedData(),C=[];x.forEach(function(T){var O=T.shape,k=O===void 0?"":O;k=k.toString();var j=TA(k),X;try{for(j.s();!(X=j.n()).done;){var te=X.value;C.indexOf(te)===-1&&C.push(te)}}catch(be){j.e(be)}finally{j.f()}}),this.fontService.setFontOptions({characterSet:C,fontWeight:f,fontFamily:g,iconfont:!1})}},{key:"initIconFontTex",value:function(){var a=this.layer.getLayerConfig(),s=a.fontWeight,f=s===void 0?"400":s,v=a.fontFamily,g=v===void 0?"sans-serif":v,x=this.layer.getEncodedData(),C=[];x.forEach(function(T){var O=T.shape,k=O===void 0?"":O;k="".concat(k),C.indexOf(k)===-1&&C.push(k)}),this.fontService.setFontOptions({characterSet:C,fontWeight:f,fontFamily:g,iconfont:!0})}},{key:"generateGlyphLayout",value:function(a){var s=this,f=this.fontService.mapping,v=this.layer.getLayerConfig(),g=v.spacing,x=g===void 0?2:g,C=v.textAnchor,T=C===void 0?"center":C,O=this.layer.getEncodedData();this.glyphInfo=O.map(function(k){var j=k.shape,X=j===void 0?"":j,te=k.id,be=k.size,Ne=be===void 0?1:be,$e=k.textOffset,ot=$e===void 0?[0,0]:$e,bt=AA(X.toString(),f,Ne,T,"left",x,ot,a),_t=wA(bt,ot,!1);return k.shaping=bt,k.glyphQuads=_t,k.centroid=Mp(k.coordinates),k.originCentroid=k.version==="GAODE2.x"?Mp(k.originCoordinates):k.originCentroid=k.centroid,s.glyphInfoMap[te]={shaping:bt,glyphQuads:_t,centroid:Mp(k.coordinates)},k})}},{key:"filterGlyphs",value:function(){var a=this,s=this.layer.getLayerConfig(),f=s.padding,v=f===void 0?[4,4]:f,g=s.textAllowOverlap,x=g===void 0?!1:g;if(!x){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var C=this.rendererService.getViewportSize(),T=C.width,O=C.height,k=new bA(T,O),j=this.glyphInfo.filter(function(X){var te=X.shaping,be=X.id,Ne=be===void 0?0:be,$e=X.version==="GAODE2.x"?X.originCentroid:X.centroid,ot=X.size,bt=ot/24,_t=a.mapService.lngLatToContainer($e),qt=k.placeCollisionBox({x1:te.left*bt-v[0],x2:te.right*bt+v[0],y1:te.top*bt-v[1],y2:te.bottom*bt+v[1],anchorPointX:_t.x,anchorPointY:_t.y}),ar=qt.box;return ar&&ar.length?(k.insertCollisionBox(ar,Ne),!0):!1});j.forEach(function(X){a.glyphInfoMap[X.id]=X})}}},{key:"initGlyph",value:function(){var a=this.layer.getLayerConfig(),s=a.iconfont,f=s===void 0?!1:s;f?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(f)}},{key:"updateTexture",value:function(){var a=this.rendererService.createTexture2D,s=this.fontService.canvas;this.textureHeight=s.height,this.texture&&this.texture.destroy(),this.texture=a({data:s,mag:G.LINEAR,min:G.LINEAR,width:s.width,height:s.height})}},{key:"reBuildModel",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;this.filterGlyphs(),this.layer.models=[this.layer.buildLayerModel({moduleName:"pointText",vertexShader:jy,fragmentShader:Zy,triangulation:Vy.bind(this),depth:{enable:!1},blend:this.getBlend(),stencil:Pa(f,g)})]}}]),r}(fo),OA={fillImage:XC,fill:Py,radar:fA,image:Iy,normal:Ry,simplePoint:mA,extrude:Ty,text:Gy,icon:QC},RA=OA;function LA(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=kA(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function kA(e,i){if(!!e){if(typeof e=="string")return Hy(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Hy(e,i)}}function Hy(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function DA(e){var i=FA();return function(){var n=(0,Mt.Z)(e),a;if(i){var s=(0,Mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,wr.Z)(this,a)}}function FA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Wy=function(e){(0,Ir.Z)(r,e);var i=DA(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ne.Z)(n),"type","PointLayer"),n}return(0,Pt.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new RA[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getModelTypeWillEmptyData",value:function(){if(this.shapeOption){var a=this.shapeOption,s=a.field,f=a.values,v=this.getLayerConfig(),g=v.shape2d,x=v.shape3d,C=this.iconService.getIconMap();if(s&&(g==null?void 0:g.indexOf(s))!==-1)return"fill";if(f&&f instanceof Array){var T=LA(f),O;try{for(T.s();!(O=T.n()).done;){var k=O.value;if(typeof k=="string"&&C.hasOwnProperty(k))return"image"}}catch(j){T.e(j)}finally{T.f()}}}return"normal"}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var a=this.getModelType(),s={fillImage:{},normal:{blend:"additive"},radar:{},simplePoint:{},fill:{blend:"normal"},extrude:{},image:{},icon:{},text:{blend:"normal"}};return s[a]}},{key:"getModelType",value:function(){var a=["fillImage","fill","radar","image","normal","simplePoint","extrude","text","icon"];if(this.layerType&&a.includes(this.layerType))return this.layerType;var s=this.getEncodedData(),f=this.getLayerConfig(),v=f.shape2d,g=f.shape3d,x=this.iconService.getIconMap(),C=s.find(function(O){return O.hasOwnProperty("shape")});if(C){var T=C.shape;return T==="dot"?"normal":T==="simple"?"simplePoint":T==="radar"?"radar":T==="fillImage"?"fillImage":(v==null?void 0:v.indexOf(T))!==-1?"fill":(g==null?void 0:g.indexOf(T))!==-1?"extrude":x.hasOwnProperty(T)?"image":this.fontService.getGlyph(T)!==""?"icon":"text"}else return this.getModelTypeWillEmptyData()}}]),r}(qh);function BA(e){var i=NA();return function(){var n=(0,Mt.Z)(e),a;if(i){var s=(0,Mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,wr.Z)(this,a)}}function NA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var zA=`uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];  
  float isSide = styleMappingMat[0][3];
  float sidey = styleMappingMat[3][0];
  float lightWeight = styleMappingMat[3][1];

  if(isSide < 1.0) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      gl_FragColor = v_Color;
    }

  } else {
     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    gl_FragColor = v_Color;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,UA=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - isSide
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[3][0] = a_uvs[2];

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // project_pos.z += 500000.0; // amap1

  // project_pos.z += (500000.0 * 4.0)/pow(2.0, 21.0 - u_Zoom); // mapbox
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,ZA=`uniform sampler2D u_texture;
uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float isSide = styleMappingMat[0][3];
  float lightWeight = styleMappingMat[3][1];
  float topU = styleMappingMat[2][2];
  float topV = styleMappingMat[2][3];

  float sidey = styleMappingMat[3][0];
  if(isSide < 1.0) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      gl_FragColor = v_Color;
    }
  } else {

     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    gl_FragColor = texture2D(u_texture, vec2(topU, topV));
  }
  

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,jA=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  v_Color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - a_Position.z(judge side by a_Position.z)
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - u - v
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[2][2] = a_uvs[0];
  styleMappingMat[2][3] = 1.0 - a_uvs[1];
  styleMappingMat[3][0] = a_uvs[2];


  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // project_pos.z += 500000.0; // amap1

  // project_pos.z += (500000.0 * 4.0)/pow(2.0, 21.0 - u_Zoom); // mapbox
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,VA=`uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float isSide = styleMappingMat[0][3];
  float sidey = styleMappingMat[3][0];
  float lightWeight = styleMappingMat[3][1];

  if(isSide < 1.0) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }
    
    if( u_linearColor == 1.0) {
      // side use linear
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      // side notuse linear
       gl_FragColor = v_Color;
    }
  } else {
    // top face
    if(u_topsurface < 1.0) {
      discard;
    }
    gl_FragColor = v_Color;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);
}
`,GA=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - isSide
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[3][0] = a_uvs[2];

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,HA=function(e){(0,Ir.Z)(r,e);var i=BA(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ne.Z)(n),"texture",void 0),n}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.heightfixed,g=v===void 0?!1:v,x=a.raisingHeight,C=x===void 0?0:x,T=a.topsurface,O=T===void 0?!0:T,k=a.sidesurface,j=k===void 0?!0:k,X=a.sourceColor,te=a.targetColor;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f})){this.judgeStyleAttributes({opacity:f});var be=this.layer.getEncodedData(),Ne=this.calDataFrame(this.cellLength,be,this.cellProperties),$e=Ne.data,ot=Ne.width,bt=Ne.height;this.rowCount=bt,this.dataTexture=this.cellLength>0&&$e.length>0?this.createTexture2D({flipY:!0,data:$e,format:G.LUMINANCE,type:G.FLOAT,width:ot,height:bt}):this.createTexture2D({flipY:!0,data:[1],format:G.LUMINANCE,type:G.FLOAT,width:1,height:1})}var _t=0,qt=[1,1,1,1],ar=[1,1,1,1];return X&&te&&(qt=Ji(X),ar=Ji(te),_t=1),{u_topsurface:Number(O),u_sidesurface:Number(j),u_heightfixed:Number(g),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(C),u_opacity:fa()(f)?f:1,u_linearColor:_t,u_sourceColor:qt,u_targetColor:ar,u_texture:this.texture}}},{key:"initModels",value:function(){return this.loadTexture(),this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v,x=this.getShaders(),C=x.frag,T=x.vert,O=x.type;return[this.layer.buildLayerModel({moduleName:O,vertexShader:T,fragmentShader:C,triangulation:hy,stencil:Pa(f,g)})]}},{key:"getShaders",value:function(){var a=this.layer.getLayerConfig(),s=a.pickLight,f=a.mapTexture;return f?{frag:ZA,vert:jA,type:"polygonExtrudeTexture"}:s?{frag:VA,vert:GA,type:"polygonExtrudePickLight"}:{frag:zA,vert:UA,type:"polygonExtrude"}}},{key:"clearModels",value:function(){var a,s;(a=this.dataTexture)===null||a===void 0||a.destroy(),(s=this.texture)===null||s===void 0||s.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.layer.getSource().extent,s=(0,on.Z)(a,4),f=s[0],v=s[1],g=s[2],x=s[3],C=g-f,T=x-v;this.styleAttributeService.registerStyleAttribute({name:"uvs",type:On.Attribute,descriptor:{name:"a_uvs",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:3,update:function(k,j,X,te,be){var Ne=X[0],$e=X[1];return[(Ne-f)/C,($e-v)/T,X[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:On.Attribute,descriptor:{name:"a_Normal",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:3,update:function(k,j,X,te,be){return be}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(k,j,X,te){var be=k.size,Ne=be===void 0?10:be;return Array.isArray(Ne)?[Ne[0]]:[Ne]}}})}},{key:"loadTexture",value:function(){var a=this,s=this.layer.getLayerConfig(),f=s.mapTexture,v=this.rendererService.createTexture2D;if(this.texture=v({height:0,width:0}),f){var g=new Image;g.crossOrigin="",g.src=f,g.onload=function(){a.texture=v({data:g,width:g.width,height:g.height,wrapS:G.CLAMP_TO_EDGE,wrapT:G.CLAMP_TO_EDGE,min:G.LINEAR,mag:G.LINEAR}),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()}}}}]),r}(fo);function WA(e){var i=XA();return function(){var n=(0,Mt.Z)(e),a;if(i){var s=(0,Mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,wr.Z)(this,a)}}function XA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var YA=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,qA=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
uniform float u_opacitylinear: 0.0;
uniform float u_dir: 1.0;
varying vec3 v_linear;
varying vec2 v_pos;


void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_dir == 1.0 ? 1.0 - length(v_pos - v_linear.xy)/v_linear.z : length(v_pos - v_linear.xy)/v_linear.z;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,KA=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_opacity: 1.0;
uniform float u_raisingHeight: 0.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

uniform float u_opacitylinear: 0.0;

attribute vec3 a_linear;
varying vec3 v_linear;
varying vec2 v_pos;

void main() {
  if(u_opacitylinear > 0.0) {
    v_linear = a_linear;
    v_pos = a_Position.xy;
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}`,$A=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_opacity: 1.0;
uniform float u_raisingHeight: 0.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,QA=function(e){(0,Ir.Z)(r,e);var i=WA(r);function r(){return(0,ht.Z)(this,r),i.apply(this,arguments)}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.raisingHeight,f=s===void 0?0:s,v=a.opacity,g=v===void 0?1:v,x=a.opacityLinear,C=x===void 0?{enable:!1,dir:"in"}:x;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:g})){this.judgeStyleAttributes({opacity:g});var T=this.layer.getEncodedData(),O=this.calDataFrame(this.cellLength,T,this.cellProperties),k=O.data,j=O.width,X=O.height;this.rowCount=X,this.dataTexture=this.cellLength>0&&k.length>0?this.createTexture2D({flipY:!0,data:k,format:G.LUMINANCE,type:G.FLOAT,width:j,height:X}):this.createTexture2D({flipY:!0,data:[1],format:G.LUMINANCE,type:G.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(f),u_opacity:fa()(g)?g:1,u_opacitylinear:Number(C.enable),u_dir:C.dir==="in"?1:0}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.getModelParams(),s=a.frag,f=a.vert,v=a.triangulation,g=a.type,x=this.layer.getLayerConfig(),C=x.mask,T=C===void 0?!1:C,O=x.maskInside,k=O===void 0?!0:O;return this.layer.triangulation=v,[this.layer.buildLayerModel({moduleName:g,vertexShader:f,fragmentShader:s,triangulation:v,blend:this.getBlend(),depth:{enable:!1},stencil:Pa(T,k)})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.layer.getLayerConfig(),s=a.opacityLinear,f=s===void 0?{enable:!1,dir:"in"}:s;f.enable&&this.styleAttributeService.registerStyleAttribute({name:"linear",type:On.Attribute,descriptor:{name:"a_linear",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:3,update:function(g,x,C,T,O){return[C[3],C[4],C[5]]}}})}},{key:"getModelParams",value:function(){var a=this.layer.getLayerConfig(),s=a.opacityLinear,f=s===void 0?{enable:!1}:s;return f.enable?{frag:qA,vert:KA,type:"polygon_linear",triangulation:NE}:{frag:YA,vert:$A,type:"polygon_fill",triangulation:Uv}}}]),r}(fo);function JA(e){var i=ew();return function(){var n=(0,Mt.Z)(e),a;if(i){var s=(0,Mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,wr.Z)(this,a)}}function ew(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var tw=`
uniform float u_time: 0.0;
uniform float u_opacity: 1.0;

varying vec2 v_uv;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

float coast2water_fadedepth = 0.10;
float large_waveheight      = .750; // change to adjust the "heavy" waves
float large_wavesize        = 3.4;  // factor to adjust the large wave size
float small_waveheight      = 0.6;  // change to adjust the small random waves
float small_wavesize        = 0.5;   // factor to ajust the small wave size
float water_softlight_fact  = 15.;  // range [1..200] (should be << smaller than glossy-fact)
float water_glossylight_fact= 120.; // range [1..200]
float particle_amount       = 70.;
// vec3 watercolor             = vec3(0.43, 0.60, 0.66); // 'transparent' low-water color (RGB)
// vec3 watercolor2            = vec3(0.06, 0.07, 0.11); // deep-water color (RGB, should be darker than the low-water color)
uniform vec4 u_watercolor;
uniform vec4 u_watercolor2;
vec3 water_specularcolor    = vec3(1.3, 1.3, 0.9);    // specular Color (RGB) of the water-highlights
#define light                 vec3(-0., sin(u_time*0.5)*.5 + .35, 2.8) // position of the sun

uniform sampler2D u_texture1;
uniform sampler2D u_texture2;
uniform sampler2D u_texture3;

  

float hash( float n ) {
    return fract(sin(n)*43758.5453123);
}

// 2d noise function
float noise1( in vec2 x ) {
  vec2 p  = floor(x);
  vec2 f  = smoothstep(0.0, 1.0, fract(x));
  float n = p.x + p.y*57.0;
  return mix(mix( hash(n+  0.0), hash(n+  1.0),f.x),
    mix( hash(n+ 57.0), hash(n+ 58.0),f.x),f.y);
}

float noise(vec2 p) {
    return texture2D(u_texture2,p*vec2(1./256.)).x;
}

vec4 highness(vec2 p) {
    vec4 t = texture2D(u_texture1,fract(p));
    float clipped = -2.0-smoothstep(3.,10.,t.a)*6.9-smoothstep(10.,100.,t.a)*89.9-smoothstep(0.,10000.,t.a)*10000.0;
    return clamp(t, 0.0,3.0)+clamp(t/3.0-1.0, 0.0,1.0)+clamp(t/16.0-1.0, 0.0,1.0);
}

float height_map( vec2 p ) {
    vec4 height=highness(p);
    /*
    height = -0.5+
        0.5*smoothstep(-100.,0.,-height)+
        2.75*smoothstep(0.,2.,height)+
        1.75*smoothstep(2.,4.,height)+
        2.75*smoothstep(4.,16.,height)+
        1.5*smoothstep(16.,1000.,height);
    */

    mat2 m = mat2( 0.9563*1.4,  -0.2924*1.4,  0.2924*1.4,  0.9563*1.4 );
    //p = p*6.;
    float f = 0.6000*noise1( p ); p = m*p*1.1*6.;
    f += 0.2500*noise( p ); p = m*p*1.32;
    f += 0.1666*noise( p ); p = m*p*1.11;
    f += 0.0834*noise( p ); p = m*p*1.12;
    f += 0.0634*noise( p ); p = m*p*1.13;
    f += 0.0444*noise( p ); p = m*p*1.14;
    f += 0.0274*noise( p ); p = m*p*1.15;
    f += 0.0134*noise( p ); p = m*p*1.16;
    f += 0.0104*noise( p ); p = m*p*1.17;
    f += 0.0084*noise( p );
    f = .25*f+dot(height,vec4(-.03125,-.125,.25,.25))*.5;
        const float FLAT_LEVEL = 0.92525;
        //f = f*0.25+height*0.75;
    if (f<FLAT_LEVEL)
        f = f;
    else
        f = pow((f-FLAT_LEVEL)/(1.-FLAT_LEVEL), 2.)*(1.-FLAT_LEVEL)*2.0+FLAT_LEVEL; // makes a smooth coast-increase
    return clamp(f, 0., 10.);
}

vec3 plasma_quintic( float x ) {
    x = clamp( x, 0.0, 1.0);
    vec4 x1 = vec4( 1.0, x, x * x, x * x * x ); // 1 x x2 x3
    vec4 x2 = x1 * x1.w * x; // x4 x5 x6 x7
    return vec3(
        dot( x1.xyzw, vec4( +0.063861086, +1.992659096, -1.023901152, -0.490832805 ) ) + dot( x2.xy, vec2( +1.308442123, -0.914547012 ) ),
        dot( x1.xyzw, vec4( +0.049718590, -0.791144343, +2.892305078, +0.811726816 ) ) + dot( x2.xy, vec2( -4.686502417, +2.717794514 ) ),
        dot( x1.xyzw, vec4( +0.513275779, +1.580255060, -5.164414457, +4.559573646 ) ) + dot( x2.xy, vec2( -1.916810682, +0.570638854 ) ) );
}

vec4 color(vec2 p){
    vec4 c1 = vec4(1.7,1.6,.9,1);
    vec4 c2 = vec4(.2,.94,.1,1);
    vec4 c3 = vec4(.3,.2,.0,1);
    vec4 c4 = vec4(.99,.99,1.6,1);
    vec4 v = highness(p);
    float los = smoothstep(0.1,1.1,v.b);
    float his = smoothstep(3.5,6.5,v.b);
    float ces = smoothstep(1.,5.,v.a);
    vec4 lo = mix(c1,c2,los);
    vec4 hi = mix(c3,c4,his);
    vec4 ce = mix(lo,hi,ces);

    return vec4(plasma_quintic(ces),1).ragb;
}

vec3 terrain_map( vec2 p )
{
  return color(p).rgb*0.75+0.25*vec3(0.7, .55, .4)+texture2D(u_texture3, fract(p*5.)).rgb*.5; // test-terrain is simply 'sandstone'
}

const mat2 m = mat2( 0.72, -1.60,  1.60,  0.72 );

float water_map( vec2 p, float height ) {
    vec2 p2 = p*large_wavesize;
    vec2 shift1 = 0.001*vec2( u_time*160.0*2.0, u_time*120.0*2.0 );
    vec2 shift2 = 0.001*vec2( u_time*190.0*2.0, -u_time*130.0*2.0 );

    // coarse crossing 'ocean' waves...
    float f = 0.6000*noise( p );
    f += 0.2500*noise( p*m );
    f += 0.1666*noise( p*m*m );
    float wave = sin(p2.x*0.622+p2.y*0.622+shift2.x*4.269)*large_waveheight*f*height*height ;

    p *= small_wavesize;
    f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<9; i++)
    { p = m*p*.947; f -= amp*abs(sin((noise( p+shift1*s )-.5)*2.)); amp = amp*.59; s*=-1.329; }
    
    return wave+f*small_waveheight;
}

float nautic(vec2 p) {
    p *= 18.;
    float f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*abs(smoothstep(0., 1., noise( p+u_time*s ))-.5); amp = amp*.5; s*=-1.227; }
    return pow(1.-f, 5.);
}

float particles(vec2 p) {
    p *= 200.;
    float f = 0.;
    float amp = 1.0, s = 1.5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*noise( p+u_time*s ); amp = amp*.5; s*=-1.227; }
    return pow(f*.35, 7.)*particle_amount;
}

float test_shadow( vec2 xy, float height) {
    vec3 r0 = vec3(xy, height);
    vec3 rd = normalize( light - r0 );
    
    float hit = 1.0;
    float t   = 0.001;
    for (int j=1; j<25; j++)
    {
        vec3 p = r0 + t*rd;
        float h = height_map( p.xy );
        float height_diff = p.z - h;
        if (height_diff<0.0)
        {
            return 0.0;
        }
        t += 0.01+height_diff*.02;
        hit = min(hit, 2.*height_diff/t); // soft shaddow   
    }
    return hit;
}

vec3 CalcTerrain(vec2 uv, float height) {
    vec3 col = terrain_map( uv );
    vec2 iResolution = vec2(512.);
    float h1 = height_map(uv-vec2(0., 0.5)/ iResolution.xy);
    float h2 = height_map(uv+vec2(0., 0.5)/ iResolution.xy);
    float h3 = height_map(uv-vec2(0.5, 0.)/ iResolution.xy);
    float h4 = height_map(uv+vec2(0.5, 0.)/ iResolution.xy);
    vec3 norm = normalize(vec3(h3-h4, h1-h2, 1.));
    vec3 r0 = vec3(uv, height);
    vec3 rd = normalize( light - r0 );
    float grad = dot(norm, rd);
    col *= grad+pow(grad, 8.);
    float terrainshade = test_shadow( uv, height );
    col = mix(col*.25, col, terrainshade);
    return col;
}


void main() {
  vec3 watercolor = u_watercolor.rgb;
  vec3 watercolor2 = u_watercolor2.rgb;
  vec2 uv = v_uv;
  float WATER_LEVEL = 0.84; // Water level (range: 0.0 - 2.0)
  float deepwater_fadedepth   = 0.4 + coast2water_fadedepth;
  float height = height_map( uv );
  vec3 col;

    float waveheight = clamp(WATER_LEVEL*3.-1.5, 0., 1.);
    float level = WATER_LEVEL + .2*water_map(uv*15. + vec2(u_time*.1), waveheight);
    if (height > level)
    {
        col = CalcTerrain(uv, height);
    }
    if (height <= level)
    {
        vec2 dif = vec2(.0, .01);
        vec2 pos = uv*15. + vec2(u_time*.01);
        float h1 = water_map(pos-dif,waveheight);
        float h2 = water_map(pos+dif,waveheight);
        float h3 = water_map(pos-dif.yx,waveheight);
        float h4 = water_map(pos+dif.yx,waveheight);
        vec3 normwater = normalize(vec3(h3-h4, h1-h2, .125)); // norm-vector of the 'bumpy' water-plane
        uv += normwater.xy*.002*(level-height);
        
        col = CalcTerrain(uv, height);

        float coastfade = clamp((level-height)/coast2water_fadedepth, 0., 1.);
        float coastfade2= clamp((level-height)/deepwater_fadedepth, 0., 1.);
        float intensity = col.r*.2126+col.g*.7152+col.b*.0722;
        watercolor = mix(watercolor*intensity, watercolor2, smoothstep(0., 1., coastfade2));

        vec3 r0 = vec3(uv, WATER_LEVEL);
        vec3 rd = normalize( light - r0 ); // ray-direction to the light from water-position
        float grad     = dot(normwater, rd); // dot-product of norm-vector and light-direction
        float specular = pow(grad, water_softlight_fact);  // used for soft highlights                          
        float specular2= pow(grad, water_glossylight_fact); // used for glossy highlights
        float gradpos  = dot(vec3(0., 0., 1.), rd);
        float specular1= smoothstep(0., 1., pow(gradpos, 5.));  // used for diffusity (some darker corona around light's specular reflections...)                          
        float watershade  = test_shadow( uv, level );
        watercolor *= 2.2+watershade;
        watercolor += (.2+.8*watershade) * ((grad-1.0)*.5+specular) * .25;
        watercolor /= (1.+specular1*1.25);
        watercolor += watershade*specular2*water_specularcolor;
        watercolor += watershade*coastfade*(1.-coastfade2)*(vec3(.5, .6, .7)*nautic(uv)+vec3(1., 1., 1.)*particles(uv));
        
        col = mix(col, watercolor, coastfade);
    }
    

  float opacity = styleMappingMat[0][0];
  gl_FragColor = vec4(col, opacity);  
}
`,rw=`attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec2 v_uv;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"

void main() {
  v_uv = a_uv;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,nw=function(e){(0,Ir.Z)(r,e);var i=JA(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ne.Z)(n),"texture1",void 0),(0,A.Z)((0,ne.Z)(n),"texture2",void 0),(0,A.Z)((0,ne.Z)(n),"texture3",void 0),n}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.watercolor,g=v===void 0?"#6D99A8":v,x=a.watercolor2,C=x===void 0?"#0F121C":x;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f})){this.judgeStyleAttributes({opacity:f});var T=this.layer.getEncodedData(),O=this.calDataFrame(this.cellLength,T,this.cellProperties),k=O.data,j=O.width,X=O.height;this.rowCount=X,this.dataTexture=this.cellLength>0&&k.length>0?this.createTexture2D({flipY:!0,data:k,format:G.LUMINANCE,type:G.FLOAT,width:j,height:X}):this.createTexture2D({flipY:!0,data:[1],format:G.LUMINANCE,type:G.FLOAT,width:1,height:1})}return{u_texture1:this.texture1,u_texture2:this.texture2,u_texture3:this.texture3,u_watercolor:Ji(g),u_watercolor2:Ji(C),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:fa()(f)?f:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.loadTexture(),this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"polygon_ocean",vertexShader:rw,fragmentShader:tw,triangulation:Uv,depth:{enable:!1},stencil:Pa(f,g)})]}},{key:"clearModels",value:function(){var a,s,f,v;(a=this.texture1)===null||a===void 0||a.destroy(),(s=this.texture2)===null||s===void 0||s.destroy(),(f=this.texture3)===null||f===void 0||f.destroy(),(v=this.dataTexture)===null||v===void 0||v.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.layer.getSource().extent,s=(0,on.Z)(a,4),f=s[0],v=s[1],g=s[2],x=s[3],C=g-f,T=x-v;this.styleAttributeService.registerStyleAttribute({name:"oceanUv",type:On.Attribute,descriptor:{name:"a_uv",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(k,j,X,te,be){var Ne=(0,on.Z)(X,2),$e=Ne[0],ot=Ne[1];return[($e-f)/C,(ot-v)/T]}}})}},{key:"loadTexture",value:function(){var a=this,s=this.rendererService.createTexture2D,f={height:0,width:0};this.texture1=s(f),this.texture2=s(f),this.texture3=s(f),v(function(x){a.texture1=g(x[0]),a.texture2=g(x[1]),a.texture3=g(x[2]),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()});function v(x){var C=0,T=[],O=["https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*MJ22QbpuCzIAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*-z2HSIVDsHIAAAAAAAAAAAAAARQnAQ"];O.map(function(k){var j=new Image;j.crossOrigin="",j.src=k,T.push(j),j.onload=function(){C++,C===3&&x(T)}})}function g(x){return s({data:x,width:x.width,height:x.height,wrapS:G.MIRRORED_REPEAT,wrapT:G.MIRRORED_REPEAT,min:G.LINEAR,mag:G.LINEAR})}}}]),r}(fo);function iw(e){var i=aw();return function(){var n=(0,Mt.Z)(e),a;if(i){var s=(0,Mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,wr.Z)(this,a)}}function aw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ow=`uniform sampler2D u_texture;
uniform float u_time: 0.0;
uniform float u_speed: 1.0;
uniform float u_opacity: 1.0;

varying vec4 v_Color;
varying vec2 v_uv;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E


float rand(vec2 n) { return 0.5 + 0.5 * fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453); }

float water(vec3 p) {
  float t = u_time * u_speed;
  p.z += t * 2.; p.x += t * 2.;
  vec3 c1 = texture2D(u_texture, p.xz / 30.).xyz;
  p.z += t * 3.; p.x += t * 0.52;
  vec3 c2 = texture2D(u_texture, p.xz / 30.).xyz;
  p.z += t * 4.; p.x += t * 0.8;
  vec3 c3 = texture2D(u_texture, p.xz / 30.).xyz;
  c1 += c2 - c3;
  float z = (c1.x + c1.y + c1.z) / 3.;
  return p.y + z / 4.;
}

float map(vec3 p) {
  float d = 100.0;
  d = water(p);
  return d;
}

float intersect(vec3 ro, vec3 rd) {
  float d = 0.0;
  for (int i = 0; i <= 100; i++) {
    float h = map(ro + rd * d);
    if (h < 0.1) return  d;
    d += h;
  }
  return 0.0;
}

vec3 norm(vec3 p) {
  float eps = .1;
  return normalize(vec3(
    map(p + vec3(eps, 0, 0)) - map(p + vec3(-eps, 0, 0)),
    map(p + vec3(0, eps, 0)) - map(p + vec3(0, -eps, 0)),
    map(p + vec3(0, 0, eps)) - map(p + vec3(0, 0, -eps))
  ));
} 

float calSpc() {
  vec3 l1 = normalize(vec3(1, 1, 1));
  vec3 ro = vec3(-3, 20, -8);
  vec3 rc = vec3(0, 0, 0);
  vec3 ww = normalize(rc - ro);
  vec3 uu = normalize(cross(vec3(0,1,0), ww));
  vec3 vv = normalize(cross(rc - ro, uu));
  vec3 rd = normalize(uu * v_uv.x + vv * v_uv.y + ww);
  float d = intersect(ro, rd);
  vec3 p = ro + rd * d;
  vec3 n = norm(p);
  float spc = pow(max(0.0, dot(reflect(l1, n), rd)), 30.0);
  return spc;
}

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;

  float spc = calSpc();
  gl_FragColor += spc * 0.4;
}
`,sw=`attribute vec4 a_Color;
attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
varying vec2 v_uv;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"

void main() {
  v_uv = a_uv;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,uw=function(e){(0,Ir.Z)(r,e);var i=iw(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ne.Z)(n),"texture",void 0),n}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.speed,g=v===void 0?.5:v;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f})){this.judgeStyleAttributes({opacity:f});var x=this.layer.getEncodedData(),C=this.calDataFrame(this.cellLength,x,this.cellProperties),T=C.data,O=C.width,k=C.height;this.rowCount=k,this.dataTexture=this.cellLength>0&&T.length>0?this.createTexture2D({flipY:!0,data:T,format:G.LUMINANCE,type:G.FLOAT,width:O,height:k}):this.createTexture2D({flipY:!0,data:[1],format:G.LUMINANCE,type:G.FLOAT,width:1,height:1})}return{u_texture:this.texture,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_speed:g,u_opacity:fa()(f)?f:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.loadTexture(),this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"polygon_water",vertexShader:sw,fragmentShader:ow,triangulation:Uv,depth:{enable:!1},stencil:Pa(f,g)})]}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.layer.getSource().extent,s=(0,on.Z)(a,4),f=s[0],v=s[1],g=s[2],x=s[3],C=g-f,T=x-v;this.styleAttributeService.registerStyleAttribute({name:"waterUv",type:On.Attribute,descriptor:{name:"a_uv",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(k,j,X,te,be){var Ne=(0,on.Z)(X,2),$e=Ne[0],ot=Ne[1];return[($e-f)/C,(ot-v)/T]}}})}},{key:"loadTexture",value:function(){var a=this,s=this.layer.getLayerConfig(),f=s.waterTexture,v=this.rendererService.createTexture2D;this.texture=v({height:0,width:0});var g=new Image;g.crossOrigin="",f?(console.warn("L7 recommend\uFF1Ahttps://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ"),g.src=f):g.src="https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ",g.onload=function(){a.texture=v({data:g,width:g.width,height:g.height,wrapS:G.MIRRORED_REPEAT,wrapT:G.MIRRORED_REPEAT,min:G.LINEAR,mag:G.LINEAR}),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()}}}]),r}(fo),lw={fill:QA,line:Cy,extrude:HA,text:Gy,point_fill:Py,point_image:Iy,point_normal:Ry,point_extrude:Ty,water:uw,ocean:nw},cw=lw;function fw(e){var i=hw();return function(){var n=(0,Mt.Z)(e),a;if(i){var s=(0,Mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,wr.Z)(this,a)}}function hw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Xy=function(e){(0,Ir.Z)(r,e);var i=fw(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ne.Z)(n),"type","PolygonLayer"),n}return(0,Pt.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new cw[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var a,s=this.styleAttributeService.getLayerStyleAttribute("shape"),f=s==null||(a=s.scale)===null||a===void 0?void 0:a.field;return f==="fill"?"fill":f==="extrude"?"extrude":f==="water"?"water":f==="ocean"?"ocean":f==="line"?"line":this.getPointModelType()}},{key:"getPointModelType",value:function(){var a=this.getEncodedData(),s=this.getLayerConfig(),f=s.shape2d,v=s.shape3d,g=this.iconService.getIconMap(),x=a.find(function(T){return T.hasOwnProperty("shape")});if(x){var C=x.shape;return C==="dot"?"point_normal":(f==null?void 0:f.indexOf(C))!==-1?"point_fill":(v==null?void 0:v.indexOf(C))!==-1?"point_extrude":g.hasOwnProperty(C)?"point_image":"text"}else return"fill"}}]),r}(qh);function pw(e){var i=dw();return function(){var n=(0,Mt.Z)(e),a;if(i){var s=(0,Mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,wr.Z)(this,a)}}function dw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var vw=function(e){(0,Ir.Z)(r,e);var i=pw(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ne.Z)(n),"isLayerGroup",!0),n}return(0,Pt.Z)(r,[{key:"addChild",value:function(a){this.layerChildren.push(a)}},{key:"removeChild",value:function(a){var s=this.layerChildren.indexOf(a);s>-1&&this.layerChildren.splice(s,1),a.destroy()}},{key:"clearChild",value:function(){this.layerChildren.forEach(function(a){a.destroy()}),this.layerChildren=[]}},{key:"hasChild",value:function(a){return this.layerChildren.includes(a)}}]),r}(qh);function mw(e){var i=gw();return function(){var n=(0,Mt.Z)(e),a;if(i){var s=(0,Mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,wr.Z)(this,a)}}function gw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var yw=function(e){(0,Ir.Z)(r,e);var i=mw(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ne.Z)(n),"initedTileset",!1),(0,A.Z)((0,ne.Z)(n),"tilesetManager",void 0),(0,A.Z)((0,ne.Z)(n),"showGrid",!1),(0,A.Z)((0,ne.Z)(n),"subGridLayer",void 0),(0,A.Z)((0,ne.Z)(n),"subTextLayer",void 0),(0,A.Z)((0,ne.Z)(n),"lastViewStates",void 0),(0,A.Z)((0,ne.Z)(n),"timer",void 0),(0,A.Z)((0,ne.Z)(n),"renderSubLayers",function(){if(!!n.tilesetManager){var v=n.layer;n.tilesetManager.tiles.filter(function(g){return g.isLoaded}).map(function(g){return g.layer?g.layer.updateLayerConfig({visible:g.isVisible}):(g.layer=n.creatSubLayer(g),v.addChild(g.layer)),g.layer}),n.showGrid&&(v.hasChild(n.subGridLayer)||v.addChild(n.subGridLayer),v.hasChild(n.subTextLayer)||v.addChild(n.subTextLayer)),n.layerService.renderLayers(),n.tilesetManager.isLoaded&&v.emit("tiles-loaded",n.tilesetManager.currentTiles)}}),n}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){return{}}},{key:"initModels",value:function(){var a,s=this.layer.getSource();this.tilesetManager=s.tileset,this.initedTileset||(this.bindTilesetEvent(),this.initedTileset=!0);var f=this.getCurrentView(),v=f.latLonBounds,g=f.zoom;return(a=this.tilesetManager)===null||a===void 0||a.update(g,v),this.showGrid&&this.renderSubGridLayer(),this.buildModels()}},{key:"buildModels",value:function(){return[]}},{key:"clearModels",value:function(){}},{key:"renderSubGridLayer",value:function(){if(!!this.tilesetManager){var a=this.tilesetManager.currentTiles.map(function(f){return f.bboxPolygon}),s={type:"FeatureCollection",features:a};if(this.subGridLayer){this.subGridLayer.setData(s),this.subTextLayer.setData(s);return}this.subGridLayer=new wy({autoFit:!1}).source(s).size(1).color("red").shape("simple").style({lineType:"dash",dashArray:[1,2]}),this.subTextLayer=new Wy({autoFit:!1}).source(s).size(14).color("red").shape("meta","text").style({opacity:1,strokeWidth:1,stroke:"#fff"}),this.subGridLayer.setContainer(av(this.layer.sceneContainer),this.layer.sceneContainer),this.subTextLayer.setContainer(av(this.layer.sceneContainer),this.layer.sceneContainer),this.subGridLayer.init(),this.subTextLayer.init()}}},{key:"registerBuiltinAttributes",value:function(){}},{key:"bindTilesetEvent",value:function(){var a=this;!this.tilesetManager||(this.tilesetManager.on("tile-loaded",function(s){}),this.tilesetManager.on("tile-unload",function(s){a.destroySubLayer(s)}),this.tilesetManager.on("tile-error",function(s,f){}),this.tilesetManager.on("tile-update",this.renderSubLayers),this.mapService.on("mapchange",function(s){var f=a.getCurrentView(),v=f.latLonBounds,g=f.zoom;if(a.mapService.version==="GAODE1.x"){var x=a.layer.getLayerConfig(),C=x.visible;g<3&&C?(a.layer.updateLayerConfig({visible:!1}),a.layerService.updateLayerRenderList()):g>=3&&!C&&(a.layer.updateLayerConfig({visible:!0}),a.layerService.updateLayerRenderList())}a.lastViewStates&&a.lastViewStates.zoom===g&&a.lastViewStates.latLonBounds.toString()===v.toString()||(a.lastViewStates={zoom:g,latLonBounds:v},a.timer&&(clearTimeout(a.timer),a.timer=null),a.timer=setTimeout(function(){var T;(T=a.tilesetManager)===null||T===void 0||T.update(g,v),a.showGrid&&a.renderSubGridLayer()},250))}))}},{key:"creatSubLayer",value:function(a){var s=this.layer.getLayerConfig(),f=s.opacity,v=f===void 0?1:f,g=s.zIndex,x=g===void 0?0:g,C=new Ey({visible:a.isVisible,zIndex:x}).source(a.data,{parser:{type:"image",extent:a.bounds}}).style({opacity:v}),T=av(this.layer.sceneContainer);return C.setContainer(T,this.layer.sceneContainer),C.init(),C}},{key:"destroySubLayer",value:function(a){if(a.layer){var s=this.layer;s.removeChild(a.layer)}}},{key:"getCurrentView",value:function(){var a=this.mapService.getBounds(),s=[a[0][0],a[0][1],a[1][0],a[1][1]],f=this.mapService.getZoom();return{latLonBounds:s,zoom:f}}}]),r}(fo);function _w(e){var i=xw();return function(){var n=(0,Mt.Z)(e),a;if(i){var s=(0,Mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,wr.Z)(this,a)}}function xw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var bw=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_min;
uniform float u_max;
uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
varying vec2 v_texCoord;

void main() {

  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;
  if (value == u_noDataValue)
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))
    gl_FragColor = vec4(0, 0, 0, 0);
  else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);
    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }


}
`,Ew=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,Yy=function(e){(0,Ir.Z)(r,e);var i=_w(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ne.Z)(n),"texture",void 0),(0,A.Z)((0,ne.Z)(n),"colorTexture",void 0),n}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.clampLow,g=v===void 0?!0:v,x=a.clampHigh,C=x===void 0?!0:x,T=a.noDataValue,O=T===void 0?-9999999:T,k=a.domain,j=k===void 0?[0,1]:k;return this.updateColorTexure(),{u_opacity:f||1,u_texture:this.texture,u_domain:j,u_clampLow:g,u_clampHigh:typeof C!="undefined"?C:g,u_noDataValue:O,u_colorTexture:this.colorTexture}}},{key:"initModels",value:function(){this.layer.isLayerGroup=!1;var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v,x=this.layer.getSource(),C=this.rendererService.createTexture2D,T=x.data.dataArray[0];this.texture=C({data:T.data,width:T.width,height:T.height,format:G.LUMINANCE,type:G.FLOAT});var O=this.layer.getLayerConfig(),k=O.rampColors,j=Ts(k);return this.colorTexture=C({data:j.data,width:j.width,height:j.height,flipY:!1}),[this.layer.buildLayerModel({moduleName:"RasterImageData",vertexShader:Ew,fragmentShader:bw,triangulation:dy,primitive:G.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:Pa(f,g)})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:On.Attribute,descriptor:{name:"a_Uv",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(s,f,v,g){return[v[3],v[4]]}}})}},{key:"updateColorTexure",value:function(){var a=this.rendererService.createTexture2D,s=this.layer.getLayerConfig(),f=s.rampColors,v=Ts(f);this.colorTexture=a({data:v.data,width:v.width,height:v.height,flipY:!1})}}]),r}(fo),Sw={raster:Yy,raster3d:Yy,rasterTile:yw},Cw=Sw;function Aw(e){var i=ww();return function(){var n=(0,Mt.Z)(e),a;if(i){var s=(0,Mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,wr.Z)(this,a)}}function ww(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Tw=function(e){(0,Ir.Z)(r,e);var i=Aw(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ne.Z)(n),"type","RasterLayer"),n}return(0,Pt.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new Cw[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var a=this.getModelType(),s={raster:{},raster3d:{},rasterTile:{}};return s[a]}},{key:"getModelType",value:function(){switch(this.layerSource.parser.type){case"raster":return"raster";case"rasterTile":return"rasterTile";default:return"raster"}}}]),r}(vw);function Mw(e){var i=Pw();return function(){var n=(0,Mt.Z)(e),a;if(i){var s=(0,Mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,wr.Z)(this,a)}}function Pw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Iw=`uniform float u_opacity;
varying vec4 v_Color;

void main() {
  gl_FragColor = v_Color;
  gl_FragColor.a *= u_opacity;
}
`,Ow=`attribute vec4 a_Color;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;

#pragma include "projection"

void main() {

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,Rw=function(e){(0,Ir.Z)(r,e);var i=Mw(r);function r(){return(0,ht.Z)(this,r),i.apply(this,arguments)}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?0:s;return{u_opacity:fa()(f)?f:0}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"mask",vertexShader:Ow,fragmentShader:Iw,triangulation:Uv,blend:this.getBlend(),depth:{enable:!1},stencil:{enable:!0,mask:255,func:{cmp:G.ALWAYS,ref:1,mask:255},opFront:{fail:G.REPLACE,zfail:G.REPLACE,zpass:G.REPLACE}}})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy(),this.layerService.clear()}},{key:"registerBuiltinAttributes",value:function(){return""}}]),r}(fo),Lw={fill:Rw},kw=Lw;function Dw(e){var i=Fw();return function(){var n=(0,Mt.Z)(e),a;if(i){var s=(0,Mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,wr.Z)(this,a)}}function Fw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Bw=function(e){(0,Ir.Z)(r,e);var i=Dw(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ne.Z)(n),"type","MaskLayer"),n}return(0,Pt.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new kw[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"fill"}}]),r}(qh),qy,Ky,$y,Qy,Jy,uv,e_,t_,r_;function n_(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Nw(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?n_(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n_(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var zw=(qy=(0,Wr.b2)(),Ky=(0,Wr.f3)(Ht.IGlobalConfigService),$y=(0,Wr.f3)(Ht.IMapService),Qy=(0,Wr.f3)(Ht.IFontService),qy(Jy=(uv=function(){function e(){(0,ht.Z)(this,e),Ui(this,"configService",e_,this),Ui(this,"mapService",t_,this),Ui(this,"fontService",r_,this)}return(0,Pt.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.styleAttributeService;r.hooks.init.tap("DataMappingPlugin",function(){a.generateMaping(r,{styleAttributeService:s})}),r.hooks.beforeRenderData.tap("DataMappingPlugin",function(){return r.dataState.dataMappingNeedUpdate=!1,a.generateMaping(r,{styleAttributeService:s}),!0}),r.hooks.beforeRender.tap("DataMappingPlugin",function(){if(!r.layerModelNeedUpdate){var f=r.getBottomColor(),v=s.getLayerStyleAttributes()||[],g=s.getLayerStyleAttribute("filter"),x=r.getSource().data.dataArray,C=v.filter(function(O){return O.needRemapping}),T=x;g!=null&&g.needRemapping&&g!==null&&g!==void 0&&g.scale&&(T=x.filter(function(O){return a.applyAttributeMapping(g,O,f)[0]})),C.length&&(g!=null&&g.needRemapping?(r.setEncodedData(a.mapping(r,v,T,void 0,f)),g.needRemapping=!1):r.setEncodedData(a.mapping(r,C,T,r.getEncodedData(),f)),r.emit("remapping",null))}})}},{key:"generateMaping",value:function(r,n){var a=this,s=n.styleAttributeService,f=r.getBottomColor(),v=s.getLayerStyleAttributes()||[],g=s.getLayerStyleAttribute("filter"),x=r.getSource().data.dataArray,C=x;g!=null&&g.scale&&(C=x.filter(function(T){return a.applyAttributeMapping(g,T,f)[0]})),r.setEncodedData(this.mapping(r,v,C,void 0,f)),r.emit("dataUpdate",null)}},{key:"getArrowPoints",value:function(r,n){var a=[n[0]-r[0],n[1]-r[1]],s=cu(a),f=[r[0]+s[0]*1e-4,r[1]+s[1]*1e-4];return f}},{key:"mapping",value:function(r,n,a,s,f){var v=this,g=r.getLayerConfig(),x=g.arrow,C=x===void 0?{enable:!1}:x,T=a.map(function(O,k){var j=s?s[k]:{},X=Nw({id:O._id,coordinates:O.coordinates},j);if(n.filter(function(Ne){return Ne.scale!==void 0}).forEach(function(Ne){var $e=v.applyAttributeMapping(Ne,O,f);Ne.needRemapping=!1,Ne.name==="color"&&($e=$e.map(function(ot){return Ji(ot)})),X[Ne.name]=Array.isArray($e)&&$e.length===1?$e[0]:$e,Ne.name==="shape"&&(X.shape=v.fontService.getIconFontKey(X[Ne.name]))}),X.shape==="line"&&C.enable){var te=X.coordinates,be=v.getArrowPoints(te[0],te[1]);X.coordinates.splice(1,0,be,be)}return X});return this.adjustData2Amap2Coordinates(T,r),this.adjustData2SimpleCoordinates(T),T}},{key:"adjustData2Amap2Coordinates",value:function(r,n){var a=this;if(r.length>0&&this.mapService.version===js["GAODE2.x"]){var s=this.getLayerCenter(n);typeof r[0].coordinates[0]=="number"?r.filter(function(f){return!f.originCoordinates}).map(function(f){f.version=js["GAODE2.x"],f.originCoordinates=du()(f.coordinates),f.coordinates=a.mapService.lngLatToCoordByLayer(f.coordinates,s)}):r.filter(function(f){return!f.originCoordinates}).map(function(f){f.version=js["GAODE2.x"],f.originCoordinates=du()(f.coordinates),f.coordinates=a.mapService.lngLatToCoordsByLayer(f.coordinates,s)})}}},{key:"getLayerCenter",value:function(r){var n=r.getSource();return n.center}},{key:"adjustData2SimpleCoordinates",value:function(r){var n=this;r.length>0&&this.mapService.version===js.SIMPLE&&r.map(function(a){a.simpleCoordinate||(a.coordinates=n.unProjectCoordinates(a.coordinates),a.simpleCoordinate=!0)})}},{key:"unProjectCoordinates",value:function(r){var n=this;if(typeof r[0]=="number")return this.mapService.simpleMapCoord.unproject(r);if(r[0]&&r[0][0]instanceof Array){var a=[];return r.map(function(f){var v=[];f.map(function(g){v.push(n.mapService.simpleMapCoord.unproject(g))}),a.push(v)}),a}else{var s=[];return r.map(function(f){s.push(n.mapService.simpleMapCoord.unproject(f))}),s}}},{key:"applyAttributeMapping",value:function(r,n,a){var s;if(!r.scale)return[];var f=(r==null||(s=r.scale)===null||s===void 0?void 0:s.scalers)||[],v=[];f.forEach(function(x){var C,T=x.field;(n.hasOwnProperty(T)||((C=r.scale)===null||C===void 0?void 0:C.type)==="variable")&&v.push(n[T])});var g=r.mapping?r.mapping(v):[];return r.name==="color"&&!al(g[0])?[a]:g}}]),e}(),e_=jn(uv.prototype,"configService",[Ky],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),t_=jn(uv.prototype,"mapService",[$y],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),r_=jn(uv.prototype,"fontService",[Qy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uv))||Jy),i_,a_,Uw=(i_=(0,Wr.b2)(),i_(a_=function(){function e(){(0,ht.Z)(this,e),(0,A.Z)(this,"mapService",void 0)}return(0,Pt.Z)(e,[{key:"apply",value:function(r){var n=this;this.mapService=r.getContainer().get(Ht.IMapService),r.hooks.init.tap("DataSourcePlugin",function(){var a=r.getSource();if(!a){var s=r.sourceOption||{data:Al,options:Cf},f=s.data,v=s.options;r.setSource(new Vl(f,v))}n.updateClusterData(r)}),r.hooks.beforeRenderData.tap("DataSourcePlugin",function(){var a=n.updateClusterData(r),s=r.dataState.dataSourceNeedUpdate;return r.dataState.dataSourceNeedUpdate=!1,a||s})}},{key:"updateClusterData",value:function(r){var n=r.getSource(),a=n.cluster,s=n.clusterOptions,f=s.zoom,v=f===void 0?0:f,g=s.maxZoom,x=g===void 0?16:g,C=this.mapService.getZoom()-1,T=r.dataState.dataSourceNeedUpdate;return a&&(T||Math.abs(r.clusterZoom-C)>=1)?(v!==Math.floor(C)&&n.updateClusterData(Math.floor(C)),r.clusterZoom=C,!0):!1}}]),e}())||a_);function Z0(e,i){return e<i?-1:e>i?1:e>=i?0:NaN}function o_(e){return e.length===1&&(e=Zw(e)),{left:function(i,r,n,a){for(n==null&&(n=0),a==null&&(a=i.length);n<a;){var s=n+a>>>1;e(i[s],r)<0?n=s+1:a=s}return n},right:function(i,r,n,a){for(n==null&&(n=0),a==null&&(a=i.length);n<a;){var s=n+a>>>1;e(i[s],r)>0?a=s:n=s+1}return n}}}function Zw(e){return function(i,r){return Z0(e(i),r)}}var s_=o_(Z0),jw=s_.right,eI=s_.left,Vv=jw;function u_(e,i){var r=e.length,n=-1,a,s,f;if(i==null){for(;++n<r;)if((a=e[n])!=null&&a>=a)for(s=f=a;++n<r;)(a=e[n])!=null&&(s>a&&(s=a),f<a&&(f=a))}else for(;++n<r;)if((a=i(e[n],n,e))!=null&&a>=a)for(s=f=a;++n<r;)(a=i(e[n],n,e))!=null&&(s>a&&(s=a),f<a&&(f=a));return[s,f]}var l_=Array.prototype,tI=l_.slice,rI=l_.map,j0=Math.sqrt(50),V0=Math.sqrt(10),G0=Math.sqrt(2);function c_(e,i,r){var n,a=-1,s,f,v;if(i=+i,e=+e,r=+r,e===i&&r>0)return[e];if((n=i<e)&&(s=e,e=i,i=s),(v=Gv(e,i,r))===0||!isFinite(v))return[];if(v>0)for(e=Math.ceil(e/v),i=Math.floor(i/v),f=new Array(s=Math.ceil(i-e+1));++a<s;)f[a]=(e+a)*v;else for(e=Math.floor(e*v),i=Math.ceil(i*v),f=new Array(s=Math.ceil(e-i+1));++a<s;)f[a]=(e-a)/v;return n&&f.reverse(),f}function Gv(e,i,r){var n=(i-e)/Math.max(0,r),a=Math.floor(Math.log(n)/Math.LN10),s=n/Math.pow(10,a);return a>=0?(s>=j0?10:s>=V0?5:s>=G0?2:1)*Math.pow(10,a):-Math.pow(10,-a)/(s>=j0?10:s>=V0?5:s>=G0?2:1)}function H0(e,i,r){var n=Math.abs(i-e)/Math.max(0,r),a=Math.pow(10,Math.floor(Math.log(n)/Math.LN10)),s=n/a;return s>=j0?a*=10:s>=V0?a*=5:s>=G0&&(a*=2),i<e?-a:a}function nI(){var e=identity,i=extent,r=sturges;function n(a){var s,f=a.length,v,g=new Array(f);for(s=0;s<f;++s)g[s]=e(a[s],s,a);var x=i(g),C=x[0],T=x[1],O=r(g,C,T);Array.isArray(O)||(O=tickStep(C,T,O),O=range(Math.ceil(C/O)*O,T,O));for(var k=O.length;O[0]<=C;)O.shift(),--k;for(;O[k-1]>T;)O.pop(),--k;var j=new Array(k+1),X;for(s=0;s<=k;++s)X=j[s]=[],X.x0=s>0?O[s-1]:C,X.x1=s<k?O[s]:T;for(s=0;s<f;++s)v=g[s],C<=v&&v<=T&&j[bisect(O,v,0,k)].push(a[s]);return j}return n.value=function(a){return arguments.length?(e=typeof a=="function"?a:constant(a),n):e},n.domain=function(a){return arguments.length?(i=typeof a=="function"?a:constant([a[0],a[1]]),n):i},n.thresholds=function(a){return arguments.length?(r=typeof a=="function"?a:Array.isArray(a)?constant(slice.call(a)):constant(a),n):r},n}function iI(e,i,r){return e=map.call(e,number).sort(ascending),Math.ceil((r-i)/(2*(quantile(e,.75)-quantile(e,.25))*Math.pow(e.length,-1/3)))}function Vw(e){return e===null?NaN:+e}function Gw(e,i,r){if(r==null&&(r=Vw),!!(n=e.length)){if((i=+i)<=0||n<2)return+r(e[0],0,e);if(i>=1)return+r(e[n-1],n-1,e);var n,a=(n-1)*i,s=Math.floor(a),f=+r(e[s],s,e),v=+r(e[s+1],s+1,e);return f+(v-f)*(a-s)}}var Hw=U(87765),Mc="$";function Hv(){}Hv.prototype=f_.prototype={constructor:Hv,has:function(e){return Mc+e in this},get:function(e){return this[Mc+e]},set:function(e,i){return this[Mc+e]=i,this},remove:function(e){var i=Mc+e;return i in this&&delete this[i]},clear:function(){for(var e in this)e[0]===Mc&&delete this[e]},keys:function(){var e=[];for(var i in this)i[0]===Mc&&e.push(i.slice(1));return e},values:function(){var e=[];for(var i in this)i[0]===Mc&&e.push(this[i]);return e},entries:function(){var e=[];for(var i in this)i[0]===Mc&&e.push({key:i.slice(1),value:this[i]});return e},size:function(){var e=0;for(var i in this)i[0]===Mc&&++e;return e},empty:function(){for(var e in this)if(e[0]===Mc)return!1;return!0},each:function(e){for(var i in this)i[0]===Mc&&e(this[i],i.slice(1),this)}};function f_(e,i){var r=new Hv;if(e instanceof Hv)e.each(function(v,g){r.set(g,v)});else if(Array.isArray(e)){var n=-1,a=e.length,s;if(i==null)for(;++n<a;)r.set(n,e[n]);else for(;++n<a;)r.set(i(s=e[n],n,e),s)}else if(e)for(var f in e)r.set(f,e[f]);return r}var W0=f_;function aI(){var e=[],i=[],r,n,a;function s(v,g,x,C){if(g>=e.length)return r!=null&&v.sort(r),n!=null?n(v):v;for(var T=-1,O=v.length,k=e[g++],j,X,te=map(),be,Ne=x();++T<O;)(be=te.get(j=k(X=v[T])+""))?be.push(X):te.set(j,[X]);return te.each(function($e,ot){C(Ne,ot,s($e,g,x,C))}),Ne}function f(v,g){if(++g>e.length)return v;var x,C=i[g-1];return n!=null&&g>=e.length?x=v.entries():(x=[],v.each(function(T,O){x.push({key:O,values:f(T,g)})})),C!=null?x.sort(function(T,O){return C(T.key,O.key)}):x}return a={object:function(v){return s(v,0,Ww,Xw)},map:function(v){return s(v,0,h_,p_)},entries:function(v){return f(s(v,0,h_,p_),0)},key:function(v){return e.push(v),a},sortKeys:function(v){return i[e.length-1]=v,a},sortValues:function(v){return r=v,a},rollup:function(v){return n=v,a}}}function Ww(){return{}}function Xw(e,i,r){e[i]=r}function h_(){return map()}function p_(e,i,r){e.set(i,r)}function Wv(){}var Rp=W0.prototype;Wv.prototype=Yw.prototype={constructor:Wv,has:Rp.has,add:function(e){return e+="",this[Mc+e]=e,this},remove:Rp.remove,clear:Rp.clear,values:Rp.keys,size:Rp.size,empty:Rp.empty,each:Rp.each};function Yw(e,i){var r=new Wv;if(e instanceof Wv)e.each(function(s){r.add(s)});else if(e){var n=-1,a=e.length;if(i==null)for(;++n<a;)r.add(e[n]);else for(;++n<a;)r.add(i(e[n],n,e))}return r}var oI=null,d_=Array.prototype,Xv=d_.map,Lp=d_.slice;function Qh(e,i){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(i).domain(e);break}return this}function v_(e,i){switch(arguments.length){case 0:break;case 1:this.interpolator(e);break;default:this.interpolator(i).domain(e);break}return this}var m_={name:"implicit"};function Yv(){var e=W0(),i=[],r=[],n=m_;function a(s){var f=s+"",v=e.get(f);if(!v){if(n!==m_)return n;e.set(f,v=i.push(s))}return r[(v-1)%r.length]}return a.domain=function(s){if(!arguments.length)return i.slice();i=[],e=W0();for(var f=-1,v=s.length,g,x;++f<v;)e.has(x=(g=s[f])+"")||e.set(x,i.push(g));return a},a.range=function(s){return arguments.length?(r=Lp.call(s),a):r.slice()},a.unknown=function(s){return arguments.length?(n=s,a):n},a.copy=function(){return Yv(i,r).unknown(n)},Qh.apply(a,arguments),a}function g_(){var e=ordinal().unknown(void 0),i=e.domain,r=e.range,n=[0,1],a,s,f=!1,v=0,g=0,x=.5;delete e.unknown;function C(){var T=i().length,O=n[1]<n[0],k=n[O-0],j=n[1-O];a=(j-k)/Math.max(1,T-v+g*2),f&&(a=Math.floor(a)),k+=(j-k-a*(T-v))*x,s=a*(1-v),f&&(k=Math.round(k),s=Math.round(s));var X=sequence(T).map(function(te){return k+a*te});return r(O?X.reverse():X)}return e.domain=function(T){return arguments.length?(i(T),C()):i()},e.range=function(T){return arguments.length?(n=[+T[0],+T[1]],C()):n.slice()},e.rangeRound=function(T){return n=[+T[0],+T[1]],f=!0,C()},e.bandwidth=function(){return s},e.step=function(){return a},e.round=function(T){return arguments.length?(f=!!T,C()):f},e.padding=function(T){return arguments.length?(v=Math.min(1,g=+T),C()):v},e.paddingInner=function(T){return arguments.length?(v=Math.min(1,T),C()):v},e.paddingOuter=function(T){return arguments.length?(g=+T,C()):g},e.align=function(T){return arguments.length?(x=Math.max(0,Math.min(1,T)),C()):x},e.copy=function(){return g_(i(),n).round(f).paddingInner(v).paddingOuter(g).align(x)},initRange.apply(C(),arguments)}function y_(e){var i=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return y_(i())},e}function sI(){return y_(g_.apply(null,arguments).paddingInner(1))}var qw=U(21775),Kw=U(73626);function $w(e,i){return e=+e,i=+i,function(r){return Math.round(e*(1-r)+i*r)}}function Qw(e){return function(){return e}}function X0(e){return+e}var __=[0,1];function el(e){return e}function Y0(e,i){return(i-=e=+e)?function(r){return(r-e)/i}:Qw(isNaN(i)?NaN:.5)}function x_(e){var i=e[0],r=e[e.length-1],n;return i>r&&(n=i,i=r,r=n),function(a){return Math.max(i,Math.min(r,a))}}function Jw(e,i,r){var n=e[0],a=e[1],s=i[0],f=i[1];return a<n?(n=Y0(a,n),s=r(f,s)):(n=Y0(n,a),s=r(s,f)),function(v){return s(n(v))}}function eT(e,i,r){var n=Math.min(e.length,i.length)-1,a=new Array(n),s=new Array(n),f=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),i=i.slice().reverse());++f<n;)a[f]=Y0(e[f],e[f+1]),s[f]=r(i[f],i[f+1]);return function(v){var g=Vv(e,v,1,n)-1;return s[g](a[g](v))}}function qv(e,i){return i.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function q0(){var e=__,i=__,r=qw.Z,n,a,s,f=el,v,g,x;function C(){return v=Math.min(e.length,i.length)>2?eT:Jw,g=x=null,T}function T(O){return isNaN(O=+O)?s:(g||(g=v(e.map(n),i,r)))(n(f(O)))}return T.invert=function(O){return f(a((x||(x=v(i,e.map(n),Kw.Z)))(O)))},T.domain=function(O){return arguments.length?(e=Xv.call(O,X0),f===el||(f=x_(e)),C()):e.slice()},T.range=function(O){return arguments.length?(i=Lp.call(O),C()):i.slice()},T.rangeRound=function(O){return i=Lp.call(O),r=$w,C()},T.clamp=function(O){return arguments.length?(f=O?x_(e):el,T):f!==el},T.interpolate=function(O){return arguments.length?(r=O,C()):r},T.unknown=function(O){return arguments.length?(s=O,T):s},function(O,k){return n=O,a=k,C()}}function b_(e,i){return q0()(e,i)}var tT=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Kv(e){if(!(i=tT.exec(e)))throw new Error("invalid format: "+e);var i;return new K0({fill:i[1],align:i[2],sign:i[3],symbol:i[4],zero:i[5],width:i[6],comma:i[7],precision:i[8]&&i[8].slice(1),trim:i[9],type:i[10]})}Kv.prototype=K0.prototype;function K0(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}K0.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function rT(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function $v(e,i){if((r=(e=i?e.toExponential(i-1):e.toExponential()).indexOf("e"))<0)return null;var r,n=e.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+e.slice(r+1)]}function yd(e){return e=$v(Math.abs(e)),e?e[1]:NaN}function nT(e,i){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(yd(i)/3)))*3-yd(Math.abs(e)))}function iT(e,i){return function(r,n){for(var a=r.length,s=[],f=0,v=e[0],g=0;a>0&&v>0&&(g+v+1>n&&(v=Math.max(1,n-g)),s.push(r.substring(a-=v,a+v)),!((g+=v+1)>n));)v=e[f=(f+1)%e.length];return s.reverse().join(i)}}function aT(e){return function(i){return i.replace(/[0-9]/g,function(r){return e[+r]})}}function oT(e){e:for(var i=e.length,r=1,n=-1,a;r<i;++r)switch(e[r]){case".":n=a=r;break;case"0":n===0&&(n=r),a=r;break;default:if(!+e[r])break e;n>0&&(n=0);break}return n>0?e.slice(0,n)+e.slice(a+1):e}var E_;function sT(e,i){var r=$v(e,i);if(!r)return e+"";var n=r[0],a=r[1],s=a-(E_=Math.max(-8,Math.min(8,Math.floor(a/3)))*3)+1,f=n.length;return s===f?n:s>f?n+new Array(s-f+1).join("0"):s>0?n.slice(0,s)+"."+n.slice(s):"0."+new Array(1-s).join("0")+$v(e,Math.max(0,i+s-1))[0]}function S_(e,i){var r=$v(e,i);if(!r)return e+"";var n=r[0],a=r[1];return a<0?"0."+new Array(-a).join("0")+n:n.length>a+1?n.slice(0,a+1)+"."+n.slice(a+1):n+new Array(a-n.length+2).join("0")}var C_={"%":function(e,i){return(e*100).toFixed(i)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:rT,e:function(e,i){return e.toExponential(i)},f:function(e,i){return e.toFixed(i)},g:function(e,i){return e.toPrecision(i)},o:function(e){return Math.round(e).toString(8)},p:function(e,i){return S_(e*100,i)},r:S_,s:sT,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function A_(e){return e}var w_=Array.prototype.map,T_=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function uT(e){var i=e.grouping===void 0||e.thousands===void 0?A_:iT(w_.call(e.grouping,Number),e.thousands+""),r=e.currency===void 0?"":e.currency[0]+"",n=e.currency===void 0?"":e.currency[1]+"",a=e.decimal===void 0?".":e.decimal+"",s=e.numerals===void 0?A_:aT(w_.call(e.numerals,String)),f=e.percent===void 0?"%":e.percent+"",v=e.minus===void 0?"-":e.minus+"",g=e.nan===void 0?"NaN":e.nan+"";function x(T){T=Kv(T);var O=T.fill,k=T.align,j=T.sign,X=T.symbol,te=T.zero,be=T.width,Ne=T.comma,$e=T.precision,ot=T.trim,bt=T.type;bt==="n"?(Ne=!0,bt="g"):C_[bt]||($e===void 0&&($e=12),ot=!0,bt="g"),(te||O==="0"&&k==="=")&&(te=!0,O="0",k="=");var _t=X==="$"?r:X==="#"&&/[boxX]/.test(bt)?"0"+bt.toLowerCase():"",qt=X==="$"?n:/[%p]/.test(bt)?f:"",ar=C_[bt],Pr=/[defgprs%]/.test(bt);$e=$e===void 0?6:/[gprs]/.test(bt)?Math.max(1,Math.min(21,$e)):Math.max(0,Math.min(20,$e));function qr(gr){var un=_t,Ln=qt,Vn,Fa,Ro;if(bt==="c")Ln=ar(gr)+Ln,gr="";else{gr=+gr;var Ls=gr<0||1/gr<0;if(gr=isNaN(gr)?g:ar(Math.abs(gr),$e),ot&&(gr=oT(gr)),Ls&&+gr==0&&j!=="+"&&(Ls=!1),un=(Ls?j==="("?j:v:j==="-"||j==="("?"":j)+un,Ln=(bt==="s"?T_[8+E_/3]:"")+Ln+(Ls&&j==="("?")":""),Pr){for(Vn=-1,Fa=gr.length;++Vn<Fa;)if(Ro=gr.charCodeAt(Vn),48>Ro||Ro>57){Ln=(Ro===46?a+gr.slice(Vn+1):gr.slice(Vn))+Ln,gr=gr.slice(0,Vn);break}}}Ne&&!te&&(gr=i(gr,Infinity));var au=un.length+gr.length+Ln.length,Vs=au<be?new Array(be-au+1).join(O):"";switch(Ne&&te&&(gr=i(Vs+gr,Vs.length?be-Ln.length:Infinity),Vs=""),k){case"<":gr=un+gr+Ln+Vs;break;case"=":gr=un+Vs+gr+Ln;break;case"^":gr=Vs.slice(0,au=Vs.length>>1)+un+gr+Ln+Vs.slice(au);break;default:gr=Vs+un+gr+Ln;break}return s(gr)}return qr.toString=function(){return T+""},qr}function C(T,O){var k=x((T=Kv(T),T.type="f",T)),j=Math.max(-8,Math.min(8,Math.floor(yd(O)/3)))*3,X=Math.pow(10,-j),te=T_[8+j/3];return function(be){return k(X*be)+te}}return{format:x,formatPrefix:C}}var Qv,$0,M_;lT({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function lT(e){return Qv=uT(e),$0=Qv.format,M_=Qv.formatPrefix,Qv}function cT(e,i){return e=Math.abs(e),i=Math.abs(i)-e,Math.max(0,yd(i)-yd(e))+1}function fT(e){return Math.max(0,-yd(Math.abs(e)))}function hT(e,i,r,n){var a=H0(e,i,r),s;switch(n=Kv(n==null?",f":n),n.type){case"s":{var f=Math.max(Math.abs(e),Math.abs(i));return n.precision==null&&!isNaN(s=nT(a,f))&&(n.precision=s),M_(n,f)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(s=cT(a,Math.max(Math.abs(e),Math.abs(i))))&&(n.precision=s-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(s=fT(a))&&(n.precision=s-(n.type==="%")*2);break}}return $0(n)}function _d(e){var i=e.domain;return e.ticks=function(r){var n=i();return c_(n[0],n[n.length-1],r==null?10:r)},e.tickFormat=function(r,n){var a=i();return hT(a[0],a[a.length-1],r==null?10:r,n)},e.nice=function(r){r==null&&(r=10);var n=i(),a=0,s=n.length-1,f=n[a],v=n[s],g;return v<f&&(g=f,f=v,v=g,g=a,a=s,s=g),g=Gv(f,v,r),g>0?(f=Math.floor(f/g)*g,v=Math.ceil(v/g)*g,g=Gv(f,v,r)):g<0&&(f=Math.ceil(f*g)/g,v=Math.floor(v*g)/g,g=Gv(f,v,r)),g>0?(n[a]=Math.floor(f/g)*g,n[s]=Math.ceil(v/g)*g,i(n)):g<0&&(n[a]=Math.ceil(f*g)/g,n[s]=Math.floor(v*g)/g,i(n)),e},e}function P_(){var e=b_(el,el);return e.copy=function(){return qv(e,P_())},Qh.apply(e,arguments),_d(e)}function I_(e){var i;function r(n){return isNaN(n=+n)?i:n}return r.invert=r,r.domain=r.range=function(n){return arguments.length?(e=Xv.call(n,X0),r):e.slice()},r.unknown=function(n){return arguments.length?(i=n,r):i},r.copy=function(){return I_(e).unknown(i)},e=arguments.length?Xv.call(e,X0):[0,1],_d(r)}function O_(e,i){e=e.slice();var r=0,n=e.length-1,a=e[r],s=e[n],f;return s<a&&(f=r,r=n,n=f,f=a,a=s,s=f),e[r]=i.floor(a),e[n]=i.ceil(s),e}function R_(e){return Math.log(e)}function L_(e){return Math.exp(e)}function pT(e){return-Math.log(-e)}function dT(e){return-Math.exp(-e)}function vT(e){return isFinite(e)?+("1e"+e):e<0?0:e}function mT(e){return e===10?vT:e===Math.E?Math.exp:function(i){return Math.pow(e,i)}}function gT(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),function(i){return Math.log(i)/e})}function k_(e){return function(i){return-e(-i)}}function yT(e){var i=e(R_,L_),r=i.domain,n=10,a,s;function f(){return a=gT(n),s=mT(n),r()[0]<0?(a=k_(a),s=k_(s),e(pT,dT)):e(R_,L_),i}return i.base=function(v){return arguments.length?(n=+v,f()):n},i.domain=function(v){return arguments.length?(r(v),f()):r()},i.ticks=function(v){var g=r(),x=g[0],C=g[g.length-1],T;(T=C<x)&&(O=x,x=C,C=O);var O=a(x),k=a(C),j,X,te,be=v==null?10:+v,Ne=[];if(!(n%1)&&k-O<be){if(O=Math.round(O)-1,k=Math.round(k)+1,x>0){for(;O<k;++O)for(X=1,j=s(O);X<n;++X)if(te=j*X,!(te<x)){if(te>C)break;Ne.push(te)}}else for(;O<k;++O)for(X=n-1,j=s(O);X>=1;--X)if(te=j*X,!(te<x)){if(te>C)break;Ne.push(te)}}else Ne=c_(O,k,Math.min(k-O,be)).map(s);return T?Ne.reverse():Ne},i.tickFormat=function(v,g){if(g==null&&(g=n===10?".0e":","),typeof g!="function"&&(g=$0(g)),v===Infinity)return g;v==null&&(v=10);var x=Math.max(1,n*v/i.ticks().length);return function(C){var T=C/s(Math.round(a(C)));return T*n<n-.5&&(T*=n),T<=x?g(C):""}},i.nice=function(){return r(O_(r(),{floor:function(v){return s(Math.floor(a(v)))},ceil:function(v){return s(Math.ceil(a(v)))}}))},i}function D_(){var e=yT(q0()).domain([1,10]);return e.copy=function(){return qv(e,D_()).base(e.base())},Qh.apply(e,arguments),e}function F_(e){return function(i){return Math.sign(i)*Math.log1p(Math.abs(i/e))}}function B_(e){return function(i){return Math.sign(i)*Math.expm1(Math.abs(i))*e}}function _T(e){var i=1,r=e(F_(i),B_(i));return r.constant=function(n){return arguments.length?e(F_(i=+n),B_(i)):i},linearish(r)}function xT(){var e=_T(transformer());return e.copy=function(){return copy(e,xT()).constant(e.constant())},initRange.apply(e,arguments)}function N_(e){return function(i){return i<0?-Math.pow(-i,e):Math.pow(i,e)}}function bT(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function ET(e){return e<0?-e*e:e*e}function ST(e){var i=e(el,el),r=1;function n(){return r===1?e(el,el):r===.5?e(bT,ET):e(N_(r),N_(1/r))}return i.exponent=function(a){return arguments.length?(r=+a,n()):r},_d(i)}function Q0(){var e=ST(q0());return e.copy=function(){return qv(e,Q0()).exponent(e.exponent())},Qh.apply(e,arguments),e}function uI(){return Q0.apply(null,arguments).exponent(.5)}function z_(){var e=[],i=[],r=[],n;function a(){var f=0,v=Math.max(1,i.length);for(r=new Array(v-1);++f<v;)r[f-1]=Gw(e,f/v);return s}function s(f){return isNaN(f=+f)?n:i[Vv(r,f)]}return s.invertExtent=function(f){var v=i.indexOf(f);return v<0?[NaN,NaN]:[v>0?r[v-1]:e[0],v<r.length?r[v]:e[e.length-1]]},s.domain=function(f){if(!arguments.length)return e.slice();e=[];for(var v=0,g=f.length,x;v<g;++v)x=f[v],x!=null&&!isNaN(x=+x)&&e.push(x);return e.sort(Z0),a()},s.range=function(f){return arguments.length?(i=Lp.call(f),a()):i.slice()},s.unknown=function(f){return arguments.length?(n=f,s):n},s.quantiles=function(){return r.slice()},s.copy=function(){return z_().domain(e).range(i).unknown(n)},Qh.apply(s,arguments)}function U_(){var e=0,i=1,r=1,n=[.5],a=[0,1],s;function f(g){return g<=g?a[Vv(n,g,0,r)]:s}function v(){var g=-1;for(n=new Array(r);++g<r;)n[g]=((g+1)*i-(g-r)*e)/(r+1);return f}return f.domain=function(g){return arguments.length?(e=+g[0],i=+g[1],v()):[e,i]},f.range=function(g){return arguments.length?(r=(a=Lp.call(g)).length-1,v()):a.slice()},f.invertExtent=function(g){var x=a.indexOf(g);return x<0?[NaN,NaN]:x<1?[e,n[0]]:x>=r?[n[r-1],i]:[n[x-1],n[x]]},f.unknown=function(g){return arguments.length&&(s=g),f},f.thresholds=function(){return n.slice()},f.copy=function(){return U_().domain([e,i]).range(a).unknown(s)},Qh.apply(_d(f),arguments)}function Z_(){var e=[.5],i=[0,1],r,n=1;function a(s){return s<=s?i[Vv(e,s,0,n)]:r}return a.domain=function(s){return arguments.length?(e=Lp.call(s),n=Math.min(e.length,i.length-1),a):e.slice()},a.range=function(s){return arguments.length?(i=Lp.call(s),n=Math.min(e.length,i.length-1),a):i.slice()},a.invertExtent=function(s){var f=i.indexOf(s);return[e[f-1],e[f]]},a.unknown=function(s){return arguments.length?(r=s,a):r},a.copy=function(){return Z_().domain(e).range(i).unknown(r)},Qh.apply(a,arguments)}var J0=new Date,em=new Date;function ul(e,i,r,n){function a(s){return e(s=arguments.length===0?new Date:new Date(+s)),s}return a.floor=function(s){return e(s=new Date(+s)),s},a.ceil=function(s){return e(s=new Date(s-1)),i(s,1),e(s),s},a.round=function(s){var f=a(s),v=a.ceil(s);return s-f<v-s?f:v},a.offset=function(s,f){return i(s=new Date(+s),f==null?1:Math.floor(f)),s},a.range=function(s,f,v){var g=[],x;if(s=a.ceil(s),v=v==null?1:Math.floor(v),!(s<f)||!(v>0))return g;do g.push(x=new Date(+s)),i(s,v),e(s);while(x<s&&s<f);return g},a.filter=function(s){return ul(function(f){if(f>=f)for(;e(f),!s(f);)f.setTime(f-1)},function(f,v){if(f>=f)if(v<0)for(;++v<=0;)for(;i(f,-1),!s(f););else for(;--v>=0;)for(;i(f,1),!s(f););})},r&&(a.count=function(s,f){return J0.setTime(+s),em.setTime(+f),e(J0),e(em),Math.floor(r(J0,em))},a.every=function(s){return s=Math.floor(s),!isFinite(s)||!(s>0)?null:s>1?a.filter(n?function(f){return n(f)%s==0}:function(f){return a.count(0,f)%s==0}):a}),a}var tm=ul(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,i){e.setFullYear(e.getFullYear()+i)},function(e,i){return i.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});tm.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:ul(function(i){i.setFullYear(Math.floor(i.getFullYear()/e)*e),i.setMonth(0,1),i.setHours(0,0,0,0)},function(i,r){i.setFullYear(i.getFullYear()+r*e)})};var xd=tm,lI=tm.range,j_=ul(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,i){e.setMonth(e.getMonth()+i)},function(e,i){return i.getMonth()-e.getMonth()+(i.getFullYear()-e.getFullYear())*12},function(e){return e.getMonth()}),CT=j_,cI=j_.range,Jv=1e3,lv=6e4,V_=36e5,G_=864e5,H_=6048e5;function kp(e){return ul(function(i){i.setDate(i.getDate()-(i.getDay()+7-e)%7),i.setHours(0,0,0,0)},function(i,r){i.setDate(i.getDate()+r*7)},function(i,r){return(r-i-(r.getTimezoneOffset()-i.getTimezoneOffset())*lv)/H_})}var rm=kp(0),e0=kp(1),AT=kp(2),wT=kp(3),bd=kp(4),TT=kp(5),MT=kp(6),fI=rm.range,hI=e0.range,pI=AT.range,dI=wT.range,vI=bd.range,mI=TT.range,gI=MT.range,W_=ul(function(e){e.setHours(0,0,0,0)},function(e,i){e.setDate(e.getDate()+i)},function(e,i){return(i-e-(i.getTimezoneOffset()-e.getTimezoneOffset())*lv)/G_},function(e){return e.getDate()-1}),nm=W_,yI=W_.range,X_=ul(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*Jv-e.getMinutes()*lv)},function(e,i){e.setTime(+e+i*V_)},function(e,i){return(i-e)/V_},function(e){return e.getHours()}),PT=X_,_I=X_.range,Y_=ul(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*Jv)},function(e,i){e.setTime(+e+i*lv)},function(e,i){return(i-e)/lv},function(e){return e.getMinutes()}),IT=Y_,xI=Y_.range,q_=ul(function(e){e.setTime(e-e.getMilliseconds())},function(e,i){e.setTime(+e+i*Jv)},function(e,i){return(i-e)/Jv},function(e){return e.getUTCSeconds()}),OT=q_,bI=q_.range,t0=ul(function(){},function(e,i){e.setTime(+e+i)},function(e,i){return i-e});t0.every=function(e){return e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?ul(function(i){i.setTime(Math.floor(i/e)*e)},function(i,r){i.setTime(+i+r*e)},function(i,r){return(r-i)/e}):t0};var RT=t0,EI=t0.range;function Dp(e){return ul(function(i){i.setUTCDate(i.getUTCDate()-(i.getUTCDay()+7-e)%7),i.setUTCHours(0,0,0,0)},function(i,r){i.setUTCDate(i.getUTCDate()+r*7)},function(i,r){return(r-i)/H_})}var K_=Dp(0),r0=Dp(1),LT=Dp(2),kT=Dp(3),Ed=Dp(4),DT=Dp(5),FT=Dp(6),SI=K_.range,CI=r0.range,AI=LT.range,wI=kT.range,TI=Ed.range,MI=DT.range,PI=FT.range,$_=ul(function(e){e.setUTCHours(0,0,0,0)},function(e,i){e.setUTCDate(e.getUTCDate()+i)},function(e,i){return(i-e)/G_},function(e){return e.getUTCDate()-1}),Q_=$_,II=$_.range,im=ul(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,i){e.setUTCFullYear(e.getUTCFullYear()+i)},function(e,i){return i.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});im.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:ul(function(i){i.setUTCFullYear(Math.floor(i.getUTCFullYear()/e)*e),i.setUTCMonth(0,1),i.setUTCHours(0,0,0,0)},function(i,r){i.setUTCFullYear(i.getUTCFullYear()+r*e)})};var cv=im,OI=im.range;function am(e){if(0<=e.y&&e.y<100){var i=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return i.setFullYear(e.y),i}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function om(e){if(0<=e.y&&e.y<100){var i=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return i.setUTCFullYear(e.y),i}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function fv(e,i,r){return{y:e,m:i,d:r,H:0,M:0,S:0,L:0}}function BT(e){var i=e.dateTime,r=e.date,n=e.time,a=e.periods,s=e.days,f=e.shortDays,v=e.months,g=e.shortMonths,x=hv(a),C=pv(a),T=hv(s),O=pv(s),k=hv(f),j=pv(f),X=hv(v),te=pv(v),be=hv(g),Ne=pv(g),$e={a:Ls,A:au,b:Vs,B:Oc,c:null,d:i1,e:i1,f:oM,g:mM,G:yM,H:nM,I:iM,j:aM,L:a1,m:sM,M:uM,p:gm,q:g0,Q:f1,s:h1,S:lM,u:cM,U:fM,V:hM,w:pM,W:dM,x:null,X:null,y:vM,Y:gM,Z:_M,"%":c1},ot={a:bP,A:EP,b:SP,B:CP,c:null,d:s1,e:s1,f:SM,g:LM,G:DM,H:xM,I:bM,j:EM,L:u1,m:CM,M:AM,p:AP,q:wP,Q:f1,s:h1,S:wM,u:TM,U:MM,V:PM,w:IM,W:OM,x:null,X:null,y:RM,Y:kM,Z:FM,"%":c1},bt={a:qr,A:gr,b:un,B:Ln,c:Vn,d:r1,e:r1,f:JT,g:t1,G:e1,H:n1,I:n1,j:qT,L:QT,m:YT,M:KT,p:Pr,q:XT,Q:tM,s:rM,S:$T,u:jT,U:VT,V:GT,w:ZT,W:HT,x:Fa,X:Ro,y:t1,Y:e1,Z:WT,"%":eM};$e.x=_t(r,$e),$e.X=_t(n,$e),$e.c=_t(i,$e),ot.x=_t(r,ot),ot.X=_t(n,ot),ot.c=_t(i,ot);function _t(ci,Oa){return function(eo){var _n=[],Pl=-1,qo=0,ec=ci.length,tc,Np,hb;for(eo instanceof Date||(eo=new Date(+eo));++Pl<ec;)ci.charCodeAt(Pl)===37&&(_n.push(ci.slice(qo,Pl)),(Np=J_[tc=ci.charAt(++Pl)])!=null?tc=ci.charAt(++Pl):Np=tc==="e"?" ":"0",(hb=Oa[tc])&&(tc=hb(eo,Np)),_n.push(tc),qo=Pl+1);return _n.push(ci.slice(qo,Pl)),_n.join("")}}function qt(ci,Oa){return function(eo){var _n=fv(1900,void 0,1),Pl=ar(_n,ci,eo+="",0),qo,ec;if(Pl!=eo.length)return null;if("Q"in _n)return new Date(_n.Q);if("s"in _n)return new Date(_n.s*1e3+("L"in _n?_n.L:0));if(Oa&&!("Z"in _n)&&(_n.Z=0),"p"in _n&&(_n.H=_n.H%12+_n.p*12),_n.m===void 0&&(_n.m="q"in _n?_n.q:0),"V"in _n){if(_n.V<1||_n.V>53)return null;"w"in _n||(_n.w=1),"Z"in _n?(qo=om(fv(_n.y,0,1)),ec=qo.getUTCDay(),qo=ec>4||ec===0?r0.ceil(qo):r0(qo),qo=Q_.offset(qo,(_n.V-1)*7),_n.y=qo.getUTCFullYear(),_n.m=qo.getUTCMonth(),_n.d=qo.getUTCDate()+(_n.w+6)%7):(qo=am(fv(_n.y,0,1)),ec=qo.getDay(),qo=ec>4||ec===0?e0.ceil(qo):e0(qo),qo=nm.offset(qo,(_n.V-1)*7),_n.y=qo.getFullYear(),_n.m=qo.getMonth(),_n.d=qo.getDate()+(_n.w+6)%7)}else("W"in _n||"U"in _n)&&("w"in _n||(_n.w="u"in _n?_n.u%7:"W"in _n?1:0),ec="Z"in _n?om(fv(_n.y,0,1)).getUTCDay():am(fv(_n.y,0,1)).getDay(),_n.m=0,_n.d="W"in _n?(_n.w+6)%7+_n.W*7-(ec+5)%7:_n.w+_n.U*7-(ec+6)%7);return"Z"in _n?(_n.H+=_n.Z/100|0,_n.M+=_n.Z%100,om(_n)):am(_n)}}function ar(ci,Oa,eo,_n){for(var Pl=0,qo=Oa.length,ec=eo.length,tc,Np;Pl<qo;){if(_n>=ec)return-1;if(tc=Oa.charCodeAt(Pl++),tc===37){if(tc=Oa.charAt(Pl++),Np=bt[tc in J_?Oa.charAt(Pl++):tc],!Np||(_n=Np(ci,eo,_n))<0)return-1}else if(tc!=eo.charCodeAt(_n++))return-1}return _n}function Pr(ci,Oa,eo){var _n=x.exec(Oa.slice(eo));return _n?(ci.p=C[_n[0].toLowerCase()],eo+_n[0].length):-1}function qr(ci,Oa,eo){var _n=k.exec(Oa.slice(eo));return _n?(ci.w=j[_n[0].toLowerCase()],eo+_n[0].length):-1}function gr(ci,Oa,eo){var _n=T.exec(Oa.slice(eo));return _n?(ci.w=O[_n[0].toLowerCase()],eo+_n[0].length):-1}function un(ci,Oa,eo){var _n=be.exec(Oa.slice(eo));return _n?(ci.m=Ne[_n[0].toLowerCase()],eo+_n[0].length):-1}function Ln(ci,Oa,eo){var _n=X.exec(Oa.slice(eo));return _n?(ci.m=te[_n[0].toLowerCase()],eo+_n[0].length):-1}function Vn(ci,Oa,eo){return ar(ci,i,Oa,eo)}function Fa(ci,Oa,eo){return ar(ci,r,Oa,eo)}function Ro(ci,Oa,eo){return ar(ci,n,Oa,eo)}function Ls(ci){return f[ci.getDay()]}function au(ci){return s[ci.getDay()]}function Vs(ci){return g[ci.getMonth()]}function Oc(ci){return v[ci.getMonth()]}function gm(ci){return a[+(ci.getHours()>=12)]}function g0(ci){return 1+~~(ci.getMonth()/3)}function bP(ci){return f[ci.getUTCDay()]}function EP(ci){return s[ci.getUTCDay()]}function SP(ci){return g[ci.getUTCMonth()]}function CP(ci){return v[ci.getUTCMonth()]}function AP(ci){return a[+(ci.getUTCHours()>=12)]}function wP(ci){return 1+~~(ci.getUTCMonth()/3)}return{format:function(ci){var Oa=_t(ci+="",$e);return Oa.toString=function(){return ci},Oa},parse:function(ci){var Oa=qt(ci+="",!1);return Oa.toString=function(){return ci},Oa},utcFormat:function(ci){var Oa=_t(ci+="",ot);return Oa.toString=function(){return ci},Oa},utcParse:function(ci){var Oa=qt(ci+="",!0);return Oa.toString=function(){return ci},Oa}}}var J_={"-":"",_:" ","0":"0"},_u=/^\s*\d+/,NT=/^%/,zT=/[\\^$*+?|[\]().{}]/g;function Ja(e,i,r){var n=e<0?"-":"",a=(n?-e:e)+"",s=a.length;return n+(s<r?new Array(r-s+1).join(i)+a:a)}function UT(e){return e.replace(zT,"\\$&")}function hv(e){return new RegExp("^(?:"+e.map(UT).join("|")+")","i")}function pv(e){for(var i={},r=-1,n=e.length;++r<n;)i[e[r].toLowerCase()]=r;return i}function ZT(e,i,r){var n=_u.exec(i.slice(r,r+1));return n?(e.w=+n[0],r+n[0].length):-1}function jT(e,i,r){var n=_u.exec(i.slice(r,r+1));return n?(e.u=+n[0],r+n[0].length):-1}function VT(e,i,r){var n=_u.exec(i.slice(r,r+2));return n?(e.U=+n[0],r+n[0].length):-1}function GT(e,i,r){var n=_u.exec(i.slice(r,r+2));return n?(e.V=+n[0],r+n[0].length):-1}function HT(e,i,r){var n=_u.exec(i.slice(r,r+2));return n?(e.W=+n[0],r+n[0].length):-1}function e1(e,i,r){var n=_u.exec(i.slice(r,r+4));return n?(e.y=+n[0],r+n[0].length):-1}function t1(e,i,r){var n=_u.exec(i.slice(r,r+2));return n?(e.y=+n[0]+(+n[0]>68?1900:2e3),r+n[0].length):-1}function WT(e,i,r){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(i.slice(r,r+6));return n?(e.Z=n[1]?0:-(n[2]+(n[3]||"00")),r+n[0].length):-1}function XT(e,i,r){var n=_u.exec(i.slice(r,r+1));return n?(e.q=n[0]*3-3,r+n[0].length):-1}function YT(e,i,r){var n=_u.exec(i.slice(r,r+2));return n?(e.m=n[0]-1,r+n[0].length):-1}function r1(e,i,r){var n=_u.exec(i.slice(r,r+2));return n?(e.d=+n[0],r+n[0].length):-1}function qT(e,i,r){var n=_u.exec(i.slice(r,r+3));return n?(e.m=0,e.d=+n[0],r+n[0].length):-1}function n1(e,i,r){var n=_u.exec(i.slice(r,r+2));return n?(e.H=+n[0],r+n[0].length):-1}function KT(e,i,r){var n=_u.exec(i.slice(r,r+2));return n?(e.M=+n[0],r+n[0].length):-1}function $T(e,i,r){var n=_u.exec(i.slice(r,r+2));return n?(e.S=+n[0],r+n[0].length):-1}function QT(e,i,r){var n=_u.exec(i.slice(r,r+3));return n?(e.L=+n[0],r+n[0].length):-1}function JT(e,i,r){var n=_u.exec(i.slice(r,r+6));return n?(e.L=Math.floor(n[0]/1e3),r+n[0].length):-1}function eM(e,i,r){var n=NT.exec(i.slice(r,r+1));return n?r+n[0].length:-1}function tM(e,i,r){var n=_u.exec(i.slice(r));return n?(e.Q=+n[0],r+n[0].length):-1}function rM(e,i,r){var n=_u.exec(i.slice(r));return n?(e.s=+n[0],r+n[0].length):-1}function i1(e,i){return Ja(e.getDate(),i,2)}function nM(e,i){return Ja(e.getHours(),i,2)}function iM(e,i){return Ja(e.getHours()%12||12,i,2)}function aM(e,i){return Ja(1+nm.count(xd(e),e),i,3)}function a1(e,i){return Ja(e.getMilliseconds(),i,3)}function oM(e,i){return a1(e,i)+"000"}function sM(e,i){return Ja(e.getMonth()+1,i,2)}function uM(e,i){return Ja(e.getMinutes(),i,2)}function lM(e,i){return Ja(e.getSeconds(),i,2)}function cM(e){var i=e.getDay();return i===0?7:i}function fM(e,i){return Ja(rm.count(xd(e)-1,e),i,2)}function o1(e){var i=e.getDay();return i>=4||i===0?bd(e):bd.ceil(e)}function hM(e,i){return e=o1(e),Ja(bd.count(xd(e),e)+(xd(e).getDay()===4),i,2)}function pM(e){return e.getDay()}function dM(e,i){return Ja(e0.count(xd(e)-1,e),i,2)}function vM(e,i){return Ja(e.getFullYear()%100,i,2)}function mM(e,i){return e=o1(e),Ja(e.getFullYear()%100,i,2)}function gM(e,i){return Ja(e.getFullYear()%1e4,i,4)}function yM(e,i){var r=e.getDay();return e=r>=4||r===0?bd(e):bd.ceil(e),Ja(e.getFullYear()%1e4,i,4)}function _M(e){var i=e.getTimezoneOffset();return(i>0?"-":(i*=-1,"+"))+Ja(i/60|0,"0",2)+Ja(i%60,"0",2)}function s1(e,i){return Ja(e.getUTCDate(),i,2)}function xM(e,i){return Ja(e.getUTCHours(),i,2)}function bM(e,i){return Ja(e.getUTCHours()%12||12,i,2)}function EM(e,i){return Ja(1+Q_.count(cv(e),e),i,3)}function u1(e,i){return Ja(e.getUTCMilliseconds(),i,3)}function SM(e,i){return u1(e,i)+"000"}function CM(e,i){return Ja(e.getUTCMonth()+1,i,2)}function AM(e,i){return Ja(e.getUTCMinutes(),i,2)}function wM(e,i){return Ja(e.getUTCSeconds(),i,2)}function TM(e){var i=e.getUTCDay();return i===0?7:i}function MM(e,i){return Ja(K_.count(cv(e)-1,e),i,2)}function l1(e){var i=e.getUTCDay();return i>=4||i===0?Ed(e):Ed.ceil(e)}function PM(e,i){return e=l1(e),Ja(Ed.count(cv(e),e)+(cv(e).getUTCDay()===4),i,2)}function IM(e){return e.getUTCDay()}function OM(e,i){return Ja(r0.count(cv(e)-1,e),i,2)}function RM(e,i){return Ja(e.getUTCFullYear()%100,i,2)}function LM(e,i){return e=l1(e),Ja(e.getUTCFullYear()%100,i,2)}function kM(e,i){return Ja(e.getUTCFullYear()%1e4,i,4)}function DM(e,i){var r=e.getUTCDay();return e=r>=4||r===0?Ed(e):Ed.ceil(e),Ja(e.getUTCFullYear()%1e4,i,4)}function FM(){return"+0000"}function c1(){return"%"}function f1(e){return+e}function h1(e){return Math.floor(+e/1e3)}var Sd,p1,BM,NM,zM;UM({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function UM(e){return Sd=BT(e),p1=Sd.format,BM=Sd.parse,NM=Sd.utcFormat,zM=Sd.utcParse,Sd}var dv=1e3,vv=dv*60,mv=vv*60,gv=mv*24,ZM=gv*7,d1=gv*30,sm=gv*365;function jM(e){return new Date(e)}function VM(e){return e instanceof Date?+e:+new Date(+e)}function v1(e,i,r,n,a,s,f,v,g){var x=b_(el,el),C=x.invert,T=x.domain,O=g(".%L"),k=g(":%S"),j=g("%I:%M"),X=g("%I %p"),te=g("%a %d"),be=g("%b %d"),Ne=g("%B"),$e=g("%Y"),ot=[[f,1,dv],[f,5,5*dv],[f,15,15*dv],[f,30,30*dv],[s,1,vv],[s,5,5*vv],[s,15,15*vv],[s,30,30*vv],[a,1,mv],[a,3,3*mv],[a,6,6*mv],[a,12,12*mv],[n,1,gv],[n,2,2*gv],[r,1,ZM],[i,1,d1],[i,3,3*d1],[e,1,sm]];function bt(qt){return(f(qt)<qt?O:s(qt)<qt?k:a(qt)<qt?j:n(qt)<qt?X:i(qt)<qt?r(qt)<qt?te:be:e(qt)<qt?Ne:$e)(qt)}function _t(qt,ar,Pr,qr){if(qt==null&&(qt=10),typeof qt=="number"){var gr=Math.abs(Pr-ar)/qt,un=o_(function(Ln){return Ln[2]}).right(ot,gr);un===ot.length?(qr=H0(ar/sm,Pr/sm,qt),qt=e):un?(un=ot[gr/ot[un-1][2]<ot[un][2]/gr?un-1:un],qr=un[1],qt=un[0]):(qr=Math.max(H0(ar,Pr,qt),1),qt=v)}return qr==null?qt:qt.every(qr)}return x.invert=function(qt){return new Date(C(qt))},x.domain=function(qt){return arguments.length?T(Xv.call(qt,VM)):T().map(jM)},x.ticks=function(qt,ar){var Pr=T(),qr=Pr[0],gr=Pr[Pr.length-1],un=gr<qr,Ln;return un&&(Ln=qr,qr=gr,gr=Ln),Ln=_t(qt,qr,gr,ar),Ln=Ln?Ln.range(qr,gr+1):[],un?Ln.reverse():Ln},x.tickFormat=function(qt,ar){return ar==null?bt:g(ar)},x.nice=function(qt,ar){var Pr=T();return(qt=_t(qt,Pr[0],Pr[Pr.length-1],ar))?T(O_(Pr,qt)):x},x.copy=function(){return qv(x,v1(e,i,r,n,a,s,f,v,g))},x}function GM(){return Qh.apply(v1(xd,CT,rm,nm,PT,IT,OT,RT,p1).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function RI(){return initRange.apply(calendar(utcYear,utcMonth,utcWeek,utcDay,utcHour,utcMinute,utcSecond,utcMillisecond,utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function n0(){var e=0,i=1,r,n,a,s,f=el,v=!1,g;function x(C){return isNaN(C=+C)?g:f(a===0?.5:(C=(s(C)-r)*a,v?Math.max(0,Math.min(1,C)):C))}return x.domain=function(C){return arguments.length?(r=s(e=+C[0]),n=s(i=+C[1]),a=r===n?0:1/(n-r),x):[e,i]},x.clamp=function(C){return arguments.length?(v=!!C,x):v},x.interpolator=function(C){return arguments.length?(f=C,x):f},x.unknown=function(C){return arguments.length?(g=C,x):g},function(C){return s=C,r=C(e),n=C(i),a=r===n?0:1/(n-r),x}}function yv(e,i){return i.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function m1(){var e=_d(n0()(el));return e.copy=function(){return yv(e,m1())},v_.apply(e,arguments)}function HM(){var e=loggish(n0()).domain([1,10]);return e.copy=function(){return yv(e,HM()).base(e.base())},initInterpolator.apply(e,arguments)}function WM(){var e=symlogish(n0());return e.copy=function(){return yv(e,WM()).constant(e.constant())},initInterpolator.apply(e,arguments)}function g1(){var e=powish(n0());return e.copy=function(){return yv(e,g1()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function LI(){return g1.apply(null,arguments).exponent(.5)}function XM(){var e=[],i=identity;function r(n){if(!isNaN(n=+n))return i((bisect(e,n)-1)/(e.length-1))}return r.domain=function(n){if(!arguments.length)return e.slice();e=[];for(var a=0,s=n.length,f;a<s;++a)f=n[a],f!=null&&!isNaN(f=+f)&&e.push(f);return e.sort(ascending),r},r.interpolator=function(n){return arguments.length?(i=n,r):i},r.copy=function(){return XM(i).domain(e)},initInterpolator.apply(r,arguments)}function i0(){var e=0,i=.5,r=1,n,a,s,f,v,g=el,x,C=!1,T;function O(k){return isNaN(k=+k)?T:(k=.5+((k=+x(k))-a)*(k<a?f:v),g(C?Math.max(0,Math.min(1,k)):k))}return O.domain=function(k){return arguments.length?(n=x(e=+k[0]),a=x(i=+k[1]),s=x(r=+k[2]),f=n===a?0:.5/(a-n),v=a===s?0:.5/(s-a),O):[e,i,r]},O.clamp=function(k){return arguments.length?(C=!!k,O):C},O.interpolator=function(k){return arguments.length?(g=k,O):g},O.unknown=function(k){return arguments.length?(T=k,O):T},function(k){return x=k,n=k(e),a=k(i),s=k(r),f=n===a?0:.5/(a-n),v=a===s?0:.5/(s-a),O}}function y1(){var e=_d(i0()(el));return e.copy=function(){return yv(e,y1())},v_.apply(e,arguments)}function YM(){var e=loggish(i0()).domain([.1,1,10]);return e.copy=function(){return copy(e,YM()).base(e.base())},initInterpolator.apply(e,arguments)}function qM(){var e=symlogish(i0());return e.copy=function(){return copy(e,qM()).constant(e.constant())},initInterpolator.apply(e,arguments)}function _1(){var e=powish(i0());return e.copy=function(){return copy(e,_1()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function kI(){return _1.apply(null,arguments).exponent(.5)}var Jl,x1,b1,E1,um,S1;function C1(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function A1(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?C1(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):C1(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var KM=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,$M=(Jl={},(0,A.Z)(Jl,Oo.LINEAR,P_),(0,A.Z)(Jl,Oo.POWER,Q0),(0,A.Z)(Jl,Oo.LOG,D_),(0,A.Z)(Jl,Oo.IDENTITY,I_),(0,A.Z)(Jl,Oo.SEQUENTIAL,m1),(0,A.Z)(Jl,Oo.TIME,GM),(0,A.Z)(Jl,Oo.QUANTILE,z_),(0,A.Z)(Jl,Oo.QUANTIZE,U_),(0,A.Z)(Jl,Oo.THRESHOLD,Z_),(0,A.Z)(Jl,Oo.CAT,Yv),(0,A.Z)(Jl,Oo.DIVERGING,y1),Jl),QM=(x1=(0,Wr.b2)(),b1=(0,Wr.f3)(Ht.IGlobalConfigService),x1(E1=(um=function(){function e(){(0,ht.Z)(this,e),Ui(this,"configService",S1,this),(0,A.Z)(this,"scaleCache",{}),(0,A.Z)(this,"scaleOptions",{})}return(0,Pt.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.styleAttributeService;r.hooks.init.tap("FeatureScalePlugin",function(){a.scaleOptions=r.getScaleOptions();var f=s.getLayerStyleAttributes(),v=r.getSource().data.dataArray;v.length!==0&&a.caculateScalesForAttributes(f||[],v)}),r.hooks.beforeRenderData.tap("FeatureScalePlugin",function(){a.scaleOptions=r.getScaleOptions();var f=s.getLayerStyleAttributes(),v=r.getSource().data.dataArray;return a.caculateScalesForAttributes(f||[],v),r.layerModelNeedUpdate=!0,!0}),r.hooks.beforeRender.tap("FeatureScalePlugin",function(){if(!r.layerModelNeedUpdate){a.scaleOptions=r.getScaleOptions();var f=s.getLayerStyleAttributes();if(f){var v=r.getSource().data.dataArray;if(v.length===0)return;var g=f.filter(function(x){return x.needRescale});g.length&&a.caculateScalesForAttributes(g,v)}}})}},{key:"isNumber",value:function(r){return!isNaN(parseFloat(r))&&isFinite(r)}},{key:"caculateScalesForAttributes",value:function(r,n){var a=this;this.scaleCache={},r.forEach(function(s){if(s.scale){var f=s.scale,v=s.name;f.names=a.parseFields(s.scale.field||[]);var g=[];f.names.forEach(function(x){var C;g.push(a.createScale(x,s.name,(C=s.scale)===null||C===void 0?void 0:C.values,n))}),g.some(function(x){return x.type===Wh.VARIABLE})?(f.type=Wh.VARIABLE,g.forEach(function(x){if(!f.callback){var C,T,O,k,j;f.values&&f.values!=="text"&&((C=x.option)===null||C===void 0?void 0:C.type)!==Oo.DIVERGING&&((T=x.option)===null||T===void 0?void 0:T.type)!==Oo.SEQUENTIAL?x.scale.range(f.values):((O=x.option)===null||O===void 0?void 0:O.type)===Oo.CAT?x.scale.range(x.option.domain):(((k=x.option)===null||k===void 0?void 0:k.type)===Oo.DIVERGING||((j=x.option)===null||j===void 0?void 0:j.type)===Oo.SEQUENTIAL)&&x.scale.interpolator(Hw.hD(f.values))}})):(f.type=Wh.CONSTANT,f.defaultValues=g.map(function(x,C){return x.scale(f.names[C])})),f.scalers=g.map(function(x){return{field:x.field,func:x.scale,option:x.option}}),s.needRescale=!1}})}},{key:"parseFields",value:function(r){return Array.isArray(r)?r:vo()(r)?r.split("*"):[r]}},{key:"createScale",value:function(r,n,a,s){var f,v,g=this.scaleOptions[n]&&((f=this.scaleOptions[n])===null||f===void 0?void 0:f.field)===r?this.scaleOptions[n]:this.scaleOptions[r],x={field:r,scale:void 0,type:Wh.VARIABLE,option:g};if(!s||!s.length)return g&&g.type?x.scale=this.createDefaultScale(g):(x.scale=Yv([r]),x.type=Wh.CONSTANT),x;var C=(v=s.find(function(k){return!$u()(k[r])}))===null||v===void 0?void 0:v[r];if(this.isNumber(r)||$u()(C)&&!g)x.scale=Yv([r]),x.type=Wh.CONSTANT;else{var T=g&&g.type||this.getDefaultType(C);a==="text"&&(T=Oo.CAT);var O=this.createScaleConfig(T,r,g,s);x.scale=this.createDefaultScale(O),x.option=O}return x}},{key:"getDefaultType",value:function(r){var n=Oo.LINEAR;return typeof r=="string"&&(n=KM.test(r)?Oo.TIME:Oo.CAT),n}},{key:"createScaleConfig",value:function(r,n,a,s){var f={type:r},v=(s==null?void 0:s.map(function(C){return C[n]}))||[];if(a!=null&&a.domain)f.domain=a==null?void 0:a.domain;else if(r!==Oo.CAT&&r!==Oo.QUANTILE&&r!==Oo.DIVERGING)f.domain=u_(v);else if(r===Oo.CAT)f.domain=ld()(v);else if(r===Oo.QUANTILE)f.domain=v;else if(r===Oo.DIVERGING){var g=u_(v),x=(a==null?void 0:a.neutral)!==void 0?a==null?void 0:a.neutral:(g[0]+g[1])/2;f.domain=[g[0],x,g[1]]}return A1(A1({},f),a)}},{key:"createDefaultScale",value:function(r){var n=r.type,a=r.domain,s=r.unknown,f=r.clamp,v=r.nice,g=$M[n]();return a&&g.domain&&g.domain(a),s&&g.unknown(s),f!==void 0&&g.clamp&&g.clamp(f),v!==void 0&&g.nice&&g.nice(v),g}}]),e}(),S1=jn(um.prototype,"configService",[b1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),um))||E1),w1,T1,M1,P1,a0,I1,O1;function R1(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function JM(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?R1(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):R1(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var e5=(w1=(0,Wr.b2)(),T1=(0,Wr.f3)(Ht.ICameraService),M1=(0,Wr.f3)(Ht.IRendererService),w1(P1=(a0=function(){function e(){(0,ht.Z)(this,e),Ui(this,"cameraService",I1,this),Ui(this,"rendererService",O1,this)}return(0,Pt.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("LayerAnimateStylePlugin",function(){r.models.forEach(function(n){n.addUniforms(JM({},r.layerModel.getAnimateUniforms()))})})}}]),e}(),I1=jn(a0.prototype,"cameraService",[T1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),O1=jn(a0.prototype,"rendererService",[M1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a0))||P1),L1,k1,t5=(L1=(0,Wr.b2)(),L1(k1=function(){function e(){(0,ht.Z)(this,e)}return(0,Pt.Z)(e,[{key:"apply",value:function(r){r.hooks.init.tap("LayerModelPlugin",function(){r.prepareBuildModel(),r.buildModels(),r.styleNeedUpdate=!1}),r.hooks.beforeRenderData.tap("DataSourcePlugin",function(){return r.prepareBuildModel(),r.clearModels(),r.buildModels(),r.layerModelNeedUpdate=!1,!1})}}]),e}())||k1),D1,F1,r5=(D1=(0,Wr.b2)(),D1(F1=function(){function e(){(0,ht.Z)(this,e)}return(0,Pt.Z)(e,[{key:"apply",value:function(r){r.hooks.afterInit.tap("LayerStylePlugin",function(){r.updateLayerConfig({});var n=r.getLayerConfig(),a=n.autoFit,s=n.fitBoundsOptions;a&&setTimeout(function(){r.fitBounds(s)},100)})}}]),e}())||F1),B1,N1,n5=["type"];function z1(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function _v(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?z1(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):z1(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var U1={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},i5={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},a5={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},o5={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5},DI=null;function s5(e){var i={u_DirectionalLights:new Array(3).fill(_v({},a5)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill(_v({},o5)),u_NumOfSpotLights:0};return(!e||!e.length)&&(e=[i5]),e.forEach(function(r,n){var a=r.type,s=a===void 0?"directional":a,f=(0,Cc.Z)(r,n5),v=U1[s].lights,g=U1[s].num,x=i[g];i[v][x]=_v(_v({},i[v][x]),f),i[g]++}),i}var u5=(B1=(0,Wr.b2)(),B1(N1=function(){function e(){(0,ht.Z)(this,e)}return(0,Pt.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("LightingPlugin",function(){var n=r.getLayerConfig(),a=n.enableLighting;a&&r.models.forEach(function(s){return s.addUniforms(_v({},s5()))})})}}]),e}())||N1),Z1,j1,V1,lm,G1,l5=(Z1=(0,Wr.b2)(),j1=(0,Wr.f3)(Ht.IGlobalConfigService),Z1(V1=(lm=function(){function e(){(0,ht.Z)(this,e),Ui(this,"configService",G1,this),(0,A.Z)(this,"enabled",void 0)}return(0,Pt.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.rendererService,f=n.postProcessingPassFactory,v=n.normalPassFactory;r.hooks.init.tap("MultiPassRendererPlugin",function(){var g=r.getLayerConfig(),x=g.enableMultiPassRenderer,C=g.passes,T=C===void 0?[]:C;a.enabled=!!x&&r.getLayerConfig().enableMultiPassRenderer!==!1,a.enabled&&(r.multiPassRenderer=Gg(r,T,f,v),r.multiPassRenderer.setRenderFlag(!0))}),r.hooks.beforeRender.tap("MultiPassRendererPlugin",function(){if(a.enabled){var g=s.getViewportSize(),x=g.width,C=g.height;r.multiPassRenderer.resize(x,C)}})}}]),e}(),G1=jn(lm.prototype,"configService",[j1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lm))||V1),H1,W1,o0={NONE:0,ENCODE:1,HIGHLIGHT:2},c5=(H1=(0,Wr.b2)(),H1(W1=function(){function e(){(0,ht.Z)(this,e)}return(0,Pt.Z)(e,[{key:"apply",value:function(r,n){var a=n.rendererService,s=n.styleAttributeService;r.hooks.init.tap("PixelPickingPlugin",function(){var f=!0;s.registerStyleAttribute({name:"pickingColor",type:On.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:G.FLOAT},size:3,update:function(g,x){var C=g.id;return f?hu(C):[0,0,0]}}})}),r.hooks.beforePickingEncode.tap("PixelPickingPlugin",function(){var f=r.getLayerConfig(),v=f.enablePicking;v&&r.isVisible()&&r.models.forEach(function(g){return g.addUniforms({u_PickingStage:o0.ENCODE})})}),r.hooks.afterPickingEncode.tap("PixelPickingPlugin",function(){var f=r.getLayerConfig(),v=f.enablePicking;v&&r.isVisible()&&r.models.forEach(function(g){return g.addUniforms({u_PickingStage:o0.HIGHLIGHT})})}),r.hooks.beforeHighlight.tap("PixelPickingPlugin",function(f){var v=r.getLayerConfig(),g=v.highlightColor,x=v.activeMix,C=x===void 0?0:x,T=typeof g=="string"?Ji(g):g||[1,0,0,1];r.updateLayerConfig({pickedFeatureID:ol(new Uint8Array(f))}),r.models.forEach(function(O){return O.addUniforms({u_PickingStage:o0.HIGHLIGHT,u_PickingColor:f,u_HighlightColor:T.map(function(k){return k*255}),u_activeMix:C})})}),r.hooks.beforeSelect.tap("PixelPickingPlugin",function(f){var v=r.getLayerConfig(),g=v.selectColor,x=v.selectMix,C=x===void 0?0:x,T=typeof g=="string"?Ji(g):g||[1,0,0,1];r.updateLayerConfig({pickedFeatureID:ol(new Uint8Array(f))}),r.models.forEach(function(O){return O.addUniforms({u_PickingStage:o0.HIGHLIGHT,u_PickingColor:f,u_HighlightColor:T.map(function(k){return k*255}),u_activeMix:C,u_CurrentSelectedId:f,u_SelectColor:T.map(function(k){return k*255}),u_EnableSelect:1})})})}}]),e}())||W1),X1,Y1,f5=(X1=(0,Wr.b2)(),X1(Y1=function(){function e(){(0,ht.Z)(this,e)}return(0,Pt.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.styleAttributeService;r.hooks.init.tap("RegisterStyleAttributePlugin",function(){a.registerBuiltinAttributes(s)})}},{key:"registerBuiltinAttributes",value:function(r){r.registerStyleAttribute({name:"position",type:On.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:G.FLOAT},size:3,update:function(a,s,f){return f.length===2?[f[0],f[1],0]:[f[0],f[1],f[2]]}}}),r.registerStyleAttribute({name:"filter",type:On.Attribute,descriptor:{name:"filter",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(a,s){var f=a.filter;return f?[1]:[0]}}}),r.registerStyleAttribute({name:"color",type:On.Attribute,descriptor:{name:"a_Color",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:4,update:function(a,s){var f=a.color;return!f||!f.length?[1,1,1,1]:f}}}),r.registerStyleAttribute({name:"vertexId",type:On.Attribute,descriptor:{name:"a_vertexId",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(a,s,f,v){return[s]}}})}}]),e}())||Y1),q1,K1,$1,Q1,J1,ex,Cd,tx,rx,nx,ix,h5=(q1=(0,Wr.b2)(),K1=(0,Wr.f3)(Ht.ICameraService),$1=(0,Wr.f3)(Ht.ICoordinateSystemService),Q1=(0,Wr.f3)(Ht.IRendererService),J1=(0,Wr.f3)(Ht.IMapService),q1(ex=(Cd=function(){function e(){(0,ht.Z)(this,e),Ui(this,"cameraService",tx,this),Ui(this,"coordinateSystemService",rx,this),Ui(this,"rendererService",nx,this),Ui(this,"mapService",ix,this)}return(0,Pt.Z)(e,[{key:"apply",value:function(r){var n=this,a=this.mapService.version,s=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],f=[0,0];r.hooks.beforeRender.tap("ShaderUniformPlugin",function(){if(n.coordinateSystemService.refresh(),a==="GAODE2.x"){var v=n.getLayerCenter(r);n.mapService.map.customCoords.setCenter(v),n.mapService.setCustomCoordCenter(v),s=n.mapService.map.customCoords.getMVPMatrix(),f=n.mapService.getCustomCoordCenter()}var g=n.rendererService.getViewportSize(),x=g.width,C=g.height;r.models.forEach(function(T){var O;T.addUniforms((O={},(0,A.Z)(O,Tp.ProjectionMatrix,n.cameraService.getProjectionMatrix()),(0,A.Z)(O,Tp.ViewMatrix,n.cameraService.getViewMatrix()),(0,A.Z)(O,Tp.ViewProjectionMatrix,n.cameraService.getViewProjectionMatrix()),(0,A.Z)(O,Tp.Zoom,n.cameraService.getZoom()),(0,A.Z)(O,Tp.ZoomScale,n.cameraService.getZoomScale()),(0,A.Z)(O,Tp.FocalDistance,n.cameraService.getFocalDistance()),(0,A.Z)(O,Tp.CameraPosition,n.cameraService.getCameraPosition()),(0,A.Z)(O,hi.CoordinateSystem,n.coordinateSystemService.getCoordinateSystem()),(0,A.Z)(O,hi.ViewportCenter,n.coordinateSystemService.getViewportCenter()),(0,A.Z)(O,hi.ViewportCenterProjection,n.coordinateSystemService.getViewportCenterProjection()),(0,A.Z)(O,hi.PixelsPerDegree,n.coordinateSystemService.getPixelsPerDegree()),(0,A.Z)(O,hi.PixelsPerDegree2,n.coordinateSystemService.getPixelsPerDegree2()),(0,A.Z)(O,hi.PixelsPerMeter,n.coordinateSystemService.getPixelsPerMeter()),(0,A.Z)(O,hi.Mvp,s),(0,A.Z)(O,"u_SceneCenterMKT",f),(0,A.Z)(O,"u_ViewportSize",[x,C]),(0,A.Z)(O,"u_ModelMatrix",n.cameraService.getModelMatrix()),(0,A.Z)(O,"u_DevicePixelRatio",kn.devicePixelRatio),(0,A.Z)(O,"u_PickingBuffer",r.getLayerConfig().pickingBuffer||0),(0,A.Z)(O,"u_shaderPick",Number(r.getShaderPickStat())),O))})})}},{key:"getLayerCenter",value:function(r){var n=r.getSource();return n.center}}]),e}(),tx=jn(Cd.prototype,"cameraService",[K1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rx=jn(Cd.prototype,"coordinateSystemService",[$1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nx=jn(Cd.prototype,"rendererService",[Q1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ix=jn(Cd.prototype,"mapService",[J1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cd))||ex),ax,ox,p5=(ax=(0,Wr.b2)(),ax(ox=function(){function e(){(0,ht.Z)(this,e)}return(0,Pt.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("UpdateModelPlugin",function(){r.layerModel&&r.layerModel.needUpdate()})}}]),e}())||ox),sx,ux,d5=(sx=(0,Wr.b2)(),sx(ux=function(){function e(){(0,ht.Z)(this,e)}return(0,Pt.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.styleAttributeService;r.hooks.init.tap("UpdateStyleAttributePlugin",function(){a.initStyleAttribute(r,{styleAttributeService:s})}),r.hooks.beforeRender.tap("UpdateStyleAttributePlugin",function(){r.layerModelNeedUpdate||a.updateStyleAtrribute(r,{styleAttributeService:s})})}},{key:"updateStyleAtrribute",value:function(r,n){var a=n.styleAttributeService,s=a.getLayerStyleAttributes()||[],f=a.getLayerStyleAttribute("filter"),v=a.getLayerStyleAttribute("shape");if(f&&f.needRegenerateVertices){r.layerModelNeedUpdate=!0,s.forEach(function(g){return g.needRegenerateVertices=!1});return}s.filter(function(g){return g.needRegenerateVertices}).forEach(function(g){a.updateAttributeByFeatureRange(g.name,r.getEncodedData(),g.featureRange.startIndex,g.featureRange.endIndex),g.needRegenerateVertices=!1})}},{key:"initStyleAttribute",value:function(r,n){var a=n.styleAttributeService,s=a.getLayerStyleAttributes()||[];s.filter(function(f){return f.needRegenerateVertices}).forEach(function(f){a.updateAttributeByFeatureRange(f.name,r.getEncodedData(),f.featureRange.startIndex,f.featureRange.endIndex),f.needRegenerateVertices=!1})}}]),e}())||ux);Ql.bind(Ht.ILayerPlugin).to(Uw).inRequestScope(),Ql.bind(Ht.ILayerPlugin).to(f5).inRequestScope(),Ql.bind(Ht.ILayerPlugin).to(QM).inRequestScope(),Ql.bind(Ht.ILayerPlugin).to(zw).inRequestScope(),Ql.bind(Ht.ILayerPlugin).to(r5).inRequestScope(),Ql.bind(Ht.ILayerPlugin).to(d5).inRequestScope(),Ql.bind(Ht.ILayerPlugin).to(p5).inRequestScope(),Ql.bind(Ht.ILayerPlugin).to(l5).inRequestScope(),Ql.bind(Ht.ILayerPlugin).to(h5).inRequestScope(),Ql.bind(Ht.ILayerPlugin).to(e5).inRequestScope(),Ql.bind(Ht.ILayerPlugin).to(u5).inRequestScope(),Ql.bind(Ht.ILayerPlugin).to(c5).inRequestScope(),Ql.bind(Ht.ILayerPlugin).to(t5).inRequestScope();var v5=U(88307),m5=U.n(v5),g5=function(){function e(i,r){(0,ht.Z)(this,e),(0,A.Z)(this,"attribute",void 0),(0,A.Z)(this,"buffer",void 0);var n=r.buffer,a=r.offset,s=r.stride,f=r.normalized,v=r.size,g=r.divisor;this.buffer=n,this.attribute={buffer:n.get(),offset:a||0,stride:s||0,normalized:f||!1,divisor:g||0},v&&(this.attribute.size=v)}return(0,Pt.Z)(e,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(r){this.buffer.subData(r)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),yh,xv,_h,Pc,bv,Jh,Ev,s0,Lf,Fp,Du,kf,Df,u0,y5=(yh={},(0,A.Z)(yh,G.POINTS,"points"),(0,A.Z)(yh,G.LINES,"lines"),(0,A.Z)(yh,G.LINE_LOOP,"line loop"),(0,A.Z)(yh,G.LINE_STRIP,"line strip"),(0,A.Z)(yh,G.TRIANGLES,"triangles"),(0,A.Z)(yh,G.TRIANGLE_FAN,"triangle fan"),(0,A.Z)(yh,G.TRIANGLE_STRIP,"triangle strip"),yh),lx=(xv={},(0,A.Z)(xv,G.STATIC_DRAW,"static"),(0,A.Z)(xv,G.DYNAMIC_DRAW,"dynamic"),(0,A.Z)(xv,G.STREAM_DRAW,"stream"),xv),cm=(_h={},(0,A.Z)(_h,G.BYTE,"int8"),(0,A.Z)(_h,G.UNSIGNED_INT,"int16"),(0,A.Z)(_h,G.INT,"int32"),(0,A.Z)(_h,G.UNSIGNED_BYTE,"uint8"),(0,A.Z)(_h,G.UNSIGNED_SHORT,"uint16"),(0,A.Z)(_h,G.UNSIGNED_INT,"uint32"),(0,A.Z)(_h,G.FLOAT,"float"),_h),_5=(Pc={},(0,A.Z)(Pc,G.ALPHA,"alpha"),(0,A.Z)(Pc,G.LUMINANCE,"luminance"),(0,A.Z)(Pc,G.LUMINANCE_ALPHA,"luminance alpha"),(0,A.Z)(Pc,G.RGB,"rgb"),(0,A.Z)(Pc,G.RGBA,"rgba"),(0,A.Z)(Pc,G.RGBA4,"rgba4"),(0,A.Z)(Pc,G.RGB5_A1,"rgb5 a1"),(0,A.Z)(Pc,G.RGB565,"rgb565"),(0,A.Z)(Pc,G.DEPTH_COMPONENT,"depth"),(0,A.Z)(Pc,G.DEPTH_STENCIL,"depth stencil"),Pc),x5=(bv={},(0,A.Z)(bv,G.DONT_CARE,"dont care"),(0,A.Z)(bv,G.NICEST,"nice"),(0,A.Z)(bv,G.FASTEST,"fast"),bv),cx=(Jh={},(0,A.Z)(Jh,G.NEAREST,"nearest"),(0,A.Z)(Jh,G.LINEAR,"linear"),(0,A.Z)(Jh,G.LINEAR_MIPMAP_LINEAR,"mipmap"),(0,A.Z)(Jh,G.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),(0,A.Z)(Jh,G.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),(0,A.Z)(Jh,G.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),Jh),fx=(Ev={},(0,A.Z)(Ev,G.REPEAT,"repeat"),(0,A.Z)(Ev,G.CLAMP_TO_EDGE,"clamp"),(0,A.Z)(Ev,G.MIRRORED_REPEAT,"mirror"),Ev),b5=(s0={},(0,A.Z)(s0,G.NONE,"none"),(0,A.Z)(s0,G.BROWSER_DEFAULT_WEBGL,"browser"),s0),E5=(Lf={},(0,A.Z)(Lf,G.NEVER,"never"),(0,A.Z)(Lf,G.ALWAYS,"always"),(0,A.Z)(Lf,G.LESS,"less"),(0,A.Z)(Lf,G.LEQUAL,"lequal"),(0,A.Z)(Lf,G.GREATER,"greater"),(0,A.Z)(Lf,G.GEQUAL,"gequal"),(0,A.Z)(Lf,G.EQUAL,"equal"),(0,A.Z)(Lf,G.NOTEQUAL,"notequal"),Lf),hx=(Fp={},(0,A.Z)(Fp,G.FUNC_ADD,"add"),(0,A.Z)(Fp,G.MIN_EXT,"min"),(0,A.Z)(Fp,G.MAX_EXT,"max"),(0,A.Z)(Fp,G.FUNC_SUBTRACT,"subtract"),(0,A.Z)(Fp,G.FUNC_REVERSE_SUBTRACT,"reverse subtract"),Fp),l0=(Du={},(0,A.Z)(Du,G.ZERO,"zero"),(0,A.Z)(Du,G.ONE,"one"),(0,A.Z)(Du,G.SRC_COLOR,"src color"),(0,A.Z)(Du,G.ONE_MINUS_SRC_COLOR,"one minus src color"),(0,A.Z)(Du,G.SRC_ALPHA,"src alpha"),(0,A.Z)(Du,G.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),(0,A.Z)(Du,G.DST_COLOR,"dst color"),(0,A.Z)(Du,G.ONE_MINUS_DST_COLOR,"one minus dst color"),(0,A.Z)(Du,G.DST_ALPHA,"dst alpha"),(0,A.Z)(Du,G.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),(0,A.Z)(Du,G.CONSTANT_COLOR,"constant color"),(0,A.Z)(Du,G.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),(0,A.Z)(Du,G.CONSTANT_ALPHA,"constant alpha"),(0,A.Z)(Du,G.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),(0,A.Z)(Du,G.SRC_ALPHA_SATURATE,"src alpha saturate"),Du),S5=(kf={},(0,A.Z)(kf,G.NEVER,"never"),(0,A.Z)(kf,G.ALWAYS,"always"),(0,A.Z)(kf,G.LESS,"less"),(0,A.Z)(kf,G.LEQUAL,"lequal"),(0,A.Z)(kf,G.GREATER,"greater"),(0,A.Z)(kf,G.GEQUAL,"gequal"),(0,A.Z)(kf,G.EQUAL,"equal"),(0,A.Z)(kf,G.NOTEQUAL,"notequal"),kf),Ad=(Df={},(0,A.Z)(Df,G.ZERO,"zero"),(0,A.Z)(Df,G.KEEP,"keep"),(0,A.Z)(Df,G.REPLACE,"replace"),(0,A.Z)(Df,G.INVERT,"invert"),(0,A.Z)(Df,G.INCR,"increment"),(0,A.Z)(Df,G.DECR,"decrement"),(0,A.Z)(Df,G.INCR_WRAP,"increment wrap"),(0,A.Z)(Df,G.DECR_WRAP,"decrement wrap"),Df),C5=(u0={},(0,A.Z)(u0,G.FRONT,"front"),(0,A.Z)(u0,G.BACK,"back"),u0),A5=function(){function e(i,r){(0,ht.Z)(this,e),(0,A.Z)(this,"buffer",void 0);var n=r.data,a=r.usage,s=r.type;this.buffer=i.buffer({data:n,usage:lx[a||G.STATIC_DRAW],type:cm[s||G.UNSIGNED_BYTE]})}return(0,Pt.Z)(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.buffer.destroy()}},{key:"subData",value:function(r){var n=r.data,a=r.offset;this.buffer.subdata(n,a)}}]),e}(),w5=function(){function e(i,r){(0,ht.Z)(this,e),(0,A.Z)(this,"elements",void 0);var n=r.data,a=r.usage,s=r.type,f=r.count;this.elements=i.elements({data:n,usage:lx[a||G.STATIC_DRAW],type:cm[s||G.UNSIGNED_BYTE],count:f})}return(0,Pt.Z)(e,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(r){var n=r.data;this.elements.subdata(n)}},{key:"destroy",value:function(){}}]),e}(),T5=function(){function e(i,r){(0,ht.Z)(this,e),(0,A.Z)(this,"framebuffer",void 0);var n=r.width,a=r.height,s=r.color,f=r.colors,v=r.depth,g=r.stencil,x={width:n,height:a};Array.isArray(f)&&(x.colors=f.map(function(C){return C.get()})),s&&typeof s!="boolean"&&(x.color=s.get()),this.framebuffer=i.framebuffer(x)}return(0,Pt.Z)(e,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(r){var n=r.width,a=r.height;this.framebuffer.resize(n,a)}}]),e}(),M5=U(36719),P5=U.n(M5),I5=U(68630),O5=U.n(I5);function px(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Ic(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?px(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):px(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var R5=function(){function e(i,r){(0,ht.Z)(this,e),(0,A.Z)(this,"reGl",void 0),(0,A.Z)(this,"destroyed",!1),(0,A.Z)(this,"drawCommand",void 0),(0,A.Z)(this,"drawPickCommand",void 0),(0,A.Z)(this,"drawParams",void 0),(0,A.Z)(this,"options",void 0),(0,A.Z)(this,"uniforms",{}),this.reGl=i;var n=r.vs,a=r.fs,s=r.attributes,f=r.uniforms,v=r.primitive,g=r.count,x=r.elements,C=r.depth,T=r.blend,O=r.stencil,k=r.cull,j=r.instances,X={};this.options=r,f&&(this.uniforms=this.extractUniforms(f),Object.keys(f).forEach(function($e){X[$e]=i.prop($e)}));var te={};Object.keys(s).forEach(function($e){te[$e]=s[$e].get()});var be={attributes:te,frag:a,uniforms:X,vert:n,blend:{},primitive:y5[v===void 0?G.TRIANGLES:v]};j&&(be.instances=j),g&&(be.count=g),x&&(be.elements=x.get()),this.initDepthDrawParams({depth:C},be),this.initBlendDrawParams({blend:T},be),this.initStencilDrawParams({stencil:O},be),this.initCullDrawParams({cull:k},be),this.drawCommand=i(be);var Ne=du()(be);Ne.blend=Ic(Ic({},Ne.blend),{},{enable:!1}),this.drawPickCommand=i(Ne),this.drawParams=be}return(0,Pt.Z)(e,[{key:"updateAttributesAndElements",value:function(r,n){var a={};Object.keys(r).forEach(function(f){a[f]=r[f].get()}),this.drawParams.attributes=a,this.drawParams.elements=n.get(),this.drawCommand=this.reGl(this.drawParams);var s=du()(this.drawParams);s.blend=Ic(Ic({},s.blend),{},{enable:!1}),this.drawPickCommand=this.reGl(s)}},{key:"updateAttributes",value:function(r){var n={};Object.keys(r).forEach(function(s){n[s]=r[s].get()}),this.drawParams.attributes=n,this.drawCommand=this.reGl(this.drawParams);var a=du()(this.drawParams);a.blend=Ic(Ic({},a.blend),{},{enable:!1}),this.drawPickCommand=this.reGl(a)}},{key:"addUniforms",value:function(r){this.uniforms=Ic(Ic({},this.uniforms),this.extractUniforms(r))}},{key:"draw",value:function(r,n){if(!(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)){var a=Ic(Ic({},this.uniforms),this.extractUniforms(r.uniforms||{})),s={};Object.keys(a).forEach(function(f){var v=(0,dt.Z)(a[f]);v==="boolean"||v==="number"||Array.isArray(a[f])||a[f].BYTES_PER_ELEMENT?s[f]=a[f]:s[f]=a[f].get()}),n?this.drawPickCommand(s):this.drawCommand(s)}}},{key:"destroy",value:function(){this.drawParams.elements.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(function(r){r.destroy()}),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(r,n){var a=r.depth;a&&(n.depth={enable:a.enable===void 0?!0:!!a.enable,mask:a.mask===void 0?!0:!!a.mask,func:E5[a.func||G.LESS],range:a.range||[0,1]})}},{key:"initBlendDrawParams",value:function(r,n){var a=r.blend;if(a){var s=a.enable,f=a.func,v=a.equation,g=a.color,x=g===void 0?[0,0,0,0]:g;n.blend={enable:!!s,func:{srcRGB:l0[f&&f.srcRGB||G.SRC_ALPHA],srcAlpha:l0[f&&f.srcAlpha||G.SRC_ALPHA],dstRGB:l0[f&&f.dstRGB||G.ONE_MINUS_SRC_ALPHA],dstAlpha:l0[f&&f.dstAlpha||G.ONE_MINUS_SRC_ALPHA]},equation:{rgb:hx[v&&v.rgb||G.FUNC_ADD],alpha:hx[v&&v.alpha||G.FUNC_ADD]},color:x}}}},{key:"initStencilDrawParams",value:function(r,n){var a=r.stencil;if(a){var s=a.enable,f=a.mask,v=f===void 0?-1:f,g=a.func,x=g===void 0?{cmp:G.ALWAYS,ref:0,mask:-1}:g,C=a.opFront,T=C===void 0?{fail:G.KEEP,zfail:G.KEEP,zpass:G.KEEP}:C,O=a.opBack,k=O===void 0?{fail:G.KEEP,zfail:G.KEEP,zpass:G.KEEP}:O;n.stencil={enable:!!s,mask:v,func:Ic(Ic({},x),{},{cmp:S5[x.cmp]}),opFront:{fail:Ad[T.fail],zfail:Ad[T.zfail],zpass:Ad[T.zpass]},opBack:{fail:Ad[k.fail],zfail:Ad[k.zfail],zpass:Ad[k.zpass]}}}}},{key:"initCullDrawParams",value:function(r,n){var a=r.cull;if(a){var s=a.enable,f=a.face,v=f===void 0?G.BACK:f;n.cull={enable:!!s,face:C5[v]}}}},{key:"extractUniforms",value:function(r){var n=this,a={};return Object.keys(r).forEach(function(s){n.extractUniformsRecursively(s,r[s],a,"")}),a}},{key:"extractUniformsRecursively",value:function(r,n,a,s){var f=this;if(n===null||typeof n=="number"||typeof n=="boolean"||Array.isArray(n)&&typeof n[0]=="number"||P5()(n)||n===""||"resize"in n){a["".concat(s&&s+".").concat(r)]=n;return}O5()(n)&&Object.keys(n).forEach(function(v){f.extractUniformsRecursively(v,n[v],a,"".concat(s&&s+".").concat(r))}),Array.isArray(n)&&n.forEach(function(v,g){Object.keys(v).forEach(function(x){f.extractUniformsRecursively(x,v[x],a,"".concat(s&&s+".").concat(r,"[").concat(g,"]"))})})}}]),e}(),L5=function(){function e(i,r){(0,ht.Z)(this,e),(0,A.Z)(this,"texture",void 0),(0,A.Z)(this,"width",void 0),(0,A.Z)(this,"height",void 0),(0,A.Z)(this,"isDistroy",!1);var n=r.data,a=r.type,s=a===void 0?G.UNSIGNED_BYTE:a,f=r.width,v=r.height,g=r.flipY,x=g===void 0?!1:g,C=r.format,T=C===void 0?G.RGBA:C,O=r.mipmap,k=O===void 0?!1:O,j=r.wrapS,X=j===void 0?G.CLAMP_TO_EDGE:j,te=r.wrapT,be=te===void 0?G.CLAMP_TO_EDGE:te,Ne=r.aniso,$e=Ne===void 0?0:Ne,ot=r.alignment,bt=ot===void 0?1:ot,_t=r.premultiplyAlpha,qt=_t===void 0?!1:_t,ar=r.mag,Pr=ar===void 0?G.NEAREST:ar,qr=r.min,gr=qr===void 0?G.NEAREST:qr,un=r.colorSpace,Ln=un===void 0?G.BROWSER_DEFAULT_WEBGL:un,Vn=r.x,Fa=Vn===void 0?0:Vn,Ro=r.y,Ls=Ro===void 0?0:Ro,au=r.copy,Vs=au===void 0?!1:au;this.width=f,this.height=v;var Oc={width:f,height:v,type:cm[s],format:_5[T],wrapS:fx[X],wrapT:fx[be],mag:cx[Pr],min:cx[gr],alignment:bt,flipY:x,colorSpace:b5[Ln],premultiplyAlpha:qt,aniso:$e,x:Fa,y:Ls,copy:Vs};n&&(Oc.data=n),typeof k=="number"?Oc.mipmap=x5[k]:typeof k=="boolean"&&(Oc.mipmap=k),this.texture=i.texture(Oc)}return(0,Pt.Z)(e,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.texture(r)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(r){var n=r.width,a=r.height;this.texture.resize(n,a),this.width=n,this.height=a}},{key:"destroy",value:function(){if(!this.isDistroy){var r;(r=this.texture)===null||r===void 0||r.destroy()}this.isDistroy=!0}}]),e}(),dx,vx,k5=(dx=(0,Wr.b2)(),dx(vx=function(){function e(){var i=this;(0,ht.Z)(this,e),(0,A.Z)(this,"extensionObject",void 0),(0,A.Z)(this,"gl",void 0),(0,A.Z)(this,"$container",void 0),(0,A.Z)(this,"canvas",void 0),(0,A.Z)(this,"width",void 0),(0,A.Z)(this,"height",void 0),(0,A.Z)(this,"isDirty",void 0),(0,A.Z)(this,"createModel",function(r){return new R5(i.gl,r)}),(0,A.Z)(this,"createAttribute",function(r){return new g5(i.gl,r)}),(0,A.Z)(this,"createBuffer",function(r){return new A5(i.gl,r)}),(0,A.Z)(this,"createElements",function(r){return new w5(i.gl,r)}),(0,A.Z)(this,"createTexture2D",function(r){return new L5(i.gl,r)}),(0,A.Z)(this,"createFramebuffer",function(r){return new T5(i.gl,r)}),(0,A.Z)(this,"useFramebuffer",function(r,n){i.gl({framebuffer:r?r.get():null})(n)}),(0,A.Z)(this,"clear",function(r){var n=r.color,a=r.depth,s=r.stencil,f=r.framebuffer,v=f===void 0?null:f,g={color:n,depth:a,stencil:s};g.framebuffer=v===null?v:v.get(),i.gl.clear(g)}),(0,A.Z)(this,"viewport",function(r){var n=r.x,a=r.y,s=r.width,f=r.height;i.gl._gl.viewport(n,a,s,f),i.width=s,i.height=f,i.gl._refresh()}),(0,A.Z)(this,"readPixels",function(r){var n=r.framebuffer,a=r.x,s=r.y,f=r.width,v=r.height,g={x:a,y:s,width:f,height:v};return n&&(g.framebuffer=n.get()),i.gl.read(g)}),(0,A.Z)(this,"getViewportSize",function(){return{width:i.gl._gl.drawingBufferWidth,height:i.gl._gl.drawingBufferHeight}}),(0,A.Z)(this,"getContainer",function(){if(ts)return i.canvas;var r;return(r=i.canvas)===null||r===void 0?void 0:r.parentElement}),(0,A.Z)(this,"getCanvas",function(){return i.canvas}),(0,A.Z)(this,"getGLContext",function(){return i.gl._gl}),(0,A.Z)(this,"destroy",function(){i.canvas=null,i.gl.destroy(),i.gl=null})}return(0,Pt.Z)(e,[{key:"init",value:function(){var i=(0,P.Z)(N().mark(function n(a,s){var f=this;return N().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return this.canvas=a,g.next=3,new Promise(function(x,C){m5()({canvas:f.canvas,attributes:{alpha:!0,antialias:s.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:s.preserveDrawingBuffer,stencil:s.stencil},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture"],profile:!0,onDone:function(O,k){(O||!k)&&C(O),x(k)}})});case 3:this.gl=g.sent,this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 5:case"end":return g.stop()}},n,this)}));function r(n,a){return i.apply(this,arguments)}return r}()},{key:"getPointSizeRange",value:function(){return this.gl._gl.getParameter(this.gl._gl.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(r){return!!this.getGLContext().getExtension(r)}},{key:"setState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var r=this.getGLContext();r.disable(r.CULL_FACE)}},{key:"setDirty",value:function(r){this.isDirty=r}},{key:"getDirty",value:function(){return this.isDirty}}]),e}())||vx);function mx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function gx(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?mx(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):mx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var D5=function(){function e(i){(0,ht.Z)(this,e),(0,A.Z)(this,"sceneService",void 0),(0,A.Z)(this,"mapService",void 0),(0,A.Z)(this,"controlService",void 0),(0,A.Z)(this,"layerService",void 0),(0,A.Z)(this,"iconService",void 0),(0,A.Z)(this,"markerService",void 0),(0,A.Z)(this,"popupService",void 0),(0,A.Z)(this,"fontService",void 0),(0,A.Z)(this,"interactionService",void 0),(0,A.Z)(this,"container",void 0);var r=i.id,n=i.map,a=i.canvas,s=i.hasBaseMap,f=I2();this.container=f,n.setContainer(f,r,a,s),f.bind(Ht.IRendererService).to(k5).inSingletonScope(),this.sceneService=f.get(Ht.ISceneService),this.mapService=f.get(Ht.IMapService),this.iconService=f.get(Ht.IIconService),this.fontService=f.get(Ht.IFontService),this.controlService=f.get(Ht.IControlService),this.layerService=f.get(Ht.ILayerService),this.markerService=f.get(Ht.IMarkerService),this.interactionService=f.get(Ht.IInteractionService),this.popupService=f.get(Ht.IPopupService),ts?this.sceneService.initMiniScene(i):(this.initComponent(r),this.sceneService.init(i),this.initControl())}return(0,Pt.Z)(e,[{key:"map",get:function(){return this.mapService.map}},{key:"loaded",get:function(){return this.sceneService.loaded}},{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"exportPng",value:function(r){return this.sceneService.exportPng(r)}},{key:"exportMap",value:function(r){return this.sceneService.exportPng(r)}},{key:"registerRenderService",value:function(r){var n=this;if(this.sceneService.loaded){var a=new r(this);a.init()}else this.on("loaded",function(){var s=new r(n);s.init()})}},{key:"setBgColor",value:function(r){this.mapService.setBgColor(r)}},{key:"addLayer",value:function(r){var n=av(this.container);r.setContainer(n,this.container),this.sceneService.addLayer(r);var a=r.getLayerConfig();if(a){var s=a.mask,f=a.maskfence,v=a.maskColor,g=v===void 0?"#000":v,x=a.maskOpacity,C=x===void 0?0:x;if(s&&f){var T=new Bw().source(f).shape("fill").color(g).style({opacity:C});this.addMask(T,r.id)}}else console.warn("addLayer should run after scene loaded!")}},{key:"addMask",value:function(r,n){var a=this.getLayer(n);if(a){var s=av(this.container);r.setContainer(s,this.container),a.addMaskLayer(r),this.sceneService.addLayer(r)}else console.warn("parent layer not find!")}},{key:"getPickedLayer",value:function(){return this.layerService.pickedLayerId}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(r){return this.layerService.getLayer(r)}},{key:"getLayerByName",value:function(r){return this.layerService.getLayerByName(r)}},{key:"removeLayer",value:function(r,n){this.layerService.remove(r,n)}},{key:"removeAllLayer",value:function(){this.layerService.removeAllLayers()}},{key:"render",value:function(){this.sceneService.render()}},{key:"setEnableRender",value:function(r){this.layerService.setEnableRender(r)}},{key:"addIconFont",value:function(r,n){this.fontService.addIconFont(r,n)}},{key:"addIconFonts",value:function(r){var n=this;r.forEach(function(a){var s=(0,on.Z)(a,2),f=s[0],v=s[1];n.fontService.addIconFont(f,v)})}},{key:"addFontFace",value:function(r,n){this.sceneService.addFontFace(r,n)}},{key:"addImage",value:function(r,n){ts?this.iconService.addImageMini(r,n,this.sceneService):this.iconService.addImage(r,n)}},{key:"hasImage",value:function(r){return this.iconService.hasImage(r)}},{key:"removeImage",value:function(r){this.iconService.removeImage(r)}},{key:"addIconFontGlyphs",value:function(r,n){this.fontService.addIconGlyphs(n)}},{key:"addControl",value:function(r){this.controlService.addControl(r,this.container)}},{key:"removeControl",value:function(r){this.controlService.removeControl(r)}},{key:"getControlByName",value:function(r){return this.controlService.getControlByName(r)}},{key:"addMarker",value:function(r){this.markerService.addMarker(r)}},{key:"addMarkerLayer",value:function(r){this.markerService.addMarkerLayer(r)}},{key:"removeMarkerLayer",value:function(r){this.markerService.removeMarkerLayer(r)}},{key:"removeAllMakers",value:function(){this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(r){this.popupService.addPopup(r)}},{key:"on",value:function(r,n){D0.indexOf(r)===-1?this.mapService.on(r,n):this.sceneService.on(r,n)}},{key:"once",value:function(r,n){D0.indexOf(r)===-1?this.mapService.once(r,n):this.sceneService.once(r,n)}},{key:"off",value:function(r,n){D0.indexOf(r)===-1?this.mapService.off(r,n):this.sceneService.off(r,n)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(r){return this.mapService.getCenter(r)}},{key:"setCenter",value:function(r,n){return this.mapService.setCenter(r,n)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(r){return this.mapService.setPitch(r)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(r){this.mapService.setRotation(r)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(r){this.mapService.panTo(r)}},{key:"panBy",value:function(r,n){this.mapService.panBy(r,n)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(r){this.mapService.setZoom(r)}},{key:"fitBounds",value:function(r,n){var a=this.sceneService.getSceneConfig(),s=a.fitBoundsOptions,f=a.animate;this.mapService.fitBounds(r,n||gx(gx({},s),{},{animate:f}))}},{key:"setZoomAndCenter",value:function(r,n){this.mapService.setZoomAndCenter(r,n)}},{key:"setMapStyle",value:function(r){this.mapService.setMapStyle(r)}},{key:"setMapStatus",value:function(r){this.mapService.setMapStatus(r)}},{key:"pixelToLngLat",value:function(r){return this.mapService.pixelToLngLat(r)}},{key:"lngLatToPixel",value:function(r){return this.mapService.lngLatToPixel(r)}},{key:"containerToLngLat",value:function(r){return this.mapService.containerToLngLat(r)}},{key:"lngLatToContainer",value:function(r){return this.mapService.lngLatToContainer(r)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(r,n){this.container.bind(Ht.IPostProcessingPass).to(r).whenTargetNamed(n)}},{key:"enableShaderPick",value:function(){this.layerService.enableShaderPick()}},{key:"diasbleShaderPick",value:function(){this.layerService.disableShaderPick()}},{key:"getPointSizeRange",value:function(){return this.sceneService.getPointSizeRange()}},{key:"initComponent",value:function(r){this.controlService.init({container:Bc(r)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var r=this.sceneService.getSceneConfig(),n=r.logoVisible,a=r.logoPosition;n&&this.addControl(new K2({position:a}))}}]),e}(),FI="2.8.47";function yx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function BI(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?yx(Object(r),!0).forEach(function(n){F5(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):yx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function F5(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function NI(e,i){return U5(e)||z5(e,i)||N5(e,i)||B5()}function B5(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function N5(e,i){if(!!e){if(typeof e=="string")return _x(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return _x(e,i)}}function _x(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function z5(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,f,v;try{for(r=r.call(e);!(a=(f=r.next()).done)&&(n.push(f.value),!(i&&n.length===i));a=!0);}catch(g){s=!0,v=g}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function U5(e){if(Array.isArray(e))return e}var zI=null,UI=null,xx,fm,bx;function Ex(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Sx(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Ex(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ex(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Z5=(xx=k0(Ht.IGlobalConfigService),fm=function(){function e(i){(0,ht.Z)(this,e),Ui(this,"configService",bx,this),(0,A.Z)(this,"config",void 0),this.config=i}return(0,Pt.Z)(e,[{key:"setContainer",value:function(r,n,a,s){r.bind(Ht.MapConfig).toConstantValue(Sx(Sx({},this.config),{},{id:n,canvas:a,hasBaseMap:s})),r.bind(Ht.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),e}(),bx=jn(fm.prototype,"configService",[xx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fm),j5=U(6158),Sv=U.n(j5);function Cv(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function c0(e,i){var r=Me([],i,e);return o(r,r,1/r[3]),r}function ZI(e,i){var r=e%i;return r<0?i+r:r}function jI(e,i,r){return r*i+(1-r)*e}function Bp(e,i){if(!e)throw new Error(i||"viewport-mercator-project: assertion failed.")}var af=Math.PI,Cx=af/4,xh=af/180,Ax=180/af,hm=512,pm=4003e4,V5=1.5;function Tx(e){return Math.pow(2,e)}function G5(e){return Math.log2(e)}function f0(e,i){var r=(0,on.Z)(e,2),n=r[0],a=r[1];Bp(Number.isFinite(n)&&Number.isFinite(i)),Bp(Number.isFinite(a)&&a>=-90&&a<=90,"invalid latitude"),i*=hm;var s=n*xh,f=a*xh,v=i*(s+af)/(2*af),g=i*(af-Math.log(Math.tan(Cx+f*.5)))/(2*af);return[v,g]}function dm(e,i){var r=(0,on.Z)(e,2),n=r[0],a=r[1];i*=hm;var s=n/i*(2*af)-af,f=2*(Math.atan(Math.exp(af-a/i*(2*af)))-Cx);return[s*Ax,f*Ax]}function VI(e){var i=e.latitude;assert(Number.isFinite(i));var r=Math.cos(i*xh);return G5(pm*r)-9}function Mx(e){var i=e.latitude,r=e.longitude,n=e.zoom,a=e.scale,s=e.highPrecision,f=s===void 0?!1:s;a=a!==void 0?a:Tx(n),Bp(Number.isFinite(i)&&Number.isFinite(r)&&Number.isFinite(a));var v={},g=hm*a,x=Math.cos(i*xh),C=g/360,T=C/x,O=g/pm/x;if(v.pixelsPerMeter=[O,-O,O],v.metersPerPixel=[1/O,-1/O,1/O],v.pixelsPerDegree=[C,-T,O],v.degreesPerPixel=[1/C,-1/T,1/O],f){var k=xh*Math.tan(i*xh)/x,j=C*k/2,X=g/pm*k,te=X/T*O;v.pixelsPerDegree2=[0,-j,X],v.pixelsPerMeter2=[te,0,te]}return v}function GI(e,i){var r=_slicedToArray(e,3),n=r[0],a=r[1],s=r[2],f=_slicedToArray(i,3),v=f[0],g=f[1],x=f[2],C=1,T=Mx({longitude:n,latitude:a,scale:C,highPrecision:!0}),O=T.pixelsPerMeter,k=T.pixelsPerMeter2,j=f0(e,C);j[0]+=v*(O[0]+k[0]*g),j[1]+=g*(O[1]+k[1]*g);var X=dm(j,C),te=(s||0)+(x||0);return Number.isFinite(s)||Number.isFinite(x)?[X[0],X[1],te]:X}function H5(e){var i=e.height,r=e.pitch,n=e.bearing,a=e.altitude,s=e.center,f=s===void 0?null:s,v=e.flipY,g=v===void 0?!1:v,x=Cv();return jr(x,x,[0,0,-a]),en(x,x,[1,1,1/i]),ui(x,x,-r*xh),Ga(x,x,n*xh),g&&en(x,x,[1,-1,1]),f&&jr(x,x,Xa.negate([],f)),x}function W5(e){var i=e.width,r=e.height,n=e.altitude,a=n===void 0?V5:n,s=e.pitch,f=s===void 0?0:s,v=e.nearZMultiplier,g=v===void 0?1:v,x=e.farZMultiplier,C=x===void 0?1:x,T=f*xh,O=Math.atan(.5/a),k=Math.sin(O)*a/Math.sin(Math.PI/2-T-O),j=Math.cos(Math.PI/2-T)*k+a;return{fov:2*Math.atan(r/2/a),aspect:i/r,focalDistance:a,near:g,far:j*C}}function X5(e){var i=e.width,r=e.height,n=e.pitch,a=e.altitude,s=e.nearZMultiplier,f=e.farZMultiplier,v=W5({width:i,height:r,altitude:a,pitch:n,nearZMultiplier:s,farZMultiplier:f}),g=v.fov,x=v.aspect,C=v.near,T=v.far,O=ua([],g,x,C,T);return O}function Y5(e,i){var r=(0,on.Z)(e,3),n=r[0],a=r[1],s=r[2],f=s===void 0?0:s;return Bp(Number.isFinite(n)&&Number.isFinite(a)&&Number.isFinite(f)),c0(i,[n,a,f,1])}function Px(e,i){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=(0,on.Z)(e,3),a=n[0],s=n[1],f=n[2];if(Bp(Number.isFinite(a)&&Number.isFinite(s),"invalid pixel coordinate"),Number.isFinite(f)){var v=c0(i,[a,s,f,1]);return v}var g=c0(i,[a,s,0,1]),x=c0(i,[a,s,1,1]),C=g[2],T=x[2],O=C===T?0:((r||0)-C)/(T-C);return Ci.t7([],g,x,O)}var Ix=Cv(),q5=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=i.width,n=i.height,a=i.viewMatrix,s=a===void 0?Ix:a,f=i.projectionMatrix,v=f===void 0?Ix:f;(0,ht.Z)(this,e),this.width=r||1,this.height=n||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=s,this.projectionMatrix=v;var g=Cv();Gn(g,g,this.projectionMatrix),Gn(g,g,this.viewMatrix),this.viewProjectionMatrix=g;var x=Cv();en(x,x,[this.width/2,-this.height/2,1]),jr(x,x,[1,-1,0]),Gn(x,x,this.viewProjectionMatrix);var C=Hr(Cv(),x);if(!C)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=x,this.pixelUnprojectionMatrix=C,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return(0,Pt.Z)(e,[{key:"equals",value:function(r){return r instanceof e?r.width===this.width&&r.height===this.height&&nt(r.projectionMatrix,this.projectionMatrix)&&nt(r.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=n.topLeft,s=a===void 0?!0:a,f=this.projectPosition(r),v=Y5(f,this.pixelProjectionMatrix),g=(0,on.Z)(v,2),x=g[0],C=g[1],T=s?C:this.height-C;return r.length===2?[x,T]:[x,T,v[2]]}},{key:"unproject",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=n.topLeft,s=a===void 0?!0:a,f=n.targetZ,v=(0,on.Z)(r,3),g=v[0],x=v[1],C=v[2],T=s?x:this.height-x,O=f&&f*this.pixelsPerMeter,k=Px([g,T,C],this.pixelUnprojectionMatrix,O),j=this.unprojectPosition(k),X=(0,on.Z)(j,3),te=X[0],be=X[1],Ne=X[2];return Number.isFinite(C)?[te,be,Ne]:Number.isFinite(f)?[te,be,f]:[te,be]}},{key:"projectPosition",value:function(r){var n=this.projectFlat(r),a=(0,on.Z)(n,2),s=a[0],f=a[1],v=(r[2]||0)*this.pixelsPerMeter;return[s,f,v]}},{key:"unprojectPosition",value:function(r){var n=this.unprojectFlat(r),a=(0,on.Z)(n,2),s=a[0],f=a[1],v=(r[2]||0)/this.pixelsPerMeter;return[s,f,v]}},{key:"projectFlat",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return r}},{key:"unprojectFlat",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return r}}]),e}();function K5(e){var i=e.width,r=e.height,n=e.bounds,a=e.minExtent,s=a===void 0?0:a,f=e.maxZoom,v=f===void 0?24:f,g=e.padding,x=g===void 0?0:g,C=e.offset,T=C===void 0?[0,0]:C,O=(0,on.Z)(n,2),k=(0,on.Z)(O[0],2),j=k[0],X=k[1],te=(0,on.Z)(O[1],2),be=te[0],Ne=te[1];if(Number.isFinite(x)){var $e=x;x={top:$e,bottom:$e,left:$e,right:$e}}else Bp(Number.isFinite(x.top)&&Number.isFinite(x.bottom)&&Number.isFinite(x.left)&&Number.isFinite(x.right));var ot=new Ox({width:i,height:r,longitude:0,latitude:0,zoom:0}),bt=ot.project([j,Ne]),_t=ot.project([be,X]),qt=[Math.max(Math.abs(_t[0]-bt[0]),s),Math.max(Math.abs(_t[1]-bt[1]),s)],ar=[i-x.left-x.right-Math.abs(T[0])*2,r-x.top-x.bottom-Math.abs(T[1])*2];Bp(ar[0]>0&&ar[1]>0);var Pr=ar[0]/qt[0],qr=ar[1]/qt[1],gr=(x.right-x.left)/2/Pr,un=(x.bottom-x.top)/2/qr,Ln=[(_t[0]+bt[0])/2+gr,(_t[1]+bt[1])/2+un],Vn=ot.unproject(Ln),Fa=ot.zoom+Math.log2(Math.abs(Math.min(Pr,qr)));return{longitude:Vn[0],latitude:Vn[1],zoom:Math.min(Fa,v)}}var Ox=function(e){(0,Ir.Z)(i,e);function i(){var r,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a=n.width,s=n.height,f=n.latitude,v=f===void 0?0:f,g=n.longitude,x=g===void 0?0:g,C=n.zoom,T=C===void 0?0:C,O=n.pitch,k=O===void 0?0:O,j=n.bearing,X=j===void 0?0:j,te=n.altitude,be=te===void 0?1.5:te,Ne=n.nearZMultiplier,$e=n.farZMultiplier;(0,ht.Z)(this,i),a=a||1,s=s||1;var ot=Tx(T);be=Math.max(.75,be);var bt=f0([x,v],ot);bt[2]=0;var _t=X5({width:a,height:s,pitch:k,bearing:X,altitude:be,nearZMultiplier:Ne||1/s,farZMultiplier:$e||1.01}),qt=H5({height:s,center:bt,pitch:k,bearing:X,altitude:be,flipY:!0});return r=(0,wr.Z)(this,(0,Mt.Z)(i).call(this,{width:a,height:s,viewMatrix:qt,projectionMatrix:_t})),r.latitude=v,r.longitude=x,r.zoom=T,r.pitch=k,r.bearing=X,r.altitude=be,r.scale=ot,r.center=bt,r.pixelsPerMeter=Mx((0,ne.Z)((0,ne.Z)(r))).pixelsPerMeter[2],Object.freeze((0,ne.Z)((0,ne.Z)(r))),r}return(0,Pt.Z)(i,[{key:"projectFlat",value:function(n){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return f0(n,a)}},{key:"unprojectFlat",value:function(n){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return dm(n,a)}},{key:"getMapCenterByLngLatPosition",value:function(n){var a=n.lngLat,s=n.pos,f=Px(s,this.pixelUnprojectionMatrix),v=f0(a,this.scale),g=Ci.IH([],v,Ci.tk([],f)),x=Ci.IH([],this.center,g);return dm(x,this.scale)}},{key:"getLocationAtPoint",value:function(n){var a=n.lngLat,s=n.pos;return this.getMapCenterByLngLatPosition({lngLat:a,pos:s})}},{key:"fitBounds",value:function(n){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=this.width,f=this.height,v=K5(Object.assign({width:s,height:f,bounds:n},a)),g=v.longitude,x=v.latitude,C=v.zoom;return new i({width:s,height:f,longitude:g,latitude:x,zoom:C})}}]),i}(q5),$5=function(){function e(){(0,ht.Z)(this,e),(0,A.Z)(this,"viewport",void 0)}return(0,Pt.Z)(e,[{key:"syncWithMapCamera",value:function(r){var n=r.center,a=r.zoom,s=r.pitch,f=r.bearing,v=r.viewportHeight,g=r.viewportWidth;this.viewport=new Ox({width:g,height:v,longitude:n&&n[0],latitude:n&&n[1],zoom:a,pitch:s,bearing:f})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(r,n){return this.viewport.projectFlat(r,n)}}]),e}(),Q5=function(){function e(i){(0,ht.Z)(this,e),(0,A.Z)(this,"size",1e4),this.size=i||1e4}return(0,Pt.Z)(e,[{key:"setSize",value:function(r){this.size=r}},{key:"getSize",value:function(){return[this.size,this.size]}},{key:"mercatorXfromLng",value:function(r){return(180+r)/360*this.size}},{key:"mercatorYfromLat",value:function(r){return(1-(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360)*this.size}},{key:"lngFromMercatorX",value:function(r){return r/this.size*360-180}},{key:"latFromMercatorY",value:function(r){var n=180-(1-r/this.size)*360;return 360/Math.PI*Math.atan(Math.exp(n*Math.PI/180))-90}},{key:"project",value:function(r){var n=this.mercatorXfromLng(r[0]),a=this.mercatorYfromLat(r[1]);return[n,a]}},{key:"unproject",value:function(r){var n=this.lngFromMercatorX(r[0]),a=this.latFromMercatorY(r[1]);return[n,a]}}]),e}(),Rx={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},J5=["id","attributionControl","style","token","rotation","mapInstance"],Lx,kx,Dx,Fx,Bx,Nx,wd,zx,Ux,Zx,jx;function Vx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function e3(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Vx(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Vx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function t3(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var a=i.head||i.getElementsByTagName("head")[0];if(!a){a=i.createElement("head");var s=i.body||i.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(a,s):i.documentElement.appendChild(a)}var f=i.createElement("style");return f.type="text/css",f.styleSheet?f.styleSheet.cssText=e:f.appendChild(i.createTextNode(e)),a.appendChild(f),f}}t3(`.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`),window.mapboxgl=Sv();var Gx={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},r3=0,n3=12,Hx="pk.eyJ1IjoiMTg5Njk5NDg2MTkiLCJhIjoiY2s5OXVzdHlzMDVneDNscDVjdzVmeXl0dyJ9.81SQ5qaJS0xExYLbDZAGpQ",i3=(Lx=(0,Wr.b2)(),kx=(0,Wr.f3)(Ht.MapConfig),Dx=(0,Wr.f3)(Ht.IGlobalConfigService),Fx=(0,Wr.f3)(Ht.ICoordinateSystemService),Bx=(0,Wr.f3)(Ht.IEventEmitter),Lx(Nx=(wd=function(){function e(){var i=this;(0,ht.Z)(this,e),(0,A.Z)(this,"version",js.MAPBOX),(0,A.Z)(this,"map",void 0),(0,A.Z)(this,"simpleMapCoord",new Q5),(0,A.Z)(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),Ui(this,"config",zx,this),Ui(this,"configService",Ux,this),Ui(this,"coordinateSystemService",Zx,this),Ui(this,"eventEmitter",jx,this),(0,A.Z)(this,"viewport",void 0),(0,A.Z)(this,"markerContainer",void 0),(0,A.Z)(this,"cameraChangedCallback",void 0),(0,A.Z)(this,"$mapContainer",void 0),(0,A.Z)(this,"handleCameraChanged",function(){var r=i.map.getCenter().wrap(),n=r.lat,a=r.lng;i.emit("mapchange"),i.viewport.syncWithMapCamera({bearing:i.map.getBearing(),center:[a,n],viewportHeight:i.map.transform.height,pitch:i.map.getPitch(),viewportWidth:i.map.transform.width,zoom:i.map.getZoom(),cameraHeight:0});var s=i.config.offsetZoom,f=s===void 0?n3:s;i.viewport.getZoom()>f?i.coordinateSystemService.setCoordinateSystem(Ai.LNGLAT_OFFSET):i.coordinateSystemService.setCoordinateSystem(Ai.LNGLAT),i.cameraChangedCallback(i.viewport)})}return(0,Pt.Z)(e,[{key:"setBgColor",value:function(r){this.bgColor=r}},{key:"addMarkerContainer",value:function(){var r=this.map.getCanvasContainer();this.markerContainer=lo("div","l7-marker-container",r),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(r,n){j2.indexOf(r)!==-1?this.eventEmitter.on(r,n):this.map.on(Gx[r]||r,n)}},{key:"off",value:function(r,n){this.map.off(Gx[r]||r,n),this.eventEmitter.off(r,n)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){var r=this.map.transform;return[r.width,r.height]}},{key:"getType",value:function(){return"mapbox"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(r){return this.map.setZoom(r)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(r){this.map.setCenter(r)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(r){this.map.setBearing(r)}},{key:"zoomIn",value:function(r,n){this.map.zoomIn(r,n)}},{key:"zoomOut",value:function(r,n){this.map.zoomOut(r,n)}},{key:"setPitch",value:function(r){return this.map.setPitch(r)}},{key:"panTo",value:function(r){this.map.panTo(r)}},{key:"panBy",value:function(r,n){this.panTo([r,n])}},{key:"fitBounds",value:function(r,n){this.map.fitBounds(r,n)}},{key:"setMaxZoom",value:function(r){this.map.setMaxZoom(r)}},{key:"setMinZoom",value:function(r){this.map.setMinZoom(r)}},{key:"setMapStatus",value:function(r){r.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),r.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),r.dragEnable===!1&&this.map.dragPan.disable(),r.dragEnable===!0&&this.map.dragPan.enable(),r.rotateEnable===!1&&this.map.dragRotate.disable(),r.rotateEnable===!0&&this.map.dragRotate.enable(),r.keyboardEnable===!1&&this.map.keyboard.disable(),r.keyboardEnable===!0&&this.map.keyboard.enable(),r.zoomEnable===!1&&this.map.scrollZoom.disable(),r.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(r,n){this.map.flyTo({zoom:r,center:n})}},{key:"setMapStyle",value:function(r){this.map.setStyle(this.getMapStyle(r))}},{key:"pixelToLngLat",value:function(r){return this.map.unproject(r)}},{key:"lngLatToPixel",value:function(r){return this.map.project(r)}},{key:"containerToLngLat",value:function(r){return this.map.unproject(r)}},{key:"lngLatToContainer",value:function(r){return this.map.project(r)}},{key:"lngLatToCoord",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{x:0,y:0,z:0},a=this.lngLatToMercator(r,0),s=a.x,f=a.y;return[s-n.x,f-n.y]}},{key:"lngLatToMercator",value:function(r,n){var a=window.mapboxgl.MercatorCoordinate.fromLngLat(r,n),s=a.x,f=s===void 0?0:s,v=a.y,g=v===void 0?0:v,x=a.z,C=x===void 0?0:x;return{x:f,y:g,z:C}}},{key:"getModelMatrix",value:function(r,n,a){var s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],f=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},v=window.mapboxgl.MercatorCoordinate.fromLngLat(r,n),g=v.meterInMercatorCoordinateUnits(),x=zr();return jr(x,x,Xa.fromValues(v.x-f.x,v.y-f.y,v.z||0-f.z)),en(x,x,Xa.fromValues(g*s[0],-g*s[1],g*s[2])),ui(x,x,a[0]),Ni(x,x,a[1]),Ga(x,x,a[2]),x}},{key:"init",value:function(){var i=(0,P.Z)(N().mark(function n(){var a,s,f,v,g,x,C,T,O,k,j,X,te;return N().wrap(function(Ne){for(;;)switch(Ne.prev=Ne.next){case 0:a=this.config,s=a.id,f=s===void 0?"map":s,v=a.attributionControl,g=v===void 0?!1:v,x=a.style,C=x===void 0?"light":x,T=a.token,O=T===void 0?Hx:T,k=a.rotation,j=k===void 0?0:k,X=a.mapInstance,te=(0,Cc.Z)(a,J5),this.viewport=new $5,!X&&!window.mapboxgl&&console.error(this.configService.getSceneWarninfo("SDK")),O===Hx&&C!=="blank"&&!window.mapboxgl.accessToken&&!X&&console.warn(this.configService.getSceneWarninfo("MapToken")),!X&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=O),X?(this.map=X,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatAmapContainer(f),this.map=new window.mapboxgl.Map(e3({container:this.$mapContainer,style:this.getMapStyle(C),attributionControl:g,bearing:j},te))),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return Ne.stop()}},n,this)}));function r(){return i.apply(this,arguments)}return r}()},{key:"destroy",value:function(){var r,n;(r=this.$mapContainer)===null||r===void 0||(n=r.parentNode)===null||n===void 0||n.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(r){for(var n,a=arguments.length,s=new Array(a>1?a-1:0),f=1;f<a;f++)s[f-1]=arguments[f];(n=this.eventEmitter).emit.apply(n,[r].concat(s))}},{key:"once",value:function(r){for(var n,a=arguments.length,s=new Array(a>1?a-1:0),f=1;f<a;f++)s[f-1]=arguments[f];(n=this.eventEmitter).once.apply(n,[r].concat(s))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"meterToCoord",value:function(r,n){var a=new(Sv()).LngLat(r[0],r[1]),s=new(Sv()).LngLat(n[0],n[1]),f=a.distanceTo(s),v=Sv().MercatorCoordinate.fromLngLat({lng:r[0],lat:r[1]}),g=Sv().MercatorCoordinate.fromLngLat({lng:n[0],lat:n[1]}),x=v.x,C=v.y,T=g.x,O=g.y,k=Math.sqrt(Math.pow(x-T,2)+Math.pow(C-O,2))*4194304*2;return k/f}},{key:"exportMap",value:function(r){var n=this.map.getCanvas(),a=r==="jpg"?n==null?void 0:n.toDataURL("image/jpeg"):n==null?void 0:n.toDataURL("image/png");return a}},{key:"onCameraChanged",value:function(r){this.cameraChangedCallback=r}},{key:"creatAmapContainer",value:function(r){var n=r;typeof r=="string"&&(n=document.getElementById(r));var a=document.createElement("div");return a.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,a.id="l7_mapbox_div"+r3++,n.appendChild(a),a}},{key:"getMapStyle",value:function(r){return typeof r!="string"?r:Rx[r]?Rx[r]:r}}]),e}(),zx=jn(wd.prototype,"config",[kx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ux=jn(wd.prototype,"configService",[Dx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zx=jn(wd.prototype,"coordinateSystemService",[Fx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jx=jn(wd.prototype,"eventEmitter",[Bx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wd))||Nx);function a3(e){var i=o3();return function(){var n=(0,Mt.Z)(e),a;if(i){var s=(0,Mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,wr.Z)(this,a)}}function o3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function s3(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var a=i.head||i.getElementsByTagName("head")[0];if(!a){a=i.createElement("head");var s=i.body||i.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(a,s):i.documentElement.appendChild(a)}var f=i.createElement("style");return f.type="text/css",f.styleSheet?f.styleSheet.cssText=e:f.appendChild(i.createTextNode(e)),a.appendChild(f),f}}s3(`.mapboxgl-ctrl-logo {
 display: none !important;
}
`);var u3=function(e){(0,Ir.Z)(r,e);var i=a3(r);function r(){return(0,ht.Z)(this,r),i.apply(this,arguments)}return(0,Pt.Z)(r,[{key:"getServiceConstructor",value:function(){return i3}}]),r}(Z5);function Wx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Xx(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Wx(Object(r),!0).forEach(function(n){l3(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Wx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function l3(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function c3(e,i){return d3(e)||p3(e,i)||h3(e,i)||f3()}function f3(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function h3(e,i){if(!!e){if(typeof e=="string")return Yx(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Yx(e,i)}}function Yx(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function p3(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,f,v;try{for(r=r.call(e);!(a=(f=r.next()).done)&&(n.push(f.value),!(i&&n.length===i));a=!0);}catch(g){s=!0,v=g}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function d3(e){if(Array.isArray(e))return e}var v3=re.memo(function(e){var i=e.style,r=e.className,n=e.map,a=e.option,s=e.onSceneLoaded,f=(0,re.createRef)(),v=(0,re.useState)(),g=c3(v,2),x=g[0],C=g[1];return(0,re.useEffect)(function(){var T=new D5(Xx(Xx({id:f.current},a),{},{map:new u3(n)}));return T.on("loaded",function(){C(T),s&&s(T)}),function(){T.destroy()}},[]),(0,re.useEffect)(function(){x&&n.style&&x.setMapStyle(n.style)},[JSON.stringify(n.style)]),(0,re.useEffect)(function(){x&&n.zoom&&x.setZoom(n.zoom)},[n.zoom]),(0,re.useEffect)(function(){x&&n.center&&x.setCenter(n.center)},[JSON.stringify(n.center)]),(0,re.useEffect)(function(){x&&n.pitch!==void 0&&x.setPitch(n.pitch||0)},[n.pitch]),(0,re.useEffect)(function(){x&&n.rotation&&x.setRotation(n.rotation)},[n.rotation]),re.createElement(m.Provider,{value:x},(0,re.createElement)("div",{ref:f,style:i,className:r},x&&e.children))}),m3=v3;function qx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function HI(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?qx(Object(r),!0).forEach(function(n){g3(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):qx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function g3(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function WI(e,i){return b3(e)||x3(e,i)||_3(e,i)||y3()}function y3(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _3(e,i){if(!!e){if(typeof e=="string")return Kx(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Kx(e,i)}}function Kx(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function x3(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,f,v;try{for(r=r.call(e);!(a=(f=r.next()).done)&&(n.push(f.value),!(i&&n.length===i));a=!0);}catch(g){s=!0,v=g}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function b3(e){if(Array.isArray(e))return e}var XI=null,YI=null;function $x(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function qI(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?$x(Object(r),!0).forEach(function(n){E3(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$x(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function E3(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function KI(e,i){return w3(e)||A3(e,i)||C3(e,i)||S3()}function S3(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function C3(e,i){if(!!e){if(typeof e=="string")return Qx(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Qx(e,i)}}function Qx(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function A3(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,f,v;try{for(r=r.call(e);!(a=(f=r.next()).done)&&(n.push(f.value),!(i&&n.length===i));a=!0);}catch(g){s=!0,v=g}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function w3(e){if(Array.isArray(e))return e}var $I=null,QI=null;function JI(e,i){return I3(e)||P3(e,i)||M3(e,i)||T3()}function T3(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function M3(e,i){if(!!e){if(typeof e=="string")return Jx(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Jx(e,i)}}function Jx(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function P3(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,f,v;try{for(r=r.call(e);!(a=(f=r.next()).done)&&(n.push(f.value),!(i&&n.length===i));a=!0);}catch(g){s=!0,v=g}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function I3(e){if(Array.isArray(e))return e}var eO=null,tO=null;function eb(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function rO(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?eb(Object(r),!0).forEach(function(n){O3(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):eb(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function O3(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function nO(e,i){if(e==null)return{};var r=R3(e,i),n,a;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],!(i.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(r[n]=e[n]))}return r}function R3(e,i){if(e==null)return{};var r={},n=Object.keys(e),a,s;for(s=0;s<n.length;s++)a=n[s],!(i.indexOf(a)>=0)&&(r[a]=e[a]);return r}var iO=null,tb=U(73935);function rb(e,i){return F3(e)||D3(e,i)||k3(e,i)||L3()}function L3(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function k3(e,i){if(!!e){if(typeof e=="string")return nb(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return nb(e,i)}}function nb(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function D3(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,f,v;try{for(r=r.call(e);!(a=(f=r.next()).done)&&(n.push(f.value),!(i&&n.length===i));a=!0);}catch(g){s=!0,v=g}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function F3(e){if(Array.isArray(e))return e}var ib=re.useEffect,ab=re.useState,B3=/\B([A-Z])/g,N3=function(i){return i.replace(B3,"-$1").toLowerCase()};function aO(e){var i=e.className,r=e.style,n=e.children,a=e.position,s=ab(),f=rb(s,2),v=f[0],g=f[1],x=useSceneValue(),C=ab(function(){return document.createElement("div")}),T=rb(C,1),O=T[0];return ib(function(){var k=new Control({position:a});return k.onAdd=function(){if(i&&(O.className=i),r){var j=Object.keys(r).map(function(X){return"".concat(N3(X),":").concat(r[X])}).join(";");O.style.cssText=j}return O},k.onRemove=function(){},g(k),x.addControl(k),function(){x.removeControl(k)}},[]),ib(function(){v&&v.setPosition(a||"bottomleft")},[a]),createPortal(n,O)}var ob=(0,re.createContext)({});function oO(){return useContext(ob)}var Ff=U(96486),sO=re.useEffect,z3=re.memo(function(i){var r=i.layer,n=i.active;return r.active(n.option),null},Ff.isEqual),uO=re.useEffect,U3=re.memo(function(i){var r=i.layer,n=i.animate;return r.animate(n),null},Ff.isEqual),lO=re.useEffect,Z3=re.memo(function(i){var r=i.layer,n=i.color;return n.field?r.color(n.field,n.values):r.color(n.values),null},Ff.isEqual),j3=re.memo(function(i){var r=i.layer,n=i.filter;return n.field&&r.filter(n.field,n.values),null},Ff.isEqual),V3=re.memo(function(i){var r=i.layer,n=i.scale;return r.scale(n.values),null},Ff.isEqual),cO=re.useEffect,G3=re.memo(function(i){var r=i.layer,n=i.select;return r.select(n.option),null},Ff.isEqual),H3=re.memo(function(i){var r=i.layer,n=i.shape;return n.field?r.shape(n.field,n.values):r.shape(n.values),null},Ff.isEqual),W3=re.memo(function(i){var r=i.layer,n=i.size;return n.field?r.size(n.field,n.values):r.size(n.values),null},Ff.isEqual),X3=["data"];function Y3(e,i){if(e==null)return{};var r=q3(e,i),n,a;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],!(i.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(r[n]=e[n]))}return r}function q3(e,i){if(e==null)return{};var r={},n=Object.keys(e),a,s;for(s=0;s<n.length;s++)a=n[s],!(i.indexOf(a)>=0)&&(r[a]=e[a]);return r}var K3=re.memo(function(i){var r=i.layer,n=i.source,a=n.data,s=Y3(n,X3);return r.inited?r.setData(a,s):r.source(a,s),s.autoFit&&r.fitBounds(s&&s.fitBoundsOptions),null},Ff.isEqual),fO=re.useEffect,$3=re.memo(function(i){var r=i.layer,n=i.style;return r.style(n),null},Ff.isEqual);function Q3(e,i){return rP(e)||tP(e,i)||eP(e,i)||J3()}function J3(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function eP(e,i){if(!!e){if(typeof e=="string")return sb(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return sb(e,i)}}function sb(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function tP(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,f,v;try{for(r=r.call(e);!(a=(f=r.next()).done)&&(n.push(f.value),!(i&&n.length===i));a=!0);}catch(g){s=!0,v=g}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function rP(e){if(Array.isArray(e))return e}var Av=re.useEffect,nP=re.useState;function ub(e,i){var r=i.source,n=i.color,a=i.shape,s=i.style,f=i.size,v=i.scale,g=i.active,x=i.select,C=i.filter,T=i.animate,O=i.options,k=i.onLayerLoaded,j=ve(),X=nP(function(){var Ne;switch(e){case"polygonLayer":Ne=new Xy(O);break;case"lineLayer":Ne=new wy(O);break;case"pointLayer":Ne=new Wy(O);break;case"heatmapLayer":Ne=new AS(O);break;case"rasterLayer":Ne=new Tw(O);break;case"imageLayer":Ne=new Ey(O);break;case"citybuildingLayer":Ne=new KE(O);break;default:Ne=new Xy(O)}return Ne.on("inited",function(){k&&k(Ne,j)}),Ne}),te=Q3(X,1),be=te[0];return Av(function(){return j.addLayer(be),function(){j.removeLayer(be)}},[]),Av(function(){be.inited&&O&&be.updateLayerConfig(O)},[O==null?void 0:O.minZoom,O==null?void 0:O.maxZoom,O==null?void 0:O.visible]),Av(function(){be.inited&&(O==null?void 0:O.zIndex)&&be.setIndex(O.zIndex)},[O==null?void 0:O.zIndex]),Av(function(){be.inited&&(O==null?void 0:O.blend)&&be.setBlend(O.blend)},[O==null?void 0:O.blend]),Av(function(){j.render()}),re.createElement(ob.Provider,{value:be},re.createElement(K3,{layer:be,source:r}),v&&re.createElement(V3,{layer:be,scale:v}),n&&re.createElement(Z3,{layer:be,color:n}),f&&re.createElement(W3,{layer:be,size:f}),a&&re.createElement(H3,{layer:be,shape:a}),s&&re.createElement($3,{layer:be,style:s}),g&&re.createElement(z3,{layer:be,active:g}),x&&re.createElement(G3,{layer:be,select:x}),C&&re.createElement(j3,{layer:be,filter:C}),T&&re.createElement(U3,{layer:be,animate:T}),i.children)}var hO=null,pO=null,iP=re.memo(function(i){return ub("pointLayer",i)}),aP=re.memo(function(i){return ub("heatmapLayer",i)}),dO=null,vO=null,mO=null,gO=re.useEffect,yO=null,_O=null;function h0(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?h0=function(r){return typeof r}:h0=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},h0(e)}function lb(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function p0(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?lb(Object(r),!0).forEach(function(n){oP(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):lb(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function oP(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function sP(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function cb(e,i){for(var r=0;r<i.length;r++){var n=i[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function uP(e,i,r){return i&&cb(e.prototype,i),r&&cb(e,r),e}function lP(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),i&&vm(e,i)}function vm(e,i){return vm=Object.setPrototypeOf||function(n,a){return n.__proto__=a,n},vm(e,i)}function cP(e){var i=pP();return function(){var n=d0(e),a;if(i){var s=d0(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return fP(this,a)}}function fP(e,i){if(i&&(h0(i)==="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return hP(e)}function hP(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function pP(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function d0(e){return d0=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},d0(e)}var xO=function(e){lP(r,e);var i=cP(r);function r(n){var a;return sP(this,r),a=i.call(this,n),a.el=void 0,a.scene=void 0,a.popup=void 0,a.el=document.createElement("div"),a}return uP(r,[{key:"componentDidMount",value:function(){var a,s=this.props,f=s.lnglat,v=s.children,g=s.option,x=s.lngLat,C=new Ug(p0(p0({},g),{},{stopPropagation:(a=this.props.option)===null||a===void 0?void 0:a.stopPropagation}));f&&C.setLnglat(f),x&&C.setLnglat(x),v&&C.setDOMContent(this.el),this.popup=C,this.scene.addPopup(C)}},{key:"componentDidUpdate",value:function(a){var s,f,v,g,x,C,T=Array.isArray(a.lnglat)?a.lnglat:[a==null||(s=a.lnglat)===null||s===void 0?void 0:s.lng,a==null||(f=a.lnglat)===null||f===void 0?void 0:f.lat],O=Array.isArray(this.props.lnglat)?this.props.lnglat:[(v=this.props)===null||v===void 0||(g=v.lnglat)===null||g===void 0?void 0:g.lng,(x=this.props)===null||x===void 0||(C=x.lnglat)===null||C===void 0?void 0:C.lat],k=T.toString()!==O.toString();if(k){var j;this.popup.remove(),this.popup=new Ug(p0(p0({},this.props.option),{},{stopPropagation:(j=this.props.option)===null||j===void 0?void 0:j.stopPropagation})),this.popup.setLnglat(this.props.lnglat),this.popup.setDOMContent(this.el),this.scene.addPopup(this.popup)}}},{key:"componentWillUnmount",value:function(){this.popup.remove()}},{key:"render",value:function(){var a=this;return re.createElement(m.Consumer,{},function(s){return s&&(a.scene=s),(0,tb.createPortal)(a.props.children,a.el)})}}]),r}(re.PureComponent);function v0(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?v0=function(r){return typeof r}:v0=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},v0(e)}function dP(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function fb(e,i){for(var r=0;r<i.length;r++){var n=i[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function vP(e,i,r){return i&&fb(e.prototype,i),r&&fb(e,r),e}function mP(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),i&&mm(e,i)}function mm(e,i){return mm=Object.setPrototypeOf||function(n,a){return n.__proto__=a,n},mm(e,i)}function gP(e){var i=xP();return function(){var n=m0(e),a;if(i){var s=m0(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return yP(this,a)}}function yP(e,i){if(i&&(v0(i)==="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return _P(e)}function _P(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function xP(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function m0(e){return m0=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},m0(e)}var bO=function(e){mP(r,e);var i=gP(r);function r(n){var a;return dP(this,r),a=i.call(this,n),a.el=void 0,a.scene=void 0,a.marker=void 0,a.el=document.createElement("div"),a}return vP(r,[{key:"componentDidMount",value:function(){var a=this.props,s=a.lnglat,f=a.children,v=a.option,g=a.onMarkerLoaded,x=new Dg(v);s&&x.setLnglat(s),f&&x.setElement(this.el),this.marker=x,g&&g(x),this.scene.addMarker(x)}},{key:"componentDidUpdate",value:function(a){var s,f=(a==null?void 0:a.lnglat.toString())!==((s=this.props)===null||s===void 0?void 0:s.lnglat.toString());f&&this.marker.setLnglat(this.props.lnglat)}},{key:"componentWillUnmount",value:function(){this.marker&&this.marker.remove()}},{key:"render",value:function(){var a=this;return re.createElement(m.Consumer,{},function(s){return s&&(a.scene=s),(0,tb.createPortal)(a.props.children,a.el)})}}]),r}(re.PureComponent),EO=re.useEffect,SO=null,CO=null,AO=re.useEffect,wO=null},66213:function(It,$,U){"use strict";U.d($,{Z:function(){return m}});var ae=U(77608);function re(ve,Z){for(;!Object.prototype.hasOwnProperty.call(ve,Z)&&(ve=(0,ae.Z)(ve),ve!==null););return ve}function m(){return typeof Reflect!="undefined"&&Reflect.get?m=Reflect.get.bind():m=function(Z,le,fe){var Le=re(Z,le);if(!!Le){var J=Object.getOwnPropertyDescriptor(Le,le);return J.get?J.get.call(arguments.length<3?Z:fe):J.value}},m.apply(this,arguments)}},31795:function(It,$,U){var ae=U(75752);It.exports.geometry=re,It.exports.ring=ve;function re(le){var fe=0,Le;switch(le.type){case"Polygon":return m(le.coordinates);case"MultiPolygon":for(Le=0;Le<le.coordinates.length;Le++)fe+=m(le.coordinates[Le]);return fe;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(Le=0;Le<le.geometries.length;Le++)fe+=re(le.geometries[Le]);return fe}}function m(le){var fe=0;if(le&&le.length>0){fe+=Math.abs(ve(le[0]));for(var Le=1;Le<le.length;Le++)fe-=Math.abs(ve(le[Le]))}return fe}function ve(le){var fe,Le,J,Xe,et,Ue,gt,rr=0,xt=le.length;if(xt>2){for(gt=0;gt<xt;gt++)gt===xt-2?(Xe=xt-2,et=xt-1,Ue=0):gt===xt-1?(Xe=xt-1,et=0,Ue=1):(Xe=gt,et=gt+1,Ue=gt+2),fe=le[Xe],Le=le[et],J=le[Ue],rr+=(Z(J[0])-Z(fe[0]))*Math.sin(Z(Le[1]));rr=rr*ae.RADIUS*ae.RADIUS/2}return rr}function Z(le){return le*Math.PI/180}},38163:function(It,$,U){var ae=U(31795);It.exports=re;function re(Le,J){switch(Le&&Le.type||null){case"FeatureCollection":return Le.features=Le.features.map(m(re,J)),Le;case"GeometryCollection":return Le.geometries=Le.geometries.map(m(re,J)),Le;case"Feature":return Le.geometry=re(Le.geometry,J),Le;case"Polygon":case"MultiPolygon":return ve(Le,J);default:return Le}}function m(Le,J){return function(Xe){return Le(Xe,J)}}function ve(Le,J){return Le.type==="Polygon"?Le.coordinates=Z(Le.coordinates,J):Le.type==="MultiPolygon"&&(Le.coordinates=Le.coordinates.map(m(Z,J))),Le}function Z(Le,J){J=!!J,Le[0]=le(Le[0],J);for(var Xe=1;Xe<Le.length;Xe++)Le[Xe]=le(Le[Xe],!J);return Le}function le(Le,J){return fe(Le)===J?Le:Le.reverse()}function fe(Le){return ae.ring(Le)>=0}},53645:function(){},9187:function(It){"use strict";It.exports=$,It.exports.default=$;function $(A,Ce,De){De=De||2;var wt=Ce&&Ce.length,mt=wt?Ce[0]*De:A.length,Bt=U(A,0,mt,De,!0),Kt=[];if(!Bt||Bt.next===Bt.prev)return Kt;var Cr,ei,vn,di,Wn,si,vi;if(wt&&(Bt=fe(A,Ce,Bt,De)),A.length>80*De){Cr=vn=A[0],ei=di=A[1];for(var qn=De;qn<mt;qn+=De)Wn=A[qn],si=A[qn+1],Wn<Cr&&(Cr=Wn),si<ei&&(ei=si),Wn>vn&&(vn=Wn),si>di&&(di=si);vi=Math.max(vn-Cr,di-ei),vi=vi!==0?1/vi:0}return re(Bt,Kt,De,Cr,ei,vi),Kt}function U(A,Ce,De,wt,mt){var Bt,Kt;if(mt===tn(A,Ce,De,wt)>0)for(Bt=Ce;Bt<De;Bt+=wt)Kt=Qt(Bt,A[Bt],A[Bt+1],Kt);else for(Bt=De-wt;Bt>=Ce;Bt-=wt)Kt=Qt(Bt,A[Bt],A[Bt+1],Kt);return Kt&&it(Kt,Kt.next)&&(Er(Kt),Kt=Kt.next),Kt}function ae(A,Ce){if(!A)return A;Ce||(Ce=A);var De=A,wt;do if(wt=!1,!De.steiner&&(it(De,De.next)||at(De.prev,De,De.next)===0)){if(Er(De),De=Ce=De.prev,De===De.next)break;wt=!0}else De=De.next;while(wt||De!==Ce);return Ce}function re(A,Ce,De,wt,mt,Bt,Kt){if(!!A){!Kt&&Bt&&Ue(A,wt,mt,Bt);for(var Cr=A,ei,vn;A.prev!==A.next;){if(ei=A.prev,vn=A.next,Bt?ve(A,wt,mt,Bt):m(A)){Ce.push(ei.i/De),Ce.push(A.i/De),Ce.push(vn.i/De),Er(A),A=vn.next,Cr=vn.next;continue}if(A=vn,A===Cr){Kt?Kt===1?(A=Z(ae(A),Ce,De),re(A,Ce,De,wt,mt,Bt,2)):Kt===2&&le(A,Ce,De,wt,mt,Bt):re(ae(A),Ce,De,wt,mt,Bt,1);break}}}}function m(A){var Ce=A.prev,De=A,wt=A.next;if(at(Ce,De,wt)>=0)return!1;for(var mt=A.next.next;mt!==A.prev;){if(Yt(Ce.x,Ce.y,De.x,De.y,wt.x,wt.y,mt.x,mt.y)&&at(mt.prev,mt,mt.next)>=0)return!1;mt=mt.next}return!0}function ve(A,Ce,De,wt){var mt=A.prev,Bt=A,Kt=A.next;if(at(mt,Bt,Kt)>=0)return!1;for(var Cr=mt.x<Bt.x?mt.x<Kt.x?mt.x:Kt.x:Bt.x<Kt.x?Bt.x:Kt.x,ei=mt.y<Bt.y?mt.y<Kt.y?mt.y:Kt.y:Bt.y<Kt.y?Bt.y:Kt.y,vn=mt.x>Bt.x?mt.x>Kt.x?mt.x:Kt.x:Bt.x>Kt.x?Bt.x:Kt.x,di=mt.y>Bt.y?mt.y>Kt.y?mt.y:Kt.y:Bt.y>Kt.y?Bt.y:Kt.y,Wn=rr(Cr,ei,Ce,De,wt),si=rr(vn,di,Ce,De,wt),vi=A.prevZ,qn=A.nextZ;vi&&vi.z>=Wn&&qn&&qn.z<=si;){if(vi!==A.prev&&vi!==A.next&&Yt(mt.x,mt.y,Bt.x,Bt.y,Kt.x,Kt.y,vi.x,vi.y)&&at(vi.prev,vi,vi.next)>=0||(vi=vi.prevZ,qn!==A.prev&&qn!==A.next&&Yt(mt.x,mt.y,Bt.x,Bt.y,Kt.x,Kt.y,qn.x,qn.y)&&at(qn.prev,qn,qn.next)>=0))return!1;qn=qn.nextZ}for(;vi&&vi.z>=Wn;){if(vi!==A.prev&&vi!==A.next&&Yt(mt.x,mt.y,Bt.x,Bt.y,Kt.x,Kt.y,vi.x,vi.y)&&at(vi.prev,vi,vi.next)>=0)return!1;vi=vi.prevZ}for(;qn&&qn.z<=si;){if(qn!==A.prev&&qn!==A.next&&Yt(mt.x,mt.y,Bt.x,Bt.y,Kt.x,Kt.y,qn.x,qn.y)&&at(qn.prev,qn,qn.next)>=0)return!1;qn=qn.nextZ}return!0}function Z(A,Ce,De){var wt=A;do{var mt=wt.prev,Bt=wt.next.next;!it(mt,Bt)&&Zt(mt,wt,wt.next,Bt)&&Je(mt,Bt)&&Je(Bt,mt)&&(Ce.push(mt.i/De),Ce.push(wt.i/De),Ce.push(Bt.i/De),Er(wt),Er(wt.next),wt=A=Bt),wt=wt.next}while(wt!==A);return ae(wt)}function le(A,Ce,De,wt,mt,Bt){var Kt=A;do{for(var Cr=Kt.next.next;Cr!==Kt.prev;){if(Kt.i!==Cr.i&&Et(Kt,Cr)){var ei=Qe(Kt,Cr);Kt=ae(Kt,Kt.next),ei=ae(ei,ei.next),re(Kt,Ce,De,wt,mt,Bt),re(ei,Ce,De,wt,mt,Bt);return}Cr=Cr.next}Kt=Kt.next}while(Kt!==A)}function fe(A,Ce,De,wt){var mt=[],Bt,Kt,Cr,ei,vn;for(Bt=0,Kt=Ce.length;Bt<Kt;Bt++)Cr=Ce[Bt]*wt,ei=Bt<Kt-1?Ce[Bt+1]*wt:A.length,vn=U(A,Cr,ei,wt,!1),vn===vn.next&&(vn.steiner=!0),mt.push(xt(vn));for(mt.sort(Le),Bt=0;Bt<mt.length;Bt++)De=J(mt[Bt],De),De=ae(De,De.next);return De}function Le(A,Ce){return A.x-Ce.x}function J(A,Ce){var De=Xe(A,Ce);if(!De)return Ce;var wt=Qe(De,A),mt=ae(De,De.next);return ae(wt,wt.next),Ce===De?mt:Ce}function Xe(A,Ce){var De=Ce,wt=A.x,mt=A.y,Bt=-Infinity,Kt;do{if(mt<=De.y&&mt>=De.next.y&&De.next.y!==De.y){var Cr=De.x+(mt-De.y)*(De.next.x-De.x)/(De.next.y-De.y);if(Cr<=wt&&Cr>Bt){if(Bt=Cr,Cr===wt){if(mt===De.y)return De;if(mt===De.next.y)return De.next}Kt=De.x<De.next.x?De:De.next}}De=De.next}while(De!==Ce);if(!Kt)return null;if(wt===Bt)return Kt;var ei=Kt,vn=Kt.x,di=Kt.y,Wn=Infinity,si;De=Kt;do wt>=De.x&&De.x>=vn&&wt!==De.x&&Yt(mt<di?wt:Bt,mt,vn,di,mt<di?Bt:wt,mt,De.x,De.y)&&(si=Math.abs(mt-De.y)/(wt-De.x),Je(De,A)&&(si<Wn||si===Wn&&(De.x>Kt.x||De.x===Kt.x&&et(Kt,De)))&&(Kt=De,Wn=si)),De=De.next;while(De!==ei);return Kt}function et(A,Ce){return at(A.prev,A,Ce.prev)<0&&at(Ce.next,A,A.next)<0}function Ue(A,Ce,De,wt){var mt=A;do mt.z===null&&(mt.z=rr(mt.x,mt.y,Ce,De,wt)),mt.prevZ=mt.prev,mt.nextZ=mt.next,mt=mt.next;while(mt!==A);mt.prevZ.nextZ=null,mt.prevZ=null,gt(mt)}function gt(A){var Ce,De,wt,mt,Bt,Kt,Cr,ei,vn=1;do{for(De=A,A=null,Bt=null,Kt=0;De;){for(Kt++,wt=De,Cr=0,Ce=0;Ce<vn&&(Cr++,wt=wt.nextZ,!!wt);Ce++);for(ei=vn;Cr>0||ei>0&&wt;)Cr!==0&&(ei===0||!wt||De.z<=wt.z)?(mt=De,De=De.nextZ,Cr--):(mt=wt,wt=wt.nextZ,ei--),Bt?Bt.nextZ=mt:A=mt,mt.prevZ=Bt,Bt=mt;De=wt}Bt.nextZ=null,vn*=2}while(Kt>1);return A}function rr(A,Ce,De,wt,mt){return A=32767*(A-De)*mt,Ce=32767*(Ce-wt)*mt,A=(A|A<<8)&16711935,A=(A|A<<4)&252645135,A=(A|A<<2)&858993459,A=(A|A<<1)&1431655765,Ce=(Ce|Ce<<8)&16711935,Ce=(Ce|Ce<<4)&252645135,Ce=(Ce|Ce<<2)&858993459,Ce=(Ce|Ce<<1)&1431655765,A|Ce<<1}function xt(A){var Ce=A,De=A;do(Ce.x<De.x||Ce.x===De.x&&Ce.y<De.y)&&(De=Ce),Ce=Ce.next;while(Ce!==A);return De}function Yt(A,Ce,De,wt,mt,Bt,Kt,Cr){return(mt-Kt)*(Ce-Cr)-(A-Kt)*(Bt-Cr)>=0&&(A-Kt)*(wt-Cr)-(De-Kt)*(Ce-Cr)>=0&&(De-Kt)*(Bt-Cr)-(mt-Kt)*(wt-Cr)>=0}function Et(A,Ce){return A.next.i!==Ce.i&&A.prev.i!==Ce.i&&!ft(A,Ce)&&(Je(A,Ce)&&Je(Ce,A)&&At(A,Ce)&&(at(A.prev,A,Ce.prev)||at(A,Ce.prev,Ce))||it(A,Ce)&&at(A.prev,A,A.next)>0&&at(Ce.prev,Ce,Ce.next)>0)}function at(A,Ce,De){return(Ce.y-A.y)*(De.x-Ce.x)-(Ce.x-A.x)*(De.y-Ce.y)}function it(A,Ce){return A.x===Ce.x&&A.y===Ce.y}function Zt(A,Ce,De,wt){var mt=$t(at(A,Ce,De)),Bt=$t(at(A,Ce,wt)),Kt=$t(at(De,wt,A)),Cr=$t(at(De,wt,Ce));return!!(mt!==Bt&&Kt!==Cr||mt===0&&Y(A,De,Ce)||Bt===0&&Y(A,wt,Ce)||Kt===0&&Y(De,A,wt)||Cr===0&&Y(De,Ce,wt))}function Y(A,Ce,De){return Ce.x<=Math.max(A.x,De.x)&&Ce.x>=Math.min(A.x,De.x)&&Ce.y<=Math.max(A.y,De.y)&&Ce.y>=Math.min(A.y,De.y)}function $t(A){return A>0?1:A<0?-1:0}function ft(A,Ce){var De=A;do{if(De.i!==A.i&&De.next.i!==A.i&&De.i!==Ce.i&&De.next.i!==Ce.i&&Zt(De,De.next,A,Ce))return!0;De=De.next}while(De!==A);return!1}function Je(A,Ce){return at(A.prev,A,A.next)<0?at(A,Ce,A.next)>=0&&at(A,A.prev,Ce)>=0:at(A,Ce,A.prev)<0||at(A,A.next,Ce)<0}function At(A,Ce){var De=A,wt=!1,mt=(A.x+Ce.x)/2,Bt=(A.y+Ce.y)/2;do De.y>Bt!=De.next.y>Bt&&De.next.y!==De.y&&mt<(De.next.x-De.x)*(Bt-De.y)/(De.next.y-De.y)+De.x&&(wt=!wt),De=De.next;while(De!==A);return wt}function Qe(A,Ce){var De=new Nr(A.i,A.x,A.y),wt=new Nr(Ce.i,Ce.x,Ce.y),mt=A.next,Bt=Ce.prev;return A.next=Ce,Ce.prev=A,De.next=mt,mt.prev=De,wt.next=De,De.prev=wt,Bt.next=wt,wt.prev=Bt,wt}function Qt(A,Ce,De,wt){var mt=new Nr(A,Ce,De);return wt?(mt.next=wt.next,mt.prev=wt,wt.next.prev=mt,wt.next=mt):(mt.prev=mt,mt.next=mt),mt}function Er(A){A.next.prev=A.prev,A.prev.next=A.next,A.prevZ&&(A.prevZ.nextZ=A.nextZ),A.nextZ&&(A.nextZ.prevZ=A.prevZ)}function Nr(A,Ce,De){this.i=A,this.x=Ce,this.y=De,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}$.deviation=function(A,Ce,De,wt){var mt=Ce&&Ce.length,Bt=mt?Ce[0]*De:A.length,Kt=Math.abs(tn(A,0,Bt,De));if(mt)for(var Cr=0,ei=Ce.length;Cr<ei;Cr++){var vn=Ce[Cr]*De,di=Cr<ei-1?Ce[Cr+1]*De:A.length;Kt-=Math.abs(tn(A,vn,di,De))}var Wn=0;for(Cr=0;Cr<wt.length;Cr+=3){var si=wt[Cr]*De,vi=wt[Cr+1]*De,qn=wt[Cr+2]*De;Wn+=Math.abs((A[si]-A[qn])*(A[vi+1]-A[si+1])-(A[si]-A[vi])*(A[qn+1]-A[si+1]))}return Kt===0&&Wn===0?0:Math.abs((Wn-Kt)/Kt)};function tn(A,Ce,De,wt){for(var mt=0,Bt=Ce,Kt=De-wt;Bt<De;Bt+=wt)mt+=(A[Kt]-A[Bt])*(A[Bt+1]+A[Kt+1]),Kt=Bt;return mt}$.flatten=function(A){for(var Ce=A[0][0].length,De={vertices:[],holes:[],dimensions:Ce},wt=0,mt=0;mt<A.length;mt++){for(var Bt=0;Bt<A[mt].length;Bt++)for(var Kt=0;Kt<Ce;Kt++)De.vertices.push(A[mt][Bt][Kt]);mt>0&&(wt+=A[mt-1].length,De.holes.push(wt))}return De}},67709:function(It){function $(ae){var re=ae.target||ae.srcElement;re.__resizeRAF__&&cancelAnimationFrame(re.__resizeRAF__),re.__resizeRAF__=requestAnimationFrame(function(){var m=re.__resizeTrigger__,ve=m&&m.__resizeListeners__;ve&&ve.forEach(function(Z){Z.call(m,ae)})})}var U=function(re,m){var ve=this,Z=ve.document,le,fe=Z.attachEvent;typeof navigator!="undefined"&&(le=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/));function Le(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",$)}if(!re.__resizeListeners__)if(re.__resizeListeners__=[],fe)re.__resizeTrigger__=re,re.attachEvent("onresize",$);else{getComputedStyle(re).position==="static"&&(re.style.position="relative");var J=re.__resizeTrigger__=Z.createElement("object");J.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),J.setAttribute("class","resize-sensor"),J.setAttribute("tabindex","-1"),J.setAttribute("title",""),J.__resizeElement__=re,J.onload=Le,J.type="text/html",le&&re.appendChild(J),J.data="about:blank",le||re.appendChild(J)}re.__resizeListeners__.push(m)};It.exports=typeof window=="undefined"?U:U.bind(window),It.exports.unbind=function(ae,re){var m=document.attachEvent,ve=ae.__resizeListeners__||[];if(re){var Z=ve.indexOf(re);Z!==-1&&ve.splice(Z,1)}else ve=ae.__resizeListeners__=[];if(!ve.length){if(m)ae.detachEvent("onresize",$);else if(ae.__resizeTrigger__){var le=ae.__resizeTrigger__.contentDocument,fe=le&&le.defaultView;fe&&(fe.removeEventListener("resize",$),delete fe.__resizeTrigger__),ae.__resizeTrigger__=!ae.removeChild(ae.__resizeTrigger__)}delete ae.__resizeListeners__}}},26729:function(It){"use strict";var $=Object.prototype.hasOwnProperty,U="~";function ae(){}Object.create&&(ae.prototype=Object.create(null),new ae().__proto__||(U=!1));function re(le,fe,Le){this.fn=le,this.context=fe,this.once=Le||!1}function m(le,fe,Le,J,Xe){if(typeof Le!="function")throw new TypeError("The listener must be a function");var et=new re(Le,J||le,Xe),Ue=U?U+fe:fe;return le._events[Ue]?le._events[Ue].fn?le._events[Ue]=[le._events[Ue],et]:le._events[Ue].push(et):(le._events[Ue]=et,le._eventsCount++),le}function ve(le,fe){--le._eventsCount==0?le._events=new ae:delete le._events[fe]}function Z(){this._events=new ae,this._eventsCount=0}Z.prototype.eventNames=function(){var fe=[],Le,J;if(this._eventsCount===0)return fe;for(J in Le=this._events)$.call(Le,J)&&fe.push(U?J.slice(1):J);return Object.getOwnPropertySymbols?fe.concat(Object.getOwnPropertySymbols(Le)):fe},Z.prototype.listeners=function(fe){var Le=U?U+fe:fe,J=this._events[Le];if(!J)return[];if(J.fn)return[J.fn];for(var Xe=0,et=J.length,Ue=new Array(et);Xe<et;Xe++)Ue[Xe]=J[Xe].fn;return Ue},Z.prototype.listenerCount=function(fe){var Le=U?U+fe:fe,J=this._events[Le];return J?J.fn?1:J.length:0},Z.prototype.emit=function(fe,Le,J,Xe,et,Ue){var gt=U?U+fe:fe;if(!this._events[gt])return!1;var rr=this._events[gt],xt=arguments.length,Yt,Et;if(rr.fn){switch(rr.once&&this.removeListener(fe,rr.fn,void 0,!0),xt){case 1:return rr.fn.call(rr.context),!0;case 2:return rr.fn.call(rr.context,Le),!0;case 3:return rr.fn.call(rr.context,Le,J),!0;case 4:return rr.fn.call(rr.context,Le,J,Xe),!0;case 5:return rr.fn.call(rr.context,Le,J,Xe,et),!0;case 6:return rr.fn.call(rr.context,Le,J,Xe,et,Ue),!0}for(Et=1,Yt=new Array(xt-1);Et<xt;Et++)Yt[Et-1]=arguments[Et];rr.fn.apply(rr.context,Yt)}else{var at=rr.length,it;for(Et=0;Et<at;Et++)switch(rr[Et].once&&this.removeListener(fe,rr[Et].fn,void 0,!0),xt){case 1:rr[Et].fn.call(rr[Et].context);break;case 2:rr[Et].fn.call(rr[Et].context,Le);break;case 3:rr[Et].fn.call(rr[Et].context,Le,J);break;case 4:rr[Et].fn.call(rr[Et].context,Le,J,Xe);break;default:if(!Yt)for(it=1,Yt=new Array(xt-1);it<xt;it++)Yt[it-1]=arguments[it];rr[Et].fn.apply(rr[Et].context,Yt)}}return!0},Z.prototype.on=function(fe,Le,J){return m(this,fe,Le,J,!1)},Z.prototype.once=function(fe,Le,J){return m(this,fe,Le,J,!0)},Z.prototype.removeListener=function(fe,Le,J,Xe){var et=U?U+fe:fe;if(!this._events[et])return this;if(!Le)return ve(this,et),this;var Ue=this._events[et];if(Ue.fn)Ue.fn===Le&&(!Xe||Ue.once)&&(!J||Ue.context===J)&&ve(this,et);else{for(var gt=0,rr=[],xt=Ue.length;gt<xt;gt++)(Ue[gt].fn!==Le||Xe&&!Ue[gt].once||J&&Ue[gt].context!==J)&&rr.push(Ue[gt]);rr.length?this._events[et]=rr.length===1?rr[0]:rr:ve(this,et)}return this},Z.prototype.removeAllListeners=function(fe){var Le;return fe?(Le=U?U+fe:fe,this._events[Le]&&ve(this,Le)):(this._events=new ae,this._eventsCount=0),this},Z.prototype.off=Z.prototype.removeListener,Z.prototype.addListener=Z.prototype.on,Z.prefixed=U,Z.EventEmitter=Z,It.exports=Z},7375:function(It,$){"use strict";Object.defineProperty($,"__esModule",{value:!0});var U=Symbol.for("INJECTION");function ae(le,fe,Le,J){function Xe(){return J&&!Reflect.hasMetadata(U,this,fe)&&Reflect.defineMetadata(U,Le(),this,fe),Reflect.hasMetadata(U,this,fe)?Reflect.getMetadata(U,this,fe):Le()}function et(Ue){Reflect.defineMetadata(U,Ue,this,fe)}Object.defineProperty(le,fe,{configurable:!0,enumerable:!0,get:Xe,set:et})}function re(le,fe){return function(Le){return function(J,Xe){var et=function(){return le.get(Le)};ae(J,Xe,et,fe)}}}$.makePropertyInjectDecorator=re;function m(le,fe){return function(Le,J){return function(Xe,et){var Ue=function(){return le.getNamed(Le,J)};ae(Xe,et,Ue,fe)}}}$.makePropertyInjectNamedDecorator=m;function ve(le,fe){return function(Le,J,Xe){return function(et,Ue){var gt=function(){return le.getTagged(Le,J,Xe)};ae(et,Ue,gt,fe)}}}$.makePropertyInjectTaggedDecorator=ve;function Z(le,fe){return function(Le){return function(J,Xe){var et=function(){return le.getAll(Le)};ae(J,Xe,et,fe)}}}$.makePropertyMultiInjectDecorator=Z},84879:function(It,$,U){"use strict";var ae;ae={value:!0};var re=U(7375);function m(ve,Z){Z===void 0&&(Z=!0);var le=re.makePropertyInjectDecorator(ve,Z),fe=re.makePropertyInjectNamedDecorator(ve,Z),Le=re.makePropertyInjectTaggedDecorator(ve,Z),J=re.makePropertyMultiInjectDecorator(ve,Z);return{lazyInject:le,lazyInjectNamed:fe,lazyInjectTagged:Le,lazyMultiInject:J}}$.Z=m},99934:function(It,$,U){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.tagProperty=$.tagParameter=$.decorate=void 0;var ae=U(16674),re=U(6867);function m(J,Xe,et,Ue){var gt=re.TAGGED;Z(gt,J,Xe,Ue,et)}$.tagParameter=m;function ve(J,Xe,et){var Ue=re.TAGGED_PROP;Z(Ue,J.constructor,Xe,et)}$.tagProperty=ve;function Z(J,Xe,et,Ue,gt){var rr={},xt=typeof gt=="number",Yt=gt!==void 0&&xt?gt.toString():et;if(xt&&et!==void 0)throw new Error(ae.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(J,Xe)&&(rr=Reflect.getMetadata(J,Xe));var Et=rr[Yt];if(!Array.isArray(Et))Et=[];else for(var at=0,it=Et;at<it.length;at++){var Zt=it[at];if(Zt.key===Ue.key)throw new Error(ae.DUPLICATED_METADATA+" "+Zt.key.toString())}Et.push(Ue),rr[Yt]=Et,Reflect.defineMetadata(J,rr,Xe)}function le(J,Xe){Reflect.decorate(J,Xe)}function fe(J,Xe){return function(et,Ue){Xe(et,Ue,J)}}function Le(J,Xe,et){typeof et=="number"?le([fe(et,J)],Xe):typeof et=="string"?Reflect.decorate([J],Xe,et):le([J],Xe)}$.decorate=Le},5744:function(It,$,U){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.inject=$.LazyServiceIdentifer=void 0;var ae=U(16674),re=U(6867),m=U(47738),ve=U(99934),Z=function(){function fe(Le){this._cb=Le}return fe.prototype.unwrap=function(){return this._cb()},fe}();$.LazyServiceIdentifer=Z;function le(fe){return function(Le,J,Xe){if(fe===void 0)throw new Error(ae.UNDEFINED_INJECT_ANNOTATION(Le.name));var et=new m.Metadata(re.INJECT_TAG,fe);typeof Xe=="number"?ve.tagParameter(Le,J,Xe,et):ve.tagProperty(Le,J,et)}}$.inject=le},64315:function(It,$,U){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.injectable=void 0;var ae=U(16674),re=U(6867);function m(){return function(ve){if(Reflect.hasOwnMetadata(re.PARAM_TYPES,ve))throw new Error(ae.DUPLICATED_INJECTABLE_DECORATOR);var Z=Reflect.getMetadata(re.DESIGN_PARAM_TYPES,ve)||[];return Reflect.defineMetadata(re.PARAM_TYPES,Z,ve),ve}}$.injectable=m},71693:function(It,$,U){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.multiInject=void 0;var ae=U(6867),re=U(47738),m=U(99934);function ve(Z){return function(le,fe,Le){var J=new re.Metadata(ae.MULTI_INJECT_TAG,Z);typeof Le=="number"?m.tagParameter(le,fe,Le,J):m.tagProperty(le,fe,J)}}$.multiInject=ve},38085:function(It,$,U){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.named=void 0;var ae=U(6867),re=U(47738),m=U(99934);function ve(Z){return function(le,fe,Le){var J=new re.Metadata(ae.NAMED_TAG,Z);typeof Le=="number"?m.tagParameter(le,fe,Le,J):m.tagProperty(le,fe,J)}}$.named=ve},6515:function(It,$,U){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.optional=void 0;var ae=U(6867),re=U(47738),m=U(99934);function ve(){return function(Z,le,fe){var Le=new re.Metadata(ae.OPTIONAL_TAG,!0);typeof fe=="number"?m.tagParameter(Z,le,fe,Le):m.tagProperty(Z,le,Le)}}$.optional=ve},7014:function(It,$,U){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.postConstruct=void 0;var ae=U(16674),re=U(6867),m=U(47738);function ve(){return function(Z,le,fe){var Le=new m.Metadata(re.POST_CONSTRUCT,le);if(Reflect.hasOwnMetadata(re.POST_CONSTRUCT,Z.constructor))throw new Error(ae.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(re.POST_CONSTRUCT,Le,Z.constructor)}}$.postConstruct=ve},32052:function(It,$,U){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.tagged=void 0;var ae=U(47738),re=U(99934);function m(ve,Z){return function(le,fe,Le){var J=new ae.Metadata(ve,Z);typeof Le=="number"?re.tagParameter(le,fe,Le,J):re.tagProperty(le,fe,J)}}$.tagged=m},55638:function(It,$,U){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.targetName=void 0;var ae=U(6867),re=U(47738),m=U(99934);function ve(Z){return function(le,fe,Le){var J=new re.Metadata(ae.NAME_TAG,Z);m.tagParameter(le,fe,Le,J)}}$.targetName=ve},86757:function(It,$,U){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.unmanaged=void 0;var ae=U(6867),re=U(47738),m=U(99934);function ve(){return function(Z,le,fe){var Le=new re.Metadata(ae.UNMANAGED_TAG,!0);m.tagParameter(Z,le,fe,Le)}}$.unmanaged=ve},44290:function(It,$,U){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.Binding=void 0;var ae=U(28421),re=U(37791),m=function(){function ve(Z,le){this.id=re.id(),this.activated=!1,this.serviceIdentifier=Z,this.scope=le,this.type=ae.BindingTypeEnum.Invalid,this.constraint=function(fe){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return ve.prototype.clone=function(){var Z=new ve(this.serviceIdentifier,this.scope);return Z.activated=Z.scope===ae.BindingScopeEnum.Singleton?this.activated:!1,Z.implementationType=this.implementationType,Z.dynamicValue=this.dynamicValue,Z.scope=this.scope,Z.type=this.type,Z.factory=this.factory,Z.provider=this.provider,Z.constraint=this.constraint,Z.onActivation=this.onActivation,Z.cache=this.cache,Z},ve}();$.Binding=m},23184:function(It,$){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.BindingCount=void 0;var U={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};$.BindingCount=U},16674:function(It,$){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.STACK_OVERFLOW=$.CIRCULAR_DEPENDENCY_IN_FACTORY=$.POST_CONSTRUCT_ERROR=$.MULTIPLE_POST_CONSTRUCT_METHODS=$.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=$.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=$.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=$.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=$.ARGUMENTS_LENGTH_MISMATCH=$.INVALID_DECORATOR_OPERATION=$.INVALID_TO_SELF_VALUE=$.INVALID_FUNCTION_BINDING=$.INVALID_MIDDLEWARE_RETURN=$.NO_MORE_SNAPSHOTS_AVAILABLE=$.INVALID_BINDING_TYPE=$.NOT_IMPLEMENTED=$.CIRCULAR_DEPENDENCY=$.UNDEFINED_INJECT_ANNOTATION=$.MISSING_INJECT_ANNOTATION=$.MISSING_INJECTABLE_ANNOTATION=$.NOT_REGISTERED=$.CANNOT_UNBIND=$.AMBIGUOUS_MATCH=$.KEY_NOT_FOUND=$.NULL_ARGUMENT=$.DUPLICATED_METADATA=$.DUPLICATED_INJECTABLE_DECORATOR=void 0,$.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",$.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",$.NULL_ARGUMENT="NULL argument",$.KEY_NOT_FOUND="Key Not Found",$.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",$.CANNOT_UNBIND="Could not unbind serviceIdentifier:",$.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",$.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",$.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var U=function(ve){return"@inject called with undefined this could mean that the class "+ve+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};$.UNDEFINED_INJECT_ANNOTATION=U,$.CIRCULAR_DEPENDENCY="Circular dependency found:",$.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",$.INVALID_BINDING_TYPE="Invalid binding type:",$.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",$.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",$.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",$.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",$.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var ae=function(){for(var ve=[],Z=0;Z<arguments.length;Z++)ve[Z]=arguments[Z];return"The number of constructor arguments in the derived class "+(ve[0]+" must be >= than the number of constructor arguments of its base class.")};$.ARGUMENTS_LENGTH_MISMATCH=ae,$.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",$.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",$.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",$.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",$.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";var re=function(){for(var ve=[],Z=0;Z<arguments.length;Z++)ve[Z]=arguments[Z];return"@postConstruct error in class "+ve[0]+": "+ve[1]};$.POST_CONSTRUCT_ERROR=re;var m=function(){for(var ve=[],Z=0;Z<arguments.length;Z++)ve[Z]=arguments[Z];return"It looks like there is a circular dependency "+("in one of the '"+ve[0]+"' bindings. Please investigate bindings with")+("service identifier '"+ve[1]+"'.")};$.CIRCULAR_DEPENDENCY_IN_FACTORY=m,$.STACK_OVERFLOW="Maximum call stack size exceeded"},28421:function(It,$){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.TargetTypeEnum=$.BindingTypeEnum=$.BindingScopeEnum=void 0;var U={Request:"Request",Singleton:"Singleton",Transient:"Transient"};$.BindingScopeEnum=U;var ae={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};$.BindingTypeEnum=ae;var re={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};$.TargetTypeEnum=re},6867:function(It,$){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.NON_CUSTOM_TAG_KEYS=$.POST_CONSTRUCT=$.DESIGN_PARAM_TYPES=$.PARAM_TYPES=$.TAGGED_PROP=$.TAGGED=$.MULTI_INJECT_TAG=$.INJECT_TAG=$.OPTIONAL_TAG=$.UNMANAGED_TAG=$.NAME_TAG=$.NAMED_TAG=void 0,$.NAMED_TAG="named",$.NAME_TAG="name",$.UNMANAGED_TAG="unmanaged",$.OPTIONAL_TAG="optional",$.INJECT_TAG="inject",$.MULTI_INJECT_TAG="multi_inject",$.TAGGED="inversify:tagged",$.TAGGED_PROP="inversify:tagged_props",$.PARAM_TYPES="inversify:paramtypes",$.DESIGN_PARAM_TYPES="design:paramtypes",$.POST_CONSTRUCT="post_construct";function U(){return[$.INJECT_TAG,$.MULTI_INJECT_TAG,$.NAME_TAG,$.UNMANAGED_TAG,$.NAMED_TAG,$.OPTIONAL_TAG]}$.NON_CUSTOM_TAG_KEYS=U()},51389:function(It,$,U){"use strict";var ae=this&&this.__awaiter||function(Et,at,it,Zt){function Y($t){return $t instanceof it?$t:new it(function(ft){ft($t)})}return new(it||(it=Promise))(function($t,ft){function Je(Qt){try{Qe(Zt.next(Qt))}catch(Er){ft(Er)}}function At(Qt){try{Qe(Zt.throw(Qt))}catch(Er){ft(Er)}}function Qe(Qt){Qt.done?$t(Qt.value):Y(Qt.value).then(Je,At)}Qe((Zt=Zt.apply(Et,at||[])).next())})},re=this&&this.__generator||function(Et,at){var it={label:0,sent:function(){if($t[0]&1)throw $t[1];return $t[1]},trys:[],ops:[]},Zt,Y,$t,ft;return ft={next:Je(0),throw:Je(1),return:Je(2)},typeof Symbol=="function"&&(ft[Symbol.iterator]=function(){return this}),ft;function Je(Qe){return function(Qt){return At([Qe,Qt])}}function At(Qe){if(Zt)throw new TypeError("Generator is already executing.");for(;it;)try{if(Zt=1,Y&&($t=Qe[0]&2?Y.return:Qe[0]?Y.throw||(($t=Y.return)&&$t.call(Y),0):Y.next)&&!($t=$t.call(Y,Qe[1])).done)return $t;switch(Y=0,$t&&(Qe=[Qe[0]&2,$t.value]),Qe[0]){case 0:case 1:$t=Qe;break;case 4:return it.label++,{value:Qe[1],done:!1};case 5:it.label++,Y=Qe[1],Qe=[0];continue;case 7:Qe=it.ops.pop(),it.trys.pop();continue;default:if($t=it.trys,!($t=$t.length>0&&$t[$t.length-1])&&(Qe[0]===6||Qe[0]===2)){it=0;continue}if(Qe[0]===3&&(!$t||Qe[1]>$t[0]&&Qe[1]<$t[3])){it.label=Qe[1];break}if(Qe[0]===6&&it.label<$t[1]){it.label=$t[1],$t=Qe;break}if($t&&it.label<$t[2]){it.label=$t[2],it.ops.push(Qe);break}$t[2]&&it.ops.pop(),it.trys.pop();continue}Qe=at.call(Et,it)}catch(Qt){Qe=[6,Qt],Y=0}finally{Zt=$t=0}if(Qe[0]&5)throw Qe[1];return{value:Qe[0]?Qe[1]:void 0,done:!0}}},m=this&&this.__spreadArray||function(Et,at){for(var it=0,Zt=at.length,Y=Et.length;it<Zt;it++,Y++)Et[Y]=at[it];return Et};Object.defineProperty($,"__esModule",{value:!0}),$.Container=void 0;var ve=U(44290),Z=U(16674),le=U(28421),fe=U(6867),Le=U(51377),J=U(86311),Xe=U(31927),et=U(15451),Ue=U(37791),gt=U(55800),rr=U(85700),xt=U(80175),Yt=function(){function Et(at){this._appliedMiddleware=[];var it=at||{};if(typeof it!="object")throw new Error(""+Z.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(it.defaultScope===void 0)it.defaultScope=le.BindingScopeEnum.Transient;else if(it.defaultScope!==le.BindingScopeEnum.Singleton&&it.defaultScope!==le.BindingScopeEnum.Transient&&it.defaultScope!==le.BindingScopeEnum.Request)throw new Error(""+Z.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(it.autoBindInjectable===void 0)it.autoBindInjectable=!1;else if(typeof it.autoBindInjectable!="boolean")throw new Error(""+Z.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(it.skipBaseClassChecks===void 0)it.skipBaseClassChecks=!1;else if(typeof it.skipBaseClassChecks!="boolean")throw new Error(""+Z.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:it.autoBindInjectable,defaultScope:it.defaultScope,skipBaseClassChecks:it.skipBaseClassChecks},this.id=Ue.id(),this._bindingDictionary=new xt.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new Le.MetadataReader}return Et.merge=function(at,it){for(var Zt=[],Y=2;Y<arguments.length;Y++)Zt[Y-2]=arguments[Y];var $t=new Et,ft=m([at,it],Zt).map(function(Qe){return J.getBindingDictionary(Qe)}),Je=J.getBindingDictionary($t);function At(Qe,Qt){Qe.traverse(function(Er,Nr){Nr.forEach(function(tn){Qt.add(tn.serviceIdentifier,tn.clone())})})}return ft.forEach(function(Qe){At(Qe,Je)}),$t},Et.prototype.load=function(){for(var at=[],it=0;it<arguments.length;it++)at[it]=arguments[it];for(var Zt=this._getContainerModuleHelpersFactory(),Y=0,$t=at;Y<$t.length;Y++){var ft=$t[Y],Je=Zt(ft.id);ft.registry(Je.bindFunction,Je.unbindFunction,Je.isboundFunction,Je.rebindFunction)}},Et.prototype.loadAsync=function(){for(var at=[],it=0;it<arguments.length;it++)at[it]=arguments[it];return ae(this,void 0,void 0,function(){var Zt,Y,$t,ft,Je;return re(this,function(At){switch(At.label){case 0:Zt=this._getContainerModuleHelpersFactory(),Y=0,$t=at,At.label=1;case 1:return Y<$t.length?(ft=$t[Y],Je=Zt(ft.id),[4,ft.registry(Je.bindFunction,Je.unbindFunction,Je.isboundFunction,Je.rebindFunction)]):[3,4];case 2:At.sent(),At.label=3;case 3:return Y++,[3,1];case 4:return[2]}})})},Et.prototype.unload=function(){for(var at=this,it=[],Zt=0;Zt<arguments.length;Zt++)it[Zt]=arguments[Zt];var Y=function($t){return function(ft){return ft.moduleId===$t}};it.forEach(function($t){var ft=Y($t.id);at._bindingDictionary.removeByCondition(ft)})},Et.prototype.bind=function(at){var it=this.options.defaultScope||le.BindingScopeEnum.Transient,Zt=new ve.Binding(at,it);return this._bindingDictionary.add(at,Zt),new et.BindingToSyntax(Zt)},Et.prototype.rebind=function(at){return this.unbind(at),this.bind(at)},Et.prototype.unbind=function(at){try{this._bindingDictionary.remove(at)}catch(it){throw new Error(Z.CANNOT_UNBIND+" "+gt.getServiceIdentifierAsString(at))}},Et.prototype.unbindAll=function(){this._bindingDictionary=new xt.Lookup},Et.prototype.isBound=function(at){var it=this._bindingDictionary.hasKey(at);return!it&&this.parent&&(it=this.parent.isBound(at)),it},Et.prototype.isBoundNamed=function(at,it){return this.isBoundTagged(at,fe.NAMED_TAG,it)},Et.prototype.isBoundTagged=function(at,it,Zt){var Y=!1;if(this._bindingDictionary.hasKey(at)){var $t=this._bindingDictionary.get(at),ft=J.createMockRequest(this,at,it,Zt);Y=$t.some(function(Je){return Je.constraint(ft)})}return!Y&&this.parent&&(Y=this.parent.isBoundTagged(at,it,Zt)),Y},Et.prototype.snapshot=function(){this._snapshots.push(rr.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},Et.prototype.restore=function(){var at=this._snapshots.pop();if(at===void 0)throw new Error(Z.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=at.bindings,this._middleware=at.middleware},Et.prototype.createChild=function(at){var it=new Et(at||this.options);return it.parent=this,it},Et.prototype.applyMiddleware=function(){for(var at=[],it=0;it<arguments.length;it++)at[it]=arguments[it];this._appliedMiddleware=this._appliedMiddleware.concat(at);var Zt=this._middleware?this._middleware:this._planAndResolve();this._middleware=at.reduce(function(Y,$t){return $t(Y)},Zt)},Et.prototype.applyCustomMetadataReader=function(at){this._metadataReader=at},Et.prototype.get=function(at){return this._get(!1,!1,le.TargetTypeEnum.Variable,at)},Et.prototype.getTagged=function(at,it,Zt){return this._get(!1,!1,le.TargetTypeEnum.Variable,at,it,Zt)},Et.prototype.getNamed=function(at,it){return this.getTagged(at,fe.NAMED_TAG,it)},Et.prototype.getAll=function(at){return this._get(!0,!0,le.TargetTypeEnum.Variable,at)},Et.prototype.getAllTagged=function(at,it,Zt){return this._get(!1,!0,le.TargetTypeEnum.Variable,at,it,Zt)},Et.prototype.getAllNamed=function(at,it){return this.getAllTagged(at,fe.NAMED_TAG,it)},Et.prototype.resolve=function(at){var it=this.createChild();return it.bind(at).toSelf(),this._appliedMiddleware.forEach(function(Zt){it.applyMiddleware(Zt)}),it.get(at)},Et.prototype._getContainerModuleHelpersFactory=function(){var at=this,it=function(Je,At){Je._binding.moduleId=At},Zt=function(Je){return function(At){var Qe=at.bind.bind(at),Qt=Qe(At);return it(Qt,Je),Qt}},Y=function(Je){return function(At){var Qe=at.unbind.bind(at);Qe(At)}},$t=function(Je){return function(At){var Qe=at.isBound.bind(at);return Qe(At)}},ft=function(Je){return function(At){var Qe=at.rebind.bind(at),Qt=Qe(At);return it(Qt,Je),Qt}};return function(Je){return{bindFunction:Zt(Je),isboundFunction:$t(Je),rebindFunction:ft(Je),unbindFunction:Y(Je)}}},Et.prototype._get=function(at,it,Zt,Y,$t,ft){var Je=null,At={avoidConstraints:at,contextInterceptor:function(Qe){return Qe},isMultiInject:it,key:$t,serviceIdentifier:Y,targetType:Zt,value:ft};if(this._middleware){if(Je=this._middleware(At),Je==null)throw new Error(Z.INVALID_MIDDLEWARE_RETURN)}else Je=this._planAndResolve()(At);return Je},Et.prototype._planAndResolve=function(){var at=this;return function(it){var Zt=J.plan(at._metadataReader,at,it.isMultiInject,it.targetType,it.serviceIdentifier,it.key,it.value,it.avoidConstraints);Zt=it.contextInterceptor(Zt);var Y=Xe.resolve(Zt);return Y}},Et}();$.Container=Yt},33244:function(It,$,U){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.AsyncContainerModule=$.ContainerModule=void 0;var ae=U(37791),re=function(){function ve(Z){this.id=ae.id(),this.registry=Z}return ve}();$.ContainerModule=re;var m=function(){function ve(Z){this.id=ae.id(),this.registry=Z}return ve}();$.AsyncContainerModule=m},85700:function(It,$){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.ContainerSnapshot=void 0;var U=function(){function ae(){}return ae.of=function(re,m){var ve=new ae;return ve.bindings=re,ve.middleware=m,ve},ae}();$.ContainerSnapshot=U},80175:function(It,$,U){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.Lookup=void 0;var ae=U(16674),re=function(){function m(){this._map=new Map}return m.prototype.getMap=function(){return this._map},m.prototype.add=function(ve,Z){if(ve==null)throw new Error(ae.NULL_ARGUMENT);if(Z==null)throw new Error(ae.NULL_ARGUMENT);var le=this._map.get(ve);le!==void 0?(le.push(Z),this._map.set(ve,le)):this._map.set(ve,[Z])},m.prototype.get=function(ve){if(ve==null)throw new Error(ae.NULL_ARGUMENT);var Z=this._map.get(ve);if(Z!==void 0)return Z;throw new Error(ae.KEY_NOT_FOUND)},m.prototype.remove=function(ve){if(ve==null)throw new Error(ae.NULL_ARGUMENT);if(!this._map.delete(ve))throw new Error(ae.KEY_NOT_FOUND)},m.prototype.removeByCondition=function(ve){var Z=this;this._map.forEach(function(le,fe){var Le=le.filter(function(J){return!ve(J)});Le.length>0?Z._map.set(fe,Le):Z._map.delete(fe)})},m.prototype.hasKey=function(ve){if(ve==null)throw new Error(ae.NULL_ARGUMENT);return this._map.has(ve)},m.prototype.clone=function(){var ve=new m;return this._map.forEach(function(Z,le){Z.forEach(function(fe){return ve.add(le,fe.clone())})}),ve},m.prototype.traverse=function(ve){this._map.forEach(function(Z,le){ve(le,Z)})},m}();$.Lookup=re},86700:function(It,$,U){"use strict";var ae;ae={value:!0},ae=ae=ae=ae=ae=ae=$.GW=ae=ae=$.zY=ae=ae=ae=ae=ae=$.f3=ae=ae=$.b2=ae=ae=ae=ae=ae=$.W2=ae=void 0;var re=U(6867);ae=re;var m=U(51389);Object.defineProperty($,"W2",{enumerable:!0,get:function(){return m.Container}});var ve=U(28421);ae={enumerable:!0,get:function(){return ve.BindingScopeEnum}},ae={enumerable:!0,get:function(){return ve.BindingTypeEnum}},ae={enumerable:!0,get:function(){return ve.TargetTypeEnum}};var Z=U(33244);ae={enumerable:!0,get:function(){return Z.AsyncContainerModule}},ae={enumerable:!0,get:function(){return Z.ContainerModule}};var le=U(64315);Object.defineProperty($,"b2",{enumerable:!0,get:function(){return le.injectable}});var fe=U(32052);ae={enumerable:!0,get:function(){return fe.tagged}};var Le=U(38085);ae={enumerable:!0,get:function(){return Le.named}};var J=U(5744);Object.defineProperty($,"f3",{enumerable:!0,get:function(){return J.inject}}),ae={enumerable:!0,get:function(){return J.LazyServiceIdentifer}};var Xe=U(6515);ae={enumerable:!0,get:function(){return Xe.optional}};var et=U(86757);ae={enumerable:!0,get:function(){return et.unmanaged}};var Ue=U(71693);ae={enumerable:!0,get:function(){return Ue.multiInject}};var gt=U(55638);ae={enumerable:!0,get:function(){return gt.targetName}};var rr=U(7014);Object.defineProperty($,"zY",{enumerable:!0,get:function(){return rr.postConstruct}});var xt=U(51377);ae={enumerable:!0,get:function(){return xt.MetadataReader}};var Yt=U(37791);ae={enumerable:!0,get:function(){return Yt.id}};var Et=U(99934);Object.defineProperty($,"GW",{enumerable:!0,get:function(){return Et.decorate}});var at=U(80758);ae={enumerable:!0,get:function(){return at.traverseAncerstors}},ae={enumerable:!0,get:function(){return at.taggedConstraint}},ae={enumerable:!0,get:function(){return at.namedConstraint}},ae={enumerable:!0,get:function(){return at.typeConstraint}};var it=U(55800);ae={enumerable:!0,get:function(){return it.getServiceIdentifierAsString}};var Zt=U(70600);ae={enumerable:!0,get:function(){return Zt.multiBindToService}}},95228:function(It,$,U){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.Context=void 0;var ae=U(37791),re=function(){function m(ve){this.id=ae.id(),this.container=ve}return m.prototype.addPlan=function(ve){this.plan=ve},m.prototype.setCurrentRequest=function(ve){this.currentRequest=ve},m}();$.Context=re},47738:function(It,$,U){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.Metadata=void 0;var ae=U(6867),re=function(){function m(ve,Z){this.key=ve,this.value=Z}return m.prototype.toString=function(){return this.key===ae.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},m}();$.Metadata=re},51377:function(It,$,U){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.MetadataReader=void 0;var ae=U(6867),re=function(){function m(){}return m.prototype.getConstructorMetadata=function(ve){var Z=Reflect.getMetadata(ae.PARAM_TYPES,ve),le=Reflect.getMetadata(ae.TAGGED,ve);return{compilerGeneratedMetadata:Z,userGeneratedMetadata:le||{}}},m.prototype.getPropertiesMetadata=function(ve){var Z=Reflect.getMetadata(ae.TAGGED_PROP,ve)||[];return Z},m}();$.MetadataReader=re},55314:function(It,$){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.Plan=void 0;var U=function(){function ae(re,m){this.parentContext=re,this.rootRequest=m}return ae}();$.Plan=U},86311:function(It,$,U){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.getBindingDictionary=$.createMockRequest=$.plan=void 0;var ae=U(23184),re=U(16674),m=U(28421),ve=U(6867),Z=U(85265),le=U(55800),fe=U(95228),Le=U(47738),J=U(55314),Xe=U(6e3),et=U(6748),Ue=U(18924);function gt(Y){return Y._bindingDictionary}$.getBindingDictionary=gt;function rr(Y,$t,ft,Je,At,Qe){var Qt=Y?ve.MULTI_INJECT_TAG:ve.INJECT_TAG,Er=new Le.Metadata(Qt,ft),Nr=new Ue.Target($t,Je,ft,Er);if(At!==void 0){var tn=new Le.Metadata(At,Qe);Nr.metadata.push(tn)}return Nr}function xt(Y,$t,ft,Je,At){var Qe=at(ft.container,At.serviceIdentifier),Qt=[];return Qe.length===ae.BindingCount.NoBindingsAvailable&&ft.container.options.autoBindInjectable&&typeof At.serviceIdentifier=="function"&&Y.getConstructorMetadata(At.serviceIdentifier).compilerGeneratedMetadata&&(ft.container.bind(At.serviceIdentifier).toSelf(),Qe=at(ft.container,At.serviceIdentifier)),$t?Qt=Qe:Qt=Qe.filter(function(Er){var Nr=new et.Request(Er.serviceIdentifier,ft,Je,Er,At);return Er.constraint(Nr)}),Yt(At.serviceIdentifier,Qt,At,ft.container),Qt}function Yt(Y,$t,ft,Je){switch($t.length){case ae.BindingCount.NoBindingsAvailable:if(ft.isOptional())return $t;var At=le.getServiceIdentifierAsString(Y),Qe=re.NOT_REGISTERED;throw Qe+=le.listMetadataForTarget(At,ft),Qe+=le.listRegisteredBindingsForServiceIdentifier(Je,At,at),new Error(Qe);case ae.BindingCount.OnlyOneBindingAvailable:if(!ft.isArray())return $t;case ae.BindingCount.MultipleBindingsAvailable:default:if(ft.isArray())return $t;var At=le.getServiceIdentifierAsString(Y),Qe=re.AMBIGUOUS_MATCH+" "+At;throw Qe+=le.listRegisteredBindingsForServiceIdentifier(Je,At,at),new Error(Qe)}}function Et(Y,$t,ft,Je,At,Qe){var Qt,Er;if(At===null){Qt=xt(Y,$t,Je,null,Qe),Er=new et.Request(ft,Je,null,Qt,Qe);var Nr=new J.Plan(Je,Er);Je.addPlan(Nr)}else Qt=xt(Y,$t,Je,At,Qe),Er=At.addChildRequest(Qe.serviceIdentifier,Qt,Qe);Qt.forEach(function(tn){var A=null;if(Qe.isArray())A=Er.addChildRequest(tn.serviceIdentifier,tn,Qe);else{if(tn.cache)return;A=Er}if(tn.type===m.BindingTypeEnum.Instance&&tn.implementationType!==null){var Ce=Xe.getDependencies(Y,tn.implementationType);if(!Je.container.options.skipBaseClassChecks){var De=Xe.getBaseClassDependencyCount(Y,tn.implementationType);if(Ce.length<De){var wt=re.ARGUMENTS_LENGTH_MISMATCH(Xe.getFunctionName(tn.implementationType));throw new Error(wt)}}Ce.forEach(function(mt){Et(Y,!1,mt.serviceIdentifier,Je,A,mt)})}})}function at(Y,$t){var ft=[],Je=gt(Y);return Je.hasKey($t)?ft=Je.get($t):Y.parent!==null&&(ft=at(Y.parent,$t)),ft}function it(Y,$t,ft,Je,At,Qe,Qt,Er){Er===void 0&&(Er=!1);var Nr=new fe.Context($t),tn=rr(ft,Je,At,"",Qe,Qt);try{return Et(Y,Er,At,Nr,null,tn),Nr}catch(A){throw Z.isStackOverflowExeption(A)&&Nr.plan&&le.circularDependencyToException(Nr.plan.rootRequest),A}}$.plan=it;function Zt(Y,$t,ft,Je){var At=new Ue.Target(m.TargetTypeEnum.Variable,"",$t,new Le.Metadata(ft,Je)),Qe=new fe.Context(Y),Qt=new et.Request($t,Qe,null,[],At);return Qt}$.createMockRequest=Zt},88460:function(It,$){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.QueryableString=void 0;var U=function(){function ae(re){this.str=re}return ae.prototype.startsWith=function(re){return this.str.indexOf(re)===0},ae.prototype.endsWith=function(re){var m="",ve=re.split("").reverse().join("");return m=this.str.split("").reverse().join(""),this.startsWith.call({str:m},ve)},ae.prototype.contains=function(re){return this.str.indexOf(re)!==-1},ae.prototype.equals=function(re){return this.str===re},ae.prototype.value=function(){return this.str},ae}();$.QueryableString=U},6e3:function(It,$,U){"use strict";var ae=this&&this.__spreadArray||function(xt,Yt){for(var Et=0,at=Yt.length,it=xt.length;Et<at;Et++,it++)xt[it]=Yt[Et];return xt};Object.defineProperty($,"__esModule",{value:!0}),$.getFunctionName=$.getBaseClassDependencyCount=$.getDependencies=void 0;var re=U(5744),m=U(16674),ve=U(28421),Z=U(6867),le=U(55800);Object.defineProperty($,"getFunctionName",{enumerable:!0,get:function(){return le.getFunctionName}});var fe=U(18924);function Le(xt,Yt){var Et=le.getFunctionName(Yt),at=J(xt,Et,Yt,!1);return at}$.getDependencies=Le;function J(xt,Yt,Et,at){var it=xt.getConstructorMetadata(Et),Zt=it.compilerGeneratedMetadata;if(Zt===void 0){var Y=m.MISSING_INJECTABLE_ANNOTATION+" "+Yt+".";throw new Error(Y)}var $t=it.userGeneratedMetadata,ft=Object.keys($t),Je=Et.length===0&&ft.length>0,At=ft.length>Et.length,Qe=Je||At?ft.length:Et.length,Qt=et(at,Yt,Zt,$t,Qe),Er=Ue(xt,Et),Nr=ae(ae([],Qt),Er);return Nr}function Xe(xt,Yt,Et,at,it){var Zt=it[xt.toString()]||[],Y=rr(Zt),$t=Y.unmanaged!==!0,ft=at[xt],Je=Y.inject||Y.multiInject;if(ft=Je||ft,ft instanceof re.LazyServiceIdentifer&&(ft=ft.unwrap()),$t){var At=ft===Object,Qe=ft===Function,Qt=ft===void 0,Er=At||Qe||Qt;if(!Yt&&Er){var Nr=m.MISSING_INJECT_ANNOTATION+" argument "+xt+" in class "+Et+".";throw new Error(Nr)}var tn=new fe.Target(ve.TargetTypeEnum.ConstructorArgument,Y.targetName,ft);return tn.metadata=Zt,tn}return null}function et(xt,Yt,Et,at,it){for(var Zt=[],Y=0;Y<it;Y++){var $t=Y,ft=Xe($t,xt,Yt,Et,at);ft!==null&&Zt.push(ft)}return Zt}function Ue(xt,Yt){for(var Et=xt.getPropertiesMetadata(Yt),at=[],it=Object.keys(Et),Zt=0,Y=it;Zt<Y.length;Zt++){var $t=Y[Zt],ft=Et[$t],Je=rr(Et[$t]),At=Je.targetName||$t,Qe=Je.inject||Je.multiInject,Qt=new fe.Target(ve.TargetTypeEnum.ClassProperty,At,Qe);Qt.metadata=ft,at.push(Qt)}var Er=Object.getPrototypeOf(Yt.prototype).constructor;if(Er!==Object){var Nr=Ue(xt,Er);at=ae(ae([],at),Nr)}return at}function gt(xt,Yt){var Et=Object.getPrototypeOf(Yt.prototype).constructor;if(Et!==Object){var at=le.getFunctionName(Et),it=J(xt,at,Et,!0),Zt=it.map(function(ft){return ft.metadata.filter(function(Je){return Je.key===Z.UNMANAGED_TAG})}),Y=[].concat.apply([],Zt).length,$t=it.length-Y;return $t>0?$t:gt(xt,Et)}else return 0}$.getBaseClassDependencyCount=gt;function rr(xt){var Yt={};return xt.forEach(function(Et){Yt[Et.key.toString()]=Et.value}),{inject:Yt[Z.INJECT_TAG],multiInject:Yt[Z.MULTI_INJECT_TAG],targetName:Yt[Z.NAME_TAG],unmanaged:Yt[Z.UNMANAGED_TAG]}}},6748:function(It,$,U){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.Request=void 0;var ae=U(37791),re=function(){function m(ve,Z,le,fe,Le){this.id=ae.id(),this.serviceIdentifier=ve,this.parentContext=Z,this.parentRequest=le,this.target=Le,this.childRequests=[],this.bindings=Array.isArray(fe)?fe:[fe],this.requestScope=le===null?new Map:null}return m.prototype.addChildRequest=function(ve,Z,le){var fe=new m(ve,this.parentContext,this,Z,le);return this.childRequests.push(fe),fe},m}();$.Request=re},18924:function(It,$,U){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.Target=void 0;var ae=U(6867),re=U(37791),m=U(47738),ve=U(88460),Z=function(){function le(fe,Le,J,Xe){this.id=re.id(),this.type=fe,this.serviceIdentifier=J,this.name=new ve.QueryableString(Le||""),this.metadata=new Array;var et=null;typeof Xe=="string"?et=new m.Metadata(ae.NAMED_TAG,Xe):Xe instanceof m.Metadata&&(et=Xe),et!==null&&this.metadata.push(et)}return le.prototype.hasTag=function(fe){for(var Le=0,J=this.metadata;Le<J.length;Le++){var Xe=J[Le];if(Xe.key===fe)return!0}return!1},le.prototype.isArray=function(){return this.hasTag(ae.MULTI_INJECT_TAG)},le.prototype.matchesArray=function(fe){return this.matchesTag(ae.MULTI_INJECT_TAG)(fe)},le.prototype.isNamed=function(){return this.hasTag(ae.NAMED_TAG)},le.prototype.isTagged=function(){return this.metadata.some(function(fe){return ae.NON_CUSTOM_TAG_KEYS.every(function(Le){return fe.key!==Le})})},le.prototype.isOptional=function(){return this.matchesTag(ae.OPTIONAL_TAG)(!0)},le.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(fe){return fe.key===ae.NAMED_TAG})[0]:null},le.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(fe){return ae.NON_CUSTOM_TAG_KEYS.every(function(Le){return fe.key!==Le})}):null},le.prototype.matchesNamedTag=function(fe){return this.matchesTag(ae.NAMED_TAG)(fe)},le.prototype.matchesTag=function(fe){var Le=this;return function(J){for(var Xe=0,et=Le.metadata;Xe<et.length;Xe++){var Ue=et[Xe];if(Ue.key===fe&&Ue.value===J)return!0}return!1}},le}();$.Target=Z},52279:function(It,$,U){"use strict";var ae=this&&this.__spreadArray||function(J,Xe){for(var et=0,Ue=Xe.length,gt=J.length;et<Ue;et++,gt++)J[gt]=Xe[et];return J};Object.defineProperty($,"__esModule",{value:!0}),$.resolveInstance=void 0;var re=U(16674),m=U(28421),ve=U(6867);function Z(J,Xe,et){var Ue=Xe.filter(function(rr){return rr.target!==null&&rr.target.type===m.TargetTypeEnum.ClassProperty}),gt=Ue.map(et);return Ue.forEach(function(rr,xt){var Yt="";Yt=rr.target.name.value();var Et=gt[xt];J[Yt]=Et}),J}function le(J,Xe){return new(J.bind.apply(J,ae([void 0],Xe)))}function fe(J,Xe){if(Reflect.hasMetadata(ve.POST_CONSTRUCT,J)){var et=Reflect.getMetadata(ve.POST_CONSTRUCT,J);try{Xe[et.value]()}catch(Ue){throw new Error(re.POST_CONSTRUCT_ERROR(J.name,Ue.message))}}}function Le(J,Xe,et){var Ue=null;if(Xe.length>0){var gt=Xe.filter(function(xt){return xt.target!==null&&xt.target.type===m.TargetTypeEnum.ConstructorArgument}),rr=gt.map(et);Ue=le(J,rr),Ue=Z(Ue,Xe,et)}else Ue=new J;return fe(J,Ue),Ue}$.resolveInstance=Le},31927:function(It,$,U){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.resolve=void 0;var ae=U(16674),re=U(28421),m=U(85265),ve=U(55800),Z=U(52279),le=function(J,Xe,et){try{return et()}catch(Ue){throw m.isStackOverflowExeption(Ue)?new Error(ae.CIRCULAR_DEPENDENCY_IN_FACTORY(J,Xe.toString())):Ue}},fe=function(J){return function(Xe){Xe.parentContext.setCurrentRequest(Xe);var et=Xe.bindings,Ue=Xe.childRequests,gt=Xe.target&&Xe.target.isArray(),rr=!Xe.parentRequest||!Xe.parentRequest.target||!Xe.target||!Xe.parentRequest.target.matchesArray(Xe.target.serviceIdentifier);if(gt&&rr)return Ue.map(function(Zt){var Y=fe(J);return Y(Zt)});var xt=null;if(Xe.target.isOptional()&&et.length===0)return;var Yt=et[0],Et=Yt.scope===re.BindingScopeEnum.Singleton,at=Yt.scope===re.BindingScopeEnum.Request;if(Et&&Yt.activated)return Yt.cache;if(at&&J!==null&&J.has(Yt.id))return J.get(Yt.id);if(Yt.type===re.BindingTypeEnum.ConstantValue)xt=Yt.cache,Yt.activated=!0;else if(Yt.type===re.BindingTypeEnum.Function)xt=Yt.cache,Yt.activated=!0;else if(Yt.type===re.BindingTypeEnum.Constructor)xt=Yt.implementationType;else if(Yt.type===re.BindingTypeEnum.DynamicValue&&Yt.dynamicValue!==null)xt=le("toDynamicValue",Yt.serviceIdentifier,function(){return Yt.dynamicValue(Xe.parentContext)});else if(Yt.type===re.BindingTypeEnum.Factory&&Yt.factory!==null)xt=le("toFactory",Yt.serviceIdentifier,function(){return Yt.factory(Xe.parentContext)});else if(Yt.type===re.BindingTypeEnum.Provider&&Yt.provider!==null)xt=le("toProvider",Yt.serviceIdentifier,function(){return Yt.provider(Xe.parentContext)});else if(Yt.type===re.BindingTypeEnum.Instance&&Yt.implementationType!==null)xt=Z.resolveInstance(Yt.implementationType,Ue,fe(J));else{var it=ve.getServiceIdentifierAsString(Xe.serviceIdentifier);throw new Error(ae.INVALID_BINDING_TYPE+" "+it)}return typeof Yt.onActivation=="function"&&(xt=Yt.onActivation(Xe.parentContext,xt)),Et&&(Yt.cache=xt,Yt.activated=!0),at&&J!==null&&!J.has(Yt.id)&&J.set(Yt.id,xt),xt}};function Le(J){var Xe=fe(J.plan.rootRequest.requestScope);return Xe(J.plan.rootRequest)}$.resolve=Le},83366:function(It,$,U){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.BindingInSyntax=void 0;var ae=U(28421),re=U(71325),m=function(){function ve(Z){this._binding=Z}return ve.prototype.inRequestScope=function(){return this._binding.scope=ae.BindingScopeEnum.Request,new re.BindingWhenOnSyntax(this._binding)},ve.prototype.inSingletonScope=function(){return this._binding.scope=ae.BindingScopeEnum.Singleton,new re.BindingWhenOnSyntax(this._binding)},ve.prototype.inTransientScope=function(){return this._binding.scope=ae.BindingScopeEnum.Transient,new re.BindingWhenOnSyntax(this._binding)},ve}();$.BindingInSyntax=m},74889:function(It,$,U){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.BindingInWhenOnSyntax=void 0;var ae=U(83366),re=U(51811),m=U(98370),ve=function(){function Z(le){this._binding=le,this._bindingWhenSyntax=new m.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new re.BindingOnSyntax(this._binding),this._bindingInSyntax=new ae.BindingInSyntax(le)}return Z.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},Z.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},Z.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},Z.prototype.when=function(le){return this._bindingWhenSyntax.when(le)},Z.prototype.whenTargetNamed=function(le){return this._bindingWhenSyntax.whenTargetNamed(le)},Z.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},Z.prototype.whenTargetTagged=function(le,fe){return this._bindingWhenSyntax.whenTargetTagged(le,fe)},Z.prototype.whenInjectedInto=function(le){return this._bindingWhenSyntax.whenInjectedInto(le)},Z.prototype.whenParentNamed=function(le){return this._bindingWhenSyntax.whenParentNamed(le)},Z.prototype.whenParentTagged=function(le,fe){return this._bindingWhenSyntax.whenParentTagged(le,fe)},Z.prototype.whenAnyAncestorIs=function(le){return this._bindingWhenSyntax.whenAnyAncestorIs(le)},Z.prototype.whenNoAncestorIs=function(le){return this._bindingWhenSyntax.whenNoAncestorIs(le)},Z.prototype.whenAnyAncestorNamed=function(le){return this._bindingWhenSyntax.whenAnyAncestorNamed(le)},Z.prototype.whenAnyAncestorTagged=function(le,fe){return this._bindingWhenSyntax.whenAnyAncestorTagged(le,fe)},Z.prototype.whenNoAncestorNamed=function(le){return this._bindingWhenSyntax.whenNoAncestorNamed(le)},Z.prototype.whenNoAncestorTagged=function(le,fe){return this._bindingWhenSyntax.whenNoAncestorTagged(le,fe)},Z.prototype.whenAnyAncestorMatches=function(le){return this._bindingWhenSyntax.whenAnyAncestorMatches(le)},Z.prototype.whenNoAncestorMatches=function(le){return this._bindingWhenSyntax.whenNoAncestorMatches(le)},Z.prototype.onActivation=function(le){return this._bindingOnSyntax.onActivation(le)},Z}();$.BindingInWhenOnSyntax=ve},51811:function(It,$,U){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.BindingOnSyntax=void 0;var ae=U(98370),re=function(){function m(ve){this._binding=ve}return m.prototype.onActivation=function(ve){return this._binding.onActivation=ve,new ae.BindingWhenSyntax(this._binding)},m}();$.BindingOnSyntax=re},15451:function(It,$,U){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.BindingToSyntax=void 0;var ae=U(16674),re=U(28421),m=U(74889),ve=U(71325),Z=function(){function le(fe){this._binding=fe}return le.prototype.to=function(fe){return this._binding.type=re.BindingTypeEnum.Instance,this._binding.implementationType=fe,new m.BindingInWhenOnSyntax(this._binding)},le.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+ae.INVALID_TO_SELF_VALUE);var fe=this._binding.serviceIdentifier;return this.to(fe)},le.prototype.toConstantValue=function(fe){return this._binding.type=re.BindingTypeEnum.ConstantValue,this._binding.cache=fe,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=re.BindingScopeEnum.Singleton,new ve.BindingWhenOnSyntax(this._binding)},le.prototype.toDynamicValue=function(fe){return this._binding.type=re.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=fe,this._binding.implementationType=null,new m.BindingInWhenOnSyntax(this._binding)},le.prototype.toConstructor=function(fe){return this._binding.type=re.BindingTypeEnum.Constructor,this._binding.implementationType=fe,this._binding.scope=re.BindingScopeEnum.Singleton,new ve.BindingWhenOnSyntax(this._binding)},le.prototype.toFactory=function(fe){return this._binding.type=re.BindingTypeEnum.Factory,this._binding.factory=fe,this._binding.scope=re.BindingScopeEnum.Singleton,new ve.BindingWhenOnSyntax(this._binding)},le.prototype.toFunction=function(fe){if(typeof fe!="function")throw new Error(ae.INVALID_FUNCTION_BINDING);var Le=this.toConstantValue(fe);return this._binding.type=re.BindingTypeEnum.Function,this._binding.scope=re.BindingScopeEnum.Singleton,Le},le.prototype.toAutoFactory=function(fe){return this._binding.type=re.BindingTypeEnum.Factory,this._binding.factory=function(Le){var J=function(){return Le.container.get(fe)};return J},this._binding.scope=re.BindingScopeEnum.Singleton,new ve.BindingWhenOnSyntax(this._binding)},le.prototype.toProvider=function(fe){return this._binding.type=re.BindingTypeEnum.Provider,this._binding.provider=fe,this._binding.scope=re.BindingScopeEnum.Singleton,new ve.BindingWhenOnSyntax(this._binding)},le.prototype.toService=function(fe){this.toDynamicValue(function(Le){return Le.container.get(fe)})},le}();$.BindingToSyntax=Z},71325:function(It,$,U){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.BindingWhenOnSyntax=void 0;var ae=U(51811),re=U(98370),m=function(){function ve(Z){this._binding=Z,this._bindingWhenSyntax=new re.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new ae.BindingOnSyntax(this._binding)}return ve.prototype.when=function(Z){return this._bindingWhenSyntax.when(Z)},ve.prototype.whenTargetNamed=function(Z){return this._bindingWhenSyntax.whenTargetNamed(Z)},ve.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},ve.prototype.whenTargetTagged=function(Z,le){return this._bindingWhenSyntax.whenTargetTagged(Z,le)},ve.prototype.whenInjectedInto=function(Z){return this._bindingWhenSyntax.whenInjectedInto(Z)},ve.prototype.whenParentNamed=function(Z){return this._bindingWhenSyntax.whenParentNamed(Z)},ve.prototype.whenParentTagged=function(Z,le){return this._bindingWhenSyntax.whenParentTagged(Z,le)},ve.prototype.whenAnyAncestorIs=function(Z){return this._bindingWhenSyntax.whenAnyAncestorIs(Z)},ve.prototype.whenNoAncestorIs=function(Z){return this._bindingWhenSyntax.whenNoAncestorIs(Z)},ve.prototype.whenAnyAncestorNamed=function(Z){return this._bindingWhenSyntax.whenAnyAncestorNamed(Z)},ve.prototype.whenAnyAncestorTagged=function(Z,le){return this._bindingWhenSyntax.whenAnyAncestorTagged(Z,le)},ve.prototype.whenNoAncestorNamed=function(Z){return this._bindingWhenSyntax.whenNoAncestorNamed(Z)},ve.prototype.whenNoAncestorTagged=function(Z,le){return this._bindingWhenSyntax.whenNoAncestorTagged(Z,le)},ve.prototype.whenAnyAncestorMatches=function(Z){return this._bindingWhenSyntax.whenAnyAncestorMatches(Z)},ve.prototype.whenNoAncestorMatches=function(Z){return this._bindingWhenSyntax.whenNoAncestorMatches(Z)},ve.prototype.onActivation=function(Z){return this._bindingOnSyntax.onActivation(Z)},ve}();$.BindingWhenOnSyntax=m},98370:function(It,$,U){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.BindingWhenSyntax=void 0;var ae=U(51811),re=U(80758),m=function(){function ve(Z){this._binding=Z}return ve.prototype.when=function(Z){return this._binding.constraint=Z,new ae.BindingOnSyntax(this._binding)},ve.prototype.whenTargetNamed=function(Z){return this._binding.constraint=re.namedConstraint(Z),new ae.BindingOnSyntax(this._binding)},ve.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(Z){var le=Z.target!==null&&!Z.target.isNamed()&&!Z.target.isTagged();return le},new ae.BindingOnSyntax(this._binding)},ve.prototype.whenTargetTagged=function(Z,le){return this._binding.constraint=re.taggedConstraint(Z)(le),new ae.BindingOnSyntax(this._binding)},ve.prototype.whenInjectedInto=function(Z){return this._binding.constraint=function(le){return re.typeConstraint(Z)(le.parentRequest)},new ae.BindingOnSyntax(this._binding)},ve.prototype.whenParentNamed=function(Z){return this._binding.constraint=function(le){return re.namedConstraint(Z)(le.parentRequest)},new ae.BindingOnSyntax(this._binding)},ve.prototype.whenParentTagged=function(Z,le){return this._binding.constraint=function(fe){return re.taggedConstraint(Z)(le)(fe.parentRequest)},new ae.BindingOnSyntax(this._binding)},ve.prototype.whenAnyAncestorIs=function(Z){return this._binding.constraint=function(le){return re.traverseAncerstors(le,re.typeConstraint(Z))},new ae.BindingOnSyntax(this._binding)},ve.prototype.whenNoAncestorIs=function(Z){return this._binding.constraint=function(le){return!re.traverseAncerstors(le,re.typeConstraint(Z))},new ae.BindingOnSyntax(this._binding)},ve.prototype.whenAnyAncestorNamed=function(Z){return this._binding.constraint=function(le){return re.traverseAncerstors(le,re.namedConstraint(Z))},new ae.BindingOnSyntax(this._binding)},ve.prototype.whenNoAncestorNamed=function(Z){return this._binding.constraint=function(le){return!re.traverseAncerstors(le,re.namedConstraint(Z))},new ae.BindingOnSyntax(this._binding)},ve.prototype.whenAnyAncestorTagged=function(Z,le){return this._binding.constraint=function(fe){return re.traverseAncerstors(fe,re.taggedConstraint(Z)(le))},new ae.BindingOnSyntax(this._binding)},ve.prototype.whenNoAncestorTagged=function(Z,le){return this._binding.constraint=function(fe){return!re.traverseAncerstors(fe,re.taggedConstraint(Z)(le))},new ae.BindingOnSyntax(this._binding)},ve.prototype.whenAnyAncestorMatches=function(Z){return this._binding.constraint=function(le){return re.traverseAncerstors(le,Z)},new ae.BindingOnSyntax(this._binding)},ve.prototype.whenNoAncestorMatches=function(Z){return this._binding.constraint=function(le){return!re.traverseAncerstors(le,Z)},new ae.BindingOnSyntax(this._binding)},ve}();$.BindingWhenSyntax=m},80758:function(It,$,U){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.typeConstraint=$.namedConstraint=$.taggedConstraint=$.traverseAncerstors=void 0;var ae=U(6867),re=U(47738),m=function(fe,Le){var J=fe.parentRequest;return J!==null?Le(J)?!0:m(J,Le):!1};$.traverseAncerstors=m;var ve=function(fe){return function(Le){var J=function(Xe){return Xe!==null&&Xe.target!==null&&Xe.target.matchesTag(fe)(Le)};return J.metaData=new re.Metadata(fe,Le),J}};$.taggedConstraint=ve;var Z=ve(ae.NAMED_TAG);$.namedConstraint=Z;var le=function(fe){return function(Le){var J=null;if(Le!==null)if(J=Le.bindings[0],typeof fe=="string"){var Xe=J.serviceIdentifier;return Xe===fe}else{var et=Le.bindings[0].implementationType;return fe===et}return!1}};$.typeConstraint=le},70600:function(It,$){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.multiBindToService=void 0;var U=function(ae){return function(re){return function(){for(var m=[],ve=0;ve<arguments.length;ve++)m[ve]=arguments[ve];return m.forEach(function(Z){return ae.bind(Z).toService(re)})}}};$.multiBindToService=U},85265:function(It,$,U){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.isStackOverflowExeption=void 0;var ae=U(16674);function re(m){return m instanceof RangeError||m.message===ae.STACK_OVERFLOW}$.isStackOverflowExeption=re},37791:function(It,$){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.id=void 0;var U=0;function ae(){return U++}$.id=ae},55800:function(It,$,U){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.circularDependencyToException=$.listMetadataForTarget=$.listRegisteredBindingsForServiceIdentifier=$.getServiceIdentifierAsString=$.getFunctionName=void 0;var ae=U(16674);function re(J){if(typeof J=="function"){var Xe=J;return Xe.name}else{if(typeof J=="symbol")return J.toString();var Xe=J;return Xe}}$.getServiceIdentifierAsString=re;function m(J,Xe,et){var Ue="",gt=et(J,Xe);return gt.length!==0&&(Ue=`
Registered bindings:`,gt.forEach(function(rr){var xt="Object";rr.implementationType!==null&&(xt=Le(rr.implementationType)),Ue=Ue+`
 `+xt,rr.constraint.metaData&&(Ue=Ue+" - "+rr.constraint.metaData)})),Ue}$.listRegisteredBindingsForServiceIdentifier=m;function ve(J,Xe){return J.parentRequest===null?!1:J.parentRequest.serviceIdentifier===Xe?!0:ve(J.parentRequest,Xe)}function Z(J){function Xe(Ue,gt){gt===void 0&&(gt=[]);var rr=re(Ue.serviceIdentifier);return gt.push(rr),Ue.parentRequest!==null?Xe(Ue.parentRequest,gt):gt}var et=Xe(J);return et.reverse().join(" --> ")}function le(J){J.childRequests.forEach(function(Xe){if(ve(Xe,Xe.serviceIdentifier)){var et=Z(Xe);throw new Error(ae.CIRCULAR_DEPENDENCY+" "+et)}else le(Xe)})}$.circularDependencyToException=le;function fe(J,Xe){if(Xe.isTagged()||Xe.isNamed()){var et="",Ue=Xe.getNamedTag(),gt=Xe.getCustomTags();return Ue!==null&&(et+=Ue.toString()+`
`),gt!==null&&gt.forEach(function(rr){et+=rr.toString()+`
`})," "+J+`
 `+J+" - "+et}else return" "+J}$.listMetadataForTarget=fe;function Le(J){if(J.name)return J.name;var Xe=J.toString(),et=Xe.match(/^function\s*([^\s(]+)/);return et?et[1]:"Anonymous function: "+Xe}$.getFunctionName=Le},31745:function(It){"use strict";It.exports=U,It.exports.default=U;var $=1e20;function U(Z,le,fe,Le,J,Xe){this.fontSize=Z||24,this.buffer=le===void 0?3:le,this.cutoff=Le||.25,this.fontFamily=J||"sans-serif",this.fontWeight=Xe||"normal",this.radius=fe||8;var et=this.size=this.fontSize+this.buffer*2,Ue=et+this.buffer*2,gt=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;gt?this.canvas=my.createOffscreenCanvas(et,et,"2d"):(this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=et),this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(Ue*Ue),this.gridInner=new Float64Array(Ue*Ue),this.f=new Float64Array(Ue),this.z=new Float64Array(Ue+1),this.v=new Uint16Array(Ue),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,gt?this.middle=Math.round(et/2*1):this.middle=Math.round(et/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function ae(Z,le,fe,Le,J,Xe,et){Xe.fill($,0,le*fe),et.fill(0,0,le*fe);for(var Ue=(le-Le)/2,gt=0;gt<J;gt++)for(var rr=0;rr<Le;rr++){var xt=(gt+Ue)*le+rr+Ue,Yt=Z.data[4*(gt*Le+rr)+3]/255;if(Yt===1)Xe[xt]=0,et[xt]=$;else if(Yt===0)Xe[xt]=$,et[xt]=0;else{var Et=Math.max(0,.5-Yt),at=Math.max(0,Yt-.5);Xe[xt]=Et*Et,et[xt]=at*at}}}function re(Z,le,fe,Le,J,Xe,et){for(var Ue=0;Ue<le*fe;Ue++){var gt=Math.sqrt(Le[Ue])-Math.sqrt(J[Ue]);Z[Ue]=Math.round(255-255*(gt/Xe+et))}}U.prototype._draw=function(Z,le){var fe=this.ctx.measureText(Z),Le=fe.width,J=2*this.buffer,Xe,et,Ue,gt,rr,xt,Yt,Et;le&&this.useMetrics?(rr=Math.floor(fe.actualBoundingBoxAscent),Et=this.buffer+Math.ceil(fe.actualBoundingBoxAscent),xt=this.buffer,Yt=this.buffer,et=Math.min(this.size,Math.ceil(fe.actualBoundingBoxRight-fe.actualBoundingBoxLeft)),gt=Math.min(this.size-xt,Math.ceil(fe.actualBoundingBoxAscent+fe.actualBoundingBoxDescent)),Xe=et+J,Ue=gt+J,this.ctx.textBaseline="alphabetic"):(Xe=et=this.size,Ue=gt=this.size,rr=19*this.fontSize/24,xt=Yt=0,Et=this.middle,this.ctx.textBaseline="middle");var at;et&&gt&&(this.ctx.clearRect(Yt,xt,et,gt),this.ctx.fillText(Z,this.buffer,Et),at=this.ctx.getImageData(Yt,xt,et,gt));var it=new Uint8ClampedArray(Xe*Ue);return ae(at,Xe,Ue,et,gt,this.gridOuter,this.gridInner),m(this.gridOuter,Xe,Ue,this.f,this.v,this.z),m(this.gridInner,Xe,Ue,this.f,this.v,this.z),re(it,Xe,Ue,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:it,metrics:{width:et,height:gt,sdfWidth:Xe,sdfHeight:Ue,top:rr,left:0,advance:Le}}},U.prototype.draw=function(Z){return this._draw(Z,!1).data},U.prototype.drawWithMetrics=function(Z){return this._draw(Z,!0)};function m(Z,le,fe,Le,J,Xe){for(var et=0;et<le;et++)ve(Z,et,le,fe,Le,J,Xe);for(var Ue=0;Ue<fe;Ue++)ve(Z,Ue*le,1,le,Le,J,Xe)}function ve(Z,le,fe,Le,J,Xe,et){var Ue,gt,rr,xt;for(Xe[0]=0,et[0]=-$,et[1]=$,Ue=0;Ue<Le;Ue++)J[Ue]=Z[le+Ue*fe];for(Ue=1,gt=0,rr=0;Ue<Le;Ue++){do xt=Xe[gt],rr=(J[Ue]-J[xt]+Ue*Ue-xt*xt)/(Ue-xt)/2;while(rr<=et[gt]&&--gt>-1);gt++,Xe[gt]=Ue,et[gt]=rr,et[gt+1]=$}for(Ue=0,gt=0;Ue<Le;Ue++){for(;et[gt+1]<Ue;)gt++;xt=Xe[gt],Z[le+Ue*fe]=J[xt]+(Ue-xt)*(Ue-xt)}}},18857:function(It,$,U){"use strict";U.r($),U.d($,{Function:function(){return bu},Interpreter:function(){return ko},default:function(){return cl},evaluate:function(){return Cs},vm:function(){return ae}});var ae={};U.r(ae),U.d(ae,{Script:function(){return rc},compileFunction:function(){return vs},createContext:function(){return Il},runInContext:function(){return es},runInNewContext:function(){return of}});var re={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},m="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",ve={5:m,"5module":m+" export import",6:m+" const class extends export import super"},Z=/^in(stanceof)?$/,le="\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC",fe="\u200C\u200D\xB7\u0300-\u036F\u0387\u0483-\u0487\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u0669\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u06F0-\u06F9\u0711\u0730-\u074A\u07A6-\u07B0\u07C0-\u07C9\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0966-\u096F\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09E6-\u09EF\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A66-\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AE6-\u0AEF\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B62\u0B63\u0B66-\u0B6F\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0BE6-\u0BEF\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0CE6-\u0CEF\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D66-\u0D6F\u0D81-\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0E50-\u0E59\u0EB1\u0EB4-\u0EBC\u0EC8-\u0ECD\u0ED0-\u0ED9\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1040-\u1049\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F-\u109D\u135D-\u135F\u1369-\u1371\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u18A9\u1920-\u192B\u1930-\u193B\u1946-\u194F\u19D0-\u19DA\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AB0-\u1ABD\u1ABF\u1AC0\u1B00-\u1B04\u1B34-\u1B44\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BB0-\u1BB9\u1BE6-\u1BF3\u1C24-\u1C37\u1C40-\u1C49\u1C50-\u1C59\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u203F\u2040\u2054\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA620-\uA629\uA66F\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA82C\uA880\uA881\uA8B4-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F1\uA8FF-\uA909\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9D0-\uA9D9\uA9E5\uA9F0-\uA9F9\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA50-\uAA59\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uABF0-\uABF9\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFF10-\uFF19\uFF3F",Le=new RegExp("["+le+"]"),J=new RegExp("["+le+fe+"]");le=fe=null;var Xe=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,349,41,7,1,79,28,11,0,9,21,107,20,28,22,13,52,76,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,230,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,35,56,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,190,0,80,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,689,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,43,8,8952,286,50,2,18,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,2357,44,11,6,17,0,370,43,1301,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42717,35,4148,12,221,3,5761,15,7472,3104,541,1507,4938],et=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,370,1,154,10,176,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,161,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,19306,9,135,4,60,6,26,9,1014,0,2,54,8,3,82,0,12,1,19628,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,262,6,10,9,419,13,1495,6,110,6,6,9,4759,9,787719,239];function Ue(_,M){for(var F=65536,R=0;R<M.length;R+=2){if(F+=M[R],F>_)return!1;if(F+=M[R+1],F>=_)return!0}}function gt(_,M){return _<65?_===36:_<91?!0:_<97?_===95:_<123?!0:_<=65535?_>=170&&Le.test(String.fromCharCode(_)):M===!1?!1:Ue(_,Xe)}function rr(_,M){return _<48?_===36:_<58?!0:_<65?!1:_<91?!0:_<97?_===95:_<123?!0:_<=65535?_>=170&&J.test(String.fromCharCode(_)):M===!1?!1:Ue(_,Xe)||Ue(_,et)}var xt=function(M,F){F===void 0&&(F={}),this.label=M,this.keyword=F.keyword,this.beforeExpr=!!F.beforeExpr,this.startsExpr=!!F.startsExpr,this.isLoop=!!F.isLoop,this.isAssign=!!F.isAssign,this.prefix=!!F.prefix,this.postfix=!!F.postfix,this.binop=F.binop||null,this.updateContext=null};function Yt(_,M){return new xt(_,{beforeExpr:!0,binop:M})}var Et={beforeExpr:!0},at={startsExpr:!0},it={};function Zt(_,M){return M===void 0&&(M={}),M.keyword=_,it[_]=new xt(_,M)}var Y={num:new xt("num",at),regexp:new xt("regexp",at),string:new xt("string",at),name:new xt("name",at),eof:new xt("eof"),bracketL:new xt("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new xt("]"),braceL:new xt("{",{beforeExpr:!0,startsExpr:!0}),braceR:new xt("}"),parenL:new xt("(",{beforeExpr:!0,startsExpr:!0}),parenR:new xt(")"),comma:new xt(",",Et),semi:new xt(";",Et),colon:new xt(":",Et),dot:new xt("."),question:new xt("?",Et),questionDot:new xt("?."),arrow:new xt("=>",Et),template:new xt("template"),invalidTemplate:new xt("invalidTemplate"),ellipsis:new xt("...",Et),backQuote:new xt("`",at),dollarBraceL:new xt("${",{beforeExpr:!0,startsExpr:!0}),eq:new xt("=",{beforeExpr:!0,isAssign:!0}),assign:new xt("_=",{beforeExpr:!0,isAssign:!0}),incDec:new xt("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new xt("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:Yt("||",1),logicalAND:Yt("&&",2),bitwiseOR:Yt("|",3),bitwiseXOR:Yt("^",4),bitwiseAND:Yt("&",5),equality:Yt("==/!=/===/!==",6),relational:Yt("</>/<=/>=",7),bitShift:Yt("<</>>/>>>",8),plusMin:new xt("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:Yt("%",10),star:Yt("*",10),slash:Yt("/",10),starstar:new xt("**",{beforeExpr:!0}),coalesce:Yt("??",1),_break:Zt("break"),_case:Zt("case",Et),_catch:Zt("catch"),_continue:Zt("continue"),_debugger:Zt("debugger"),_default:Zt("default",Et),_do:Zt("do",{isLoop:!0,beforeExpr:!0}),_else:Zt("else",Et),_finally:Zt("finally"),_for:Zt("for",{isLoop:!0}),_function:Zt("function",at),_if:Zt("if"),_return:Zt("return",Et),_switch:Zt("switch"),_throw:Zt("throw",Et),_try:Zt("try"),_var:Zt("var"),_const:Zt("const"),_while:Zt("while",{isLoop:!0}),_with:Zt("with"),_new:Zt("new",{beforeExpr:!0,startsExpr:!0}),_this:Zt("this",at),_super:Zt("super",at),_class:Zt("class",at),_extends:Zt("extends",Et),_export:Zt("export"),_import:Zt("import",at),_null:Zt("null",at),_true:Zt("true",at),_false:Zt("false",at),_in:Zt("in",{beforeExpr:!0,binop:7}),_instanceof:Zt("instanceof",{beforeExpr:!0,binop:7}),_typeof:Zt("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:Zt("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:Zt("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},$t=/\r\n?|\n|\u2028|\u2029/,ft=new RegExp($t.source,"g");function Je(_,M){return _===10||_===13||!M&&(_===8232||_===8233)}var At=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,Qe=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,Qt=Object.prototype,Er=Qt.hasOwnProperty,Nr=Qt.toString;function tn(_,M){return Er.call(_,M)}var A=Array.isArray||function(_){return Nr.call(_)==="[object Array]"};function Ce(_){return new RegExp("^(?:"+_.replace(/ /g,"|")+")$")}var De=function(M,F){this.line=M,this.column=F};De.prototype.offset=function(M){return new De(this.line,this.column+M)};var wt=function(M,F,R){this.start=F,this.end=R,M.sourceFile!==null&&(this.source=M.sourceFile)};function mt(_,M){for(var F=1,R=0;;){ft.lastIndex=R;var K=ft.exec(_);if(K&&K.index<M)++F,R=K.index+K[0].length;else return new De(F,M-R)}}var Bt={ecmaVersion:10,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:!1,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1};function Kt(_){var M={};for(var F in Bt)M[F]=_&&tn(_,F)?_[F]:Bt[F];if(M.ecmaVersion>=2015&&(M.ecmaVersion-=2009),M.allowReserved==null&&(M.allowReserved=M.ecmaVersion<5),A(M.onToken)){var R=M.onToken;M.onToken=function(K){return R.push(K)}}return A(M.onComment)&&(M.onComment=Cr(M,M.onComment)),M}function Cr(_,M){return function(F,R,K,_e,je,pt){var dt={type:F?"Block":"Line",value:R,start:K,end:_e};_.locations&&(dt.loc=new wt(this,je,pt)),_.ranges&&(dt.range=[K,_e]),M.push(dt)}}var ei=1,vn=2,di=ei|vn,Wn=4,si=8,vi=16,qn=32,mi=64,aa=128;function Wi(_,M){return vn|(_?Wn:0)|(M?si:0)}var Oi=0,Ki=1,oa=2,Mi=3,da=4,$n=5,wi=function(M,F,R){this.options=M=Kt(M),this.sourceFile=M.sourceFile,this.keywords=Ce(ve[M.ecmaVersion>=6?6:M.sourceType==="module"?"5module":5]);var K="";if(M.allowReserved!==!0){for(var _e=M.ecmaVersion;!(K=re[_e]);_e--);M.sourceType==="module"&&(K+=" await")}this.reservedWords=Ce(K);var je=(K?K+" ":"")+re.strict;this.reservedWordsStrict=Ce(je),this.reservedWordsStrictBind=Ce(je+" "+re.strictBind),this.input=String(F),this.containsEsc=!1,R?(this.pos=R,this.lineStart=this.input.lastIndexOf(`
`,R-1)+1,this.curLine=this.input.slice(0,this.lineStart).split($t).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=Y.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule=M.sourceType==="module",this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports={},this.pos===0&&M.allowHashBang&&this.input.slice(0,2)==="#!"&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(ei),this.regexpState=null},ji={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0}};wi.prototype.parse=function(){var M=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(M)},ji.inFunction.get=function(){return(this.currentVarScope().flags&vn)>0},ji.inGenerator.get=function(){return(this.currentVarScope().flags&si)>0},ji.inAsync.get=function(){return(this.currentVarScope().flags&Wn)>0},ji.allowSuper.get=function(){return(this.currentThisScope().flags&mi)>0},ji.allowDirectSuper.get=function(){return(this.currentThisScope().flags&aa)>0},ji.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())},wi.prototype.inNonArrowFunction=function(){return(this.currentThisScope().flags&vn)>0},wi.extend=function(){for(var M=[],F=arguments.length;F--;)M[F]=arguments[F];for(var R=this,K=0;K<M.length;K++)R=M[K](R);return R},wi.parse=function(M,F){return new this(F,M).parse()},wi.parseExpressionAt=function(M,F,R){var K=new this(R,M,F);return K.nextToken(),K.parseExpression()},wi.tokenizer=function(M,F){return new this(F,M)},Object.defineProperties(wi.prototype,ji);var $i=wi.prototype,zo=/^(?:'((?:\\.|[^'\\])*?)'|"((?:\\.|[^"\\])*?)")/;$i.strictDirective=function(_){for(;;){Qe.lastIndex=_,_+=Qe.exec(this.input)[0].length;var M=zo.exec(this.input.slice(_));if(!M)return!1;if((M[1]||M[2])==="use strict"){Qe.lastIndex=_+M[0].length;var F=Qe.exec(this.input),R=F.index+F[0].length,K=this.input.charAt(R);return K===";"||K==="}"||$t.test(F[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(K)||K==="!"&&this.input.charAt(R+1)==="=")}_+=M[0].length,Qe.lastIndex=_,_+=Qe.exec(this.input)[0].length,this.input[_]===";"&&_++}},$i.eat=function(_){return this.type===_?(this.next(),!0):!1},$i.isContextual=function(_){return this.type===Y.name&&this.value===_&&!this.containsEsc},$i.eatContextual=function(_){return this.isContextual(_)?(this.next(),!0):!1},$i.expectContextual=function(_){this.eatContextual(_)||this.unexpected()},$i.canInsertSemicolon=function(){return this.type===Y.eof||this.type===Y.braceR||$t.test(this.input.slice(this.lastTokEnd,this.start))},$i.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},$i.semicolon=function(){!this.eat(Y.semi)&&!this.insertSemicolon()&&this.unexpected()},$i.afterTrailingComma=function(_,M){if(this.type===_)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),M||this.next(),!0},$i.expect=function(_){this.eat(_)||this.unexpected()},$i.unexpected=function(_){this.raise(_!=null?_:this.start,"Unexpected token")};function me(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1}$i.checkPatternErrors=function(_,M){if(!!_){_.trailingComma>-1&&this.raiseRecoverable(_.trailingComma,"Comma is not permitted after the rest element");var F=M?_.parenthesizedAssign:_.parenthesizedBind;F>-1&&this.raiseRecoverable(F,"Parenthesized pattern")}},$i.checkExpressionErrors=function(_,M){if(!_)return!1;var F=_.shorthandAssign,R=_.doubleProto;if(!M)return F>=0||R>=0;F>=0&&this.raise(F,"Shorthand property assignments are valid only in destructuring patterns"),R>=0&&this.raiseRecoverable(R,"Redefinition of __proto__ property")},$i.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},$i.isSimpleAssignTarget=function(_){return _.type==="ParenthesizedExpression"?this.isSimpleAssignTarget(_.expression):_.type==="Identifier"||_.type==="MemberExpression"};var Dn=wi.prototype;Dn.parseTopLevel=function(_){var M={};for(_.body||(_.body=[]);this.type!==Y.eof;){var F=this.parseStatement(null,!0,M);_.body.push(F)}if(this.inModule)for(var R=0,K=Object.keys(this.undefinedExports);R<K.length;R+=1){var _e=K[R];this.raiseRecoverable(this.undefinedExports[_e].start,"Export '"+_e+"' is not defined")}return this.adaptDirectivePrologue(_.body),this.next(),_.sourceType=this.options.sourceType,this.finishNode(_,"Program")};var Za={kind:"loop"},hs={kind:"switch"};Dn.isLet=function(_){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;Qe.lastIndex=this.pos;var M=Qe.exec(this.input),F=this.pos+M[0].length,R=this.input.charCodeAt(F);if(R===91)return!0;if(_)return!1;if(R===123)return!0;if(gt(R,!0)){for(var K=F+1;rr(this.input.charCodeAt(K),!0);)++K;var _e=this.input.slice(F,K);if(!Z.test(_e))return!0}return!1},Dn.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;Qe.lastIndex=this.pos;var _=Qe.exec(this.input),M=this.pos+_[0].length;return!$t.test(this.input.slice(this.pos,M))&&this.input.slice(M,M+8)==="function"&&(M+8===this.input.length||!rr(this.input.charAt(M+8)))},Dn.parseStatement=function(_,M,F){var R=this.type,K=this.startNode(),_e;switch(this.isLet(_)&&(R=Y._var,_e="let"),R){case Y._break:case Y._continue:return this.parseBreakContinueStatement(K,R.keyword);case Y._debugger:return this.parseDebuggerStatement(K);case Y._do:return this.parseDoStatement(K);case Y._for:return this.parseForStatement(K);case Y._function:return _&&(this.strict||_!=="if"&&_!=="label")&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(K,!1,!_);case Y._class:return _&&this.unexpected(),this.parseClass(K,!0);case Y._if:return this.parseIfStatement(K);case Y._return:return this.parseReturnStatement(K);case Y._switch:return this.parseSwitchStatement(K);case Y._throw:return this.parseThrowStatement(K);case Y._try:return this.parseTryStatement(K);case Y._const:case Y._var:return _e=_e||this.value,_&&_e!=="var"&&this.unexpected(),this.parseVarStatement(K,_e);case Y._while:return this.parseWhileStatement(K);case Y._with:return this.parseWithStatement(K);case Y.braceL:return this.parseBlock(!0,K);case Y.semi:return this.parseEmptyStatement(K);case Y._export:case Y._import:if(this.options.ecmaVersion>10&&R===Y._import){Qe.lastIndex=this.pos;var je=Qe.exec(this.input),pt=this.pos+je[0].length,dt=this.input.charCodeAt(pt);if(dt===40||dt===46)return this.parseExpressionStatement(K,this.parseExpression())}return this.options.allowImportExportEverywhere||(M||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),R===Y._import?this.parseImport(K):this.parseExport(K,F);default:if(this.isAsyncFunction())return _&&this.unexpected(),this.next(),this.parseFunctionStatement(K,!0,!_);var ur=this.value,yr=this.parseExpression();return R===Y.name&&yr.type==="Identifier"&&this.eat(Y.colon)?this.parseLabeledStatement(K,ur,yr,_):this.parseExpressionStatement(K,yr)}},Dn.parseBreakContinueStatement=function(_,M){var F=M==="break";this.next(),this.eat(Y.semi)||this.insertSemicolon()?_.label=null:this.type!==Y.name?this.unexpected():(_.label=this.parseIdent(),this.semicolon());for(var R=0;R<this.labels.length;++R){var K=this.labels[R];if((_.label==null||K.name===_.label.name)&&(K.kind!=null&&(F||K.kind==="loop")||_.label&&F))break}return R===this.labels.length&&this.raise(_.start,"Unsyntactic "+M),this.finishNode(_,F?"BreakStatement":"ContinueStatement")},Dn.parseDebuggerStatement=function(_){return this.next(),this.semicolon(),this.finishNode(_,"DebuggerStatement")},Dn.parseDoStatement=function(_){return this.next(),this.labels.push(Za),_.body=this.parseStatement("do"),this.labels.pop(),this.expect(Y._while),_.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(Y.semi):this.semicolon(),this.finishNode(_,"DoWhileStatement")},Dn.parseForStatement=function(_){this.next();var M=this.options.ecmaVersion>=9&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction)&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(Za),this.enterScope(0),this.expect(Y.parenL),this.type===Y.semi)return M>-1&&this.unexpected(M),this.parseFor(_,null);var F=this.isLet();if(this.type===Y._var||this.type===Y._const||F){var R=this.startNode(),K=F?"let":this.value;return this.next(),this.parseVar(R,!0,K),this.finishNode(R,"VariableDeclaration"),(this.type===Y._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&R.declarations.length===1?(this.options.ecmaVersion>=9&&(this.type===Y._in?M>-1&&this.unexpected(M):_.await=M>-1),this.parseForIn(_,R)):(M>-1&&this.unexpected(M),this.parseFor(_,R))}var _e=new me,je=this.parseExpression(!0,_e);return this.type===Y._in||this.options.ecmaVersion>=6&&this.isContextual("of")?(this.options.ecmaVersion>=9&&(this.type===Y._in?M>-1&&this.unexpected(M):_.await=M>-1),this.toAssignable(je,!1,_e),this.checkLVal(je),this.parseForIn(_,je)):(this.checkExpressionErrors(_e,!0),M>-1&&this.unexpected(M),this.parseFor(_,je))},Dn.parseFunctionStatement=function(_,M,F){return this.next(),this.parseFunction(_,nr|(F?0:Ar),!1,M)},Dn.parseIfStatement=function(_){return this.next(),_.test=this.parseParenExpression(),_.consequent=this.parseStatement("if"),_.alternate=this.eat(Y._else)?this.parseStatement("if"):null,this.finishNode(_,"IfStatement")},Dn.parseReturnStatement=function(_){return!this.inFunction&&!this.options.allowReturnOutsideFunction&&this.raise(this.start,"'return' outside of function"),this.next(),this.eat(Y.semi)||this.insertSemicolon()?_.argument=null:(_.argument=this.parseExpression(),this.semicolon()),this.finishNode(_,"ReturnStatement")},Dn.parseSwitchStatement=function(_){this.next(),_.discriminant=this.parseParenExpression(),_.cases=[],this.expect(Y.braceL),this.labels.push(hs),this.enterScope(0);for(var M,F=!1;this.type!==Y.braceR;)if(this.type===Y._case||this.type===Y._default){var R=this.type===Y._case;M&&this.finishNode(M,"SwitchCase"),_.cases.push(M=this.startNode()),M.consequent=[],this.next(),R?M.test=this.parseExpression():(F&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),F=!0,M.test=null),this.expect(Y.colon)}else M||this.unexpected(),M.consequent.push(this.parseStatement(null));return this.exitScope(),M&&this.finishNode(M,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(_,"SwitchStatement")},Dn.parseThrowStatement=function(_){return this.next(),$t.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),_.argument=this.parseExpression(),this.semicolon(),this.finishNode(_,"ThrowStatement")};var Nt=[];Dn.parseTryStatement=function(_){if(this.next(),_.block=this.parseBlock(),_.handler=null,this.type===Y._catch){var M=this.startNode();if(this.next(),this.eat(Y.parenL)){M.param=this.parseBindingAtom();var F=M.param.type==="Identifier";this.enterScope(F?qn:0),this.checkLVal(M.param,F?da:oa),this.expect(Y.parenR)}else this.options.ecmaVersion<10&&this.unexpected(),M.param=null,this.enterScope(0);M.body=this.parseBlock(!1),this.exitScope(),_.handler=this.finishNode(M,"CatchClause")}return _.finalizer=this.eat(Y._finally)?this.parseBlock():null,!_.handler&&!_.finalizer&&this.raise(_.start,"Missing catch or finally clause"),this.finishNode(_,"TryStatement")},Dn.parseVarStatement=function(_,M){return this.next(),this.parseVar(_,!1,M),this.semicolon(),this.finishNode(_,"VariableDeclaration")},Dn.parseWhileStatement=function(_){return this.next(),_.test=this.parseParenExpression(),this.labels.push(Za),_.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(_,"WhileStatement")},Dn.parseWithStatement=function(_){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),_.object=this.parseParenExpression(),_.body=this.parseStatement("with"),this.finishNode(_,"WithStatement")},Dn.parseEmptyStatement=function(_){return this.next(),this.finishNode(_,"EmptyStatement")},Dn.parseLabeledStatement=function(_,M,F,R){for(var K=0,_e=this.labels;K<_e.length;K+=1){var je=_e[K];je.name===M&&this.raise(F.start,"Label '"+M+"' is already declared")}for(var pt=this.type.isLoop?"loop":this.type===Y._switch?"switch":null,dt=this.labels.length-1;dt>=0;dt--){var ur=this.labels[dt];if(ur.statementStart===_.start)ur.statementStart=this.start,ur.kind=pt;else break}return this.labels.push({name:M,kind:pt,statementStart:this.start}),_.body=this.parseStatement(R?R.indexOf("label")===-1?R+"label":R:"label"),this.labels.pop(),_.label=F,this.finishNode(_,"LabeledStatement")},Dn.parseExpressionStatement=function(_,M){return _.expression=M,this.semicolon(),this.finishNode(_,"ExpressionStatement")},Dn.parseBlock=function(_,M,F){for(_===void 0&&(_=!0),M===void 0&&(M=this.startNode()),M.body=[],this.expect(Y.braceL),_&&this.enterScope(0);this.type!==Y.braceR;){var R=this.parseStatement(null);M.body.push(R)}return F&&(this.strict=!1),this.next(),_&&this.exitScope(),this.finishNode(M,"BlockStatement")},Dn.parseFor=function(_,M){return _.init=M,this.expect(Y.semi),_.test=this.type===Y.semi?null:this.parseExpression(),this.expect(Y.semi),_.update=this.type===Y.parenR?null:this.parseExpression(),this.expect(Y.parenR),_.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(_,"ForStatement")},Dn.parseForIn=function(_,M){var F=this.type===Y._in;return this.next(),M.type==="VariableDeclaration"&&M.declarations[0].init!=null&&(!F||this.options.ecmaVersion<8||this.strict||M.kind!=="var"||M.declarations[0].id.type!=="Identifier")?this.raise(M.start,(F?"for-in":"for-of")+" loop variable declaration may not have an initializer"):M.type==="AssignmentPattern"&&this.raise(M.start,"Invalid left-hand side in for-loop"),_.left=M,_.right=F?this.parseExpression():this.parseMaybeAssign(),this.expect(Y.parenR),_.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(_,F?"ForInStatement":"ForOfStatement")},Dn.parseVar=function(_,M,F){for(_.declarations=[],_.kind=F;;){var R=this.startNode();if(this.parseVarId(R,F),this.eat(Y.eq)?R.init=this.parseMaybeAssign(M):F==="const"&&!(this.type===Y._in||this.options.ecmaVersion>=6&&this.isContextual("of"))?this.unexpected():R.id.type!=="Identifier"&&!(M&&(this.type===Y._in||this.isContextual("of")))?this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):R.init=null,_.declarations.push(this.finishNode(R,"VariableDeclarator")),!this.eat(Y.comma))break}return _},Dn.parseVarId=function(_,M){_.id=this.parseBindingAtom(),this.checkLVal(_.id,M==="var"?Ki:oa,!1)};var nr=1,Ar=2,rn=4;Dn.parseFunction=function(_,M,F,R){this.initFunction(_),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!R)&&(this.type===Y.star&&M&Ar&&this.unexpected(),_.generator=this.eat(Y.star)),this.options.ecmaVersion>=8&&(_.async=!!R),M&nr&&(_.id=M&rn&&this.type!==Y.name?null:this.parseIdent(),_.id&&!(M&Ar)&&this.checkLVal(_.id,this.strict||_.generator||_.async?this.treatFunctionsAsVar?Ki:oa:Mi));var K=this.yieldPos,_e=this.awaitPos,je=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(Wi(_.async,_.generator)),M&nr||(_.id=this.type===Y.name?this.parseIdent():null),this.parseFunctionParams(_),this.parseFunctionBody(_,F,!1),this.yieldPos=K,this.awaitPos=_e,this.awaitIdentPos=je,this.finishNode(_,M&nr?"FunctionDeclaration":"FunctionExpression")},Dn.parseFunctionParams=function(_){this.expect(Y.parenL),_.params=this.parseBindingList(Y.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},Dn.parseClass=function(_,M){this.next();var F=this.strict;this.strict=!0,this.parseClassId(_,M),this.parseClassSuper(_);var R=this.startNode(),K=!1;for(R.body=[],this.expect(Y.braceL);this.type!==Y.braceR;){var _e=this.parseClassElement(_.superClass!==null);_e&&(R.body.push(_e),_e.type==="MethodDefinition"&&_e.kind==="constructor"&&(K&&this.raise(_e.start,"Duplicate constructor in the same class"),K=!0))}return this.strict=F,this.next(),_.body=this.finishNode(R,"ClassBody"),this.finishNode(_,M?"ClassDeclaration":"ClassExpression")},Dn.parseClassElement=function(_){var M=this;if(this.eat(Y.semi))return null;var F=this.startNode(),R=function(dt,ur){ur===void 0&&(ur=!1);var yr=M.start,In=M.startLoc;return M.eatContextual(dt)?M.type!==Y.parenL&&(!ur||!M.canInsertSemicolon())?!0:(F.key&&M.unexpected(),F.computed=!1,F.key=M.startNodeAt(yr,In),F.key.name=dt,M.finishNode(F.key,"Identifier"),!1):!1};F.kind="method",F.static=R("static");var K=this.eat(Y.star),_e=!1;K||(this.options.ecmaVersion>=8&&R("async",!0)?(_e=!0,K=this.options.ecmaVersion>=9&&this.eat(Y.star)):R("get")?F.kind="get":R("set")&&(F.kind="set")),F.key||this.parsePropertyName(F);var je=F.key,pt=!1;return!F.computed&&!F.static&&(je.type==="Identifier"&&je.name==="constructor"||je.type==="Literal"&&je.value==="constructor")?(F.kind!=="method"&&this.raise(je.start,"Constructor can't have get/set modifier"),K&&this.raise(je.start,"Constructor can't be a generator"),_e&&this.raise(je.start,"Constructor can't be an async method"),F.kind="constructor",pt=_):F.static&&je.type==="Identifier"&&je.name==="prototype"&&this.raise(je.start,"Classes may not have a static property named prototype"),this.parseClassMethod(F,K,_e,pt),F.kind==="get"&&F.value.params.length!==0&&this.raiseRecoverable(F.value.start,"getter should have no params"),F.kind==="set"&&F.value.params.length!==1&&this.raiseRecoverable(F.value.start,"setter should have exactly one param"),F.kind==="set"&&F.value.params[0].type==="RestElement"&&this.raiseRecoverable(F.value.params[0].start,"Setter cannot use rest params"),F},Dn.parseClassMethod=function(_,M,F,R){return _.value=this.parseMethod(M,F,R),this.finishNode(_,"MethodDefinition")},Dn.parseClassId=function(_,M){this.type===Y.name?(_.id=this.parseIdent(),M&&this.checkLVal(_.id,oa,!1)):(M===!0&&this.unexpected(),_.id=null)},Dn.parseClassSuper=function(_){_.superClass=this.eat(Y._extends)?this.parseExprSubscripts():null},Dn.parseExport=function(_,M){if(this.next(),this.eat(Y.star))return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(_.exported=this.parseIdent(!0),this.checkExport(M,_.exported.name,this.lastTokStart)):_.exported=null),this.expectContextual("from"),this.type!==Y.string&&this.unexpected(),_.source=this.parseExprAtom(),this.semicolon(),this.finishNode(_,"ExportAllDeclaration");if(this.eat(Y._default)){this.checkExport(M,"default",this.lastTokStart);var F;if(this.type===Y._function||(F=this.isAsyncFunction())){var R=this.startNode();this.next(),F&&this.next(),_.declaration=this.parseFunction(R,nr|rn,!1,F)}else if(this.type===Y._class){var K=this.startNode();_.declaration=this.parseClass(K,"nullableID")}else _.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(_,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())_.declaration=this.parseStatement(null),_.declaration.type==="VariableDeclaration"?this.checkVariableExport(M,_.declaration.declarations):this.checkExport(M,_.declaration.id.name,_.declaration.id.start),_.specifiers=[],_.source=null;else{if(_.declaration=null,_.specifiers=this.parseExportSpecifiers(M),this.eatContextual("from"))this.type!==Y.string&&this.unexpected(),_.source=this.parseExprAtom();else{for(var _e=0,je=_.specifiers;_e<je.length;_e+=1){var pt=je[_e];this.checkUnreserved(pt.local),this.checkLocalExport(pt.local)}_.source=null}this.semicolon()}return this.finishNode(_,"ExportNamedDeclaration")},Dn.checkExport=function(_,M,F){!_||(tn(_,M)&&this.raiseRecoverable(F,"Duplicate export '"+M+"'"),_[M]=!0)},Dn.checkPatternExport=function(_,M){var F=M.type;if(F==="Identifier")this.checkExport(_,M.name,M.start);else if(F==="ObjectPattern")for(var R=0,K=M.properties;R<K.length;R+=1){var _e=K[R];this.checkPatternExport(_,_e)}else if(F==="ArrayPattern")for(var je=0,pt=M.elements;je<pt.length;je+=1){var dt=pt[je];dt&&this.checkPatternExport(_,dt)}else F==="Property"?this.checkPatternExport(_,M.value):F==="AssignmentPattern"?this.checkPatternExport(_,M.left):F==="RestElement"?this.checkPatternExport(_,M.argument):F==="ParenthesizedExpression"&&this.checkPatternExport(_,M.expression)},Dn.checkVariableExport=function(_,M){if(!!_)for(var F=0,R=M;F<R.length;F+=1){var K=R[F];this.checkPatternExport(_,K.id)}},Dn.shouldParseExportStatement=function(){return this.type.keyword==="var"||this.type.keyword==="const"||this.type.keyword==="class"||this.type.keyword==="function"||this.isLet()||this.isAsyncFunction()},Dn.parseExportSpecifiers=function(_){var M=[],F=!0;for(this.expect(Y.braceL);!this.eat(Y.braceR);){if(F)F=!1;else if(this.expect(Y.comma),this.afterTrailingComma(Y.braceR))break;var R=this.startNode();R.local=this.parseIdent(!0),R.exported=this.eatContextual("as")?this.parseIdent(!0):R.local,this.checkExport(_,R.exported.name,R.exported.start),M.push(this.finishNode(R,"ExportSpecifier"))}return M},Dn.parseImport=function(_){return this.next(),this.type===Y.string?(_.specifiers=Nt,_.source=this.parseExprAtom()):(_.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),_.source=this.type===Y.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(_,"ImportDeclaration")},Dn.parseImportSpecifiers=function(){var _=[],M=!0;if(this.type===Y.name){var F=this.startNode();if(F.local=this.parseIdent(),this.checkLVal(F.local,oa),_.push(this.finishNode(F,"ImportDefaultSpecifier")),!this.eat(Y.comma))return _}if(this.type===Y.star){var R=this.startNode();return this.next(),this.expectContextual("as"),R.local=this.parseIdent(),this.checkLVal(R.local,oa),_.push(this.finishNode(R,"ImportNamespaceSpecifier")),_}for(this.expect(Y.braceL);!this.eat(Y.braceR);){if(M)M=!1;else if(this.expect(Y.comma),this.afterTrailingComma(Y.braceR))break;var K=this.startNode();K.imported=this.parseIdent(!0),this.eatContextual("as")?K.local=this.parseIdent():(this.checkUnreserved(K.imported),K.local=K.imported),this.checkLVal(K.local,oa),_.push(this.finishNode(K,"ImportSpecifier"))}return _},Dn.adaptDirectivePrologue=function(_){for(var M=0;M<_.length&&this.isDirectiveCandidate(_[M]);++M)_[M].directive=_[M].expression.raw.slice(1,-1)},Dn.isDirectiveCandidate=function(_){return _.type==="ExpressionStatement"&&_.expression.type==="Literal"&&typeof _.expression.value=="string"&&(this.input[_.start]==='"'||this.input[_.start]==="'")};var wn=wi.prototype;wn.toAssignable=function(_,M,F){if(this.options.ecmaVersion>=6&&_)switch(_.type){case"Identifier":this.inAsync&&_.name==="await"&&this.raise(_.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"RestElement":break;case"ObjectExpression":_.type="ObjectPattern",F&&this.checkPatternErrors(F,!0);for(var R=0,K=_.properties;R<K.length;R+=1){var _e=K[R];this.toAssignable(_e,M),_e.type==="RestElement"&&(_e.argument.type==="ArrayPattern"||_e.argument.type==="ObjectPattern")&&this.raise(_e.argument.start,"Unexpected token")}break;case"Property":_.kind!=="init"&&this.raise(_.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(_.value,M);break;case"ArrayExpression":_.type="ArrayPattern",F&&this.checkPatternErrors(F,!0),this.toAssignableList(_.elements,M);break;case"SpreadElement":_.type="RestElement",this.toAssignable(_.argument,M),_.argument.type==="AssignmentPattern"&&this.raise(_.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":_.operator!=="="&&this.raise(_.left.end,"Only '=' operator can be used for specifying default value."),_.type="AssignmentPattern",delete _.operator,this.toAssignable(_.left,M);case"AssignmentPattern":break;case"ParenthesizedExpression":this.toAssignable(_.expression,M,F);break;case"ChainExpression":this.raiseRecoverable(_.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!M)break;default:this.raise(_.start,"Assigning to rvalue")}else F&&this.checkPatternErrors(F,!0);return _},wn.toAssignableList=function(_,M){for(var F=_.length,R=0;R<F;R++){var K=_[R];K&&this.toAssignable(K,M)}if(F){var _e=_[F-1];this.options.ecmaVersion===6&&M&&_e&&_e.type==="RestElement"&&_e.argument.type!=="Identifier"&&this.unexpected(_e.argument.start)}return _},wn.parseSpread=function(_){var M=this.startNode();return this.next(),M.argument=this.parseMaybeAssign(!1,_),this.finishNode(M,"SpreadElement")},wn.parseRestBinding=function(){var _=this.startNode();return this.next(),this.options.ecmaVersion===6&&this.type!==Y.name&&this.unexpected(),_.argument=this.parseBindingAtom(),this.finishNode(_,"RestElement")},wn.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case Y.bracketL:var _=this.startNode();return this.next(),_.elements=this.parseBindingList(Y.bracketR,!0,!0),this.finishNode(_,"ArrayPattern");case Y.braceL:return this.parseObj(!0)}return this.parseIdent()},wn.parseBindingList=function(_,M,F){for(var R=[],K=!0;!this.eat(_);)if(K?K=!1:this.expect(Y.comma),M&&this.type===Y.comma)R.push(null);else{if(F&&this.afterTrailingComma(_))break;if(this.type===Y.ellipsis){var _e=this.parseRestBinding();this.parseBindingListItem(_e),R.push(_e),this.type===Y.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.expect(_);break}else{var je=this.parseMaybeDefault(this.start,this.startLoc);this.parseBindingListItem(je),R.push(je)}}return R},wn.parseBindingListItem=function(_){return _},wn.parseMaybeDefault=function(_,M,F){if(F=F||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(Y.eq))return F;var R=this.startNodeAt(_,M);return R.left=F,R.right=this.parseMaybeAssign(),this.finishNode(R,"AssignmentPattern")},wn.checkLVal=function(_,M,F){switch(M===void 0&&(M=Oi),_.type){case"Identifier":M===oa&&_.name==="let"&&this.raiseRecoverable(_.start,"let is disallowed as a lexically bound name"),this.strict&&this.reservedWordsStrictBind.test(_.name)&&this.raiseRecoverable(_.start,(M?"Binding ":"Assigning to ")+_.name+" in strict mode"),F&&(tn(F,_.name)&&this.raiseRecoverable(_.start,"Argument name clash"),F[_.name]=!0),M!==Oi&&M!==$n&&this.declareName(_.name,M,_.start);break;case"ChainExpression":this.raiseRecoverable(_.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":M&&this.raiseRecoverable(_.start,"Binding member expression");break;case"ObjectPattern":for(var R=0,K=_.properties;R<K.length;R+=1){var _e=K[R];this.checkLVal(_e,M,F)}break;case"Property":this.checkLVal(_.value,M,F);break;case"ArrayPattern":for(var je=0,pt=_.elements;je<pt.length;je+=1){var dt=pt[je];dt&&this.checkLVal(dt,M,F)}break;case"AssignmentPattern":this.checkLVal(_.left,M,F);break;case"RestElement":this.checkLVal(_.argument,M,F);break;case"ParenthesizedExpression":this.checkLVal(_.expression,M,F);break;default:this.raise(_.start,(M?"Binding":"Assigning to")+" rvalue")}};var Fn=wi.prototype;Fn.checkPropClash=function(_,M,F){if(!(this.options.ecmaVersion>=9&&_.type==="SpreadElement")&&!(this.options.ecmaVersion>=6&&(_.computed||_.method||_.shorthand))){var R=_.key,K;switch(R.type){case"Identifier":K=R.name;break;case"Literal":K=String(R.value);break;default:return}var _e=_.kind;if(this.options.ecmaVersion>=6){K==="__proto__"&&_e==="init"&&(M.proto&&(F?F.doubleProto<0&&(F.doubleProto=R.start):this.raiseRecoverable(R.start,"Redefinition of __proto__ property")),M.proto=!0);return}K="$"+K;var je=M[K];if(je){var pt;_e==="init"?pt=this.strict&&je.init||je.get||je.set:pt=je.init||je[_e],pt&&this.raiseRecoverable(R.start,"Redefinition of property")}else je=M[K]={init:!1,get:!1,set:!1};je[_e]=!0}},Fn.parseExpression=function(_,M){var F=this.start,R=this.startLoc,K=this.parseMaybeAssign(_,M);if(this.type===Y.comma){var _e=this.startNodeAt(F,R);for(_e.expressions=[K];this.eat(Y.comma);)_e.expressions.push(this.parseMaybeAssign(_,M));return this.finishNode(_e,"SequenceExpression")}return K},Fn.parseMaybeAssign=function(_,M,F){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(_);this.exprAllowed=!1}var R=!1,K=-1,_e=-1;M?(K=M.parenthesizedAssign,_e=M.trailingComma,M.parenthesizedAssign=M.trailingComma=-1):(M=new me,R=!0);var je=this.start,pt=this.startLoc;(this.type===Y.parenL||this.type===Y.name)&&(this.potentialArrowAt=this.start);var dt=this.parseMaybeConditional(_,M);if(F&&(dt=F.call(this,dt,je,pt)),this.type.isAssign){var ur=this.startNodeAt(je,pt);return ur.operator=this.value,ur.left=this.type===Y.eq?this.toAssignable(dt,!1,M):dt,R||(M.parenthesizedAssign=M.trailingComma=M.doubleProto=-1),M.shorthandAssign>=ur.left.start&&(M.shorthandAssign=-1),this.checkLVal(dt),this.next(),ur.right=this.parseMaybeAssign(_),this.finishNode(ur,"AssignmentExpression")}else R&&this.checkExpressionErrors(M,!0);return K>-1&&(M.parenthesizedAssign=K),_e>-1&&(M.trailingComma=_e),dt},Fn.parseMaybeConditional=function(_,M){var F=this.start,R=this.startLoc,K=this.parseExprOps(_,M);if(this.checkExpressionErrors(M))return K;if(this.eat(Y.question)){var _e=this.startNodeAt(F,R);return _e.test=K,_e.consequent=this.parseMaybeAssign(),this.expect(Y.colon),_e.alternate=this.parseMaybeAssign(_),this.finishNode(_e,"ConditionalExpression")}return K},Fn.parseExprOps=function(_,M){var F=this.start,R=this.startLoc,K=this.parseMaybeUnary(M,!1);return this.checkExpressionErrors(M)||K.start===F&&K.type==="ArrowFunctionExpression"?K:this.parseExprOp(K,F,R,-1,_)},Fn.parseExprOp=function(_,M,F,R,K){var _e=this.type.binop;if(_e!=null&&(!K||this.type!==Y._in)&&_e>R){var je=this.type===Y.logicalOR||this.type===Y.logicalAND,pt=this.type===Y.coalesce;pt&&(_e=Y.logicalAND.binop);var dt=this.value;this.next();var ur=this.start,yr=this.startLoc,In=this.parseExprOp(this.parseMaybeUnary(null,!1),ur,yr,_e,K),Bn=this.buildBinary(M,F,_,In,dt,je||pt);return(je&&this.type===Y.coalesce||pt&&(this.type===Y.logicalOR||this.type===Y.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(Bn,M,F,R,K)}return _},Fn.buildBinary=function(_,M,F,R,K,_e){var je=this.startNodeAt(_,M);return je.left=F,je.operator=K,je.right=R,this.finishNode(je,_e?"LogicalExpression":"BinaryExpression")},Fn.parseMaybeUnary=function(_,M){var F=this.start,R=this.startLoc,K;if(this.isContextual("await")&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction))K=this.parseAwait(),M=!0;else if(this.type.prefix){var _e=this.startNode(),je=this.type===Y.incDec;_e.operator=this.value,_e.prefix=!0,this.next(),_e.argument=this.parseMaybeUnary(null,!0),this.checkExpressionErrors(_,!0),je?this.checkLVal(_e.argument):this.strict&&_e.operator==="delete"&&_e.argument.type==="Identifier"?this.raiseRecoverable(_e.start,"Deleting local variable in strict mode"):M=!0,K=this.finishNode(_e,je?"UpdateExpression":"UnaryExpression")}else{if(K=this.parseExprSubscripts(_),this.checkExpressionErrors(_))return K;for(;this.type.postfix&&!this.canInsertSemicolon();){var pt=this.startNodeAt(F,R);pt.operator=this.value,pt.prefix=!1,pt.argument=K,this.checkLVal(K),this.next(),K=this.finishNode(pt,"UpdateExpression")}}return!M&&this.eat(Y.starstar)?this.buildBinary(F,R,K,this.parseMaybeUnary(null,!1),"**",!1):K},Fn.parseExprSubscripts=function(_){var M=this.start,F=this.startLoc,R=this.parseExprAtom(_);if(R.type==="ArrowFunctionExpression"&&this.input.slice(this.lastTokStart,this.lastTokEnd)!==")")return R;var K=this.parseSubscripts(R,M,F);return _&&K.type==="MemberExpression"&&(_.parenthesizedAssign>=K.start&&(_.parenthesizedAssign=-1),_.parenthesizedBind>=K.start&&(_.parenthesizedBind=-1)),K},Fn.parseSubscripts=function(_,M,F,R){for(var K=this.options.ecmaVersion>=8&&_.type==="Identifier"&&_.name==="async"&&this.lastTokEnd===_.end&&!this.canInsertSemicolon()&&_.end-_.start==5&&this.potentialArrowAt===_.start,_e=!1;;){var je=this.parseSubscript(_,M,F,R,K,_e);if(je.optional&&(_e=!0),je===_||je.type==="ArrowFunctionExpression"){if(_e){var pt=this.startNodeAt(M,F);pt.expression=je,je=this.finishNode(pt,"ChainExpression")}return je}_=je}},Fn.parseSubscript=function(_,M,F,R,K,_e){var je=this.options.ecmaVersion>=11,pt=je&&this.eat(Y.questionDot);R&&pt&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var dt=this.eat(Y.bracketL);if(dt||pt&&this.type!==Y.parenL&&this.type!==Y.backQuote||this.eat(Y.dot)){var ur=this.startNodeAt(M,F);ur.object=_,ur.property=dt?this.parseExpression():this.parseIdent(this.options.allowReserved!=="never"),ur.computed=!!dt,dt&&this.expect(Y.bracketR),je&&(ur.optional=pt),_=this.finishNode(ur,"MemberExpression")}else if(!R&&this.eat(Y.parenL)){var yr=new me,In=this.yieldPos,Bn=this.awaitPos,Qn=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var Vi=this.parseExprList(Y.parenR,this.options.ecmaVersion>=8,!1,yr);if(K&&!pt&&!this.canInsertSemicolon()&&this.eat(Y.arrow))return this.checkPatternErrors(yr,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=In,this.awaitPos=Bn,this.awaitIdentPos=Qn,this.parseArrowExpression(this.startNodeAt(M,F),Vi,!0);this.checkExpressionErrors(yr,!0),this.yieldPos=In||this.yieldPos,this.awaitPos=Bn||this.awaitPos,this.awaitIdentPos=Qn||this.awaitIdentPos;var Li=this.startNodeAt(M,F);Li.callee=_,Li.arguments=Vi,je&&(Li.optional=pt),_=this.finishNode(Li,"CallExpression")}else if(this.type===Y.backQuote){(pt||_e)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var ba=this.startNodeAt(M,F);ba.tag=_,ba.quasi=this.parseTemplate({isTagged:!0}),_=this.finishNode(ba,"TaggedTemplateExpression")}return _},Fn.parseExprAtom=function(_){this.type===Y.slash&&this.readRegexp();var M,F=this.potentialArrowAt===this.start;switch(this.type){case Y._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),M=this.startNode(),this.next(),this.type===Y.parenL&&!this.allowDirectSuper&&this.raise(M.start,"super() call outside constructor of a subclass"),this.type!==Y.dot&&this.type!==Y.bracketL&&this.type!==Y.parenL&&this.unexpected(),this.finishNode(M,"Super");case Y._this:return M=this.startNode(),this.next(),this.finishNode(M,"ThisExpression");case Y.name:var R=this.start,K=this.startLoc,_e=this.containsEsc,je=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!_e&&je.name==="async"&&!this.canInsertSemicolon()&&this.eat(Y._function))return this.parseFunction(this.startNodeAt(R,K),0,!1,!0);if(F&&!this.canInsertSemicolon()){if(this.eat(Y.arrow))return this.parseArrowExpression(this.startNodeAt(R,K),[je],!1);if(this.options.ecmaVersion>=8&&je.name==="async"&&this.type===Y.name&&!_e)return je=this.parseIdent(!1),(this.canInsertSemicolon()||!this.eat(Y.arrow))&&this.unexpected(),this.parseArrowExpression(this.startNodeAt(R,K),[je],!0)}return je;case Y.regexp:var pt=this.value;return M=this.parseLiteral(pt.value),M.regex={pattern:pt.pattern,flags:pt.flags},M;case Y.num:case Y.string:return this.parseLiteral(this.value);case Y._null:case Y._true:case Y._false:return M=this.startNode(),M.value=this.type===Y._null?null:this.type===Y._true,M.raw=this.type.keyword,this.next(),this.finishNode(M,"Literal");case Y.parenL:var dt=this.start,ur=this.parseParenAndDistinguishExpression(F);return _&&(_.parenthesizedAssign<0&&!this.isSimpleAssignTarget(ur)&&(_.parenthesizedAssign=dt),_.parenthesizedBind<0&&(_.parenthesizedBind=dt)),ur;case Y.bracketL:return M=this.startNode(),this.next(),M.elements=this.parseExprList(Y.bracketR,!0,!0,_),this.finishNode(M,"ArrayExpression");case Y.braceL:return this.parseObj(!1,_);case Y._function:return M=this.startNode(),this.next(),this.parseFunction(M,0);case Y._class:return this.parseClass(this.startNode(),!1);case Y._new:return this.parseNew();case Y.backQuote:return this.parseTemplate();case Y._import:return this.options.ecmaVersion>=11?this.parseExprImport():this.unexpected();default:this.unexpected()}},Fn.parseExprImport=function(){var _=this.startNode();this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import");var M=this.parseIdent(!0);switch(this.type){case Y.parenL:return this.parseDynamicImport(_);case Y.dot:return _.meta=M,this.parseImportMeta(_);default:this.unexpected()}},Fn.parseDynamicImport=function(_){if(this.next(),_.source=this.parseMaybeAssign(),!this.eat(Y.parenR)){var M=this.start;this.eat(Y.comma)&&this.eat(Y.parenR)?this.raiseRecoverable(M,"Trailing comma is not allowed in import()"):this.unexpected(M)}return this.finishNode(_,"ImportExpression")},Fn.parseImportMeta=function(_){this.next();var M=this.containsEsc;return _.property=this.parseIdent(!0),_.property.name!=="meta"&&this.raiseRecoverable(_.property.start,"The only valid meta property for import is 'import.meta'"),M&&this.raiseRecoverable(_.start,"'import.meta' must not contain escaped characters"),this.options.sourceType!=="module"&&this.raiseRecoverable(_.start,"Cannot use 'import.meta' outside a module"),this.finishNode(_,"MetaProperty")},Fn.parseLiteral=function(_){var M=this.startNode();return M.value=_,M.raw=this.input.slice(this.start,this.end),M.raw.charCodeAt(M.raw.length-1)===110&&(M.bigint=M.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(M,"Literal")},Fn.parseParenExpression=function(){this.expect(Y.parenL);var _=this.parseExpression();return this.expect(Y.parenR),_},Fn.parseParenAndDistinguishExpression=function(_){var M=this.start,F=this.startLoc,R,K=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var _e=this.start,je=this.startLoc,pt=[],dt=!0,ur=!1,yr=new me,In=this.yieldPos,Bn=this.awaitPos,Qn;for(this.yieldPos=0,this.awaitPos=0;this.type!==Y.parenR;)if(dt?dt=!1:this.expect(Y.comma),K&&this.afterTrailingComma(Y.parenR,!0)){ur=!0;break}else if(this.type===Y.ellipsis){Qn=this.start,pt.push(this.parseParenItem(this.parseRestBinding())),this.type===Y.comma&&this.raise(this.start,"Comma is not permitted after the rest element");break}else pt.push(this.parseMaybeAssign(!1,yr,this.parseParenItem));var Vi=this.start,Li=this.startLoc;if(this.expect(Y.parenR),_&&!this.canInsertSemicolon()&&this.eat(Y.arrow))return this.checkPatternErrors(yr,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=In,this.awaitPos=Bn,this.parseParenArrowList(M,F,pt);(!pt.length||ur)&&this.unexpected(this.lastTokStart),Qn&&this.unexpected(Qn),this.checkExpressionErrors(yr,!0),this.yieldPos=In||this.yieldPos,this.awaitPos=Bn||this.awaitPos,pt.length>1?(R=this.startNodeAt(_e,je),R.expressions=pt,this.finishNodeAt(R,"SequenceExpression",Vi,Li)):R=pt[0]}else R=this.parseParenExpression();if(this.options.preserveParens){var ba=this.startNodeAt(M,F);return ba.expression=R,this.finishNode(ba,"ParenthesizedExpression")}else return R},Fn.parseParenItem=function(_){return _},Fn.parseParenArrowList=function(_,M,F){return this.parseArrowExpression(this.startNodeAt(_,M),F)};var gi=[];Fn.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var _=this.startNode(),M=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(Y.dot)){_.meta=M;var F=this.containsEsc;return _.property=this.parseIdent(!0),_.property.name!=="target"&&this.raiseRecoverable(_.property.start,"The only valid meta property for new is 'new.target'"),F&&this.raiseRecoverable(_.start,"'new.target' must not contain escaped characters"),this.inNonArrowFunction()||this.raiseRecoverable(_.start,"'new.target' can only be used in functions"),this.finishNode(_,"MetaProperty")}var R=this.start,K=this.startLoc,_e=this.type===Y._import;return _.callee=this.parseSubscripts(this.parseExprAtom(),R,K,!0),_e&&_.callee.type==="ImportExpression"&&this.raise(R,"Cannot use new with import()"),this.eat(Y.parenL)?_.arguments=this.parseExprList(Y.parenR,this.options.ecmaVersion>=8,!1):_.arguments=gi,this.finishNode(_,"NewExpression")},Fn.parseTemplateElement=function(_){var M=_.isTagged,F=this.startNode();return this.type===Y.invalidTemplate?(M||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),F.value={raw:this.value,cooked:null}):F.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,`
`),cooked:this.value},this.next(),F.tail=this.type===Y.backQuote,this.finishNode(F,"TemplateElement")},Fn.parseTemplate=function(_){_===void 0&&(_={});var M=_.isTagged;M===void 0&&(M=!1);var F=this.startNode();this.next(),F.expressions=[];var R=this.parseTemplateElement({isTagged:M});for(F.quasis=[R];!R.tail;)this.type===Y.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(Y.dollarBraceL),F.expressions.push(this.parseExpression()),this.expect(Y.braceR),F.quasis.push(R=this.parseTemplateElement({isTagged:M}));return this.next(),this.finishNode(F,"TemplateLiteral")},Fn.isAsyncProp=function(_){return!_.computed&&_.key.type==="Identifier"&&_.key.name==="async"&&(this.type===Y.name||this.type===Y.num||this.type===Y.string||this.type===Y.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===Y.star)&&!$t.test(this.input.slice(this.lastTokEnd,this.start))},Fn.parseObj=function(_,M){var F=this.startNode(),R=!0,K={};for(F.properties=[],this.next();!this.eat(Y.braceR);){if(R)R=!1;else if(this.expect(Y.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(Y.braceR))break;var _e=this.parseProperty(_,M);_||this.checkPropClash(_e,K,M),F.properties.push(_e)}return this.finishNode(F,_?"ObjectPattern":"ObjectExpression")},Fn.parseProperty=function(_,M){var F=this.startNode(),R,K,_e,je;if(this.options.ecmaVersion>=9&&this.eat(Y.ellipsis))return _?(F.argument=this.parseIdent(!1),this.type===Y.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.finishNode(F,"RestElement")):(this.type===Y.parenL&&M&&(M.parenthesizedAssign<0&&(M.parenthesizedAssign=this.start),M.parenthesizedBind<0&&(M.parenthesizedBind=this.start)),F.argument=this.parseMaybeAssign(!1,M),this.type===Y.comma&&M&&M.trailingComma<0&&(M.trailingComma=this.start),this.finishNode(F,"SpreadElement"));this.options.ecmaVersion>=6&&(F.method=!1,F.shorthand=!1,(_||M)&&(_e=this.start,je=this.startLoc),_||(R=this.eat(Y.star)));var pt=this.containsEsc;return this.parsePropertyName(F),!_&&!pt&&this.options.ecmaVersion>=8&&!R&&this.isAsyncProp(F)?(K=!0,R=this.options.ecmaVersion>=9&&this.eat(Y.star),this.parsePropertyName(F,M)):K=!1,this.parsePropertyValue(F,_,R,K,_e,je,M,pt),this.finishNode(F,"Property")},Fn.parsePropertyValue=function(_,M,F,R,K,_e,je,pt){if((F||R)&&this.type===Y.colon&&this.unexpected(),this.eat(Y.colon))_.value=M?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,je),_.kind="init";else if(this.options.ecmaVersion>=6&&this.type===Y.parenL)M&&this.unexpected(),_.kind="init",_.method=!0,_.value=this.parseMethod(F,R);else if(!M&&!pt&&this.options.ecmaVersion>=5&&!_.computed&&_.key.type==="Identifier"&&(_.key.name==="get"||_.key.name==="set")&&this.type!==Y.comma&&this.type!==Y.braceR&&this.type!==Y.eq){(F||R)&&this.unexpected(),_.kind=_.key.name,this.parsePropertyName(_),_.value=this.parseMethod(!1);var dt=_.kind==="get"?0:1;if(_.value.params.length!==dt){var ur=_.value.start;_.kind==="get"?this.raiseRecoverable(ur,"getter should have no params"):this.raiseRecoverable(ur,"setter should have exactly one param")}else _.kind==="set"&&_.value.params[0].type==="RestElement"&&this.raiseRecoverable(_.value.params[0].start,"Setter cannot use rest params")}else this.options.ecmaVersion>=6&&!_.computed&&_.key.type==="Identifier"?((F||R)&&this.unexpected(),this.checkUnreserved(_.key),_.key.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=K),_.kind="init",M?_.value=this.parseMaybeDefault(K,_e,_.key):this.type===Y.eq&&je?(je.shorthandAssign<0&&(je.shorthandAssign=this.start),_.value=this.parseMaybeDefault(K,_e,_.key)):_.value=_.key,_.shorthand=!0):this.unexpected()},Fn.parsePropertyName=function(_){if(this.options.ecmaVersion>=6){if(this.eat(Y.bracketL))return _.computed=!0,_.key=this.parseMaybeAssign(),this.expect(Y.bracketR),_.key;_.computed=!1}return _.key=this.type===Y.num||this.type===Y.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never")},Fn.initFunction=function(_){_.id=null,this.options.ecmaVersion>=6&&(_.generator=_.expression=!1),this.options.ecmaVersion>=8&&(_.async=!1)},Fn.parseMethod=function(_,M,F){var R=this.startNode(),K=this.yieldPos,_e=this.awaitPos,je=this.awaitIdentPos;return this.initFunction(R),this.options.ecmaVersion>=6&&(R.generator=_),this.options.ecmaVersion>=8&&(R.async=!!M),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(Wi(M,R.generator)|mi|(F?aa:0)),this.expect(Y.parenL),R.params=this.parseBindingList(Y.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(R,!1,!0),this.yieldPos=K,this.awaitPos=_e,this.awaitIdentPos=je,this.finishNode(R,"FunctionExpression")},Fn.parseArrowExpression=function(_,M,F){var R=this.yieldPos,K=this.awaitPos,_e=this.awaitIdentPos;return this.enterScope(Wi(F,!1)|vi),this.initFunction(_),this.options.ecmaVersion>=8&&(_.async=!!F),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,_.params=this.toAssignableList(M,!0),this.parseFunctionBody(_,!0,!1),this.yieldPos=R,this.awaitPos=K,this.awaitIdentPos=_e,this.finishNode(_,"ArrowFunctionExpression")},Fn.parseFunctionBody=function(_,M,F){var R=M&&this.type!==Y.braceL,K=this.strict,_e=!1;if(R)_.body=this.parseMaybeAssign(),_.expression=!0,this.checkParams(_,!1);else{var je=this.options.ecmaVersion>=7&&!this.isSimpleParamList(_.params);(!K||je)&&(_e=this.strictDirective(this.end),_e&&je&&this.raiseRecoverable(_.start,"Illegal 'use strict' directive in function with non-simple parameter list"));var pt=this.labels;this.labels=[],_e&&(this.strict=!0),this.checkParams(_,!K&&!_e&&!M&&!F&&this.isSimpleParamList(_.params)),this.strict&&_.id&&this.checkLVal(_.id,$n),_.body=this.parseBlock(!1,void 0,_e&&!K),_.expression=!1,this.adaptDirectivePrologue(_.body.body),this.labels=pt}this.exitScope()},Fn.isSimpleParamList=function(_){for(var M=0,F=_;M<F.length;M+=1){var R=F[M];if(R.type!=="Identifier")return!1}return!0},Fn.checkParams=function(_,M){for(var F={},R=0,K=_.params;R<K.length;R+=1){var _e=K[R];this.checkLVal(_e,Ki,M?null:F)}},Fn.parseExprList=function(_,M,F,R){for(var K=[],_e=!0;!this.eat(_);){if(_e)_e=!1;else if(this.expect(Y.comma),M&&this.afterTrailingComma(_))break;var je=void 0;F&&this.type===Y.comma?je=null:this.type===Y.ellipsis?(je=this.parseSpread(R),R&&this.type===Y.comma&&R.trailingComma<0&&(R.trailingComma=this.start)):je=this.parseMaybeAssign(!1,R),K.push(je)}return K},Fn.checkUnreserved=function(_){var M=_.start,F=_.end,R=_.name;if(this.inGenerator&&R==="yield"&&this.raiseRecoverable(M,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&R==="await"&&this.raiseRecoverable(M,"Cannot use 'await' as identifier inside an async function"),this.keywords.test(R)&&this.raise(M,"Unexpected keyword '"+R+"'"),!(this.options.ecmaVersion<6&&this.input.slice(M,F).indexOf("\\")!==-1)){var K=this.strict?this.reservedWordsStrict:this.reservedWords;K.test(R)&&(!this.inAsync&&R==="await"&&this.raiseRecoverable(M,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(M,"The keyword '"+R+"' is reserved"))}},Fn.parseIdent=function(_,M){var F=this.startNode();return this.type===Y.name?F.name=this.value:this.type.keyword?(F.name=this.type.keyword,(F.name==="class"||F.name==="function")&&(this.lastTokEnd!==this.lastTokStart+1||this.input.charCodeAt(this.lastTokStart)!==46)&&this.context.pop()):this.unexpected(),this.next(!!_),this.finishNode(F,"Identifier"),_||(this.checkUnreserved(F),F.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=F.start)),F},Fn.parseYield=function(_){this.yieldPos||(this.yieldPos=this.start);var M=this.startNode();return this.next(),this.type===Y.semi||this.canInsertSemicolon()||this.type!==Y.star&&!this.type.startsExpr?(M.delegate=!1,M.argument=null):(M.delegate=this.eat(Y.star),M.argument=this.parseMaybeAssign(_)),this.finishNode(M,"YieldExpression")},Fn.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var _=this.startNode();return this.next(),_.argument=this.parseMaybeUnary(null,!1),this.finishNode(_,"AwaitExpression")};var ti=wi.prototype;ti.raise=function(_,M){var F=mt(this.input,_);M+=" ("+F.line+":"+F.column+")";var R=new SyntaxError(M);throw R.pos=_,R.loc=F,R.raisedAt=this.pos,R},ti.raiseRecoverable=ti.raise,ti.curPosition=function(){if(this.options.locations)return new De(this.curLine,this.pos-this.lineStart)};var fn=wi.prototype,Di=function(M){this.flags=M,this.var=[],this.lexical=[],this.functions=[]};fn.enterScope=function(_){this.scopeStack.push(new Di(_))},fn.exitScope=function(){this.scopeStack.pop()},fn.treatFunctionsAsVarInScope=function(_){return _.flags&vn||!this.inModule&&_.flags&ei},fn.declareName=function(_,M,F){var R=!1;if(M===oa){var K=this.currentScope();R=K.lexical.indexOf(_)>-1||K.functions.indexOf(_)>-1||K.var.indexOf(_)>-1,K.lexical.push(_),this.inModule&&K.flags&ei&&delete this.undefinedExports[_]}else if(M===da){var _e=this.currentScope();_e.lexical.push(_)}else if(M===Mi){var je=this.currentScope();this.treatFunctionsAsVar?R=je.lexical.indexOf(_)>-1:R=je.lexical.indexOf(_)>-1||je.var.indexOf(_)>-1,je.functions.push(_)}else for(var pt=this.scopeStack.length-1;pt>=0;--pt){var dt=this.scopeStack[pt];if(dt.lexical.indexOf(_)>-1&&!(dt.flags&qn&&dt.lexical[0]===_)||!this.treatFunctionsAsVarInScope(dt)&&dt.functions.indexOf(_)>-1){R=!0;break}if(dt.var.push(_),this.inModule&&dt.flags&ei&&delete this.undefinedExports[_],dt.flags&di)break}R&&this.raiseRecoverable(F,"Identifier '"+_+"' has already been declared")},fn.checkLocalExport=function(_){this.scopeStack[0].lexical.indexOf(_.name)===-1&&this.scopeStack[0].var.indexOf(_.name)===-1&&(this.undefinedExports[_.name]=_)},fn.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]},fn.currentVarScope=function(){for(var _=this.scopeStack.length-1;;_--){var M=this.scopeStack[_];if(M.flags&di)return M}},fn.currentThisScope=function(){for(var _=this.scopeStack.length-1;;_--){var M=this.scopeStack[_];if(M.flags&di&&!(M.flags&vi))return M}};var Ri=function(M,F,R){this.type="",this.start=F,this.end=0,M.options.locations&&(this.loc=new wt(M,R)),M.options.directSourceFile&&(this.sourceFile=M.options.directSourceFile),M.options.ranges&&(this.range=[F,0])},to=wi.prototype;to.startNode=function(){return new Ri(this,this.start,this.startLoc)},to.startNodeAt=function(_,M){return new Ri(this,_,M)};function Es(_,M,F,R){return _.type=M,_.end=F,this.options.locations&&(_.loc.end=R),this.options.ranges&&(_.range[1]=F),_}to.finishNode=function(_,M){return Es.call(this,_,M,this.lastTokEnd,this.lastTokEndLoc)},to.finishNodeAt=function(_,M,F,R){return Es.call(this,_,M,F,R)};var Ko=function(M,F,R,K,_e){this.token=M,this.isExpr=!!F,this.preserveSpace=!!R,this.override=K,this.generator=!!_e},Ba={b_stat:new Ko("{",!1),b_expr:new Ko("{",!0),b_tmpl:new Ko("${",!1),p_stat:new Ko("(",!1),p_expr:new Ko("(",!0),q_tmpl:new Ko("`",!0,!0,function(_){return _.tryReadTemplateToken()}),f_stat:new Ko("function",!1),f_expr:new Ko("function",!0),f_expr_gen:new Ko("function",!0,!1,null,!0),f_gen:new Ko("function",!1,!1,null,!0)},xa=wi.prototype;xa.initialContext=function(){return[Ba.b_stat]},xa.braceIsBlock=function(_){var M=this.curContext();return M===Ba.f_expr||M===Ba.f_stat?!0:_===Y.colon&&(M===Ba.b_stat||M===Ba.b_expr)?!M.isExpr:_===Y._return||_===Y.name&&this.exprAllowed?$t.test(this.input.slice(this.lastTokEnd,this.start)):_===Y._else||_===Y.semi||_===Y.eof||_===Y.parenR||_===Y.arrow?!0:_===Y.braceL?M===Ba.b_stat:_===Y._var||_===Y._const||_===Y.name?!1:!this.exprAllowed},xa.inGeneratorContext=function(){for(var _=this.context.length-1;_>=1;_--){var M=this.context[_];if(M.token==="function")return M.generator}return!1},xa.updateContext=function(_){var M,F=this.type;F.keyword&&_===Y.dot?this.exprAllowed=!1:(M=F.updateContext)?M.call(this,_):this.exprAllowed=F.beforeExpr},Y.parenR.updateContext=Y.braceR.updateContext=function(){if(this.context.length===1){this.exprAllowed=!0;return}var _=this.context.pop();_===Ba.b_stat&&this.curContext().token==="function"&&(_=this.context.pop()),this.exprAllowed=!_.isExpr},Y.braceL.updateContext=function(_){this.context.push(this.braceIsBlock(_)?Ba.b_stat:Ba.b_expr),this.exprAllowed=!0},Y.dollarBraceL.updateContext=function(){this.context.push(Ba.b_tmpl),this.exprAllowed=!0},Y.parenL.updateContext=function(_){var M=_===Y._if||_===Y._for||_===Y._with||_===Y._while;this.context.push(M?Ba.p_stat:Ba.p_expr),this.exprAllowed=!0},Y.incDec.updateContext=function(){},Y._function.updateContext=Y._class.updateContext=function(_){_.beforeExpr&&_!==Y.semi&&_!==Y._else&&!(_===Y._return&&$t.test(this.input.slice(this.lastTokEnd,this.start)))&&!((_===Y.colon||_===Y.braceL)&&this.curContext()===Ba.b_stat)?this.context.push(Ba.f_expr):this.context.push(Ba.f_stat),this.exprAllowed=!1},Y.backQuote.updateContext=function(){this.curContext()===Ba.q_tmpl?this.context.pop():this.context.push(Ba.q_tmpl),this.exprAllowed=!1},Y.star.updateContext=function(_){if(_===Y._function){var M=this.context.length-1;this.context[M]===Ba.f_expr?this.context[M]=Ba.f_expr_gen:this.context[M]=Ba.f_gen}this.exprAllowed=!0},Y.name.updateContext=function(_){var M=!1;this.options.ecmaVersion>=6&&_!==Y.dot&&(this.value==="of"&&!this.exprAllowed||this.value==="yield"&&this.inGeneratorContext())&&(M=!0),this.exprAllowed=M};var H="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",Q=H+" Extended_Pictographic",oe=Q,ye={9:H,10:Q,11:oe},Pe="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",He="Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",rt=He+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",pe=rt+" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho",ke={9:He,10:rt,11:pe},vt={};function pr(_){var M=vt[_]={binary:Ce(ye[_]+" "+Pe),nonBinary:{General_Category:Ce(Pe),Script:Ce(ke[_])}};M.nonBinary.Script_Extensions=M.nonBinary.Script,M.nonBinary.gc=M.nonBinary.General_Category,M.nonBinary.sc=M.nonBinary.Script,M.nonBinary.scx=M.nonBinary.Script_Extensions}pr(9),pr(10),pr(11);var Ft=wi.prototype,zt=function(M){this.parser=M,this.validFlags="gim"+(M.options.ecmaVersion>=6?"uy":"")+(M.options.ecmaVersion>=9?"s":""),this.unicodeProperties=vt[M.options.ecmaVersion>=11?11:M.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]};zt.prototype.reset=function(M,F,R){var K=R.indexOf("u")!==-1;this.start=M|0,this.source=F+"",this.flags=R,this.switchU=K&&this.parser.options.ecmaVersion>=6,this.switchN=K&&this.parser.options.ecmaVersion>=9},zt.prototype.raise=function(M){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+M)},zt.prototype.at=function(M,F){F===void 0&&(F=!1);var R=this.source,K=R.length;if(M>=K)return-1;var _e=R.charCodeAt(M);if(!(F||this.switchU)||_e<=55295||_e>=57344||M+1>=K)return _e;var je=R.charCodeAt(M+1);return je>=56320&&je<=57343?(_e<<10)+je-56613888:_e},zt.prototype.nextIndex=function(M,F){F===void 0&&(F=!1);var R=this.source,K=R.length;if(M>=K)return K;var _e=R.charCodeAt(M),je;return!(F||this.switchU)||_e<=55295||_e>=57344||M+1>=K||(je=R.charCodeAt(M+1))<56320||je>57343?M+1:M+2},zt.prototype.current=function(M){return M===void 0&&(M=!1),this.at(this.pos,M)},zt.prototype.lookahead=function(M){return M===void 0&&(M=!1),this.at(this.nextIndex(this.pos,M),M)},zt.prototype.advance=function(M){M===void 0&&(M=!1),this.pos=this.nextIndex(this.pos,M)},zt.prototype.eat=function(M,F){return F===void 0&&(F=!1),this.current(F)===M?(this.advance(F),!0):!1};function vr(_){return _<=65535?String.fromCharCode(_):(_-=65536,String.fromCharCode((_>>10)+55296,(_&1023)+56320))}Ft.validateRegExpFlags=function(_){for(var M=_.validFlags,F=_.flags,R=0;R<F.length;R++){var K=F.charAt(R);M.indexOf(K)===-1&&this.raise(_.start,"Invalid regular expression flag"),F.indexOf(K,R+1)>-1&&this.raise(_.start,"Duplicate regular expression flag")}},Ft.validateRegExpPattern=function(_){this.regexp_pattern(_),!_.switchN&&this.options.ecmaVersion>=9&&_.groupNames.length>0&&(_.switchN=!0,this.regexp_pattern(_))},Ft.regexp_pattern=function(_){_.pos=0,_.lastIntValue=0,_.lastStringValue="",_.lastAssertionIsQuantifiable=!1,_.numCapturingParens=0,_.maxBackReference=0,_.groupNames.length=0,_.backReferenceNames.length=0,this.regexp_disjunction(_),_.pos!==_.source.length&&(_.eat(41)&&_.raise("Unmatched ')'"),(_.eat(93)||_.eat(125))&&_.raise("Lone quantifier brackets")),_.maxBackReference>_.numCapturingParens&&_.raise("Invalid escape");for(var M=0,F=_.backReferenceNames;M<F.length;M+=1){var R=F[M];_.groupNames.indexOf(R)===-1&&_.raise("Invalid named capture referenced")}},Ft.regexp_disjunction=function(_){for(this.regexp_alternative(_);_.eat(124);)this.regexp_alternative(_);this.regexp_eatQuantifier(_,!0)&&_.raise("Nothing to repeat"),_.eat(123)&&_.raise("Lone quantifier brackets")},Ft.regexp_alternative=function(_){for(;_.pos<_.source.length&&this.regexp_eatTerm(_););},Ft.regexp_eatTerm=function(_){return this.regexp_eatAssertion(_)?(_.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(_)&&_.switchU&&_.raise("Invalid quantifier"),!0):(_.switchU?this.regexp_eatAtom(_):this.regexp_eatExtendedAtom(_))?(this.regexp_eatQuantifier(_),!0):!1},Ft.regexp_eatAssertion=function(_){var M=_.pos;if(_.lastAssertionIsQuantifiable=!1,_.eat(94)||_.eat(36))return!0;if(_.eat(92)){if(_.eat(66)||_.eat(98))return!0;_.pos=M}if(_.eat(40)&&_.eat(63)){var F=!1;if(this.options.ecmaVersion>=9&&(F=_.eat(60)),_.eat(61)||_.eat(33))return this.regexp_disjunction(_),_.eat(41)||_.raise("Unterminated group"),_.lastAssertionIsQuantifiable=!F,!0}return _.pos=M,!1},Ft.regexp_eatQuantifier=function(_,M){return M===void 0&&(M=!1),this.regexp_eatQuantifierPrefix(_,M)?(_.eat(63),!0):!1},Ft.regexp_eatQuantifierPrefix=function(_,M){return _.eat(42)||_.eat(43)||_.eat(63)||this.regexp_eatBracedQuantifier(_,M)},Ft.regexp_eatBracedQuantifier=function(_,M){var F=_.pos;if(_.eat(123)){var R=0,K=-1;if(this.regexp_eatDecimalDigits(_)&&(R=_.lastIntValue,_.eat(44)&&this.regexp_eatDecimalDigits(_)&&(K=_.lastIntValue),_.eat(125)))return K!==-1&&K<R&&!M&&_.raise("numbers out of order in {} quantifier"),!0;_.switchU&&!M&&_.raise("Incomplete quantifier"),_.pos=F}return!1},Ft.regexp_eatAtom=function(_){return this.regexp_eatPatternCharacters(_)||_.eat(46)||this.regexp_eatReverseSolidusAtomEscape(_)||this.regexp_eatCharacterClass(_)||this.regexp_eatUncapturingGroup(_)||this.regexp_eatCapturingGroup(_)},Ft.regexp_eatReverseSolidusAtomEscape=function(_){var M=_.pos;if(_.eat(92)){if(this.regexp_eatAtomEscape(_))return!0;_.pos=M}return!1},Ft.regexp_eatUncapturingGroup=function(_){var M=_.pos;if(_.eat(40)){if(_.eat(63)&&_.eat(58)){if(this.regexp_disjunction(_),_.eat(41))return!0;_.raise("Unterminated group")}_.pos=M}return!1},Ft.regexp_eatCapturingGroup=function(_){if(_.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(_):_.current()===63&&_.raise("Invalid group"),this.regexp_disjunction(_),_.eat(41))return _.numCapturingParens+=1,!0;_.raise("Unterminated group")}return!1},Ft.regexp_eatExtendedAtom=function(_){return _.eat(46)||this.regexp_eatReverseSolidusAtomEscape(_)||this.regexp_eatCharacterClass(_)||this.regexp_eatUncapturingGroup(_)||this.regexp_eatCapturingGroup(_)||this.regexp_eatInvalidBracedQuantifier(_)||this.regexp_eatExtendedPatternCharacter(_)},Ft.regexp_eatInvalidBracedQuantifier=function(_){return this.regexp_eatBracedQuantifier(_,!0)&&_.raise("Nothing to repeat"),!1},Ft.regexp_eatSyntaxCharacter=function(_){var M=_.current();return En(M)?(_.lastIntValue=M,_.advance(),!0):!1};function En(_){return _===36||_>=40&&_<=43||_===46||_===63||_>=91&&_<=94||_>=123&&_<=125}Ft.regexp_eatPatternCharacters=function(_){for(var M=_.pos,F=0;(F=_.current())!==-1&&!En(F);)_.advance();return _.pos!==M},Ft.regexp_eatExtendedPatternCharacter=function(_){var M=_.current();return M!==-1&&M!==36&&!(M>=40&&M<=43)&&M!==46&&M!==63&&M!==91&&M!==94&&M!==124?(_.advance(),!0):!1},Ft.regexp_groupSpecifier=function(_){if(_.eat(63)){if(this.regexp_eatGroupName(_)){_.groupNames.indexOf(_.lastStringValue)!==-1&&_.raise("Duplicate capture group name"),_.groupNames.push(_.lastStringValue);return}_.raise("Invalid group")}},Ft.regexp_eatGroupName=function(_){if(_.lastStringValue="",_.eat(60)){if(this.regexp_eatRegExpIdentifierName(_)&&_.eat(62))return!0;_.raise("Invalid capture group name")}return!1},Ft.regexp_eatRegExpIdentifierName=function(_){if(_.lastStringValue="",this.regexp_eatRegExpIdentifierStart(_)){for(_.lastStringValue+=vr(_.lastIntValue);this.regexp_eatRegExpIdentifierPart(_);)_.lastStringValue+=vr(_.lastIntValue);return!0}return!1},Ft.regexp_eatRegExpIdentifierStart=function(_){var M=_.pos,F=this.options.ecmaVersion>=11,R=_.current(F);return _.advance(F),R===92&&this.regexp_eatRegExpUnicodeEscapeSequence(_,F)&&(R=_.lastIntValue),pn(R)?(_.lastIntValue=R,!0):(_.pos=M,!1)};function pn(_){return gt(_,!0)||_===36||_===95}Ft.regexp_eatRegExpIdentifierPart=function(_){var M=_.pos,F=this.options.ecmaVersion>=11,R=_.current(F);return _.advance(F),R===92&&this.regexp_eatRegExpUnicodeEscapeSequence(_,F)&&(R=_.lastIntValue),Ot(R)?(_.lastIntValue=R,!0):(_.pos=M,!1)};function Ot(_){return rr(_,!0)||_===36||_===95||_===8204||_===8205}Ft.regexp_eatAtomEscape=function(_){return this.regexp_eatBackReference(_)||this.regexp_eatCharacterClassEscape(_)||this.regexp_eatCharacterEscape(_)||_.switchN&&this.regexp_eatKGroupName(_)?!0:(_.switchU&&(_.current()===99&&_.raise("Invalid unicode escape"),_.raise("Invalid escape")),!1)},Ft.regexp_eatBackReference=function(_){var M=_.pos;if(this.regexp_eatDecimalEscape(_)){var F=_.lastIntValue;if(_.switchU)return F>_.maxBackReference&&(_.maxBackReference=F),!0;if(F<=_.numCapturingParens)return!0;_.pos=M}return!1},Ft.regexp_eatKGroupName=function(_){if(_.eat(107)){if(this.regexp_eatGroupName(_))return _.backReferenceNames.push(_.lastStringValue),!0;_.raise("Invalid named reference")}return!1},Ft.regexp_eatCharacterEscape=function(_){return this.regexp_eatControlEscape(_)||this.regexp_eatCControlLetter(_)||this.regexp_eatZero(_)||this.regexp_eatHexEscapeSequence(_)||this.regexp_eatRegExpUnicodeEscapeSequence(_,!1)||!_.switchU&&this.regexp_eatLegacyOctalEscapeSequence(_)||this.regexp_eatIdentityEscape(_)},Ft.regexp_eatCControlLetter=function(_){var M=_.pos;if(_.eat(99)){if(this.regexp_eatControlLetter(_))return!0;_.pos=M}return!1},Ft.regexp_eatZero=function(_){return _.current()===48&&!on(_.lookahead())?(_.lastIntValue=0,_.advance(),!0):!1},Ft.regexp_eatControlEscape=function(_){var M=_.current();return M===116?(_.lastIntValue=9,_.advance(),!0):M===110?(_.lastIntValue=10,_.advance(),!0):M===118?(_.lastIntValue=11,_.advance(),!0):M===102?(_.lastIntValue=12,_.advance(),!0):M===114?(_.lastIntValue=13,_.advance(),!0):!1},Ft.regexp_eatControlLetter=function(_){var M=_.current();return nn(M)?(_.lastIntValue=M%32,_.advance(),!0):!1};function nn(_){return _>=65&&_<=90||_>=97&&_<=122}Ft.regexp_eatRegExpUnicodeEscapeSequence=function(_,M){M===void 0&&(M=!1);var F=_.pos,R=M||_.switchU;if(_.eat(117)){if(this.regexp_eatFixedHexDigits(_,4)){var K=_.lastIntValue;if(R&&K>=55296&&K<=56319){var _e=_.pos;if(_.eat(92)&&_.eat(117)&&this.regexp_eatFixedHexDigits(_,4)){var je=_.lastIntValue;if(je>=56320&&je<=57343)return _.lastIntValue=(K-55296)*1024+(je-56320)+65536,!0}_.pos=_e,_.lastIntValue=K}return!0}if(R&&_.eat(123)&&this.regexp_eatHexDigits(_)&&_.eat(125)&&Zr(_.lastIntValue))return!0;R&&_.raise("Invalid unicode escape"),_.pos=F}return!1};function Zr(_){return _>=0&&_<=1114111}Ft.regexp_eatIdentityEscape=function(_){if(_.switchU)return this.regexp_eatSyntaxCharacter(_)?!0:_.eat(47)?(_.lastIntValue=47,!0):!1;var M=_.current();return M!==99&&(!_.switchN||M!==107)?(_.lastIntValue=M,_.advance(),!0):!1},Ft.regexp_eatDecimalEscape=function(_){_.lastIntValue=0;var M=_.current();if(M>=49&&M<=57){do _.lastIntValue=10*_.lastIntValue+(M-48),_.advance();while((M=_.current())>=48&&M<=57);return!0}return!1},Ft.regexp_eatCharacterClassEscape=function(_){var M=_.current();if(Yr(M))return _.lastIntValue=-1,_.advance(),!0;if(_.switchU&&this.options.ecmaVersion>=9&&(M===80||M===112)){if(_.lastIntValue=-1,_.advance(),_.eat(123)&&this.regexp_eatUnicodePropertyValueExpression(_)&&_.eat(125))return!0;_.raise("Invalid property name")}return!1};function Yr(_){return _===100||_===68||_===115||_===83||_===119||_===87}Ft.regexp_eatUnicodePropertyValueExpression=function(_){var M=_.pos;if(this.regexp_eatUnicodePropertyName(_)&&_.eat(61)){var F=_.lastStringValue;if(this.regexp_eatUnicodePropertyValue(_)){var R=_.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(_,F,R),!0}}if(_.pos=M,this.regexp_eatLoneUnicodePropertyNameOrValue(_)){var K=_.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(_,K),!0}return!1},Ft.regexp_validateUnicodePropertyNameAndValue=function(_,M,F){tn(_.unicodeProperties.nonBinary,M)||_.raise("Invalid property name"),_.unicodeProperties.nonBinary[M].test(F)||_.raise("Invalid property value")},Ft.regexp_validateUnicodePropertyNameOrValue=function(_,M){_.unicodeProperties.binary.test(M)||_.raise("Invalid property name")},Ft.regexp_eatUnicodePropertyName=function(_){var M=0;for(_.lastStringValue="";_i(M=_.current());)_.lastStringValue+=vr(M),_.advance();return _.lastStringValue!==""};function _i(_){return nn(_)||_===95}Ft.regexp_eatUnicodePropertyValue=function(_){var M=0;for(_.lastStringValue="";an(M=_.current());)_.lastStringValue+=vr(M),_.advance();return _.lastStringValue!==""};function an(_){return _i(_)||on(_)}Ft.regexp_eatLoneUnicodePropertyNameOrValue=function(_){return this.regexp_eatUnicodePropertyValue(_)},Ft.regexp_eatCharacterClass=function(_){if(_.eat(91)){if(_.eat(94),this.regexp_classRanges(_),_.eat(93))return!0;_.raise("Unterminated character class")}return!1},Ft.regexp_classRanges=function(_){for(;this.regexp_eatClassAtom(_);){var M=_.lastIntValue;if(_.eat(45)&&this.regexp_eatClassAtom(_)){var F=_.lastIntValue;_.switchU&&(M===-1||F===-1)&&_.raise("Invalid character class"),M!==-1&&F!==-1&&M>F&&_.raise("Range out of order in character class")}}},Ft.regexp_eatClassAtom=function(_){var M=_.pos;if(_.eat(92)){if(this.regexp_eatClassEscape(_))return!0;if(_.switchU){var F=_.current();(F===99||Pi(F))&&_.raise("Invalid class escape"),_.raise("Invalid escape")}_.pos=M}var R=_.current();return R!==93?(_.lastIntValue=R,_.advance(),!0):!1},Ft.regexp_eatClassEscape=function(_){var M=_.pos;if(_.eat(98))return _.lastIntValue=8,!0;if(_.switchU&&_.eat(45))return _.lastIntValue=45,!0;if(!_.switchU&&_.eat(99)){if(this.regexp_eatClassControlLetter(_))return!0;_.pos=M}return this.regexp_eatCharacterClassEscape(_)||this.regexp_eatCharacterEscape(_)},Ft.regexp_eatClassControlLetter=function(_){var M=_.current();return on(M)||M===95?(_.lastIntValue=M%32,_.advance(),!0):!1},Ft.regexp_eatHexEscapeSequence=function(_){var M=_.pos;if(_.eat(120)){if(this.regexp_eatFixedHexDigits(_,2))return!0;_.switchU&&_.raise("Invalid escape"),_.pos=M}return!1},Ft.regexp_eatDecimalDigits=function(_){var M=_.pos,F=0;for(_.lastIntValue=0;on(F=_.current());)_.lastIntValue=10*_.lastIntValue+(F-48),_.advance();return _.pos!==M};function on(_){return _>=48&&_<=57}Ft.regexp_eatHexDigits=function(_){var M=_.pos,F=0;for(_.lastIntValue=0;Xi(F=_.current());)_.lastIntValue=16*_.lastIntValue+yi(F),_.advance();return _.pos!==M};function Xi(_){return _>=48&&_<=57||_>=65&&_<=70||_>=97&&_<=102}function yi(_){return _>=65&&_<=70?10+(_-65):_>=97&&_<=102?10+(_-97):_-48}Ft.regexp_eatLegacyOctalEscapeSequence=function(_){if(this.regexp_eatOctalDigit(_)){var M=_.lastIntValue;if(this.regexp_eatOctalDigit(_)){var F=_.lastIntValue;M<=3&&this.regexp_eatOctalDigit(_)?_.lastIntValue=M*64+F*8+_.lastIntValue:_.lastIntValue=M*8+F}else _.lastIntValue=M;return!0}return!1},Ft.regexp_eatOctalDigit=function(_){var M=_.current();return Pi(M)?(_.lastIntValue=M-48,_.advance(),!0):(_.lastIntValue=0,!1)};function Pi(_){return _>=48&&_<=55}Ft.regexp_eatFixedHexDigits=function(_,M){var F=_.pos;_.lastIntValue=0;for(var R=0;R<M;++R){var K=_.current();if(!Xi(K))return _.pos=F,!1;_.lastIntValue=16*_.lastIntValue+yi(K),_.advance()}return!0};var bi=function(M){this.type=M.type,this.value=M.value,this.start=M.start,this.end=M.end,M.options.locations&&(this.loc=new wt(M,M.startLoc,M.endLoc)),M.options.ranges&&(this.range=[M.start,M.end])},ht=wi.prototype;ht.next=function(_){!_&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new bi(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},ht.getToken=function(){return this.next(),new bi(this)},typeof Symbol!="undefined"&&(ht[Symbol.iterator]=function(){var _=this;return{next:function(){var M=_.getToken();return{done:M.type===Y.eof,value:M}}}}),ht.curContext=function(){return this.context[this.context.length-1]},ht.nextToken=function(){var _=this.curContext();if((!_||!_.preserveSpace)&&this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length)return this.finishToken(Y.eof);if(_.override)return _.override(this);this.readToken(this.fullCharCodeAtPos())},ht.readToken=function(_){return gt(_,this.options.ecmaVersion>=6)||_===92?this.readWord():this.getTokenFromCode(_)},ht.fullCharCodeAtPos=function(){var _=this.input.charCodeAt(this.pos);if(_<=55295||_>=57344)return _;var M=this.input.charCodeAt(this.pos+1);return(_<<10)+M-56613888},ht.skipBlockComment=function(){var _=this.options.onComment&&this.curPosition(),M=this.pos,F=this.input.indexOf("*/",this.pos+=2);if(F===-1&&this.raise(this.pos-2,"Unterminated comment"),this.pos=F+2,this.options.locations){ft.lastIndex=M;for(var R;(R=ft.exec(this.input))&&R.index<this.pos;)++this.curLine,this.lineStart=R.index+R[0].length}this.options.onComment&&this.options.onComment(!0,this.input.slice(M+2,F),M,this.pos,_,this.curPosition())},ht.skipLineComment=function(_){for(var M=this.pos,F=this.options.onComment&&this.curPosition(),R=this.input.charCodeAt(this.pos+=_);this.pos<this.input.length&&!Je(R);)R=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(M+_,this.pos),M,this.pos,F,this.curPosition())},ht.skipSpace=function(){e:for(;this.pos<this.input.length;){var _=this.input.charCodeAt(this.pos);switch(_){case 32:case 160:++this.pos;break;case 13:this.input.charCodeAt(this.pos+1)===10&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(_>8&&_<14||_>=5760&&At.test(String.fromCharCode(_)))++this.pos;else break e}}},ht.finishToken=function(_,M){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var F=this.type;this.type=_,this.value=M,this.updateContext(F)},ht.readToken_dot=function(){var _=this.input.charCodeAt(this.pos+1);if(_>=48&&_<=57)return this.readNumber(!0);var M=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&_===46&&M===46?(this.pos+=3,this.finishToken(Y.ellipsis)):(++this.pos,this.finishToken(Y.dot))},ht.readToken_slash=function(){var _=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):_===61?this.finishOp(Y.assign,2):this.finishOp(Y.slash,1)},ht.readToken_mult_modulo_exp=function(_){var M=this.input.charCodeAt(this.pos+1),F=1,R=_===42?Y.star:Y.modulo;return this.options.ecmaVersion>=7&&_===42&&M===42&&(++F,R=Y.starstar,M=this.input.charCodeAt(this.pos+2)),M===61?this.finishOp(Y.assign,F+1):this.finishOp(R,F)},ht.readToken_pipe_amp=function(_){var M=this.input.charCodeAt(this.pos+1);if(M===_){if(this.options.ecmaVersion>=12){var F=this.input.charCodeAt(this.pos+2);if(F===61)return this.finishOp(Y.assign,3)}return this.finishOp(_===124?Y.logicalOR:Y.logicalAND,2)}return M===61?this.finishOp(Y.assign,2):this.finishOp(_===124?Y.bitwiseOR:Y.bitwiseAND,1)},ht.readToken_caret=function(){var _=this.input.charCodeAt(this.pos+1);return _===61?this.finishOp(Y.assign,2):this.finishOp(Y.bitwiseXOR,1)},ht.readToken_plus_min=function(_){var M=this.input.charCodeAt(this.pos+1);return M===_?M===45&&!this.inModule&&this.input.charCodeAt(this.pos+2)===62&&(this.lastTokEnd===0||$t.test(this.input.slice(this.lastTokEnd,this.pos)))?(this.skipLineComment(3),this.skipSpace(),this.nextToken()):this.finishOp(Y.incDec,2):M===61?this.finishOp(Y.assign,2):this.finishOp(Y.plusMin,1)},ht.readToken_lt_gt=function(_){var M=this.input.charCodeAt(this.pos+1),F=1;return M===_?(F=_===62&&this.input.charCodeAt(this.pos+2)===62?3:2,this.input.charCodeAt(this.pos+F)===61?this.finishOp(Y.assign,F+1):this.finishOp(Y.bitShift,F)):M===33&&_===60&&!this.inModule&&this.input.charCodeAt(this.pos+2)===45&&this.input.charCodeAt(this.pos+3)===45?(this.skipLineComment(4),this.skipSpace(),this.nextToken()):(M===61&&(F=2),this.finishOp(Y.relational,F))},ht.readToken_eq_excl=function(_){var M=this.input.charCodeAt(this.pos+1);return M===61?this.finishOp(Y.equality,this.input.charCodeAt(this.pos+2)===61?3:2):_===61&&M===62&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(Y.arrow)):this.finishOp(_===61?Y.eq:Y.prefix,1)},ht.readToken_question=function(){var _=this.options.ecmaVersion;if(_>=11){var M=this.input.charCodeAt(this.pos+1);if(M===46){var F=this.input.charCodeAt(this.pos+2);if(F<48||F>57)return this.finishOp(Y.questionDot,2)}if(M===63){if(_>=12){var R=this.input.charCodeAt(this.pos+2);if(R===61)return this.finishOp(Y.assign,3)}return this.finishOp(Y.coalesce,2)}}return this.finishOp(Y.question,1)},ht.getTokenFromCode=function(_){switch(_){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(Y.parenL);case 41:return++this.pos,this.finishToken(Y.parenR);case 59:return++this.pos,this.finishToken(Y.semi);case 44:return++this.pos,this.finishToken(Y.comma);case 91:return++this.pos,this.finishToken(Y.bracketL);case 93:return++this.pos,this.finishToken(Y.bracketR);case 123:return++this.pos,this.finishToken(Y.braceL);case 125:return++this.pos,this.finishToken(Y.braceR);case 58:return++this.pos,this.finishToken(Y.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(Y.backQuote);case 48:var M=this.input.charCodeAt(this.pos+1);if(M===120||M===88)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(M===111||M===79)return this.readRadixNumber(8);if(M===98||M===66)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(_);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(_);case 124:case 38:return this.readToken_pipe_amp(_);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(_);case 60:case 62:return this.readToken_lt_gt(_);case 61:case 33:return this.readToken_eq_excl(_);case 63:return this.readToken_question();case 126:return this.finishOp(Y.prefix,1)}this.raise(this.pos,"Unexpected character '"+qi(_)+"'")},ht.finishOp=function(_,M){var F=this.input.slice(this.pos,this.pos+M);return this.pos+=M,this.finishToken(_,F)},ht.readRegexp=function(){for(var _,M,F=this.pos;;){this.pos>=this.input.length&&this.raise(F,"Unterminated regular expression");var R=this.input.charAt(this.pos);if($t.test(R)&&this.raise(F,"Unterminated regular expression"),_)_=!1;else{if(R==="[")M=!0;else if(R==="]"&&M)M=!1;else if(R==="/"&&!M)break;_=R==="\\"}++this.pos}var K=this.input.slice(F,this.pos);++this.pos;var _e=this.pos,je=this.readWord1();this.containsEsc&&this.unexpected(_e);var pt=this.regexpState||(this.regexpState=new zt(this));pt.reset(F,K,je),this.validateRegExpFlags(pt),this.validateRegExpPattern(pt);var dt=null;try{dt=new RegExp(K,je)}catch(ur){}return this.finishToken(Y.regexp,{pattern:K,flags:je,value:dt})},ht.readInt=function(_,M,F){for(var R=this.options.ecmaVersion>=12&&M===void 0,K=F&&this.input.charCodeAt(this.pos)===48,_e=this.pos,je=0,pt=0,dt=0,ur=M==null?Infinity:M;dt<ur;++dt,++this.pos){var yr=this.input.charCodeAt(this.pos),In=void 0;if(R&&yr===95){K&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),pt===95&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),dt===0&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),pt=yr;continue}if(yr>=97?In=yr-97+10:yr>=65?In=yr-65+10:yr>=48&&yr<=57?In=yr-48:In=Infinity,In>=_)break;pt=yr,je=je*_+In}return R&&pt===95&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===_e||M!=null&&this.pos-_e!==M?null:je};function Pt(_,M){return M?parseInt(_,8):parseFloat(_.replace(/_/g,""))}function Aa(_){return typeof BigInt!="function"?null:BigInt(_.replace(/_/g,""))}ht.readRadixNumber=function(_){var M=this.pos;this.pos+=2;var F=this.readInt(_);return F==null&&this.raise(this.start+2,"Expected number in radix "+_),this.options.ecmaVersion>=11&&this.input.charCodeAt(this.pos)===110?(F=Aa(this.input.slice(M,this.pos)),++this.pos):gt(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(Y.num,F)},ht.readNumber=function(_){var M=this.pos;!_&&this.readInt(10,void 0,!0)===null&&this.raise(M,"Invalid number");var F=this.pos-M>=2&&this.input.charCodeAt(M)===48;F&&this.strict&&this.raise(M,"Invalid number");var R=this.input.charCodeAt(this.pos);if(!F&&!_&&this.options.ecmaVersion>=11&&R===110){var K=Aa(this.input.slice(M,this.pos));return++this.pos,gt(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(Y.num,K)}F&&/[89]/.test(this.input.slice(M,this.pos))&&(F=!1),R===46&&!F&&(++this.pos,this.readInt(10),R=this.input.charCodeAt(this.pos)),(R===69||R===101)&&!F&&(R=this.input.charCodeAt(++this.pos),(R===43||R===45)&&++this.pos,this.readInt(10)===null&&this.raise(M,"Invalid number")),gt(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var _e=Pt(this.input.slice(M,this.pos),F);return this.finishToken(Y.num,_e)},ht.readCodePoint=function(){var _=this.input.charCodeAt(this.pos),M;if(_===123){this.options.ecmaVersion<6&&this.unexpected();var F=++this.pos;M=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,M>1114111&&this.invalidStringToken(F,"Code point out of bounds")}else M=this.readHexChar(4);return M};function qi(_){return _<=65535?String.fromCharCode(_):(_-=65536,String.fromCharCode((_>>10)+55296,(_&1023)+56320))}ht.readString=function(_){for(var M="",F=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var R=this.input.charCodeAt(this.pos);if(R===_)break;R===92?(M+=this.input.slice(F,this.pos),M+=this.readEscapedChar(!1),F=this.pos):(Je(R,this.options.ecmaVersion>=10)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return M+=this.input.slice(F,this.pos++),this.finishToken(Y.string,M)};var Ii={};ht.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(_){if(_===Ii)this.readInvalidTemplateToken();else throw _}this.inTemplateElement=!1},ht.invalidStringToken=function(_,M){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw Ii;this.raise(_,M)},ht.readTmplToken=function(){for(var _="",M=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var F=this.input.charCodeAt(this.pos);if(F===96||F===36&&this.input.charCodeAt(this.pos+1)===123)return this.pos===this.start&&(this.type===Y.template||this.type===Y.invalidTemplate)?F===36?(this.pos+=2,this.finishToken(Y.dollarBraceL)):(++this.pos,this.finishToken(Y.backQuote)):(_+=this.input.slice(M,this.pos),this.finishToken(Y.template,_));if(F===92)_+=this.input.slice(M,this.pos),_+=this.readEscapedChar(!0),M=this.pos;else if(Je(F)){switch(_+=this.input.slice(M,this.pos),++this.pos,F){case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:_+=`
`;break;default:_+=String.fromCharCode(F);break}this.options.locations&&(++this.curLine,this.lineStart=this.pos),M=this.pos}else++this.pos}},ht.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if(this.input[this.pos+1]!=="{")break;case"`":return this.finishToken(Y.invalidTemplate,this.input.slice(this.start,this.pos))}this.raise(this.start,"Unterminated template")},ht.readEscapedChar=function(_){var M=this.input.charCodeAt(++this.pos);switch(++this.pos,M){case 110:return`
`;case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return qi(this.readCodePoint());case 116:return"	";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(_){var F=this.pos-1;return this.invalidStringToken(F,"Invalid escape sequence in template string"),null}default:if(M>=48&&M<=55){var R=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],K=parseInt(R,8);return K>255&&(R=R.slice(0,-1),K=parseInt(R,8)),this.pos+=R.length-1,M=this.input.charCodeAt(this.pos),(R!=="0"||M===56||M===57)&&(this.strict||_)&&this.invalidStringToken(this.pos-1-R.length,_?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(K)}return Je(M)?"":String.fromCharCode(M)}},ht.readHexChar=function(_){var M=this.pos,F=this.readInt(16,_);return F===null&&this.invalidStringToken(M,"Bad character escape sequence"),F},ht.readWord1=function(){this.containsEsc=!1;for(var _="",M=!0,F=this.pos,R=this.options.ecmaVersion>=6;this.pos<this.input.length;){var K=this.fullCharCodeAtPos();if(rr(K,R))this.pos+=K<=65535?1:2;else if(K===92){this.containsEsc=!0,_+=this.input.slice(F,this.pos);var _e=this.pos;this.input.charCodeAt(++this.pos)!==117&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var je=this.readCodePoint();(M?gt:rr)(je,R)||this.invalidStringToken(_e,"Invalid Unicode escape"),_+=qi(je),F=this.pos}else break;M=!1}return _+this.input.slice(F,this.pos)},ht.readWord=function(){var _=this.readWord1(),M=Y.name;return this.keywords.test(_)&&(M=it[_]),this.finishToken(M,_)};var pi="7.4.1";wi.acorn={Parser:wi,version:pi,defaultOptions:Bt,Position:De,SourceLocation:wt,getLineInfo:mt,Node:Ri,TokenType:xt,tokTypes:Y,keywordTypes:it,TokContext:Ko,tokContexts:Ba,isIdentifierChar:rr,isIdentifierStart:gt,Token:bi,isNewLine:Je,lineBreak:$t,lineBreakG:ft,nonASCIIwhitespace:At};function wa(_,M){return wi.parse(_,M)}function $s(_,M,F){return wi.parseExpressionAt(_,M,F)}function Ir(_,M){return wi.tokenizer(_,M)}function wr(_,M){_.prototype=Object.create(M.prototype),_.prototype.constructor=_,_.__proto__=M}function Mt(_){var M=typeof Map=="function"?new Map:void 0;return Mt=function(R){if(R===null||!Fu(R))return R;if(typeof R!="function")throw new TypeError("Super expression must either be null or a function");if(typeof M!="undefined"){if(M.has(R))return M.get(R);M.set(R,K)}function K(){return ne(R,arguments,Ra(this).constructor)}return K.prototype=Object.create(R.prototype,{constructor:{value:K,enumerable:!1,writable:!0,configurable:!0}}),oo(K,R)},Mt(_)}function bo(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(_){return!1}}function ne(_,M,F){return bo()?ne=Reflect.construct:ne=function(K,_e,je){var pt=[null];pt.push.apply(pt,_e);var dt=Function.bind.apply(K,pt),ur=new dt;return je&&oo(ur,je.prototype),ur},ne.apply(null,arguments)}function Fu(_){return Function.toString.call(_).indexOf("[native code]")!==-1}function oo(_,M){return oo=Object.setPrototypeOf||function(R,K){return R.__proto__=K,R},oo(_,M)}function Ra(_){return Ra=Object.setPrototypeOf?Object.getPrototypeOf:function(F){return F.__proto__||Object.getPrototypeOf(F)},Ra(_)}var Ta=function(_){wr(M,_);function M(){return _.apply(this,arguments)||this}return M}(Mt(Error)),Qi=function(_){wr(M,_);function M(){return _.apply(this,arguments)||this}return M}(Mt(SyntaxError)),Uo=function(_){wr(M,_);function M(){return _.apply(this,arguments)||this}return M}(Mt(ReferenceError)),$o=function(_){wr(M,_);function M(){return _.apply(this,arguments)||this}return M}(Mt(TypeError)),xu=function(_){wr(M,_);function M(){return _.apply(this,arguments)||this}return M}(Ta),Eo=function(_){wr(M,_);function M(){return _.apply(this,arguments)||this}return M}(Qi),Zo=function(_){wr(M,_);function M(){return _.apply(this,arguments)||this}return M}(Uo),sa={UnknownError:[3001,"%0",xu],ExecutionTimeOutError:[3002,"Script execution timed out after %0ms",xu],NodeTypeSyntaxError:[1001,"Unknown node type: %0",Zo],BinaryOperatorSyntaxError:[1002,"Unknown binary operator: %0",Zo],LogicalOperatorSyntaxError:[1003,"Unknown logical operator: %0",Zo],UnaryOperatorSyntaxError:[1004,"Unknown unary operator: %0",Zo],UpdateOperatorSyntaxError:[1005,"Unknown update operator: %0",Zo],ObjectStructureSyntaxError:[1006,"Unknown object structure: %0",Zo],AssignmentExpressionSyntaxError:[1007,"Unknown assignment expression: %0",Zo],VariableTypeSyntaxError:[1008,"Unknown variable type: %0",Zo],ParamTypeSyntaxError:[1009,"Unknown param type: %0",Zo],AssignmentTypeSyntaxError:[1010,"Unknown assignment type: %0",Zo],FunctionUndefinedReferenceError:[2001,"%0 is not a function",Uo],VariableUndefinedReferenceError:[2002,"%0 is not defined",Uo],IsNotConstructor:[2003,"%0 is not a constructor",$o]};function so(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(_){return!1}}function jo(_,M,F){return so()?jo=Reflect.construct:jo=function(K,_e,je){var pt=[null];pt.push.apply(pt,_e);var dt=Function.bind.apply(K,pt),ur=new dt;return je&&Ya(ur,je.prototype),ur},jo.apply(null,arguments)}function Ya(_,M){return Ya=Object.setPrototypeOf||function(R,K){return R.__proto__=K,R},Ya(_,M)}var Gs="0.0.3";function ll(_,M){Object.defineProperty(_,"name",{value:M,writable:!1,enumerable:!1,configurable:!0})}var os=Object.prototype.hasOwnProperty,ie=Symbol("Break"),Ee=Symbol("Continue"),qe=Symbol("DefaultCase"),Rt=Symbol("EmptyStatementReturn"),Or=Symbol("WithScopeName"),Tn=Symbol("SuperScopeName"),Ti=Symbol("RootScopeName"),ro=Symbol("GlobalScopeName");function La(_){return typeof _=="function"}var ja=function(){function _(F){this.interpreter=F}var M=_.prototype;return M.generator=function(){var R=this.interpreter;function K(){return this.getCurrentScope()}function _e(){return this.getGlobalScope()}function je(){return this.getCurrentContext()}return{getOptions:R.getOptions.bind(R),getCurrentScope:K.bind(R),getGlobalScope:_e.bind(R),getCurrentContext:je.bind(R),getExecStartTime:R.getExecStartTime.bind(R)}},_}();function Qo(_,M,F){if(F===void 0&&(F=!0),!(_ instanceof ja))throw new Error("Illegal call");if(typeof M!="string")return M;if(!!M){var R=_.generator(),K=R.getOptions(),_e={timeout:K.timeout,_initEnv:function(){F||this.setCurrentContext(R.getCurrentContext()),this.execStartTime=R.getExecStartTime(),this.execEndTime=this.execStartTime}},je=F?R.getGlobalScope():R.getCurrentScope(),pt=new ko(je,_e);return pt.evaluate(M)}}Object.defineProperty(Qo,"__IS_EVAL_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});function ps(_){if(!(_ instanceof ja))throw new Error("Illegal call");for(var M=_.generator(),F=arguments.length,R=new Array(F>1?F-1:0),K=1;K<F;K++)R[K-1]=arguments[K];var _e=R.pop(),je=new ko(M.getGlobalScope(),M.getOptions()),pt=`
		    (function anonymous(`+R.join(",")+`){
		        `+_e+`
		    });
		    `;return je.evaluate(pt)}Object.defineProperty(ps,"__IS_FUNCTION_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});var Jo=function(M){this.value=M},Ss=function(M){this.value=M},Lo=function(M){this.value=M},Vo=function(M,F,R){F===void 0&&(F=null),this.name=R,this.parent=F,this.data=M,this.labelStack=[]};function Qs(){}function ou(_,M){return _===void 0&&(_=null),new Vo(Object.create(null),_,M)}function ds(_){return Object.create(_)}var ga={NaN:NaN,Infinity:Infinity,undefined:void 0,Object,Array,String,Boolean,Number,Date,RegExp,Error,URIError,TypeError,RangeError,SyntaxError,ReferenceError,Float32Array,Float64Array,Uint32Array,Math,parseInt,parseFloat,isNaN,isFinite,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,escape,unescape,eval:Qo,Function:ps};typeof JSON!="undefined"&&(ga.JSON=JSON),typeof Promise!="undefined"&&(ga.Promise=Promise),typeof Set!="undefined"&&(ga.Set=Set),typeof Map!="undefined"&&(ga.Map=Map),typeof Symbol!="undefined"&&(ga.Symbol=Symbol),typeof Proxy!="undefined"&&(ga.Proxy=Proxy),typeof WeakMap!="undefined"&&(ga.WeakMap=WeakMap),typeof WeakSet!="undefined"&&(ga.WeakSet=WeakSet),typeof Reflect!="undefined"&&(ga.Reflect=Reflect);var ko=function(){function _(F,R){F===void 0&&(F=_.global),R===void 0&&(R={}),this.sourceList=[],this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.isVarDeclMode=!1,this.lastExecNode=null,this.isRunning=!1,this.options={ecmaVersion:R.ecmaVersion||_.ecmaVersion,timeout:R.timeout||0,rootContext:R.rootContext,globalContextInFunction:R.globalContextInFunction===void 0?_.globalContextInFunction:R.globalContextInFunction,_initEnv:R._initEnv},this.context=F||Object.create(null),this.callStack=[],this.initEnvironment(this.context)}var M=_.prototype;return M.initEnvironment=function(R){var K;if(R instanceof Vo)K=R;else{var _e=null,je=this.createSuperScope(R);this.options.rootContext&&(_e=new Vo(ds(this.options.rootContext),je,Ti)),K=new Vo(R,_e||je,ro)}this.globalScope=K,this.currentScope=this.globalScope,this.globalContext=K.data,this.currentContext=K.data,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.execStartTime=Date.now(),this.execEndTime=this.execStartTime;var pt=this.options._initEnv;pt&&pt.call(this)},M.getExecStartTime=function(){return this.execStartTime},M.getExecutionTime=function(){return this.execEndTime-this.execStartTime},M.setExecTimeout=function(R){R===void 0&&(R=0),this.options.timeout=R},M.getOptions=function(){return this.options},M.getGlobalScope=function(){return this.globalScope},M.getCurrentScope=function(){return this.currentScope},M.getCurrentContext=function(){return this.currentContext},M.isInterruptThrow=function(R){return R instanceof xu||R instanceof Zo||R instanceof Eo},M.createSuperScope=function(R){var K=Object.assign({},ga),_e=Object.keys(K);return _e.forEach(function(je){je in R&&delete K[je]}),new Vo(K,null,Tn)},M.setCurrentContext=function(R){this.currentContext=R},M.setCurrentScope=function(R){this.currentScope=R},M.evaluate=function(R){R===void 0&&(R="");var K;if(!!R)return K=wa(R,{ranges:!0,locations:!0,ecmaVersion:this.options.ecmaVersion||_.ecmaVersion}),this.evaluateNode(K,R)},M.appendCode=function(R){return this.evaluate(R)},M.evaluateNode=function(R,K){var _e=this;K===void 0&&(K=""),this.value=void 0,this.source=K,this.sourceList.push(K),this.isRunning=!0,this.execStartTime=Date.now(),this.execEndTime=this.execStartTime,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var je=this.getCurrentScope(),pt=this.getCurrentContext(),dt=je.labelStack.concat([]),ur=this.callStack.concat([]),yr=function(){_e.setCurrentScope(je),_e.setCurrentContext(pt),je.labelStack=dt,_e.callStack=ur};try{var In=this.createClosure(R);this.addDeclarationsToScope(this.collectDeclVars,this.collectDeclFuncs,this.getCurrentScope()),In()}catch(Bn){throw Bn}finally{yr(),this.execEndTime=Date.now()}return this.isRunning=!1,this.getValue()},M.createErrorMessage=function(R,K,_e){var je=R[1].replace("%0",String(K));return _e!==null&&(je+=this.getNodePosition(_e||this.lastExecNode)),je},M.createError=function(R,K){return new K(R)},M.createThrowError=function(R,K){return this.createError(R,K)},M.createInternalThrowError=function(R,K,_e){return this.createError(this.createErrorMessage(R,K,_e),R[2])},M.checkTimeout=function(){if(!this.isRunning)return!1;var R=this.options.timeout||0,K=Date.now();return K-this.execStartTime>R},M.getNodePosition=function(R){if(R){var K="";return R.loc?" ["+R.loc.start.line+":"+R.loc.start.column+"]"+K:""}return""},M.createClosure=function(R){var K=this,_e;switch(R.type){case"BinaryExpression":_e=this.binaryExpressionHandler(R);break;case"LogicalExpression":_e=this.logicalExpressionHandler(R);break;case"UnaryExpression":_e=this.unaryExpressionHandler(R);break;case"UpdateExpression":_e=this.updateExpressionHandler(R);break;case"ObjectExpression":_e=this.objectExpressionHandler(R);break;case"ArrayExpression":_e=this.arrayExpressionHandler(R);break;case"CallExpression":_e=this.callExpressionHandler(R);break;case"NewExpression":_e=this.newExpressionHandler(R);break;case"MemberExpression":_e=this.memberExpressionHandler(R);break;case"ThisExpression":_e=this.thisExpressionHandler(R);break;case"SequenceExpression":_e=this.sequenceExpressionHandler(R);break;case"Literal":_e=this.literalHandler(R);break;case"Identifier":_e=this.identifierHandler(R);break;case"AssignmentExpression":_e=this.assignmentExpressionHandler(R);break;case"FunctionDeclaration":_e=this.functionDeclarationHandler(R);break;case"VariableDeclaration":_e=this.variableDeclarationHandler(R);break;case"BlockStatement":case"Program":_e=this.programHandler(R);break;case"ExpressionStatement":_e=this.expressionStatementHandler(R);break;case"EmptyStatement":_e=this.emptyStatementHandler(R);break;case"ReturnStatement":_e=this.returnStatementHandler(R);break;case"FunctionExpression":_e=this.functionExpressionHandler(R);break;case"IfStatement":_e=this.ifStatementHandler(R);break;case"ConditionalExpression":_e=this.conditionalExpressionHandler(R);break;case"ForStatement":_e=this.forStatementHandler(R);break;case"WhileStatement":_e=this.whileStatementHandler(R);break;case"DoWhileStatement":_e=this.doWhileStatementHandler(R);break;case"ForInStatement":_e=this.forInStatementHandler(R);break;case"WithStatement":_e=this.withStatementHandler(R);break;case"ThrowStatement":_e=this.throwStatementHandler(R);break;case"TryStatement":_e=this.tryStatementHandler(R);break;case"ContinueStatement":_e=this.continueStatementHandler(R);break;case"BreakStatement":_e=this.breakStatementHandler(R);break;case"SwitchStatement":_e=this.switchStatementHandler(R);break;case"LabeledStatement":_e=this.labeledStatementHandler(R);break;case"DebuggerStatement":_e=this.debuggerStatementHandler(R);break;default:throw this.createInternalThrowError(sa.NodeTypeSyntaxError,R.type,R)}return function(){var je=K.options.timeout;if(je&&je>0&&K.checkTimeout())throw K.createInternalThrowError(sa.ExecutionTimeOutError,je,null);return K.lastExecNode=R,_e.apply(void 0,arguments)}},M.binaryExpressionHandler=function(R){var K=this,_e=this.createClosure(R.left),je=this.createClosure(R.right);return function(){var pt=_e(),dt=je();switch(R.operator){case"==":return pt==dt;case"!=":return pt!=dt;case"===":return pt===dt;case"!==":return pt!==dt;case"<":return pt<dt;case"<=":return pt<=dt;case">":return pt>dt;case">=":return pt>=dt;case"<<":return pt<<dt;case">>":return pt>>dt;case">>>":return pt>>>dt;case"+":return pt+dt;case"-":return pt-dt;case"*":return pt*dt;case"**":return Math.pow(pt,dt);case"/":return pt/dt;case"%":return pt%dt;case"|":return pt|dt;case"^":return pt^dt;case"&":return pt&dt;case"in":return pt in dt;case"instanceof":return pt instanceof dt;default:throw K.createInternalThrowError(sa.BinaryOperatorSyntaxError,R.operator,R)}}},M.logicalExpressionHandler=function(R){var K=this,_e=this.createClosure(R.left),je=this.createClosure(R.right);return function(){switch(R.operator){case"||":return _e()||je();case"&&":return _e()&&je();default:throw K.createInternalThrowError(sa.LogicalOperatorSyntaxError,R.operator,R)}}},M.unaryExpressionHandler=function(R){var K=this;switch(R.operator){case"delete":var _e=this.createObjectGetter(R.argument),je=this.createNameGetter(R.argument);return function(){var yr=_e(),In=je();return delete yr[In]};default:var pt;if(R.operator==="typeof"&&R.argument.type==="Identifier"){var dt=this.createObjectGetter(R.argument),ur=this.createNameGetter(R.argument);pt=function(){return dt()[ur()]}}else pt=this.createClosure(R.argument);return function(){var yr=pt();switch(R.operator){case"-":return-yr;case"+":return+yr;case"!":return!yr;case"~":return~yr;case"void":return;case"typeof":return typeof yr;default:throw K.createInternalThrowError(sa.UnaryOperatorSyntaxError,R.operator,R)}}}},M.updateExpressionHandler=function(R){var K=this,_e=this.createObjectGetter(R.argument),je=this.createNameGetter(R.argument);return function(){var pt=_e(),dt=je();switch(K.assertVariable(pt,dt,R),R.operator){case"++":return R.prefix?++pt[dt]:pt[dt]++;case"--":return R.prefix?--pt[dt]:pt[dt]--;default:throw K.createInternalThrowError(sa.UpdateOperatorSyntaxError,R.operator,R)}}},M.objectExpressionHandler=function(R){var K=this,_e=[];function je(dt){return dt.type==="Identifier"?dt.name:dt.type==="Literal"?dt.value:this.throwError(sa.ObjectStructureSyntaxError,dt.type,dt)}var pt=Object.create(null);return R.properties.forEach(function(dt){var ur=dt.kind,yr=je(dt.key);(!pt[yr]||ur==="init")&&(pt[yr]={}),pt[yr][ur]=K.createClosure(dt.value),_e.push({key:yr,property:dt})}),function(){for(var dt={},ur=_e.length,yr=0;yr<ur;yr++){var In=_e[yr],Bn=In.key,Qn=pt[Bn],Vi=Qn.init?Qn.init():void 0,Li=Qn.get?Qn.get():function(){},ba=Qn.set?Qn.set():function(fl){};if("set"in Qn||"get"in Qn){var Gi={configurable:!0,enumerable:!0,get:Li,set:ba};Object.defineProperty(dt,Bn,Gi)}else{var As=In.property,Eu=As.kind;As.key.type==="Identifier"&&As.value.type==="FunctionExpression"&&Eu==="init"&&!As.value.id&&ll(Vi,As.key.name),dt[Bn]=Vi}}return dt}},M.arrayExpressionHandler=function(R){var K=this,_e=R.elements.map(function(je){return je&&K.createClosure(je)});return function(){for(var je=_e.length,pt=Array(je),dt=0;dt<je;dt++){var ur=_e[dt];ur&&(pt[dt]=ur())}return pt}},M.safeObjectGet=function(R,K,_e){return R[K]},M.createCallFunctionGetter=function(R){var K=this;switch(R.type){case"MemberExpression":var _e=this.createClosure(R.object),je=this.createMemberKeyGetter(R),pt=this.source;return function(){var ur=_e(),yr=je(),In=K.safeObjectGet(ur,yr,R);if(!In||!La(In)){var Bn=pt.slice(R.start,R.end);throw K.createInternalThrowError(sa.FunctionUndefinedReferenceError,Bn,R)}return In.__IS_EVAL_FUNC?function(Qn){return In(new ja(K),Qn,!0)}:In.__IS_FUNCTION_FUNC?function(){for(var Qn=arguments.length,Vi=new Array(Qn),Li=0;Li<Qn;Li++)Vi[Li]=arguments[Li];return In.apply(void 0,[new ja(K)].concat(Vi))}:In.bind(ur)};default:var dt=this.createClosure(R);return function(){var ur="";R.type==="Identifier"&&(ur=R.name);var yr=dt();if(!yr||!La(yr))throw K.createInternalThrowError(sa.FunctionUndefinedReferenceError,ur,R);if(R.type==="Identifier"&&yr.__IS_EVAL_FUNC&&ur==="eval")return function(Qn){var Vi=K.getScopeFromName(ur,K.getCurrentScope()),Li=Vi.name===Tn||Vi.name===ro||Vi.name===Ti;return yr(new ja(K),Qn,!Li)};if(yr.__IS_EVAL_FUNC)return function(Qn){return yr(new ja(K),Qn,!0)};if(yr.__IS_FUNCTION_FUNC)return function(){for(var Qn=arguments.length,Vi=new Array(Qn),Li=0;Li<Qn;Li++)Vi[Li]=arguments[Li];return yr.apply(void 0,[new ja(K)].concat(Vi))};var In=K.options.globalContextInFunction;if(R.type==="Identifier"){var Bn=K.getIdentifierScope(R);Bn.name===Or&&(In=Bn.data)}return yr.bind(In)}}},M.callExpressionHandler=function(R){var K=this,_e=this.createCallFunctionGetter(R.callee),je=R.arguments.map(function(pt){return K.createClosure(pt)});return function(){return _e().apply(void 0,je.map(function(pt){return pt()}))}},M.functionExpressionHandler=function(R){var K=this,_e=this,je=this.source,pt=this.collectDeclVars,dt=this.collectDeclFuncs;this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var ur=R.id?R.id.name:"",yr=R.params.length,In=R.params.map(function(Li){return K.createParamNameGetter(Li)}),Bn=this.createClosure(R.body),Qn=this.collectDeclVars,Vi=this.collectDeclFuncs;return this.collectDeclVars=pt,this.collectDeclFuncs=dt,function(){var Li=_e.getCurrentScope(),ba=function Gi(){for(var As=arguments.length,Eu=new Array(As),fl=0;fl<As;fl++)Eu[fl]=arguments[fl];_e.callStack.push(""+ur);var Rc=_e.getCurrentScope(),tl=ou(Li,"FunctionScope("+ur+")");_e.setCurrentScope(tl),_e.addDeclarationsToScope(Qn,Vi,tl),ur&&(tl.data[ur]=Gi),tl.data.arguments=arguments,In.forEach(function(Nu,zu){tl.data[Nu()]=Eu[zu]});var Lc=_e.getCurrentContext();_e.setCurrentContext(this);var Bu=Bn();if(_e.setCurrentContext(Lc),_e.setCurrentScope(Rc),_e.callStack.pop(),Bu instanceof Jo)return Bu.value};return ll(ba,ur),Object.defineProperty(ba,"length",{value:yr,writable:!1,enumerable:!1,configurable:!0}),Object.defineProperty(ba,"toString",{value:function(){return je.slice(R.start,R.end)},writable:!0,configurable:!0,enumerable:!1}),Object.defineProperty(ba,"valueOf",{value:function(){return je.slice(R.start,R.end)},writable:!0,configurable:!0,enumerable:!1}),ba}},M.newExpressionHandler=function(R){var K=this,_e=this.source,je=this.createClosure(R.callee),pt=R.arguments.map(function(dt){return K.createClosure(dt)});return function(){var dt=je();if(!La(dt)||dt.__IS_EVAL_FUNC){var ur=R.callee,yr=_e.slice(ur.start,ur.end);throw K.createInternalThrowError(sa.IsNotConstructor,yr,R)}return dt.__IS_FUNCTION_FUNC?dt.apply(void 0,[new ja(K)].concat(pt.map(function(In){return In()}))):jo(dt,pt.map(function(In){return In()}))}},M.memberExpressionHandler=function(R){var K=this.createClosure(R.object),_e=this.createMemberKeyGetter(R);return function(){var je=K(),pt=_e();return je[pt]}},M.thisExpressionHandler=function(R){var K=this;return function(){return K.getCurrentContext()}},M.sequenceExpressionHandler=function(R){var K=this,_e=R.expressions.map(function(je){return K.createClosure(je)});return function(){for(var je,pt=_e.length,dt=0;dt<pt;dt++){var ur=_e[dt];je=ur()}return je}},M.literalHandler=function(R){return function(){return R.regex?new RegExp(R.regex.pattern,R.regex.flags):R.value}},M.identifierHandler=function(R){var K=this;return function(){var _e=K.getCurrentScope(),je=K.getScopeDataFromName(R.name,_e);return K.assertVariable(je,R.name,R),je[R.name]}},M.getIdentifierScope=function(R){var K=this.getCurrentScope(),_e=this.getScopeFromName(R.name,K);return _e},M.assignmentExpressionHandler=function(R){var K=this;R.left.type==="Identifier"&&R.right.type==="FunctionExpression"&&!R.right.id&&(R.right.id={type:"Identifier",name:R.left.name});var _e=this.createObjectGetter(R.left),je=this.createNameGetter(R.left),pt=this.createClosure(R.right);return function(){var dt=_e(),ur=je(),yr=pt();switch(R.operator!=="="&&K.assertVariable(dt,ur,R),R.operator){case"=":return dt[ur]=yr;case"+=":return dt[ur]+=yr;case"-=":return dt[ur]-=yr;case"*=":return dt[ur]*=yr;case"**=":return dt[ur]=Math.pow(dt[ur],yr);case"/=":return dt[ur]/=yr;case"%=":return dt[ur]%=yr;case"<<=":return dt[ur]<<=yr;case">>=":return dt[ur]>>=yr;case">>>=":return dt[ur]>>>=yr;case"&=":return dt[ur]&=yr;case"^=":return dt[ur]^=yr;case"|=":return dt[ur]|=yr;default:throw K.createInternalThrowError(sa.AssignmentExpressionSyntaxError,R.type,R)}}},M.functionDeclarationHandler=function(R){if(R.id){var K=this.functionExpressionHandler(R);Object.defineProperty(K,"isFunctionDeclareClosure",{value:!0,writable:!1,configurable:!1,enumerable:!1}),this.funcDeclaration(R.id.name,K)}return function(){return Rt}},M.getVariableName=function(R){if(R.type==="Identifier")return R.name;throw this.createInternalThrowError(sa.VariableTypeSyntaxError,R.type,R)},M.variableDeclarationHandler=function(R){for(var K=this,_e,je=[],pt=0;pt<R.declarations.length;pt++){var dt=R.declarations[pt];this.varDeclaration(this.getVariableName(dt.id)),dt.init&&je.push({type:"AssignmentExpression",operator:"=",left:dt.id,right:dt.init})}return je.length&&(_e=this.createClosure({type:"BlockStatement",body:je})),function(){if(_e){var ur=K.isVarDeclMode;K.isVarDeclMode=!0,_e(),K.isVarDeclMode=ur}return Rt}},M.assertVariable=function(R,K,_e){if(R===this.globalScope.data&&!(K in R))throw this.createInternalThrowError(sa.VariableUndefinedReferenceError,K,_e)},M.programHandler=function(R){var K=this,_e=R.body.map(function(je){return K.createClosure(je)});return function(){for(var je=Rt,pt=0;pt<_e.length;pt++){var dt=_e[pt],ur=K.setValue(dt());if(ur!==Rt&&(je=ur,je instanceof Jo||je instanceof Ss||je instanceof Lo||je===ie||je===Ee))break}return je}},M.expressionStatementHandler=function(R){return this.createClosure(R.expression)},M.emptyStatementHandler=function(R){return function(){return Rt}},M.returnStatementHandler=function(R){var K=R.argument?this.createClosure(R.argument):Qs;return function(){return new Jo(K())}},M.ifStatementHandler=function(R){var K=this.createClosure(R.test),_e=this.createClosure(R.consequent),je=R.alternate?this.createClosure(R.alternate):function(){return Rt};return function(){return K()?_e():je()}},M.conditionalExpressionHandler=function(R){return this.ifStatementHandler(R)},M.forStatementHandler=function(R){var K=this,_e=Qs,je=R.test?this.createClosure(R.test):function(){return!0},pt=Qs,dt=this.createClosure(R.body);return R.type==="ForStatement"&&(_e=R.init?this.createClosure(R.init):_e,pt=R.update?this.createClosure(R.update):Qs),function(ur){var yr,In=Rt,Bn=R.type==="DoWhileStatement";for(ur&&ur.type==="LabeledStatement"&&(yr=ur.label.name),_e();Bn||je();pt()){Bn=!1;var Qn=K.setValue(dt());if(!(Qn===Rt||Qn===Ee)){if(Qn===ie)break;if(In=Qn,In instanceof Lo&&In.value===yr){In=Rt;continue}if(In instanceof Jo||In instanceof Ss||In instanceof Lo)break}}return In}},M.whileStatementHandler=function(R){return this.forStatementHandler(R)},M.doWhileStatementHandler=function(R){return this.forStatementHandler(R)},M.forInStatementHandler=function(R){var K=this,_e=R.left,je=this.createClosure(R.right),pt=this.createClosure(R.body);return R.left.type==="VariableDeclaration"&&(this.createClosure(R.left)(),_e=R.left.declarations[0].id),function(dt){var ur,yr=Rt,In;dt&&dt.type==="LabeledStatement"&&(ur=dt.label.name);var Bn=je();for(In in Bn){K.assignmentExpressionHandler({type:"AssignmentExpression",operator:"=",left:_e,right:{type:"Literal",value:In}})();var Qn=K.setValue(pt());if(!(Qn===Rt||Qn===Ee)){if(Qn===ie)break;if(yr=Qn,yr instanceof Lo&&yr.value===ur){yr=Rt;continue}if(yr instanceof Jo||yr instanceof Ss||yr instanceof Lo)break}}return yr}},M.withStatementHandler=function(R){var K=this,_e=this.createClosure(R.object),je=this.createClosure(R.body);return function(){var pt=_e(),dt=K.getCurrentScope(),ur=new Vo(pt,dt,Or);K.setCurrentScope(ur);var yr=K.setValue(je());return K.setCurrentScope(dt),yr}},M.throwStatementHandler=function(R){var K=this,_e=this.createClosure(R.argument);return function(){throw K.setValue(void 0),_e()}},M.tryStatementHandler=function(R){var K=this,_e=this.createClosure(R.block),je=R.handler?this.catchClauseHandler(R.handler):null,pt=R.finalizer?this.createClosure(R.finalizer):null;return function(){var dt=K.getCurrentScope(),ur=K.getCurrentContext(),yr=dt.labelStack.concat([]),In=K.callStack.concat([]),Bn=Rt,Qn,Vi,Li=function(){K.setCurrentScope(dt),K.setCurrentContext(ur),dt.labelStack=yr,K.callStack=In};try{Bn=K.setValue(_e()),Bn instanceof Jo&&(Qn=Bn)}catch(ba){if(Li(),K.isInterruptThrow(ba))throw ba;if(je)try{Bn=K.setValue(je(ba)),Bn instanceof Jo&&(Qn=Bn)}catch(Gi){if(Li(),K.isInterruptThrow(Gi))throw Gi;Vi=Gi}}if(pt)try{Bn=pt(),Bn instanceof Jo&&(Qn=Bn)}catch(ba){if(Li(),K.isInterruptThrow(ba))throw ba;Vi=ba}if(Vi)throw Vi;return Qn||Bn}},M.catchClauseHandler=function(R){var K=this,_e=this.createParamNameGetter(R.param),je=this.createClosure(R.body);return function(pt){var dt,ur=K.getCurrentScope(),yr=ur.data,In=_e(),Bn=os.call(yr,In),Qn=yr[In];return yr[In]=pt,dt=je(),Bn?yr[In]=Qn:delete yr[In],dt}},M.continueStatementHandler=function(R){return function(){return R.label?new Lo(R.label.name):Ee}},M.breakStatementHandler=function(R){return function(){return R.label?new Ss(R.label.name):ie}},M.switchStatementHandler=function(R){var K=this,_e=this.createClosure(R.discriminant),je=R.cases.map(function(pt){return K.switchCaseHandler(pt)});return function(){for(var pt=_e(),dt=!1,ur,yr,In,Bn=0;Bn<je.length;Bn++){var Qn=je[Bn](),Vi=Qn.testClosure();if(Vi===qe){In=Qn;continue}if(dt||Vi===pt){if(dt=!0,yr=K.setValue(Qn.bodyClosure()),yr===Rt)continue;if(yr===ie||(ur=yr,ur instanceof Jo||ur instanceof Ss||ur instanceof Lo||ur===Ee))break}}if(!dt&&In){yr=K.setValue(In.bodyClosure());var Li=yr===Rt||yr===ie||yr===Ee;Li||(ur=yr)}return ur}},M.switchCaseHandler=function(R){var K=R.test?this.createClosure(R.test):function(){return qe},_e=this.createClosure({type:"BlockStatement",body:R.consequent});return function(){return{testClosure:K,bodyClosure:_e}}},M.labeledStatementHandler=function(R){var K=this,_e=R.label.name,je=this.createClosure(R.body);return function(){var pt,dt=K.getCurrentScope();return dt.labelStack.push(_e),pt=je(R),pt instanceof Ss&&pt.value===_e&&(pt=Rt),dt.labelStack.pop(),pt}},M.debuggerStatementHandler=function(R){return function(){debugger;return Rt}},M.createParamNameGetter=function(R){if(R.type==="Identifier")return function(){return R.name};throw this.createInternalThrowError(sa.ParamTypeSyntaxError,R.type,R)},M.createObjectKeyGetter=function(R){var K;return R.type==="Identifier"?K=function(){return R.name}:K=this.createClosure(R),function(){return K()}},M.createMemberKeyGetter=function(R){return R.computed?this.createClosure(R.property):this.createObjectKeyGetter(R.property)},M.createObjectGetter=function(R){var K=this;switch(R.type){case"Identifier":return function(){return K.getScopeDataFromName(R.name,K.getCurrentScope())};case"MemberExpression":return this.createClosure(R.object);default:throw this.createInternalThrowError(sa.AssignmentTypeSyntaxError,R.type,R)}},M.createNameGetter=function(R){switch(R.type){case"Identifier":return function(){return R.name};case"MemberExpression":return this.createMemberKeyGetter(R);default:throw this.createInternalThrowError(sa.AssignmentTypeSyntaxError,R.type,R)}},M.varDeclaration=function(R){var K=this.collectDeclVars;K[R]=void 0},M.funcDeclaration=function(R,K){var _e=this.collectDeclFuncs;_e[R]=K},M.addDeclarationsToScope=function(R,K,_e){var je=_e.data;for(var pt in K){var dt=K[pt];je[pt]=dt&&dt()}for(var ur in R)ur in je||(je[ur]=void 0)},M.getScopeValue=function(R,K){var _e=this.getScopeFromName(R,K);return _e.data[R]},M.getScopeDataFromName=function(R,K){return this.getScopeFromName(R,K).data},M.getScopeFromName=function(R,K){var _e=K;do if(R in _e.data)return _e;while(_e=_e.parent);return this.globalScope},M.setValue=function(R){var K=this.callStack.length;return this.isVarDeclMode||K||R===Rt||R===ie||R===Ee||R instanceof Ss||R instanceof Lo||(this.value=R instanceof Jo?R.value:R),R},M.getValue=function(){return this.value},_}();ko.version=Gs,ko.eval=Qo,ko.Function=ps,ko.ecmaVersion=5,ko.globalContextInFunction=void 0,ko.global=Object.create(null);function Il(_){return _===void 0&&(_=Object.create(null)),_}function vs(_,M,F){M===void 0&&(M=[]),F===void 0&&(F={});var R=F.parsingContext,K=F.timeout===void 0?0:F.timeout,_e=`
    (function anonymous(`+M.join(",")+`){
         `+_+`
    });
    `,je=new ko(R,{ecmaVersion:F.ecmaVersion,timeout:K,rootContext:F.rootContext,globalContextInFunction:F.globalContextInFunction});return je.evaluate(_e)}function es(_,M,F){var R=new ko(M,F);return R.evaluate(_)}var of=es,rc=function(){function _(F){this._code=F}var M=_.prototype;return M.runInContext=function(R){return es(this._code,R)},M.runInNewContext=function(R){return es(this._code,R)},_}(),Cs=function(_,M,F){return es(_,M,F)};function bu(){for(var _=arguments.length,M=new Array(_),F=0;F<_;F++)M[F]=arguments[F];var R=M.pop();return vs(R||"",M)}var cl=Cs},20396:function(It,$,U){var ae;/*! Hammer.JS - v2.0.7 - 2016-04-22
* http://hammerjs.github.io/
*
* Copyright (c) 2016 Jorik Tangelder;
* Licensed under the MIT license */(function(re,m,ve,Z){"use strict";var le=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,fe=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined"),Le=le||fe,J=["","webkit","Moz","MS","ms","o"],Xe=Le?"":m.createElement("div"),et="function",Ue=Math.round,gt=Math.abs,rr=Date.now;function xt(ie,Ee,qe){return setTimeout(ft(ie,qe),Ee)}function Yt(ie,Ee,qe){return Array.isArray(ie)?(Et(ie,qe[Ee],qe),!0):!1}function Et(ie,Ee,qe){var Rt;if(!!ie)if(ie.forEach)ie.forEach(Ee,qe);else if(ie.length!==Z)for(Rt=0;Rt<ie.length;)Ee.call(qe,ie[Rt],Rt,ie),Rt++;else for(Rt in ie)ie.hasOwnProperty(Rt)&&Ee.call(qe,ie[Rt],Rt,ie)}function at(ie,Ee,qe){var Rt="DEPRECATED METHOD: "+Ee+`
`+qe+` AT 
`;return function(){var Or=new Error("get-stack-trace"),Tn=Or&&Or.stack?Or.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Ti=re.console&&(re.console.warn||re.console.log);return Ti&&Ti.call(re.console,Rt,Tn),ie.apply(this,arguments)}}var it;typeof Object.assign!="function"?it=function(Ee){if(Ee===Z||Ee===null)throw new TypeError("Cannot convert undefined or null to object");for(var qe=Object(Ee),Rt=1;Rt<arguments.length;Rt++){var Or=arguments[Rt];if(Or!==Z&&Or!==null)for(var Tn in Or)Or.hasOwnProperty(Tn)&&(qe[Tn]=Or[Tn])}return qe}:it=Object.assign;var Zt=at(function(Ee,qe,Rt){for(var Or=Object.keys(qe),Tn=0;Tn<Or.length;)(!Rt||Rt&&Ee[Or[Tn]]===Z)&&(Ee[Or[Tn]]=qe[Or[Tn]]),Tn++;return Ee},"extend","Use `assign`."),Y=at(function(Ee,qe){return Zt(Ee,qe,!0)},"merge","Use `assign`.");function $t(ie,Ee,qe){var Rt=Ee.prototype,Or;Or=ie.prototype=Object.create(Rt),Or.constructor=ie,Or._super=Rt,qe&&it(Or,qe)}function ft(ie,Ee){return function(){return ie.apply(Ee,arguments)}}function Je(ie,Ee){return typeof ie==et?ie.apply(Ee&&Ee[0]||Z,Ee):ie}function At(ie,Ee){return ie===Z?Ee:ie}function Qe(ie,Ee,qe){Et(tn(Ee),function(Rt){ie.addEventListener(Rt,qe,!1)})}function Qt(ie,Ee,qe){Et(tn(Ee),function(Rt){ie.removeEventListener(Rt,qe,!1)})}function Er(ie,Ee){for(;ie;){if(ie==Ee)return!0;ie=ie.parentNode}return!1}function Nr(ie,Ee){return ie.indexOf(Ee)>-1}function tn(ie){return ie.trim().split(/\s+/g)}function A(ie,Ee,qe){if(ie.indexOf&&!qe)return ie.indexOf(Ee);for(var Rt=0;Rt<ie.length;){if(qe&&ie[Rt][qe]==Ee||!qe&&ie[Rt]===Ee)return Rt;Rt++}return-1}function Ce(ie){return Array.prototype.slice.call(ie,0)}function De(ie,Ee,qe){for(var Rt=[],Or=[],Tn=0;Tn<ie.length;){var Ti=Ee?ie[Tn][Ee]:ie[Tn];A(Or,Ti)<0&&Rt.push(ie[Tn]),Or[Tn]=Ti,Tn++}return qe&&(Ee?Rt=Rt.sort(function(La,ja){return La[Ee]>ja[Ee]}):Rt=Rt.sort()),Rt}function wt(ie,Ee){for(var qe,Rt,Or=Ee[0].toUpperCase()+Ee.slice(1),Tn=0;Tn<J.length;){if(qe=J[Tn],Rt=qe?qe+Or:Ee,Rt in ie)return Rt;Tn++}return Z}var mt=1;function Bt(){return mt++}function Kt(ie){var Ee=ie.ownerDocument||ie;return Ee.defaultView||Ee.parentWindow||re}var Cr=/mobile|tablet|ip(ad|hone|od)|android/i,ei="ontouchstart"in re,vn=wt(re,"PointerEvent")!==Z,di=ei&&Cr.test(navigator.userAgent),Wn="touch",si="pen",vi="mouse",qn="kinect",mi=25,aa=1,Wi=2,Oi=4,Ki=8,oa=1,Mi=2,da=4,$n=8,wi=16,ji=Mi|da,$i=$n|wi,zo=ji|$i,me=["x","y"],Dn=["clientX","clientY"];function Za(ie,Ee){var qe=this;this.manager=ie,this.callback=Ee,this.element=ie.element,this.target=ie.options.inputTarget,this.domHandler=function(Rt){Je(ie.options.enable,[ie])&&qe.handler(Rt)},this.init()}Za.prototype={handler:function(){},init:function(){this.evEl&&Qe(this.element,this.evEl,this.domHandler),this.evTarget&&Qe(this.target,this.evTarget,this.domHandler),this.evWin&&Qe(Kt(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&Qt(this.element,this.evEl,this.domHandler),this.evTarget&&Qt(this.target,this.evTarget,this.domHandler),this.evWin&&Qt(Kt(this.element),this.evWin,this.domHandler)}};function hs(ie){var Ee,qe=ie.options.inputClass;return qe?Ee=qe:vn?Ee=Pe:di?Ee=zt:ei?Ee=Ot:Ee=xa,new Ee(ie,Nt)}function Nt(ie,Ee,qe){var Rt=qe.pointers.length,Or=qe.changedPointers.length,Tn=Ee&aa&&Rt-Or==0,Ti=Ee&(Oi|Ki)&&Rt-Or==0;qe.isFirst=!!Tn,qe.isFinal=!!Ti,Tn&&(ie.session={}),qe.eventType=Ee,nr(ie,qe),ie.emit("hammer.input",qe),ie.recognize(qe),ie.session.prevInput=qe}function nr(ie,Ee){var qe=ie.session,Rt=Ee.pointers,Or=Rt.length;qe.firstInput||(qe.firstInput=wn(Ee)),Or>1&&!qe.firstMultiple?qe.firstMultiple=wn(Ee):Or===1&&(qe.firstMultiple=!1);var Tn=qe.firstInput,Ti=qe.firstMultiple,ro=Ti?Ti.center:Tn.center,La=Ee.center=Fn(Rt);Ee.timeStamp=rr(),Ee.deltaTime=Ee.timeStamp-Tn.timeStamp,Ee.angle=Di(ro,La),Ee.distance=fn(ro,La),Ar(qe,Ee),Ee.offsetDirection=ti(Ee.deltaX,Ee.deltaY);var ja=gi(Ee.deltaTime,Ee.deltaX,Ee.deltaY);Ee.overallVelocityX=ja.x,Ee.overallVelocityY=ja.y,Ee.overallVelocity=gt(ja.x)>gt(ja.y)?ja.x:ja.y,Ee.scale=Ti?to(Ti.pointers,Rt):1,Ee.rotation=Ti?Ri(Ti.pointers,Rt):0,Ee.maxPointers=qe.prevInput?Ee.pointers.length>qe.prevInput.maxPointers?Ee.pointers.length:qe.prevInput.maxPointers:Ee.pointers.length,rn(qe,Ee);var Qo=ie.element;Er(Ee.srcEvent.target,Qo)&&(Qo=Ee.srcEvent.target),Ee.target=Qo}function Ar(ie,Ee){var qe=Ee.center,Rt=ie.offsetDelta||{},Or=ie.prevDelta||{},Tn=ie.prevInput||{};(Ee.eventType===aa||Tn.eventType===Oi)&&(Or=ie.prevDelta={x:Tn.deltaX||0,y:Tn.deltaY||0},Rt=ie.offsetDelta={x:qe.x,y:qe.y}),Ee.deltaX=Or.x+(qe.x-Rt.x),Ee.deltaY=Or.y+(qe.y-Rt.y)}function rn(ie,Ee){var qe=ie.lastInterval||Ee,Rt=Ee.timeStamp-qe.timeStamp,Or,Tn,Ti,ro;if(Ee.eventType!=Ki&&(Rt>mi||qe.velocity===Z)){var La=Ee.deltaX-qe.deltaX,ja=Ee.deltaY-qe.deltaY,Qo=gi(Rt,La,ja);Tn=Qo.x,Ti=Qo.y,Or=gt(Qo.x)>gt(Qo.y)?Qo.x:Qo.y,ro=ti(La,ja),ie.lastInterval=Ee}else Or=qe.velocity,Tn=qe.velocityX,Ti=qe.velocityY,ro=qe.direction;Ee.velocity=Or,Ee.velocityX=Tn,Ee.velocityY=Ti,Ee.direction=ro}function wn(ie){for(var Ee=[],qe=0;qe<ie.pointers.length;)Ee[qe]={clientX:Ue(ie.pointers[qe].clientX),clientY:Ue(ie.pointers[qe].clientY)},qe++;return{timeStamp:rr(),pointers:Ee,center:Fn(Ee),deltaX:ie.deltaX,deltaY:ie.deltaY}}function Fn(ie){var Ee=ie.length;if(Ee===1)return{x:Ue(ie[0].clientX),y:Ue(ie[0].clientY)};for(var qe=0,Rt=0,Or=0;Or<Ee;)qe+=ie[Or].clientX,Rt+=ie[Or].clientY,Or++;return{x:Ue(qe/Ee),y:Ue(Rt/Ee)}}function gi(ie,Ee,qe){return{x:Ee/ie||0,y:qe/ie||0}}function ti(ie,Ee){return ie===Ee?oa:gt(ie)>=gt(Ee)?ie<0?Mi:da:Ee<0?$n:wi}function fn(ie,Ee,qe){qe||(qe=me);var Rt=Ee[qe[0]]-ie[qe[0]],Or=Ee[qe[1]]-ie[qe[1]];return Math.sqrt(Rt*Rt+Or*Or)}function Di(ie,Ee,qe){qe||(qe=me);var Rt=Ee[qe[0]]-ie[qe[0]],Or=Ee[qe[1]]-ie[qe[1]];return Math.atan2(Or,Rt)*180/Math.PI}function Ri(ie,Ee){return Di(Ee[1],Ee[0],Dn)+Di(ie[1],ie[0],Dn)}function to(ie,Ee){return fn(Ee[0],Ee[1],Dn)/fn(ie[0],ie[1],Dn)}var Es={mousedown:aa,mousemove:Wi,mouseup:Oi},Ko="mousedown",Ba="mousemove mouseup";function xa(){this.evEl=Ko,this.evWin=Ba,this.pressed=!1,Za.apply(this,arguments)}$t(xa,Za,{handler:function(Ee){var qe=Es[Ee.type];qe&aa&&Ee.button===0&&(this.pressed=!0),qe&Wi&&Ee.which!==1&&(qe=Oi),!!this.pressed&&(qe&Oi&&(this.pressed=!1),this.callback(this.manager,qe,{pointers:[Ee],changedPointers:[Ee],pointerType:vi,srcEvent:Ee}))}});var H={pointerdown:aa,pointermove:Wi,pointerup:Oi,pointercancel:Ki,pointerout:Ki},Q={2:Wn,3:si,4:vi,5:qn},oe="pointerdown",ye="pointermove pointerup pointercancel";!Le&&re.MSPointerEvent&&!re.PointerEvent&&(oe="MSPointerDown",ye="MSPointerMove MSPointerUp MSPointerCancel");function Pe(){this.evEl=oe,this.evWin=ye,Za.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}$t(Pe,Za,{handler:function(Ee){var qe=this.store,Rt=!1,Or=Ee.type.toLowerCase().replace("ms",""),Tn=H[Or],Ti=Q[Ee.pointerType]||Ee.pointerType,ro=Ti==Wn,La=A(qe,Ee.pointerId,"pointerId");Tn&aa&&(Ee.button===0||ro)?La<0&&(qe.push(Ee),La=qe.length-1):Tn&(Oi|Ki)&&(Rt=!0),!(La<0)&&(qe[La]=Ee,this.callback(this.manager,Tn,{pointers:qe,changedPointers:[Ee],pointerType:Ti,srcEvent:Ee}),Rt&&qe.splice(La,1))}});var He={touchstart:aa,touchmove:Wi,touchend:Oi,touchcancel:Ki},rt="touchstart",pe="touchstart touchmove touchend touchcancel";function ke(){this.evTarget=rt,this.evWin=pe,this.started=!1,Za.apply(this,arguments)}$t(ke,Za,{handler:function(Ee){var qe=He[Ee.type];if(qe===aa&&(this.started=!0),!!this.started){var Rt=vt.call(this,Ee,qe);qe&(Oi|Ki)&&Rt[0].length-Rt[1].length==0&&(this.started=!1),this.callback(this.manager,qe,{pointers:Rt[0],changedPointers:Rt[1],pointerType:Wn,srcEvent:Ee})}}});function vt(ie,Ee){var qe=Ce(ie.touches),Rt=Ce(ie.changedTouches);return Ee&(Oi|Ki)&&(qe=De(qe.concat(Rt),"identifier",!0)),[qe,Rt]}var pr={touchstart:aa,touchmove:Wi,touchend:Oi,touchcancel:Ki},Ft="touchstart touchmove touchend touchcancel";function zt(){this.evTarget=Ft,this.targetIds={},Za.apply(this,arguments)}$t(zt,Za,{handler:function(Ee){var qe=pr[Ee.type],Rt=vr.call(this,Ee,qe);!Rt||this.callback(this.manager,qe,{pointers:Rt[0],changedPointers:Rt[1],pointerType:Wn,srcEvent:Ee})}});function vr(ie,Ee){var qe=Ce(ie.touches),Rt=this.targetIds;if(Ee&(aa|Wi)&&qe.length===1)return Rt[qe[0].identifier]=!0,[qe,qe];var Or,Tn,Ti=Ce(ie.changedTouches),ro=[],La=this.target;if(Tn=qe.filter(function(ja){return Er(ja.target,La)}),Ee===aa)for(Or=0;Or<Tn.length;)Rt[Tn[Or].identifier]=!0,Or++;for(Or=0;Or<Ti.length;)Rt[Ti[Or].identifier]&&ro.push(Ti[Or]),Ee&(Oi|Ki)&&delete Rt[Ti[Or].identifier],Or++;if(!!ro.length)return[De(Tn.concat(ro),"identifier",!0),ro]}var En=2500,pn=25;function Ot(){Za.apply(this,arguments);var ie=ft(this.handler,this);this.touch=new zt(this.manager,ie),this.mouse=new xa(this.manager,ie),this.primaryTouch=null,this.lastTouches=[]}$t(Ot,Za,{handler:function(Ee,qe,Rt){var Or=Rt.pointerType==Wn,Tn=Rt.pointerType==vi;if(!(Tn&&Rt.sourceCapabilities&&Rt.sourceCapabilities.firesTouchEvents)){if(Or)nn.call(this,qe,Rt);else if(Tn&&Yr.call(this,Rt))return;this.callback(Ee,qe,Rt)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function nn(ie,Ee){ie&aa?(this.primaryTouch=Ee.changedPointers[0].identifier,Zr.call(this,Ee)):ie&(Oi|Ki)&&Zr.call(this,Ee)}function Zr(ie){var Ee=ie.changedPointers[0];if(Ee.identifier===this.primaryTouch){var qe={x:Ee.clientX,y:Ee.clientY};this.lastTouches.push(qe);var Rt=this.lastTouches,Or=function(){var Tn=Rt.indexOf(qe);Tn>-1&&Rt.splice(Tn,1)};setTimeout(Or,En)}}function Yr(ie){for(var Ee=ie.srcEvent.clientX,qe=ie.srcEvent.clientY,Rt=0;Rt<this.lastTouches.length;Rt++){var Or=this.lastTouches[Rt],Tn=Math.abs(Ee-Or.x),Ti=Math.abs(qe-Or.y);if(Tn<=pn&&Ti<=pn)return!0}return!1}var _i=Le?Z:wt(Xe.style,"touchAction"),an=_i!==Z,on="compute",Xi="auto",yi="manipulation",Pi="none",bi="pan-x",ht="pan-y",Pt=Ii();function Aa(ie,Ee){this.manager=ie,this.set(Ee)}Aa.prototype={set:function(ie){ie==on&&(ie=this.compute()),an&&this.manager.element.style&&Pt[ie]&&(this.manager.element.style[_i]=ie),this.actions=ie.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var ie=[];return Et(this.manager.recognizers,function(Ee){Je(Ee.options.enable,[Ee])&&(ie=ie.concat(Ee.getTouchAction()))}),qi(ie.join(" "))},preventDefaults:function(ie){var Ee=ie.srcEvent,qe=ie.offsetDirection;if(this.manager.session.prevented){Ee.preventDefault();return}var Rt=this.actions,Or=Nr(Rt,Pi)&&!Pt[Pi],Tn=Nr(Rt,ht)&&!Pt[ht],Ti=Nr(Rt,bi)&&!Pt[bi];if(Or){var ro=ie.pointers.length===1,La=ie.distance<2,ja=ie.deltaTime<250;if(ro&&La&&ja)return}if(!(Ti&&Tn)&&(Or||Tn&&qe&ji||Ti&&qe&$i))return this.preventSrc(Ee)},preventSrc:function(ie){this.manager.session.prevented=!0,ie.preventDefault()}};function qi(ie){if(Nr(ie,Pi))return Pi;var Ee=Nr(ie,bi),qe=Nr(ie,ht);return Ee&&qe?Pi:Ee||qe?Ee?bi:ht:Nr(ie,yi)?yi:Xi}function Ii(){if(!an)return!1;var ie={};if(Le)return ie;var Ee=re.CSS&&re.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(qe){ie[qe]=Ee?re.CSS.supports("touch-action",qe):!0}),ie}var pi=1,wa=2,$s=4,Ir=8,wr=Ir,Mt=16,bo=32;function ne(ie){this.options=it({},this.defaults,ie||{}),this.id=Bt(),this.manager=null,this.options.enable=At(this.options.enable,!0),this.state=pi,this.simultaneous={},this.requireFail=[]}ne.prototype={defaults:{},set:function(ie){return it(this.options,ie),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(ie){if(Yt(ie,"recognizeWith",this))return this;var Ee=this.simultaneous;return ie=Ra(ie,this),Ee[ie.id]||(Ee[ie.id]=ie,ie.recognizeWith(this)),this},dropRecognizeWith:function(ie){return Yt(ie,"dropRecognizeWith",this)?this:(ie=Ra(ie,this),delete this.simultaneous[ie.id],this)},requireFailure:function(ie){if(Yt(ie,"requireFailure",this))return this;var Ee=this.requireFail;return ie=Ra(ie,this),A(Ee,ie)===-1&&(Ee.push(ie),ie.requireFailure(this)),this},dropRequireFailure:function(ie){if(Yt(ie,"dropRequireFailure",this))return this;ie=Ra(ie,this);var Ee=A(this.requireFail,ie);return Ee>-1&&this.requireFail.splice(Ee,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(ie){return!!this.simultaneous[ie.id]},emit:function(ie){var Ee=this,qe=this.state;function Rt(Or){Ee.manager.emit(Or,ie)}qe<Ir&&Rt(Ee.options.event+Fu(qe)),Rt(Ee.options.event),ie.additionalEvent&&Rt(ie.additionalEvent),qe>=Ir&&Rt(Ee.options.event+Fu(qe))},tryEmit:function(ie){if(this.canEmit())return this.emit(ie);this.state=bo},canEmit:function(){for(var ie=0;ie<this.requireFail.length;){if(!(this.requireFail[ie].state&(bo|pi)))return!1;ie++}return!0},recognize:function(ie){var Ee=it({},ie);if(!Je(this.options.enable,[this,Ee])){this.reset(),this.state=bo;return}this.state&(wr|Mt|bo)&&(this.state=pi),this.state=this.process(Ee),this.state&(wa|$s|Ir|Mt)&&this.tryEmit(Ee)},process:function(ie){},getTouchAction:function(){},reset:function(){}};function Fu(ie){return ie&Mt?"cancel":ie&Ir?"end":ie&$s?"move":ie&wa?"start":""}function oo(ie){return ie==wi?"down":ie==$n?"up":ie==Mi?"left":ie==da?"right":""}function Ra(ie,Ee){var qe=Ee.manager;return qe?qe.get(ie):ie}function Ta(){ne.apply(this,arguments)}$t(Ta,ne,{defaults:{pointers:1},attrTest:function(ie){var Ee=this.options.pointers;return Ee===0||ie.pointers.length===Ee},process:function(ie){var Ee=this.state,qe=ie.eventType,Rt=Ee&(wa|$s),Or=this.attrTest(ie);return Rt&&(qe&Ki||!Or)?Ee|Mt:Rt||Or?qe&Oi?Ee|Ir:Ee&wa?Ee|$s:wa:bo}});function Qi(){Ta.apply(this,arguments),this.pX=null,this.pY=null}$t(Qi,Ta,{defaults:{event:"pan",threshold:10,pointers:1,direction:zo},getTouchAction:function(){var ie=this.options.direction,Ee=[];return ie&ji&&Ee.push(ht),ie&$i&&Ee.push(bi),Ee},directionTest:function(ie){var Ee=this.options,qe=!0,Rt=ie.distance,Or=ie.direction,Tn=ie.deltaX,Ti=ie.deltaY;return Or&Ee.direction||(Ee.direction&ji?(Or=Tn===0?oa:Tn<0?Mi:da,qe=Tn!=this.pX,Rt=Math.abs(ie.deltaX)):(Or=Ti===0?oa:Ti<0?$n:wi,qe=Ti!=this.pY,Rt=Math.abs(ie.deltaY))),ie.direction=Or,qe&&Rt>Ee.threshold&&Or&Ee.direction},attrTest:function(ie){return Ta.prototype.attrTest.call(this,ie)&&(this.state&wa||!(this.state&wa)&&this.directionTest(ie))},emit:function(ie){this.pX=ie.deltaX,this.pY=ie.deltaY;var Ee=oo(ie.direction);Ee&&(ie.additionalEvent=this.options.event+Ee),this._super.emit.call(this,ie)}});function Uo(){Ta.apply(this,arguments)}$t(Uo,Ta,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Pi]},attrTest:function(ie){return this._super.attrTest.call(this,ie)&&(Math.abs(ie.scale-1)>this.options.threshold||this.state&wa)},emit:function(ie){if(ie.scale!==1){var Ee=ie.scale<1?"in":"out";ie.additionalEvent=this.options.event+Ee}this._super.emit.call(this,ie)}});function $o(){ne.apply(this,arguments),this._timer=null,this._input=null}$t($o,ne,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Xi]},process:function(ie){var Ee=this.options,qe=ie.pointers.length===Ee.pointers,Rt=ie.distance<Ee.threshold,Or=ie.deltaTime>Ee.time;if(this._input=ie,!Rt||!qe||ie.eventType&(Oi|Ki)&&!Or)this.reset();else if(ie.eventType&aa)this.reset(),this._timer=xt(function(){this.state=wr,this.tryEmit()},Ee.time,this);else if(ie.eventType&Oi)return wr;return bo},reset:function(){clearTimeout(this._timer)},emit:function(ie){this.state===wr&&(ie&&ie.eventType&Oi?this.manager.emit(this.options.event+"up",ie):(this._input.timeStamp=rr(),this.manager.emit(this.options.event,this._input)))}});function xu(){Ta.apply(this,arguments)}$t(xu,Ta,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Pi]},attrTest:function(ie){return this._super.attrTest.call(this,ie)&&(Math.abs(ie.rotation)>this.options.threshold||this.state&wa)}});function Eo(){Ta.apply(this,arguments)}$t(Eo,Ta,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:ji|$i,pointers:1},getTouchAction:function(){return Qi.prototype.getTouchAction.call(this)},attrTest:function(ie){var Ee=this.options.direction,qe;return Ee&(ji|$i)?qe=ie.overallVelocity:Ee&ji?qe=ie.overallVelocityX:Ee&$i&&(qe=ie.overallVelocityY),this._super.attrTest.call(this,ie)&&Ee&ie.offsetDirection&&ie.distance>this.options.threshold&&ie.maxPointers==this.options.pointers&&gt(qe)>this.options.velocity&&ie.eventType&Oi},emit:function(ie){var Ee=oo(ie.offsetDirection);Ee&&this.manager.emit(this.options.event+Ee,ie),this.manager.emit(this.options.event,ie)}});function Zo(){ne.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}$t(Zo,ne,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[yi]},process:function(ie){var Ee=this.options,qe=ie.pointers.length===Ee.pointers,Rt=ie.distance<Ee.threshold,Or=ie.deltaTime<Ee.time;if(this.reset(),ie.eventType&aa&&this.count===0)return this.failTimeout();if(Rt&&Or&&qe){if(ie.eventType!=Oi)return this.failTimeout();var Tn=this.pTime?ie.timeStamp-this.pTime<Ee.interval:!0,Ti=!this.pCenter||fn(this.pCenter,ie.center)<Ee.posThreshold;this.pTime=ie.timeStamp,this.pCenter=ie.center,!Ti||!Tn?this.count=1:this.count+=1,this._input=ie;var ro=this.count%Ee.taps;if(ro===0)return this.hasRequireFailures()?(this._timer=xt(function(){this.state=wr,this.tryEmit()},Ee.interval,this),wa):wr}return bo},failTimeout:function(){return this._timer=xt(function(){this.state=bo},this.options.interval,this),bo},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==wr&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function sa(ie,Ee){return Ee=Ee||{},Ee.recognizers=At(Ee.recognizers,sa.defaults.preset),new Ya(ie,Ee)}sa.VERSION="2.0.7",sa.defaults={domEvents:!1,touchAction:on,enable:!0,inputTarget:null,inputClass:null,preset:[[xu,{enable:!1}],[Uo,{enable:!1},["rotate"]],[Eo,{direction:ji}],[Qi,{direction:ji},["swipe"]],[Zo],[Zo,{event:"doubletap",taps:2},["tap"]],[$o]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var so=1,jo=2;function Ya(ie,Ee){this.options=it({},sa.defaults,Ee||{}),this.options.inputTarget=this.options.inputTarget||ie,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=ie,this.input=hs(this),this.touchAction=new Aa(this,this.options.touchAction),Gs(this,!0),Et(this.options.recognizers,function(qe){var Rt=this.add(new qe[0](qe[1]));qe[2]&&Rt.recognizeWith(qe[2]),qe[3]&&Rt.requireFailure(qe[3])},this)}Ya.prototype={set:function(ie){return it(this.options,ie),ie.touchAction&&this.touchAction.update(),ie.inputTarget&&(this.input.destroy(),this.input.target=ie.inputTarget,this.input.init()),this},stop:function(ie){this.session.stopped=ie?jo:so},recognize:function(ie){var Ee=this.session;if(!Ee.stopped){this.touchAction.preventDefaults(ie);var qe,Rt=this.recognizers,Or=Ee.curRecognizer;(!Or||Or&&Or.state&wr)&&(Or=Ee.curRecognizer=null);for(var Tn=0;Tn<Rt.length;)qe=Rt[Tn],Ee.stopped!==jo&&(!Or||qe==Or||qe.canRecognizeWith(Or))?qe.recognize(ie):qe.reset(),!Or&&qe.state&(wa|$s|Ir)&&(Or=Ee.curRecognizer=qe),Tn++}},get:function(ie){if(ie instanceof ne)return ie;for(var Ee=this.recognizers,qe=0;qe<Ee.length;qe++)if(Ee[qe].options.event==ie)return Ee[qe];return null},add:function(ie){if(Yt(ie,"add",this))return this;var Ee=this.get(ie.options.event);return Ee&&this.remove(Ee),this.recognizers.push(ie),ie.manager=this,this.touchAction.update(),ie},remove:function(ie){if(Yt(ie,"remove",this))return this;if(ie=this.get(ie),ie){var Ee=this.recognizers,qe=A(Ee,ie);qe!==-1&&(Ee.splice(qe,1),this.touchAction.update())}return this},on:function(ie,Ee){if(ie!==Z&&Ee!==Z){var qe=this.handlers;return Et(tn(ie),function(Rt){qe[Rt]=qe[Rt]||[],qe[Rt].push(Ee)}),this}},off:function(ie,Ee){if(ie!==Z){var qe=this.handlers;return Et(tn(ie),function(Rt){Ee?qe[Rt]&&qe[Rt].splice(A(qe[Rt],Ee),1):delete qe[Rt]}),this}},emit:function(ie,Ee){this.options.domEvents&&ll(ie,Ee);var qe=this.handlers[ie]&&this.handlers[ie].slice();if(!(!qe||!qe.length)){Ee.type=ie,Ee.preventDefault=function(){Ee.srcEvent.preventDefault()};for(var Rt=0;Rt<qe.length;)qe[Rt](Ee),Rt++}},destroy:function(){this.element&&Gs(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Gs(ie,Ee){var qe=ie.element;if(!!qe.style){var Rt;Et(ie.options.cssProps,function(Or,Tn){Rt=wt(qe.style,Tn),Ee?(ie.oldCssProps[Rt]=qe.style[Rt],qe.style[Rt]=Or):qe.style[Rt]=ie.oldCssProps[Rt]||""}),Ee||(ie.oldCssProps={})}}function ll(ie,Ee){if(!Le){var qe=m.createEvent("Event");qe.initEvent(ie,!0,!0),qe.gesture=Ee,Ee.target.dispatchEvent(qe)}}if(!Le){it(sa,{INPUT_START:aa,INPUT_MOVE:Wi,INPUT_END:Oi,INPUT_CANCEL:Ki,STATE_POSSIBLE:pi,STATE_BEGAN:wa,STATE_CHANGED:$s,STATE_ENDED:Ir,STATE_RECOGNIZED:wr,STATE_CANCELLED:Mt,STATE_FAILED:bo,DIRECTION_NONE:oa,DIRECTION_LEFT:Mi,DIRECTION_RIGHT:da,DIRECTION_UP:$n,DIRECTION_DOWN:wi,DIRECTION_HORIZONTAL:ji,DIRECTION_VERTICAL:$i,DIRECTION_ALL:zo,Manager:Ya,Input:Za,TouchAction:Aa,TouchInput:zt,MouseInput:xa,PointerEventInput:Pe,TouchMouseInput:Ot,SingleTouchInput:ke,Recognizer:ne,AttrRecognizer:Ta,Tap:Zo,Pan:Qi,Swipe:Eo,Pinch:Uo,Rotate:xu,Press:$o,on:Qe,off:Qt,each:Et,merge:Y,extend:Zt,assign:it,inherit:$t,bindFn:ft,prefixed:wt});var os=typeof window!="undefined"?window:typeof self!="undefined"?self:{};os.Hammer=sa,ae=function(){return sa}.call($,U,$,It),ae!==Z&&(It.exports=ae)}})(typeof window!="undefined"?window:{console:null,MSPointerEvent:null,PointerEvent:null,CSS:null},document,"Hammer")},88307:function(It,$,U){(function(ae,re){It.exports=re(U(18857))})(this,function(ae){"use strict";var re=function(B){return B instanceof Uint8Array||B instanceof Uint16Array||B instanceof Uint32Array||B instanceof Int8Array||B instanceof Int16Array||B instanceof Int32Array||B instanceof Float32Array||B instanceof Float64Array||B instanceof Uint8ClampedArray},m=function(B,ge){for(var Be=Object.keys(ge),Dt=0;Dt<Be.length;++Dt)B[Be[Dt]]=ge[Be[Dt]];return B},ve=`
`;function Z(B){return typeof atob!="undefined"?atob(B):"base64:"+B}function le(B){var ge=new Error("(regl) "+B);throw console.error(ge),ge}function fe(B,ge){B||le(ge)}function Le(B){return B?": "+B:""}function J(B,ge,Be){B in ge||le("unknown parameter ("+B+")"+Le(Be)+". possible values: "+Object.keys(ge).join())}function Xe(B,ge){re(B)||le("invalid parameter type"+Le(ge)+". must be a typed array")}function et(B,ge){switch(ge){case"number":return typeof B=="number";case"object":return typeof B=="object";case"string":return typeof B=="string";case"boolean":return typeof B=="boolean";case"function":return typeof B=="function";case"undefined":return typeof B=="undefined";case"symbol":return typeof B=="symbol"}}function Ue(B,ge,Be){et(B,ge)||le("invalid parameter type"+Le(Be)+". expected "+ge+", got "+typeof B)}function gt(B,ge){B>=0&&(B|0)===B||le("invalid parameter type, ("+B+")"+Le(ge)+". must be a nonnegative integer")}function rr(B,ge,Be){ge.indexOf(B)<0&&le("invalid value"+Le(Be)+". must be one of: "+ge)}var xt=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function Yt(B){Object.keys(B).forEach(function(ge){xt.indexOf(ge)<0&&le('invalid regl constructor argument "'+ge+'". must be one of '+xt)})}function Et(B,ge){for(B=B+"";B.length<ge;)B=" "+B;return B}function at(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function it(B,ge){this.number=B,this.line=ge,this.errors=[]}function Zt(B,ge,Be){this.file=B,this.line=ge,this.message=Be}function Y(){var B=new Error,ge=(B.stack||B).toString(),Be=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(ge);if(Be)return Be[1];var Dt=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(ge);return Dt?Dt[1]:"unknown"}function $t(){var B=new Error,ge=(B.stack||B).toString(),Be=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(ge);if(Be)return Be[1];var Dt=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(ge);return Dt?Dt[1]:"unknown"}function ft(B,ge){var Be=B.split(`
`),Dt=1,sr=0,kt={unknown:new at,0:new at};kt.unknown.name=kt[0].name=ge||Y(),kt.unknown.lines.push(new it(0,""));for(var er=0;er<Be.length;++er){var hr=Be[er],mr=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(hr);if(mr)switch(mr[1]){case"line":var xr=/(\d+)(\s+\d+)?/.exec(mr[2]);xr&&(Dt=xr[1]|0,xr[2]&&(sr=xr[2]|0,sr in kt||(kt[sr]=new at)));break;case"define":var Tr=/SHADER_NAME(_B64)?\s+(.*)$/.exec(mr[2]);Tr&&(kt[sr].name=Tr[1]?Z(Tr[2]):Tr[2]);break}kt[sr].lines.push(new it(Dt++,hr))}return Object.keys(kt).forEach(function(Rr){var Gr=kt[Rr];Gr.lines.forEach(function(_r){Gr.index[_r.number]=_r})}),kt}function Je(B){var ge=[];return B.split(`
`).forEach(function(Be){if(!(Be.length<5)){var Dt=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(Be);Dt?ge.push(new Zt(Dt[1]|0,Dt[2]|0,Dt[3].trim())):Be.length>0&&ge.push(new Zt("unknown",0,Be))}}),ge}function At(B,ge){ge.forEach(function(Be){var Dt=B[Be.file];if(Dt){var sr=Dt.index[Be.line];if(sr){sr.errors.push(Be),Dt.hasErrors=!0;return}}B.unknown.hasErrors=!0,B.unknown.lines[0].errors.push(Be)})}function Qe(B,ge,Be,Dt,sr){if(!B.getShaderParameter(ge,B.COMPILE_STATUS)){var kt=B.getShaderInfoLog(ge),er=Dt===B.FRAGMENT_SHADER?"fragment":"vertex";De(Be,"string",er+" shader source must be a string",sr);var hr=ft(Be,sr),mr=Je(kt);At(hr,mr),Object.keys(hr).forEach(function(xr){var Tr=hr[xr];if(!Tr.hasErrors)return;var Rr=[""],Gr=[""];function _r(Mr,ut){Rr.push(Mr),Gr.push(ut||"")}_r("file number "+xr+": "+Tr.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),Tr.lines.forEach(function(Mr){if(Mr.errors.length>0){_r(Et(Mr.number,4)+"|  ","background-color:yellow; font-weight:bold"),_r(Mr.line+ve,"color:red; background-color:yellow; font-weight:bold");var ut=0;Mr.errors.forEach(function(Gt){var br=Gt.message,Br=/^\s*'(.*)'\s*:\s*(.*)$/.exec(br);if(Br){var cr=Br[1];switch(br=Br[2],cr){case"assign":cr="=";break}ut=Math.max(Mr.line.indexOf(cr,ut),0)}else ut=0;_r(Et("| ",6)),_r(Et("^^^",ut+3)+ve,"font-weight:bold"),_r(Et("| ",6)),_r(br+ve,"font-weight:bold")}),_r(Et("| ",6)+ve)}else _r(Et(Mr.number,4)+"|  "),_r(Mr.line+ve,"color:red")}),typeof document!="undefined"&&!window.chrome?(Gr[0]=Rr.join("%c"),console.log.apply(console,Gr)):console.log(Rr.join(""))}),fe.raise("Error compiling "+er+" shader, "+hr[0].name)}}function Qt(B,ge,Be,Dt,sr){if(!B.getProgramParameter(ge,B.LINK_STATUS)){var kt=B.getProgramInfoLog(ge),er=ft(Be,sr),hr=ft(Dt,sr),mr='Error linking program with vertex shader, "'+hr[0].name+'", and fragment shader "'+er[0].name+'"';typeof document!="undefined"?console.log("%c"+mr+ve+"%c"+kt,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(mr+ve+kt),fe.raise(mr)}}function Er(B){B._commandRef=Y()}function Nr(B,ge,Be,Dt){Er(B);function sr(mr){return mr?Dt.id(mr):0}B._fragId=sr(B.static.frag),B._vertId=sr(B.static.vert);function kt(mr,xr){Object.keys(xr).forEach(function(Tr){mr[Dt.id(Tr)]=!0})}var er=B._uniformSet={};kt(er,ge.static),kt(er,ge.dynamic);var hr=B._attributeSet={};kt(hr,Be.static),kt(hr,Be.dynamic),B._hasCount="count"in B.static||"count"in B.dynamic||"elements"in B.static||"elements"in B.dynamic}function tn(B,ge){var Be=$t();le(B+" in command "+(ge||Y())+(Be==="unknown"?"":" called from "+Be))}function A(B,ge,Be){B||tn(ge,Be||Y())}function Ce(B,ge,Be,Dt){B in ge||tn("unknown parameter ("+B+")"+Le(Be)+". possible values: "+Object.keys(ge).join(),Dt||Y())}function De(B,ge,Be,Dt){et(B,ge)||tn("invalid parameter type"+Le(Be)+". expected "+ge+", got "+typeof B,Dt||Y())}function wt(B){B()}function mt(B,ge,Be){B.texture?rr(B.texture._texture.internalformat,ge,"unsupported texture format for attachment"):rr(B.renderbuffer._renderbuffer.format,Be,"unsupported renderbuffer format for attachment")}var Bt=33071,Kt=9728,Cr=9984,ei=9985,vn=9986,di=9987,Wn=5120,si=5121,vi=5122,qn=5123,mi=5124,aa=5125,Wi=5126,Oi=32819,Ki=32820,oa=33635,Mi=34042,da=36193,$n={};$n[Wn]=$n[si]=1,$n[vi]=$n[qn]=$n[da]=$n[oa]=$n[Oi]=$n[Ki]=2,$n[mi]=$n[aa]=$n[Wi]=$n[Mi]=4;function wi(B,ge){return B===Ki||B===Oi||B===oa?2:B===Mi?4:$n[B]*ge}function ji(B){return!(B&B-1)&&!!B}function $i(B,ge,Be){var Dt,sr=ge.width,kt=ge.height,er=ge.channels;fe(sr>0&&sr<=Be.maxTextureSize&&kt>0&&kt<=Be.maxTextureSize,"invalid texture shape"),(B.wrapS!==Bt||B.wrapT!==Bt)&&fe(ji(sr)&&ji(kt),"incompatible wrap mode for texture, both width and height must be power of 2"),ge.mipmask===1?sr!==1&&kt!==1&&fe(B.minFilter!==Cr&&B.minFilter!==vn&&B.minFilter!==ei&&B.minFilter!==di,"min filter requires mipmap"):(fe(ji(sr)&&ji(kt),"texture must be a square power of 2 to support mipmapping"),fe(ge.mipmask===(sr<<1)-1,"missing or incomplete mipmap data")),ge.type===Wi&&(Be.extensions.indexOf("oes_texture_float_linear")<0&&fe(B.minFilter===Kt&&B.magFilter===Kt,"filter not supported, must enable oes_texture_float_linear"),fe(!B.genMipmaps,"mipmap generation not supported with float textures"));var hr=ge.images;for(Dt=0;Dt<16;++Dt)if(hr[Dt]){var mr=sr>>Dt,xr=kt>>Dt;fe(ge.mipmask&1<<Dt,"missing mipmap data");var Tr=hr[Dt];if(fe(Tr.width===mr&&Tr.height===xr,"invalid shape for mip images"),fe(Tr.format===ge.format&&Tr.internalformat===ge.internalformat&&Tr.type===ge.type,"incompatible type for mip image"),!Tr.compressed)if(Tr.data){var Rr=Math.ceil(wi(Tr.type,er)*mr/Tr.unpackAlignment)*Tr.unpackAlignment;fe(Tr.data.byteLength===Rr*xr,"invalid data for image, buffer size is inconsistent with image format")}else Tr.element||Tr.copy}else B.genMipmaps||fe((ge.mipmask&1<<Dt)==0,"extra mipmap data");ge.compressed&&fe(!B.genMipmaps,"mipmap generation for compressed images not supported")}function zo(B,ge,Be,Dt){var sr=B.width,kt=B.height,er=B.channels;fe(sr>0&&sr<=Dt.maxTextureSize&&kt>0&&kt<=Dt.maxTextureSize,"invalid texture shape"),fe(sr===kt,"cube map must be square"),fe(ge.wrapS===Bt&&ge.wrapT===Bt,"wrap mode not supported by cube map");for(var hr=0;hr<Be.length;++hr){var mr=Be[hr];fe(mr.width===sr&&mr.height===kt,"inconsistent cube map face shape"),ge.genMipmaps&&(fe(!mr.compressed,"can not generate mipmap for compressed textures"),fe(mr.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var xr=mr.images,Tr=0;Tr<16;++Tr){var Rr=xr[Tr];if(Rr){var Gr=sr>>Tr,_r=kt>>Tr;fe(mr.mipmask&1<<Tr,"missing mipmap data"),fe(Rr.width===Gr&&Rr.height===_r,"invalid shape for mip images"),fe(Rr.format===B.format&&Rr.internalformat===B.internalformat&&Rr.type===B.type,"incompatible type for mip image"),Rr.compressed||(Rr.data?fe(Rr.data.byteLength===Gr*_r*Math.max(wi(Rr.type,er),Rr.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):Rr.element||Rr.copy)}}}}var me=m(fe,{optional:wt,raise:le,commandRaise:tn,command:A,parameter:J,commandParameter:Ce,constructor:Yt,type:Ue,commandType:De,isTypedArray:Xe,nni:gt,oneOf:rr,shaderError:Qe,linkError:Qt,callSite:$t,saveCommandRef:Er,saveDrawInfo:Nr,framebufferFormat:mt,guessCommand:Y,texture2D:$i,textureCube:zo}),Dn=0,Za=0,hs=5,Nt=6;function nr(B,ge){this.id=Dn++,this.type=B,this.data=ge}function Ar(B){return B.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function rn(B){if(B.length===0)return[];var ge=B.charAt(0),Be=B.charAt(B.length-1);if(B.length>1&&ge===Be&&(ge==='"'||ge==="'"))return['"'+Ar(B.substr(1,B.length-2))+'"'];var Dt=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(B);if(Dt)return rn(B.substr(0,Dt.index)).concat(rn(Dt[1])).concat(rn(B.substr(Dt.index+Dt[0].length)));var sr=B.split(".");if(sr.length===1)return['"'+Ar(B)+'"'];for(var kt=[],er=0;er<sr.length;++er)kt=kt.concat(rn(sr[er]));return kt}function wn(B){return"["+rn(B).join("][")+"]"}function Fn(B,ge){return new nr(B,wn(ge+""))}function gi(B){return typeof B=="function"&&!B._reglType||B instanceof nr}function ti(B,ge){if(typeof B=="function")return new nr(Za,B);if(typeof B=="number"||typeof B=="boolean")return new nr(hs,B);if(Array.isArray(B))return new nr(Nt,B.map(function(Be,Dt){return ti(Be,ge+"["+Dt+"]")}));if(B instanceof nr)return B;me(!1,"invalid option type in uniform "+ge)}var fn={DynamicVariable:nr,define:Fn,isDynamic:gi,unbox:ti,accessor:wn},Di={next:typeof requestAnimationFrame=="function"?function(B){return requestAnimationFrame(B)}:function(B){return setTimeout(B,16)},cancel:typeof cancelAnimationFrame=="function"?function(B){return cancelAnimationFrame(B)}:clearTimeout},Ri=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,to=Ri?function(){return+new Date}:typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function Es(){var B={"":0},ge=[""];return{id:function(Be){var Dt=B[Be];return Dt||(Dt=B[Be]=ge.length,ge.push(Be),Dt)},str:function(Be){return ge[Be]}}}function Ko(B,ge,Be){var Dt=document.createElement("canvas");m(Dt.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),B.appendChild(Dt),B===document.body&&(Dt.style.position="absolute",m(B.style,{margin:0,padding:0}));function sr(){var hr=window.innerWidth,mr=window.innerHeight;if(B!==document.body){var xr=Dt.getBoundingClientRect();hr=xr.right-xr.left,mr=xr.bottom-xr.top}Dt.width=Be*hr,Dt.height=Be*mr}var kt;B!==document.body&&typeof ResizeObserver=="function"?(kt=new ResizeObserver(function(){setTimeout(sr)}),kt.observe(B)):window.addEventListener("resize",sr,!1);function er(){kt?kt.disconnect():window.removeEventListener("resize",sr),B.removeChild(Dt)}return sr(),{canvas:Dt,onDestroy:er}}function Ba(B,ge){function Be(Dt){try{return B.getContext(Dt,ge)}catch(sr){return null}}return Be("webgl")||Be("experimental-webgl")||Be("webgl-experimental")}function xa(B){return typeof B.nodeName=="string"&&typeof B.appendChild=="function"&&typeof B.getBoundingClientRect=="function"}function H(B){return typeof B.drawArrays=="function"||typeof B.drawElements=="function"}function Q(B){return typeof B=="string"?B.split():(me(Array.isArray(B),"invalid extension array"),B)}function oe(B){return typeof B=="string"?(me(typeof document!="undefined","not supported outside of DOM"),document.querySelector(B)):B}function ye(B){var ge=B||{},Be,Dt,sr,kt,er={},hr=[],mr=[],xr=typeof window=="undefined"?1:window.devicePixelRatio,Tr=!1,Rr=function(Mr){Mr&&me.raise(Mr)},Gr=function(){};if(typeof ge=="string"?(me(typeof document!="undefined","selector queries only supported in DOM environments"),Be=document.querySelector(ge),me(Be,"invalid query string for element")):typeof ge=="object"?xa(ge)?Be=ge:H(ge)?(kt=ge,sr=kt.canvas):(me.constructor(ge),"gl"in ge?kt=ge.gl:"canvas"in ge?sr=oe(ge.canvas):"container"in ge&&(Dt=oe(ge.container)),"attributes"in ge&&(er=ge.attributes,me.type(er,"object","invalid context attributes")),"extensions"in ge&&(hr=Q(ge.extensions)),"optionalExtensions"in ge&&(mr=Q(ge.optionalExtensions)),"onDone"in ge&&(me.type(ge.onDone,"function","invalid or missing onDone callback"),Rr=ge.onDone),"profile"in ge&&(Tr=!!ge.profile),"pixelRatio"in ge&&(xr=+ge.pixelRatio,me(xr>0,"invalid pixel ratio"))):me.raise("invalid arguments to regl"),Be&&(Be.nodeName.toLowerCase()==="canvas"?sr=Be:Dt=Be),!kt){if(!sr){me(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var _r=Ko(Dt||document.body,Rr,xr);if(!_r)return null;sr=_r.canvas,Gr=_r.onDestroy}er.premultipliedAlpha===void 0&&(er.premultipliedAlpha=!0),kt=Ba(sr,er)}return kt?{gl:kt,canvas:sr,container:Dt,extensions:hr,optionalExtensions:mr,pixelRatio:xr,profile:Tr,onDone:Rr,onDestroy:Gr}:(Gr(),Rr("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function Pe(B,ge){var Be={};function Dt(hr){me.type(hr,"string","extension name must be string");var mr=hr.toLowerCase(),xr;try{xr=Be[mr]=sr(hr)}catch(Tr){}return!!xr}function sr(hr){return B.getExtension(hr)?B.getExtension(hr):B.getExtension(hr.toLowerCase())?B.getExtension(hr.toLowerCase()):null}for(var kt=0;kt<ge.extensions.length;++kt){var er=ge.extensions[kt];if(!Dt(er))return ge.onDestroy(),ge.onDone('"'+er+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return ge.optionalExtensions.forEach(Dt),{extensions:Be,restore:function(){Object.keys(Be).forEach(function(hr){if(Be[hr]&&!Dt(hr))throw new Error("(regl): error restoring extension "+hr)})}}}function He(B,ge){for(var Be=Array(B),Dt=0;Dt<B;++Dt)Be[Dt]=ge(Dt);return Be}var rt=5120,pe=5121,ke=5122,vt=5123,pr=5124,Ft=5125,zt=5126;function vr(B){for(var ge=16;ge<=1<<28;ge*=16)if(B<=ge)return ge;return 0}function En(B){var ge,Be;return ge=(B>65535)<<4,B>>>=ge,Be=(B>255)<<3,B>>>=Be,ge|=Be,Be=(B>15)<<2,B>>>=Be,ge|=Be,Be=(B>3)<<1,B>>>=Be,ge|=Be,ge|B>>1}function pn(){var B=He(8,function(){return[]});function ge(kt){var er=vr(kt),hr=B[En(er)>>2];return hr.length>0?hr.pop():new ArrayBuffer(er)}function Be(kt){B[En(kt.byteLength)>>2].push(kt)}function Dt(kt,er){var hr=null;switch(kt){case rt:hr=new Int8Array(ge(er),0,er);break;case pe:hr=new Uint8Array(ge(er),0,er);break;case ke:hr=new Int16Array(ge(2*er),0,er);break;case vt:hr=new Uint16Array(ge(2*er),0,er);break;case pr:hr=new Int32Array(ge(4*er),0,er);break;case Ft:hr=new Uint32Array(ge(4*er),0,er);break;case zt:hr=new Float32Array(ge(4*er),0,er);break;default:return null}return hr.length!==er?hr.subarray(0,er):hr}function sr(kt){Be(kt.buffer)}return{alloc:ge,free:Be,allocType:Dt,freeType:sr}}var Ot=pn();Ot.zero=pn();var nn=3408,Zr=3410,Yr=3411,_i=3412,an=3413,on=3414,Xi=3415,yi=33901,Pi=33902,bi=3379,ht=3386,Pt=34921,Aa=36347,qi=36348,Ii=35661,pi=35660,wa=34930,$s=36349,Ir=34076,wr=34024,Mt=7936,bo=7937,ne=7938,Fu=35724,oo=34047,Ra=36063,Ta=34852,Qi=3553,Uo=34067,$o=34069,xu=33984,Eo=6408,Zo=5126,sa=5121,so=36160,jo=36053,Ya=36064,Gs=16384,ll=function(B,ge){var Be=1;ge.ext_texture_filter_anisotropic&&(Be=B.getParameter(oo));var Dt=1,sr=1;ge.webgl_draw_buffers&&(Dt=B.getParameter(Ta),sr=B.getParameter(Ra));var kt=!!ge.oes_texture_float;if(kt){var er=B.createTexture();B.bindTexture(Qi,er),B.texImage2D(Qi,0,Eo,1,1,0,Eo,Zo,null);var hr=B.createFramebuffer();if(B.bindFramebuffer(so,hr),B.framebufferTexture2D(so,Ya,Qi,er,0),B.bindTexture(Qi,null),B.checkFramebufferStatus(so)!==jo)kt=!1;else{B.viewport(0,0,1,1),B.clearColor(1,0,0,1),B.clear(Gs);var mr=Ot.allocType(Zo,4);B.readPixels(0,0,1,1,Eo,Zo,mr),B.getError()?kt=!1:(B.deleteFramebuffer(hr),B.deleteTexture(er),kt=mr[0]===1),Ot.freeType(mr)}}var xr=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),Tr=!0;if(!xr){var Rr=B.createTexture(),Gr=Ot.allocType(sa,36);B.activeTexture(xu),B.bindTexture(Uo,Rr),B.texImage2D($o,0,Eo,3,3,0,Eo,sa,Gr),Ot.freeType(Gr),B.bindTexture(Uo,null),B.deleteTexture(Rr),Tr=!B.getError()}return{colorBits:[B.getParameter(Zr),B.getParameter(Yr),B.getParameter(_i),B.getParameter(an)],depthBits:B.getParameter(on),stencilBits:B.getParameter(Xi),subpixelBits:B.getParameter(nn),extensions:Object.keys(ge).filter(function(_r){return!!ge[_r]}),maxAnisotropic:Be,maxDrawbuffers:Dt,maxColorAttachments:sr,pointSizeDims:B.getParameter(yi),lineWidthDims:B.getParameter(Pi),maxViewportDims:B.getParameter(ht),maxCombinedTextureUnits:B.getParameter(Ii),maxCubeMapSize:B.getParameter(Ir),maxRenderbufferSize:B.getParameter(wr),maxTextureUnits:B.getParameter(wa),maxTextureSize:B.getParameter(bi),maxAttributes:B.getParameter(Pt),maxVertexUniforms:B.getParameter(Aa),maxVertexTextureUnits:B.getParameter(pi),maxVaryingVectors:B.getParameter(qi),maxFragmentUniforms:B.getParameter($s),glsl:B.getParameter(Fu),renderer:B.getParameter(bo),vendor:B.getParameter(Mt),version:B.getParameter(ne),readFloat:kt,npotTextureCube:Tr}};function os(B){return!!B&&typeof B=="object"&&Array.isArray(B.shape)&&Array.isArray(B.stride)&&typeof B.offset=="number"&&B.shape.length===B.stride.length&&(Array.isArray(B.data)||re(B.data))}var ie=function(B){return Object.keys(B).map(function(ge){return B[ge]})},Ee={shape:ro,flatten:Ti};function qe(B,ge,Be){for(var Dt=0;Dt<ge;++Dt)Be[Dt]=B[Dt]}function Rt(B,ge,Be,Dt){for(var sr=0,kt=0;kt<ge;++kt)for(var er=B[kt],hr=0;hr<Be;++hr)Dt[sr++]=er[hr]}function Or(B,ge,Be,Dt,sr,kt){for(var er=kt,hr=0;hr<ge;++hr)for(var mr=B[hr],xr=0;xr<Be;++xr)for(var Tr=mr[xr],Rr=0;Rr<Dt;++Rr)sr[er++]=Tr[Rr]}function Tn(B,ge,Be,Dt,sr){for(var kt=1,er=Be+1;er<ge.length;++er)kt*=ge[er];var hr=ge[Be];if(ge.length-Be==4){var mr=ge[Be+1],xr=ge[Be+2],Tr=ge[Be+3];for(er=0;er<hr;++er)Or(B[er],mr,xr,Tr,Dt,sr),sr+=kt}else for(er=0;er<hr;++er)Tn(B[er],ge,Be+1,Dt,sr),sr+=kt}function Ti(B,ge,Be,Dt){var sr=1;if(ge.length)for(var kt=0;kt<ge.length;++kt)sr*=ge[kt];else sr=0;var er=Dt||Ot.allocType(Be,sr);switch(ge.length){case 0:break;case 1:qe(B,ge[0],er);break;case 2:Rt(B,ge[0],ge[1],er);break;case 3:Or(B,ge[0],ge[1],ge[2],er,0);break;default:Tn(B,ge,0,er,0)}return er}function ro(B){for(var ge=[],Be=B;Be.length;Be=Be[0])ge.push(Be.length);return ge}var La={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},ja=5120,Qo=5122,ps=5124,Jo=5121,Ss=5123,Lo=5125,Vo=5126,Qs=5126,ou={int8:ja,int16:Qo,int32:ps,uint8:Jo,uint16:Ss,uint32:Lo,float:Vo,float32:Qs},ds=35048,ga=35040,ko={dynamic:ds,stream:ga,static:35044},Il=Ee.flatten,vs=Ee.shape,es=35044,of=35040,rc=5121,Cs=5126,bu=[];bu[5120]=1,bu[5122]=2,bu[5124]=4,bu[5121]=1,bu[5123]=2,bu[5125]=4,bu[5126]=4;function cl(B){return La[Object.prototype.toString.call(B)]|0}function _(B,ge){for(var Be=0;Be<ge.length;++Be)B[Be]=ge[Be]}function M(B,ge,Be,Dt,sr,kt,er){for(var hr=0,mr=0;mr<Be;++mr)for(var xr=0;xr<Dt;++xr)B[hr++]=ge[sr*mr+kt*xr+er]}function F(B,ge,Be,Dt){var sr=0,kt={};function er(ut){this.id=sr++,this.buffer=B.createBuffer(),this.type=ut,this.usage=es,this.byteLength=0,this.dimension=1,this.dtype=rc,this.persistentData=null,Be.profile&&(this.stats={size:0})}er.prototype.bind=function(){B.bindBuffer(this.type,this.buffer)},er.prototype.destroy=function(){Gr(this)};var hr=[];function mr(ut,Gt){var br=hr.pop();return br||(br=new er(ut)),br.bind(),Rr(br,Gt,of,0,1,!1),br}function xr(ut){hr.push(ut)}function Tr(ut,Gt,br){ut.byteLength=Gt.byteLength,B.bufferData(ut.type,Gt,br)}function Rr(ut,Gt,br,Br,cr,or){var zr;if(ut.usage=br,Array.isArray(Gt)){if(ut.dtype=Br||Cs,Gt.length>0){var Un;if(Array.isArray(Gt[0])){zr=vs(Gt);for(var tr=1,ir=1;ir<zr.length;++ir)tr*=zr[ir];ut.dimension=tr,Un=Il(Gt,zr,ut.dtype),Tr(ut,Un,br),or?ut.persistentData=Un:Ot.freeType(Un)}else if(typeof Gt[0]=="number"){ut.dimension=cr;var Sn=Ot.allocType(ut.dtype,Gt.length);_(Sn,Gt),Tr(ut,Sn,br),or?ut.persistentData=Sn:Ot.freeType(Sn)}else re(Gt[0])?(ut.dimension=Gt[0].length,ut.dtype=Br||cl(Gt[0])||Cs,Un=Il(Gt,[Gt.length,Gt[0].length],ut.dtype),Tr(ut,Un,br),or?ut.persistentData=Un:Ot.freeType(Un)):me.raise("invalid buffer data")}}else if(re(Gt))ut.dtype=Br||cl(Gt),ut.dimension=cr,Tr(ut,Gt,br),or&&(ut.persistentData=new Uint8Array(new Uint8Array(Gt.buffer)));else if(os(Gt)){zr=Gt.shape;var Xr=Gt.stride,Sr=Gt.offset,Hr=0,Jr=0,Ei=0,Gn=0;zr.length===1?(Hr=zr[0],Jr=1,Ei=Xr[0],Gn=0):zr.length===2?(Hr=zr[0],Jr=zr[1],Ei=Xr[0],Gn=Xr[1]):me.raise("invalid shape"),ut.dtype=Br||cl(Gt.data)||Cs,ut.dimension=Jr;var jr=Ot.allocType(ut.dtype,Hr*Jr);M(jr,Gt.data,Hr,Jr,Ei,Gn,Sr),Tr(ut,jr,br),or?ut.persistentData=jr:Ot.freeType(jr)}else Gt instanceof ArrayBuffer?(ut.dtype=rc,ut.dimension=cr,Tr(ut,Gt,br),or&&(ut.persistentData=new Uint8Array(new Uint8Array(Gt)))):me.raise("invalid buffer data")}function Gr(ut){ge.bufferCount--,Dt(ut);var Gt=ut.buffer;me(Gt,"buffer must not be deleted already"),B.deleteBuffer(Gt),ut.buffer=null,delete kt[ut.id]}function _r(ut,Gt,br,Br){ge.bufferCount++;var cr=new er(Gt);kt[cr.id]=cr;function or(tr){var ir=es,Sn=null,Xr=0,Sr=0,Hr=1;return Array.isArray(tr)||re(tr)||os(tr)||tr instanceof ArrayBuffer?Sn=tr:typeof tr=="number"?Xr=tr|0:tr&&(me.type(tr,"object","buffer arguments must be an object, a number or an array"),"data"in tr&&(me(Sn===null||Array.isArray(Sn)||re(Sn)||os(Sn),"invalid data for buffer"),Sn=tr.data),"usage"in tr&&(me.parameter(tr.usage,ko,"invalid buffer usage"),ir=ko[tr.usage]),"type"in tr&&(me.parameter(tr.type,ou,"invalid buffer type"),Sr=ou[tr.type]),"dimension"in tr&&(me.type(tr.dimension,"number","invalid dimension"),Hr=tr.dimension|0),"length"in tr&&(me.nni(Xr,"buffer length must be a nonnegative integer"),Xr=tr.length|0)),cr.bind(),Sn?Rr(cr,Sn,ir,Sr,Hr,Br):(Xr&&B.bufferData(cr.type,Xr,ir),cr.dtype=Sr||rc,cr.usage=ir,cr.dimension=Hr,cr.byteLength=Xr),Be.profile&&(cr.stats.size=cr.byteLength*bu[cr.dtype]),or}function zr(tr,ir){me(ir+tr.byteLength<=cr.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+tr.byteLength+" starting from offset "+ir+" to a buffer of size "+cr.byteLength),B.bufferSubData(cr.type,ir,tr)}function Un(tr,ir){var Sn=(ir||0)|0,Xr;if(cr.bind(),re(tr)||tr instanceof ArrayBuffer)zr(tr,Sn);else if(Array.isArray(tr)){if(tr.length>0)if(typeof tr[0]=="number"){var Sr=Ot.allocType(cr.dtype,tr.length);_(Sr,tr),zr(Sr,Sn),Ot.freeType(Sr)}else if(Array.isArray(tr[0])||re(tr[0])){Xr=vs(tr);var Hr=Il(tr,Xr,cr.dtype);zr(Hr,Sn),Ot.freeType(Hr)}else me.raise("invalid buffer data")}else if(os(tr)){Xr=tr.shape;var Jr=tr.stride,Ei=0,Gn=0,jr=0,en=0;Xr.length===1?(Ei=Xr[0],Gn=1,jr=Jr[0],en=0):Xr.length===2?(Ei=Xr[0],Gn=Xr[1],jr=Jr[0],en=Jr[1]):me.raise("invalid shape");var ni=Array.isArray(tr.data)?cr.dtype:cl(tr.data),ui=Ot.allocType(ni,Ei*Gn);M(ui,tr.data,Ei,Gn,jr,en,tr.offset),zr(ui,Sn),Ot.freeType(ui)}else me.raise("invalid data for buffer subdata");return or}return br||or(ut),or._reglType="buffer",or._buffer=cr,or.subdata=Un,Be.profile&&(or.stats=cr.stats),or.destroy=function(){Gr(cr)},or}function Mr(){ie(kt).forEach(function(ut){ut.buffer=B.createBuffer(),B.bindBuffer(ut.type,ut.buffer),B.bufferData(ut.type,ut.persistentData||ut.byteLength,ut.usage)})}return Be.profile&&(ge.getTotalBufferSize=function(){var ut=0;return Object.keys(kt).forEach(function(Gt){ut+=kt[Gt].stats.size}),ut}),{create:_r,createStream:mr,destroyStream:xr,clear:function(){ie(kt).forEach(Gr),hr.forEach(Gr)},getBuffer:function(ut){return ut&&ut._buffer instanceof er?ut._buffer:null},restore:Mr,_initBuffer:Rr}}var R=0,K=0,_e=1,je=1,pt=4,dt=4,ur={points:R,point:K,lines:_e,line:je,triangles:pt,triangle:dt,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},yr=0,In=1,Bn=4,Qn=5120,Vi=5121,Li=5122,ba=5123,Gi=5124,As=5125,Eu=34963,fl=35040,Rc=35044;function tl(B,ge,Be,Dt){var sr={},kt=0,er={uint8:Vi,uint16:ba};ge.oes_element_index_uint&&(er.uint32=As);function hr(Mr){this.id=kt++,sr[this.id]=this,this.buffer=Mr,this.primType=Bn,this.vertCount=0,this.type=0}hr.prototype.bind=function(){this.buffer.bind()};var mr=[];function xr(Mr){var ut=mr.pop();return ut||(ut=new hr(Be.create(null,Eu,!0,!1)._buffer)),Rr(ut,Mr,fl,-1,-1,0,0),ut}function Tr(Mr){mr.push(Mr)}function Rr(Mr,ut,Gt,br,Br,cr,or){Mr.buffer.bind();var zr;if(ut){var Un=or;!or&&(!re(ut)||os(ut)&&!re(ut.data))&&(Un=ge.oes_element_index_uint?As:ba),Be._initBuffer(Mr.buffer,ut,Gt,Un,3)}else B.bufferData(Eu,cr,Gt),Mr.buffer.dtype=zr||Vi,Mr.buffer.usage=Gt,Mr.buffer.dimension=3,Mr.buffer.byteLength=cr;if(zr=or,!or){switch(Mr.buffer.dtype){case Vi:case Qn:zr=Vi;break;case ba:case Li:zr=ba;break;case As:case Gi:zr=As;break;default:me.raise("unsupported type for element array")}Mr.buffer.dtype=zr}Mr.type=zr,me(zr!==As||!!ge.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var tr=Br;tr<0&&(tr=Mr.buffer.byteLength,zr===ba?tr>>=1:zr===As&&(tr>>=2)),Mr.vertCount=tr;var ir=br;if(br<0){ir=Bn;var Sn=Mr.buffer.dimension;Sn===1&&(ir=yr),Sn===2&&(ir=In),Sn===3&&(ir=Bn)}Mr.primType=ir}function Gr(Mr){Dt.elementsCount--,me(Mr.buffer!==null,"must not double destroy elements"),delete sr[Mr.id],Mr.buffer.destroy(),Mr.buffer=null}function _r(Mr,ut){var Gt=Be.create(null,Eu,!0),br=new hr(Gt._buffer);Dt.elementsCount++;function Br(cr){if(!cr)Gt(),br.primType=Bn,br.vertCount=0,br.type=Vi;else if(typeof cr=="number")Gt(cr),br.primType=Bn,br.vertCount=cr|0,br.type=Vi;else{var or=null,zr=Rc,Un=-1,tr=-1,ir=0,Sn=0;Array.isArray(cr)||re(cr)||os(cr)?or=cr:(me.type(cr,"object","invalid arguments for elements"),"data"in cr&&(or=cr.data,me(Array.isArray(or)||re(or)||os(or),"invalid data for element buffer")),"usage"in cr&&(me.parameter(cr.usage,ko,"invalid element buffer usage"),zr=ko[cr.usage]),"primitive"in cr&&(me.parameter(cr.primitive,ur,"invalid element buffer primitive"),Un=ur[cr.primitive]),"count"in cr&&(me(typeof cr.count=="number"&&cr.count>=0,"invalid vertex count for elements"),tr=cr.count|0),"type"in cr&&(me.parameter(cr.type,er,"invalid buffer type"),Sn=er[cr.type]),"length"in cr?ir=cr.length|0:(ir=tr,Sn===ba||Sn===Li?ir*=2:(Sn===As||Sn===Gi)&&(ir*=4))),Rr(br,or,zr,Un,tr,ir,Sn)}return Br}return Br(Mr),Br._reglType="elements",Br._elements=br,Br.subdata=function(cr,or){return Gt.subdata(cr,or),Br},Br.destroy=function(){Gr(br)},Br}return{create:_r,createStream:xr,destroyStream:Tr,getElements:function(Mr){return typeof Mr=="function"&&Mr._elements instanceof hr?Mr._elements:null},clear:function(){ie(sr).forEach(Gr)}}}var Lc=new Float32Array(1),Bu=new Uint32Array(Lc.buffer),Nu=5123;function zu(B){for(var ge=Ot.allocType(Nu,B.length),Be=0;Be<B.length;++Be)if(isNaN(B[Be]))ge[Be]=65535;else if(B[Be]===Infinity)ge[Be]=31744;else if(B[Be]===-Infinity)ge[Be]=64512;else{Lc[0]=B[Be];var Dt=Bu[0],sr=Dt>>>31<<15,kt=(Dt<<1>>>24)-127,er=Dt>>13&(1<<10)-1;if(kt<-24)ge[Be]=sr;else if(kt<-14){var hr=-14-kt;ge[Be]=sr+(er+(1<<10)>>hr)}else kt>15?ge[Be]=sr+31744:ge[Be]=sr+(kt+15<<10)+er}return ge}function uo(B){return Array.isArray(B)||re(B)}var Bf=function(B){return!(B&B-1)&&!!B},Nf=34467,ws=3553,sf=34067,su=34069,Hs=6408,uf=6406,Ol=6407,ya=6409,nc=6410,Js=32854,hl=32855,zf=36194,ep=32819,lf=32820,ic=33635,ac=34042,oc=6402,sc=34041,uc=35904,Rl=35906,Ll=36193,pl=33776,eu=33777,kc=33778,cf=33779,Uf=35986,dl=35987,lc=34798,rl=35840,ff=35841,Dc=35842,bh=35843,kl=36196,Dl=5121,Zf=5123,jf=5125,vl=5126,Vf=10242,Eh=10243,Fc=10497,cc=33071,tp=33648,fc=10240,Va=10241,hc=9728,ts=9729,Uu=9984,kn=9985,Ma=9986,Ws=9987,Bc=33170,Zu=4352,Nc=4353,rp=4354,lo=34046,ju=3317,Su=37440,tu=37441,Do=37443,Fl=37444,ml=33984,ho=[Uu,Ma,kn,Ws],yn=[0,ya,nc,Ol,Hs],qa={};qa[ya]=qa[uf]=qa[oc]=1,qa[sc]=qa[nc]=2,qa[Ol]=qa[uc]=3,qa[Hs]=qa[Rl]=4;function nl(B){return"[object "+B+"]"}var pc=nl("HTMLCanvasElement"),uu=nl("OffscreenCanvas"),na=nl("CanvasRenderingContext2D"),hf=nl("ImageBitmap"),Kr=nl("HTMLImageElement"),zc=nl("HTMLVideoElement"),pf=Object.keys(La).concat([pc,uu,na,hf,Kr,zc]),gl=[];gl[Dl]=1,gl[vl]=4,gl[Ll]=2,gl[Zf]=2,gl[jf]=4;var Ea=[];Ea[Js]=2,Ea[hl]=2,Ea[zf]=2,Ea[sc]=4,Ea[pl]=.5,Ea[eu]=.5,Ea[kc]=1,Ea[cf]=1,Ea[Uf]=.5,Ea[dl]=1,Ea[lc]=1,Ea[rl]=.5,Ea[ff]=.25,Ea[Dc]=.5,Ea[bh]=.25,Ea[kl]=.5;function ms(B){return Array.isArray(B)&&(B.length===0||typeof B[0]=="number")}function Uc(B){if(!Array.isArray(B))return!1;var ge=B.length;return!(ge===0||!uo(B[0]))}function Cu(B){return Object.prototype.toString.call(B)}function ks(B){return Cu(B)===pc}function Vu(B){return Cu(B)===uu}function Zc(B){return Cu(B)===na}function Bl(B){return Cu(B)===hf}function Gf(B){return Cu(B)===Kr}function Hf(B){return Cu(B)===zc}function Ds(B){var ge=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return!!(ge&&B&&B.getContext)}function Fs(B){var ge=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return!!(ge&&B&&"src"in B&&"crossOrigin"in B)}function Fi(B){if(!B)return!1;if(Ds(B)||Fs(B))return!0;var ge=Cu(B);return pf.indexOf(ge)>=0?!0:ms(B)||Uc(B)||os(B)}function Au(B){return La[Object.prototype.toString.call(B)]|0}function wu(B,ge){var Be=ge.length;switch(B.type){case Dl:case Zf:case jf:case vl:var Dt=Ot.allocType(B.type,Be);Dt.set(ge),B.data=Dt;break;case Ll:B.data=zu(ge);break;default:me.raise("unsupported texture type, must specify a typed array")}}function rs(B,ge){return Ot.allocType(B.type===Ll?vl:B.type,ge)}function Gu(B,ge){B.type===Ll?(B.data=zu(ge),Ot.freeType(ge)):B.data=ge}function Tu(B,ge,Be,Dt,sr,kt){for(var er=B.width,hr=B.height,mr=B.channels,xr=er*hr*mr,Tr=rs(B,xr),Rr=0,Gr=0;Gr<hr;++Gr)for(var _r=0;_r<er;++_r)for(var Mr=0;Mr<mr;++Mr)Tr[Rr++]=ge[Be*_r+Dt*Gr+sr*Mr+kt];Gu(B,Tr)}function Xs(B,ge,Be,Dt,sr,kt){var er;if(typeof Ea[B]!="undefined"?er=Ea[B]:er=qa[B]*gl[ge],kt&&(er*=6),sr){for(var hr=0,mr=Be;mr>=1;)hr+=er*mr*mr,mr/=2;return hr}else return er*Be*Dt}function gs(B,ge,Be,Dt,sr,kt,er){var hr={"don't care":Zu,"dont care":Zu,nice:rp,fast:Nc},mr={repeat:Fc,clamp:cc,mirror:tp},xr={nearest:hc,linear:ts},Tr=m({mipmap:Ws,"nearest mipmap nearest":Uu,"linear mipmap nearest":kn,"nearest mipmap linear":Ma,"linear mipmap linear":Ws},xr),Rr={none:0,browser:Fl},Gr={uint8:Dl,rgba4:ep,rgb565:ic,"rgb5 a1":lf},_r={alpha:uf,luminance:ya,"luminance alpha":nc,rgb:Ol,rgba:Hs,rgba4:Js,"rgb5 a1":hl,rgb565:zf},Mr={};ge.ext_srgb&&(_r.srgb=uc,_r.srgba=Rl),ge.oes_texture_float&&(Gr.float32=Gr.float=vl),ge.oes_texture_half_float&&(Gr.float16=Gr["half float"]=Ll),ge.webgl_depth_texture&&(m(_r,{depth:oc,"depth stencil":sc}),m(Gr,{uint16:Zf,uint32:jf,"depth stencil":ac})),ge.webgl_compressed_texture_s3tc&&m(Mr,{"rgb s3tc dxt1":pl,"rgba s3tc dxt1":eu,"rgba s3tc dxt3":kc,"rgba s3tc dxt5":cf}),ge.webgl_compressed_texture_atc&&m(Mr,{"rgb atc":Uf,"rgba atc explicit alpha":dl,"rgba atc interpolated alpha":lc}),ge.webgl_compressed_texture_pvrtc&&m(Mr,{"rgb pvrtc 4bppv1":rl,"rgb pvrtc 2bppv1":ff,"rgba pvrtc 4bppv1":Dc,"rgba pvrtc 2bppv1":bh}),ge.webgl_compressed_texture_etc1&&(Mr["rgb etc1"]=kl);var ut=Array.prototype.slice.call(B.getParameter(Nf)||new Uint32Array(0));Object.keys(Mr).forEach(function(Te){var Ut=Mr[Te];ut.indexOf(Ut)>=0&&(_r[Te]=Ut)});var Gt=Object.keys(_r);Be.textureFormats=Gt;var br=[];Object.keys(_r).forEach(function(Te){var Ut=_r[Te];br[Ut]=Te});var Br=[];Object.keys(Gr).forEach(function(Te){var Ut=Gr[Te];Br[Ut]=Te});var cr=[];Object.keys(xr).forEach(function(Te){var Ut=xr[Te];cr[Ut]=Te});var or=[];Object.keys(Tr).forEach(function(Te){var Ut=Tr[Te];or[Ut]=Te});var zr=[];Object.keys(mr).forEach(function(Te){var Ut=mr[Te];zr[Ut]=Te});var Un=Gt.reduce(function(Te,Ut){var St=_r[Ut];return St===ya||St===uf||St===ya||St===nc||St===oc||St===sc||ge.ext_srgb&&(St===uc||St===Rl)?Te[St]=St:St===hl||Ut.indexOf("rgba")>=0?Te[St]=Hs:Te[St]=Ol,Te},{});function tr(){this.internalformat=Hs,this.format=Hs,this.type=Dl,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=Fl,this.width=0,this.height=0,this.channels=0}function ir(Te,Ut){Te.internalformat=Ut.internalformat,Te.format=Ut.format,Te.type=Ut.type,Te.compressed=Ut.compressed,Te.premultiplyAlpha=Ut.premultiplyAlpha,Te.flipY=Ut.flipY,Te.unpackAlignment=Ut.unpackAlignment,Te.colorSpace=Ut.colorSpace,Te.width=Ut.width,Te.height=Ut.height,Te.channels=Ut.channels}function Sn(Te,Ut){if(!(typeof Ut!="object"||!Ut)){if("premultiplyAlpha"in Ut&&(me.type(Ut.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),Te.premultiplyAlpha=Ut.premultiplyAlpha),"flipY"in Ut&&(me.type(Ut.flipY,"boolean","invalid texture flip"),Te.flipY=Ut.flipY),"alignment"in Ut&&(me.oneOf(Ut.alignment,[1,2,4,8],"invalid texture unpack alignment"),Te.unpackAlignment=Ut.alignment),"colorSpace"in Ut&&(me.parameter(Ut.colorSpace,Rr,"invalid colorSpace"),Te.colorSpace=Rr[Ut.colorSpace]),"type"in Ut){var St=Ut.type;me(ge.oes_texture_float||!(St==="float"||St==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),me(ge.oes_texture_half_float||!(St==="half float"||St==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),me(ge.webgl_depth_texture||!(St==="uint16"||St==="uint32"||St==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),me.parameter(St,Gr,"invalid texture type"),Te.type=Gr[St]}var mn=Te.width,Hi=Te.height,Se=Te.channels,ue=!1;"shape"in Ut?(me(Array.isArray(Ut.shape)&&Ut.shape.length>=2,"shape must be an array"),mn=Ut.shape[0],Hi=Ut.shape[1],Ut.shape.length===3&&(Se=Ut.shape[2],me(Se>0&&Se<=4,"invalid number of channels"),ue=!0),me(mn>=0&&mn<=Be.maxTextureSize,"invalid width"),me(Hi>=0&&Hi<=Be.maxTextureSize,"invalid height")):("radius"in Ut&&(mn=Hi=Ut.radius,me(mn>=0&&mn<=Be.maxTextureSize,"invalid radius")),"width"in Ut&&(mn=Ut.width,me(mn>=0&&mn<=Be.maxTextureSize,"invalid width")),"height"in Ut&&(Hi=Ut.height,me(Hi>=0&&Hi<=Be.maxTextureSize,"invalid height")),"channels"in Ut&&(Se=Ut.channels,me(Se>0&&Se<=4,"invalid number of channels"),ue=!0)),Te.width=mn|0,Te.height=Hi|0,Te.channels=Se|0;var Ge=!1;if("format"in Ut){var lt=Ut.format;me(ge.webgl_depth_texture||!(lt==="depth"||lt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),me.parameter(lt,_r,"invalid texture format");var Lt=Te.internalformat=_r[lt];Te.format=Un[Lt],lt in Gr&&("type"in Ut||(Te.type=Gr[lt])),lt in Mr&&(Te.compressed=!0),Ge=!0}!ue&&Ge?Te.channels=qa[Te.format]:ue&&!Ge?Te.channels!==yn[Te.format]&&(Te.format=Te.internalformat=yn[Te.channels]):Ge&&ue&&me(Te.channels===qa[Te.format],"number of channels inconsistent with specified format")}}function Xr(Te){B.pixelStorei(Su,Te.flipY),B.pixelStorei(tu,Te.premultiplyAlpha),B.pixelStorei(Do,Te.colorSpace),B.pixelStorei(ju,Te.unpackAlignment)}function Sr(){tr.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function Hr(Te,Ut){var St=null;if(Fi(Ut)?St=Ut:Ut&&(me.type(Ut,"object","invalid pixel data type"),Sn(Te,Ut),"x"in Ut&&(Te.xOffset=Ut.x|0),"y"in Ut&&(Te.yOffset=Ut.y|0),Fi(Ut.data)&&(St=Ut.data)),me(!Te.compressed||St instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),Ut.copy){me(!St,"can not specify copy and data field for the same texture");var mn=sr.viewportWidth,Hi=sr.viewportHeight;Te.width=Te.width||mn-Te.xOffset,Te.height=Te.height||Hi-Te.yOffset,Te.needsCopy=!0,me(Te.xOffset>=0&&Te.xOffset<mn&&Te.yOffset>=0&&Te.yOffset<Hi&&Te.width>0&&Te.width<=mn&&Te.height>0&&Te.height<=Hi,"copy texture read out of bounds")}else if(!St)Te.width=Te.width||1,Te.height=Te.height||1,Te.channels=Te.channels||4;else if(re(St))Te.channels=Te.channels||4,Te.data=St,!("type"in Ut)&&Te.type===Dl&&(Te.type=Au(St));else if(ms(St))Te.channels=Te.channels||4,wu(Te,St),Te.alignment=1,Te.needsFree=!0;else if(os(St)){var Se=St.data;!Array.isArray(Se)&&Te.type===Dl&&(Te.type=Au(Se));var ue=St.shape,Ge=St.stride,lt,Lt,Ke,Fe,nt,xe;ue.length===3?(Ke=ue[2],xe=Ge[2]):(me(ue.length===2,"invalid ndarray pixel data, must be 2 or 3D"),Ke=1,xe=1),lt=ue[0],Lt=ue[1],Fe=Ge[0],nt=Ge[1],Te.alignment=1,Te.width=lt,Te.height=Lt,Te.channels=Ke,Te.format=Te.internalformat=yn[Ke],Te.needsFree=!0,Tu(Te,Se,Fe,nt,xe,St.offset)}else if(Ds(St)||ks(St)||Vu(St)||Zc(St))Ds(St)||ks(St)||Vu(St)?Te.element=St:Te.element=St.canvas,Te.width=Te.element.width,Te.height=Te.element.height,Te.channels=4;else if(Bl(St))Te.element=St,Te.width=St.width,Te.height=St.height,Te.channels=4;else if(Gf(St))Te.element=St,Te.width=St.naturalWidth,Te.height=St.naturalHeight,Te.channels=4;else if(Fs(St))Te.element=St,Te.width=St.width,Te.height=St.height,Te.channels=4;else if(Hf(St))Te.element=St,Te.width=St.videoWidth,Te.height=St.videoHeight,Te.channels=4;else if(Uc(St)){var Ze=Te.width||St[0].length,Ae=Te.height||St.length,ct=Te.channels;uo(St[0][0])?ct=ct||St[0][0].length:ct=ct||1;for(var Ct=Ee.shape(St),fr=1,Ur=0;Ur<Ct.length;++Ur)fr*=Ct[Ur];var Vr=rs(Te,fr);Ee.flatten(St,Ct,"",Vr),Gu(Te,Vr),Te.alignment=1,Te.width=Ze,Te.height=Ae,Te.channels=ct,Te.format=Te.internalformat=yn[ct],Te.needsFree=!0}Te.type===vl?me(Be.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):Te.type===Ll&&me(Be.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function Jr(Te,Ut,St){var mn=Te.element,Hi=Te.data,Se=Te.internalformat,ue=Te.format,Ge=Te.type,lt=Te.width,Lt=Te.height;Xr(Te),mn?B.texImage2D(Ut,St,ue,ue,Ge,mn):Te.compressed?B.compressedTexImage2D(Ut,St,Se,lt,Lt,0,Hi):Te.needsCopy?(Dt(),B.copyTexImage2D(Ut,St,ue,Te.xOffset,Te.yOffset,lt,Lt,0)):B.texImage2D(Ut,St,ue,lt,Lt,0,ue,Ge,Hi||null)}function Ei(Te,Ut,St,mn,Hi){var Se=Te.element,ue=Te.data,Ge=Te.internalformat,lt=Te.format,Lt=Te.type,Ke=Te.width,Fe=Te.height;Xr(Te),Se?B.texSubImage2D(Ut,Hi,St,mn,lt,Lt,Se):Te.compressed?B.compressedTexSubImage2D(Ut,Hi,St,mn,Ge,Ke,Fe,ue):Te.needsCopy?(Dt(),B.copyTexSubImage2D(Ut,Hi,St,mn,Te.xOffset,Te.yOffset,Ke,Fe)):B.texSubImage2D(Ut,Hi,St,mn,Ke,Fe,lt,Lt,ue)}var Gn=[];function jr(){return Gn.pop()||new Sr}function en(Te){Te.needsFree&&Ot.freeType(Te.data),Sr.call(Te),Gn.push(Te)}function ni(){tr.call(this),this.genMipmaps=!1,this.mipmapHint=Zu,this.mipmask=0,this.images=Array(16)}function ui(Te,Ut,St){var mn=Te.images[0]=jr();Te.mipmask=1,mn.width=Te.width=Ut,mn.height=Te.height=St,mn.channels=Te.channels=4}function Ni(Te,Ut){var St=null;if(Fi(Ut))St=Te.images[0]=jr(),ir(St,Te),Hr(St,Ut),Te.mipmask=1;else if(Sn(Te,Ut),Array.isArray(Ut.mipmap))for(var mn=Ut.mipmap,Hi=0;Hi<mn.length;++Hi)St=Te.images[Hi]=jr(),ir(St,Te),St.width>>=Hi,St.height>>=Hi,Hr(St,mn[Hi]),Te.mipmask|=1<<Hi;else St=Te.images[0]=jr(),ir(St,Te),Hr(St,Ut),Te.mipmask=1;ir(Te,Te.images[0]),Te.compressed&&(Te.internalformat===pl||Te.internalformat===eu||Te.internalformat===kc||Te.internalformat===cf)&&me(Te.width%4==0&&Te.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function Ga(Te,Ut){for(var St=Te.images,mn=0;mn<St.length;++mn){if(!St[mn])return;Jr(St[mn],Ut,mn)}}var no=[];function Zi(){var Te=no.pop()||new ni;tr.call(Te),Te.mipmask=0;for(var Ut=0;Ut<16;++Ut)Te.images[Ut]=null;return Te}function ss(Te){for(var Ut=Te.images,St=0;St<Ut.length;++St)Ut[St]&&en(Ut[St]),Ut[St]=null;no.push(Te)}function Ha(){this.minFilter=hc,this.magFilter=hc,this.wrapS=cc,this.wrapT=cc,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=Zu}function as(Te,Ut){if("min"in Ut){var St=Ut.min;me.parameter(St,Tr),Te.minFilter=Tr[St],ho.indexOf(Te.minFilter)>=0&&!("faces"in Ut)&&(Te.genMipmaps=!0)}if("mag"in Ut){var mn=Ut.mag;me.parameter(mn,xr),Te.magFilter=xr[mn]}var Hi=Te.wrapS,Se=Te.wrapT;if("wrap"in Ut){var ue=Ut.wrap;typeof ue=="string"?(me.parameter(ue,mr),Hi=Se=mr[ue]):Array.isArray(ue)&&(me.parameter(ue[0],mr),me.parameter(ue[1],mr),Hi=mr[ue[0]],Se=mr[ue[1]])}else{if("wrapS"in Ut){var Ge=Ut.wrapS;me.parameter(Ge,mr),Hi=mr[Ge]}if("wrapT"in Ut){var lt=Ut.wrapT;me.parameter(lt,mr),Se=mr[lt]}}if(Te.wrapS=Hi,Te.wrapT=Se,"anisotropic"in Ut){var Lt=Ut.anisotropic;me(typeof Lt=="number"&&Lt>=1&&Lt<=Be.maxAnisotropic,"aniso samples must be between 1 and "),Te.anisotropic=Ut.anisotropic}if("mipmap"in Ut){var Ke=!1;switch(typeof Ut.mipmap){case"string":me.parameter(Ut.mipmap,hr,"invalid mipmap hint"),Te.mipmapHint=hr[Ut.mipmap],Te.genMipmaps=!0,Ke=!0;break;case"boolean":Ke=Te.genMipmaps=Ut.mipmap;break;case"object":me(Array.isArray(Ut.mipmap),"invalid mipmap type"),Te.genMipmaps=!1,Ke=!0;break;default:me.raise("invalid mipmap type")}Ke&&!("min"in Ut)&&(Te.minFilter=Uu)}}function wo(Te,Ut){B.texParameteri(Ut,Va,Te.minFilter),B.texParameteri(Ut,fc,Te.magFilter),B.texParameteri(Ut,Vf,Te.wrapS),B.texParameteri(Ut,Eh,Te.wrapT),ge.ext_texture_filter_anisotropic&&B.texParameteri(Ut,lo,Te.anisotropic),Te.genMipmaps&&(B.hint(Bc,Te.mipmapHint),B.generateMipmap(Ut))}var Wo=0,Xo={},bs=Be.maxTextureUnits,io=Array(bs).map(function(){return null});function Si(Te){tr.call(this),this.mipmask=0,this.internalformat=Hs,this.id=Wo++,this.refCount=1,this.target=Te,this.texture=B.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new Ha,er.profile&&(this.stats={size:0})}function Yo(Te){B.activeTexture(ml),B.bindTexture(Te.target,Te.texture)}function ra(){var Te=io[0];Te?B.bindTexture(Te.target,Te.texture):B.bindTexture(ws,null)}function us(Te){var Ut=Te.texture;me(Ut,"must not double destroy texture");var St=Te.unit,mn=Te.target;St>=0&&(B.activeTexture(ml+St),B.bindTexture(mn,null),io[St]=null),B.deleteTexture(Ut),Te.texture=null,Te.params=null,Te.pixels=null,Te.refCount=0,delete Xo[Te.id],kt.textureCount--}m(Si.prototype,{bind:function(){var Te=this;Te.bindCount+=1;var Ut=Te.unit;if(Ut<0){for(var St=0;St<bs;++St){var mn=io[St];if(mn){if(mn.bindCount>0)continue;mn.unit=-1}io[St]=Te,Ut=St;break}Ut>=bs&&me.raise("insufficient number of texture units"),er.profile&&kt.maxTextureUnits<Ut+1&&(kt.maxTextureUnits=Ut+1),Te.unit=Ut,B.activeTexture(ml+Ut),B.bindTexture(Te.target,Te.texture)}return Ut},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&us(this)}});function oi(Te,Ut){var St=new Si(ws);Xo[St.id]=St,kt.textureCount++;function mn(ue,Ge){var lt=St.texInfo;Ha.call(lt);var Lt=Zi();return typeof ue=="number"?typeof Ge=="number"?ui(Lt,ue|0,Ge|0):ui(Lt,ue|0,ue|0):ue?(me.type(ue,"object","invalid arguments to regl.texture"),as(lt,ue),Ni(Lt,ue)):ui(Lt,1,1),lt.genMipmaps&&(Lt.mipmask=(Lt.width<<1)-1),St.mipmask=Lt.mipmask,ir(St,Lt),me.texture2D(lt,Lt,Be),St.internalformat=Lt.internalformat,mn.width=Lt.width,mn.height=Lt.height,Yo(St),Ga(Lt,ws),wo(lt,ws),ra(),ss(Lt),er.profile&&(St.stats.size=Xs(St.internalformat,St.type,Lt.width,Lt.height,lt.genMipmaps,!1)),mn.format=br[St.internalformat],mn.type=Br[St.type],mn.mag=cr[lt.magFilter],mn.min=or[lt.minFilter],mn.wrapS=zr[lt.wrapS],mn.wrapT=zr[lt.wrapT],mn}function Hi(ue,Ge,lt,Lt){me(!!ue,"must specify image data");var Ke=Ge|0,Fe=lt|0,nt=Lt|0,xe=jr();return ir(xe,St),xe.width=0,xe.height=0,Hr(xe,ue),xe.width=xe.width||(St.width>>nt)-Ke,xe.height=xe.height||(St.height>>nt)-Fe,me(St.type===xe.type&&St.format===xe.format&&St.internalformat===xe.internalformat,"incompatible format for texture.subimage"),me(Ke>=0&&Fe>=0&&Ke+xe.width<=St.width&&Fe+xe.height<=St.height,"texture.subimage write out of bounds"),me(St.mipmask&1<<nt,"missing mipmap data"),me(xe.data||xe.element||xe.needsCopy,"missing image data"),Yo(St),Ei(xe,ws,Ke,Fe,nt),ra(),en(xe),mn}function Se(ue,Ge){var lt=ue|0,Lt=Ge|0||lt;if(lt===St.width&&Lt===St.height)return mn;mn.width=St.width=lt,mn.height=St.height=Lt,Yo(St);for(var Ke=0;St.mipmask>>Ke;++Ke){var Fe=lt>>Ke,nt=Lt>>Ke;if(!Fe||!nt)break;B.texImage2D(ws,Ke,St.format,Fe,nt,0,St.format,St.type,null)}return ra(),er.profile&&(St.stats.size=Xs(St.internalformat,St.type,lt,Lt,!1,!1)),mn}return mn(Te,Ut),mn.subimage=Hi,mn.resize=Se,mn._reglType="texture2d",mn._texture=St,er.profile&&(mn.stats=St.stats),mn.destroy=function(){St.decRef()},mn}function zi(Te,Ut,St,mn,Hi,Se){var ue=new Si(sf);Xo[ue.id]=ue,kt.cubeCount++;var Ge=new Array(6);function lt(Fe,nt,xe,Ze,Ae,ct){var Ct,fr=ue.texInfo;for(Ha.call(fr),Ct=0;Ct<6;++Ct)Ge[Ct]=Zi();if(typeof Fe=="number"||!Fe){var Ur=Fe|0||1;for(Ct=0;Ct<6;++Ct)ui(Ge[Ct],Ur,Ur)}else if(typeof Fe=="object")if(nt)Ni(Ge[0],Fe),Ni(Ge[1],nt),Ni(Ge[2],xe),Ni(Ge[3],Ze),Ni(Ge[4],Ae),Ni(Ge[5],ct);else if(as(fr,Fe),Sn(ue,Fe),"faces"in Fe){var Vr=Fe.faces;for(me(Array.isArray(Vr)&&Vr.length===6,"cube faces must be a length 6 array"),Ct=0;Ct<6;++Ct)me(typeof Vr[Ct]=="object"&&!!Vr[Ct],"invalid input for cube map face"),ir(Ge[Ct],ue),Ni(Ge[Ct],Vr[Ct])}else for(Ct=0;Ct<6;++Ct)Ni(Ge[Ct],Fe);else me.raise("invalid arguments to cube map");for(ir(ue,Ge[0]),me.optional(function(){Be.npotTextureCube||me(Bf(ue.width)&&Bf(ue.height),"your browser does not support non power or two texture dimensions")}),fr.genMipmaps?ue.mipmask=(Ge[0].width<<1)-1:ue.mipmask=Ge[0].mipmask,me.textureCube(ue,fr,Ge,Be),ue.internalformat=Ge[0].internalformat,lt.width=Ge[0].width,lt.height=Ge[0].height,Yo(ue),Ct=0;Ct<6;++Ct)Ga(Ge[Ct],su+Ct);for(wo(fr,sf),ra(),er.profile&&(ue.stats.size=Xs(ue.internalformat,ue.type,lt.width,lt.height,fr.genMipmaps,!0)),lt.format=br[ue.internalformat],lt.type=Br[ue.type],lt.mag=cr[fr.magFilter],lt.min=or[fr.minFilter],lt.wrapS=zr[fr.wrapS],lt.wrapT=zr[fr.wrapT],Ct=0;Ct<6;++Ct)ss(Ge[Ct]);return lt}function Lt(Fe,nt,xe,Ze,Ae){me(!!nt,"must specify image data"),me(typeof Fe=="number"&&Fe===(Fe|0)&&Fe>=0&&Fe<6,"invalid face");var ct=xe|0,Ct=Ze|0,fr=Ae|0,Ur=jr();return ir(Ur,ue),Ur.width=0,Ur.height=0,Hr(Ur,nt),Ur.width=Ur.width||(ue.width>>fr)-ct,Ur.height=Ur.height||(ue.height>>fr)-Ct,me(ue.type===Ur.type&&ue.format===Ur.format&&ue.internalformat===Ur.internalformat,"incompatible format for texture.subimage"),me(ct>=0&&Ct>=0&&ct+Ur.width<=ue.width&&Ct+Ur.height<=ue.height,"texture.subimage write out of bounds"),me(ue.mipmask&1<<fr,"missing mipmap data"),me(Ur.data||Ur.element||Ur.needsCopy,"missing image data"),Yo(ue),Ei(Ur,su+Fe,ct,Ct,fr),ra(),en(Ur),lt}function Ke(Fe){var nt=Fe|0;if(nt!==ue.width){lt.width=ue.width=nt,lt.height=ue.height=nt,Yo(ue);for(var xe=0;xe<6;++xe)for(var Ze=0;ue.mipmask>>Ze;++Ze)B.texImage2D(su+xe,Ze,ue.format,nt>>Ze,nt>>Ze,0,ue.format,ue.type,null);return ra(),er.profile&&(ue.stats.size=Xs(ue.internalformat,ue.type,lt.width,lt.height,!1,!0)),lt}}return lt(Te,Ut,St,mn,Hi,Se),lt.subimage=Lt,lt.resize=Ke,lt._reglType="textureCube",lt._texture=ue,er.profile&&(lt.stats=ue.stats),lt.destroy=function(){ue.decRef()},lt}function ua(){for(var Te=0;Te<bs;++Te)B.activeTexture(ml+Te),B.bindTexture(ws,null),io[Te]=null;ie(Xo).forEach(us),kt.cubeCount=0,kt.textureCount=0}er.profile&&(kt.getTotalTextureSize=function(){var Te=0;return Object.keys(Xo).forEach(function(Ut){Te+=Xo[Ut].stats.size}),Te});function To(){for(var Te=0;Te<bs;++Te){var Ut=io[Te];Ut&&(Ut.bindCount=0,Ut.unit=-1,io[Te]=null)}ie(Xo).forEach(function(St){St.texture=B.createTexture(),B.bindTexture(St.target,St.texture);for(var mn=0;mn<32;++mn)if((St.mipmask&1<<mn)!=0)if(St.target===ws)B.texImage2D(ws,mn,St.internalformat,St.width>>mn,St.height>>mn,0,St.internalformat,St.type,null);else for(var Hi=0;Hi<6;++Hi)B.texImage2D(su+Hi,mn,St.internalformat,St.width>>mn,St.height>>mn,0,St.internalformat,St.type,null);wo(St.texInfo,St.target)})}function wl(){for(var Te=0;Te<bs;++Te){var Ut=io[Te];Ut&&(Ut.bindCount=0,Ut.unit=-1,io[Te]=null),B.activeTexture(ml+Te),B.bindTexture(ws,null),B.bindTexture(sf,null)}}return{create2D:oi,createCube:zi,clear:ua,getTexture:function(Te){return null},restore:To,refresh:wl}}var Mu=36161,Rn=32854,Cn=32855,df=36194,ys=33189,lu=36168,ns=34041,Go=35907,Wf=34836,vf=34842,ha=34843,Na=[];Na[Rn]=2,Na[Cn]=2,Na[df]=2,Na[ys]=2,Na[lu]=1,Na[ns]=4,Na[Go]=4,Na[Wf]=16,Na[vf]=8,Na[ha]=6;function dc(B,ge,Be){return Na[B]*ge*Be}var yl=function(B,ge,Be,Dt,sr){var kt={rgba4:Rn,rgb565:df,"rgb5 a1":Cn,depth:ys,stencil:lu,"depth stencil":ns};ge.ext_srgb&&(kt.srgba=Go),ge.ext_color_buffer_half_float&&(kt.rgba16f=vf,kt.rgb16f=ha),ge.webgl_color_buffer_float&&(kt.rgba32f=Wf);var er=[];Object.keys(kt).forEach(function(_r){var Mr=kt[_r];er[Mr]=_r});var hr=0,mr={};function xr(_r){this.id=hr++,this.refCount=1,this.renderbuffer=_r,this.format=Rn,this.width=0,this.height=0,sr.profile&&(this.stats={size:0})}xr.prototype.decRef=function(){--this.refCount<=0&&Tr(this)};function Tr(_r){var Mr=_r.renderbuffer;me(Mr,"must not double destroy renderbuffer"),B.bindRenderbuffer(Mu,null),B.deleteRenderbuffer(Mr),_r.renderbuffer=null,_r.refCount=0,delete mr[_r.id],Dt.renderbufferCount--}function Rr(_r,Mr){var ut=new xr(B.createRenderbuffer());mr[ut.id]=ut,Dt.renderbufferCount++;function Gt(Br,cr){var or=0,zr=0,Un=Rn;if(typeof Br=="object"&&Br){var tr=Br;if("shape"in tr){var ir=tr.shape;me(Array.isArray(ir)&&ir.length>=2,"invalid renderbuffer shape"),or=ir[0]|0,zr=ir[1]|0}else"radius"in tr&&(or=zr=tr.radius|0),"width"in tr&&(or=tr.width|0),"height"in tr&&(zr=tr.height|0);"format"in tr&&(me.parameter(tr.format,kt,"invalid renderbuffer format"),Un=kt[tr.format])}else typeof Br=="number"?(or=Br|0,typeof cr=="number"?zr=cr|0:zr=or):Br?me.raise("invalid arguments to renderbuffer constructor"):or=zr=1;if(me(or>0&&zr>0&&or<=Be.maxRenderbufferSize&&zr<=Be.maxRenderbufferSize,"invalid renderbuffer size"),!(or===ut.width&&zr===ut.height&&Un===ut.format))return Gt.width=ut.width=or,Gt.height=ut.height=zr,ut.format=Un,B.bindRenderbuffer(Mu,ut.renderbuffer),B.renderbufferStorage(Mu,Un,or,zr),me(B.getError()===0,"invalid render buffer format"),sr.profile&&(ut.stats.size=dc(ut.format,ut.width,ut.height)),Gt.format=er[ut.format],Gt}function br(Br,cr){var or=Br|0,zr=cr|0||or;return or===ut.width&&zr===ut.height||(me(or>0&&zr>0&&or<=Be.maxRenderbufferSize&&zr<=Be.maxRenderbufferSize,"invalid renderbuffer size"),Gt.width=ut.width=or,Gt.height=ut.height=zr,B.bindRenderbuffer(Mu,ut.renderbuffer),B.renderbufferStorage(Mu,ut.format,or,zr),me(B.getError()===0,"invalid render buffer format"),sr.profile&&(ut.stats.size=dc(ut.format,ut.width,ut.height))),Gt}return Gt(_r,Mr),Gt.resize=br,Gt._reglType="renderbuffer",Gt._renderbuffer=ut,sr.profile&&(Gt.stats=ut.stats),Gt.destroy=function(){ut.decRef()},Gt}sr.profile&&(Dt.getTotalRenderbufferSize=function(){var _r=0;return Object.keys(mr).forEach(function(Mr){_r+=mr[Mr].stats.size}),_r});function Gr(){ie(mr).forEach(function(_r){_r.renderbuffer=B.createRenderbuffer(),B.bindRenderbuffer(Mu,_r.renderbuffer),B.renderbufferStorage(Mu,_r.format,_r.width,_r.height)}),B.bindRenderbuffer(Mu,null)}return{create:Rr,clear:function(){ie(mr).forEach(Tr)},restore:Gr}},Pu=36160,cu=36161,Fo=3553,il=34069,fu=36064,mf=36096,Nl=36128,jc=33306,gf=36053,Iu=36054,vc=36055,Vc=36057,al=36061,Ji=36193,ol=5121,hu=5126,Ts=6407,zl=6408,_l=6402,yf=[Ts,zl],Pa=[];Pa[zl]=4,Pa[Ts]=3;var l=[];l[ol]=1,l[hu]=4,l[Ji]=2;var h=32854,c=32855,d=36194,E=33189,w=36168,P=34041,L=35907,N=34836,q=34842,ce=34843,he=[h,c,d,L,q,ce,N],de={};de[gf]="complete",de[Iu]="incomplete attachment",de[Vc]="incomplete dimensions",de[vc]="incomplete, missing attachment",de[al]="unsupported";function Re(B,ge,Be,Dt,sr,kt){var er={cur:null,next:null,dirty:!1,setFBO:null},hr=["rgba"],mr=["rgba4","rgb565","rgb5 a1"];ge.ext_srgb&&mr.push("srgba"),ge.ext_color_buffer_half_float&&mr.push("rgba16f","rgb16f"),ge.webgl_color_buffer_float&&mr.push("rgba32f");var xr=["uint8"];ge.oes_texture_half_float&&xr.push("half float","float16"),ge.oes_texture_float&&xr.push("float","float32");function Tr(Sr,Hr,Jr){this.target=Sr,this.texture=Hr,this.renderbuffer=Jr;var Ei=0,Gn=0;Hr?(Ei=Hr.width,Gn=Hr.height):Jr&&(Ei=Jr.width,Gn=Jr.height),this.width=Ei,this.height=Gn}function Rr(Sr){Sr&&(Sr.texture&&Sr.texture._texture.decRef(),Sr.renderbuffer&&Sr.renderbuffer._renderbuffer.decRef())}function Gr(Sr,Hr,Jr){if(!!Sr)if(Sr.texture){var Ei=Sr.texture._texture,Gn=Math.max(1,Ei.width),jr=Math.max(1,Ei.height);me(Gn===Hr&&jr===Jr,"inconsistent width/height for supplied texture"),Ei.refCount+=1}else{var en=Sr.renderbuffer._renderbuffer;me(en.width===Hr&&en.height===Jr,"inconsistent width/height for renderbuffer"),en.refCount+=1}}function _r(Sr,Hr){Hr&&(Hr.texture?B.framebufferTexture2D(Pu,Sr,Hr.target,Hr.texture._texture.texture,0):B.framebufferRenderbuffer(Pu,Sr,cu,Hr.renderbuffer._renderbuffer.renderbuffer))}function Mr(Sr){var Hr=Fo,Jr=null,Ei=null,Gn=Sr;typeof Sr=="object"&&(Gn=Sr.data,"target"in Sr&&(Hr=Sr.target|0)),me.type(Gn,"function","invalid attachment data");var jr=Gn._reglType;return jr==="texture2d"?(Jr=Gn,me(Hr===Fo)):jr==="textureCube"?(Jr=Gn,me(Hr>=il&&Hr<il+6,"invalid cube map target")):jr==="renderbuffer"?(Ei=Gn,Hr=cu):me.raise("invalid regl object for attachment"),new Tr(Hr,Jr,Ei)}function ut(Sr,Hr,Jr,Ei,Gn){if(Jr){var jr=Dt.create2D({width:Sr,height:Hr,format:Ei,type:Gn});return jr._texture.refCount=0,new Tr(Fo,jr,null)}else{var en=sr.create({width:Sr,height:Hr,format:Ei});return en._renderbuffer.refCount=0,new Tr(cu,null,en)}}function Gt(Sr){return Sr&&(Sr.texture||Sr.renderbuffer)}function br(Sr,Hr,Jr){Sr&&(Sr.texture?Sr.texture.resize(Hr,Jr):Sr.renderbuffer&&Sr.renderbuffer.resize(Hr,Jr),Sr.width=Hr,Sr.height=Jr)}var Br=0,cr={};function or(){this.id=Br++,cr[this.id]=this,this.framebuffer=B.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function zr(Sr){Sr.colorAttachments.forEach(Rr),Rr(Sr.depthAttachment),Rr(Sr.stencilAttachment),Rr(Sr.depthStencilAttachment)}function Un(Sr){var Hr=Sr.framebuffer;me(Hr,"must not double destroy framebuffer"),B.deleteFramebuffer(Hr),Sr.framebuffer=null,kt.framebufferCount--,delete cr[Sr.id]}function tr(Sr){var Hr;B.bindFramebuffer(Pu,Sr.framebuffer);var Jr=Sr.colorAttachments;for(Hr=0;Hr<Jr.length;++Hr)_r(fu+Hr,Jr[Hr]);for(Hr=Jr.length;Hr<Be.maxColorAttachments;++Hr)B.framebufferTexture2D(Pu,fu+Hr,Fo,null,0);B.framebufferTexture2D(Pu,jc,Fo,null,0),B.framebufferTexture2D(Pu,mf,Fo,null,0),B.framebufferTexture2D(Pu,Nl,Fo,null,0),_r(mf,Sr.depthAttachment),_r(Nl,Sr.stencilAttachment),_r(jc,Sr.depthStencilAttachment);var Ei=B.checkFramebufferStatus(Pu);!B.isContextLost()&&Ei!==gf&&me.raise("framebuffer configuration not supported, status = "+de[Ei]),B.bindFramebuffer(Pu,er.next?er.next.framebuffer:null),er.cur=er.next,B.getError()}function ir(Sr,Hr){var Jr=new or;kt.framebufferCount++;function Ei(jr,en){var ni;me(er.next!==Jr,"can not update framebuffer which is currently in use");var ui=0,Ni=0,Ga=!0,no=!0,Zi=null,ss=!0,Ha="rgba",as="uint8",wo=1,Wo=null,Xo=null,bs=null,io=!1;if(typeof jr=="number")ui=jr|0,Ni=en|0||ui;else if(!jr)ui=Ni=1;else{me.type(jr,"object","invalid arguments for framebuffer");var Si=jr;if("shape"in Si){var Yo=Si.shape;me(Array.isArray(Yo)&&Yo.length>=2,"invalid shape for framebuffer"),ui=Yo[0],Ni=Yo[1]}else"radius"in Si&&(ui=Ni=Si.radius),"width"in Si&&(ui=Si.width),"height"in Si&&(Ni=Si.height);("color"in Si||"colors"in Si)&&(Zi=Si.color||Si.colors,Array.isArray(Zi)&&me(Zi.length===1||ge.webgl_draw_buffers,"multiple render targets not supported")),Zi||("colorCount"in Si&&(wo=Si.colorCount|0,me(wo>0,"invalid color buffer count")),"colorTexture"in Si&&(ss=!!Si.colorTexture,Ha="rgba4"),"colorType"in Si&&(as=Si.colorType,ss?(me(ge.oes_texture_float||!(as==="float"||as==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),me(ge.oes_texture_half_float||!(as==="half float"||as==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):as==="half float"||as==="float16"?(me(ge.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),Ha="rgba16f"):(as==="float"||as==="float32")&&(me(ge.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),Ha="rgba32f"),me.oneOf(as,xr,"invalid color type")),"colorFormat"in Si&&(Ha=Si.colorFormat,hr.indexOf(Ha)>=0?ss=!0:mr.indexOf(Ha)>=0?ss=!1:me.optional(function(){ss?me.oneOf(Si.colorFormat,hr,"invalid color format for texture"):me.oneOf(Si.colorFormat,mr,"invalid color format for renderbuffer")}))),("depthTexture"in Si||"depthStencilTexture"in Si)&&(io=!!(Si.depthTexture||Si.depthStencilTexture),me(!io||ge.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in Si&&(typeof Si.depth=="boolean"?Ga=Si.depth:(Wo=Si.depth,no=!1)),"stencil"in Si&&(typeof Si.stencil=="boolean"?no=Si.stencil:(Xo=Si.stencil,Ga=!1)),"depthStencil"in Si&&(typeof Si.depthStencil=="boolean"?Ga=no=Si.depthStencil:(bs=Si.depthStencil,Ga=!1,no=!1))}var ra=null,us=null,oi=null,zi=null;if(Array.isArray(Zi))ra=Zi.map(Mr);else if(Zi)ra=[Mr(Zi)];else for(ra=new Array(wo),ni=0;ni<wo;++ni)ra[ni]=ut(ui,Ni,ss,Ha,as);me(ge.webgl_draw_buffers||ra.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),me(ra.length<=Be.maxColorAttachments,"too many color attachments, not supported"),ui=ui||ra[0].width,Ni=Ni||ra[0].height,Wo?us=Mr(Wo):Ga&&!no&&(us=ut(ui,Ni,io,"depth","uint32")),Xo?oi=Mr(Xo):no&&!Ga&&(oi=ut(ui,Ni,!1,"stencil","uint8")),bs?zi=Mr(bs):!Wo&&!Xo&&no&&Ga&&(zi=ut(ui,Ni,io,"depth stencil","depth stencil")),me(!!Wo+!!Xo+!!bs<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var ua=null;for(ni=0;ni<ra.length;++ni)if(Gr(ra[ni],ui,Ni),me(!ra[ni]||ra[ni].texture&&yf.indexOf(ra[ni].texture._texture.format)>=0||ra[ni].renderbuffer&&he.indexOf(ra[ni].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+ni+" is invalid"),ra[ni]&&ra[ni].texture){var To=Pa[ra[ni].texture._texture.format]*l[ra[ni].texture._texture.type];ua===null?ua=To:me(ua===To,"all color attachments much have the same number of bits per pixel.")}return Gr(us,ui,Ni),me(!us||us.texture&&us.texture._texture.format===_l||us.renderbuffer&&us.renderbuffer._renderbuffer.format===E,"invalid depth attachment for framebuffer object"),Gr(oi,ui,Ni),me(!oi||oi.renderbuffer&&oi.renderbuffer._renderbuffer.format===w,"invalid stencil attachment for framebuffer object"),Gr(zi,ui,Ni),me(!zi||zi.texture&&zi.texture._texture.format===P||zi.renderbuffer&&zi.renderbuffer._renderbuffer.format===P,"invalid depth-stencil attachment for framebuffer object"),zr(Jr),Jr.width=ui,Jr.height=Ni,Jr.colorAttachments=ra,Jr.depthAttachment=us,Jr.stencilAttachment=oi,Jr.depthStencilAttachment=zi,Ei.color=ra.map(Gt),Ei.depth=Gt(us),Ei.stencil=Gt(oi),Ei.depthStencil=Gt(zi),Ei.width=Jr.width,Ei.height=Jr.height,tr(Jr),Ei}function Gn(jr,en){me(er.next!==Jr,"can not resize a framebuffer which is currently in use");var ni=Math.max(jr|0,1),ui=Math.max(en|0||ni,1);if(ni===Jr.width&&ui===Jr.height)return Ei;for(var Ni=Jr.colorAttachments,Ga=0;Ga<Ni.length;++Ga)br(Ni[Ga],ni,ui);return br(Jr.depthAttachment,ni,ui),br(Jr.stencilAttachment,ni,ui),br(Jr.depthStencilAttachment,ni,ui),Jr.width=Ei.width=ni,Jr.height=Ei.height=ui,tr(Jr),Ei}return Ei(Sr,Hr),m(Ei,{resize:Gn,_reglType:"framebuffer",_framebuffer:Jr,destroy:function(){Un(Jr),zr(Jr)},use:function(jr){er.setFBO({framebuffer:Ei},jr)}})}function Sn(Sr){var Hr=Array(6);function Jr(Gn){var jr;me(Hr.indexOf(er.next)<0,"can not update framebuffer which is currently in use");var en={color:null},ni=0,ui=null,Ni="rgba",Ga="uint8",no=1;if(typeof Gn=="number")ni=Gn|0;else if(!Gn)ni=1;else{me.type(Gn,"object","invalid arguments for framebuffer");var Zi=Gn;if("shape"in Zi){var ss=Zi.shape;me(Array.isArray(ss)&&ss.length>=2,"invalid shape for framebuffer"),me(ss[0]===ss[1],"cube framebuffer must be square"),ni=ss[0]}else"radius"in Zi&&(ni=Zi.radius|0),"width"in Zi?(ni=Zi.width|0,"height"in Zi&&me(Zi.height===ni,"must be square")):"height"in Zi&&(ni=Zi.height|0);("color"in Zi||"colors"in Zi)&&(ui=Zi.color||Zi.colors,Array.isArray(ui)&&me(ui.length===1||ge.webgl_draw_buffers,"multiple render targets not supported")),ui||("colorCount"in Zi&&(no=Zi.colorCount|0,me(no>0,"invalid color buffer count")),"colorType"in Zi&&(me.oneOf(Zi.colorType,xr,"invalid color type"),Ga=Zi.colorType),"colorFormat"in Zi&&(Ni=Zi.colorFormat,me.oneOf(Zi.colorFormat,hr,"invalid color format for texture"))),"depth"in Zi&&(en.depth=Zi.depth),"stencil"in Zi&&(en.stencil=Zi.stencil),"depthStencil"in Zi&&(en.depthStencil=Zi.depthStencil)}var Ha;if(ui)if(Array.isArray(ui))for(Ha=[],jr=0;jr<ui.length;++jr)Ha[jr]=ui[jr];else Ha=[ui];else{Ha=Array(no);var as={radius:ni,format:Ni,type:Ga};for(jr=0;jr<no;++jr)Ha[jr]=Dt.createCube(as)}for(en.color=Array(Ha.length),jr=0;jr<Ha.length;++jr){var wo=Ha[jr];me(typeof wo=="function"&&wo._reglType==="textureCube","invalid cube map"),ni=ni||wo.width,me(wo.width===ni&&wo.height===ni,"invalid cube map shape"),en.color[jr]={target:il,data:Ha[jr]}}for(jr=0;jr<6;++jr){for(var Wo=0;Wo<Ha.length;++Wo)en.color[Wo].target=il+jr;jr>0&&(en.depth=Hr[0].depth,en.stencil=Hr[0].stencil,en.depthStencil=Hr[0].depthStencil),Hr[jr]?Hr[jr](en):Hr[jr]=ir(en)}return m(Jr,{width:ni,height:ni,color:Ha})}function Ei(Gn){var jr,en=Gn|0;if(me(en>0&&en<=Be.maxCubeMapSize,"invalid radius for cube fbo"),en===Jr.width)return Jr;var ni=Jr.color;for(jr=0;jr<ni.length;++jr)ni[jr].resize(en);for(jr=0;jr<6;++jr)Hr[jr].resize(en);return Jr.width=Jr.height=en,Jr}return Jr(Sr),m(Jr,{faces:Hr,resize:Ei,_reglType:"framebufferCube",destroy:function(){Hr.forEach(function(Gn){Gn.destroy()})}})}function Xr(){er.cur=null,er.next=null,er.dirty=!0,ie(cr).forEach(function(Sr){Sr.framebuffer=B.createFramebuffer(),tr(Sr)})}return m(er,{getFramebuffer:function(Sr){if(typeof Sr=="function"&&Sr._reglType==="framebuffer"){var Hr=Sr._framebuffer;if(Hr instanceof or)return Hr}return null},create:ir,createCube:Sn,clear:function(){ie(cr).forEach(Un)},restore:Xr})}var Ie=5126,We=34962,we=34963,Ve=["attributes","elements","offset","count","primitive","instances"];function tt(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=Ie,this.offset=0,this.stride=0,this.divisor=0}function yt(B,ge,Be,Dt,sr,kt,er){for(var hr=Be.maxAttributes,mr=new Array(hr),xr=0;xr<hr;++xr)mr[xr]=new tt;var Tr=0,Rr={},Gr={Record:tt,scope:{},state:mr,currentVAO:null,targetVAO:null,restore:Mr()?zr:function(){},createVAO:Un,getVAO:Gt,destroyBuffer:_r,setVAO:Mr()?br:Br,clear:Mr()?cr:function(){}};function _r(tr){for(var ir=0;ir<mr.length;++ir){var Sn=mr[ir];Sn.buffer===tr&&(B.disableVertexAttribArray(ir),Sn.buffer=null)}}function Mr(){return ge.oes_vertex_array_object}function ut(){return ge.angle_instanced_arrays}function Gt(tr){return typeof tr=="function"&&tr._vao?tr._vao:null}function br(tr){if(tr!==Gr.currentVAO){var ir=Mr();tr?ir.bindVertexArrayOES(tr.vao):ir.bindVertexArrayOES(null),Gr.currentVAO=tr}}function Br(tr){if(tr!==Gr.currentVAO){if(tr)tr.bindAttrs();else{for(var ir=ut(),Sn=0;Sn<mr.length;++Sn){var Xr=mr[Sn];Xr.buffer?(B.enableVertexAttribArray(Sn),Xr.buffer.bind(),B.vertexAttribPointer(Sn,Xr.size,Xr.type,Xr.normalized,Xr.stride,Xr.offfset),ir&&Xr.divisor&&ir.vertexAttribDivisorANGLE(Sn,Xr.divisor)):(B.disableVertexAttribArray(Sn),B.vertexAttrib4f(Sn,Xr.x,Xr.y,Xr.z,Xr.w))}er.elements?B.bindBuffer(we,er.elements.buffer.buffer):B.bindBuffer(we,null)}Gr.currentVAO=tr}}function cr(){ie(Rr).forEach(function(tr){tr.destroy()})}function or(){this.id=++Tr,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var tr=Mr();tr?this.vao=tr.createVertexArrayOES():this.vao=null,Rr[this.id]=this,this.buffers=[]}or.prototype.bindAttrs=function(){for(var tr=ut(),ir=this.attributes,Sn=0;Sn<ir.length;++Sn){var Xr=ir[Sn];Xr.buffer?(B.enableVertexAttribArray(Sn),B.bindBuffer(We,Xr.buffer.buffer),B.vertexAttribPointer(Sn,Xr.size,Xr.type,Xr.normalized,Xr.stride,Xr.offset),tr&&Xr.divisor&&tr.vertexAttribDivisorANGLE(Sn,Xr.divisor)):(B.disableVertexAttribArray(Sn),B.vertexAttrib4f(Sn,Xr.x,Xr.y,Xr.z,Xr.w))}for(var Sr=ir.length;Sr<hr;++Sr)B.disableVertexAttribArray(Sr);var Hr=kt.getElements(this.elements);Hr?B.bindBuffer(we,Hr.buffer.buffer):B.bindBuffer(we,null)},or.prototype.refresh=function(){var tr=Mr();tr&&(tr.bindVertexArrayOES(this.vao),this.bindAttrs(),Gr.currentVAO=null,tr.bindVertexArrayOES(null))},or.prototype.destroy=function(){if(this.vao){var tr=Mr();this===Gr.currentVAO&&(Gr.currentVAO=null,tr.bindVertexArrayOES(null)),tr.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),Rr[this.id]&&(delete Rr[this.id],Dt.vaoCount-=1)};function zr(){var tr=Mr();tr&&ie(Rr).forEach(function(ir){ir.refresh()})}function Un(tr){var ir=new or;Dt.vaoCount+=1;function Sn(Xr){var Sr;if(Array.isArray(Xr))Sr=Xr,ir.elements&&ir.ownsElements&&ir.elements.destroy(),ir.elements=null,ir.ownsElements=!1,ir.offset=0,ir.count=0,ir.instances=-1,ir.primitive=4;else{if(me(typeof Xr=="object","invalid arguments for create vao"),me("attributes"in Xr,"must specify attributes for vao"),Xr.elements){var Hr=Xr.elements;ir.ownsElements?typeof Hr=="function"&&Hr._reglType==="elements"?(ir.elements.destroy(),ir.ownsElements=!1):(ir.elements(Hr),ir.ownsElements=!1):kt.getElements(Xr.elements)?(ir.elements=Xr.elements,ir.ownsElements=!1):(ir.elements=kt.create(Xr.elements),ir.ownsElements=!0)}else ir.elements=null,ir.ownsElements=!1;Sr=Xr.attributes,ir.offset=0,ir.count=-1,ir.instances=-1,ir.primitive=4,ir.elements&&(ir.count=ir.elements._elements.vertCount,ir.primitive=ir.elements._elements.primType),"offset"in Xr&&(ir.offset=Xr.offset|0),"count"in Xr&&(ir.count=Xr.count|0),"instances"in Xr&&(ir.instances=Xr.instances|0),"primitive"in Xr&&(me(Xr.primitive in ur,"bad primitive type: "+Xr.primitive),ir.primitive=ur[Xr.primitive]),me.optional(function(){for(var Ga=Object.keys(Xr),no=0;no<Ga.length;++no)me(Ve.indexOf(Ga[no])>=0,'invalid option for vao: "'+Ga[no]+'" valid options are '+Ve)}),me(Array.isArray(Sr),"attributes must be an array")}me(Sr.length<hr,"too many attributes"),me(Sr.length>0,"must specify at least one attribute");var Jr={},Ei=ir.attributes;Ei.length=Sr.length;for(var Gn=0;Gn<Sr.length;++Gn){var jr=Sr[Gn],en=Ei[Gn]=new tt,ni=jr.data||jr;if(Array.isArray(ni)||re(ni)||os(ni)){var ui;ir.buffers[Gn]&&(ui=ir.buffers[Gn],re(ni)&&ui._buffer.byteLength>=ni.byteLength?ui.subdata(ni):(ui.destroy(),ir.buffers[Gn]=null)),ir.buffers[Gn]||(ui=ir.buffers[Gn]=sr.create(jr,We,!1,!0)),en.buffer=sr.getBuffer(ui),en.size=en.buffer.dimension|0,en.normalized=!1,en.type=en.buffer.dtype,en.offset=0,en.stride=0,en.divisor=0,en.state=1,Jr[Gn]=1}else sr.getBuffer(jr)?(en.buffer=sr.getBuffer(jr),en.size=en.buffer.dimension|0,en.normalized=!1,en.type=en.buffer.dtype,en.offset=0,en.stride=0,en.divisor=0,en.state=1):sr.getBuffer(jr.buffer)?(en.buffer=sr.getBuffer(jr.buffer),en.size=(+jr.size||en.buffer.dimension)|0,en.normalized=!!jr.normalized||!1,"type"in jr?(me.parameter(jr.type,ou,"invalid buffer type"),en.type=ou[jr.type]):en.type=en.buffer.dtype,en.offset=(jr.offset||0)|0,en.stride=(jr.stride||0)|0,en.divisor=(jr.divisor||0)|0,en.state=1,me(en.size>=1&&en.size<=4,"size must be between 1 and 4"),me(en.offset>=0,"invalid offset"),me(en.stride>=0&&en.stride<=255,"stride must be between 0 and 255"),me(en.divisor>=0,"divisor must be positive"),me(!en.divisor||!!ge.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in jr?(me(Gn>0,"first attribute must not be a constant"),en.x=+jr.x||0,en.y=+jr.y||0,en.z=+jr.z||0,en.w=+jr.w||0,en.state=2):me(!1,"invalid attribute spec for location "+Gn)}for(var Ni=0;Ni<ir.buffers.length;++Ni)!Jr[Ni]&&ir.buffers[Ni]&&(ir.buffers[Ni].destroy(),ir.buffers[Ni]=null);return ir.refresh(),Sn}return Sn.destroy=function(){for(var Xr=0;Xr<ir.buffers.length;++Xr)ir.buffers[Xr]&&ir.buffers[Xr].destroy();ir.buffers.length=0,ir.ownsElements&&(ir.elements.destroy(),ir.elements=null,ir.ownsElements=!1),ir.destroy()},Sn._vao=ir,Sn._reglType="vao",Sn(tr)}return Gr}var Wt=35632,jt=35633,Jt=35718,dr=35721;function Fr(B,ge,Be,Dt){var sr={},kt={};function er(ut,Gt,br,Br){this.name=ut,this.id=Gt,this.location=br,this.info=Br}function hr(ut,Gt){for(var br=0;br<ut.length;++br)if(ut[br].id===Gt.id){ut[br].location=Gt.location;return}ut.push(Gt)}function mr(ut,Gt,br){var Br=ut===Wt?sr:kt,cr=Br[Gt];if(!cr){var or=ge.str(Gt);cr=B.createShader(ut),B.shaderSource(cr,or),B.compileShader(cr),me.shaderError(B,cr,or,ut,br),Br[Gt]=cr}return cr}var xr={},Tr=[],Rr=0;function Gr(ut,Gt){this.id=Rr++,this.fragId=ut,this.vertId=Gt,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,Dt.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function _r(ut,Gt,br){var Br,cr,or=mr(Wt,ut.fragId),zr=mr(jt,ut.vertId),Un=ut.program=B.createProgram();if(B.attachShader(Un,or),B.attachShader(Un,zr),br)for(Br=0;Br<br.length;++Br){var tr=br[Br];B.bindAttribLocation(Un,tr[0],tr[1])}B.linkProgram(Un),me.linkError(B,Un,ge.str(ut.fragId),ge.str(ut.vertId),Gt);var ir=B.getProgramParameter(Un,Jt);Dt.profile&&(ut.stats.uniformsCount=ir);var Sn=ut.uniforms;for(Br=0;Br<ir;++Br)if(cr=B.getActiveUniform(Un,Br),cr)if(cr.size>1)for(var Xr=0;Xr<cr.size;++Xr){var Sr=cr.name.replace("[0]","["+Xr+"]");hr(Sn,new er(Sr,ge.id(Sr),B.getUniformLocation(Un,Sr),cr))}else hr(Sn,new er(cr.name,ge.id(cr.name),B.getUniformLocation(Un,cr.name),cr));var Hr=B.getProgramParameter(Un,dr);Dt.profile&&(ut.stats.attributesCount=Hr);var Jr=ut.attributes;for(Br=0;Br<Hr;++Br)cr=B.getActiveAttrib(Un,Br),cr&&hr(Jr,new er(cr.name,ge.id(cr.name),B.getAttribLocation(Un,cr.name),cr))}Dt.profile&&(Be.getMaxUniformsCount=function(){var ut=0;return Tr.forEach(function(Gt){Gt.stats.uniformsCount>ut&&(ut=Gt.stats.uniformsCount)}),ut},Be.getMaxAttributesCount=function(){var ut=0;return Tr.forEach(function(Gt){Gt.stats.attributesCount>ut&&(ut=Gt.stats.attributesCount)}),ut});function Mr(){sr={},kt={};for(var ut=0;ut<Tr.length;++ut)_r(Tr[ut],null,Tr[ut].attributes.map(function(Gt){return[Gt.location,Gt.name]}))}return{clear:function(){var ut=B.deleteShader.bind(B);ie(sr).forEach(ut),sr={},ie(kt).forEach(ut),kt={},Tr.forEach(function(Gt){B.deleteProgram(Gt.program)}),Tr.length=0,xr={},Be.shaderCount=0},program:function(ut,Gt,br,Br){me.command(ut>=0,"missing vertex shader",br),me.command(Gt>=0,"missing fragment shader",br);var cr=xr[Gt];cr||(cr=xr[Gt]={});var or=cr[ut];if(or&&(or.refCount++,!Br))return or;var zr=new Gr(Gt,ut);return Be.shaderCount++,_r(zr,br,Br),or||(cr[ut]=zr),Tr.push(zr),m(zr,{destroy:function(){if(zr.refCount--,zr.refCount<=0){B.deleteProgram(zr.program);var Un=Tr.indexOf(zr);Tr.splice(Un,1),Be.shaderCount--}cr[zr.vertId].refCount<=0&&(B.deleteShader(kt[zr.vertId]),delete kt[zr.vertId],delete xr[zr.fragId][zr.vertId]),Object.keys(xr[zr.fragId]).length||(B.deleteShader(sr[zr.fragId]),delete sr[zr.fragId],delete xr[zr.fragId])}})},restore:Mr,shader:mr,frag:-1,vert:-1}}var kr=6408,ln=5121,Nn=3333,zn=5126;function Mn(B,ge,Be,Dt,sr,kt,er){function hr(Tr){var Rr;ge.next===null?(me(sr.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),Rr=ln):(me(ge.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),Rr=ge.next.colorAttachments[0].texture._texture.type,me.optional(function(){kt.oes_texture_float?(me(Rr===ln||Rr===zn,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),Rr===zn&&me(er.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):me(Rr===ln,"Reading from a framebuffer is only allowed for the type 'uint8'")}));var Gr=0,_r=0,Mr=Dt.framebufferWidth,ut=Dt.framebufferHeight,Gt=null;re(Tr)?Gt=Tr:Tr&&(me.type(Tr,"object","invalid arguments to regl.read()"),Gr=Tr.x|0,_r=Tr.y|0,me(Gr>=0&&Gr<Dt.framebufferWidth,"invalid x offset for regl.read"),me(_r>=0&&_r<Dt.framebufferHeight,"invalid y offset for regl.read"),Mr=(Tr.width||Dt.framebufferWidth-Gr)|0,ut=(Tr.height||Dt.framebufferHeight-_r)|0,Gt=Tr.data||null),Gt&&(Rr===ln?me(Gt instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):Rr===zn&&me(Gt instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),me(Mr>0&&Mr+Gr<=Dt.framebufferWidth,"invalid width for read pixels"),me(ut>0&&ut+_r<=Dt.framebufferHeight,"invalid height for read pixels"),Be();var br=Mr*ut*4;return Gt||(Rr===ln?Gt=new Uint8Array(br):Rr===zn&&(Gt=Gt||new Float32Array(br))),me.isTypedArray(Gt,"data buffer for regl.read() must be a typedarray"),me(Gt.byteLength>=br,"data buffer for regl.read() too small"),B.pixelStorei(Nn,4),B.readPixels(Gr,_r,Mr,ut,kr,Rr,Gt),Gt}function mr(Tr){var Rr;return ge.setFBO({framebuffer:Tr.framebuffer},function(){Rr=hr(Tr)}),Rr}function xr(Tr){return!Tr||!("framebuffer"in Tr)?hr(Tr):mr(Tr)}return xr}function Bi(B){return Array.prototype.slice.call(B)}function Qr(B){return Bi(B).join("")}function li(){var B=0,ge=[],Be=[];function Dt(Rr){for(var Gr=0;Gr<Be.length;++Gr)if(Be[Gr]===Rr)return ge[Gr];var _r="g"+B++;return ge.push(_r),Be.push(Rr),_r}function sr(){var Rr=[];function Gr(){Rr.push.apply(Rr,Bi(arguments))}var _r=[];function Mr(){var ut="v"+B++;return _r.push(ut),arguments.length>0&&(Rr.push(ut,"="),Rr.push.apply(Rr,Bi(arguments)),Rr.push(";")),ut}return m(Gr,{def:Mr,toString:function(){return Qr([_r.length>0?"var "+_r.join(",")+";":"",Qr(Rr)])}})}function kt(){var Rr=sr(),Gr=sr(),_r=Rr.toString,Mr=Gr.toString;function ut(Gt,br){Gr(Gt,br,"=",Rr.def(Gt,br),";")}return m(function(){Rr.apply(Rr,Bi(arguments))},{def:Rr.def,entry:Rr,exit:Gr,save:ut,set:function(Gt,br,Br){ut(Gt,br),Rr(Gt,br,"=",Br,";")},toString:function(){return _r()+Mr()}})}function er(){var Rr=Qr(arguments),Gr=kt(),_r=kt(),Mr=Gr.toString,ut=_r.toString;return m(Gr,{then:function(){return Gr.apply(Gr,Bi(arguments)),this},else:function(){return _r.apply(_r,Bi(arguments)),this},toString:function(){var Gt=ut();return Gt&&(Gt="else{"+Gt+"}"),Qr(["if(",Rr,"){",Mr(),"}",Gt])}})}var hr=sr(),mr={};function xr(Rr,Gr){var _r=[];function Mr(){var cr="a"+_r.length;return _r.push(cr),cr}Gr=Gr||0;for(var ut=0;ut<Gr;++ut)Mr();var Gt=kt(),br=Gt.toString,Br=mr[Rr]=m(Gt,{arg:Mr,toString:function(){return Qr(["function(",_r.join(),"){",br(),"}"])}});return Br}function Tr(){var Rr=['"use strict";',hr,"return {"];Object.keys(mr).forEach(function(ut){Rr.push('"',ut,'":',mr[ut].toString(),",")}),Rr.push("}");var Gr=Qr(Rr).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),_r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Mr=_r?ae.Function.apply(null,ge.concat(Gr)):Function.apply(null,ge.concat(Gr));return Mr.apply(null,Be)}return{global:hr,link:Dt,block:sr,proc:xr,scope:kt,cond:er,compile:Tr}}var fi="xyzw".split(""),ii=5121,Xn=1,xi=2,ri=0,Kn=1,po=2,Ka=3,Ho=4,Bo=5,za=6,co="dither",Bs="blend.enable",_s="blend.color",Hu="blend.equation",xs="blend.func",pu="depth.enable",vo="depth.func",mc="depth.range",ru="depth.mask",Wu="colorMask",du="cull.enable",xl="cull.face",vu="frontFace",Ul="lineWidth",Ou="polygonOffset.enable",So="polygonOffset.offset",ka="sample.alpha",Ua="sample.enable",mu="sample.coverage",ta="stencil.enable",is="stencil.mask",Ms="stencil.func",bl="stencil.opFront",_f="stencil.opBack",xf="scissor.enable",Gc="scissor.box",mo="viewport",Hc="profile",Ru="framebuffer",Zl="vert",Xu="frag",nu="elements",go="primitive",gc="count",bf="offset",Wc="instances",yc="vao",Sh="Width",Ch="Height",El=Ru+Sh,Xc=Ru+Ch,Ah=mo+Sh,np=mo+Ch,Ps="drawingBuffer",Yc=Ps+Sh,zp=Ps+Ch,Td=[xs,Hu,Ms,bl,_f,mu,mo,Gc,So],Ef=34962,ip=34963,Md=35632,Pd=35633,wh=3553,ap=34067,Up=2884,qc=3042,Zp=3024,Co=2960,Th=2929,jp=3089,Mh=32823,Xf=32926,Yf=32928,Ph=5126,qf=35664,jl=35665,Sl=35666,Kf=5124,Ih=35667,_c=35668,Oh=35669,$f=35670,Qf=35671,Sf=35672,Kc=35673,Ns=35674,Jf=35675,eh=35676,th=35678,rh=35680,Rh=4,Cl=1028,Yu=1029,Vp=2304,Lh=2305,Gp=32775,Id=32776,Hp=519,gu=7680,Wp=0,kh=1,$c=32774,qu=513,Xp=36160,Od=36064,Al={"0":0,"1":1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Cf=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],Vl={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Qc={"0":0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},Wr={frag:Md,vert:Pd},op={cw:Vp,ccw:Lh};function Ht(B){return Array.isArray(B)||re(B)||os(B)}function sp(B){return B.sort(function(ge,Be){return ge===mo?-1:Be===mo?1:ge<Be?-1:1})}function va(B,ge,Be,Dt){this.thisDep=B,this.contextDep=ge,this.propDep=Be,this.append=Dt}function Gl(B){return B&&!(B.thisDep||B.contextDep||B.propDep)}function Ao(B){return new va(!1,!1,!1,B)}function Ys(B,ge){var Be=B.type;if(Be===ri){var Dt=B.data.length;return new va(!0,Dt>=1,Dt>=2,ge)}else if(Be===Ho){var sr=B.data;return new va(sr.thisDep,sr.contextDep,sr.propDep,ge)}else{if(Be===Bo)return new va(!1,!1,!1,ge);if(Be===za){for(var kt=!1,er=!1,hr=!1,mr=0;mr<B.data.length;++mr){var xr=B.data[mr];if(xr.type===Kn)hr=!0;else if(xr.type===po)er=!0;else if(xr.type===Ka)kt=!0;else if(xr.type===ri){kt=!0;var Tr=xr.data;Tr>=1&&(er=!0),Tr>=2&&(hr=!0)}else xr.type===Ho&&(kt=kt||xr.data.thisDep,er=er||xr.data.contextDep,hr=hr||xr.data.propDep)}return new va(kt,er,hr,ge)}else return new va(Be===Ka,Be===po,Be===Kn,ge)}}var Yp=new va(!1,!1,!1,function(){});function up(B,ge,Be,Dt,sr,kt,er,hr,mr,xr,Tr,Rr,Gr,_r,Mr){var ut=xr.Record,Gt={add:32774,subtract:32778,"reverse subtract":32779};Be.ext_blend_minmax&&(Gt.min=Gp,Gt.max=Id);var br=Be.angle_instanced_arrays,Br=Be.webgl_draw_buffers,cr=Be.oes_vertex_array_object,or={dirty:!0,profile:Mr.profile},zr={},Un=[],tr={},ir={};function Sn(Se){return Se.replace(".","_")}function Xr(Se,ue,Ge){var lt=Sn(Se);Un.push(Se),zr[lt]=or[lt]=!!Ge,tr[lt]=ue}function Sr(Se,ue,Ge){var lt=Sn(Se);Un.push(Se),Array.isArray(Ge)?(or[lt]=Ge.slice(),zr[lt]=Ge.slice()):or[lt]=zr[lt]=Ge,ir[lt]=ue}Xr(co,Zp),Xr(Bs,qc),Sr(_s,"blendColor",[0,0,0,0]),Sr(Hu,"blendEquationSeparate",[$c,$c]),Sr(xs,"blendFuncSeparate",[kh,Wp,kh,Wp]),Xr(pu,Th,!0),Sr(vo,"depthFunc",qu),Sr(mc,"depthRange",[0,1]),Sr(ru,"depthMask",!0),Sr(Wu,Wu,[!0,!0,!0,!0]),Xr(du,Up),Sr(xl,"cullFace",Yu),Sr(vu,vu,Lh),Sr(Ul,Ul,1),Xr(Ou,Mh),Sr(So,"polygonOffset",[0,0]),Xr(ka,Xf),Xr(Ua,Yf),Sr(mu,"sampleCoverage",[1,!1]),Xr(ta,Co),Sr(is,"stencilMask",-1),Sr(Ms,"stencilFunc",[Hp,0,-1]),Sr(bl,"stencilOpSeparate",[Cl,gu,gu,gu]),Sr(_f,"stencilOpSeparate",[Yu,gu,gu,gu]),Xr(xf,jp),Sr(Gc,"scissor",[0,0,B.drawingBufferWidth,B.drawingBufferHeight]),Sr(mo,mo,[0,0,B.drawingBufferWidth,B.drawingBufferHeight]);var Hr={gl:B,context:Gr,strings:ge,next:zr,current:or,draw:Rr,elements:kt,buffer:sr,shader:Tr,attributes:xr.state,vao:xr,uniforms:mr,framebuffer:hr,extensions:Be,timer:_r,isBufferArgs:Ht},Jr={primTypes:ur,compareFuncs:Vl,blendFuncs:Al,blendEquations:Gt,stencilOps:Qc,glTypes:ou,orientationType:op};me.optional(function(){Hr.isArrayLike=uo}),Br&&(Jr.backBuffer=[Yu],Jr.drawBuffer=He(Dt.maxDrawbuffers,function(Se){return Se===0?[0]:He(Se,function(ue){return Od+ue})}));var Ei=0;function Gn(){var Se=li(),ue=Se.link,Ge=Se.global;Se.id=Ei++,Se.batchId="0";var lt=ue(Hr),Lt=Se.shared={props:"a0"};Object.keys(Hr).forEach(function(Ze){Lt[Ze]=Ge.def(lt,".",Ze)}),me.optional(function(){Se.CHECK=ue(me),Se.commandStr=me.guessCommand(),Se.command=ue(Se.commandStr),Se.assert=function(Ze,Ae,ct){Ze("if(!(",Ae,"))",this.CHECK,".commandRaise(",ue(ct),",",this.command,");")},Jr.invalidBlendCombinations=Cf});var Ke=Se.next={},Fe=Se.current={};Object.keys(ir).forEach(function(Ze){Array.isArray(or[Ze])&&(Ke[Ze]=Ge.def(Lt.next,".",Ze),Fe[Ze]=Ge.def(Lt.current,".",Ze))});var nt=Se.constants={};Object.keys(Jr).forEach(function(Ze){nt[Ze]=Ge.def(JSON.stringify(Jr[Ze]))}),Se.invoke=function(Ze,Ae){switch(Ae.type){case ri:var ct=["this",Lt.context,Lt.props,Se.batchId];return Ze.def(ue(Ae.data),".call(",ct.slice(0,Math.max(Ae.data.length+1,4)),")");case Kn:return Ze.def(Lt.props,Ae.data);case po:return Ze.def(Lt.context,Ae.data);case Ka:return Ze.def("this",Ae.data);case Ho:return Ae.data.append(Se,Ze),Ae.data.ref;case Bo:return Ae.data.toString();case za:return Ae.data.map(function(Ct){return Se.invoke(Ze,Ct)})}},Se.attribCache={};var xe={};return Se.scopeAttrib=function(Ze){var Ae=ge.id(Ze);if(Ae in xe)return xe[Ae];var ct=xr.scope[Ae];ct||(ct=xr.scope[Ae]=new ut);var Ct=xe[Ae]=ue(ct);return Ct},Se}function jr(Se){var ue=Se.static,Ge=Se.dynamic,lt;if(Hc in ue){var Lt=!!ue[Hc];lt=Ao(function(Fe,nt){return Lt}),lt.enable=Lt}else if(Hc in Ge){var Ke=Ge[Hc];lt=Ys(Ke,function(Fe,nt){return Fe.invoke(nt,Ke)})}return lt}function en(Se,ue){var Ge=Se.static,lt=Se.dynamic;if(Ru in Ge){var Lt=Ge[Ru];return Lt?(Lt=hr.getFramebuffer(Lt),me.command(Lt,"invalid framebuffer object"),Ao(function(Fe,nt){var xe=Fe.link(Lt),Ze=Fe.shared;nt.set(Ze.framebuffer,".next",xe);var Ae=Ze.context;return nt.set(Ae,"."+El,xe+".width"),nt.set(Ae,"."+Xc,xe+".height"),xe})):Ao(function(Fe,nt){var xe=Fe.shared;nt.set(xe.framebuffer,".next","null");var Ze=xe.context;return nt.set(Ze,"."+El,Ze+"."+Yc),nt.set(Ze,"."+Xc,Ze+"."+zp),"null"})}else if(Ru in lt){var Ke=lt[Ru];return Ys(Ke,function(Fe,nt){var xe=Fe.invoke(nt,Ke),Ze=Fe.shared,Ae=Ze.framebuffer,ct=nt.def(Ae,".getFramebuffer(",xe,")");me.optional(function(){Fe.assert(nt,"!"+xe+"||"+ct,"invalid framebuffer object")}),nt.set(Ae,".next",ct);var Ct=Ze.context;return nt.set(Ct,"."+El,ct+"?"+ct+".width:"+Ct+"."+Yc),nt.set(Ct,"."+Xc,ct+"?"+ct+".height:"+Ct+"."+zp),ct})}else return null}function ni(Se,ue,Ge){var lt=Se.static,Lt=Se.dynamic;function Ke(xe){if(xe in lt){var Ze=lt[xe];me.commandType(Ze,"object","invalid "+xe,Ge.commandStr);var Ae=!0,ct=Ze.x|0,Ct=Ze.y|0,fr,Ur;return"width"in Ze?(fr=Ze.width|0,me.command(fr>=0,"invalid "+xe,Ge.commandStr)):Ae=!1,"height"in Ze?(Ur=Ze.height|0,me.command(Ur>=0,"invalid "+xe,Ge.commandStr)):Ae=!1,new va(!Ae&&ue&&ue.thisDep,!Ae&&ue&&ue.contextDep,!Ae&&ue&&ue.propDep,function(Dr,An){var cn=Dr.shared.context,xn=fr;"width"in Ze||(xn=An.def(cn,".",El,"-",ct));var bn=Ur;return"height"in Ze||(bn=An.def(cn,".",Xc,"-",Ct)),[ct,Ct,xn,bn]})}else if(xe in Lt){var Vr=Lt[xe],sn=Ys(Vr,function(Dr,An){var cn=Dr.invoke(An,Vr);me.optional(function(){Dr.assert(An,cn+"&&typeof "+cn+'==="object"',"invalid "+xe)});var xn=Dr.shared.context,bn=An.def(cn,".x|0"),dn=An.def(cn,".y|0"),Jn=An.def('"width" in ',cn,"?",cn,".width|0:","(",xn,".",El,"-",bn,")"),_a=An.def('"height" in ',cn,"?",cn,".height|0:","(",xn,".",Xc,"-",dn,")");return me.optional(function(){Dr.assert(An,Jn+">=0&&"+_a+">=0","invalid "+xe)}),[bn,dn,Jn,_a]});return ue&&(sn.thisDep=sn.thisDep||ue.thisDep,sn.contextDep=sn.contextDep||ue.contextDep,sn.propDep=sn.propDep||ue.propDep),sn}else return ue?new va(ue.thisDep,ue.contextDep,ue.propDep,function(Dr,An){var cn=Dr.shared.context;return[0,0,An.def(cn,".",El),An.def(cn,".",Xc)]}):null}var Fe=Ke(mo);if(Fe){var nt=Fe;Fe=new va(Fe.thisDep,Fe.contextDep,Fe.propDep,function(xe,Ze){var Ae=nt.append(xe,Ze),ct=xe.shared.context;return Ze.set(ct,"."+Ah,Ae[2]),Ze.set(ct,"."+np,Ae[3]),Ae})}return{viewport:Fe,scissor_box:Ke(Gc)}}function ui(Se,ue){var Ge=Se.static,lt=typeof Ge[Xu]=="string"&&typeof Ge[Zl]=="string";if(lt){if(Object.keys(ue.dynamic).length>0)return null;var Lt=ue.static,Ke=Object.keys(Lt);if(Ke.length>0&&typeof Lt[Ke[0]]=="number"){for(var Fe=[],nt=0;nt<Ke.length;++nt)me(typeof Lt[Ke[nt]]=="number","must specify all vertex attribute locations when using vaos"),Fe.push([Lt[Ke[nt]]|0,Ke[nt]]);return Fe}}return null}function Ni(Se,ue,Ge){var lt=Se.static,Lt=Se.dynamic;function Ke(Ae){if(Ae in lt){var ct=ge.id(lt[Ae]);me.optional(function(){Tr.shader(Wr[Ae],ct,me.guessCommand())});var Ct=Ao(function(){return ct});return Ct.id=ct,Ct}else if(Ae in Lt){var fr=Lt[Ae];return Ys(fr,function(Ur,Vr){var sn=Ur.invoke(Vr,fr),Dr=Vr.def(Ur.shared.strings,".id(",sn,")");return me.optional(function(){Vr(Ur.shared.shader,".shader(",Wr[Ae],",",Dr,",",Ur.command,");")}),Dr})}return null}var Fe=Ke(Xu),nt=Ke(Zl),xe=null,Ze;return Gl(Fe)&&Gl(nt)?(xe=Tr.program(nt.id,Fe.id,null,Ge),Ze=Ao(function(Ae,ct){return Ae.link(xe)})):Ze=new va(Fe&&Fe.thisDep||nt&&nt.thisDep,Fe&&Fe.contextDep||nt&&nt.contextDep,Fe&&Fe.propDep||nt&&nt.propDep,function(Ae,ct){var Ct=Ae.shared.shader,fr;Fe?fr=Fe.append(Ae,ct):fr=ct.def(Ct,".",Xu);var Ur;nt?Ur=nt.append(Ae,ct):Ur=ct.def(Ct,".",Zl);var Vr=Ct+".program("+Ur+","+fr;return me.optional(function(){Vr+=","+Ae.command}),ct.def(Vr+")")}),{frag:Fe,vert:nt,progVar:Ze,program:xe}}function Ga(Se,ue){var Ge=Se.static,lt=Se.dynamic,Lt={},Ke=!1;function Fe(){if(yc in Ge){var An=Ge[yc];return An!==null&&xr.getVAO(An)===null&&(An=xr.createVAO(An)),Ke=!0,Lt.vao=An,Ao(function(xn){var bn=xr.getVAO(An);return bn?xn.link(bn):"null"})}else if(yc in lt){Ke=!0;var cn=lt[yc];return Ys(cn,function(xn,bn){var dn=xn.invoke(bn,cn);return bn.def(xn.shared.vao+".getVAO("+dn+")")})}return null}var nt=Fe(),xe=!1;function Ze(){if(nu in Ge){var An=Ge[nu];if(Lt.elements=An,Ht(An)){var cn=Lt.elements=kt.create(An,!0);An=kt.getElements(cn),xe=!0}else An&&(An=kt.getElements(An),xe=!0,me.command(An,"invalid elements",ue.commandStr));var xn=Ao(function(dn,Jn){if(An){var _a=dn.link(An);return dn.ELEMENTS=_a,_a}return dn.ELEMENTS=null,null});return xn.value=An,xn}else if(nu in lt){xe=!0;var bn=lt[nu];return Ys(bn,function(dn,Jn){var _a=dn.shared,ls=_a.isBufferArgs,Ia=_a.elements,pa=dn.invoke(Jn,bn),Tl=Jn.def("null"),Is=Jn.def(ls,"(",pa,")"),Ku=dn.cond(Is).then(Tl,"=",Ia,".createStream(",pa,");").else(Tl,"=",Ia,".getElements(",pa,");");return me.optional(function(){dn.assert(Ku.else,"!"+pa+"||"+Tl,"invalid elements")}),Jn.entry(Ku),Jn.exit(dn.cond(Is).then(Ia,".destroyStream(",Tl,");")),dn.ELEMENTS=Tl,Tl})}else if(Ke)return new va(nt.thisDep,nt.contextDep,nt.propDep,function(dn,Jn){return Jn.def(dn.shared.vao+".currentVAO?"+dn.shared.elements+".getElements("+dn.shared.vao+".currentVAO.elements):null")});return null}var Ae=Ze();function ct(){if(go in Ge){var An=Ge[go];return Lt.primitive=An,me.commandParameter(An,ur,"invalid primitve",ue.commandStr),Ao(function(xn,bn){return ur[An]})}else if(go in lt){var cn=lt[go];return Ys(cn,function(xn,bn){var dn=xn.constants.primTypes,Jn=xn.invoke(bn,cn);return me.optional(function(){xn.assert(bn,Jn+" in "+dn,"invalid primitive, must be one of "+Object.keys(ur))}),bn.def(dn,"[",Jn,"]")})}else{if(xe)return Gl(Ae)?Ae.value?Ao(function(xn,bn){return bn.def(xn.ELEMENTS,".primType")}):Ao(function(){return Rh}):new va(Ae.thisDep,Ae.contextDep,Ae.propDep,function(xn,bn){var dn=xn.ELEMENTS;return bn.def(dn,"?",dn,".primType:",Rh)});if(Ke)return new va(nt.thisDep,nt.contextDep,nt.propDep,function(xn,bn){return bn.def(xn.shared.vao+".currentVAO?"+xn.shared.vao+".currentVAO.primitive:"+Rh)})}return null}function Ct(An,cn){if(An in Ge){var xn=Ge[An]|0;return cn?Lt.offset=xn:Lt.instances=xn,me.command(!cn||xn>=0,"invalid "+An,ue.commandStr),Ao(function(dn,Jn){return cn&&(dn.OFFSET=xn),xn})}else if(An in lt){var bn=lt[An];return Ys(bn,function(dn,Jn){var _a=dn.invoke(Jn,bn);return cn&&(dn.OFFSET=_a,me.optional(function(){dn.assert(Jn,_a+">=0","invalid "+An)})),_a})}else if(cn){if(xe)return Ao(function(dn,Jn){return dn.OFFSET=0,0});if(Ke)return new va(nt.thisDep,nt.contextDep,nt.propDep,function(dn,Jn){return Jn.def(dn.shared.vao+".currentVAO?"+dn.shared.vao+".currentVAO.offset:0")})}else if(Ke)return new va(nt.thisDep,nt.contextDep,nt.propDep,function(dn,Jn){return Jn.def(dn.shared.vao+".currentVAO?"+dn.shared.vao+".currentVAO.instances:-1")});return null}var fr=Ct(bf,!0);function Ur(){if(gc in Ge){var An=Ge[gc]|0;return Lt.count=An,me.command(typeof An=="number"&&An>=0,"invalid vertex count",ue.commandStr),Ao(function(){return An})}else if(gc in lt){var cn=lt[gc];return Ys(cn,function(Jn,_a){var ls=Jn.invoke(_a,cn);return me.optional(function(){Jn.assert(_a,"typeof "+ls+'==="number"&&'+ls+">=0&&"+ls+"===("+ls+"|0)","invalid vertex count")}),ls})}else if(xe)if(Gl(Ae)){if(Ae)return fr?new va(fr.thisDep,fr.contextDep,fr.propDep,function(Jn,_a){var ls=_a.def(Jn.ELEMENTS,".vertCount-",Jn.OFFSET);return me.optional(function(){Jn.assert(_a,ls+">=0","invalid vertex offset/element buffer too small")}),ls}):Ao(function(Jn,_a){return _a.def(Jn.ELEMENTS,".vertCount")});var xn=Ao(function(){return-1});return me.optional(function(){xn.MISSING=!0}),xn}else{var bn=new va(Ae.thisDep||fr.thisDep,Ae.contextDep||fr.contextDep,Ae.propDep||fr.propDep,function(Jn,_a){var ls=Jn.ELEMENTS;return Jn.OFFSET?_a.def(ls,"?",ls,".vertCount-",Jn.OFFSET,":-1"):_a.def(ls,"?",ls,".vertCount:-1")});return me.optional(function(){bn.DYNAMIC=!0}),bn}else if(Ke){var dn=new va(nt.thisDep,nt.contextDep,nt.propDep,function(Jn,_a){return _a.def(Jn.shared.vao,".currentVAO?",Jn.shared.vao,".currentVAO.count:-1")});return dn}return null}var Vr=ct(),sn=Ur(),Dr=Ct(Wc,!1);return{elements:Ae,primitive:Vr,count:sn,instances:Dr,offset:fr,vao:nt,vaoActive:Ke,elementsActive:xe,static:Lt}}function no(Se,ue){var Ge=Se.static,lt=Se.dynamic,Lt={};return Un.forEach(function(Ke){var Fe=Sn(Ke);function nt(xe,Ze){if(Ke in Ge){var Ae=xe(Ge[Ke]);Lt[Fe]=Ao(function(){return Ae})}else if(Ke in lt){var ct=lt[Ke];Lt[Fe]=Ys(ct,function(Ct,fr){return Ze(Ct,fr,Ct.invoke(fr,ct))})}}switch(Ke){case du:case Bs:case co:case ta:case pu:case xf:case Ou:case ka:case Ua:case ru:return nt(function(xe){return me.commandType(xe,"boolean",Ke,ue.commandStr),xe},function(xe,Ze,Ae){return me.optional(function(){xe.assert(Ze,"typeof "+Ae+'==="boolean"',"invalid flag "+Ke,xe.commandStr)}),Ae});case vo:return nt(function(xe){return me.commandParameter(xe,Vl,"invalid "+Ke,ue.commandStr),Vl[xe]},function(xe,Ze,Ae){var ct=xe.constants.compareFuncs;return me.optional(function(){xe.assert(Ze,Ae+" in "+ct,"invalid "+Ke+", must be one of "+Object.keys(Vl))}),Ze.def(ct,"[",Ae,"]")});case mc:return nt(function(xe){return me.command(uo(xe)&&xe.length===2&&typeof xe[0]=="number"&&typeof xe[1]=="number"&&xe[0]<=xe[1],"depth range is 2d array",ue.commandStr),xe},function(xe,Ze,Ae){me.optional(function(){xe.assert(Ze,xe.shared.isArrayLike+"("+Ae+")&&"+Ae+".length===2&&typeof "+Ae+'[0]==="number"&&typeof '+Ae+'[1]==="number"&&'+Ae+"[0]<="+Ae+"[1]","depth range must be a 2d array")});var ct=Ze.def("+",Ae,"[0]"),Ct=Ze.def("+",Ae,"[1]");return[ct,Ct]});case xs:return nt(function(xe){me.commandType(xe,"object","blend.func",ue.commandStr);var Ze="srcRGB"in xe?xe.srcRGB:xe.src,Ae="srcAlpha"in xe?xe.srcAlpha:xe.src,ct="dstRGB"in xe?xe.dstRGB:xe.dst,Ct="dstAlpha"in xe?xe.dstAlpha:xe.dst;return me.commandParameter(Ze,Al,Fe+".srcRGB",ue.commandStr),me.commandParameter(Ae,Al,Fe+".srcAlpha",ue.commandStr),me.commandParameter(ct,Al,Fe+".dstRGB",ue.commandStr),me.commandParameter(Ct,Al,Fe+".dstAlpha",ue.commandStr),me.command(Cf.indexOf(Ze+", "+ct)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+Ze+", "+ct+")",ue.commandStr),[Al[Ze],Al[ct],Al[Ae],Al[Ct]]},function(xe,Ze,Ae){var ct=xe.constants.blendFuncs;me.optional(function(){xe.assert(Ze,Ae+"&&typeof "+Ae+'==="object"',"invalid blend func, must be an object")});function Ct(cn,xn){var bn=Ze.def('"',cn,xn,'" in ',Ae,"?",Ae,".",cn,xn,":",Ae,".",cn);return me.optional(function(){xe.assert(Ze,bn+" in "+ct,"invalid "+Ke+"."+cn+xn+", must be one of "+Object.keys(Al))}),bn}var fr=Ct("src","RGB"),Ur=Ct("dst","RGB");me.optional(function(){var cn=xe.constants.invalidBlendCombinations;xe.assert(Ze,cn+".indexOf("+fr+'+", "+'+Ur+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var Vr=Ze.def(ct,"[",fr,"]"),sn=Ze.def(ct,"[",Ct("src","Alpha"),"]"),Dr=Ze.def(ct,"[",Ur,"]"),An=Ze.def(ct,"[",Ct("dst","Alpha"),"]");return[Vr,Dr,sn,An]});case Hu:return nt(function(xe){if(typeof xe=="string")return me.commandParameter(xe,Gt,"invalid "+Ke,ue.commandStr),[Gt[xe],Gt[xe]];if(typeof xe=="object")return me.commandParameter(xe.rgb,Gt,Ke+".rgb",ue.commandStr),me.commandParameter(xe.alpha,Gt,Ke+".alpha",ue.commandStr),[Gt[xe.rgb],Gt[xe.alpha]];me.commandRaise("invalid blend.equation",ue.commandStr)},function(xe,Ze,Ae){var ct=xe.constants.blendEquations,Ct=Ze.def(),fr=Ze.def(),Ur=xe.cond("typeof ",Ae,'==="string"');return me.optional(function(){function Vr(sn,Dr,An){xe.assert(sn,An+" in "+ct,"invalid "+Dr+", must be one of "+Object.keys(Gt))}Vr(Ur.then,Ke,Ae),xe.assert(Ur.else,Ae+"&&typeof "+Ae+'==="object"',"invalid "+Ke),Vr(Ur.else,Ke+".rgb",Ae+".rgb"),Vr(Ur.else,Ke+".alpha",Ae+".alpha")}),Ur.then(Ct,"=",fr,"=",ct,"[",Ae,"];"),Ur.else(Ct,"=",ct,"[",Ae,".rgb];",fr,"=",ct,"[",Ae,".alpha];"),Ze(Ur),[Ct,fr]});case _s:return nt(function(xe){return me.command(uo(xe)&&xe.length===4,"blend.color must be a 4d array",ue.commandStr),He(4,function(Ze){return+xe[Ze]})},function(xe,Ze,Ae){return me.optional(function(){xe.assert(Ze,xe.shared.isArrayLike+"("+Ae+")&&"+Ae+".length===4","blend.color must be a 4d array")}),He(4,function(ct){return Ze.def("+",Ae,"[",ct,"]")})});case is:return nt(function(xe){return me.commandType(xe,"number",Fe,ue.commandStr),xe|0},function(xe,Ze,Ae){return me.optional(function(){xe.assert(Ze,"typeof "+Ae+'==="number"',"invalid stencil.mask")}),Ze.def(Ae,"|0")});case Ms:return nt(function(xe){me.commandType(xe,"object",Fe,ue.commandStr);var Ze=xe.cmp||"keep",Ae=xe.ref||0,ct="mask"in xe?xe.mask:-1;return me.commandParameter(Ze,Vl,Ke+".cmp",ue.commandStr),me.commandType(Ae,"number",Ke+".ref",ue.commandStr),me.commandType(ct,"number",Ke+".mask",ue.commandStr),[Vl[Ze],Ae,ct]},function(xe,Ze,Ae){var ct=xe.constants.compareFuncs;me.optional(function(){function Vr(){xe.assert(Ze,Array.prototype.join.call(arguments,""),"invalid stencil.func")}Vr(Ae+"&&typeof ",Ae,'==="object"'),Vr('!("cmp" in ',Ae,")||(",Ae,".cmp in ",ct,")")});var Ct=Ze.def('"cmp" in ',Ae,"?",ct,"[",Ae,".cmp]",":",gu),fr=Ze.def(Ae,".ref|0"),Ur=Ze.def('"mask" in ',Ae,"?",Ae,".mask|0:-1");return[Ct,fr,Ur]});case bl:case _f:return nt(function(xe){me.commandType(xe,"object",Fe,ue.commandStr);var Ze=xe.fail||"keep",Ae=xe.zfail||"keep",ct=xe.zpass||"keep";return me.commandParameter(Ze,Qc,Ke+".fail",ue.commandStr),me.commandParameter(Ae,Qc,Ke+".zfail",ue.commandStr),me.commandParameter(ct,Qc,Ke+".zpass",ue.commandStr),[Ke===_f?Yu:Cl,Qc[Ze],Qc[Ae],Qc[ct]]},function(xe,Ze,Ae){var ct=xe.constants.stencilOps;me.optional(function(){xe.assert(Ze,Ae+"&&typeof "+Ae+'==="object"',"invalid "+Ke)});function Ct(fr){return me.optional(function(){xe.assert(Ze,'!("'+fr+'" in '+Ae+")||("+Ae+"."+fr+" in "+ct+")","invalid "+Ke+"."+fr+", must be one of "+Object.keys(Qc))}),Ze.def('"',fr,'" in ',Ae,"?",ct,"[",Ae,".",fr,"]:",gu)}return[Ke===_f?Yu:Cl,Ct("fail"),Ct("zfail"),Ct("zpass")]});case So:return nt(function(xe){me.commandType(xe,"object",Fe,ue.commandStr);var Ze=xe.factor|0,Ae=xe.units|0;return me.commandType(Ze,"number",Fe+".factor",ue.commandStr),me.commandType(Ae,"number",Fe+".units",ue.commandStr),[Ze,Ae]},function(xe,Ze,Ae){me.optional(function(){xe.assert(Ze,Ae+"&&typeof "+Ae+'==="object"',"invalid "+Ke)});var ct=Ze.def(Ae,".factor|0"),Ct=Ze.def(Ae,".units|0");return[ct,Ct]});case xl:return nt(function(xe){var Ze=0;return xe==="front"?Ze=Cl:xe==="back"&&(Ze=Yu),me.command(!!Ze,Fe,ue.commandStr),Ze},function(xe,Ze,Ae){return me.optional(function(){xe.assert(Ze,Ae+'==="front"||'+Ae+'==="back"',"invalid cull.face")}),Ze.def(Ae,'==="front"?',Cl,":",Yu)});case Ul:return nt(function(xe){return me.command(typeof xe=="number"&&xe>=Dt.lineWidthDims[0]&&xe<=Dt.lineWidthDims[1],"invalid line width, must be a positive number between "+Dt.lineWidthDims[0]+" and "+Dt.lineWidthDims[1],ue.commandStr),xe},function(xe,Ze,Ae){return me.optional(function(){xe.assert(Ze,"typeof "+Ae+'==="number"&&'+Ae+">="+Dt.lineWidthDims[0]+"&&"+Ae+"<="+Dt.lineWidthDims[1],"invalid line width")}),Ae});case vu:return nt(function(xe){return me.commandParameter(xe,op,Fe,ue.commandStr),op[xe]},function(xe,Ze,Ae){return me.optional(function(){xe.assert(Ze,Ae+'==="cw"||'+Ae+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),Ze.def(Ae+'==="cw"?'+Vp+":"+Lh)});case Wu:return nt(function(xe){return me.command(uo(xe)&&xe.length===4,"color.mask must be length 4 array",ue.commandStr),xe.map(function(Ze){return!!Ze})},function(xe,Ze,Ae){return me.optional(function(){xe.assert(Ze,xe.shared.isArrayLike+"("+Ae+")&&"+Ae+".length===4","invalid color.mask")}),He(4,function(ct){return"!!"+Ae+"["+ct+"]"})});case mu:return nt(function(xe){me.command(typeof xe=="object"&&xe,Fe,ue.commandStr);var Ze="value"in xe?xe.value:1,Ae=!!xe.invert;return me.command(typeof Ze=="number"&&Ze>=0&&Ze<=1,"sample.coverage.value must be a number between 0 and 1",ue.commandStr),[Ze,Ae]},function(xe,Ze,Ae){me.optional(function(){xe.assert(Ze,Ae+"&&typeof "+Ae+'==="object"',"invalid sample.coverage")});var ct=Ze.def('"value" in ',Ae,"?+",Ae,".value:1"),Ct=Ze.def("!!",Ae,".invert");return[ct,Ct]})}}),Lt}function Zi(Se,ue){var Ge=Se.static,lt=Se.dynamic,Lt={};return Object.keys(Ge).forEach(function(Ke){var Fe=Ge[Ke],nt;if(typeof Fe=="number"||typeof Fe=="boolean")nt=Ao(function(){return Fe});else if(typeof Fe=="function"){var xe=Fe._reglType;xe==="texture2d"||xe==="textureCube"?nt=Ao(function(Ze){return Ze.link(Fe)}):xe==="framebuffer"||xe==="framebufferCube"?(me.command(Fe.color.length>0,'missing color attachment for framebuffer sent to uniform "'+Ke+'"',ue.commandStr),nt=Ao(function(Ze){return Ze.link(Fe.color[0])})):me.commandRaise('invalid data for uniform "'+Ke+'"',ue.commandStr)}else uo(Fe)?nt=Ao(function(Ze){var Ae=Ze.global.def("[",He(Fe.length,function(ct){return me.command(typeof Fe[ct]=="number"||typeof Fe[ct]=="boolean","invalid uniform "+Ke,Ze.commandStr),Fe[ct]}),"]");return Ae}):me.commandRaise('invalid or missing data for uniform "'+Ke+'"',ue.commandStr);nt.value=Fe,Lt[Ke]=nt}),Object.keys(lt).forEach(function(Ke){var Fe=lt[Ke];Lt[Ke]=Ys(Fe,function(nt,xe){return nt.invoke(xe,Fe)})}),Lt}function ss(Se,ue){var Ge=Se.static,lt=Se.dynamic,Lt={};return Object.keys(Ge).forEach(function(Ke){var Fe=Ge[Ke],nt=ge.id(Ke),xe=new ut;if(Ht(Fe))xe.state=Xn,xe.buffer=sr.getBuffer(sr.create(Fe,Ef,!1,!0)),xe.type=0;else{var Ze=sr.getBuffer(Fe);if(Ze)xe.state=Xn,xe.buffer=Ze,xe.type=0;else if(me.command(typeof Fe=="object"&&Fe,"invalid data for attribute "+Ke,ue.commandStr),"constant"in Fe){var Ae=Fe.constant;xe.buffer="null",xe.state=xi,typeof Ae=="number"?xe.x=Ae:(me.command(uo(Ae)&&Ae.length>0&&Ae.length<=4,"invalid constant for attribute "+Ke,ue.commandStr),fi.forEach(function(Dr,An){An<Ae.length&&(xe[Dr]=Ae[An])}))}else{Ht(Fe.buffer)?Ze=sr.getBuffer(sr.create(Fe.buffer,Ef,!1,!0)):Ze=sr.getBuffer(Fe.buffer),me.command(!!Ze,'missing buffer for attribute "'+Ke+'"',ue.commandStr);var ct=Fe.offset|0;me.command(ct>=0,'invalid offset for attribute "'+Ke+'"',ue.commandStr);var Ct=Fe.stride|0;me.command(Ct>=0&&Ct<256,'invalid stride for attribute "'+Ke+'", must be integer betweeen [0, 255]',ue.commandStr);var fr=Fe.size|0;me.command(!("size"in Fe)||fr>0&&fr<=4,'invalid size for attribute "'+Ke+'", must be 1,2,3,4',ue.commandStr);var Ur=!!Fe.normalized,Vr=0;"type"in Fe&&(me.commandParameter(Fe.type,ou,"invalid type for attribute "+Ke,ue.commandStr),Vr=ou[Fe.type]);var sn=Fe.divisor|0;me.optional(function(){"divisor"in Fe&&(me.command(sn===0||br,'cannot specify divisor for attribute "'+Ke+'", instancing not supported',ue.commandStr),me.command(sn>=0,'invalid divisor for attribute "'+Ke+'"',ue.commandStr));var Dr=ue.commandStr,An=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(Fe).forEach(function(cn){me.command(An.indexOf(cn)>=0,'unknown parameter "'+cn+'" for attribute pointer "'+Ke+'" (valid parameters are '+An+")",Dr)})}),xe.buffer=Ze,xe.state=Xn,xe.size=fr,xe.normalized=Ur,xe.type=Vr||Ze.dtype,xe.offset=ct,xe.stride=Ct,xe.divisor=sn}}Lt[Ke]=Ao(function(Dr,An){var cn=Dr.attribCache;if(nt in cn)return cn[nt];var xn={isStream:!1};return Object.keys(xe).forEach(function(bn){xn[bn]=xe[bn]}),xe.buffer&&(xn.buffer=Dr.link(xe.buffer),xn.type=xn.type||xn.buffer+".dtype"),cn[nt]=xn,xn})}),Object.keys(lt).forEach(function(Ke){var Fe=lt[Ke];function nt(xe,Ze){var Ae=xe.invoke(Ze,Fe),ct=xe.shared,Ct=xe.constants,fr=ct.isBufferArgs,Ur=ct.buffer;me.optional(function(){xe.assert(Ze,Ae+"&&(typeof "+Ae+'==="object"||typeof '+Ae+'==="function")&&('+fr+"("+Ae+")||"+Ur+".getBuffer("+Ae+")||"+Ur+".getBuffer("+Ae+".buffer)||"+fr+"("+Ae+'.buffer)||("constant" in '+Ae+"&&(typeof "+Ae+'.constant==="number"||'+ct.isArrayLike+"("+Ae+".constant))))",'invalid dynamic attribute "'+Ke+'"')});var Vr={isStream:Ze.def(!1)},sn=new ut;sn.state=Xn,Object.keys(sn).forEach(function(xn){Vr[xn]=Ze.def(""+sn[xn])});var Dr=Vr.buffer,An=Vr.type;Ze("if(",fr,"(",Ae,")){",Vr.isStream,"=true;",Dr,"=",Ur,".createStream(",Ef,",",Ae,");",An,"=",Dr,".dtype;","}else{",Dr,"=",Ur,".getBuffer(",Ae,");","if(",Dr,"){",An,"=",Dr,".dtype;",'}else if("constant" in ',Ae,"){",Vr.state,"=",xi,";","if(typeof "+Ae+'.constant === "number"){',Vr[fi[0]],"=",Ae,".constant;",fi.slice(1).map(function(xn){return Vr[xn]}).join("="),"=0;","}else{",fi.map(function(xn,bn){return Vr[xn]+"="+Ae+".constant.length>"+bn+"?"+Ae+".constant["+bn+"]:0;"}).join(""),"}}else{","if(",fr,"(",Ae,".buffer)){",Dr,"=",Ur,".createStream(",Ef,",",Ae,".buffer);","}else{",Dr,"=",Ur,".getBuffer(",Ae,".buffer);","}",An,'="type" in ',Ae,"?",Ct.glTypes,"[",Ae,".type]:",Dr,".dtype;",Vr.normalized,"=!!",Ae,".normalized;");function cn(xn){Ze(Vr[xn],"=",Ae,".",xn,"|0;")}return cn("size"),cn("offset"),cn("stride"),cn("divisor"),Ze("}}"),Ze.exit("if(",Vr.isStream,"){",Ur,".destroyStream(",Dr,");","}"),Vr}Lt[Ke]=Ys(Fe,nt)}),Lt}function Ha(Se){var ue=Se.static,Ge=Se.dynamic,lt={};return Object.keys(ue).forEach(function(Lt){var Ke=ue[Lt];lt[Lt]=Ao(function(Fe,nt){return typeof Ke=="number"||typeof Ke=="boolean"?""+Ke:Fe.link(Ke)})}),Object.keys(Ge).forEach(function(Lt){var Ke=Ge[Lt];lt[Lt]=Ys(Ke,function(Fe,nt){return Fe.invoke(nt,Ke)})}),lt}function as(Se,ue,Ge,lt,Lt){var Ke=Se.static,Fe=Se.dynamic;me.optional(function(){var cn=[Ru,Zl,Xu,nu,go,bf,gc,Wc,Hc,yc].concat(Un);function xn(bn){Object.keys(bn).forEach(function(dn){me.command(cn.indexOf(dn)>=0,'unknown parameter "'+dn+'"',Lt.commandStr)})}xn(Ke),xn(Fe)});var nt=ui(Se,ue),xe=en(Se,Lt),Ze=ni(Se,xe,Lt),Ae=Ga(Se,Lt),ct=no(Se,Lt),Ct=Ni(Se,Lt,nt);function fr(cn){var xn=Ze[cn];xn&&(ct[cn]=xn)}fr(mo),fr(Sn(Gc));var Ur=Object.keys(ct).length>0,Vr={framebuffer:xe,draw:Ae,shader:Ct,state:ct,dirty:Ur,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(Vr.profile=jr(Se,Lt),Vr.uniforms=Zi(Ge,Lt),Vr.drawVAO=Vr.scopeVAO=Ae.vao,!Vr.drawVAO&&Ct.program&&!nt&&Be.angle_instanced_arrays&&Ae.static.elements){var sn=!0,Dr=Ct.program.attributes.map(function(cn){var xn=ue.static[cn];return sn=sn&&!!xn,xn});if(sn&&Dr.length>0){var An=xr.getVAO(xr.createVAO({attributes:Dr,elements:Ae.static.elements}));Vr.drawVAO=new va(null,null,null,function(cn,xn){return cn.link(An)}),Vr.useVAO=!0}}return nt?Vr.useVAO=!0:Vr.attributes=ss(ue,Lt),Vr.context=Ha(lt,Lt),Vr}function wo(Se,ue,Ge){var lt=Se.shared,Lt=lt.context,Ke=Se.scope();Object.keys(Ge).forEach(function(Fe){ue.save(Lt,"."+Fe);var nt=Ge[Fe],xe=nt.append(Se,ue);Array.isArray(xe)?Ke(Lt,".",Fe,"=[",xe.join(),"];"):Ke(Lt,".",Fe,"=",xe,";")}),ue(Ke)}function Wo(Se,ue,Ge,lt){var Lt=Se.shared,Ke=Lt.gl,Fe=Lt.framebuffer,nt;Br&&(nt=ue.def(Lt.extensions,".webgl_draw_buffers"));var xe=Se.constants,Ze=xe.drawBuffer,Ae=xe.backBuffer,ct;Ge?ct=Ge.append(Se,ue):ct=ue.def(Fe,".next"),lt||ue("if(",ct,"!==",Fe,".cur){"),ue("if(",ct,"){",Ke,".bindFramebuffer(",Xp,",",ct,".framebuffer);"),Br&&ue(nt,".drawBuffersWEBGL(",Ze,"[",ct,".colorAttachments.length]);"),ue("}else{",Ke,".bindFramebuffer(",Xp,",null);"),Br&&ue(nt,".drawBuffersWEBGL(",Ae,");"),ue("}",Fe,".cur=",ct,";"),lt||ue("}")}function Xo(Se,ue,Ge){var lt=Se.shared,Lt=lt.gl,Ke=Se.current,Fe=Se.next,nt=lt.current,xe=lt.next,Ze=Se.cond(nt,".dirty");Un.forEach(function(Ae){var ct=Sn(Ae);if(!(ct in Ge.state)){var Ct,fr;if(ct in Fe){Ct=Fe[ct],fr=Ke[ct];var Ur=He(or[ct].length,function(sn){return Ze.def(Ct,"[",sn,"]")});Ze(Se.cond(Ur.map(function(sn,Dr){return sn+"!=="+fr+"["+Dr+"]"}).join("||")).then(Lt,".",ir[ct],"(",Ur,");",Ur.map(function(sn,Dr){return fr+"["+Dr+"]="+sn}).join(";"),";"))}else{Ct=Ze.def(xe,".",ct);var Vr=Se.cond(Ct,"!==",nt,".",ct);Ze(Vr),ct in tr?Vr(Se.cond(Ct).then(Lt,".enable(",tr[ct],");").else(Lt,".disable(",tr[ct],");"),nt,".",ct,"=",Ct,";"):Vr(Lt,".",ir[ct],"(",Ct,");",nt,".",ct,"=",Ct,";")}}}),Object.keys(Ge.state).length===0&&Ze(nt,".dirty=false;"),ue(Ze)}function bs(Se,ue,Ge,lt){var Lt=Se.shared,Ke=Se.current,Fe=Lt.current,nt=Lt.gl;sp(Object.keys(Ge)).forEach(function(xe){var Ze=Ge[xe];if(!(lt&&!lt(Ze))){var Ae=Ze.append(Se,ue);if(tr[xe]){var ct=tr[xe];Gl(Ze)?Ae?ue(nt,".enable(",ct,");"):ue(nt,".disable(",ct,");"):ue(Se.cond(Ae).then(nt,".enable(",ct,");").else(nt,".disable(",ct,");")),ue(Fe,".",xe,"=",Ae,";")}else if(uo(Ae)){var Ct=Ke[xe];ue(nt,".",ir[xe],"(",Ae,");",Ae.map(function(fr,Ur){return Ct+"["+Ur+"]="+fr}).join(";"),";")}else ue(nt,".",ir[xe],"(",Ae,");",Fe,".",xe,"=",Ae,";")}})}function io(Se,ue){br&&(Se.instancing=ue.def(Se.shared.extensions,".angle_instanced_arrays"))}function Si(Se,ue,Ge,lt,Lt){var Ke=Se.shared,Fe=Se.stats,nt=Ke.current,xe=Ke.timer,Ze=Ge.profile;function Ae(){var cn=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return cn||typeof performance=="undefined"?"Date.now()":"performance.now()"}var ct,Ct;function fr(cn){ct=ue.def(),cn(ct,"=",Ae(),";"),typeof Lt=="string"?cn(Fe,".count+=",Lt,";"):cn(Fe,".count++;"),_r&&(lt?(Ct=ue.def(),cn(Ct,"=",xe,".getNumPendingQueries();")):cn(xe,".beginQuery(",Fe,");"))}function Ur(cn){cn(Fe,".cpuTime+=",Ae(),"-",ct,";"),_r&&(lt?cn(xe,".pushScopeStats(",Ct,",",xe,".getNumPendingQueries(),",Fe,");"):cn(xe,".endQuery();"))}function Vr(cn){var xn=ue.def(nt,".profile");ue(nt,".profile=",cn,";"),ue.exit(nt,".profile=",xn,";")}var sn;if(Ze){if(Gl(Ze)){Ze.enable?(fr(ue),Ur(ue.exit),Vr("true")):Vr("false");return}sn=Ze.append(Se,ue),Vr(sn)}else sn=ue.def(nt,".profile");var Dr=Se.block();fr(Dr),ue("if(",sn,"){",Dr,"}");var An=Se.block();Ur(An),ue.exit("if(",sn,"){",An,"}")}function Yo(Se,ue,Ge,lt,Lt){var Ke=Se.shared;function Fe(xe){switch(xe){case qf:case Ih:case Qf:return 2;case jl:case _c:case Sf:return 3;case Sl:case Oh:case Kc:return 4;default:return 1}}function nt(xe,Ze,Ae){var ct=Ke.gl,Ct=ue.def(xe,".location"),fr=ue.def(Ke.attributes,"[",Ct,"]"),Ur=Ae.state,Vr=Ae.buffer,sn=[Ae.x,Ae.y,Ae.z,Ae.w],Dr=["buffer","normalized","offset","stride"];function An(){ue("if(!",fr,".buffer){",ct,".enableVertexAttribArray(",Ct,");}");var xn=Ae.type,bn;if(Ae.size?bn=ue.def(Ae.size,"||",Ze):bn=Ze,ue("if(",fr,".type!==",xn,"||",fr,".size!==",bn,"||",Dr.map(function(Jn){return fr+"."+Jn+"!=="+Ae[Jn]}).join("||"),"){",ct,".bindBuffer(",Ef,",",Vr,".buffer);",ct,".vertexAttribPointer(",[Ct,bn,xn,Ae.normalized,Ae.stride,Ae.offset],");",fr,".type=",xn,";",fr,".size=",bn,";",Dr.map(function(Jn){return fr+"."+Jn+"="+Ae[Jn]+";"}).join(""),"}"),br){var dn=Ae.divisor;ue("if(",fr,".divisor!==",dn,"){",Se.instancing,".vertexAttribDivisorANGLE(",[Ct,dn],");",fr,".divisor=",dn,";}")}}function cn(){ue("if(",fr,".buffer){",ct,".disableVertexAttribArray(",Ct,");",fr,".buffer=null;","}if(",fi.map(function(xn,bn){return fr+"."+xn+"!=="+sn[bn]}).join("||"),"){",ct,".vertexAttrib4f(",Ct,",",sn,");",fi.map(function(xn,bn){return fr+"."+xn+"="+sn[bn]+";"}).join(""),"}")}Ur===Xn?An():Ur===xi?cn():(ue("if(",Ur,"===",Xn,"){"),An(),ue("}else{"),cn(),ue("}"))}lt.forEach(function(xe){var Ze=xe.name,Ae=Ge.attributes[Ze],ct;if(Ae){if(!Lt(Ae))return;ct=Ae.append(Se,ue)}else{if(!Lt(Yp))return;var Ct=Se.scopeAttrib(Ze);me.optional(function(){Se.assert(ue,Ct+".state","missing attribute "+Ze)}),ct={},Object.keys(new ut).forEach(function(fr){ct[fr]=ue.def(Ct,".",fr)})}nt(Se.link(xe),Fe(xe.info.type),ct)})}function ra(Se,ue,Ge,lt,Lt,Ke){for(var Fe=Se.shared,nt=Fe.gl,xe,Ze=0;Ze<lt.length;++Ze){var Ae=lt[Ze],ct=Ae.name,Ct=Ae.info.type,fr=Ge.uniforms[ct],Ur=Se.link(Ae),Vr=Ur+".location",sn;if(fr){if(!Lt(fr))continue;if(Gl(fr)){var Dr=fr.value;if(me.command(Dr!==null&&typeof Dr!="undefined",'missing uniform "'+ct+'"',Se.commandStr),Ct===th||Ct===rh){me.command(typeof Dr=="function"&&(Ct===th&&(Dr._reglType==="texture2d"||Dr._reglType==="framebuffer")||Ct===rh&&(Dr._reglType==="textureCube"||Dr._reglType==="framebufferCube")),"invalid texture for uniform "+ct,Se.commandStr);var An=Se.link(Dr._texture||Dr.color[0]._texture);ue(nt,".uniform1i(",Vr,",",An+".bind());"),ue.exit(An,".unbind();")}else if(Ct===Ns||Ct===Jf||Ct===eh){me.optional(function(){me.command(uo(Dr),"invalid matrix for uniform "+ct,Se.commandStr),me.command(Ct===Ns&&Dr.length===4||Ct===Jf&&Dr.length===9||Ct===eh&&Dr.length===16,"invalid length for matrix uniform "+ct,Se.commandStr)});var cn=Se.global.def("new Float32Array(["+Array.prototype.slice.call(Dr)+"])"),xn=2;Ct===Jf?xn=3:Ct===eh&&(xn=4),ue(nt,".uniformMatrix",xn,"fv(",Vr,",false,",cn,");")}else{switch(Ct){case Ph:me.commandType(Dr,"number","uniform "+ct,Se.commandStr),xe="1f";break;case qf:me.command(uo(Dr)&&Dr.length===2,"uniform "+ct,Se.commandStr),xe="2f";break;case jl:me.command(uo(Dr)&&Dr.length===3,"uniform "+ct,Se.commandStr),xe="3f";break;case Sl:me.command(uo(Dr)&&Dr.length===4,"uniform "+ct,Se.commandStr),xe="4f";break;case $f:me.commandType(Dr,"boolean","uniform "+ct,Se.commandStr),xe="1i";break;case Kf:me.commandType(Dr,"number","uniform "+ct,Se.commandStr),xe="1i";break;case Qf:me.command(uo(Dr)&&Dr.length===2,"uniform "+ct,Se.commandStr),xe="2i";break;case Ih:me.command(uo(Dr)&&Dr.length===2,"uniform "+ct,Se.commandStr),xe="2i";break;case Sf:me.command(uo(Dr)&&Dr.length===3,"uniform "+ct,Se.commandStr),xe="3i";break;case _c:me.command(uo(Dr)&&Dr.length===3,"uniform "+ct,Se.commandStr),xe="3i";break;case Kc:me.command(uo(Dr)&&Dr.length===4,"uniform "+ct,Se.commandStr),xe="4i";break;case Oh:me.command(uo(Dr)&&Dr.length===4,"uniform "+ct,Se.commandStr),xe="4i";break}ue(nt,".uniform",xe,"(",Vr,",",uo(Dr)?Array.prototype.slice.call(Dr):Dr,");")}continue}else sn=fr.append(Se,ue)}else{if(!Lt(Yp))continue;sn=ue.def(Fe.uniforms,"[",ge.id(ct),"]")}Ct===th?(me(!Array.isArray(sn),"must specify a scalar prop for textures"),ue("if(",sn,"&&",sn,'._reglType==="framebuffer"){',sn,"=",sn,".color[0];","}")):Ct===rh&&(me(!Array.isArray(sn),"must specify a scalar prop for cube maps"),ue("if(",sn,"&&",sn,'._reglType==="framebufferCube"){',sn,"=",sn,".color[0];","}")),me.optional(function(){function Is(Lu,xc){Se.assert(ue,Lu,'bad data or missing for uniform "'+ct+'".  '+xc)}function Ku(Lu){me(!Array.isArray(sn),"must not specify an array type for uniform"),Is("typeof "+sn+'==="'+Lu+'"',"invalid type, expected "+Lu)}function yu(Lu,xc){Array.isArray(sn)?me(sn.length===Lu,"must have length "+Lu):Is(Fe.isArrayLike+"("+sn+")&&"+sn+".length==="+Lu,"invalid vector, should have length "+Lu,Se.commandStr)}function ah(Lu){me(!Array.isArray(sn),"must not specify a value type"),Is("typeof "+sn+'==="function"&&'+sn+'._reglType==="texture'+(Lu===wh?"2d":"Cube")+'"',"invalid texture type",Se.commandStr)}switch(Ct){case Kf:Ku("number");break;case Ih:yu(2,"number");break;case _c:yu(3,"number");break;case Oh:yu(4,"number");break;case Ph:Ku("number");break;case qf:yu(2,"number");break;case jl:yu(3,"number");break;case Sl:yu(4,"number");break;case $f:Ku("boolean");break;case Qf:yu(2,"boolean");break;case Sf:yu(3,"boolean");break;case Kc:yu(4,"boolean");break;case Ns:yu(4,"number");break;case Jf:yu(9,"number");break;case eh:yu(16,"number");break;case th:ah(wh);break;case rh:ah(ap);break}});var bn=1;switch(Ct){case th:case rh:var dn=ue.def(sn,"._texture");ue(nt,".uniform1i(",Vr,",",dn,".bind());"),ue.exit(dn,".unbind();");continue;case Kf:case $f:xe="1i";break;case Ih:case Qf:xe="2i",bn=2;break;case _c:case Sf:xe="3i",bn=3;break;case Oh:case Kc:xe="4i",bn=4;break;case Ph:xe="1f";break;case qf:xe="2f",bn=2;break;case jl:xe="3f",bn=3;break;case Sl:xe="4f",bn=4;break;case Ns:xe="Matrix2fv";break;case Jf:xe="Matrix3fv";break;case eh:xe="Matrix4fv";break}if(xe.charAt(0)==="M"){ue(nt,".uniform",xe,"(",Vr,",");var Jn=Math.pow(Ct-Ns+2,2),_a=Se.global.def("new Float32Array(",Jn,")");Array.isArray(sn)?ue("false,(",He(Jn,function(Is){return _a+"["+Is+"]="+sn[Is]}),",",_a,")"):ue("false,(Array.isArray(",sn,")||",sn," instanceof Float32Array)?",sn,":(",He(Jn,function(Is){return _a+"["+Is+"]="+sn+"["+Is+"]"}),",",_a,")"),ue(");")}else if(bn>1){for(var ls=[],Ia=[],pa=0;pa<bn;++pa)Array.isArray(sn)?Ia.push(sn[pa]):Ia.push(ue.def(sn+"["+pa+"]")),Ke&&ls.push(ue.def());Ke&&ue("if(!",Se.batchId,"||",ls.map(function(Is,Ku){return Is+"!=="+Ia[Ku]}).join("||"),"){",ls.map(function(Is,Ku){return Is+"="+Ia[Ku]+";"}).join("")),ue(nt,".uniform",xe,"(",Vr,",",Ia.join(","),");"),Ke&&ue("}")}else{if(me(!Array.isArray(sn),"uniform value must not be an array"),Ke){var Tl=ue.def();ue("if(!",Se.batchId,"||",Tl,"!==",sn,"){",Tl,"=",sn,";")}ue(nt,".uniform",xe,"(",Vr,",",sn,");"),Ke&&ue("}")}}}function us(Se,ue,Ge,lt){var Lt=Se.shared,Ke=Lt.gl,Fe=Lt.draw,nt=lt.draw;function xe(){var bn=nt.elements,dn,Jn=ue;return bn?((bn.contextDep&&lt.contextDynamic||bn.propDep)&&(Jn=Ge),dn=bn.append(Se,Jn),nt.elementsActive&&Jn("if("+dn+")"+Ke+".bindBuffer("+ip+","+dn+".buffer.buffer);")):(dn=Jn.def(),Jn(dn,"=",Fe,".",nu,";","if(",dn,"){",Ke,".bindBuffer(",ip,",",dn,".buffer.buffer);}","else if(",Lt.vao,".currentVAO){",dn,"=",Se.shared.elements+".getElements("+Lt.vao,".currentVAO.elements);",cr?"":"if("+dn+")"+Ke+".bindBuffer("+ip+","+dn+".buffer.buffer);","}")),dn}function Ze(){var bn=nt.count,dn,Jn=ue;return bn?((bn.contextDep&&lt.contextDynamic||bn.propDep)&&(Jn=Ge),dn=bn.append(Se,Jn),me.optional(function(){bn.MISSING&&Se.assert(ue,"false","missing vertex count"),bn.DYNAMIC&&Se.assert(Jn,dn+">=0","missing vertex count")})):(dn=Jn.def(Fe,".",gc),me.optional(function(){Se.assert(Jn,dn+">=0","missing vertex count")})),dn}var Ae=xe();function ct(bn){var dn=nt[bn];return dn?dn.contextDep&&lt.contextDynamic||dn.propDep?dn.append(Se,Ge):dn.append(Se,ue):ue.def(Fe,".",bn)}var Ct=ct(go),fr=ct(bf),Ur=Ze();if(typeof Ur=="number"){if(Ur===0)return}else Ge("if(",Ur,"){"),Ge.exit("}");var Vr,sn;br&&(Vr=ct(Wc),sn=Se.instancing);var Dr=Ae+".type",An=nt.elements&&Gl(nt.elements)&&!nt.vaoActive;function cn(){function bn(){Ge(sn,".drawElementsInstancedANGLE(",[Ct,Ur,Dr,fr+"<<(("+Dr+"-"+ii+")>>1)",Vr],");")}function dn(){Ge(sn,".drawArraysInstancedANGLE(",[Ct,fr,Ur,Vr],");")}Ae&&Ae!=="null"?An?bn():(Ge("if(",Ae,"){"),bn(),Ge("}else{"),dn(),Ge("}")):dn()}function xn(){function bn(){Ge(Ke+".drawElements("+[Ct,Ur,Dr,fr+"<<(("+Dr+"-"+ii+")>>1)"]+");")}function dn(){Ge(Ke+".drawArrays("+[Ct,fr,Ur]+");")}Ae&&Ae!=="null"?An?bn():(Ge("if(",Ae,"){"),bn(),Ge("}else{"),dn(),Ge("}")):dn()}br&&(typeof Vr!="number"||Vr>=0)?typeof Vr=="string"?(Ge("if(",Vr,">0){"),cn(),Ge("}else if(",Vr,"<0){"),xn(),Ge("}")):cn():xn()}function oi(Se,ue,Ge,lt,Lt){var Ke=Gn(),Fe=Ke.proc("body",Lt);return me.optional(function(){Ke.commandStr=ue.commandStr,Ke.command=Ke.link(ue.commandStr)}),br&&(Ke.instancing=Fe.def(Ke.shared.extensions,".angle_instanced_arrays")),Se(Ke,Fe,Ge,lt),Ke.compile().body}function zi(Se,ue,Ge,lt){io(Se,ue),Ge.useVAO?Ge.drawVAO?ue(Se.shared.vao,".setVAO(",Ge.drawVAO.append(Se,ue),");"):ue(Se.shared.vao,".setVAO(",Se.shared.vao,".targetVAO);"):(ue(Se.shared.vao,".setVAO(null);"),Yo(Se,ue,Ge,lt.attributes,function(){return!0})),ra(Se,ue,Ge,lt.uniforms,function(){return!0},!1),us(Se,ue,ue,Ge)}function ua(Se,ue){var Ge=Se.proc("draw",1);io(Se,Ge),wo(Se,Ge,ue.context),Wo(Se,Ge,ue.framebuffer),Xo(Se,Ge,ue),bs(Se,Ge,ue.state),Si(Se,Ge,ue,!1,!0);var lt=ue.shader.progVar.append(Se,Ge);if(Ge(Se.shared.gl,".useProgram(",lt,".program);"),ue.shader.program)zi(Se,Ge,ue,ue.shader.program);else{Ge(Se.shared.vao,".setVAO(null);");var Lt=Se.global.def("{}"),Ke=Ge.def(lt,".id"),Fe=Ge.def(Lt,"[",Ke,"]");Ge(Se.cond(Fe).then(Fe,".call(this,a0);").else(Fe,"=",Lt,"[",Ke,"]=",Se.link(function(nt){return oi(zi,Se,ue,nt,1)}),"(",lt,");",Fe,".call(this,a0);"))}Object.keys(ue.state).length>0&&Ge(Se.shared.current,".dirty=true;"),Se.shared.vao&&Ge(Se.shared.vao,".setVAO(null);")}function To(Se,ue,Ge,lt){Se.batchId="a1",io(Se,ue);function Lt(){return!0}Yo(Se,ue,Ge,lt.attributes,Lt),ra(Se,ue,Ge,lt.uniforms,Lt,!1),us(Se,ue,ue,Ge)}function wl(Se,ue,Ge,lt){io(Se,ue);var Lt=Ge.contextDep,Ke=ue.def(),Fe="a0",nt="a1",xe=ue.def();Se.shared.props=xe,Se.batchId=Ke;var Ze=Se.scope(),Ae=Se.scope();ue(Ze.entry,"for(",Ke,"=0;",Ke,"<",nt,";++",Ke,"){",xe,"=",Fe,"[",Ke,"];",Ae,"}",Ze.exit);function ct(Dr){return Dr.contextDep&&Lt||Dr.propDep}function Ct(Dr){return!ct(Dr)}if(Ge.needsContext&&wo(Se,Ae,Ge.context),Ge.needsFramebuffer&&Wo(Se,Ae,Ge.framebuffer),bs(Se,Ae,Ge.state,ct),Ge.profile&&ct(Ge.profile)&&Si(Se,Ae,Ge,!1,!0),lt)Ge.useVAO?Ge.drawVAO?ct(Ge.drawVAO)?Ae(Se.shared.vao,".setVAO(",Ge.drawVAO.append(Se,Ae),");"):Ze(Se.shared.vao,".setVAO(",Ge.drawVAO.append(Se,Ze),");"):Ze(Se.shared.vao,".setVAO(",Se.shared.vao,".targetVAO);"):(Ze(Se.shared.vao,".setVAO(null);"),Yo(Se,Ze,Ge,lt.attributes,Ct),Yo(Se,Ae,Ge,lt.attributes,ct)),ra(Se,Ze,Ge,lt.uniforms,Ct,!1),ra(Se,Ae,Ge,lt.uniforms,ct,!0),us(Se,Ze,Ae,Ge);else{var fr=Se.global.def("{}"),Ur=Ge.shader.progVar.append(Se,Ae),Vr=Ae.def(Ur,".id"),sn=Ae.def(fr,"[",Vr,"]");Ae(Se.shared.gl,".useProgram(",Ur,".program);","if(!",sn,"){",sn,"=",fr,"[",Vr,"]=",Se.link(function(Dr){return oi(To,Se,Ge,Dr,2)}),"(",Ur,");}",sn,".call(this,a0[",Ke,"],",Ke,");")}}function Te(Se,ue){var Ge=Se.proc("batch",2);Se.batchId="0",io(Se,Ge);var lt=!1,Lt=!0;Object.keys(ue.context).forEach(function(fr){lt=lt||ue.context[fr].propDep}),lt||(wo(Se,Ge,ue.context),Lt=!1);var Ke=ue.framebuffer,Fe=!1;Ke?(Ke.propDep?lt=Fe=!0:Ke.contextDep&&lt&&(Fe=!0),Fe||Wo(Se,Ge,Ke)):Wo(Se,Ge,null),ue.state.viewport&&ue.state.viewport.propDep&&(lt=!0);function nt(fr){return fr.contextDep&&lt||fr.propDep}Xo(Se,Ge,ue),bs(Se,Ge,ue.state,function(fr){return!nt(fr)}),(!ue.profile||!nt(ue.profile))&&Si(Se,Ge,ue,!1,"a1"),ue.contextDep=lt,ue.needsContext=Lt,ue.needsFramebuffer=Fe;var xe=ue.shader.progVar;if(xe.contextDep&&lt||xe.propDep)wl(Se,Ge,ue,null);else{var Ze=xe.append(Se,Ge);if(Ge(Se.shared.gl,".useProgram(",Ze,".program);"),ue.shader.program)wl(Se,Ge,ue,ue.shader.program);else{Ge(Se.shared.vao,".setVAO(null);");var Ae=Se.global.def("{}"),ct=Ge.def(Ze,".id"),Ct=Ge.def(Ae,"[",ct,"]");Ge(Se.cond(Ct).then(Ct,".call(this,a0,a1);").else(Ct,"=",Ae,"[",ct,"]=",Se.link(function(fr){return oi(wl,Se,ue,fr,2)}),"(",Ze,");",Ct,".call(this,a0,a1);"))}}Object.keys(ue.state).length>0&&Ge(Se.shared.current,".dirty=true;"),Se.shared.vao&&Ge(Se.shared.vao,".setVAO(null);")}function Ut(Se,ue){var Ge=Se.proc("scope",3);Se.batchId="a2";var lt=Se.shared,Lt=lt.current;wo(Se,Ge,ue.context),ue.framebuffer&&ue.framebuffer.append(Se,Ge),sp(Object.keys(ue.state)).forEach(function(Fe){var nt=ue.state[Fe],xe=nt.append(Se,Ge);uo(xe)?xe.forEach(function(Ze,Ae){Ge.set(Se.next[Fe],"["+Ae+"]",Ze)}):Ge.set(lt.next,"."+Fe,xe)}),Si(Se,Ge,ue,!0,!0),[nu,bf,gc,Wc,go].forEach(function(Fe){var nt=ue.draw[Fe];!nt||Ge.set(lt.draw,"."+Fe,""+nt.append(Se,Ge))}),Object.keys(ue.uniforms).forEach(function(Fe){var nt=ue.uniforms[Fe].append(Se,Ge);Array.isArray(nt)&&(nt="["+nt.join()+"]"),Ge.set(lt.uniforms,"["+ge.id(Fe)+"]",nt)}),Object.keys(ue.attributes).forEach(function(Fe){var nt=ue.attributes[Fe].append(Se,Ge),xe=Se.scopeAttrib(Fe);Object.keys(new ut).forEach(function(Ze){Ge.set(xe,"."+Ze,nt[Ze])})}),ue.scopeVAO&&Ge.set(lt.vao,".targetVAO",ue.scopeVAO.append(Se,Ge));function Ke(Fe){var nt=ue.shader[Fe];nt&&Ge.set(lt.shader,"."+Fe,nt.append(Se,Ge))}Ke(Zl),Ke(Xu),Object.keys(ue.state).length>0&&(Ge(Lt,".dirty=true;"),Ge.exit(Lt,".dirty=true;")),Ge("a1(",Se.shared.context,",a0,",Se.batchId,");")}function St(Se){if(!(typeof Se!="object"||uo(Se))){for(var ue=Object.keys(Se),Ge=0;Ge<ue.length;++Ge)if(fn.isDynamic(Se[ue[Ge]]))return!0;return!1}}function mn(Se,ue,Ge){var lt=ue.static[Ge];if(!lt||!St(lt))return;var Lt=Se.global,Ke=Object.keys(lt),Fe=!1,nt=!1,xe=!1,Ze=Se.global.def("{}");Ke.forEach(function(ct){var Ct=lt[ct];if(fn.isDynamic(Ct)){typeof Ct=="function"&&(Ct=lt[ct]=fn.unbox(Ct));var fr=Ys(Ct,null);Fe=Fe||fr.thisDep,xe=xe||fr.propDep,nt=nt||fr.contextDep}else{switch(Lt(Ze,".",ct,"="),typeof Ct){case"number":Lt(Ct);break;case"string":Lt('"',Ct,'"');break;case"object":Array.isArray(Ct)&&Lt("[",Ct.join(),"]");break;default:Lt(Se.link(Ct));break}Lt(";")}});function Ae(ct,Ct){Ke.forEach(function(fr){var Ur=lt[fr];if(!!fn.isDynamic(Ur)){var Vr=ct.invoke(Ct,Ur);Ct(Ze,".",fr,"=",Vr,";")}})}ue.dynamic[Ge]=new fn.DynamicVariable(Ho,{thisDep:Fe,contextDep:nt,propDep:xe,ref:Ze,append:Ae}),delete ue.static[Ge]}function Hi(Se,ue,Ge,lt,Lt){var Ke=Gn();Ke.stats=Ke.link(Lt),Object.keys(ue.static).forEach(function(nt){mn(Ke,ue,nt)}),Td.forEach(function(nt){mn(Ke,Se,nt)});var Fe=as(Se,ue,Ge,lt,Ke);return ua(Ke,Fe),Ut(Ke,Fe),Te(Ke,Fe),m(Ke.compile(),{destroy:function(){Fe.shader.program.destroy()}})}return{next:zr,current:or,procs:function(){var Se=Gn(),ue=Se.proc("poll"),Ge=Se.proc("refresh"),lt=Se.block();ue(lt),Ge(lt);var Lt=Se.shared,Ke=Lt.gl,Fe=Lt.next,nt=Lt.current;lt(nt,".dirty=false;"),Wo(Se,ue),Wo(Se,Ge,null,!0);var xe;br&&(xe=Se.link(br)),Be.oes_vertex_array_object&&Ge(Se.link(Be.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var Ze=0;Ze<Dt.maxAttributes;++Ze){var Ae=Ge.def(Lt.attributes,"[",Ze,"]"),ct=Se.cond(Ae,".buffer");ct.then(Ke,".enableVertexAttribArray(",Ze,");",Ke,".bindBuffer(",Ef,",",Ae,".buffer.buffer);",Ke,".vertexAttribPointer(",Ze,",",Ae,".size,",Ae,".type,",Ae,".normalized,",Ae,".stride,",Ae,".offset);").else(Ke,".disableVertexAttribArray(",Ze,");",Ke,".vertexAttrib4f(",Ze,",",Ae,".x,",Ae,".y,",Ae,".z,",Ae,".w);",Ae,".buffer=null;"),Ge(ct),br&&Ge(xe,".vertexAttribDivisorANGLE(",Ze,",",Ae,".divisor);")}return Ge(Se.shared.vao,".currentVAO=null;",Se.shared.vao,".setVAO(",Se.shared.vao,".targetVAO);"),Object.keys(tr).forEach(function(Ct){var fr=tr[Ct],Ur=lt.def(Fe,".",Ct),Vr=Se.block();Vr("if(",Ur,"){",Ke,".enable(",fr,")}else{",Ke,".disable(",fr,")}",nt,".",Ct,"=",Ur,";"),Ge(Vr),ue("if(",Ur,"!==",nt,".",Ct,"){",Vr,"}")}),Object.keys(ir).forEach(function(Ct){var fr=ir[Ct],Ur=or[Ct],Vr,sn,Dr=Se.block();if(Dr(Ke,".",fr,"("),uo(Ur)){var An=Ur.length;Vr=Se.global.def(Fe,".",Ct),sn=Se.global.def(nt,".",Ct),Dr(He(An,function(cn){return Vr+"["+cn+"]"}),");",He(An,function(cn){return sn+"["+cn+"]="+Vr+"["+cn+"];"}).join("")),ue("if(",He(An,function(cn){return Vr+"["+cn+"]!=="+sn+"["+cn+"]"}).join("||"),"){",Dr,"}")}else Vr=lt.def(Fe,".",Ct),sn=lt.def(nt,".",Ct),Dr(Vr,");",nt,".",Ct,"=",Vr,";"),ue("if(",Vr,"!==",sn,"){",Dr,"}");Ge(Dr)}),Se.compile()}(),compile:Hi}}function nh(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var Rd=34918,Ld=34919,Dh=35007,qp=function(B,ge){if(!ge.ext_disjoint_timer_query)return null;var Be=[];function Dt(){return Be.pop()||ge.ext_disjoint_timer_query.createQueryEXT()}function sr(br){Be.push(br)}var kt=[];function er(br){var Br=Dt();ge.ext_disjoint_timer_query.beginQueryEXT(Dh,Br),kt.push(Br),_r(kt.length-1,kt.length,br)}function hr(){ge.ext_disjoint_timer_query.endQueryEXT(Dh)}function mr(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var xr=[];function Tr(){return xr.pop()||new mr}function Rr(br){xr.push(br)}var Gr=[];function _r(br,Br,cr){var or=Tr();or.startQueryIndex=br,or.endQueryIndex=Br,or.sum=0,or.stats=cr,Gr.push(or)}var Mr=[],ut=[];function Gt(){var br,Br,cr=kt.length;if(cr!==0){ut.length=Math.max(ut.length,cr+1),Mr.length=Math.max(Mr.length,cr+1),Mr[0]=0,ut[0]=0;var or=0;for(br=0,Br=0;Br<kt.length;++Br){var zr=kt[Br];ge.ext_disjoint_timer_query.getQueryObjectEXT(zr,Ld)?(or+=ge.ext_disjoint_timer_query.getQueryObjectEXT(zr,Rd),sr(zr)):kt[br++]=zr,Mr[Br+1]=or,ut[Br+1]=br}for(kt.length=br,br=0,Br=0;Br<Gr.length;++Br){var Un=Gr[Br],tr=Un.startQueryIndex,ir=Un.endQueryIndex;Un.sum+=Mr[ir]-Mr[tr];var Sn=ut[tr],Xr=ut[ir];Xr===Sn?(Un.stats.gpuTime+=Un.sum/1e6,Rr(Un)):(Un.startQueryIndex=Sn,Un.endQueryIndex=Xr,Gr[br++]=Un)}Gr.length=br}}return{beginQuery:er,endQuery:hr,pushScopeStats:_r,update:Gt,getNumPendingQueries:function(){return kt.length},clear:function(){Be.push.apply(Be,kt);for(var br=0;br<Be.length;br++)ge.ext_disjoint_timer_query.deleteQueryEXT(Be[br]);kt.length=0,Be.length=0},restore:function(){kt.length=0,Be.length=0}}},Kp=16384,Af=256,lp=1024,$p=34962,wf="webglcontextlost",Sa="webglcontextrestored",ih=1,Hl=2,Tf=3;function cp(B,ge){for(var Be=0;Be<B.length;++Be)if(B[Be]===ge)return Be;return-1}function kd(B){var ge=ye(B);if(!ge)return null;var Be=ge.gl,Dt=Be.getContextAttributes(),sr=Be.isContextLost(),kt=Pe(Be,ge);if(!kt)return null;var er=Es(),hr=nh(),mr=kt.extensions,xr=qp(Be,mr),Tr=to(),Rr=Be.drawingBufferWidth,Gr=Be.drawingBufferHeight,_r={tick:0,time:0,viewportWidth:Rr,viewportHeight:Gr,framebufferWidth:Rr,framebufferHeight:Gr,drawingBufferWidth:Rr,drawingBufferHeight:Gr,pixelRatio:ge.pixelRatio},Mr={},ut={elements:null,primitive:4,count:-1,offset:0,instances:-1},Gt=ll(Be,mr),br=F(Be,hr,ge,or),Br=tl(Be,mr,br,hr),cr=yt(Be,mr,Gt,hr,br,Br,ut);function or(oi){return cr.destroyBuffer(oi)}var zr=Fr(Be,er,hr,ge),Un=gs(Be,mr,Gt,function(){Sn.procs.poll()},_r,hr,ge),tr=yl(Be,mr,Gt,hr,ge),ir=Re(Be,mr,Gt,Un,tr,hr),Sn=up(Be,er,mr,Gt,br,Br,Un,ir,Mr,cr,zr,ut,_r,xr,ge),Xr=Mn(Be,ir,Sn.procs.poll,_r,Dt,mr,Gt),Sr=Sn.next,Hr=Be.canvas,Jr=[],Ei=[],Gn=[],jr=[ge.onDestroy],en=null;function ni(){if(Jr.length===0){xr&&xr.update(),en=null;return}en=Di.next(ni),io();for(var oi=Jr.length-1;oi>=0;--oi){var zi=Jr[oi];zi&&zi(_r,null,0)}Be.flush(),xr&&xr.update()}function ui(){!en&&Jr.length>0&&(en=Di.next(ni))}function Ni(){en&&(Di.cancel(ni),en=null)}function Ga(oi){oi.preventDefault(),sr=!0,Ni(),Ei.forEach(function(zi){zi()})}function no(oi){Be.getError(),sr=!1,kt.restore(),zr.restore(),br.restore(),Un.restore(),tr.restore(),ir.restore(),cr.restore(),xr&&xr.restore(),Sn.procs.refresh(),ui(),Gn.forEach(function(zi){zi()})}var Zi=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;!Zi&&Hr&&(Hr.addEventListener(wf,Ga,!1),Hr.addEventListener(Sa,no,!1));function ss(){Jr.length=0,Ni(),!Zi&&Hr&&(Hr.removeEventListener(wf,Ga),Hr.removeEventListener(Sa,no)),zr.clear(),ir.clear(),tr.clear(),cr.clear(),Un.clear(),Br.clear(),br.clear(),xr&&xr.clear(),jr.forEach(function(oi){oi()})}function Ha(oi){me(!!oi,"invalid args to regl({...})"),me.type(oi,"object","invalid args to regl({...})");function zi(Ke){var Fe=m({},Ke);delete Fe.uniforms,delete Fe.attributes,delete Fe.context,delete Fe.vao,"stencil"in Fe&&Fe.stencil.op&&(Fe.stencil.opBack=Fe.stencil.opFront=Fe.stencil.op,delete Fe.stencil.op);function nt(xe){if(xe in Fe){var Ze=Fe[xe];delete Fe[xe],Object.keys(Ze).forEach(function(Ae){Fe[xe+"."+Ae]=Ze[Ae]})}}return nt("blend"),nt("depth"),nt("cull"),nt("stencil"),nt("polygonOffset"),nt("scissor"),nt("sample"),"vao"in Ke&&(Fe.vao=Ke.vao),Fe}function ua(Ke,Fe){var nt={},xe={};return Object.keys(Ke).forEach(function(Ze){var Ae=Ke[Ze];if(fn.isDynamic(Ae)){xe[Ze]=fn.unbox(Ae,Ze);return}else if(Fe&&Array.isArray(Ae)){for(var ct=0;ct<Ae.length;++ct)if(fn.isDynamic(Ae[ct])){xe[Ze]=fn.unbox(Ae,Ze);return}}nt[Ze]=Ae}),{dynamic:xe,static:nt}}var To=ua(oi.context||{},!0),wl=ua(oi.uniforms||{},!0),Te=ua(oi.attributes||{},!1),Ut=ua(zi(oi),!1),St={gpuTime:0,cpuTime:0,count:0},mn=Sn.compile(Ut,Te,wl,To,St),Hi=mn.draw,Se=mn.batch,ue=mn.scope,Ge=[];function lt(Ke){for(;Ge.length<Ke;)Ge.push(null);return Ge}function Lt(Ke,Fe){var nt;if(sr&&me.raise("context lost"),typeof Ke=="function")return ue.call(this,null,Ke,0);if(typeof Fe=="function")if(typeof Ke=="number")for(nt=0;nt<Ke;++nt)ue.call(this,null,Fe,nt);else if(Array.isArray(Ke))for(nt=0;nt<Ke.length;++nt)ue.call(this,Ke[nt],Fe,nt);else return ue.call(this,Ke,Fe,0);else if(typeof Ke=="number"){if(Ke>0)return Se.call(this,lt(Ke|0),Ke|0)}else if(Array.isArray(Ke)){if(Ke.length)return Se.call(this,Ke,Ke.length)}else return Hi.call(this,Ke)}return m(Lt,{stats:St,destroy:function(){mn.destroy()}})}var as=ir.setFBO=Ha({framebuffer:fn.define.call(null,ih,"framebuffer")});function wo(oi,zi){var ua=0;Sn.procs.poll();var To=zi.color;To&&(Be.clearColor(+To[0]||0,+To[1]||0,+To[2]||0,+To[3]||0),ua|=Kp),"depth"in zi&&(Be.clearDepth(+zi.depth),ua|=Af),"stencil"in zi&&(Be.clearStencil(zi.stencil|0),ua|=lp),me(!!ua,"called regl.clear with no buffer specified"),Be.clear(ua)}function Wo(oi){if(me(typeof oi=="object"&&oi,"regl.clear() takes an object as input"),"framebuffer"in oi)if(oi.framebuffer&&oi.framebuffer_reglType==="framebufferCube")for(var zi=0;zi<6;++zi)as(m({framebuffer:oi.framebuffer.faces[zi]},oi),wo);else as(oi,wo);else wo(null,oi)}function Xo(oi){me.type(oi,"function","regl.frame() callback must be a function"),Jr.push(oi);function zi(){var ua=cp(Jr,oi);me(ua>=0,"cannot cancel a frame twice");function To(){var wl=cp(Jr,To);Jr[wl]=Jr[Jr.length-1],Jr.length-=1,Jr.length<=0&&Ni()}Jr[ua]=To}return ui(),{cancel:zi}}function bs(){var oi=Sr.viewport,zi=Sr.scissor_box;oi[0]=oi[1]=zi[0]=zi[1]=0,_r.viewportWidth=_r.framebufferWidth=_r.drawingBufferWidth=oi[2]=zi[2]=Be.drawingBufferWidth,_r.viewportHeight=_r.framebufferHeight=_r.drawingBufferHeight=oi[3]=zi[3]=Be.drawingBufferHeight}function io(){_r.tick+=1,_r.time=Yo(),bs(),Sn.procs.poll()}function Si(){Un.refresh(),bs(),Sn.procs.refresh(),xr&&xr.update()}function Yo(){return(to()-Tr)/1e3}Si();function ra(oi,zi){me.type(zi,"function","listener callback must be a function");var ua;switch(oi){case"frame":return Xo(zi);case"lost":ua=Ei;break;case"restore":ua=Gn;break;case"destroy":ua=jr;break;default:me.raise("invalid event, must be one of frame,lost,restore,destroy")}return ua.push(zi),{cancel:function(){for(var To=0;To<ua.length;++To)if(ua[To]===zi){ua[To]=ua[ua.length-1],ua.pop();return}}}}var us=m(Ha,{clear:Wo,prop:fn.define.bind(null,ih),context:fn.define.bind(null,Hl),this:fn.define.bind(null,Tf),draw:Ha({}),buffer:function(oi){return br.create(oi,$p,!1,!1)},elements:function(oi){return Br.create(oi,!1)},texture:Un.create2D,cube:Un.createCube,renderbuffer:tr.create,framebuffer:ir.create,framebufferCube:ir.createCube,vao:cr.createVAO,attributes:Dt,frame:Xo,on:ra,limits:Gt,hasExtension:function(oi){return Gt.extensions.indexOf(oi.toLowerCase())>=0},read:Xr,destroy:ss,_gl:Be,_refresh:Si,poll:function(){io(),xr&&xr.update()},now:Yo,stats:hr});return ge.onDone(null,us),us}return kd})},77412:function(It){function $(U,ae){for(var re=-1,m=U==null?0:U.length;++re<m&&ae(U[re],re,U)!==!1;);return U}It.exports=$},47443:function(It,$,U){var ae=U(42118);function re(m,ve){var Z=m==null?0:m.length;return!!Z&&ae(m,ve,0)>-1}It.exports=re},1196:function(It){function $(U,ae,re){for(var m=-1,ve=U==null?0:U.length;++m<ve;)if(re(ae,U[m]))return!0;return!1}It.exports=$},62663:function(It){function $(U,ae,re,m){var ve=-1,Z=U==null?0:U.length;for(m&&Z&&(re=U[++ve]);++ve<Z;)re=ae(re,U[ve],ve,U);return re}It.exports=$},49029:function(It){var $=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;function U(ae){return ae.match($)||[]}It.exports=U},44037:function(It,$,U){var ae=U(98363),re=U(3674);function m(ve,Z){return ve&&ae(Z,re(Z),ve)}It.exports=m},63886:function(It,$,U){var ae=U(98363),re=U(81704);function m(ve,Z){return ve&&ae(Z,re(Z),ve)}It.exports=m},29750:function(It){function $(U,ae,re){return U===U&&(re!==void 0&&(U=U<=re?U:re),ae!==void 0&&(U=U>=ae?U:ae)),U}It.exports=$},85990:function(It,$,U){var ae=U(46384),re=U(77412),m=U(34865),ve=U(44037),Z=U(63886),le=U(64626),fe=U(278),Le=U(18805),J=U(1911),Xe=U(58234),et=U(46904),Ue=U(64160),gt=U(43824),rr=U(29148),xt=U(38517),Yt=U(1469),Et=U(44144),at=U(56688),it=U(13218),Zt=U(72928),Y=U(3674),$t=U(81704),ft=1,Je=2,At=4,Qe="[object Arguments]",Qt="[object Array]",Er="[object Boolean]",Nr="[object Date]",tn="[object Error]",A="[object Function]",Ce="[object GeneratorFunction]",De="[object Map]",wt="[object Number]",mt="[object Object]",Bt="[object RegExp]",Kt="[object Set]",Cr="[object String]",ei="[object Symbol]",vn="[object WeakMap]",di="[object ArrayBuffer]",Wn="[object DataView]",si="[object Float32Array]",vi="[object Float64Array]",qn="[object Int8Array]",mi="[object Int16Array]",aa="[object Int32Array]",Wi="[object Uint8Array]",Oi="[object Uint8ClampedArray]",Ki="[object Uint16Array]",oa="[object Uint32Array]",Mi={};Mi[Qe]=Mi[Qt]=Mi[di]=Mi[Wn]=Mi[Er]=Mi[Nr]=Mi[si]=Mi[vi]=Mi[qn]=Mi[mi]=Mi[aa]=Mi[De]=Mi[wt]=Mi[mt]=Mi[Bt]=Mi[Kt]=Mi[Cr]=Mi[ei]=Mi[Wi]=Mi[Oi]=Mi[Ki]=Mi[oa]=!0,Mi[tn]=Mi[A]=Mi[vn]=!1;function da($n,wi,ji,$i,zo,me){var Dn,Za=wi&ft,hs=wi&Je,Nt=wi&At;if(ji&&(Dn=zo?ji($n,$i,zo,me):ji($n)),Dn!==void 0)return Dn;if(!it($n))return $n;var nr=Yt($n);if(nr){if(Dn=gt($n),!Za)return fe($n,Dn)}else{var Ar=Ue($n),rn=Ar==A||Ar==Ce;if(Et($n))return le($n,Za);if(Ar==mt||Ar==Qe||rn&&!zo){if(Dn=hs||rn?{}:xt($n),!Za)return hs?J($n,Z(Dn,$n)):Le($n,ve(Dn,$n))}else{if(!Mi[Ar])return zo?$n:{};Dn=rr($n,Ar,Za)}}me||(me=new ae);var wn=me.get($n);if(wn)return wn;me.set($n,Dn),Zt($n)?$n.forEach(function(ti){Dn.add(da(ti,wi,ji,ti,$n,me))}):at($n)&&$n.forEach(function(ti,fn){Dn.set(fn,da(ti,wi,ji,fn,$n,me))});var Fn=Nt?hs?et:Xe:hs?$t:Y,gi=nr?void 0:Fn($n);return re(gi||$n,function(ti,fn){gi&&(fn=ti,ti=$n[fn]),m(Dn,fn,da(ti,wi,ji,fn,$n,me))}),Dn}It.exports=da},41848:function(It){function $(U,ae,re,m){for(var ve=U.length,Z=re+(m?1:-1);m?Z--:++Z<ve;)if(ae(U[Z],Z,U))return Z;return-1}It.exports=$},42118:function(It,$,U){var ae=U(41848),re=U(62722),m=U(42351);function ve(Z,le,fe){return le===le?m(Z,le,fe):ae(Z,re,fe)}It.exports=ve},25588:function(It,$,U){var ae=U(64160),re=U(37005),m="[object Map]";function ve(Z){return re(Z)&&ae(Z)==m}It.exports=ve},62722:function(It){function $(U){return U!==U}It.exports=$},29221:function(It,$,U){var ae=U(64160),re=U(37005),m="[object Set]";function ve(Z){return re(Z)&&ae(Z)==m}It.exports=ve},40371:function(It){function $(U){return function(ae){return ae==null?void 0:ae[U]}}It.exports=$},18674:function(It){function $(U){return function(ae){return U==null?void 0:U[ae]}}It.exports=$},45652:function(It,$,U){var ae=U(88668),re=U(47443),m=U(1196),ve=U(74757),Z=U(23593),le=U(21814),fe=200;function Le(J,Xe,et){var Ue=-1,gt=re,rr=J.length,xt=!0,Yt=[],Et=Yt;if(et)xt=!1,gt=m;else if(rr>=fe){var at=Xe?null:Z(J);if(at)return le(at);xt=!1,gt=ve,Et=new ae}else Et=Xe?[]:Yt;e:for(;++Ue<rr;){var it=J[Ue],Zt=Xe?Xe(it):it;if(it=et||it!==0?it:0,xt&&Zt===Zt){for(var Y=Et.length;Y--;)if(Et[Y]===Zt)continue e;Xe&&Et.push(Zt),Yt.push(it)}else gt(Et,Zt,et)||(Et!==Yt&&Et.push(Zt),Yt.push(it))}return Yt}It.exports=Le},57157:function(It,$,U){var ae=U(74318);function re(m,ve){var Z=ve?ae(m.buffer):m.buffer;return new m.constructor(Z,m.byteOffset,m.byteLength)}It.exports=re},93147:function(It){var $=/\w*$/;function U(ae){var re=new ae.constructor(ae.source,$.exec(ae));return re.lastIndex=ae.lastIndex,re}It.exports=U},40419:function(It,$,U){var ae=U(62705),re=ae?ae.prototype:void 0,m=re?re.valueOf:void 0;function ve(Z){return m?Object(m.call(Z)):{}}It.exports=ve},18805:function(It,$,U){var ae=U(98363),re=U(99551);function m(ve,Z){return ae(ve,re(ve),Z)}It.exports=m},1911:function(It,$,U){var ae=U(98363),re=U(51442);function m(ve,Z){return ae(ve,re(ve),Z)}It.exports=m},98805:function(It,$,U){var ae=U(40180),re=U(62689),m=U(83140),ve=U(79833);function Z(le){return function(fe){fe=ve(fe);var Le=re(fe)?m(fe):void 0,J=Le?Le[0]:fe.charAt(0),Xe=Le?ae(Le,1).join(""):fe.slice(1);return J[le]()+Xe}}It.exports=Z},35393:function(It,$,U){var ae=U(62663),re=U(53816),m=U(58748),ve="['\u2019]",Z=RegExp(ve,"g");function le(fe){return function(Le){return ae(m(re(Le).replace(Z,"")),fe,"")}}It.exports=le},23593:function(It,$,U){var ae=U(58525),re=U(50308),m=U(21814),ve=1/0,Z=ae&&1/m(new ae([,-0]))[1]==ve?function(le){return new ae(le)}:re;It.exports=Z},69389:function(It,$,U){var ae=U(18674),re={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},m=ae(re);It.exports=m},46904:function(It,$,U){var ae=U(68866),re=U(51442),m=U(81704);function ve(Z){return ae(Z,m,re)}It.exports=ve},51442:function(It,$,U){var ae=U(62488),re=U(85924),m=U(99551),ve=U(70479),Z=Object.getOwnPropertySymbols,le=Z?function(fe){for(var Le=[];fe;)ae(Le,m(fe)),fe=re(fe);return Le}:ve;It.exports=le},93157:function(It){var $=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;function U(ae){return $.test(ae)}It.exports=U},43824:function(It){var $=Object.prototype,U=$.hasOwnProperty;function ae(re){var m=re.length,ve=new re.constructor(m);return m&&typeof re[0]=="string"&&U.call(re,"index")&&(ve.index=re.index,ve.input=re.input),ve}It.exports=ae},29148:function(It,$,U){var ae=U(74318),re=U(57157),m=U(93147),ve=U(40419),Z=U(77133),le="[object Boolean]",fe="[object Date]",Le="[object Map]",J="[object Number]",Xe="[object RegExp]",et="[object Set]",Ue="[object String]",gt="[object Symbol]",rr="[object ArrayBuffer]",xt="[object DataView]",Yt="[object Float32Array]",Et="[object Float64Array]",at="[object Int8Array]",it="[object Int16Array]",Zt="[object Int32Array]",Y="[object Uint8Array]",$t="[object Uint8ClampedArray]",ft="[object Uint16Array]",Je="[object Uint32Array]";function At(Qe,Qt,Er){var Nr=Qe.constructor;switch(Qt){case rr:return ae(Qe);case le:case fe:return new Nr(+Qe);case xt:return re(Qe,Er);case Yt:case Et:case at:case it:case Zt:case Y:case $t:case ft:case Je:return Z(Qe,Er);case Le:return new Nr;case J:case Ue:return new Nr(Qe);case Xe:return m(Qe);case et:return new Nr;case gt:return ve(Qe)}}It.exports=At},42351:function(It){function $(U,ae,re){for(var m=re-1,ve=U.length;++m<ve;)if(U[m]===ae)return m;return-1}It.exports=$},2757:function(It){var $="\\ud800-\\udfff",U="\\u0300-\\u036f",ae="\\ufe20-\\ufe2f",re="\\u20d0-\\u20ff",m=U+ae+re,ve="\\u2700-\\u27bf",Z="a-z\\xdf-\\xf6\\xf8-\\xff",le="\\xac\\xb1\\xd7\\xf7",fe="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Le="\\u2000-\\u206f",J=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Xe="A-Z\\xc0-\\xd6\\xd8-\\xde",et="\\ufe0e\\ufe0f",Ue=le+fe+Le+J,gt="['\u2019]",rr="["+Ue+"]",xt="["+m+"]",Yt="\\d+",Et="["+ve+"]",at="["+Z+"]",it="[^"+$+Ue+Yt+ve+Z+Xe+"]",Zt="\\ud83c[\\udffb-\\udfff]",Y="(?:"+xt+"|"+Zt+")",$t="[^"+$+"]",ft="(?:\\ud83c[\\udde6-\\uddff]){2}",Je="[\\ud800-\\udbff][\\udc00-\\udfff]",At="["+Xe+"]",Qe="\\u200d",Qt="(?:"+at+"|"+it+")",Er="(?:"+At+"|"+it+")",Nr="(?:"+gt+"(?:d|ll|m|re|s|t|ve))?",tn="(?:"+gt+"(?:D|LL|M|RE|S|T|VE))?",A=Y+"?",Ce="["+et+"]?",De="(?:"+Qe+"(?:"+[$t,ft,Je].join("|")+")"+Ce+A+")*",wt="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",mt="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Bt=Ce+A+De,Kt="(?:"+[Et,ft,Je].join("|")+")"+Bt,Cr=RegExp([At+"?"+at+"+"+Nr+"(?="+[rr,At,"$"].join("|")+")",Er+"+"+tn+"(?="+[rr,At+Qt,"$"].join("|")+")",At+"?"+Qt+"+"+Nr,At+"+"+tn,mt,wt,Yt,Kt].join("|"),"g");function ei(vn){return vn.match(Cr)||[]}It.exports=ei},68929:function(It,$,U){var ae=U(48403),re=U(35393),m=re(function(ve,Z,le){return Z=Z.toLowerCase(),ve+(le?ae(Z):Z)});It.exports=m},48403:function(It,$,U){var ae=U(79833),re=U(11700);function m(ve){return re(ae(ve).toLowerCase())}It.exports=m},74691:function(It,$,U){var ae=U(29750),re=U(14841);function m(ve,Z,le){return le===void 0&&(le=Z,Z=void 0),le!==void 0&&(le=re(le),le=le===le?le:0),Z!==void 0&&(Z=re(Z),Z=Z===Z?Z:0),ae(re(ve),Z,le)}It.exports=m},50361:function(It,$,U){var ae=U(85990),re=1,m=4;function ve(Z){return ae(Z,re|m)}It.exports=ve},53816:function(It,$,U){var ae=U(69389),re=U(79833),m=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,ve="\\u0300-\\u036f",Z="\\ufe20-\\ufe2f",le="\\u20d0-\\u20ff",fe=ve+Z+le,Le="["+fe+"]",J=RegExp(Le,"g");function Xe(et){return et=re(et),et&&et.replace(m,ae).replace(J,"")}It.exports=Xe},56688:function(It,$,U){var ae=U(25588),re=U(7518),m=U(31167),ve=m&&m.isMap,Z=ve?re(ve):ae;It.exports=Z},14293:function(It){function $(U){return U==null}It.exports=$},81763:function(It,$,U){var ae=U(44239),re=U(37005),m="[object Number]";function ve(Z){return typeof Z=="number"||re(Z)&&ae(Z)==m}It.exports=ve},72928:function(It,$,U){var ae=U(29221),re=U(7518),m=U(31167),ve=m&&m.isSet,Z=ve?re(ve):ae;It.exports=Z},47037:function(It,$,U){var ae=U(44239),re=U(1469),m=U(37005),ve="[object String]";function Z(le){return typeof le=="string"||!re(le)&&m(le)&&ae(le)==ve}It.exports=Z},52353:function(It){function $(U){return U===void 0}It.exports=$},30236:function(It,$,U){var ae=U(42980),re=U(21463),m=re(function(ve,Z,le,fe){ae(ve,Z,le,fe)});It.exports=m},50308:function(It){function $(){}It.exports=$},44908:function(It,$,U){var ae=U(45652);function re(m){return m&&m.length?ae(m):[]}It.exports=re},11700:function(It,$,U){var ae=U(98805),re=ae("toUpperCase");It.exports=re},58748:function(It,$,U){var ae=U(49029),re=U(93157),m=U(79833),ve=U(2757);function Z(le,fe,Le){return le=m(le),fe=Le?void 0:fe,fe===void 0?re(le)?ve(le):ae(le):le.match(fe)||[]}It.exports=Z},6158:function(It){(function($,U){It.exports=U()})(this,function(){"use strict";var $,U,ae;function re(m,ve){if(!$)$=ve;else if(!U)U=ve;else{var Z="var sharedChunk = {}; ("+$+")(sharedChunk); ("+U+")(sharedChunk);",le={};$(le),ae=ve(le),typeof window!="undefined"&&(ae.workerUrl=window.URL.createObjectURL(new Blob([Z],{type:"text/javascript"})))}}return re(["exports"],function(m){"use strict";function ve(t,o){return t(o={exports:{}},o.exports),o.exports}var Z=le;function le(t,o,u,p){this.cx=3*t,this.bx=3*(u-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(p-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=p,this.p2x=u,this.p2y=p}le.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},le.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},le.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},le.prototype.solveCurveX=function(t,o){var u,p,y,b,S;for(o===void 0&&(o=1e-6),y=t,S=0;S<8;S++){if(b=this.sampleCurveX(y)-t,Math.abs(b)<o)return y;var I=this.sampleCurveDerivativeX(y);if(Math.abs(I)<1e-6)break;y-=b/I}if((y=t)<(u=0))return u;if(y>(p=1))return p;for(;u<p;){if(b=this.sampleCurveX(y),Math.abs(b-t)<o)return y;t>b?u=y:p=y,y=.5*(p-u)+u}return y},le.prototype.solve=function(t,o){return this.sampleCurveY(this.solveCurveX(t,o))};var fe=Le;function Le(t,o){this.x=t,this.y=o}Le.prototype={clone:function(){return new Le(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,o){return this.clone()._rotateAround(t,o)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var o=t.x-this.x,u=t.y-this.y;return o*o+u*u},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,o){return Math.atan2(this.x*o-this.y*t,this.x*t+this.y*o)},_matMult:function(t){var o=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=o,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var o=Math.cos(t),u=Math.sin(t),p=u*this.x+o*this.y;return this.x=o*this.x-u*this.y,this.y=p,this},_rotateAround:function(t,o){var u=Math.cos(t),p=Math.sin(t),y=o.y+p*(this.x-o.x)+u*(this.y-o.y);return this.x=o.x+u*(this.x-o.x)-p*(this.y-o.y),this.y=y,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Le.convert=function(t){return t instanceof Le?t:Array.isArray(t)?new Le(t[0],t[1]):t};var J=typeof self!="undefined"?self:{},Xe=Math.pow(2,53)-1;function et(t,o,u,p){var y=new Z(t,o,u,p);return function(b){return y.solve(b)}}var Ue=et(.25,.1,.25,1);function gt(t,o,u){return Math.min(u,Math.max(o,t))}function rr(t,o,u){var p=u-o,y=((t-o)%p+p)%p+o;return y===o?u:y}function xt(t){for(var o=[],u=arguments.length-1;u-- >0;)o[u]=arguments[u+1];for(var p=0,y=o;p<y.length;p+=1){var b=y[p];for(var S in b)t[S]=b[S]}return t}var Yt=1;function Et(){return Yt++}function at(){return function t(o){return o?(o^16*Math.random()>>o/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function it(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function Zt(t,o){t.forEach(function(u){o[u]&&(o[u]=o[u].bind(o))})}function Y(t,o){return t.indexOf(o,t.length-o.length)!==-1}function $t(t,o,u){var p={};for(var y in t)p[y]=o.call(u||this,t[y],y,t);return p}function ft(t,o,u){var p={};for(var y in t)o.call(u||this,t[y],y,t)&&(p[y]=t[y]);return p}function Je(t){return Array.isArray(t)?t.map(Je):typeof t=="object"&&t?$t(t,Je):t}var At={};function Qe(t){At[t]||(typeof console!="undefined"&&console.warn(t),At[t]=!0)}function Qt(t,o,u){return(u.y-t.y)*(o.x-t.x)>(o.y-t.y)*(u.x-t.x)}function Er(t){for(var o=0,u=0,p=t.length,y=p-1,b=void 0,S=void 0;u<p;y=u++)o+=((S=t[y]).x-(b=t[u]).x)*(b.y+S.y);return o}function Nr(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function tn(t){var o={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(p,y,b,S){var I=b||S;return o[y]=!I||I.toLowerCase(),""}),o["max-age"]){var u=parseInt(o["max-age"],10);isNaN(u)?delete o["max-age"]:o["max-age"]=u}return o}var A=null;function Ce(t){if(A==null){var o=t.navigator?t.navigator.userAgent:null;A=!!t.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return A}function De(t){try{var o=J[t];return o.setItem("_mapbox_test_",1),o.removeItem("_mapbox_test_"),!0}catch(u){return!1}}var wt,mt,Bt,Kt,Cr=J.performance&&J.performance.now?J.performance.now.bind(J.performance):Date.now.bind(Date),ei=J.requestAnimationFrame||J.mozRequestAnimationFrame||J.webkitRequestAnimationFrame||J.msRequestAnimationFrame,vn=J.cancelAnimationFrame||J.mozCancelAnimationFrame||J.webkitCancelAnimationFrame||J.msCancelAnimationFrame,di={now:Cr,frame:function(t){var o=ei(t);return{cancel:function(){return vn(o)}}},getImageData:function(t,o){o===void 0&&(o=0);var u=J.document.createElement("canvas"),p=u.getContext("2d");if(!p)throw new Error("failed to create canvas 2d context");return u.width=t.width,u.height=t.height,p.drawImage(t,0,0,t.width,t.height),p.getImageData(-o,-o,t.width+2*o,t.height+2*o)},resolveURL:function(t){return wt||(wt=J.document.createElement("a")),wt.href=t,wt.href},hardwareConcurrency:J.navigator&&J.navigator.hardwareConcurrency||4,get devicePixelRatio(){return J.devicePixelRatio},get prefersReducedMotion(){return!!J.matchMedia&&(mt==null&&(mt=J.matchMedia("(prefers-reduced-motion: reduce)")),mt.matches)}},Wn={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},si={supported:!1,testSupport:function(t){!vi&&Kt&&(qn?mi(t):Bt=t)}},vi=!1,qn=!1;function mi(t){var o=t.createTexture();t.bindTexture(t.TEXTURE_2D,o);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,Kt),t.isContextLost())return;si.supported=!0}catch(u){}t.deleteTexture(o),vi=!0}J.document&&((Kt=J.document.createElement("img")).onload=function(){Bt&&mi(Bt),Bt=null,qn=!0},Kt.onerror=function(){vi=!0,Bt=null},Kt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var aa="01",Wi=function(t,o){this._transformRequestFn=t,this._customAccessToken=o,this._createSkuToken()};function Oi(t){return t.indexOf("mapbox:")===0}Wi.prototype._createSkuToken=function(){var t=function(){for(var o="",u=0;u<10;u++)o+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",aa,o].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt},Wi.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},Wi.prototype.transformRequest=function(t,o){return this._transformRequestFn&&this._transformRequestFn(t,o)||{url:t}},Wi.prototype.normalizeStyleURL=function(t,o){if(!Oi(t))return t;var u=da(t);return u.path="/styles/v1"+u.path,this._makeAPIURL(u,this._customAccessToken||o)},Wi.prototype.normalizeGlyphsURL=function(t,o){if(!Oi(t))return t;var u=da(t);return u.path="/fonts/v1"+u.path,this._makeAPIURL(u,this._customAccessToken||o)},Wi.prototype.normalizeSourceURL=function(t,o){if(!Oi(t))return t;var u=da(t);return u.path="/v4/"+u.authority+".json",u.params.push("secure"),this._makeAPIURL(u,this._customAccessToken||o)},Wi.prototype.normalizeSpriteURL=function(t,o,u,p){var y=da(t);return Oi(t)?(y.path="/styles/v1"+y.path+"/sprite"+o+u,this._makeAPIURL(y,this._customAccessToken||p)):(y.path+=""+o+u,$n(y))},Wi.prototype.normalizeTileURL=function(t,o){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!Oi(t))return t;var u=da(t);u.path=u.path.replace(/(\.(png|jpg)\d*)(?=$)/,(di.devicePixelRatio>=2||o===512?"@2x":"")+(si.supported?".webp":"$1")),u.path=u.path.replace(/^.+\/v4\//,"/"),u.path="/v4"+u.path;var p=this._customAccessToken||function(y){for(var b=0,S=y;b<S.length;b+=1){var I=S[b].match(/^access_token=(.*)$/);if(I)return I[1]}return null}(u.params)||Wn.ACCESS_TOKEN;return Wn.REQUIRE_ACCESS_TOKEN&&p&&this._skuToken&&u.params.push("sku="+this._skuToken),this._makeAPIURL(u,p)},Wi.prototype.canonicalizeTileURL=function(t,o){var u=da(t);if(!u.path.match(/(^\/v4\/)/)||!u.path.match(/\.[\w]+$/))return t;var p="mapbox://tiles/";p+=u.path.replace("/v4/","");var y=u.params;return o&&(y=y.filter(function(b){return!b.match(/^access_token=/)})),y.length&&(p+="?"+y.join("&")),p},Wi.prototype.canonicalizeTileset=function(t,o){for(var u=!!o&&Oi(o),p=[],y=0,b=t.tiles||[];y<b.length;y+=1){var S=b[y];oa(S)?p.push(this.canonicalizeTileURL(S,u)):p.push(S)}return p},Wi.prototype._makeAPIURL=function(t,o){var u="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",p=da(Wn.API_URL);if(t.protocol=p.protocol,t.authority=p.authority,t.protocol==="http"){var y=t.params.indexOf("secure");y>=0&&t.params.splice(y,1)}if(p.path!=="/"&&(t.path=""+p.path+t.path),!Wn.REQUIRE_ACCESS_TOKEN)return $n(t);if(!(o=o||Wn.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+u);if(o[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+u);return t.params=t.params.filter(function(b){return b.indexOf("access_token")===-1}),t.params.push("access_token="+o),$n(t)};var Ki=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function oa(t){return Ki.test(t)}var Mi=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function da(t){var o=t.match(Mi);if(!o)throw new Error("Unable to parse URL object");return{protocol:o[1],authority:o[2],path:o[3]||"/",params:o[4]?o[4].split("&"):[]}}function $n(t){var o=t.params.length?"?"+t.params.join("&"):"";return t.protocol+"://"+t.authority+t.path+o}function wi(t){if(!t)return null;var o=t.split(".");if(!o||o.length!==3)return null;try{return JSON.parse(decodeURIComponent(J.atob(o[1]).split("").map(function(u){return"%"+("00"+u.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch(u){return null}}var ji=function(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};ji.prototype.getStorageKey=function(t){var o,u=wi(Wn.ACCESS_TOKEN);return o=u&&u.u?J.btoa(encodeURIComponent(u.u).replace(/%([0-9A-F]{2})/g,function(p,y){return String.fromCharCode(Number("0x"+y))})):Wn.ACCESS_TOKEN||"",t?"mapbox.eventData."+t+":"+o:"mapbox.eventData:"+o},ji.prototype.fetchEventData=function(){var t=De("localStorage"),o=this.getStorageKey(),u=this.getStorageKey("uuid");if(t)try{var p=J.localStorage.getItem(o);p&&(this.eventData=JSON.parse(p));var y=J.localStorage.getItem(u);y&&(this.anonId=y)}catch(b){Qe("Unable to read from LocalStorage")}},ji.prototype.saveEventData=function(){var t=De("localStorage"),o=this.getStorageKey(),u=this.getStorageKey("uuid");if(t)try{J.localStorage.setItem(u,this.anonId),Object.keys(this.eventData).length>=1&&J.localStorage.setItem(o,JSON.stringify(this.eventData))}catch(p){Qe("Unable to write to LocalStorage")}},ji.prototype.processRequests=function(t){},ji.prototype.postEvent=function(t,o,u,p){var y=this;if(Wn.EVENTS_URL){var b=da(Wn.EVENTS_URL);b.params.push("access_token="+(p||Wn.ACCESS_TOKEN||""));var S={event:this.type,created:new Date(t).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.2",skuId:aa,userId:this.anonId},I=o?xt(S,o):S,D={url:$n(b),headers:{"Content-Type":"text/plain"},body:JSON.stringify([I])};this.pendingRequest=xa(D,function(z){y.pendingRequest=null,u(z),y.saveEventData(),y.processRequests(p)})}},ji.prototype.queueRequest=function(t,o){this.queue.push(t),this.processRequests(o)};var $i,zo,me=function(t){function o(){t.call(this,"map.load"),this.success={},this.skuToken=""}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.postMapLoadEvent=function(u,p,y,b){this.skuToken=y,(Wn.EVENTS_URL&&b||Wn.ACCESS_TOKEN&&Array.isArray(u)&&u.some(function(S){return Oi(S)||oa(S)}))&&this.queueRequest({id:p,timestamp:Date.now()},b)},o.prototype.processRequests=function(u){var p=this;if(!this.pendingRequest&&this.queue.length!==0){var y=this.queue.shift(),b=y.id,S=y.timestamp;b&&this.success[b]||(this.anonId||this.fetchEventData(),it(this.anonId)||(this.anonId=at()),this.postEvent(S,{skuToken:this.skuToken},function(I){I||b&&(p.success[b]=!0)},u))}},o}(ji),Dn=new(function(t){function o(u){t.call(this,"appUserTurnstile"),this._customAccessToken=u}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.postTurnstileEvent=function(u,p){Wn.EVENTS_URL&&Wn.ACCESS_TOKEN&&Array.isArray(u)&&u.some(function(y){return Oi(y)||oa(y)})&&this.queueRequest(Date.now(),p)},o.prototype.processRequests=function(u){var p=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var y=wi(Wn.ACCESS_TOKEN),b=y?y.u:Wn.ACCESS_TOKEN,S=b!==this.eventData.tokenU;it(this.anonId)||(this.anonId=at(),S=!0);var I=this.queue.shift();if(this.eventData.lastSuccess){var D=new Date(this.eventData.lastSuccess),z=new Date(I),V=(I-this.eventData.lastSuccess)/864e5;S=S||V>=1||V<-1||D.getDate()!==z.getDate()}else S=!0;if(!S)return this.processRequests();this.postEvent(I,{"enabled.telemetry":!1},function(W){W||(p.eventData.lastSuccess=I,p.eventData.tokenU=b)},u)}},o}(ji)),Za=Dn.postTurnstileEvent.bind(Dn),hs=new me,Nt=hs.postMapLoadEvent.bind(hs),nr=500,Ar=50;function rn(){J.caches&&!$i&&($i=J.caches.open("mapbox-tiles"))}function wn(t){var o=t.indexOf("?");return o<0?t:t.slice(0,o)}var Fn,gi=1/0;function ti(){return Fn==null&&(Fn=J.OffscreenCanvas&&new J.OffscreenCanvas(1,1).getContext("2d")&&typeof J.createImageBitmap=="function"),Fn}var fn={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(fn);var Di=function(t){function o(u,p,y){p===401&&oa(y)&&(u+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),t.call(this,u),this.status=p,this.url=y,this.name=this.constructor.name,this.message=u}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},o}(Error),Ri=Nr()?function(){return self.worker&&self.worker.referrer}:function(){return(J.location.protocol==="blob:"?J.parent:J).location.href},to,Es,Ko=function(t,o){if(!(/^file:/.test(u=t.url)||/^file:/.test(Ri())&&!/^\w+:/.test(u))){if(J.fetch&&J.Request&&J.AbortController&&J.Request.prototype.hasOwnProperty("signal"))return function(p,y){var b,S=new J.AbortController,I=new J.Request(p.url,{method:p.method||"GET",body:p.body,credentials:p.credentials,headers:p.headers,referrer:Ri(),signal:S.signal}),D=!1,z=!1,V=(b=I.url).indexOf("sku=")>0&&oa(b);p.type==="json"&&I.headers.set("Accept","application/json");var W=function(se,Me,Oe){if(!z){if(se&&se.message!=="SecurityError"&&Qe(se),Me&&Oe)return ee(Me);var Ye=Date.now();J.fetch(I).then(function(ze){if(ze.ok){var st=V?ze.clone():null;return ee(ze,st,Ye)}return y(new Di(ze.statusText,ze.status,p.url))}).catch(function(ze){ze.code!==20&&y(new Error(ze.message))})}},ee=function(se,Me,Oe){(p.type==="arrayBuffer"?se.arrayBuffer():p.type==="json"?se.json():se.text()).then(function(Ye){z||(Me&&Oe&&function(ze,st,Tt){if(rn(),$i){var Vt={status:st.status,statusText:st.statusText,headers:new J.Headers};st.headers.forEach(function(lr,Lr){return Vt.headers.set(Lr,lr)});var Xt=tn(st.headers.get("Cache-Control")||"");Xt["no-store"]||(Xt["max-age"]&&Vt.headers.set("Expires",new Date(Tt+1e3*Xt["max-age"]).toUTCString()),new Date(Vt.headers.get("Expires")).getTime()-Tt<42e4||function(lr,Lr){if(zo===void 0)try{new Response(new ReadableStream),zo=!0}catch($r){zo=!1}zo?Lr(lr.body):lr.blob().then(Lr)}(st,function(lr){var Lr=new J.Response(lr,Vt);rn(),$i&&$i.then(function($r){return $r.put(wn(ze.url),Lr)}).catch(function($r){return Qe($r.message)})}))}}(I,Me,Oe),D=!0,y(null,Ye,se.headers.get("Cache-Control"),se.headers.get("Expires")))}).catch(function(Ye){z||y(new Error(Ye.message))})};return V?function(se,Me){if(rn(),!$i)return Me(null);var Oe=wn(se.url);$i.then(function(Ye){Ye.match(Oe).then(function(ze){var st=function(Tt){if(!Tt)return!1;var Vt=new Date(Tt.headers.get("Expires")||0),Xt=tn(Tt.headers.get("Cache-Control")||"");return Vt>Date.now()&&!Xt["no-cache"]}(ze);Ye.delete(Oe),st&&Ye.put(Oe,ze.clone()),Me(null,ze,st)}).catch(Me)}).catch(Me)}(I,W):W(null,null),{cancel:function(){z=!0,D||S.abort()}}}(t,o);if(Nr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,o,void 0,!0)}var u;return function(p,y){var b=new J.XMLHttpRequest;for(var S in b.open(p.method||"GET",p.url,!0),p.type==="arrayBuffer"&&(b.responseType="arraybuffer"),p.headers)b.setRequestHeader(S,p.headers[S]);return p.type==="json"&&(b.responseType="text",b.setRequestHeader("Accept","application/json")),b.withCredentials=p.credentials==="include",b.onerror=function(){y(new Error(b.statusText))},b.onload=function(){if((b.status>=200&&b.status<300||b.status===0)&&b.response!==null){var I=b.response;if(p.type==="json")try{I=JSON.parse(b.response)}catch(D){return y(D)}y(null,I,b.getResponseHeader("Cache-Control"),b.getResponseHeader("Expires"))}else y(new Di(b.statusText,b.status,p.url))},b.send(p.body),{cancel:function(){return b.abort()}}}(t,o)},Ba=function(t,o){return Ko(xt(t,{type:"arrayBuffer"}),o)},xa=function(t,o){return Ko(xt(t,{method:"POST"}),o)},H="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";to=[],Es=0;var Q=function(t,o){if(si.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),Es>=Wn.MAX_PARALLEL_IMAGE_REQUESTS){var u={requestParameters:t,callback:o,cancelled:!1,cancel:function(){this.cancelled=!0}};return to.push(u),u}Es++;var p=!1,y=function(){if(!p)for(p=!0,Es--;to.length&&Es<Wn.MAX_PARALLEL_IMAGE_REQUESTS;){var S=to.shift();S.cancelled||(S.cancel=Q(S.requestParameters,S.callback).cancel)}},b=Ba(t,function(S,I,D,z){y(),S?o(S):I&&(ti()?function(V,W){var ee=new J.Blob([new Uint8Array(V)],{type:"image/png"});J.createImageBitmap(ee).then(function(se){W(null,se)}).catch(function(se){W(new Error("Could not load image because of "+se.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(I,o):function(V,W,ee,se){var Me=new J.Image,Oe=J.URL;Me.onload=function(){W(null,Me),Oe.revokeObjectURL(Me.src),Me.onload=null,J.requestAnimationFrame(function(){Me.src=H})},Me.onerror=function(){return W(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var Ye=new J.Blob([new Uint8Array(V)],{type:"image/png"});Me.cacheControl=ee,Me.expires=se,Me.src=V.byteLength?Oe.createObjectURL(Ye):H}(I,o,D,z))});return{cancel:function(){b.cancel(),y()}}};function oe(t,o,u){u[t]&&u[t].indexOf(o)!==-1||(u[t]=u[t]||[],u[t].push(o))}function ye(t,o,u){if(u&&u[t]){var p=u[t].indexOf(o);p!==-1&&u[t].splice(p,1)}}var Pe=function(t,o){o===void 0&&(o={}),xt(this,o),this.type=t},He=function(t){function o(u,p){p===void 0&&(p={}),t.call(this,"error",xt({error:u},p))}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(Pe),rt=function(){};rt.prototype.on=function(t,o){return this._listeners=this._listeners||{},oe(t,o,this._listeners),this},rt.prototype.off=function(t,o){return ye(t,o,this._listeners),ye(t,o,this._oneTimeListeners),this},rt.prototype.once=function(t,o){return this._oneTimeListeners=this._oneTimeListeners||{},oe(t,o,this._oneTimeListeners),this},rt.prototype.fire=function(t,o){typeof t=="string"&&(t=new Pe(t,o||{}));var u=t.type;if(this.listens(u)){t.target=this;for(var p=0,y=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];p<y.length;p+=1)y[p].call(this,t);for(var b=0,S=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];b<S.length;b+=1){var I=S[b];ye(u,I,this._oneTimeListeners),I.call(this,t)}var D=this._eventedParent;D&&(xt(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),D.fire(t))}else t instanceof He&&console.error(t.error);return this},rt.prototype.listens=function(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)},rt.prototype.setEventedParent=function(t,o){return this._eventedParent=t,this._eventedParentData=o,this};var pe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},ke=function(t,o,u,p){this.message=(t?t+": ":"")+u,p&&(this.identifier=p),o!=null&&o.__line__&&(this.line=o.__line__)};function vt(t){var o=t.value;return o?[new ke(t.key,o,"constants have been deprecated as of v8")]:[]}function pr(t){for(var o=[],u=arguments.length-1;u-- >0;)o[u]=arguments[u+1];for(var p=0,y=o;p<y.length;p+=1){var b=y[p];for(var S in b)t[S]=b[S]}return t}function Ft(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function zt(t){if(Array.isArray(t))return t.map(zt);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){var o={};for(var u in t)o[u]=zt(t[u]);return o}return Ft(t)}var vr=function(t){function o(u,p){t.call(this,p),this.message=p,this.key=u}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(Error),En=function(t,o){o===void 0&&(o=[]),this.parent=t,this.bindings={};for(var u=0,p=o;u<p.length;u+=1){var y=p[u];this.bindings[y[0]]=y[1]}};En.prototype.concat=function(t){return new En(this,t)},En.prototype.get=function(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(t+" not found in scope.")},En.prototype.has=function(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)};var pn={kind:"null"},Ot={kind:"number"},nn={kind:"string"},Zr={kind:"boolean"},Yr={kind:"color"},_i={kind:"object"},an={kind:"value"},on={kind:"collator"},Xi={kind:"formatted"},yi={kind:"resolvedImage"};function Pi(t,o){return{kind:"array",itemType:t,N:o}}function bi(t){if(t.kind==="array"){var o=bi(t.itemType);return typeof t.N=="number"?"array<"+o+", "+t.N+">":t.itemType.kind==="value"?"array":"array<"+o+">"}return t.kind}var ht=[pn,Ot,nn,Zr,Yr,Xi,_i,Pi(an),yi];function Pt(t,o){if(o.kind==="error")return null;if(t.kind==="array"){if(o.kind==="array"&&(o.N===0&&o.itemType.kind==="value"||!Pt(t.itemType,o.itemType))&&(typeof t.N!="number"||t.N===o.N))return null}else{if(t.kind===o.kind)return null;if(t.kind==="value"){for(var u=0,p=ht;u<p.length;u+=1)if(!Pt(p[u],o))return null}}return"Expected "+bi(t)+" but found "+bi(o)+" instead."}function Aa(t,o){return o.some(function(u){return u.kind===t.kind})}function qi(t,o){return o.some(function(u){return u==="null"?t===null:u==="array"?Array.isArray(t):u==="object"?t&&!Array.isArray(t)&&typeof t=="object":u===typeof t})}var Ii=ve(function(t,o){var u={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function p(I){return(I=Math.round(I))<0?0:I>255?255:I}function y(I){return p(I[I.length-1]==="%"?parseFloat(I)/100*255:parseInt(I))}function b(I){return(D=I[I.length-1]==="%"?parseFloat(I)/100:parseFloat(I))<0?0:D>1?1:D;var D}function S(I,D,z){return z<0?z+=1:z>1&&(z-=1),6*z<1?I+(D-I)*z*6:2*z<1?D:3*z<2?I+(D-I)*(2/3-z)*6:I}try{o.parseCSSColor=function(I){var D,z=I.replace(/ /g,"").toLowerCase();if(z in u)return u[z].slice();if(z[0]==="#")return z.length===4?(D=parseInt(z.substr(1),16))>=0&&D<=4095?[(3840&D)>>4|(3840&D)>>8,240&D|(240&D)>>4,15&D|(15&D)<<4,1]:null:z.length===7&&(D=parseInt(z.substr(1),16))>=0&&D<=16777215?[(16711680&D)>>16,(65280&D)>>8,255&D,1]:null;var V=z.indexOf("("),W=z.indexOf(")");if(V!==-1&&W+1===z.length){var ee=z.substr(0,V),se=z.substr(V+1,W-(V+1)).split(","),Me=1;switch(ee){case"rgba":if(se.length!==4)return null;Me=b(se.pop());case"rgb":return se.length!==3?null:[y(se[0]),y(se[1]),y(se[2]),Me];case"hsla":if(se.length!==4)return null;Me=b(se.pop());case"hsl":if(se.length!==3)return null;var Oe=(parseFloat(se[0])%360+360)%360/360,Ye=b(se[1]),ze=b(se[2]),st=ze<=.5?ze*(Ye+1):ze+Ye-ze*Ye,Tt=2*ze-st;return[p(255*S(Tt,st,Oe+1/3)),p(255*S(Tt,st,Oe)),p(255*S(Tt,st,Oe-1/3)),Me];default:return null}}return null}}catch(I){}}).parseCSSColor,pi=function(t,o,u,p){p===void 0&&(p=1),this.r=t,this.g=o,this.b=u,this.a=p};pi.parse=function(t){if(t){if(t instanceof pi)return t;if(typeof t=="string"){var o=Ii(t);if(o)return new pi(o[0]/255*o[3],o[1]/255*o[3],o[2]/255*o[3],o[3])}}},pi.prototype.toString=function(){var t=this.toArray(),o=t[1],u=t[2],p=t[3];return"rgba("+Math.round(t[0])+","+Math.round(o)+","+Math.round(u)+","+p+")"},pi.prototype.toArray=function(){var t=this.a;return t===0?[0,0,0,0]:[255*this.r/t,255*this.g/t,255*this.b/t,t]},pi.black=new pi(0,0,0,1),pi.white=new pi(1,1,1,1),pi.transparent=new pi(0,0,0,0),pi.red=new pi(1,0,0,1);var wa=function(t,o,u){this.sensitivity=t?o?"variant":"case":o?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};wa.prototype.compare=function(t,o){return this.collator.compare(t,o)},wa.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var $s=function(t,o,u,p,y){this.text=t,this.image=o,this.scale=u,this.fontStack=p,this.textColor=y},Ir=function(t){this.sections=t};Ir.fromString=function(t){return new Ir([new $s(t,null,null,null,null)])},Ir.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(t){return t.text.length!==0||t.image&&t.image.name.length!==0})},Ir.factory=function(t){return t instanceof Ir?t:Ir.fromString(t)},Ir.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(t){return t.text}).join("")},Ir.prototype.serialize=function(){for(var t=["format"],o=0,u=this.sections;o<u.length;o+=1){var p=u[o];if(p.image)t.push(["image",p.image.name]);else{t.push(p.text);var y={};p.fontStack&&(y["text-font"]=["literal",p.fontStack.split(",")]),p.scale&&(y["font-scale"]=p.scale),p.textColor&&(y["text-color"]=["rgba"].concat(p.textColor.toArray())),t.push(y)}}return t};var wr=function(t){this.name=t.name,this.available=t.available};function Mt(t,o,u,p){return typeof t=="number"&&t>=0&&t<=255&&typeof o=="number"&&o>=0&&o<=255&&typeof u=="number"&&u>=0&&u<=255?p===void 0||typeof p=="number"&&p>=0&&p<=1?null:"Invalid rgba value ["+[t,o,u,p].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof p=="number"?[t,o,u,p]:[t,o,u]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function bo(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof pi||t instanceof wa||t instanceof Ir||t instanceof wr)return!0;if(Array.isArray(t)){for(var o=0,u=t;o<u.length;o+=1)if(!bo(u[o]))return!1;return!0}if(typeof t=="object"){for(var p in t)if(!bo(t[p]))return!1;return!0}return!1}function ne(t){if(t===null)return pn;if(typeof t=="string")return nn;if(typeof t=="boolean")return Zr;if(typeof t=="number")return Ot;if(t instanceof pi)return Yr;if(t instanceof wa)return on;if(t instanceof Ir)return Xi;if(t instanceof wr)return yi;if(Array.isArray(t)){for(var o,u=t.length,p=0,y=t;p<y.length;p+=1){var b=ne(y[p]);if(o){if(o===b)continue;o=an;break}o=b}return Pi(o||an,u)}return _i}function Fu(t){var o=typeof t;return t===null?"":o==="string"||o==="number"||o==="boolean"?String(t):t instanceof pi||t instanceof Ir||t instanceof wr?t.toString():JSON.stringify(t)}wr.prototype.toString=function(){return this.name},wr.fromString=function(t){return t?new wr({name:t,available:!1}):null},wr.prototype.serialize=function(){return["image",this.name]};var oo=function(t,o){this.type=t,this.value=o};oo.parse=function(t,o){if(t.length!==2)return o.error("'literal' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(!bo(t[1]))return o.error("invalid value");var u=t[1],p=ne(u),y=o.expectedType;return p.kind!=="array"||p.N!==0||!y||y.kind!=="array"||typeof y.N=="number"&&y.N!==0||(p=y),new oo(p,u)},oo.prototype.evaluate=function(){return this.value},oo.prototype.eachChild=function(){},oo.prototype.outputDefined=function(){return!0},oo.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof pi?["rgba"].concat(this.value.toArray()):this.value instanceof Ir?this.value.serialize():this.value};var Ra=function(t){this.name="ExpressionEvaluationError",this.message=t};Ra.prototype.toJSON=function(){return this.message};var Ta={string:nn,number:Ot,boolean:Zr,object:_i},Qi=function(t,o){this.type=t,this.args=o};Qi.parse=function(t,o){if(t.length<2)return o.error("Expected at least one argument.");var u,p=1,y=t[0];if(y==="array"){var b,S;if(t.length>2){var I=t[1];if(typeof I!="string"||!(I in Ta)||I==="object")return o.error('The item type argument of "array" must be one of string, number, boolean',1);b=Ta[I],p++}else b=an;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return o.error('The length argument to "array" must be a positive integer literal',2);S=t[2],p++}u=Pi(b,S)}else u=Ta[y];for(var D=[];p<t.length;p++){var z=o.parse(t[p],p,an);if(!z)return null;D.push(z)}return new Qi(u,D)},Qi.prototype.evaluate=function(t){for(var o=0;o<this.args.length;o++){var u=this.args[o].evaluate(t);if(!Pt(this.type,ne(u)))return u;if(o===this.args.length-1)throw new Ra("Expected value to be of type "+bi(this.type)+", but found "+bi(ne(u))+" instead.")}return null},Qi.prototype.eachChild=function(t){this.args.forEach(t)},Qi.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},Qi.prototype.serialize=function(){var t=this.type,o=[t.kind];if(t.kind==="array"){var u=t.itemType;if(u.kind==="string"||u.kind==="number"||u.kind==="boolean"){o.push(u.kind);var p=t.N;(typeof p=="number"||this.args.length>1)&&o.push(p)}}return o.concat(this.args.map(function(y){return y.serialize()}))};var Uo=function(t){this.type=Xi,this.sections=t};Uo.parse=function(t,o){if(t.length<2)return o.error("Expected at least one argument.");var u=t[1];if(!Array.isArray(u)&&typeof u=="object")return o.error("First argument must be an image or text section.");for(var p=[],y=!1,b=1;b<=t.length-1;++b){var S=t[b];if(y&&typeof S=="object"&&!Array.isArray(S)){y=!1;var I=null;if(S["font-scale"]&&!(I=o.parse(S["font-scale"],1,Ot)))return null;var D=null;if(S["text-font"]&&!(D=o.parse(S["text-font"],1,Pi(nn))))return null;var z=null;if(S["text-color"]&&!(z=o.parse(S["text-color"],1,Yr)))return null;var V=p[p.length-1];V.scale=I,V.font=D,V.textColor=z}else{var W=o.parse(t[b],1,an);if(!W)return null;var ee=W.type.kind;if(ee!=="string"&&ee!=="value"&&ee!=="null"&&ee!=="resolvedImage")return o.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");y=!0,p.push({content:W,scale:null,font:null,textColor:null})}}return new Uo(p)},Uo.prototype.evaluate=function(t){return new Ir(this.sections.map(function(o){var u=o.content.evaluate(t);return ne(u)===yi?new $s("",u,null,null,null):new $s(Fu(u),null,o.scale?o.scale.evaluate(t):null,o.font?o.font.evaluate(t).join(","):null,o.textColor?o.textColor.evaluate(t):null)}))},Uo.prototype.eachChild=function(t){for(var o=0,u=this.sections;o<u.length;o+=1){var p=u[o];t(p.content),p.scale&&t(p.scale),p.font&&t(p.font),p.textColor&&t(p.textColor)}},Uo.prototype.outputDefined=function(){return!1},Uo.prototype.serialize=function(){for(var t=["format"],o=0,u=this.sections;o<u.length;o+=1){var p=u[o];t.push(p.content.serialize());var y={};p.scale&&(y["font-scale"]=p.scale.serialize()),p.font&&(y["text-font"]=p.font.serialize()),p.textColor&&(y["text-color"]=p.textColor.serialize()),t.push(y)}return t};var $o=function(t){this.type=yi,this.input=t};$o.parse=function(t,o){if(t.length!==2)return o.error("Expected two arguments.");var u=o.parse(t[1],1,nn);return u?new $o(u):o.error("No image name provided.")},$o.prototype.evaluate=function(t){var o=this.input.evaluate(t),u=wr.fromString(o);return u&&t.availableImages&&(u.available=t.availableImages.indexOf(o)>-1),u},$o.prototype.eachChild=function(t){t(this.input)},$o.prototype.outputDefined=function(){return!1},$o.prototype.serialize=function(){return["image",this.input.serialize()]};var xu={"to-boolean":Zr,"to-color":Yr,"to-number":Ot,"to-string":nn},Eo=function(t,o){this.type=t,this.args=o};Eo.parse=function(t,o){if(t.length<2)return o.error("Expected at least one argument.");var u=t[0];if((u==="to-boolean"||u==="to-string")&&t.length!==2)return o.error("Expected one argument.");for(var p=xu[u],y=[],b=1;b<t.length;b++){var S=o.parse(t[b],b,an);if(!S)return null;y.push(S)}return new Eo(p,y)},Eo.prototype.evaluate=function(t){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(t));if(this.type.kind==="color"){for(var o,u,p=0,y=this.args;p<y.length;p+=1){if(u=null,(o=y[p].evaluate(t))instanceof pi)return o;if(typeof o=="string"){var b=t.parseColor(o);if(b)return b}else if(Array.isArray(o)&&!(u=o.length<3||o.length>4?"Invalid rbga value "+JSON.stringify(o)+": expected an array containing either three or four numeric values.":Mt(o[0],o[1],o[2],o[3])))return new pi(o[0]/255,o[1]/255,o[2]/255,o[3])}throw new Ra(u||"Could not parse color from value '"+(typeof o=="string"?o:String(JSON.stringify(o)))+"'")}if(this.type.kind==="number"){for(var S=null,I=0,D=this.args;I<D.length;I+=1){if((S=D[I].evaluate(t))===null)return 0;var z=Number(S);if(!isNaN(z))return z}throw new Ra("Could not convert "+JSON.stringify(S)+" to number.")}return this.type.kind==="formatted"?Ir.fromString(Fu(this.args[0].evaluate(t))):this.type.kind==="resolvedImage"?wr.fromString(Fu(this.args[0].evaluate(t))):Fu(this.args[0].evaluate(t))},Eo.prototype.eachChild=function(t){this.args.forEach(t)},Eo.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},Eo.prototype.serialize=function(){if(this.type.kind==="formatted")return new Uo([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new $o(this.args[0]).serialize();var t=["to-"+this.type.kind];return this.eachChild(function(o){t.push(o.serialize())}),t};var Zo=["Unknown","Point","LineString","Polygon"],sa=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};sa.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},sa.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?Zo[this.feature.type]:this.feature.type:null},sa.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},sa.prototype.canonicalID=function(){return this.canonical},sa.prototype.properties=function(){return this.feature&&this.feature.properties||{}},sa.prototype.parseColor=function(t){var o=this._parseColorCache[t];return o||(o=this._parseColorCache[t]=pi.parse(t)),o};var so=function(t,o,u,p){this.name=t,this.type=o,this._evaluate=u,this.args=p};so.prototype.evaluate=function(t){return this._evaluate(t,this.args)},so.prototype.eachChild=function(t){this.args.forEach(t)},so.prototype.outputDefined=function(){return!1},so.prototype.serialize=function(){return[this.name].concat(this.args.map(function(t){return t.serialize()}))},so.parse=function(t,o){var u,p=t[0],y=so.definitions[p];if(!y)return o.error('Unknown expression "'+p+'". If you wanted a literal array, use ["literal", [...]].',0);for(var b=Array.isArray(y)?y[0]:y.type,S=Array.isArray(y)?[[y[1],y[2]]]:y.overloads,I=S.filter(function(Yn){var hn=Yn[0];return!Array.isArray(hn)||hn.length===t.length-1}),D=null,z=0,V=I;z<V.length;z+=1){var W=V[z],ee=W[0],se=W[1];D=new Qs(o.registry,o.path,null,o.scope);for(var Me=[],Oe=!1,Ye=1;Ye<t.length;Ye++){var ze=t[Ye],st=Array.isArray(ee)?ee[Ye-1]:ee.type,Tt=D.parse(ze,1+Me.length,st);if(!Tt){Oe=!0;break}Me.push(Tt)}if(!Oe)if(Array.isArray(ee)&&ee.length!==Me.length)D.error("Expected "+ee.length+" arguments, but found "+Me.length+" instead.");else{for(var Vt=0;Vt<Me.length;Vt++){var Xt=Array.isArray(ee)?ee[Vt]:ee.type,lr=Me[Vt];D.concat(Vt+1).checkSubtype(Xt,lr.type)}if(D.errors.length===0)return new so(p,b,se,Me)}}if(I.length===1)(u=o.errors).push.apply(u,D.errors);else{for(var Lr=(I.length?I:S).map(function(Yn){var hn;return hn=Yn[0],Array.isArray(hn)?"("+hn.map(bi).join(", ")+")":"("+bi(hn.type)+"...)"}).join(" | "),$r=[],Zn=1;Zn<t.length;Zn++){var gn=o.parse(t[Zn],1+$r.length);if(!gn)return null;$r.push(bi(gn.type))}o.error("Expected arguments of type "+Lr+", but found ("+$r.join(", ")+") instead.")}return null},so.register=function(t,o){for(var u in so.definitions=o,o)t[u]=so};var jo=function(t,o,u){this.type=on,this.locale=u,this.caseSensitive=t,this.diacriticSensitive=o};function Ya(t,o){t[0]=Math.min(t[0],o[0]),t[1]=Math.min(t[1],o[1]),t[2]=Math.max(t[2],o[0]),t[3]=Math.max(t[3],o[1])}function Gs(t,o){return!(t[0]<=o[0]||t[2]>=o[2]||t[1]<=o[1]||t[3]>=o[3])}function ll(t,o){var u=(180+t[0])/360,p=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,y=Math.pow(2,o.z);return[Math.round(u*y*8192),Math.round(p*y*8192)]}function os(t,o,u){return o[1]>t[1]!=u[1]>t[1]&&t[0]<(u[0]-o[0])*(t[1]-o[1])/(u[1]-o[1])+o[0]}function ie(t,o){for(var u,p,y,b,S,I,D,z=!1,V=0,W=o.length;V<W;V++)for(var ee=o[V],se=0,Me=ee.length;se<Me-1;se++){if((b=(u=t)[0]-(p=ee[se])[0])*(D=u[1]-(y=ee[se+1])[1])-(I=u[0]-y[0])*(S=u[1]-p[1])==0&&b*I<=0&&S*D<=0)return!1;os(t,ee[se],ee[se+1])&&(z=!z)}return z}function Ee(t,o){for(var u=0;u<o.length;u++)if(ie(t,o[u]))return!0;return!1}function qe(t,o,u,p){var y=p[0]-u[0],b=p[1]-u[1],S=(t[0]-u[0])*b-y*(t[1]-u[1]),I=(o[0]-u[0])*b-y*(o[1]-u[1]);return S>0&&I<0||S<0&&I>0}function Rt(t,o,u){for(var p=0,y=u;p<y.length;p+=1)for(var b=y[p],S=0;S<b.length-1;++S)if((W=[(V=b[S+1])[0]-(z=b[S])[0],V[1]-z[1]])[0]*(ee=[(D=o)[0]-(I=t)[0],D[1]-I[1]])[1]-W[1]*ee[0]!=0&&qe(I,D,z,V)&&qe(z,V,I,D))return!0;var I,D,z,V,W,ee;return!1}function Or(t,o){for(var u=0;u<t.length;++u)if(!ie(t[u],o))return!1;for(var p=0;p<t.length-1;++p)if(Rt(t[p],t[p+1],o))return!1;return!0}function Tn(t,o){for(var u=0;u<o.length;u++)if(Or(t,o[u]))return!0;return!1}function Ti(t,o,u){for(var p=[],y=0;y<t.length;y++){for(var b=[],S=0;S<t[y].length;S++){var I=ll(t[y][S],u);Ya(o,I),b.push(I)}p.push(b)}return p}function ro(t,o,u){for(var p=[],y=0;y<t.length;y++){var b=Ti(t[y],o,u);p.push(b)}return p}function La(t,o,u,p){if(t[0]<u[0]||t[0]>u[2]){var y=.5*p,b=t[0]-u[0]>y?-p:u[0]-t[0]>y?p:0;b===0&&(b=t[0]-u[2]>y?-p:u[2]-t[0]>y?p:0),t[0]+=b}Ya(o,t)}function ja(t,o,u,p){for(var y=8192*Math.pow(2,p.z),b=[8192*p.x,8192*p.y],S=[],I=0,D=t;I<D.length;I+=1)for(var z=0,V=D[I];z<V.length;z+=1){var W=V[z],ee=[W.x+b[0],W.y+b[1]];La(ee,o,u,y),S.push(ee)}return S}function Qo(t,o,u,p){for(var y,b=8192*Math.pow(2,p.z),S=[8192*p.x,8192*p.y],I=[],D=0,z=t;D<z.length;D+=1){for(var V=[],W=0,ee=z[D];W<ee.length;W+=1){var se=ee[W],Me=[se.x+S[0],se.y+S[1]];Ya(o,Me),V.push(Me)}I.push(V)}if(o[2]-o[0]<=b/2){(y=o)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(var Oe=0,Ye=I;Oe<Ye.length;Oe+=1)for(var ze=0,st=Ye[Oe];ze<st.length;ze+=1)La(st[ze],o,u,b)}return I}jo.parse=function(t,o){if(t.length!==2)return o.error("Expected one argument.");var u=t[1];if(typeof u!="object"||Array.isArray(u))return o.error("Collator options argument must be an object.");var p=o.parse(u["case-sensitive"]!==void 0&&u["case-sensitive"],1,Zr);if(!p)return null;var y=o.parse(u["diacritic-sensitive"]!==void 0&&u["diacritic-sensitive"],1,Zr);if(!y)return null;var b=null;return u.locale&&!(b=o.parse(u.locale,1,nn))?null:new jo(p,y,b)},jo.prototype.evaluate=function(t){return new wa(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)},jo.prototype.eachChild=function(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)},jo.prototype.outputDefined=function(){return!1},jo.prototype.serialize=function(){var t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]};var ps=function(t,o){this.type=Zr,this.geojson=t,this.geometries=o};function Jo(t){if(t instanceof so&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof ps)return!1;var o=!0;return t.eachChild(function(u){o&&!Jo(u)&&(o=!1)}),o}function Ss(t){if(t instanceof so&&t.name==="feature-state")return!1;var o=!0;return t.eachChild(function(u){o&&!Ss(u)&&(o=!1)}),o}function Lo(t,o){if(t instanceof so&&o.indexOf(t.name)>=0)return!1;var u=!0;return t.eachChild(function(p){u&&!Lo(p,o)&&(u=!1)}),u}ps.parse=function(t,o){if(t.length!==2)return o.error("'within' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(bo(t[1])){var u=t[1];if(u.type==="FeatureCollection")for(var p=0;p<u.features.length;++p){var y=u.features[p].geometry.type;if(y==="Polygon"||y==="MultiPolygon")return new ps(u,u.features[p].geometry)}else if(u.type==="Feature"){var b=u.geometry.type;if(b==="Polygon"||b==="MultiPolygon")return new ps(u,u.geometry)}else if(u.type==="Polygon"||u.type==="MultiPolygon")return new ps(u,u)}return o.error("'within' expression requires valid geojson object that contains polygon geometry type.")},ps.prototype.evaluate=function(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(o,u){var p=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],b=o.canonicalID();if(u.type==="Polygon"){var S=Ti(u.coordinates,y,b),I=ja(o.geometry(),p,y,b);if(!Gs(p,y))return!1;for(var D=0,z=I;D<z.length;D+=1)if(!ie(z[D],S))return!1}if(u.type==="MultiPolygon"){var V=ro(u.coordinates,y,b),W=ja(o.geometry(),p,y,b);if(!Gs(p,y))return!1;for(var ee=0,se=W;ee<se.length;ee+=1)if(!Ee(se[ee],V))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(o,u){var p=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],b=o.canonicalID();if(u.type==="Polygon"){var S=Ti(u.coordinates,y,b),I=Qo(o.geometry(),p,y,b);if(!Gs(p,y))return!1;for(var D=0,z=I;D<z.length;D+=1)if(!Or(z[D],S))return!1}if(u.type==="MultiPolygon"){var V=ro(u.coordinates,y,b),W=Qo(o.geometry(),p,y,b);if(!Gs(p,y))return!1;for(var ee=0,se=W;ee<se.length;ee+=1)if(!Tn(se[ee],V))return!1}return!0}(t,this.geometries)}return!1},ps.prototype.eachChild=function(){},ps.prototype.outputDefined=function(){return!0},ps.prototype.serialize=function(){return["within",this.geojson]};var Vo=function(t,o){this.type=o.type,this.name=t,this.boundExpression=o};Vo.parse=function(t,o){if(t.length!==2||typeof t[1]!="string")return o.error("'var' expression requires exactly one string literal argument.");var u=t[1];return o.scope.has(u)?new Vo(u,o.scope.get(u)):o.error('Unknown variable "'+u+'". Make sure "'+u+'" has been bound in an enclosing "let" expression before using it.',1)},Vo.prototype.evaluate=function(t){return this.boundExpression.evaluate(t)},Vo.prototype.eachChild=function(){},Vo.prototype.outputDefined=function(){return!1},Vo.prototype.serialize=function(){return["var",this.name]};var Qs=function(t,o,u,p,y){o===void 0&&(o=[]),p===void 0&&(p=new En),y===void 0&&(y=[]),this.registry=t,this.path=o,this.key=o.map(function(b){return"["+b+"]"}).join(""),this.scope=p,this.errors=y,this.expectedType=u};function ou(t,o){for(var u,p=t.length-1,y=0,b=p,S=0;y<=b;)if((u=t[S=Math.floor((y+b)/2)])<=o){if(S===p||o<t[S+1])return S;y=S+1}else{if(!(u>o))throw new Ra("Input is not a number.");b=S-1}return 0}Qs.prototype.parse=function(t,o,u,p,y){return y===void 0&&(y={}),o?this.concat(o,u,p)._parse(t,y):this._parse(t,y)},Qs.prototype._parse=function(t,o){function u(z,V,W){return W==="assert"?new Qi(V,[z]):W==="coerce"?new Eo(V,[z]):z}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var p=t[0];if(typeof p!="string")return this.error("Expression name must be a string, but found "+typeof p+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var y=this.registry[p];if(y){var b=y.parse(t,this);if(!b)return null;if(this.expectedType){var S=this.expectedType,I=b.type;if(S.kind!=="string"&&S.kind!=="number"&&S.kind!=="boolean"&&S.kind!=="object"&&S.kind!=="array"||I.kind!=="value")if(S.kind!=="color"&&S.kind!=="formatted"&&S.kind!=="resolvedImage"||I.kind!=="value"&&I.kind!=="string"){if(this.checkSubtype(S,I))return null}else b=u(b,S,o.typeAnnotation||"coerce");else b=u(b,S,o.typeAnnotation||"assert")}if(!(b instanceof oo)&&b.type.kind!=="resolvedImage"&&function z(V){if(V instanceof Vo)return z(V.boundExpression);if(V instanceof so&&V.name==="error"||V instanceof jo||V instanceof ps)return!1;var W=V instanceof Eo||V instanceof Qi,ee=!0;return V.eachChild(function(se){ee=W?ee&&z(se):ee&&se instanceof oo}),!!ee&&Jo(V)&&Lo(V,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(b)){var D=new sa;try{b=new oo(b.type,b.evaluate(D))}catch(z){return this.error(z.message),null}}return b}return this.error('Unknown expression "'+p+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof t+" instead.")},Qs.prototype.concat=function(t,o,u){var p=typeof t=="number"?this.path.concat(t):this.path,y=u?this.scope.concat(u):this.scope;return new Qs(this.registry,p,o||null,y,this.errors)},Qs.prototype.error=function(t){for(var o=[],u=arguments.length-1;u-- >0;)o[u]=arguments[u+1];var p=""+this.key+o.map(function(y){return"["+y+"]"}).join("");this.errors.push(new vr(p,t))},Qs.prototype.checkSubtype=function(t,o){var u=Pt(t,o);return u&&this.error(u),u};var ds=function(t,o,u){this.type=t,this.input=o,this.labels=[],this.outputs=[];for(var p=0,y=u;p<y.length;p+=1){var b=y[p],S=b[1];this.labels.push(b[0]),this.outputs.push(S)}};function ga(t,o,u){return t*(1-u)+o*u}ds.parse=function(t,o){if(t.length-1<4)return o.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return o.error("Expected an even number of arguments.");var u=o.parse(t[1],1,Ot);if(!u)return null;var p=[],y=null;o.expectedType&&o.expectedType.kind!=="value"&&(y=o.expectedType);for(var b=1;b<t.length;b+=2){var S=b===1?-1/0:t[b],I=t[b+1],D=b,z=b+1;if(typeof S!="number")return o.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(p.length&&p[p.length-1][0]>=S)return o.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',D);var V=o.parse(I,z,y);if(!V)return null;y=y||V.type,p.push([S,V])}return new ds(y,u,p)},ds.prototype.evaluate=function(t){var o=this.labels,u=this.outputs;if(o.length===1)return u[0].evaluate(t);var p=this.input.evaluate(t);if(p<=o[0])return u[0].evaluate(t);var y=o.length;return p>=o[y-1]?u[y-1].evaluate(t):u[ou(o,p)].evaluate(t)},ds.prototype.eachChild=function(t){t(this.input);for(var o=0,u=this.outputs;o<u.length;o+=1)t(u[o])},ds.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})},ds.prototype.serialize=function(){for(var t=["step",this.input.serialize()],o=0;o<this.labels.length;o++)o>0&&t.push(this.labels[o]),t.push(this.outputs[o].serialize());return t};var ko=Object.freeze({__proto__:null,number:ga,color:function(t,o,u){return new pi(ga(t.r,o.r,u),ga(t.g,o.g,u),ga(t.b,o.b,u),ga(t.a,o.a,u))},array:function(t,o,u){return t.map(function(p,y){return ga(p,o[y],u)})}}),Il=6/29*3*(6/29),vs=Math.PI/180,es=180/Math.PI;function of(t){return t>.008856451679035631?Math.pow(t,1/3):t/Il+4/29}function rc(t){return t>6/29?t*t*t:Il*(t-4/29)}function Cs(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function bu(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function cl(t){var o=bu(t.r),u=bu(t.g),p=bu(t.b),y=of((.4124564*o+.3575761*u+.1804375*p)/.95047),b=of((.2126729*o+.7151522*u+.072175*p)/1);return{l:116*b-16,a:500*(y-b),b:200*(b-of((.0193339*o+.119192*u+.9503041*p)/1.08883)),alpha:t.a}}function _(t){var o=(t.l+16)/116,u=isNaN(t.a)?o:o+t.a/500,p=isNaN(t.b)?o:o-t.b/200;return o=1*rc(o),u=.95047*rc(u),p=1.08883*rc(p),new pi(Cs(3.2404542*u-1.5371385*o-.4985314*p),Cs(-.969266*u+1.8760108*o+.041556*p),Cs(.0556434*u-.2040259*o+1.0572252*p),t.alpha)}function M(t,o,u){var p=o-t;return t+u*(p>180||p<-180?p-360*Math.round(p/360):p)}var F={forward:cl,reverse:_,interpolate:function(t,o,u){return{l:ga(t.l,o.l,u),a:ga(t.a,o.a,u),b:ga(t.b,o.b,u),alpha:ga(t.alpha,o.alpha,u)}}},R={forward:function(t){var o=cl(t),u=o.l,p=o.a,y=o.b,b=Math.atan2(y,p)*es;return{h:b<0?b+360:b,c:Math.sqrt(p*p+y*y),l:u,alpha:t.a}},reverse:function(t){var o=t.h*vs,u=t.c;return _({l:t.l,a:Math.cos(o)*u,b:Math.sin(o)*u,alpha:t.alpha})},interpolate:function(t,o,u){return{h:M(t.h,o.h,u),c:ga(t.c,o.c,u),l:ga(t.l,o.l,u),alpha:ga(t.alpha,o.alpha,u)}}},K=Object.freeze({__proto__:null,lab:F,hcl:R}),_e=function(t,o,u,p,y){this.type=t,this.operator=o,this.interpolation=u,this.input=p,this.labels=[],this.outputs=[];for(var b=0,S=y;b<S.length;b+=1){var I=S[b],D=I[1];this.labels.push(I[0]),this.outputs.push(D)}};function je(t,o,u,p){var y=p-u,b=t-u;return y===0?0:o===1?b/y:(Math.pow(o,b)-1)/(Math.pow(o,y)-1)}_e.interpolationFactor=function(t,o,u,p){var y=0;if(t.name==="exponential")y=je(o,t.base,u,p);else if(t.name==="linear")y=je(o,1,u,p);else if(t.name==="cubic-bezier"){var b=t.controlPoints;y=new Z(b[0],b[1],b[2],b[3]).solve(je(o,1,u,p))}return y},_e.parse=function(t,o){var u=t[0],p=t[1],y=t[2],b=t.slice(3);if(!Array.isArray(p)||p.length===0)return o.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){var S=p[1];if(typeof S!="number")return o.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:S}}else{if(p[0]!=="cubic-bezier")return o.error("Unknown interpolation type "+String(p[0]),1,0);var I=p.slice(1);if(I.length!==4||I.some(function(Ye){return typeof Ye!="number"||Ye<0||Ye>1}))return o.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:I}}if(t.length-1<4)return o.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return o.error("Expected an even number of arguments.");if(!(y=o.parse(y,2,Ot)))return null;var D=[],z=null;u==="interpolate-hcl"||u==="interpolate-lab"?z=Yr:o.expectedType&&o.expectedType.kind!=="value"&&(z=o.expectedType);for(var V=0;V<b.length;V+=2){var W=b[V],ee=b[V+1],se=V+3,Me=V+4;if(typeof W!="number")return o.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',se);if(D.length&&D[D.length-1][0]>=W)return o.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',se);var Oe=o.parse(ee,Me,z);if(!Oe)return null;z=z||Oe.type,D.push([W,Oe])}return z.kind==="number"||z.kind==="color"||z.kind==="array"&&z.itemType.kind==="number"&&typeof z.N=="number"?new _e(z,u,p,y,D):o.error("Type "+bi(z)+" is not interpolatable.")},_e.prototype.evaluate=function(t){var o=this.labels,u=this.outputs;if(o.length===1)return u[0].evaluate(t);var p=this.input.evaluate(t);if(p<=o[0])return u[0].evaluate(t);var y=o.length;if(p>=o[y-1])return u[y-1].evaluate(t);var b=ou(o,p),S=_e.interpolationFactor(this.interpolation,p,o[b],o[b+1]),I=u[b].evaluate(t),D=u[b+1].evaluate(t);return this.operator==="interpolate"?ko[this.type.kind.toLowerCase()](I,D,S):this.operator==="interpolate-hcl"?R.reverse(R.interpolate(R.forward(I),R.forward(D),S)):F.reverse(F.interpolate(F.forward(I),F.forward(D),S))},_e.prototype.eachChild=function(t){t(this.input);for(var o=0,u=this.outputs;o<u.length;o+=1)t(u[o])},_e.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})},_e.prototype.serialize=function(){var t;t=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var o=[this.operator,t,this.input.serialize()],u=0;u<this.labels.length;u++)o.push(this.labels[u],this.outputs[u].serialize());return o};var pt=function(t,o){this.type=t,this.args=o};pt.parse=function(t,o){if(t.length<2)return o.error("Expectected at least one argument.");var u=null,p=o.expectedType;p&&p.kind!=="value"&&(u=p);for(var y=[],b=0,S=t.slice(1);b<S.length;b+=1){var I=o.parse(S[b],1+y.length,u,void 0,{typeAnnotation:"omit"});if(!I)return null;u=u||I.type,y.push(I)}var D=p&&y.some(function(z){return Pt(p,z.type)});return new pt(D?an:u,y)},pt.prototype.evaluate=function(t){for(var o,u=null,p=0,y=0,b=this.args;y<b.length&&(p++,(u=b[y].evaluate(t))&&u instanceof wr&&!u.available&&(o||(o=u.name),u=null,p===this.args.length&&(u=o)),u===null);y+=1);return u},pt.prototype.eachChild=function(t){this.args.forEach(t)},pt.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},pt.prototype.serialize=function(){var t=["coalesce"];return this.eachChild(function(o){t.push(o.serialize())}),t};var dt=function(t,o){this.type=o.type,this.bindings=[].concat(t),this.result=o};dt.prototype.evaluate=function(t){return this.result.evaluate(t)},dt.prototype.eachChild=function(t){for(var o=0,u=this.bindings;o<u.length;o+=1)t(u[o][1]);t(this.result)},dt.parse=function(t,o){if(t.length<4)return o.error("Expected at least 3 arguments, but found "+(t.length-1)+" instead.");for(var u=[],p=1;p<t.length-1;p+=2){var y=t[p];if(typeof y!="string")return o.error("Expected string, but found "+typeof y+" instead.",p);if(/[^a-zA-Z0-9_]/.test(y))return o.error("Variable names must contain only alphanumeric characters or '_'.",p);var b=o.parse(t[p+1],p+1);if(!b)return null;u.push([y,b])}var S=o.parse(t[t.length-1],t.length-1,o.expectedType,u);return S?new dt(u,S):null},dt.prototype.outputDefined=function(){return this.result.outputDefined()},dt.prototype.serialize=function(){for(var t=["let"],o=0,u=this.bindings;o<u.length;o+=1){var p=u[o];t.push(p[0],p[1].serialize())}return t.push(this.result.serialize()),t};var ur=function(t,o,u){this.type=t,this.index=o,this.input=u};ur.parse=function(t,o){if(t.length!==3)return o.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1,Ot),p=o.parse(t[2],2,Pi(o.expectedType||an));return u&&p?new ur(p.type.itemType,u,p):null},ur.prototype.evaluate=function(t){var o=this.index.evaluate(t),u=this.input.evaluate(t);if(o<0)throw new Ra("Array index out of bounds: "+o+" < 0.");if(o>=u.length)throw new Ra("Array index out of bounds: "+o+" > "+(u.length-1)+".");if(o!==Math.floor(o))throw new Ra("Array index must be an integer, but found "+o+" instead.");return u[o]},ur.prototype.eachChild=function(t){t(this.index),t(this.input)},ur.prototype.outputDefined=function(){return!1},ur.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var yr=function(t,o){this.type=Zr,this.needle=t,this.haystack=o};yr.parse=function(t,o){if(t.length!==3)return o.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1,an),p=o.parse(t[2],2,an);return u&&p?Aa(u.type,[Zr,nn,Ot,pn,an])?new yr(u,p):o.error("Expected first argument to be of type boolean, string, number or null, but found "+bi(u.type)+" instead"):null},yr.prototype.evaluate=function(t){var o=this.needle.evaluate(t),u=this.haystack.evaluate(t);if(!u)return!1;if(!qi(o,["boolean","string","number","null"]))throw new Ra("Expected first argument to be of type boolean, string, number or null, but found "+bi(ne(o))+" instead.");if(!qi(u,["string","array"]))throw new Ra("Expected second argument to be of type array or string, but found "+bi(ne(u))+" instead.");return u.indexOf(o)>=0},yr.prototype.eachChild=function(t){t(this.needle),t(this.haystack)},yr.prototype.outputDefined=function(){return!0},yr.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var In=function(t,o,u){this.type=Ot,this.needle=t,this.haystack=o,this.fromIndex=u};In.parse=function(t,o){if(t.length<=2||t.length>=5)return o.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1,an),p=o.parse(t[2],2,an);if(!u||!p)return null;if(!Aa(u.type,[Zr,nn,Ot,pn,an]))return o.error("Expected first argument to be of type boolean, string, number or null, but found "+bi(u.type)+" instead");if(t.length===4){var y=o.parse(t[3],3,Ot);return y?new In(u,p,y):null}return new In(u,p)},In.prototype.evaluate=function(t){var o=this.needle.evaluate(t),u=this.haystack.evaluate(t);if(!qi(o,["boolean","string","number","null"]))throw new Ra("Expected first argument to be of type boolean, string, number or null, but found "+bi(ne(o))+" instead.");if(!qi(u,["string","array"]))throw new Ra("Expected second argument to be of type array or string, but found "+bi(ne(u))+" instead.");if(this.fromIndex){var p=this.fromIndex.evaluate(t);return u.indexOf(o,p)}return u.indexOf(o)},In.prototype.eachChild=function(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)},In.prototype.outputDefined=function(){return!1},In.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var Bn=function(t,o,u,p,y,b){this.inputType=t,this.type=o,this.input=u,this.cases=p,this.outputs=y,this.otherwise=b};Bn.parse=function(t,o){if(t.length<5)return o.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if(t.length%2!=1)return o.error("Expected an even number of arguments.");var u,p;o.expectedType&&o.expectedType.kind!=="value"&&(p=o.expectedType);for(var y={},b=[],S=2;S<t.length-1;S+=2){var I=t[S],D=t[S+1];Array.isArray(I)||(I=[I]);var z=o.concat(S);if(I.length===0)return z.error("Expected at least one branch label.");for(var V=0,W=I;V<W.length;V+=1){var ee=W[V];if(typeof ee!="number"&&typeof ee!="string")return z.error("Branch labels must be numbers or strings.");if(typeof ee=="number"&&Math.abs(ee)>Number.MAX_SAFE_INTEGER)return z.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof ee=="number"&&Math.floor(ee)!==ee)return z.error("Numeric branch labels must be integer values.");if(u){if(z.checkSubtype(u,ne(ee)))return null}else u=ne(ee);if(y[String(ee)]!==void 0)return z.error("Branch labels must be unique.");y[String(ee)]=b.length}var se=o.parse(D,S,p);if(!se)return null;p=p||se.type,b.push(se)}var Me=o.parse(t[1],1,an);if(!Me)return null;var Oe=o.parse(t[t.length-1],t.length-1,p);return Oe?Me.type.kind!=="value"&&o.concat(1).checkSubtype(u,Me.type)?null:new Bn(u,p,Me,y,b,Oe):null},Bn.prototype.evaluate=function(t){var o=this.input.evaluate(t);return(ne(o)===this.inputType&&this.outputs[this.cases[o]]||this.otherwise).evaluate(t)},Bn.prototype.eachChild=function(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)},Bn.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})&&this.otherwise.outputDefined()},Bn.prototype.serialize=function(){for(var t=this,o=["match",this.input.serialize()],u=[],p={},y=0,b=Object.keys(this.cases).sort();y<b.length;y+=1){var S=b[y];(W=p[this.cases[S]])===void 0?(p[this.cases[S]]=u.length,u.push([this.cases[S],[S]])):u[W][1].push(S)}for(var I=function(se){return t.inputType.kind==="number"?Number(se):se},D=0,z=u;D<z.length;D+=1){var V=z[D],W=V[0],ee=V[1];o.push(ee.length===1?I(ee[0]):ee.map(I)),o.push(this.outputs[outputIndex$1].serialize())}return o.push(this.otherwise.serialize()),o};var Qn=function(t,o,u){this.type=t,this.branches=o,this.otherwise=u};Qn.parse=function(t,o){if(t.length<4)return o.error("Expected at least 3 arguments, but found only "+(t.length-1)+".");if(t.length%2!=0)return o.error("Expected an odd number of arguments.");var u;o.expectedType&&o.expectedType.kind!=="value"&&(u=o.expectedType);for(var p=[],y=1;y<t.length-1;y+=2){var b=o.parse(t[y],y,Zr);if(!b)return null;var S=o.parse(t[y+1],y+1,u);if(!S)return null;p.push([b,S]),u=u||S.type}var I=o.parse(t[t.length-1],t.length-1,u);return I?new Qn(u,p,I):null},Qn.prototype.evaluate=function(t){for(var o=0,u=this.branches;o<u.length;o+=1){var p=u[o],y=p[1];if(p[0].evaluate(t))return y.evaluate(t)}return this.otherwise.evaluate(t)},Qn.prototype.eachChild=function(t){for(var o=0,u=this.branches;o<u.length;o+=1){var p=u[o],y=p[1];t(p[0]),t(y)}t(this.otherwise)},Qn.prototype.outputDefined=function(){return this.branches.every(function(t){return t[1].outputDefined()})&&this.otherwise.outputDefined()},Qn.prototype.serialize=function(){var t=["case"];return this.eachChild(function(o){t.push(o.serialize())}),t};var Vi=function(t,o,u,p){this.type=t,this.input=o,this.beginIndex=u,this.endIndex=p};function Li(t,o){return t==="=="||t==="!="?o.kind==="boolean"||o.kind==="string"||o.kind==="number"||o.kind==="null"||o.kind==="value":o.kind==="string"||o.kind==="number"||o.kind==="value"}function ba(t,o,u,p){return p.compare(o,u)===0}function Gi(t,o,u){var p=t!=="=="&&t!=="!=";return function(){function y(b,S,I){this.type=Zr,this.lhs=b,this.rhs=S,this.collator=I,this.hasUntypedArgument=b.type.kind==="value"||S.type.kind==="value"}return y.parse=function(b,S){if(b.length!==3&&b.length!==4)return S.error("Expected two or three arguments.");var I=b[0],D=S.parse(b[1],1,an);if(!D)return null;if(!Li(I,D.type))return S.concat(1).error('"'+I+`" comparisons are not supported for type '`+bi(D.type)+"'.");var z=S.parse(b[2],2,an);if(!z)return null;if(!Li(I,z.type))return S.concat(2).error('"'+I+`" comparisons are not supported for type '`+bi(z.type)+"'.");if(D.type.kind!==z.type.kind&&D.type.kind!=="value"&&z.type.kind!=="value")return S.error("Cannot compare types '"+bi(D.type)+"' and '"+bi(z.type)+"'.");p&&(D.type.kind==="value"&&z.type.kind!=="value"?D=new Qi(z.type,[D]):D.type.kind!=="value"&&z.type.kind==="value"&&(z=new Qi(D.type,[z])));var V=null;if(b.length===4){if(D.type.kind!=="string"&&z.type.kind!=="string"&&D.type.kind!=="value"&&z.type.kind!=="value")return S.error("Cannot use collator to compare non-string types.");if(!(V=S.parse(b[3],3,on)))return null}return new y(D,z,V)},y.prototype.evaluate=function(b){var S=this.lhs.evaluate(b),I=this.rhs.evaluate(b);if(p&&this.hasUntypedArgument){var D=ne(S),z=ne(I);if(D.kind!==z.kind||D.kind!=="string"&&D.kind!=="number")throw new Ra('Expected arguments for "'+t+'" to be (string, string) or (number, number), but found ('+D.kind+", "+z.kind+") instead.")}if(this.collator&&!p&&this.hasUntypedArgument){var V=ne(S),W=ne(I);if(V.kind!=="string"||W.kind!=="string")return o(b,S,I)}return this.collator?u(b,S,I,this.collator.evaluate(b)):o(b,S,I)},y.prototype.eachChild=function(b){b(this.lhs),b(this.rhs),this.collator&&b(this.collator)},y.prototype.outputDefined=function(){return!0},y.prototype.serialize=function(){var b=[t];return this.eachChild(function(S){b.push(S.serialize())}),b},y}()}Vi.parse=function(t,o){if(t.length<=2||t.length>=5)return o.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1,an),p=o.parse(t[2],2,Ot);if(!u||!p)return null;if(!Aa(u.type,[Pi(an),nn,an]))return o.error("Expected first argument to be of type array or string, but found "+bi(u.type)+" instead");if(t.length===4){var y=o.parse(t[3],3,Ot);return y?new Vi(u.type,u,p,y):null}return new Vi(u.type,u,p)},Vi.prototype.evaluate=function(t){var o=this.input.evaluate(t),u=this.beginIndex.evaluate(t);if(!qi(o,["string","array"]))throw new Ra("Expected first argument to be of type array or string, but found "+bi(ne(o))+" instead.");if(this.endIndex){var p=this.endIndex.evaluate(t);return o.slice(u,p)}return o.slice(u)},Vi.prototype.eachChild=function(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)},Vi.prototype.outputDefined=function(){return!1},Vi.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var As=Gi("==",function(t,o,u){return o===u},ba),Eu=Gi("!=",function(t,o,u){return o!==u},function(t,o,u,p){return!ba(0,o,u,p)}),fl=Gi("<",function(t,o,u){return o<u},function(t,o,u,p){return p.compare(o,u)<0}),Rc=Gi(">",function(t,o,u){return o>u},function(t,o,u,p){return p.compare(o,u)>0}),tl=Gi("<=",function(t,o,u){return o<=u},function(t,o,u,p){return p.compare(o,u)<=0}),Lc=Gi(">=",function(t,o,u){return o>=u},function(t,o,u,p){return p.compare(o,u)>=0}),Bu=function(t,o,u,p,y){this.type=nn,this.number=t,this.locale=o,this.currency=u,this.minFractionDigits=p,this.maxFractionDigits=y};Bu.parse=function(t,o){if(t.length!==3)return o.error("Expected two arguments.");var u=o.parse(t[1],1,Ot);if(!u)return null;var p=t[2];if(typeof p!="object"||Array.isArray(p))return o.error("NumberFormat options argument must be an object.");var y=null;if(p.locale&&!(y=o.parse(p.locale,1,nn)))return null;var b=null;if(p.currency&&!(b=o.parse(p.currency,1,nn)))return null;var S=null;if(p["min-fraction-digits"]&&!(S=o.parse(p["min-fraction-digits"],1,Ot)))return null;var I=null;return p["max-fraction-digits"]&&!(I=o.parse(p["max-fraction-digits"],1,Ot))?null:new Bu(u,y,b,S,I)},Bu.prototype.evaluate=function(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))},Bu.prototype.eachChild=function(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)},Bu.prototype.outputDefined=function(){return!1},Bu.prototype.serialize=function(){var t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]};var Nu=function(t){this.type=Ot,this.input=t};Nu.parse=function(t,o){if(t.length!==2)return o.error("Expected 1 argument, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1);return u?u.type.kind!=="array"&&u.type.kind!=="string"&&u.type.kind!=="value"?o.error("Expected argument of type string or array, but found "+bi(u.type)+" instead."):new Nu(u):null},Nu.prototype.evaluate=function(t){var o=this.input.evaluate(t);if(typeof o=="string"||Array.isArray(o))return o.length;throw new Ra("Expected value to be of type string or array, but found "+bi(ne(o))+" instead.")},Nu.prototype.eachChild=function(t){t(this.input)},Nu.prototype.outputDefined=function(){return!1},Nu.prototype.serialize=function(){var t=["length"];return this.eachChild(function(o){t.push(o.serialize())}),t};var zu={"==":As,"!=":Eu,">":Rc,"<":fl,">=":Lc,"<=":tl,array:Qi,at:ur,boolean:Qi,case:Qn,coalesce:pt,collator:jo,format:Uo,image:$o,in:yr,"index-of":In,interpolate:_e,"interpolate-hcl":_e,"interpolate-lab":_e,length:Nu,let:dt,literal:oo,match:Bn,number:Qi,"number-format":Bu,object:Qi,slice:Vi,step:ds,string:Qi,"to-boolean":Eo,"to-color":Eo,"to-number":Eo,"to-string":Eo,var:Vo,within:ps};function uo(t,o){var u=o[0],p=o[1],y=o[2],b=o[3];u=u.evaluate(t),p=p.evaluate(t),y=y.evaluate(t);var S=b?b.evaluate(t):1,I=Mt(u,p,y,S);if(I)throw new Ra(I);return new pi(u/255*S,p/255*S,y/255*S,S)}function Bf(t,o){return t in o}function Nf(t,o){var u=o[t];return u===void 0?null:u}function ws(t){return{type:t}}function sf(t){return{result:"success",value:t}}function su(t){return{result:"error",value:t}}function Hs(t){return t["property-type"]==="data-driven"||t["property-type"]==="cross-faded-data-driven"}function uf(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function Ol(t){return!!t.expression&&t.expression.interpolated}function ya(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}function nc(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function Js(t){return t}function hl(t,o,u){return t!==void 0?t:o!==void 0?o:u!==void 0?u:void 0}function zf(t,o,u,p,y){return hl(typeof u===y?p[u]:void 0,t.default,o.default)}function ep(t,o,u){if(ya(u)!=="number")return hl(t.default,o.default);var p=t.stops.length;if(p===1||u<=t.stops[0][0])return t.stops[0][1];if(u>=t.stops[p-1][0])return t.stops[p-1][1];var y=ou(t.stops.map(function(b){return b[0]}),u);return t.stops[y][1]}function lf(t,o,u){var p=t.base!==void 0?t.base:1;if(ya(u)!=="number")return hl(t.default,o.default);var y=t.stops.length;if(y===1||u<=t.stops[0][0])return t.stops[0][1];if(u>=t.stops[y-1][0])return t.stops[y-1][1];var b=ou(t.stops.map(function(W){return W[0]}),u),S=function(W,ee,se,Me){var Oe=Me-se,Ye=W-se;return Oe===0?0:ee===1?Ye/Oe:(Math.pow(ee,Ye)-1)/(Math.pow(ee,Oe)-1)}(u,p,t.stops[b][0],t.stops[b+1][0]),I=t.stops[b][1],D=t.stops[b+1][1],z=ko[o.type]||Js;if(t.colorSpace&&t.colorSpace!=="rgb"){var V=K[t.colorSpace];z=function(W,ee){return V.reverse(V.interpolate(V.forward(W),V.forward(ee),S))}}return typeof I.evaluate=="function"?{evaluate:function(){for(var W=[],ee=arguments.length;ee--;)W[ee]=arguments[ee];var se=I.evaluate.apply(void 0,W),Me=D.evaluate.apply(void 0,W);if(se!==void 0&&Me!==void 0)return z(se,Me,S)}}:z(I,D,S)}function ic(t,o,u){return o.type==="color"?u=pi.parse(u):o.type==="formatted"?u=Ir.fromString(u.toString()):o.type==="resolvedImage"?u=wr.fromString(u.toString()):ya(u)===o.type||o.type==="enum"&&o.values[u]||(u=void 0),hl(u,t.default,o.default)}so.register(zu,{error:[{kind:"error"},[nn],function(t,o){throw new Ra(o[0].evaluate(t))}],typeof:[nn,[an],function(t,o){return bi(ne(o[0].evaluate(t)))}],"to-rgba":[Pi(Ot,4),[Yr],function(t,o){return o[0].evaluate(t).toArray()}],rgb:[Yr,[Ot,Ot,Ot],uo],rgba:[Yr,[Ot,Ot,Ot,Ot],uo],has:{type:Zr,overloads:[[[nn],function(t,o){return Bf(o[0].evaluate(t),t.properties())}],[[nn,_i],function(t,o){var u=o[1];return Bf(o[0].evaluate(t),u.evaluate(t))}]]},get:{type:an,overloads:[[[nn],function(t,o){return Nf(o[0].evaluate(t),t.properties())}],[[nn,_i],function(t,o){var u=o[1];return Nf(o[0].evaluate(t),u.evaluate(t))}]]},"feature-state":[an,[nn],function(t,o){return Nf(o[0].evaluate(t),t.featureState||{})}],properties:[_i,[],function(t){return t.properties()}],"geometry-type":[nn,[],function(t){return t.geometryType()}],id:[an,[],function(t){return t.id()}],zoom:[Ot,[],function(t){return t.globals.zoom}],"heatmap-density":[Ot,[],function(t){return t.globals.heatmapDensity||0}],"line-progress":[Ot,[],function(t){return t.globals.lineProgress||0}],accumulated:[an,[],function(t){return t.globals.accumulated===void 0?null:t.globals.accumulated}],"+":[Ot,ws(Ot),function(t,o){for(var u=0,p=0,y=o;p<y.length;p+=1)u+=y[p].evaluate(t);return u}],"*":[Ot,ws(Ot),function(t,o){for(var u=1,p=0,y=o;p<y.length;p+=1)u*=y[p].evaluate(t);return u}],"-":{type:Ot,overloads:[[[Ot,Ot],function(t,o){var u=o[1];return o[0].evaluate(t)-u.evaluate(t)}],[[Ot],function(t,o){return-o[0].evaluate(t)}]]},"/":[Ot,[Ot,Ot],function(t,o){var u=o[1];return o[0].evaluate(t)/u.evaluate(t)}],"%":[Ot,[Ot,Ot],function(t,o){var u=o[1];return o[0].evaluate(t)%u.evaluate(t)}],ln2:[Ot,[],function(){return Math.LN2}],pi:[Ot,[],function(){return Math.PI}],e:[Ot,[],function(){return Math.E}],"^":[Ot,[Ot,Ot],function(t,o){var u=o[1];return Math.pow(o[0].evaluate(t),u.evaluate(t))}],sqrt:[Ot,[Ot],function(t,o){return Math.sqrt(o[0].evaluate(t))}],log10:[Ot,[Ot],function(t,o){return Math.log(o[0].evaluate(t))/Math.LN10}],ln:[Ot,[Ot],function(t,o){return Math.log(o[0].evaluate(t))}],log2:[Ot,[Ot],function(t,o){return Math.log(o[0].evaluate(t))/Math.LN2}],sin:[Ot,[Ot],function(t,o){return Math.sin(o[0].evaluate(t))}],cos:[Ot,[Ot],function(t,o){return Math.cos(o[0].evaluate(t))}],tan:[Ot,[Ot],function(t,o){return Math.tan(o[0].evaluate(t))}],asin:[Ot,[Ot],function(t,o){return Math.asin(o[0].evaluate(t))}],acos:[Ot,[Ot],function(t,o){return Math.acos(o[0].evaluate(t))}],atan:[Ot,[Ot],function(t,o){return Math.atan(o[0].evaluate(t))}],min:[Ot,ws(Ot),function(t,o){return Math.min.apply(Math,o.map(function(u){return u.evaluate(t)}))}],max:[Ot,ws(Ot),function(t,o){return Math.max.apply(Math,o.map(function(u){return u.evaluate(t)}))}],abs:[Ot,[Ot],function(t,o){return Math.abs(o[0].evaluate(t))}],round:[Ot,[Ot],function(t,o){var u=o[0].evaluate(t);return u<0?-Math.round(-u):Math.round(u)}],floor:[Ot,[Ot],function(t,o){return Math.floor(o[0].evaluate(t))}],ceil:[Ot,[Ot],function(t,o){return Math.ceil(o[0].evaluate(t))}],"filter-==":[Zr,[nn,an],function(t,o){var u=o[0],p=o[1];return t.properties()[u.value]===p.value}],"filter-id-==":[Zr,[an],function(t,o){var u=o[0];return t.id()===u.value}],"filter-type-==":[Zr,[nn],function(t,o){var u=o[0];return t.geometryType()===u.value}],"filter-<":[Zr,[nn,an],function(t,o){var u=o[0],p=o[1],y=t.properties()[u.value],b=p.value;return typeof y==typeof b&&y<b}],"filter-id-<":[Zr,[an],function(t,o){var u=o[0],p=t.id(),y=u.value;return typeof p==typeof y&&p<y}],"filter->":[Zr,[nn,an],function(t,o){var u=o[0],p=o[1],y=t.properties()[u.value],b=p.value;return typeof y==typeof b&&y>b}],"filter-id->":[Zr,[an],function(t,o){var u=o[0],p=t.id(),y=u.value;return typeof p==typeof y&&p>y}],"filter-<=":[Zr,[nn,an],function(t,o){var u=o[0],p=o[1],y=t.properties()[u.value],b=p.value;return typeof y==typeof b&&y<=b}],"filter-id-<=":[Zr,[an],function(t,o){var u=o[0],p=t.id(),y=u.value;return typeof p==typeof y&&p<=y}],"filter->=":[Zr,[nn,an],function(t,o){var u=o[0],p=o[1],y=t.properties()[u.value],b=p.value;return typeof y==typeof b&&y>=b}],"filter-id->=":[Zr,[an],function(t,o){var u=o[0],p=t.id(),y=u.value;return typeof p==typeof y&&p>=y}],"filter-has":[Zr,[an],function(t,o){return o[0].value in t.properties()}],"filter-has-id":[Zr,[],function(t){return t.id()!==null&&t.id()!==void 0}],"filter-type-in":[Zr,[Pi(nn)],function(t,o){return o[0].value.indexOf(t.geometryType())>=0}],"filter-id-in":[Zr,[Pi(an)],function(t,o){return o[0].value.indexOf(t.id())>=0}],"filter-in-small":[Zr,[nn,Pi(an)],function(t,o){var u=o[0];return o[1].value.indexOf(t.properties()[u.value])>=0}],"filter-in-large":[Zr,[nn,Pi(an)],function(t,o){var u=o[0],p=o[1];return function(y,b,S,I){for(;S<=I;){var D=S+I>>1;if(b[D]===y)return!0;b[D]>y?I=D-1:S=D+1}return!1}(t.properties()[u.value],p.value,0,p.value.length-1)}],all:{type:Zr,overloads:[[[Zr,Zr],function(t,o){var u=o[1];return o[0].evaluate(t)&&u.evaluate(t)}],[ws(Zr),function(t,o){for(var u=0,p=o;u<p.length;u+=1)if(!p[u].evaluate(t))return!1;return!0}]]},any:{type:Zr,overloads:[[[Zr,Zr],function(t,o){var u=o[1];return o[0].evaluate(t)||u.evaluate(t)}],[ws(Zr),function(t,o){for(var u=0,p=o;u<p.length;u+=1)if(p[u].evaluate(t))return!0;return!1}]]},"!":[Zr,[Zr],function(t,o){return!o[0].evaluate(t)}],"is-supported-script":[Zr,[nn],function(t,o){var u=t.globals&&t.globals.isSupportedScript;return!u||u(o[0].evaluate(t))}],upcase:[nn,[nn],function(t,o){return o[0].evaluate(t).toUpperCase()}],downcase:[nn,[nn],function(t,o){return o[0].evaluate(t).toLowerCase()}],concat:[nn,ws(an),function(t,o){return o.map(function(u){return Fu(u.evaluate(t))}).join("")}],"resolved-locale":[nn,[on],function(t,o){return o[0].evaluate(t).resolvedLocale()}]});var ac=function(t,o){this.expression=t,this._warningHistory={},this._evaluator=new sa,this._defaultValue=o?function(u){return u.type==="color"&&nc(u.default)?new pi(0,0,0,0):u.type==="color"?pi.parse(u.default)||null:u.default===void 0?null:u.default}(o):null,this._enumValues=o&&o.type==="enum"?o.values:null};function oc(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in zu}function sc(t,o){var u=new Qs(zu,[],o?function(y){var b={color:Yr,string:nn,number:Ot,enum:nn,boolean:Zr,formatted:Xi,resolvedImage:yi};return y.type==="array"?Pi(b[y.value]||an,y.length):b[y.type]}(o):void 0),p=u.parse(t,void 0,void 0,void 0,o&&o.type==="string"?{typeAnnotation:"coerce"}:void 0);return p?sf(new ac(p,o)):su(u.errors)}ac.prototype.evaluateWithoutErrorHandling=function(t,o,u,p,y,b){return this._evaluator.globals=t,this._evaluator.feature=o,this._evaluator.featureState=u,this._evaluator.canonical=p,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=b,this.expression.evaluate(this._evaluator)},ac.prototype.evaluate=function(t,o,u,p,y,b){this._evaluator.globals=t,this._evaluator.feature=o||null,this._evaluator.featureState=u||null,this._evaluator.canonical=p,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=b||null;try{var S=this.expression.evaluate(this._evaluator);if(S==null||typeof S=="number"&&S!=S)return this._defaultValue;if(this._enumValues&&!(S in this._enumValues))throw new Ra("Expected value to be one of "+Object.keys(this._enumValues).map(function(I){return JSON.stringify(I)}).join(", ")+", but found "+JSON.stringify(S)+" instead.");return S}catch(I){return this._warningHistory[I.message]||(this._warningHistory[I.message]=!0,typeof console!="undefined"&&console.warn(I.message)),this._defaultValue}};var uc=function(t,o){this.kind=t,this._styleExpression=o,this.isStateDependent=t!=="constant"&&!Ss(o.expression)};uc.prototype.evaluateWithoutErrorHandling=function(t,o,u,p,y,b){return this._styleExpression.evaluateWithoutErrorHandling(t,o,u,p,y,b)},uc.prototype.evaluate=function(t,o,u,p,y,b){return this._styleExpression.evaluate(t,o,u,p,y,b)};var Rl=function(t,o,u,p){this.kind=t,this.zoomStops=u,this._styleExpression=o,this.isStateDependent=t!=="camera"&&!Ss(o.expression),this.interpolationType=p};function Ll(t,o){if((t=sc(t,o)).result==="error")return t;var u=t.value.expression,p=Jo(u);if(!p&&!Hs(o))return su([new vr("","data expressions not supported")]);var y=Lo(u,["zoom"]);if(!y&&!uf(o))return su([new vr("","zoom expressions not supported")]);var b=function S(I){var D=null;if(I instanceof dt)D=S(I.result);else if(I instanceof pt)for(var z=0,V=I.args;z<V.length&&!(D=S(V[z]));z+=1);else(I instanceof ds||I instanceof _e)&&I.input instanceof so&&I.input.name==="zoom"&&(D=I);return D instanceof vr||I.eachChild(function(W){var ee=S(W);ee instanceof vr?D=ee:!D&&ee?D=new vr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):D&&ee&&D!==ee&&(D=new vr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),D}(u);return b||y?b instanceof vr?su([b]):b instanceof _e&&!Ol(o)?su([new vr("",'"interpolate" expressions cannot be used with this property')]):sf(b?new Rl(p?"camera":"composite",t.value,b.labels,b instanceof _e?b.interpolation:void 0):new uc(p?"constant":"source",t.value)):su([new vr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}Rl.prototype.evaluateWithoutErrorHandling=function(t,o,u,p,y,b){return this._styleExpression.evaluateWithoutErrorHandling(t,o,u,p,y,b)},Rl.prototype.evaluate=function(t,o,u,p,y,b){return this._styleExpression.evaluate(t,o,u,p,y,b)},Rl.prototype.interpolationFactor=function(t,o,u){return this.interpolationType?_e.interpolationFactor(this.interpolationType,t,o,u):0};var pl=function(t,o){this._parameters=t,this._specification=o,pr(this,function u(p,y){var b,S,I,D=y.type==="color",z=p.stops&&typeof p.stops[0][0]=="object",V=z||!(z||p.property!==void 0),W=p.type||(Ol(y)?"exponential":"interval");if(D&&((p=pr({},p)).stops&&(p.stops=p.stops.map(function(gn){return[gn[0],pi.parse(gn[1])]})),p.default=pi.parse(p.default?p.default:y.default)),p.colorSpace&&p.colorSpace!=="rgb"&&!K[p.colorSpace])throw new Error("Unknown color space: "+p.colorSpace);if(W==="exponential")b=lf;else if(W==="interval")b=ep;else if(W==="categorical"){b=zf,S=Object.create(null);for(var ee=0,se=p.stops;ee<se.length;ee+=1){var Me=se[ee];S[Me[0]]=Me[1]}I=typeof p.stops[0][0]}else{if(W!=="identity")throw new Error('Unknown function type "'+W+'"');b=ic}if(z){for(var Oe={},Ye=[],ze=0;ze<p.stops.length;ze++){var st=p.stops[ze],Tt=st[0].zoom;Oe[Tt]===void 0&&(Oe[Tt]={zoom:Tt,type:p.type,property:p.property,default:p.default,stops:[]},Ye.push(Tt)),Oe[Tt].stops.push([st[0].value,st[1]])}for(var Vt=[],Xt=0,lr=Ye;Xt<lr.length;Xt+=1){var Lr=lr[Xt];Vt.push([Oe[Lr].zoom,u(Oe[Lr],y)])}var $r={name:"linear"};return{kind:"composite",interpolationType:$r,interpolationFactor:_e.interpolationFactor.bind(void 0,$r),zoomStops:Vt.map(function(gn){return gn[0]}),evaluate:function(gn,Yn){var hn=gn.zoom;return lf({stops:Vt,base:p.base},y,hn).evaluate(hn,Yn)}}}if(V){var Zn=W==="exponential"?{name:"exponential",base:p.base!==void 0?p.base:1}:null;return{kind:"camera",interpolationType:Zn,interpolationFactor:_e.interpolationFactor.bind(void 0,Zn),zoomStops:p.stops.map(function(gn){return gn[0]}),evaluate:function(gn){return b(p,y,gn.zoom,S,I)}}}return{kind:"source",evaluate:function(gn,Yn){var hn=Yn&&Yn.properties?Yn.properties[p.property]:void 0;return hn===void 0?hl(p.default,y.default):b(p,y,hn,S,I)}}}(this._parameters,this._specification))};function eu(t){var o=t.key,u=t.value,p=t.valueSpec||{},y=t.objectElementValidators||{},b=t.style,S=t.styleSpec,I=[],D=ya(u);if(D!=="object")return[new ke(o,u,"object expected, "+D+" found")];for(var z in u){var V=z.split(".")[0],W=p[V]||p["*"],ee=void 0;if(y[V])ee=y[V];else if(p[V])ee=kn;else if(y["*"])ee=y["*"];else{if(!p["*"]){I.push(new ke(o,u[z],'unknown property "'+z+'"'));continue}ee=kn}I=I.concat(ee({key:(o&&o+".")+z,value:u[z],valueSpec:W,style:b,styleSpec:S,object:u,objectKey:z},u))}for(var se in p)y[se]||p[se].required&&p[se].default===void 0&&u[se]===void 0&&I.push(new ke(o,u,'missing required property "'+se+'"'));return I}function kc(t){var o=t.value,u=t.valueSpec,p=t.style,y=t.styleSpec,b=t.key,S=t.arrayElementValidator||kn;if(ya(o)!=="array")return[new ke(b,o,"array expected, "+ya(o)+" found")];if(u.length&&o.length!==u.length)return[new ke(b,o,"array length "+u.length+" expected, length "+o.length+" found")];if(u["min-length"]&&o.length<u["min-length"])return[new ke(b,o,"array length at least "+u["min-length"]+" expected, length "+o.length+" found")];var I={type:u.value,values:u.values};y.$version<7&&(I.function=u.function),ya(u.value)==="object"&&(I=u.value);for(var D=[],z=0;z<o.length;z++)D=D.concat(S({array:o,arrayIndex:z,value:o[z],valueSpec:I,style:p,styleSpec:y,key:b+"["+z+"]"}));return D}function cf(t){var o=t.key,u=t.value,p=t.valueSpec,y=ya(u);return y==="number"&&u!=u&&(y="NaN"),y!=="number"?[new ke(o,u,"number expected, "+y+" found")]:"minimum"in p&&u<p.minimum?[new ke(o,u,u+" is less than the minimum value "+p.minimum)]:"maximum"in p&&u>p.maximum?[new ke(o,u,u+" is greater than the maximum value "+p.maximum)]:[]}function Uf(t){var o,u,p,y=t.valueSpec,b=Ft(t.value.type),S={},I=b!=="categorical"&&t.value.property===void 0,D=!I,z=ya(t.value.stops)==="array"&&ya(t.value.stops[0])==="array"&&ya(t.value.stops[0][0])==="object",V=eu({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(se){if(b==="identity")return[new ke(se.key,se.value,'identity function may not have a "stops" property')];var Me=[],Oe=se.value;return Me=Me.concat(kc({key:se.key,value:Oe,valueSpec:se.valueSpec,style:se.style,styleSpec:se.styleSpec,arrayElementValidator:W})),ya(Oe)==="array"&&Oe.length===0&&Me.push(new ke(se.key,Oe,"array must have at least one stop")),Me},default:function(se){return kn({key:se.key,value:se.value,valueSpec:y,style:se.style,styleSpec:se.styleSpec})}}});return b==="identity"&&I&&V.push(new ke(t.key,t.value,'missing required property "property"')),b==="identity"||t.value.stops||V.push(new ke(t.key,t.value,'missing required property "stops"')),b==="exponential"&&t.valueSpec.expression&&!Ol(t.valueSpec)&&V.push(new ke(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(D&&!Hs(t.valueSpec)?V.push(new ke(t.key,t.value,"property functions not supported")):I&&!uf(t.valueSpec)&&V.push(new ke(t.key,t.value,"zoom functions not supported"))),b!=="categorical"&&!z||t.value.property!==void 0||V.push(new ke(t.key,t.value,'"property" property is required')),V;function W(se){var Me=[],Oe=se.value,Ye=se.key;if(ya(Oe)!=="array")return[new ke(Ye,Oe,"array expected, "+ya(Oe)+" found")];if(Oe.length!==2)return[new ke(Ye,Oe,"array length 2 expected, length "+Oe.length+" found")];if(z){if(ya(Oe[0])!=="object")return[new ke(Ye,Oe,"object expected, "+ya(Oe[0])+" found")];if(Oe[0].zoom===void 0)return[new ke(Ye,Oe,"object stop key must have zoom")];if(Oe[0].value===void 0)return[new ke(Ye,Oe,"object stop key must have value")];if(p&&p>Ft(Oe[0].zoom))return[new ke(Ye,Oe[0].zoom,"stop zoom values must appear in ascending order")];Ft(Oe[0].zoom)!==p&&(p=Ft(Oe[0].zoom),u=void 0,S={}),Me=Me.concat(eu({key:Ye+"[0]",value:Oe[0],valueSpec:{zoom:{}},style:se.style,styleSpec:se.styleSpec,objectElementValidators:{zoom:cf,value:ee}}))}else Me=Me.concat(ee({key:Ye+"[0]",value:Oe[0],valueSpec:{},style:se.style,styleSpec:se.styleSpec},Oe));return oc(zt(Oe[1]))?Me.concat([new ke(Ye+"[1]",Oe[1],"expressions are not allowed in function stops.")]):Me.concat(kn({key:Ye+"[1]",value:Oe[1],valueSpec:y,style:se.style,styleSpec:se.styleSpec}))}function ee(se,Me){var Oe=ya(se.value),Ye=Ft(se.value),ze=se.value!==null?se.value:Me;if(o){if(Oe!==o)return[new ke(se.key,ze,Oe+" stop domain type must match previous stop domain type "+o)]}else o=Oe;if(Oe!=="number"&&Oe!=="string"&&Oe!=="boolean")return[new ke(se.key,ze,"stop domain value must be a number, string, or boolean")];if(Oe!=="number"&&b!=="categorical"){var st="number expected, "+Oe+" found";return Hs(y)&&b===void 0&&(st+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ke(se.key,ze,st)]}return b!=="categorical"||Oe!=="number"||isFinite(Ye)&&Math.floor(Ye)===Ye?b!=="categorical"&&Oe==="number"&&u!==void 0&&Ye<u?[new ke(se.key,ze,"stop domain values must appear in ascending order")]:(u=Ye,b==="categorical"&&Ye in S?[new ke(se.key,ze,"stop domain values must be unique")]:(S[Ye]=!0,[])):[new ke(se.key,ze,"integer expected, found "+Ye)]}}function dl(t){var o=(t.expressionContext==="property"?Ll:sc)(zt(t.value),t.valueSpec);if(o.result==="error")return o.value.map(function(p){return new ke(""+t.key+p.key,t.value,p.message)});var u=o.value.expression||o.value._styleExpression.expression;if(t.expressionContext==="property"&&t.propertyKey==="text-font"&&!u.outputDefined())return[new ke(t.key,t.value,'Invalid data expression for "'+t.propertyKey+'". Output values must be contained as literals within the expression.')];if(t.expressionContext==="property"&&t.propertyType==="layout"&&!Ss(u))return[new ke(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if(t.expressionContext==="filter"&&!Ss(u))return[new ke(t.key,t.value,'"feature-state" data expressions are not supported with filters.')];if(t.expressionContext&&t.expressionContext.indexOf("cluster")===0){if(!Lo(u,["zoom","feature-state"]))return[new ke(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(t.expressionContext==="cluster-initial"&&!Jo(u))return[new ke(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function lc(t){var o=t.key,u=t.value,p=t.valueSpec,y=[];return Array.isArray(p.values)?p.values.indexOf(Ft(u))===-1&&y.push(new ke(o,u,"expected one of ["+p.values.join(", ")+"], "+JSON.stringify(u)+" found")):Object.keys(p.values).indexOf(Ft(u))===-1&&y.push(new ke(o,u,"expected one of ["+Object.keys(p.values).join(", ")+"], "+JSON.stringify(u)+" found")),y}function rl(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(var o=0,u=t.slice(1);o<u.length;o+=1){var p=u[o];if(!rl(p)&&typeof p!="boolean")return!1}return!0;default:return!0}}pl.deserialize=function(t){return new pl(t._parameters,t._specification)},pl.serialize=function(t){return{_parameters:t._parameters,_specification:t._specification}};var ff={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Dc(t){if(t==null)return{filter:function(){return!0},needGeometry:!1};rl(t)||(t=kl(t));var o=sc(t,ff);if(o.result==="error")throw new Error(o.value.map(function(u){return u.key+": "+u.message}).join(", "));return{filter:function(u,p,y){return o.value.evaluate(u,p,{},y)},needGeometry:function u(p){if(!Array.isArray(p))return!1;if(p[0]==="within")return!0;for(var y=1;y<p.length;y++)if(u(p[y]))return!0;return!1}(t)}}function bh(t,o){return t<o?-1:t>o?1:0}function kl(t){if(!t)return!0;var o,u=t[0];return t.length<=1?u!=="any":u==="=="?Dl(t[1],t[2],"=="):u==="!="?vl(Dl(t[1],t[2],"==")):u==="<"||u===">"||u==="<="||u===">="?Dl(t[1],t[2],u):u==="any"?(o=t.slice(1),["any"].concat(o.map(kl))):u==="all"?["all"].concat(t.slice(1).map(kl)):u==="none"?["all"].concat(t.slice(1).map(kl).map(vl)):u==="in"?Zf(t[1],t.slice(2)):u==="!in"?vl(Zf(t[1],t.slice(2))):u==="has"?jf(t[1]):u==="!has"?vl(jf(t[1])):u!=="within"||t}function Dl(t,o,u){switch(t){case"$type":return["filter-type-"+u,o];case"$id":return["filter-id-"+u,o];default:return["filter-"+u,t,o]}}function Zf(t,o){if(o.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",o]];case"$id":return["filter-id-in",["literal",o]];default:return o.length>200&&!o.some(function(u){return typeof u!=typeof o[0]})?["filter-in-large",t,["literal",o.sort(bh)]]:["filter-in-small",t,["literal",o]]}}function jf(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function vl(t){return["!",t]}function Vf(t){return rl(zt(t.value))?dl(pr({},t,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function o(u){var p=u.value,y=u.key;if(ya(p)!=="array")return[new ke(y,p,"array expected, "+ya(p)+" found")];var b,S=u.styleSpec,I=[];if(p.length<1)return[new ke(y,p,"filter array must have at least 1 element")];switch(I=I.concat(lc({key:y+"[0]",value:p[0],valueSpec:S.filter_operator,style:u.style,styleSpec:u.styleSpec})),Ft(p[0])){case"<":case"<=":case">":case">=":p.length>=2&&Ft(p[1])==="$type"&&I.push(new ke(y,p,'"$type" cannot be use with operator "'+p[0]+'"'));case"==":case"!=":p.length!==3&&I.push(new ke(y,p,'filter array for operator "'+p[0]+'" must have 3 elements'));case"in":case"!in":p.length>=2&&(b=ya(p[1]))!=="string"&&I.push(new ke(y+"[1]",p[1],"string expected, "+b+" found"));for(var D=2;D<p.length;D++)b=ya(p[D]),Ft(p[1])==="$type"?I=I.concat(lc({key:y+"["+D+"]",value:p[D],valueSpec:S.geometry_type,style:u.style,styleSpec:u.styleSpec})):b!=="string"&&b!=="number"&&b!=="boolean"&&I.push(new ke(y+"["+D+"]",p[D],"string, number, or boolean expected, "+b+" found"));break;case"any":case"all":case"none":for(var z=1;z<p.length;z++)I=I.concat(o({key:y+"["+z+"]",value:p[z],style:u.style,styleSpec:u.styleSpec}));break;case"has":case"!has":b=ya(p[1]),p.length!==2?I.push(new ke(y,p,'filter array for "'+p[0]+'" operator must have 2 elements')):b!=="string"&&I.push(new ke(y+"[1]",p[1],"string expected, "+b+" found"));break;case"within":b=ya(p[1]),p.length!==2?I.push(new ke(y,p,'filter array for "'+p[0]+'" operator must have 2 elements')):b!=="object"&&I.push(new ke(y+"[1]",p[1],"object expected, "+b+" found"))}return I}(t)}function Eh(t,o){var u=t.key,p=t.style,y=t.styleSpec,b=t.value,S=t.objectKey,I=y[o+"_"+t.layerType];if(!I)return[];var D=S.match(/^(.*)-transition$/);if(o==="paint"&&D&&I[D[1]]&&I[D[1]].transition)return kn({key:u,value:b,valueSpec:y.transition,style:p,styleSpec:y});var z,V=t.valueSpec||I[S];if(!V)return[new ke(u,b,'unknown property "'+S+'"')];if(ya(b)==="string"&&Hs(V)&&!V.tokens&&(z=/^{([^}]+)}$/.exec(b)))return[new ke(u,b,'"'+S+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(z[1])+" }`.")];var W=[];return t.layerType==="symbol"&&(S==="text-field"&&p&&!p.glyphs&&W.push(new ke(u,b,'use of "text-field" requires a style "glyphs" property')),S==="text-font"&&nc(zt(b))&&Ft(b.type)==="identity"&&W.push(new ke(u,b,'"text-font" does not support identity functions'))),W.concat(kn({key:t.key,value:b,valueSpec:V,style:p,styleSpec:y,expressionContext:"property",propertyType:o,propertyKey:S}))}function Fc(t){return Eh(t,"paint")}function cc(t){return Eh(t,"layout")}function tp(t){var o=[],u=t.value,p=t.key,y=t.style,b=t.styleSpec;u.type||u.ref||o.push(new ke(p,u,'either "type" or "ref" is required'));var S,I=Ft(u.type),D=Ft(u.ref);if(u.id)for(var z=Ft(u.id),V=0;V<t.arrayIndex;V++){var W=y.layers[V];Ft(W.id)===z&&o.push(new ke(p,u.id,'duplicate layer id "'+u.id+'", previously used at line '+W.id.__line__))}if("ref"in u)["type","source","source-layer","filter","layout"].forEach(function(Me){Me in u&&o.push(new ke(p,u[Me],'"'+Me+'" is prohibited for ref layers'))}),y.layers.forEach(function(Me){Ft(Me.id)===D&&(S=Me)}),S?S.ref?o.push(new ke(p,u.ref,"ref cannot reference another ref layer")):I=Ft(S.type):o.push(new ke(p,u.ref,'ref layer "'+D+'" not found'));else if(I!=="background")if(u.source){var ee=y.sources&&y.sources[u.source],se=ee&&Ft(ee.type);ee?se==="vector"&&I==="raster"?o.push(new ke(p,u.source,'layer "'+u.id+'" requires a raster source')):se==="raster"&&I!=="raster"?o.push(new ke(p,u.source,'layer "'+u.id+'" requires a vector source')):se!=="vector"||u["source-layer"]?se==="raster-dem"&&I!=="hillshade"?o.push(new ke(p,u.source,"raster-dem source can only be used with layer type 'hillshade'.")):I!=="line"||!u.paint||!u.paint["line-gradient"]||se==="geojson"&&ee.lineMetrics||o.push(new ke(p,u,'layer "'+u.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):o.push(new ke(p,u,'layer "'+u.id+'" must specify a "source-layer"')):o.push(new ke(p,u.source,'source "'+u.source+'" not found'))}else o.push(new ke(p,u,'missing required property "source"'));return o=o.concat(eu({key:p,value:u,valueSpec:b.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return kn({key:p+".type",value:u.type,valueSpec:b.layer.type,style:t.style,styleSpec:t.styleSpec,object:u,objectKey:"type"})},filter:Vf,layout:function(Me){return eu({layer:u,key:Me.key,value:Me.value,style:Me.style,styleSpec:Me.styleSpec,objectElementValidators:{"*":function(Oe){return cc(pr({layerType:I},Oe))}}})},paint:function(Me){return eu({layer:u,key:Me.key,value:Me.value,style:Me.style,styleSpec:Me.styleSpec,objectElementValidators:{"*":function(Oe){return Fc(pr({layerType:I},Oe))}}})}}}))}function fc(t){var o=t.value,u=t.key,p=ya(o);return p!=="string"?[new ke(u,o,"string expected, "+p+" found")]:[]}var Va={promoteId:function(t){var o=t.key,u=t.value;if(ya(u)==="string")return fc({key:o,value:u});var p=[];for(var y in u)p.push.apply(p,fc({key:o+"."+y,value:u[y]}));return p}};function hc(t){var o=t.value,u=t.key,p=t.styleSpec,y=t.style;if(!o.type)return[new ke(u,o,'"type" is required')];var b,S=Ft(o.type);switch(S){case"vector":case"raster":case"raster-dem":return eu({key:u,value:o,valueSpec:p["source_"+S.replace("-","_")],style:t.style,styleSpec:p,objectElementValidators:Va});case"geojson":if(b=eu({key:u,value:o,valueSpec:p.source_geojson,style:y,styleSpec:p,objectElementValidators:Va}),o.cluster)for(var I in o.clusterProperties){var D=o.clusterProperties[I],z=D[0],V=typeof z=="string"?[z,["accumulated"],["get",I]]:z;b.push.apply(b,dl({key:u+"."+I+".map",value:D[1],expressionContext:"cluster-map"})),b.push.apply(b,dl({key:u+"."+I+".reduce",value:V,expressionContext:"cluster-reduce"}))}return b;case"video":return eu({key:u,value:o,valueSpec:p.source_video,style:y,styleSpec:p});case"image":return eu({key:u,value:o,valueSpec:p.source_image,style:y,styleSpec:p});case"canvas":return[new ke(u,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return lc({key:u+".type",value:o.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:y,styleSpec:p})}}function ts(t){var o=t.value,u=t.styleSpec,p=u.light,y=t.style,b=[],S=ya(o);if(o===void 0)return b;if(S!=="object")return b.concat([new ke("light",o,"object expected, "+S+" found")]);for(var I in o){var D=I.match(/^(.*)-transition$/);b=b.concat(D&&p[D[1]]&&p[D[1]].transition?kn({key:I,value:o[I],valueSpec:u.transition,style:y,styleSpec:u}):p[I]?kn({key:I,value:o[I],valueSpec:p[I],style:y,styleSpec:u}):[new ke(I,o[I],'unknown property "'+I+'"')])}return b}var Uu={"*":function(){return[]},array:kc,boolean:function(t){var o=t.value,u=t.key,p=ya(o);return p!=="boolean"?[new ke(u,o,"boolean expected, "+p+" found")]:[]},number:cf,color:function(t){var o=t.key,u=t.value,p=ya(u);return p!=="string"?[new ke(o,u,"color expected, "+p+" found")]:Ii(u)===null?[new ke(o,u,'color expected, "'+u+'" found')]:[]},constants:vt,enum:lc,filter:Vf,function:Uf,layer:tp,object:eu,source:hc,light:ts,string:fc,formatted:function(t){return fc(t).length===0?[]:dl(t)},resolvedImage:function(t){return fc(t).length===0?[]:dl(t)}};function kn(t){var o=t.value,u=t.valueSpec,p=t.styleSpec;return u.expression&&nc(Ft(o))?Uf(t):u.expression&&oc(zt(o))?dl(t):u.type&&Uu[u.type]?Uu[u.type](t):eu(pr({},t,{valueSpec:u.type?p[u.type]:u}))}function Ma(t){var o=t.value,u=t.key,p=fc(t);return p.length||(o.indexOf("{fontstack}")===-1&&p.push(new ke(u,o,'"glyphs" url must include a "{fontstack}" token')),o.indexOf("{range}")===-1&&p.push(new ke(u,o,'"glyphs" url must include a "{range}" token'))),p}function Ws(t,o){o===void 0&&(o=pe);var u=[];return u=u.concat(kn({key:"",value:t,valueSpec:o.$root,styleSpec:o,style:t,objectElementValidators:{glyphs:Ma,"*":function(){return[]}}})),t.constants&&(u=u.concat(vt({key:"constants",value:t.constants,style:t,styleSpec:o}))),Bc(u)}function Bc(t){return[].concat(t).sort(function(o,u){return o.line-u.line})}function Zu(t){return function(){for(var o=[],u=arguments.length;u--;)o[u]=arguments[u];return Bc(t.apply(this,o))}}Ws.source=Zu(hc),Ws.light=Zu(ts),Ws.layer=Zu(tp),Ws.filter=Zu(Vf),Ws.paintProperty=Zu(Fc),Ws.layoutProperty=Zu(cc);var Nc=Ws,rp=Nc.light,lo=Nc.paintProperty,ju=Nc.layoutProperty;function Su(t,o){var u=!1;if(o&&o.length)for(var p=0,y=o;p<y.length;p+=1)t.fire(new He(new Error(y[p].message))),u=!0;return u}var tu=Do;function Do(t,o,u){var p=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var y=new Int32Array(this.arrayBuffer);t=y[0],this.d=(o=y[1])+2*(u=y[2]);for(var b=0;b<this.d*this.d;b++){var S=y[3+b],I=y[3+b+1];p.push(S===I?null:y.subarray(S,I))}var D=y[3+p.length+1];this.keys=y.subarray(y[3+p.length],D),this.bboxes=y.subarray(D),this.insert=this._insertReadonly}else{this.d=o+2*u;for(var z=0;z<this.d*this.d;z++)p.push([]);this.keys=[],this.bboxes=[]}this.n=o,this.extent=t,this.padding=u,this.scale=o/t,this.uid=0;var V=u/o*t;this.min=-V,this.max=t+V}Do.prototype.insert=function(t,o,u,p,y){this._forEachCell(o,u,p,y,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(p),this.bboxes.push(y)},Do.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Do.prototype._insertCell=function(t,o,u,p,y,b){this.cells[y].push(b)},Do.prototype.query=function(t,o,u,p,y){var b=this.min,S=this.max;if(t<=b&&o<=b&&S<=u&&S<=p&&!y)return Array.prototype.slice.call(this.keys);var I=[];return this._forEachCell(t,o,u,p,this._queryCell,I,{},y),I},Do.prototype._queryCell=function(t,o,u,p,y,b,S,I){var D=this.cells[y];if(D!==null)for(var z=this.keys,V=this.bboxes,W=0;W<D.length;W++){var ee=D[W];if(S[ee]===void 0){var se=4*ee;(I?I(V[se+0],V[se+1],V[se+2],V[se+3]):t<=V[se+2]&&o<=V[se+3]&&u>=V[se+0]&&p>=V[se+1])?(S[ee]=!0,b.push(z[ee])):S[ee]=!1}}},Do.prototype._forEachCell=function(t,o,u,p,y,b,S,I){for(var D=this._convertToCellCoord(t),z=this._convertToCellCoord(o),V=this._convertToCellCoord(u),W=this._convertToCellCoord(p),ee=D;ee<=V;ee++)for(var se=z;se<=W;se++){var Me=this.d*se+ee;if((!I||I(this._convertFromCellCoord(ee),this._convertFromCellCoord(se),this._convertFromCellCoord(ee+1),this._convertFromCellCoord(se+1)))&&y.call(this,t,o,u,p,Me,b,S,I))return}},Do.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},Do.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},Do.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,o=3+this.cells.length+1+1,u=0,p=0;p<this.cells.length;p++)u+=this.cells[p].length;var y=new Int32Array(o+u+this.keys.length+this.bboxes.length);y[0]=this.extent,y[1]=this.n,y[2]=this.padding;for(var b=o,S=0;S<t.length;S++){var I=t[S];y[3+S]=b,y.set(I,b),b+=I.length}return y[3+t.length]=b,y.set(this.keys,b),y[3+t.length+1]=b+=this.keys.length,y.set(this.bboxes,b),b+=this.bboxes.length,y.buffer};var Fl=J.ImageData,ml=J.ImageBitmap,ho={};function yn(t,o,u){u===void 0&&(u={}),Object.defineProperty(o,"_classRegistryKey",{value:t,writeable:!1}),ho[t]={klass:o,omit:u.omit||[],shallow:u.shallow||[]}}for(var qa in yn("Object",Object),tu.serialize=function(t,o){var u=t.toArrayBuffer();return o&&o.push(u),{buffer:u}},tu.deserialize=function(t){return new tu(t.buffer)},yn("Grid",tu),yn("Color",pi),yn("Error",Error),yn("ResolvedImage",wr),yn("StylePropertyFunction",pl),yn("StyleExpression",ac,{omit:["_evaluator"]}),yn("ZoomDependentExpression",Rl),yn("ZoomConstantExpression",uc),yn("CompoundExpression",so,{omit:["_evaluate"]}),zu)zu[qa]._classRegistryKey||yn("Expression_"+qa,zu[qa]);function nl(t){return t&&typeof ArrayBuffer!="undefined"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function pc(t){return ml&&t instanceof ml}function uu(t,o){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(nl(t)||pc(t))return o&&o.push(t),t;if(ArrayBuffer.isView(t)){var u=t;return o&&o.push(u.buffer),u}if(t instanceof Fl)return o&&o.push(t.data.buffer),t;if(Array.isArray(t)){for(var p=[],y=0,b=t;y<b.length;y+=1)p.push(uu(b[y],o));return p}if(typeof t=="object"){var S=t.constructor,I=S._classRegistryKey;if(!I)throw new Error("can't serialize object of unregistered class");var D=S.serialize?S.serialize(t,o):{};if(!S.serialize){for(var z in t)if(t.hasOwnProperty(z)&&!(ho[I].omit.indexOf(z)>=0)){var V=t[z];D[z]=ho[I].shallow.indexOf(z)>=0?V:uu(V,o)}t instanceof Error&&(D.message=t.message)}if(D.$name)throw new Error("$name property is reserved for worker serialization logic.");return I!=="Object"&&(D.$name=I),D}throw new Error("can't serialize object of type "+typeof t)}function na(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||nl(t)||pc(t)||ArrayBuffer.isView(t)||t instanceof Fl)return t;if(Array.isArray(t))return t.map(na);if(typeof t=="object"){var o=t.$name||"Object",u=ho[o].klass;if(!u)throw new Error("can't deserialize unregistered class "+o);if(u.deserialize)return u.deserialize(t);for(var p=Object.create(u.prototype),y=0,b=Object.keys(t);y<b.length;y+=1){var S=b[y];if(S!=="$name"){var I=t[S];p[S]=ho[o].shallow.indexOf(S)>=0?I:na(I)}}return p}throw new Error("can't deserialize object of type "+typeof t)}var hf=function(){this.first=!0};hf.prototype.update=function(t,o){var u=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=u,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=u,!0):(this.lastFloorZoom>u?(this.lastIntegerZoom=u+1,this.lastIntegerZoomTime=o):this.lastFloorZoom<u&&(this.lastIntegerZoom=u,this.lastIntegerZoomTime=o),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=u,!0))};var Kr={"Latin-1 Supplement":function(t){return t>=128&&t<=255},Arabic:function(t){return t>=1536&&t<=1791},"Arabic Supplement":function(t){return t>=1872&&t<=1919},"Arabic Extended-A":function(t){return t>=2208&&t<=2303},"Hangul Jamo":function(t){return t>=4352&&t<=4607},"Unified Canadian Aboriginal Syllabics":function(t){return t>=5120&&t<=5759},Khmer:function(t){return t>=6016&&t<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(t){return t>=6320&&t<=6399},"General Punctuation":function(t){return t>=8192&&t<=8303},"Letterlike Symbols":function(t){return t>=8448&&t<=8527},"Number Forms":function(t){return t>=8528&&t<=8591},"Miscellaneous Technical":function(t){return t>=8960&&t<=9215},"Control Pictures":function(t){return t>=9216&&t<=9279},"Optical Character Recognition":function(t){return t>=9280&&t<=9311},"Enclosed Alphanumerics":function(t){return t>=9312&&t<=9471},"Geometric Shapes":function(t){return t>=9632&&t<=9727},"Miscellaneous Symbols":function(t){return t>=9728&&t<=9983},"Miscellaneous Symbols and Arrows":function(t){return t>=11008&&t<=11263},"CJK Radicals Supplement":function(t){return t>=11904&&t<=12031},"Kangxi Radicals":function(t){return t>=12032&&t<=12255},"Ideographic Description Characters":function(t){return t>=12272&&t<=12287},"CJK Symbols and Punctuation":function(t){return t>=12288&&t<=12351},Hiragana:function(t){return t>=12352&&t<=12447},Katakana:function(t){return t>=12448&&t<=12543},Bopomofo:function(t){return t>=12544&&t<=12591},"Hangul Compatibility Jamo":function(t){return t>=12592&&t<=12687},Kanbun:function(t){return t>=12688&&t<=12703},"Bopomofo Extended":function(t){return t>=12704&&t<=12735},"CJK Strokes":function(t){return t>=12736&&t<=12783},"Katakana Phonetic Extensions":function(t){return t>=12784&&t<=12799},"Enclosed CJK Letters and Months":function(t){return t>=12800&&t<=13055},"CJK Compatibility":function(t){return t>=13056&&t<=13311},"CJK Unified Ideographs Extension A":function(t){return t>=13312&&t<=19903},"Yijing Hexagram Symbols":function(t){return t>=19904&&t<=19967},"CJK Unified Ideographs":function(t){return t>=19968&&t<=40959},"Yi Syllables":function(t){return t>=40960&&t<=42127},"Yi Radicals":function(t){return t>=42128&&t<=42191},"Hangul Jamo Extended-A":function(t){return t>=43360&&t<=43391},"Hangul Syllables":function(t){return t>=44032&&t<=55215},"Hangul Jamo Extended-B":function(t){return t>=55216&&t<=55295},"Private Use Area":function(t){return t>=57344&&t<=63743},"CJK Compatibility Ideographs":function(t){return t>=63744&&t<=64255},"Arabic Presentation Forms-A":function(t){return t>=64336&&t<=65023},"Vertical Forms":function(t){return t>=65040&&t<=65055},"CJK Compatibility Forms":function(t){return t>=65072&&t<=65103},"Small Form Variants":function(t){return t>=65104&&t<=65135},"Arabic Presentation Forms-B":function(t){return t>=65136&&t<=65279},"Halfwidth and Fullwidth Forms":function(t){return t>=65280&&t<=65519}};function zc(t){for(var o=0,u=t;o<u.length;o+=1)if(pf(u[o].charCodeAt(0)))return!0;return!1}function pf(t){return!(t!==746&&t!==747&&(t<4352||!(Kr["Bopomofo Extended"](t)||Kr.Bopomofo(t)||Kr["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||Kr["CJK Compatibility Ideographs"](t)||Kr["CJK Compatibility"](t)||Kr["CJK Radicals Supplement"](t)||Kr["CJK Strokes"](t)||!(!Kr["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||Kr["CJK Unified Ideographs Extension A"](t)||Kr["CJK Unified Ideographs"](t)||Kr["Enclosed CJK Letters and Months"](t)||Kr["Hangul Compatibility Jamo"](t)||Kr["Hangul Jamo Extended-A"](t)||Kr["Hangul Jamo Extended-B"](t)||Kr["Hangul Jamo"](t)||Kr["Hangul Syllables"](t)||Kr.Hiragana(t)||Kr["Ideographic Description Characters"](t)||Kr.Kanbun(t)||Kr["Kangxi Radicals"](t)||Kr["Katakana Phonetic Extensions"](t)||Kr.Katakana(t)&&t!==12540||!(!Kr["Halfwidth and Fullwidth Forms"](t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!Kr["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||Kr["Unified Canadian Aboriginal Syllabics"](t)||Kr["Unified Canadian Aboriginal Syllabics Extended"](t)||Kr["Vertical Forms"](t)||Kr["Yijing Hexagram Symbols"](t)||Kr["Yi Syllables"](t)||Kr["Yi Radicals"](t))))}function gl(t){return!(pf(t)||function(o){return!!(Kr["Latin-1 Supplement"](o)&&(o===167||o===169||o===174||o===177||o===188||o===189||o===190||o===215||o===247)||Kr["General Punctuation"](o)&&(o===8214||o===8224||o===8225||o===8240||o===8241||o===8251||o===8252||o===8258||o===8263||o===8264||o===8265||o===8273)||Kr["Letterlike Symbols"](o)||Kr["Number Forms"](o)||Kr["Miscellaneous Technical"](o)&&(o>=8960&&o<=8967||o>=8972&&o<=8991||o>=8996&&o<=9e3||o===9003||o>=9085&&o<=9114||o>=9150&&o<=9165||o===9167||o>=9169&&o<=9179||o>=9186&&o<=9215)||Kr["Control Pictures"](o)&&o!==9251||Kr["Optical Character Recognition"](o)||Kr["Enclosed Alphanumerics"](o)||Kr["Geometric Shapes"](o)||Kr["Miscellaneous Symbols"](o)&&!(o>=9754&&o<=9759)||Kr["Miscellaneous Symbols and Arrows"](o)&&(o>=11026&&o<=11055||o>=11088&&o<=11097||o>=11192&&o<=11243)||Kr["CJK Symbols and Punctuation"](o)||Kr.Katakana(o)||Kr["Private Use Area"](o)||Kr["CJK Compatibility Forms"](o)||Kr["Small Form Variants"](o)||Kr["Halfwidth and Fullwidth Forms"](o)||o===8734||o===8756||o===8757||o>=9984&&o<=10087||o>=10102&&o<=10131||o===65532||o===65533)}(t))}function Ea(t){return t>=1424&&t<=2303||Kr["Arabic Presentation Forms-A"](t)||Kr["Arabic Presentation Forms-B"](t)}function ms(t,o){return!(!o&&Ea(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||Kr.Khmer(t))}function Uc(t){for(var o=0,u=t;o<u.length;o+=1)if(Ea(u[o].charCodeAt(0)))return!0;return!1}var Cu=null,ks="unavailable",Vu=null,Zc=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(ks="error"),Cu&&Cu(t)};function Bl(){Gf.fire(new Pe("pluginStateChange",{pluginStatus:ks,pluginURL:Vu}))}var Gf=new rt,Hf=function(){return ks},Ds=function(){if(ks!=="deferred"||!Vu)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");ks="loading",Bl(),Vu&&Ba({url:Vu},function(t){t?Zc(t):(ks="loaded",Bl())})},Fs={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return ks==="loaded"||Fs.applyArabicShaping!=null},isLoading:function(){return ks==="loading"},setState:function(t){ks=t.pluginStatus,Vu=t.pluginURL},isParsed:function(){return Fs.applyArabicShaping!=null&&Fs.processBidirectionalText!=null&&Fs.processStyledBidirectionalText!=null},getPluginURL:function(){return Vu}},Fi=function(t,o){this.zoom=t,o?(this.now=o.now,this.fadeDuration=o.fadeDuration,this.zoomHistory=o.zoomHistory,this.transition=o.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new hf,this.transition={})};Fi.prototype.isSupportedScript=function(t){return function(o,u){for(var p=0,y=o;p<y.length;p+=1)if(!ms(y[p].charCodeAt(0),u))return!1;return!0}(t,Fs.isLoaded())},Fi.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},Fi.prototype.getCrossfadeParameters=function(){var t=this.zoom,o=t-Math.floor(t),u=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:o+(1-o)*u}:{fromScale:.5,toScale:1,t:1-(1-u)*o}};var Au=function(t,o){this.property=t,this.value=o,this.expression=function(u,p){if(nc(u))return new pl(u,p);if(oc(u)){var y=Ll(u,p);if(y.result==="error")throw new Error(y.value.map(function(S){return S.key+": "+S.message}).join(", "));return y.value}var b=u;return typeof u=="string"&&p.type==="color"&&(b=pi.parse(u)),{kind:"constant",evaluate:function(){return b}}}(o===void 0?t.specification.default:o,t.specification)};Au.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},Au.prototype.possiblyEvaluate=function(t,o,u){return this.property.possiblyEvaluate(this,t,o,u)};var wu=function(t){this.property=t,this.value=new Au(t,void 0)};wu.prototype.transitioned=function(t,o){return new Gu(this.property,this.value,o,xt({},t.transition,this.transition),t.now)},wu.prototype.untransitioned=function(){return new Gu(this.property,this.value,null,{},0)};var rs=function(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)};rs.prototype.getValue=function(t){return Je(this._values[t].value.value)},rs.prototype.setValue=function(t,o){this._values.hasOwnProperty(t)||(this._values[t]=new wu(this._values[t].property)),this._values[t].value=new Au(this._values[t].property,o===null?void 0:Je(o))},rs.prototype.getTransition=function(t){return Je(this._values[t].transition)},rs.prototype.setTransition=function(t,o){this._values.hasOwnProperty(t)||(this._values[t]=new wu(this._values[t].property)),this._values[t].transition=Je(o)||void 0},rs.prototype.serialize=function(){for(var t={},o=0,u=Object.keys(this._values);o<u.length;o+=1){var p=u[o],y=this.getValue(p);y!==void 0&&(t[p]=y);var b=this.getTransition(p);b!==void 0&&(t[p+"-transition"]=b)}return t},rs.prototype.transitioned=function(t,o){for(var u=new Tu(this._properties),p=0,y=Object.keys(this._values);p<y.length;p+=1){var b=y[p];u._values[b]=this._values[b].transitioned(t,o._values[b])}return u},rs.prototype.untransitioned=function(){for(var t=new Tu(this._properties),o=0,u=Object.keys(this._values);o<u.length;o+=1){var p=u[o];t._values[p]=this._values[p].untransitioned()}return t};var Gu=function(t,o,u,p,y){this.property=t,this.value=o,this.begin=y+p.delay||0,this.end=this.begin+p.duration||0,t.specification.transition&&(p.delay||p.duration)&&(this.prior=u)};Gu.prototype.possiblyEvaluate=function(t,o,u){var p=t.now||0,y=this.value.possiblyEvaluate(t,o,u),b=this.prior;if(b){if(p>this.end)return this.prior=null,y;if(this.value.isDataDriven())return this.prior=null,y;if(p<this.begin)return b.possiblyEvaluate(t,o,u);var S=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(b.possiblyEvaluate(t,o,u),y,function(I){if(I<=0)return 0;if(I>=1)return 1;var D=I*I,z=D*I;return 4*(I<.5?z:3*(I-D)+z-.75)}(S))}return y};var Tu=function(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)};Tu.prototype.possiblyEvaluate=function(t,o,u){for(var p=new Mu(this._properties),y=0,b=Object.keys(this._values);y<b.length;y+=1){var S=b[y];p._values[S]=this._values[S].possiblyEvaluate(t,o,u)}return p},Tu.prototype.hasTransition=function(){for(var t=0,o=Object.keys(this._values);t<o.length;t+=1)if(this._values[o[t]].prior)return!0;return!1};var Xs=function(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)};Xs.prototype.getValue=function(t){return Je(this._values[t].value)},Xs.prototype.setValue=function(t,o){this._values[t]=new Au(this._values[t].property,o===null?void 0:Je(o))},Xs.prototype.serialize=function(){for(var t={},o=0,u=Object.keys(this._values);o<u.length;o+=1){var p=u[o],y=this.getValue(p);y!==void 0&&(t[p]=y)}return t},Xs.prototype.possiblyEvaluate=function(t,o,u){for(var p=new Mu(this._properties),y=0,b=Object.keys(this._values);y<b.length;y+=1){var S=b[y];p._values[S]=this._values[S].possiblyEvaluate(t,o,u)}return p};var gs=function(t,o,u){this.property=t,this.value=o,this.parameters=u};gs.prototype.isConstant=function(){return this.value.kind==="constant"},gs.prototype.constantOr=function(t){return this.value.kind==="constant"?this.value.value:t},gs.prototype.evaluate=function(t,o,u,p){return this.property.evaluate(this.value,this.parameters,t,o,u,p)};var Mu=function(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)};Mu.prototype.get=function(t){return this._values[t]};var Rn=function(t){this.specification=t};Rn.prototype.possiblyEvaluate=function(t,o){return t.expression.evaluate(o)},Rn.prototype.interpolate=function(t,o,u){var p=ko[this.specification.type];return p?p(t,o,u):t};var Cn=function(t,o){this.specification=t,this.overrides=o};Cn.prototype.possiblyEvaluate=function(t,o,u,p){return new gs(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(o,null,{},u,p)}:t.expression,o)},Cn.prototype.interpolate=function(t,o,u){if(t.value.kind!=="constant"||o.value.kind!=="constant")return t;if(t.value.value===void 0||o.value.value===void 0)return new gs(this,{kind:"constant",value:void 0},t.parameters);var p=ko[this.specification.type];return p?new gs(this,{kind:"constant",value:p(t.value.value,o.value.value,u)},t.parameters):t},Cn.prototype.evaluate=function(t,o,u,p,y,b){return t.kind==="constant"?t.value:t.evaluate(o,u,p,y,b)};var df=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.possiblyEvaluate=function(u,p,y,b){if(u.value===void 0)return new gs(this,{kind:"constant",value:void 0},p);if(u.expression.kind==="constant"){var S=u.expression.evaluate(p,null,{},y,b),I=u.property.specification.type==="resolvedImage"&&typeof S!="string"?S.name:S,D=this._calculate(I,I,I,p);return new gs(this,{kind:"constant",value:D},p)}if(u.expression.kind==="camera"){var z=this._calculate(u.expression.evaluate({zoom:p.zoom-1}),u.expression.evaluate({zoom:p.zoom}),u.expression.evaluate({zoom:p.zoom+1}),p);return new gs(this,{kind:"constant",value:z},p)}return new gs(this,u.expression,p)},o.prototype.evaluate=function(u,p,y,b,S,I){if(u.kind==="source"){var D=u.evaluate(p,y,b,S,I);return this._calculate(D,D,D,p)}return u.kind==="composite"?this._calculate(u.evaluate({zoom:Math.floor(p.zoom)-1},y,b),u.evaluate({zoom:Math.floor(p.zoom)},y,b),u.evaluate({zoom:Math.floor(p.zoom)+1},y,b),p):u.value},o.prototype._calculate=function(u,p,y,b){return b.zoom>b.zoomHistory.lastIntegerZoom?{from:u,to:p}:{from:y,to:p}},o.prototype.interpolate=function(u){return u},o}(Cn),ys=function(t){this.specification=t};ys.prototype.possiblyEvaluate=function(t,o,u,p){if(t.value!==void 0){if(t.expression.kind==="constant"){var y=t.expression.evaluate(o,null,{},u,p);return this._calculate(y,y,y,o)}return this._calculate(t.expression.evaluate(new Fi(Math.floor(o.zoom-1),o)),t.expression.evaluate(new Fi(Math.floor(o.zoom),o)),t.expression.evaluate(new Fi(Math.floor(o.zoom+1),o)),o)}},ys.prototype._calculate=function(t,o,u,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:t,to:o}:{from:u,to:o}},ys.prototype.interpolate=function(t){return t};var lu=function(t){this.specification=t};lu.prototype.possiblyEvaluate=function(t,o,u,p){return!!t.expression.evaluate(o,null,{},u,p)},lu.prototype.interpolate=function(){return!1};var ns=function(t){for(var o in this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],t){var u=t[o];u.specification.overridable&&this.overridableProperties.push(o);var p=this.defaultPropertyValues[o]=new Au(u,void 0),y=this.defaultTransitionablePropertyValues[o]=new wu(u);this.defaultTransitioningPropertyValues[o]=y.untransitioned(),this.defaultPossiblyEvaluatedValues[o]=p.possiblyEvaluate({})}};yn("DataDrivenProperty",Cn),yn("DataConstantProperty",Rn),yn("CrossFadedDataDrivenProperty",df),yn("CrossFadedProperty",ys),yn("ColorRampProperty",lu);var Go=function(t){function o(u,p){if(t.call(this),this.id=u.id,this.type=u.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},u.type!=="custom"&&(this.metadata=(u=u).metadata,this.minzoom=u.minzoom,this.maxzoom=u.maxzoom,u.type!=="background"&&(this.source=u.source,this.sourceLayer=u["source-layer"],this.filter=u.filter),p.layout&&(this._unevaluatedLayout=new Xs(p.layout)),p.paint)){for(var y in this._transitionablePaint=new rs(p.paint),u.paint)this.setPaintProperty(y,u.paint[y],{validate:!1});for(var b in u.layout)this.setLayoutProperty(b,u.layout[b],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Mu(p.paint)}}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},o.prototype.getLayoutProperty=function(u){return u==="visibility"?this.visibility:this._unevaluatedLayout.getValue(u)},o.prototype.setLayoutProperty=function(u,p,y){y===void 0&&(y={}),p!=null&&this._validate(ju,"layers."+this.id+".layout."+u,u,p,y)||(u!=="visibility"?this._unevaluatedLayout.setValue(u,p):this.visibility=p)},o.prototype.getPaintProperty=function(u){return Y(u,"-transition")?this._transitionablePaint.getTransition(u.slice(0,-"-transition".length)):this._transitionablePaint.getValue(u)},o.prototype.setPaintProperty=function(u,p,y){if(y===void 0&&(y={}),p!=null&&this._validate(lo,"layers."+this.id+".paint."+u,u,p,y))return!1;if(Y(u,"-transition"))return this._transitionablePaint.setTransition(u.slice(0,-"-transition".length),p||void 0),!1;var b=this._transitionablePaint._values[u],S=b.property.specification["property-type"]==="cross-faded-data-driven",I=b.value.isDataDriven(),D=b.value;this._transitionablePaint.setValue(u,p),this._handleSpecialPaintPropertyUpdate(u);var z=this._transitionablePaint._values[u].value;return z.isDataDriven()||I||S||this._handleOverridablePaintPropertyUpdate(u,D,z)},o.prototype._handleSpecialPaintPropertyUpdate=function(u){},o.prototype._handleOverridablePaintPropertyUpdate=function(u,p,y){return!1},o.prototype.isHidden=function(u){return!!(this.minzoom&&u<this.minzoom)||!!(this.maxzoom&&u>=this.maxzoom)||this.visibility==="none"},o.prototype.updateTransitions=function(u){this._transitioningPaint=this._transitionablePaint.transitioned(u,this._transitioningPaint)},o.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},o.prototype.recalculate=function(u,p){u.getCrossfadeParameters&&(this._crossfadeParameters=u.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(u,void 0,p)),this.paint=this._transitioningPaint.possiblyEvaluate(u,void 0,p)},o.prototype.serialize=function(){var u={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(u.layout=u.layout||{},u.layout.visibility=this.visibility),ft(u,function(p,y){return!(p===void 0||y==="layout"&&!Object.keys(p).length||y==="paint"&&!Object.keys(p).length)})},o.prototype._validate=function(u,p,y,b,S){return S===void 0&&(S={}),(!S||S.validate!==!1)&&Su(this,u.call(Nc,{key:p,layerType:this.type,objectKey:y,value:b,styleSpec:pe,style:{glyphs:!0,sprite:!0}}))},o.prototype.is3D=function(){return!1},o.prototype.isTileClipped=function(){return!1},o.prototype.hasOffscreenPass=function(){return!1},o.prototype.resize=function(){},o.prototype.isStateDependent=function(){for(var u in this.paint._values){var p=this.paint.get(u);if(p instanceof gs&&Hs(p.property.specification)&&(p.value.kind==="source"||p.value.kind==="composite")&&p.value.isStateDependent)return!0}return!1},o}(rt),Wf={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},vf=function(t,o){this._structArray=t,this._pos1=o*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},ha=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function Na(t,o){o===void 0&&(o=1);var u=0,p=0;return{members:t.map(function(y){var b=Wf[y.type].BYTES_PER_ELEMENT,S=u=dc(u,Math.max(o,b)),I=y.components||1;return p=Math.max(p,b),u+=b*I,{name:y.name,type:y.type,components:I,offset:S}}),size:dc(u,Math.max(p,o)),alignment:o}}function dc(t,o){return Math.ceil(t/o)*o}ha.serialize=function(t,o){return t._trim(),o&&(t.isTransferred=!0,o.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}},ha.deserialize=function(t){var o=Object.create(this.prototype);return o.arrayBuffer=t.arrayBuffer,o.length=t.length,o.capacity=t.arrayBuffer.byteLength/o.bytesPerElement,o._refreshViews(),o},ha.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},ha.prototype.clear=function(){this.length=0},ha.prototype.resize=function(t){this.reserve(t),this.length=t},ha.prototype.reserve=function(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var o=this.uint8;this._refreshViews(),o&&this.uint8.set(o)}},ha.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var yl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p){var y=this.length;return this.resize(y+1),this.emplace(y,u,p)},o.prototype.emplace=function(u,p,y){var b=2*u;return this.int16[b+0]=p,this.int16[b+1]=y,u},o}(ha);yl.prototype.bytesPerElement=4,yn("StructArrayLayout2i4",yl);var Pu=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b){var S=this.length;return this.resize(S+1),this.emplace(S,u,p,y,b)},o.prototype.emplace=function(u,p,y,b,S){var I=4*u;return this.int16[I+0]=p,this.int16[I+1]=y,this.int16[I+2]=b,this.int16[I+3]=S,u},o}(ha);Pu.prototype.bytesPerElement=8,yn("StructArrayLayout4i8",Pu);var cu=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b,S,I){var D=this.length;return this.resize(D+1),this.emplace(D,u,p,y,b,S,I)},o.prototype.emplace=function(u,p,y,b,S,I,D){var z=6*u;return this.int16[z+0]=p,this.int16[z+1]=y,this.int16[z+2]=b,this.int16[z+3]=S,this.int16[z+4]=I,this.int16[z+5]=D,u},o}(ha);cu.prototype.bytesPerElement=12,yn("StructArrayLayout2i4i12",cu);var Fo=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b,S,I){var D=this.length;return this.resize(D+1),this.emplace(D,u,p,y,b,S,I)},o.prototype.emplace=function(u,p,y,b,S,I,D){var z=4*u,V=8*u;return this.int16[z+0]=p,this.int16[z+1]=y,this.uint8[V+4]=b,this.uint8[V+5]=S,this.uint8[V+6]=I,this.uint8[V+7]=D,u},o}(ha);Fo.prototype.bytesPerElement=8,yn("StructArrayLayout2i4ub8",Fo);var il=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p){var y=this.length;return this.resize(y+1),this.emplace(y,u,p)},o.prototype.emplace=function(u,p,y){var b=2*u;return this.float32[b+0]=p,this.float32[b+1]=y,u},o}(ha);il.prototype.bytesPerElement=8,yn("StructArrayLayout2f8",il);var fu=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b,S,I,D,z,V,W){var ee=this.length;return this.resize(ee+1),this.emplace(ee,u,p,y,b,S,I,D,z,V,W)},o.prototype.emplace=function(u,p,y,b,S,I,D,z,V,W,ee){var se=10*u;return this.uint16[se+0]=p,this.uint16[se+1]=y,this.uint16[se+2]=b,this.uint16[se+3]=S,this.uint16[se+4]=I,this.uint16[se+5]=D,this.uint16[se+6]=z,this.uint16[se+7]=V,this.uint16[se+8]=W,this.uint16[se+9]=ee,u},o}(ha);fu.prototype.bytesPerElement=20,yn("StructArrayLayout10ui20",fu);var mf=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b,S,I,D,z,V,W,ee,se){var Me=this.length;return this.resize(Me+1),this.emplace(Me,u,p,y,b,S,I,D,z,V,W,ee,se)},o.prototype.emplace=function(u,p,y,b,S,I,D,z,V,W,ee,se,Me){var Oe=12*u;return this.int16[Oe+0]=p,this.int16[Oe+1]=y,this.int16[Oe+2]=b,this.int16[Oe+3]=S,this.uint16[Oe+4]=I,this.uint16[Oe+5]=D,this.uint16[Oe+6]=z,this.uint16[Oe+7]=V,this.int16[Oe+8]=W,this.int16[Oe+9]=ee,this.int16[Oe+10]=se,this.int16[Oe+11]=Me,u},o}(ha);mf.prototype.bytesPerElement=24,yn("StructArrayLayout4i4ui4i24",mf);var Nl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y){var b=this.length;return this.resize(b+1),this.emplace(b,u,p,y)},o.prototype.emplace=function(u,p,y,b){var S=3*u;return this.float32[S+0]=p,this.float32[S+1]=y,this.float32[S+2]=b,u},o}(ha);Nl.prototype.bytesPerElement=12,yn("StructArrayLayout3f12",Nl);var jc=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u){var p=this.length;return this.resize(p+1),this.emplace(p,u)},o.prototype.emplace=function(u,p){return this.uint32[1*u+0]=p,u},o}(ha);jc.prototype.bytesPerElement=4,yn("StructArrayLayout1ul4",jc);var gf=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b,S,I,D,z,V){var W=this.length;return this.resize(W+1),this.emplace(W,u,p,y,b,S,I,D,z,V)},o.prototype.emplace=function(u,p,y,b,S,I,D,z,V,W){var ee=10*u,se=5*u;return this.int16[ee+0]=p,this.int16[ee+1]=y,this.int16[ee+2]=b,this.int16[ee+3]=S,this.int16[ee+4]=I,this.int16[ee+5]=D,this.uint32[se+3]=z,this.uint16[ee+8]=V,this.uint16[ee+9]=W,u},o}(ha);gf.prototype.bytesPerElement=20,yn("StructArrayLayout6i1ul2ui20",gf);var Iu=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b,S,I){var D=this.length;return this.resize(D+1),this.emplace(D,u,p,y,b,S,I)},o.prototype.emplace=function(u,p,y,b,S,I,D){var z=6*u;return this.int16[z+0]=p,this.int16[z+1]=y,this.int16[z+2]=b,this.int16[z+3]=S,this.int16[z+4]=I,this.int16[z+5]=D,u},o}(ha);Iu.prototype.bytesPerElement=12,yn("StructArrayLayout2i2i2i12",Iu);var vc=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b,S){var I=this.length;return this.resize(I+1),this.emplace(I,u,p,y,b,S)},o.prototype.emplace=function(u,p,y,b,S,I){var D=4*u,z=8*u;return this.float32[D+0]=p,this.float32[D+1]=y,this.float32[D+2]=b,this.int16[z+6]=S,this.int16[z+7]=I,u},o}(ha);vc.prototype.bytesPerElement=16,yn("StructArrayLayout2f1f2i16",vc);var Vc=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b){var S=this.length;return this.resize(S+1),this.emplace(S,u,p,y,b)},o.prototype.emplace=function(u,p,y,b,S){var I=12*u,D=3*u;return this.uint8[I+0]=p,this.uint8[I+1]=y,this.float32[D+1]=b,this.float32[D+2]=S,u},o}(ha);Vc.prototype.bytesPerElement=12,yn("StructArrayLayout2ub2f12",Vc);var al=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y){var b=this.length;return this.resize(b+1),this.emplace(b,u,p,y)},o.prototype.emplace=function(u,p,y,b){var S=3*u;return this.uint16[S+0]=p,this.uint16[S+1]=y,this.uint16[S+2]=b,u},o}(ha);al.prototype.bytesPerElement=6,yn("StructArrayLayout3ui6",al);var Ji=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b,S,I,D,z,V,W,ee,se,Me,Oe,Ye,ze,st){var Tt=this.length;return this.resize(Tt+1),this.emplace(Tt,u,p,y,b,S,I,D,z,V,W,ee,se,Me,Oe,Ye,ze,st)},o.prototype.emplace=function(u,p,y,b,S,I,D,z,V,W,ee,se,Me,Oe,Ye,ze,st,Tt){var Vt=24*u,Xt=12*u,lr=48*u;return this.int16[Vt+0]=p,this.int16[Vt+1]=y,this.uint16[Vt+2]=b,this.uint16[Vt+3]=S,this.uint32[Xt+2]=I,this.uint32[Xt+3]=D,this.uint32[Xt+4]=z,this.uint16[Vt+10]=V,this.uint16[Vt+11]=W,this.uint16[Vt+12]=ee,this.float32[Xt+7]=se,this.float32[Xt+8]=Me,this.uint8[lr+36]=Oe,this.uint8[lr+37]=Ye,this.uint8[lr+38]=ze,this.uint32[Xt+10]=st,this.int16[Vt+22]=Tt,u},o}(ha);Ji.prototype.bytesPerElement=48,yn("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Ji);var ol=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b,S,I,D,z,V,W,ee,se,Me,Oe,Ye,ze,st,Tt,Vt,Xt,lr,Lr,$r,Zn,gn,Yn,hn,ki){var ai=this.length;return this.resize(ai+1),this.emplace(ai,u,p,y,b,S,I,D,z,V,W,ee,se,Me,Oe,Ye,ze,st,Tt,Vt,Xt,lr,Lr,$r,Zn,gn,Yn,hn,ki)},o.prototype.emplace=function(u,p,y,b,S,I,D,z,V,W,ee,se,Me,Oe,Ye,ze,st,Tt,Vt,Xt,lr,Lr,$r,Zn,gn,Yn,hn,ki,ai){var Pn=34*u,Ai=17*u;return this.int16[Pn+0]=p,this.int16[Pn+1]=y,this.int16[Pn+2]=b,this.int16[Pn+3]=S,this.int16[Pn+4]=I,this.int16[Pn+5]=D,this.int16[Pn+6]=z,this.int16[Pn+7]=V,this.uint16[Pn+8]=W,this.uint16[Pn+9]=ee,this.uint16[Pn+10]=se,this.uint16[Pn+11]=Me,this.uint16[Pn+12]=Oe,this.uint16[Pn+13]=Ye,this.uint16[Pn+14]=ze,this.uint16[Pn+15]=st,this.uint16[Pn+16]=Tt,this.uint16[Pn+17]=Vt,this.uint16[Pn+18]=Xt,this.uint16[Pn+19]=lr,this.uint16[Pn+20]=Lr,this.uint16[Pn+21]=$r,this.uint16[Pn+22]=Zn,this.uint32[Ai+12]=gn,this.float32[Ai+13]=Yn,this.float32[Ai+14]=hn,this.float32[Ai+15]=ki,this.float32[Ai+16]=ai,u},o}(ha);ol.prototype.bytesPerElement=68,yn("StructArrayLayout8i15ui1ul4f68",ol);var hu=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u){var p=this.length;return this.resize(p+1),this.emplace(p,u)},o.prototype.emplace=function(u,p){return this.float32[1*u+0]=p,u},o}(ha);hu.prototype.bytesPerElement=4,yn("StructArrayLayout1f4",hu);var Ts=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y){var b=this.length;return this.resize(b+1),this.emplace(b,u,p,y)},o.prototype.emplace=function(u,p,y,b){var S=3*u;return this.int16[S+0]=p,this.int16[S+1]=y,this.int16[S+2]=b,u},o}(ha);Ts.prototype.bytesPerElement=6,yn("StructArrayLayout3i6",Ts);var zl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y){var b=this.length;return this.resize(b+1),this.emplace(b,u,p,y)},o.prototype.emplace=function(u,p,y,b){var S=4*u;return this.uint32[2*u+0]=p,this.uint16[S+2]=y,this.uint16[S+3]=b,u},o}(ha);zl.prototype.bytesPerElement=8,yn("StructArrayLayout1ul2ui8",zl);var _l=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p){var y=this.length;return this.resize(y+1),this.emplace(y,u,p)},o.prototype.emplace=function(u,p,y){var b=2*u;return this.uint16[b+0]=p,this.uint16[b+1]=y,u},o}(ha);_l.prototype.bytesPerElement=4,yn("StructArrayLayout2ui4",_l);var yf=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u){var p=this.length;return this.resize(p+1),this.emplace(p,u)},o.prototype.emplace=function(u,p){return this.uint16[1*u+0]=p,u},o}(ha);yf.prototype.bytesPerElement=2,yn("StructArrayLayout1ui2",yf);var Pa=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b){var S=this.length;return this.resize(S+1),this.emplace(S,u,p,y,b)},o.prototype.emplace=function(u,p,y,b,S){var I=4*u;return this.float32[I+0]=p,this.float32[I+1]=y,this.float32[I+2]=b,this.float32[I+3]=S,u},o}(ha);Pa.prototype.bytesPerElement=16,yn("StructArrayLayout4f16",Pa);var l=function(t){function o(){t.apply(this,arguments)}t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o;var u={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return u.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},u.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},u.x1.get=function(){return this._structArray.int16[this._pos2+2]},u.y1.get=function(){return this._structArray.int16[this._pos2+3]},u.x2.get=function(){return this._structArray.int16[this._pos2+4]},u.y2.get=function(){return this._structArray.int16[this._pos2+5]},u.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},u.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},u.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},u.anchorPoint.get=function(){return new fe(this.anchorPointX,this.anchorPointY)},Object.defineProperties(o.prototype,u),o}(vf);l.prototype.size=20;var h=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.get=function(u){return new l(this,u)},o}(gf);yn("CollisionBoxArray",h);var c=function(t){function o(){t.apply(this,arguments)}t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o;var u={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return u.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},u.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},u.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},u.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},u.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},u.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},u.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},u.segment.get=function(){return this._structArray.uint16[this._pos2+10]},u.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},u.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},u.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},u.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},u.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},u.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},u.placedOrientation.set=function(p){this._structArray.uint8[this._pos1+37]=p},u.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},u.hidden.set=function(p){this._structArray.uint8[this._pos1+38]=p},u.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},u.crossTileID.set=function(p){this._structArray.uint32[this._pos4+10]=p},u.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(o.prototype,u),o}(vf);c.prototype.size=48;var d=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.get=function(u){return new c(this,u)},o}(Ji);yn("PlacedSymbolArray",d);var E=function(t){function o(){t.apply(this,arguments)}t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o;var u={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return u.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},u.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},u.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},u.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},u.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},u.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},u.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},u.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},u.key.get=function(){return this._structArray.uint16[this._pos2+8]},u.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},u.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},u.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},u.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},u.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},u.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},u.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},u.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},u.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},u.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},u.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},u.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},u.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},u.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},u.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},u.crossTileID.set=function(p){this._structArray.uint32[this._pos4+12]=p},u.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},u.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},u.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},u.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(o.prototype,u),o}(vf);E.prototype.size=68;var w=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.get=function(u){return new E(this,u)},o}(ol);yn("SymbolInstanceArray",w);var P=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.getoffsetX=function(u){return this.float32[1*u+0]},o}(hu);yn("GlyphOffsetArray",P);var L=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.getx=function(u){return this.int16[3*u+0]},o.prototype.gety=function(u){return this.int16[3*u+1]},o.prototype.gettileUnitDistanceFromAnchor=function(u){return this.int16[3*u+2]},o}(Ts);yn("SymbolLineVertexArray",L);var N=function(t){function o(){t.apply(this,arguments)}t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o;var u={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return u.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},u.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},u.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(o.prototype,u),o}(vf);N.prototype.size=8;var q=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.get=function(u){return new N(this,u)},o}(zl);yn("FeatureIndexArray",q);var ce=Na([{name:"a_pos",components:2,type:"Int16"}],4).members,he=function(t){t===void 0&&(t=[]),this.segments=t};function de(t,o){return 256*(t=gt(Math.floor(t),0,255))+gt(Math.floor(o),0,255)}he.prototype.prepareSegment=function(t,o,u,p){var y=this.segments[this.segments.length-1];return t>he.MAX_VERTEX_ARRAY_LENGTH&&Qe("Max vertices per segment is "+he.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+t),(!y||y.vertexLength+t>he.MAX_VERTEX_ARRAY_LENGTH||y.sortKey!==p)&&(y={vertexOffset:o.length,primitiveOffset:u.length,vertexLength:0,primitiveLength:0},p!==void 0&&(y.sortKey=p),this.segments.push(y)),y},he.prototype.get=function(){return this.segments},he.prototype.destroy=function(){for(var t=0,o=this.segments;t<o.length;t+=1){var u=o[t];for(var p in u.vaos)u.vaos[p].destroy()}},he.simpleSegment=function(t,o,u,p){return new he([{vertexOffset:t,primitiveOffset:o,vertexLength:u,primitiveLength:p,vaos:{},sortKey:0}])},he.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,yn("SegmentVector",he);var Re=Na([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Ie=ve(function(t){t.exports=function(o,u){var p,y,b,S,I,D,z,V;for(y=o.length-(p=3&o.length),b=u,I=3432918353,D=461845907,V=0;V<y;)z=255&o.charCodeAt(V)|(255&o.charCodeAt(++V))<<8|(255&o.charCodeAt(++V))<<16|(255&o.charCodeAt(++V))<<24,++V,b=27492+(65535&(S=5*(65535&(b=(b^=z=(65535&(z=(z=(65535&z)*I+(((z>>>16)*I&65535)<<16)&4294967295)<<15|z>>>17))*D+(((z>>>16)*D&65535)<<16)&4294967295)<<13|b>>>19))+((5*(b>>>16)&65535)<<16)&4294967295))+((58964+(S>>>16)&65535)<<16);switch(z=0,p){case 3:z^=(255&o.charCodeAt(V+2))<<16;case 2:z^=(255&o.charCodeAt(V+1))<<8;case 1:b^=z=(65535&(z=(z=(65535&(z^=255&o.charCodeAt(V)))*I+(((z>>>16)*I&65535)<<16)&4294967295)<<15|z>>>17))*D+(((z>>>16)*D&65535)<<16)&4294967295}return b^=o.length,b=2246822507*(65535&(b^=b>>>16))+((2246822507*(b>>>16)&65535)<<16)&4294967295,b=3266489909*(65535&(b^=b>>>13))+((3266489909*(b>>>16)&65535)<<16)&4294967295,(b^=b>>>16)>>>0}}),We=ve(function(t){t.exports=function(o,u){for(var p,y=o.length,b=u^y,S=0;y>=4;)p=1540483477*(65535&(p=255&o.charCodeAt(S)|(255&o.charCodeAt(++S))<<8|(255&o.charCodeAt(++S))<<16|(255&o.charCodeAt(++S))<<24))+((1540483477*(p>>>16)&65535)<<16),b=1540483477*(65535&b)+((1540483477*(b>>>16)&65535)<<16)^(p=1540483477*(65535&(p^=p>>>24))+((1540483477*(p>>>16)&65535)<<16)),y-=4,++S;switch(y){case 3:b^=(255&o.charCodeAt(S+2))<<16;case 2:b^=(255&o.charCodeAt(S+1))<<8;case 1:b=1540483477*(65535&(b^=255&o.charCodeAt(S)))+((1540483477*(b>>>16)&65535)<<16)}return b=1540483477*(65535&(b^=b>>>13))+((1540483477*(b>>>16)&65535)<<16),(b^=b>>>15)>>>0}}),we=Ie,Ve=We;we.murmur3=Ie,we.murmur2=Ve;var tt=function(){this.ids=[],this.positions=[],this.indexed=!1};tt.prototype.add=function(t,o,u,p){this.ids.push(Wt(t)),this.positions.push(o,u,p)},tt.prototype.getPositions=function(t){for(var o=Wt(t),u=0,p=this.ids.length-1;u<p;){var y=u+p>>1;this.ids[y]>=o?p=y:u=y+1}for(var b=[];this.ids[u]===o;)b.push({index:this.positions[3*u],start:this.positions[3*u+1],end:this.positions[3*u+2]}),u++;return b},tt.serialize=function(t,o){var u=new Float64Array(t.ids),p=new Uint32Array(t.positions);return function y(b,S,I,D){for(;I<D;){for(var z=b[I+D>>1],V=I-1,W=D+1;;){do V++;while(b[V]<z);do W--;while(b[W]>z);if(V>=W)break;jt(b,V,W),jt(S,3*V,3*W),jt(S,3*V+1,3*W+1),jt(S,3*V+2,3*W+2)}W-I<D-W?(y(b,S,I,W),I=W+1):(y(b,S,W+1,D),D=W)}}(u,p,0,u.length-1),o&&o.push(u.buffer,p.buffer),{ids:u,positions:p}},tt.deserialize=function(t){var o=new tt;return o.ids=t.ids,o.positions=t.positions,o.indexed=!0,o};var yt=Math.pow(2,53)-1;function Wt(t){var o=+t;return!isNaN(o)&&o<=yt?o:we(String(t))}function jt(t,o,u){var p=t[o];t[o]=t[u],t[u]=p}yn("FeaturePositionMap",tt);var Jt=function(t,o){this.gl=t.gl,this.location=o},dr=function(t){function o(u,p){t.call(this,u,p),this.current=0}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))},o}(Jt),Fr=function(t){function o(u,p){t.call(this,u,p),this.current=0}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))},o}(Jt),kr=function(t){function o(u,p){t.call(this,u,p),this.current=[0,0]}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1]))},o}(Jt),ln=function(t){function o(u,p){t.call(this,u,p),this.current=[0,0,0]}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2]))},o}(Jt),Nn=function(t){function o(u,p){t.call(this,u,p),this.current=[0,0,0,0]}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3]))},o}(Jt),zn=function(t){function o(u,p){t.call(this,u,p),this.current=pi.transparent}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a))},o}(Jt),Mn=new Float32Array(16),Bi=function(t){function o(u,p){t.call(this,u,p),this.current=Mn}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(var p=1;p<16;p++)if(u[p]!==this.current[p]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}},o}(Jt);function Qr(t){return[de(255*t.r,255*t.g),de(255*t.b,255*t.a)]}var li=function(t,o,u){this.value=t,this.uniformNames=o.map(function(p){return"u_"+p}),this.type=u};li.prototype.setUniform=function(t,o,u){t.set(u.constantOr(this.value))},li.prototype.getBinding=function(t,o,u){return this.type==="color"?new zn(t,o):new Fr(t,o)};var fi=function(t,o){this.uniformNames=o.map(function(u){return"u_"+u}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};fi.prototype.setConstantPatternPositions=function(t,o){this.pixelRatioFrom=o.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=o.tlbr,this.patternTo=t.tlbr},fi.prototype.setUniform=function(t,o,u,p){var y=p==="u_pattern_to"?this.patternTo:p==="u_pattern_from"?this.patternFrom:p==="u_pixel_ratio_to"?this.pixelRatioTo:p==="u_pixel_ratio_from"?this.pixelRatioFrom:null;y&&t.set(y)},fi.prototype.getBinding=function(t,o,u){return u.substr(0,9)==="u_pattern"?new Nn(t,o):new Fr(t,o)};var ii=function(t,o,u,p){this.expression=t,this.type=u,this.maxValue=0,this.paintVertexAttributes=o.map(function(y){return{name:"a_"+y,type:"Float32",components:u==="color"?2:1,offset:0}}),this.paintVertexArray=new p};ii.prototype.populatePaintArray=function(t,o,u,p,y){var b=this.paintVertexArray.length,S=this.expression.evaluate(new Fi(0),o,{},p,[],y);this.paintVertexArray.resize(t),this._setPaintValue(b,t,S)},ii.prototype.updatePaintArray=function(t,o,u,p){var y=this.expression.evaluate({zoom:0},u,p);this._setPaintValue(t,o,y)},ii.prototype._setPaintValue=function(t,o,u){if(this.type==="color")for(var p=Qr(u),y=t;y<o;y++)this.paintVertexArray.emplace(y,p[0],p[1]);else{for(var b=t;b<o;b++)this.paintVertexArray.emplace(b,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}},ii.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},ii.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var Xn=function(t,o,u,p,y,b){this.expression=t,this.uniformNames=o.map(function(S){return"u_"+S+"_t"}),this.type=u,this.useIntegerZoom=p,this.zoom=y,this.maxValue=0,this.paintVertexAttributes=o.map(function(S){return{name:"a_"+S,type:"Float32",components:u==="color"?4:2,offset:0}}),this.paintVertexArray=new b};Xn.prototype.populatePaintArray=function(t,o,u,p,y){var b=this.expression.evaluate(new Fi(this.zoom),o,{},p,[],y),S=this.expression.evaluate(new Fi(this.zoom+1),o,{},p,[],y),I=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(I,t,b,S)},Xn.prototype.updatePaintArray=function(t,o,u,p){var y=this.expression.evaluate({zoom:this.zoom},u,p),b=this.expression.evaluate({zoom:this.zoom+1},u,p);this._setPaintValue(t,o,y,b)},Xn.prototype._setPaintValue=function(t,o,u,p){if(this.type==="color")for(var y=Qr(u),b=Qr(p),S=t;S<o;S++)this.paintVertexArray.emplace(S,y[0],y[1],b[0],b[1]);else{for(var I=t;I<o;I++)this.paintVertexArray.emplace(I,u,p);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(p))}},Xn.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Xn.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},Xn.prototype.setUniform=function(t,o){var u=this.useIntegerZoom?Math.floor(o.zoom):o.zoom,p=gt(this.expression.interpolationFactor(u,this.zoom,this.zoom+1),0,1);t.set(p)},Xn.prototype.getBinding=function(t,o,u){return new Fr(t,o)};var xi=function(t,o,u,p,y,b){this.expression=t,this.type=o,this.useIntegerZoom=u,this.zoom=p,this.layerId=b,this.zoomInPaintVertexArray=new y,this.zoomOutPaintVertexArray=new y};xi.prototype.populatePaintArray=function(t,o,u){var p=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(p,t,o.patterns&&o.patterns[this.layerId],u)},xi.prototype.updatePaintArray=function(t,o,u,p,y){this._setPaintValues(t,o,u.patterns&&u.patterns[this.layerId],y)},xi.prototype._setPaintValues=function(t,o,u,p){if(p&&u){var y=p[u.min],b=p[u.mid],S=p[u.max];if(y&&b&&S)for(var I=t;I<o;I++)this.zoomInPaintVertexArray.emplace(I,b.tl[0],b.tl[1],b.br[0],b.br[1],y.tl[0],y.tl[1],y.br[0],y.br[1],b.pixelRatio,y.pixelRatio),this.zoomOutPaintVertexArray.emplace(I,b.tl[0],b.tl[1],b.br[0],b.br[1],S.tl[0],S.tl[1],S.br[0],S.br[1],b.pixelRatio,S.pixelRatio)}},xi.prototype.upload=function(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,Re.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,Re.members,this.expression.isStateDependent))},xi.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var ri=function(t,o,u){this.binders={},this._buffers=[];var p=[];for(var y in t.paint._values)if(u(y)){var b=t.paint.get(y);if(b instanceof gs&&Hs(b.property.specification)){var S=po(y,t.type),I=b.value,D=b.property.specification.type,z=b.property.useIntegerZoom,V=b.property.specification["property-type"],W=V==="cross-faded"||V==="cross-faded-data-driven";if(I.kind==="constant")this.binders[y]=W?new fi(I.value,S):new li(I.value,S,D),p.push("/u_"+y);else if(I.kind==="source"||W){var ee=Ka(y,D,"source");this.binders[y]=W?new xi(I,D,z,o,ee,t.id):new ii(I,S,D,ee),p.push("/a_"+y)}else{var se=Ka(y,D,"composite");this.binders[y]=new Xn(I,S,D,z,o,se),p.push("/z_"+y)}}}this.cacheKey=p.sort().join("")};ri.prototype.getMaxValue=function(t){var o=this.binders[t];return o instanceof ii||o instanceof Xn?o.maxValue:0},ri.prototype.populatePaintArrays=function(t,o,u,p,y){for(var b in this.binders){var S=this.binders[b];(S instanceof ii||S instanceof Xn||S instanceof xi)&&S.populatePaintArray(t,o,u,p,y)}},ri.prototype.setConstantPatternPositions=function(t,o){for(var u in this.binders){var p=this.binders[u];p instanceof fi&&p.setConstantPatternPositions(t,o)}},ri.prototype.updatePaintArrays=function(t,o,u,p,y){var b=!1;for(var S in t)for(var I=0,D=o.getPositions(S);I<D.length;I+=1){var z=D[I],V=u.feature(z.index);for(var W in this.binders){var ee=this.binders[W];if((ee instanceof ii||ee instanceof Xn||ee instanceof xi)&&ee.expression.isStateDependent===!0){var se=p.paint.get(W);ee.expression=se.value,ee.updatePaintArray(z.start,z.end,V,t[S],y),b=!0}}}return b},ri.prototype.defines=function(){var t=[];for(var o in this.binders){var u=this.binders[o];(u instanceof li||u instanceof fi)&&t.push.apply(t,u.uniformNames.map(function(p){return"#define HAS_UNIFORM_"+p}))}return t},ri.prototype.getBinderAttributes=function(){var t=[];for(var o in this.binders){var u=this.binders[o];if(u instanceof ii||u instanceof Xn)for(var p=0;p<u.paintVertexAttributes.length;p++)t.push(u.paintVertexAttributes[p].name);else if(u instanceof xi)for(var y=0;y<Re.members.length;y++)t.push(Re.members[y].name)}return t},ri.prototype.getBinderUniforms=function(){var t=[];for(var o in this.binders){var u=this.binders[o];if(u instanceof li||u instanceof fi||u instanceof Xn)for(var p=0,y=u.uniformNames;p<y.length;p+=1)t.push(y[p])}return t},ri.prototype.getPaintVertexBuffers=function(){return this._buffers},ri.prototype.getUniforms=function(t,o){var u=[];for(var p in this.binders){var y=this.binders[p];if(y instanceof li||y instanceof fi||y instanceof Xn)for(var b=0,S=y.uniformNames;b<S.length;b+=1){var I=S[b];if(o[I]){var D=y.getBinding(t,o[I],I);u.push({name:I,property:p,binding:D})}}}return u},ri.prototype.setUniforms=function(t,o,u,p){for(var y=0,b=o;y<b.length;y+=1){var S=b[y],I=S.name,D=S.property;this.binders[D].setUniform(S.binding,p,u.get(D),I)}},ri.prototype.updatePaintBuffers=function(t){for(var o in this._buffers=[],this.binders){var u=this.binders[o];if(t&&u instanceof xi){var p=t.fromScale===2?u.zoomInPaintVertexBuffer:u.zoomOutPaintVertexBuffer;p&&this._buffers.push(p)}else(u instanceof ii||u instanceof Xn)&&u.paintVertexBuffer&&this._buffers.push(u.paintVertexBuffer)}},ri.prototype.upload=function(t){for(var o in this.binders){var u=this.binders[o];(u instanceof ii||u instanceof Xn||u instanceof xi)&&u.upload(t)}this.updatePaintBuffers()},ri.prototype.destroy=function(){for(var t in this.binders){var o=this.binders[t];(o instanceof ii||o instanceof Xn||o instanceof xi)&&o.destroy()}};var Kn=function(t,o,u){u===void 0&&(u=function(){return!0}),this.programConfigurations={};for(var p=0,y=t;p<y.length;p+=1){var b=y[p];this.programConfigurations[b.id]=new ri(b,o,u)}this.needsUpload=!1,this._featureMap=new tt,this._bufferOffset=0};function po(t,o){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[t]||[t.replace(o+"-","").replace(/-/g,"_")]}function Ka(t,o,u){var p={color:{source:il,composite:Pa},number:{source:hu,composite:il}},y=function(b){return{"line-pattern":{source:fu,composite:fu},"fill-pattern":{source:fu,composite:fu},"fill-extrusion-pattern":{source:fu,composite:fu}}[b]}(t);return y&&y[u]||p[o][u]}Kn.prototype.populatePaintArrays=function(t,o,u,p,y,b){for(var S in this.programConfigurations)this.programConfigurations[S].populatePaintArrays(t,o,p,y,b);o.id!==void 0&&this._featureMap.add(o.id,u,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0},Kn.prototype.updatePaintArrays=function(t,o,u,p){for(var y=0,b=u;y<b.length;y+=1){var S=b[y];this.needsUpload=this.programConfigurations[S.id].updatePaintArrays(t,this._featureMap,o,S,p)||this.needsUpload}},Kn.prototype.get=function(t){return this.programConfigurations[t]},Kn.prototype.upload=function(t){if(this.needsUpload){for(var o in this.programConfigurations)this.programConfigurations[o].upload(t);this.needsUpload=!1}},Kn.prototype.destroy=function(){for(var t in this.programConfigurations)this.programConfigurations[t].destroy()},yn("ConstantBinder",li),yn("CrossFadedConstantBinder",fi),yn("SourceExpressionBinder",ii),yn("CrossFadedCompositeBinder",xi),yn("CompositeExpressionBinder",Xn),yn("ProgramConfiguration",ri,{omit:["_buffers"]}),yn("ProgramConfigurationSet",Kn);var Ho=Math.pow(2,14)-1,Bo=-Ho-1;function za(t){for(var o=8192/t.extent,u=t.loadGeometry(),p=0;p<u.length;p++)for(var y=u[p],b=0;b<y.length;b++){var S=y[b],I=Math.round(S.x*o),D=Math.round(S.y*o);S.x=gt(I,Bo,Ho),S.y=gt(D,Bo,Ho),(I<S.x||I>S.x+1||D<S.y||D>S.y+1)&&Qe("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return u}function co(t,o){return{type:t.type,id:t.id,properties:t.properties,geometry:o?za(t):[]}}function Bs(t,o,u,p,y){t.emplaceBack(2*o+(p+1)/2,2*u+(y+1)/2)}var _s=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(o){return o.id}),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new yl,this.indexArray=new al,this.segments=new he,this.programConfigurations=new Kn(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(function(o){return o.isStateDependent()}).map(function(o){return o.id})};function Hu(t,o){for(var u=0;u<t.length;u++)if(vu(o,t[u]))return!0;for(var p=0;p<o.length;p++)if(vu(t,o[p]))return!0;return!!mc(t,o)}function xs(t,o,u){return!!vu(t,o)||!!Wu(o,t,u)}function pu(t,o){if(t.length===1)return xl(o,t[0]);for(var u=0;u<o.length;u++)for(var p=o[u],y=0;y<p.length;y++)if(vu(t,p[y]))return!0;for(var b=0;b<t.length;b++)if(xl(o,t[b]))return!0;for(var S=0;S<o.length;S++)if(mc(t,o[S]))return!0;return!1}function vo(t,o,u){if(t.length>1){if(mc(t,o))return!0;for(var p=0;p<o.length;p++)if(Wu(o[p],t,u))return!0}for(var y=0;y<t.length;y++)if(Wu(t[y],o,u))return!0;return!1}function mc(t,o){if(t.length===0||o.length===0)return!1;for(var u=0;u<t.length-1;u++)for(var p=t[u],y=t[u+1],b=0;b<o.length-1;b++)if(ru(p,y,o[b],o[b+1]))return!0;return!1}function ru(t,o,u,p){return Qt(t,u,p)!==Qt(o,u,p)&&Qt(t,o,u)!==Qt(t,o,p)}function Wu(t,o,u){var p=u*u;if(o.length===1)return t.distSqr(o[0])<p;for(var y=1;y<o.length;y++)if(du(t,o[y-1],o[y])<p)return!0;return!1}function du(t,o,u){var p=o.distSqr(u);if(p===0)return t.distSqr(o);var y=((t.x-o.x)*(u.x-o.x)+(t.y-o.y)*(u.y-o.y))/p;return t.distSqr(y<0?o:y>1?u:u.sub(o)._mult(y)._add(o))}function xl(t,o){for(var u,p,y,b=!1,S=0;S<t.length;S++)for(var I=0,D=(u=t[S]).length-1;I<u.length;D=I++)(p=u[I]).y>o.y!=(y=u[D]).y>o.y&&o.x<(y.x-p.x)*(o.y-p.y)/(y.y-p.y)+p.x&&(b=!b);return b}function vu(t,o){for(var u=!1,p=0,y=t.length-1;p<t.length;y=p++){var b=t[p],S=t[y];b.y>o.y!=S.y>o.y&&o.x<(S.x-b.x)*(o.y-b.y)/(S.y-b.y)+b.x&&(u=!u)}return u}function Ul(t,o,u){var p=u[0],y=u[2];if(t.x<p.x&&o.x<p.x||t.x>y.x&&o.x>y.x||t.y<p.y&&o.y<p.y||t.y>y.y&&o.y>y.y)return!1;var b=Qt(t,o,u[0]);return b!==Qt(t,o,u[1])||b!==Qt(t,o,u[2])||b!==Qt(t,o,u[3])}function Ou(t,o,u){var p=o.paint.get(t).value;return p.kind==="constant"?p.value:u.programConfigurations.get(o.id).getMaxValue(t)}function So(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function ka(t,o,u,p,y){if(!o[0]&&!o[1])return t;var b=fe.convert(o)._mult(y);u==="viewport"&&b._rotate(-p);for(var S=[],I=0;I<t.length;I++)S.push(t[I].sub(b));return S}_s.prototype.populate=function(t,o,u){var p=this.layers[0],y=[],b=null;p.type==="circle"&&(b=p.layout.get("circle-sort-key"));for(var S=0,I=t;S<I.length;S+=1){var D=I[S],z=D.feature,V=D.id,W=D.index,ee=D.sourceLayerIndex,se=this.layers[0]._featureFilter.needGeometry,Me=co(z,se);if(this.layers[0]._featureFilter.filter(new Fi(this.zoom),Me,u)){var Oe=b?b.evaluate(Me,{},u):void 0,Ye={id:V,properties:z.properties,type:z.type,sourceLayerIndex:ee,index:W,geometry:se?Me.geometry:za(z),patterns:{},sortKey:Oe};y.push(Ye)}}b&&y.sort(function($r,Zn){return $r.sortKey-Zn.sortKey});for(var ze=0,st=y;ze<st.length;ze+=1){var Tt=st[ze],Vt=Tt.geometry,Xt=Tt.index,lr=Tt.sourceLayerIndex,Lr=t[Xt].feature;this.addFeature(Tt,Vt,Xt,u),o.featureIndex.insert(Lr,Vt,Xt,lr,this.index)}},_s.prototype.update=function(t,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,u)},_s.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},_s.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},_s.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ce),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},_s.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},_s.prototype.addFeature=function(t,o,u,p){for(var y=0,b=o;y<b.length;y+=1)for(var S=0,I=b[y];S<I.length;S+=1){var D=I[S],z=D.x,V=D.y;if(!(z<0||z>=8192||V<0||V>=8192)){var W=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),ee=W.vertexLength;Bs(this.layoutVertexArray,z,V,-1,-1),Bs(this.layoutVertexArray,z,V,1,-1),Bs(this.layoutVertexArray,z,V,1,1),Bs(this.layoutVertexArray,z,V,-1,1),this.indexArray.emplaceBack(ee,ee+1,ee+2),this.indexArray.emplaceBack(ee,ee+3,ee+2),W.vertexLength+=4,W.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,{},p)},yn("CircleBucket",_s,{omit:["layers"]});var Ua=new ns({"circle-sort-key":new Cn(pe.layout_circle["circle-sort-key"])}),mu={paint:new ns({"circle-radius":new Cn(pe.paint_circle["circle-radius"]),"circle-color":new Cn(pe.paint_circle["circle-color"]),"circle-blur":new Cn(pe.paint_circle["circle-blur"]),"circle-opacity":new Cn(pe.paint_circle["circle-opacity"]),"circle-translate":new Rn(pe.paint_circle["circle-translate"]),"circle-translate-anchor":new Rn(pe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Rn(pe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Rn(pe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Cn(pe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Cn(pe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Cn(pe.paint_circle["circle-stroke-opacity"])}),layout:Ua},ta=typeof Float32Array!="undefined"?Float32Array:Array;function is(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Ms(t,o,u){var p=o[0],y=o[1],b=o[2],S=o[3],I=o[4],D=o[5],z=o[6],V=o[7],W=o[8],ee=o[9],se=o[10],Me=o[11],Oe=o[12],Ye=o[13],ze=o[14],st=o[15],Tt=u[0],Vt=u[1],Xt=u[2],lr=u[3];return t[0]=Tt*p+Vt*I+Xt*W+lr*Oe,t[1]=Tt*y+Vt*D+Xt*ee+lr*Ye,t[2]=Tt*b+Vt*z+Xt*se+lr*ze,t[3]=Tt*S+Vt*V+Xt*Me+lr*st,t[4]=(Tt=u[4])*p+(Vt=u[5])*I+(Xt=u[6])*W+(lr=u[7])*Oe,t[5]=Tt*y+Vt*D+Xt*ee+lr*Ye,t[6]=Tt*b+Vt*z+Xt*se+lr*ze,t[7]=Tt*S+Vt*V+Xt*Me+lr*st,t[8]=(Tt=u[8])*p+(Vt=u[9])*I+(Xt=u[10])*W+(lr=u[11])*Oe,t[9]=Tt*y+Vt*D+Xt*ee+lr*Ye,t[10]=Tt*b+Vt*z+Xt*se+lr*ze,t[11]=Tt*S+Vt*V+Xt*Me+lr*st,t[12]=(Tt=u[12])*p+(Vt=u[13])*I+(Xt=u[14])*W+(lr=u[15])*Oe,t[13]=Tt*y+Vt*D+Xt*ee+lr*Ye,t[14]=Tt*b+Vt*z+Xt*se+lr*ze,t[15]=Tt*S+Vt*V+Xt*Me+lr*st,t}Math.hypot||(Math.hypot=function(){for(var t=arguments,o=0,u=arguments.length;u--;)o+=t[u]*t[u];return Math.sqrt(o)});var bl,_f=Ms;function xf(t,o,u){var p=o[0],y=o[1],b=o[2],S=o[3];return t[0]=u[0]*p+u[4]*y+u[8]*b+u[12]*S,t[1]=u[1]*p+u[5]*y+u[9]*b+u[13]*S,t[2]=u[2]*p+u[6]*y+u[10]*b+u[14]*S,t[3]=u[3]*p+u[7]*y+u[11]*b+u[15]*S,t}bl=new ta(3),ta!=Float32Array&&(bl[0]=0,bl[1]=0,bl[2]=0),function(){var t=new ta(4);ta!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0)}();var Gc=(function(){var t=new ta(2);ta!=Float32Array&&(t[0]=0,t[1]=0)}(),function(t){function o(u){t.call(this,u,mu)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.createBucket=function(u){return new _s(u)},o.prototype.queryRadius=function(u){var p=u;return Ou("circle-radius",this,p)+Ou("circle-stroke-width",this,p)+So(this.paint.get("circle-translate"))},o.prototype.queryIntersectsFeature=function(u,p,y,b,S,I,D,z){for(var V=ka(u,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),I.angle,D),W=this.paint.get("circle-radius").evaluate(p,y)+this.paint.get("circle-stroke-width").evaluate(p,y),ee=this.paint.get("circle-pitch-alignment")==="map",se=ee?V:function(Lr,$r){return Lr.map(function(Zn){return mo(Zn,$r)})}(V,z),Me=ee?W*D:W,Oe=0,Ye=b;Oe<Ye.length;Oe+=1)for(var ze=0,st=Ye[Oe];ze<st.length;ze+=1){var Tt=st[ze],Vt=ee?Tt:mo(Tt,z),Xt=Me,lr=xf([],[Tt.x,Tt.y,0,1],z);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Xt*=lr[3]/I.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Xt*=I.cameraToCenterDistance/lr[3]),xs(se,Vt,Xt))return!0}return!1},o}(Go));function mo(t,o){var u=xf([],[t.x,t.y,0,1],o);return new fe(u[0]/u[3],u[1]/u[3])}var Hc=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(_s);function Ru(t,o,u,p){var y=o.width,b=o.height;if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==y*b*u)throw new RangeError("mismatched image size")}else p=new Uint8Array(y*b*u);return t.width=y,t.height=b,t.data=p,t}function Zl(t,o,u){var p=o.width,y=o.height;if(p!==t.width||y!==t.height){var b=Ru({},{width:p,height:y},u);Xu(t,b,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,p),height:Math.min(t.height,y)},u),t.width=p,t.height=y,t.data=b.data}}function Xu(t,o,u,p,y,b){if(y.width===0||y.height===0)return o;if(y.width>t.width||y.height>t.height||u.x>t.width-y.width||u.y>t.height-y.height)throw new RangeError("out of range source coordinates for image copy");if(y.width>o.width||y.height>o.height||p.x>o.width-y.width||p.y>o.height-y.height)throw new RangeError("out of range destination coordinates for image copy");for(var S=t.data,I=o.data,D=0;D<y.height;D++)for(var z=((u.y+D)*t.width+u.x)*b,V=((p.y+D)*o.width+p.x)*b,W=0;W<y.width*b;W++)I[V+W]=S[z+W];return o}yn("HeatmapBucket",Hc,{omit:["layers"]});var nu=function(t,o){Ru(this,t,1,o)};nu.prototype.resize=function(t){Zl(this,t,1)},nu.prototype.clone=function(){return new nu({width:this.width,height:this.height},new Uint8Array(this.data))},nu.copy=function(t,o,u,p,y){Xu(t,o,u,p,y,1)};var go=function(t,o){Ru(this,t,4,o)};go.prototype.resize=function(t){Zl(this,t,4)},go.prototype.replace=function(t,o){o?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t},go.prototype.clone=function(){return new go({width:this.width,height:this.height},new Uint8Array(this.data))},go.copy=function(t,o,u,p,y){Xu(t,o,u,p,y,4)},yn("AlphaImage",nu),yn("RGBAImage",go);var gc={paint:new ns({"heatmap-radius":new Cn(pe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Cn(pe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Rn(pe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new lu(pe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Rn(pe.paint_heatmap["heatmap-opacity"])})};function bf(t){var o={},u=t.resolution||256,p=t.clips?t.clips.length:1,y=t.image||new go({width:u,height:p}),b=function(Me,Oe,Ye){o[t.evaluationKey]=Ye;var ze=t.expression.evaluate(o);y.data[Me+Oe+0]=Math.floor(255*ze.r/ze.a),y.data[Me+Oe+1]=Math.floor(255*ze.g/ze.a),y.data[Me+Oe+2]=Math.floor(255*ze.b/ze.a),y.data[Me+Oe+3]=Math.floor(255*ze.a)};if(t.clips)for(var S=0,I=0;S<p;++S,I+=4*u)for(var D=0,z=0;D<u;D++,z+=4){var V=D/(u-1),W=t.clips[S];b(I,z,W.start*(1-V)+W.end*V)}else for(var ee=0,se=0;ee<u;ee++,se+=4)b(0,se,ee/(u-1));return y}var Wc=function(t){function o(u){t.call(this,u,gc),this._updateColorRamp()}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.createBucket=function(u){return new Hc(u)},o.prototype._handleSpecialPaintPropertyUpdate=function(u){u==="heatmap-color"&&this._updateColorRamp()},o.prototype._updateColorRamp=function(){this.colorRamp=bf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},o.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},o.prototype.queryRadius=function(){return 0},o.prototype.queryIntersectsFeature=function(){return!1},o.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},o}(Go),yc={paint:new ns({"hillshade-illumination-direction":new Rn(pe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Rn(pe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Rn(pe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Rn(pe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Rn(pe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Rn(pe.paint_hillshade["hillshade-accent-color"])})},Sh=function(t){function o(u){t.call(this,u,yc)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},o}(Go),Ch=Na([{name:"a_pos",components:2,type:"Int16"}],4).members,El=Ah,Xc=Ah;function Ah(t,o,u){u=u||2;var p,y,b,S,I,D,z,V=o&&o.length,W=V?o[0]*u:t.length,ee=np(t,0,W,u,!0),se=[];if(!ee||ee.next===ee.prev)return se;if(V&&(ee=function(Oe,Ye,ze,st){var Tt,Vt,Xt,lr=[];for(Tt=0,Vt=Ye.length;Tt<Vt;Tt++)(Xt=np(Oe,Ye[Tt]*st,Tt<Vt-1?Ye[Tt+1]*st:Oe.length,st,!1))===Xt.next&&(Xt.steiner=!0),lr.push(Up(Xt));for(lr.sort(Md),Tt=0;Tt<lr.length;Tt++)Pd(lr[Tt],ze),ze=Ps(ze,ze.next);return ze}(t,o,ee,u)),t.length>80*u){p=b=t[0],y=S=t[1];for(var Me=u;Me<W;Me+=u)(I=t[Me])<p&&(p=I),(D=t[Me+1])<y&&(y=D),I>b&&(b=I),D>S&&(S=D);z=(z=Math.max(b-p,S-y))!==0?1/z:0}return Yc(ee,se,u,p,y,z),se}function np(t,o,u,p,y){var b,S;if(y===Kf(t,o,u,p)>0)for(b=o;b<u;b+=p)S=qf(b,t[b],t[b+1],S);else for(b=u-p;b>=o;b-=p)S=qf(b,t[b],t[b+1],S);return S&&Th(S,S.next)&&(jl(S),S=S.next),S}function Ps(t,o){if(!t)return t;o||(o=t);var u,p=t;do if(u=!1,p.steiner||!Th(p,p.next)&&Co(p.prev,p,p.next)!==0)p=p.next;else{if(jl(p),(p=o=p.prev)===p.next)break;u=!0}while(u||p!==o);return o}function Yc(t,o,u,p,y,b,S){if(t){!S&&b&&function(V,W,ee,se){var Me=V;do Me.z===null&&(Me.z=ap(Me.x,Me.y,W,ee,se)),Me.prevZ=Me.prev,Me.nextZ=Me.next,Me=Me.next;while(Me!==V);Me.prevZ.nextZ=null,Me.prevZ=null,function(Oe){var Ye,ze,st,Tt,Vt,Xt,lr,Lr,$r=1;do{for(ze=Oe,Oe=null,Vt=null,Xt=0;ze;){for(Xt++,st=ze,lr=0,Ye=0;Ye<$r&&(lr++,st=st.nextZ);Ye++);for(Lr=$r;lr>0||Lr>0&&st;)lr!==0&&(Lr===0||!st||ze.z<=st.z)?(Tt=ze,ze=ze.nextZ,lr--):(Tt=st,st=st.nextZ,Lr--),Vt?Vt.nextZ=Tt:Oe=Tt,Tt.prevZ=Vt,Vt=Tt;ze=st}Vt.nextZ=null,$r*=2}while(Xt>1)}(Me)}(t,p,y,b);for(var I,D,z=t;t.prev!==t.next;)if(I=t.prev,D=t.next,b?Td(t,p,y,b):zp(t))o.push(I.i/u),o.push(t.i/u),o.push(D.i/u),jl(t),t=D.next,z=D.next;else if((t=D)===z){S?S===1?Yc(t=Ef(Ps(t),o,u),o,u,p,y,b,2):S===2&&ip(t,o,u,p,y,b):Yc(Ps(t),o,u,p,y,b,1);break}}}function zp(t){var o=t.prev,u=t,p=t.next;if(Co(o,u,p)>=0)return!1;for(var y=t.next.next;y!==t.prev;){if(qc(o.x,o.y,u.x,u.y,p.x,p.y,y.x,y.y)&&Co(y.prev,y,y.next)>=0)return!1;y=y.next}return!0}function Td(t,o,u,p){var y=t.prev,b=t,S=t.next;if(Co(y,b,S)>=0)return!1;for(var I=y.x>b.x?y.x>S.x?y.x:S.x:b.x>S.x?b.x:S.x,D=y.y>b.y?y.y>S.y?y.y:S.y:b.y>S.y?b.y:S.y,z=ap(y.x<b.x?y.x<S.x?y.x:S.x:b.x<S.x?b.x:S.x,y.y<b.y?y.y<S.y?y.y:S.y:b.y<S.y?b.y:S.y,o,u,p),V=ap(I,D,o,u,p),W=t.prevZ,ee=t.nextZ;W&&W.z>=z&&ee&&ee.z<=V;){if(W!==t.prev&&W!==t.next&&qc(y.x,y.y,b.x,b.y,S.x,S.y,W.x,W.y)&&Co(W.prev,W,W.next)>=0||(W=W.prevZ,ee!==t.prev&&ee!==t.next&&qc(y.x,y.y,b.x,b.y,S.x,S.y,ee.x,ee.y)&&Co(ee.prev,ee,ee.next)>=0))return!1;ee=ee.nextZ}for(;W&&W.z>=z;){if(W!==t.prev&&W!==t.next&&qc(y.x,y.y,b.x,b.y,S.x,S.y,W.x,W.y)&&Co(W.prev,W,W.next)>=0)return!1;W=W.prevZ}for(;ee&&ee.z<=V;){if(ee!==t.prev&&ee!==t.next&&qc(y.x,y.y,b.x,b.y,S.x,S.y,ee.x,ee.y)&&Co(ee.prev,ee,ee.next)>=0)return!1;ee=ee.nextZ}return!0}function Ef(t,o,u){var p=t;do{var y=p.prev,b=p.next.next;!Th(y,b)&&jp(y,p,p.next,b)&&Yf(y,b)&&Yf(b,y)&&(o.push(y.i/u),o.push(p.i/u),o.push(b.i/u),jl(p),jl(p.next),p=t=b),p=p.next}while(p!==t);return Ps(p)}function ip(t,o,u,p,y,b){var S=t;do{for(var I=S.next.next;I!==S.prev;){if(S.i!==I.i&&Zp(S,I)){var D=Ph(S,I);return S=Ps(S,S.next),D=Ps(D,D.next),Yc(S,o,u,p,y,b),void Yc(D,o,u,p,y,b)}I=I.next}S=S.next}while(S!==t)}function Md(t,o){return t.x-o.x}function Pd(t,o){if(o=function(p,y){var b,S=y,I=p.x,D=p.y,z=-1/0;do{if(D<=S.y&&D>=S.next.y&&S.next.y!==S.y){var V=S.x+(D-S.y)*(S.next.x-S.x)/(S.next.y-S.y);if(V<=I&&V>z){if(z=V,V===I){if(D===S.y)return S;if(D===S.next.y)return S.next}b=S.x<S.next.x?S:S.next}}S=S.next}while(S!==y);if(!b)return null;if(I===z)return b;var W,ee=b,se=b.x,Me=b.y,Oe=1/0;S=b;do I>=S.x&&S.x>=se&&I!==S.x&&qc(D<Me?I:z,D,se,Me,D<Me?z:I,D,S.x,S.y)&&(W=Math.abs(D-S.y)/(I-S.x),Yf(S,p)&&(W<Oe||W===Oe&&(S.x>b.x||S.x===b.x&&wh(b,S)))&&(b=S,Oe=W)),S=S.next;while(S!==ee);return b}(t,o)){var u=Ph(o,t);Ps(o,o.next),Ps(u,u.next)}}function wh(t,o){return Co(t.prev,t,o.prev)<0&&Co(o.next,t,t.next)<0}function ap(t,o,u,p,y){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-u)*y)|t<<8))|t<<4))|t<<2))|t<<1))|(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=32767*(o-p)*y)|o<<8))|o<<4))|o<<2))|o<<1))<<1}function Up(t){var o=t,u=t;do(o.x<u.x||o.x===u.x&&o.y<u.y)&&(u=o),o=o.next;while(o!==t);return u}function qc(t,o,u,p,y,b,S,I){return(y-S)*(o-I)-(t-S)*(b-I)>=0&&(t-S)*(p-I)-(u-S)*(o-I)>=0&&(u-S)*(b-I)-(y-S)*(p-I)>=0}function Zp(t,o){return t.next.i!==o.i&&t.prev.i!==o.i&&!function(u,p){var y=u;do{if(y.i!==u.i&&y.next.i!==u.i&&y.i!==p.i&&y.next.i!==p.i&&jp(y,y.next,u,p))return!0;y=y.next}while(y!==u);return!1}(t,o)&&(Yf(t,o)&&Yf(o,t)&&function(u,p){var y=u,b=!1,S=(u.x+p.x)/2,I=(u.y+p.y)/2;do y.y>I!=y.next.y>I&&y.next.y!==y.y&&S<(y.next.x-y.x)*(I-y.y)/(y.next.y-y.y)+y.x&&(b=!b),y=y.next;while(y!==u);return b}(t,o)&&(Co(t.prev,t,o.prev)||Co(t,o.prev,o))||Th(t,o)&&Co(t.prev,t,t.next)>0&&Co(o.prev,o,o.next)>0)}function Co(t,o,u){return(o.y-t.y)*(u.x-o.x)-(o.x-t.x)*(u.y-o.y)}function Th(t,o){return t.x===o.x&&t.y===o.y}function jp(t,o,u,p){var y=Xf(Co(t,o,u)),b=Xf(Co(t,o,p)),S=Xf(Co(u,p,t)),I=Xf(Co(u,p,o));return y!==b&&S!==I||!(y!==0||!Mh(t,u,o))||!(b!==0||!Mh(t,p,o))||!(S!==0||!Mh(u,t,p))||!(I!==0||!Mh(u,o,p))}function Mh(t,o,u){return o.x<=Math.max(t.x,u.x)&&o.x>=Math.min(t.x,u.x)&&o.y<=Math.max(t.y,u.y)&&o.y>=Math.min(t.y,u.y)}function Xf(t){return t>0?1:t<0?-1:0}function Yf(t,o){return Co(t.prev,t,t.next)<0?Co(t,o,t.next)>=0&&Co(t,t.prev,o)>=0:Co(t,o,t.prev)<0||Co(t,t.next,o)<0}function Ph(t,o){var u=new Sl(t.i,t.x,t.y),p=new Sl(o.i,o.x,o.y),y=t.next,b=o.prev;return t.next=o,o.prev=t,u.next=y,y.prev=u,p.next=u,u.prev=p,b.next=p,p.prev=b,p}function qf(t,o,u,p){var y=new Sl(t,o,u);return p?(y.next=p.next,y.prev=p,p.next.prev=y,p.next=y):(y.prev=y,y.next=y),y}function jl(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Sl(t,o,u){this.i=t,this.x=o,this.y=u,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Kf(t,o,u,p){for(var y=0,b=o,S=u-p;b<u;b+=p)y+=(t[S]-t[b])*(t[b+1]+t[S+1]),S=b;return y}function Ih(t,o,u,p,y){(function b(S,I,D,z,V){for(;z>D;){if(z-D>600){var W=z-D+1,ee=I-D+1,se=Math.log(W),Me=.5*Math.exp(2*se/3),Oe=.5*Math.sqrt(se*Me*(W-Me)/W)*(ee-W/2<0?-1:1);b(S,I,Math.max(D,Math.floor(I-ee*Me/W+Oe)),Math.min(z,Math.floor(I+(W-ee)*Me/W+Oe)),V)}var Ye=S[I],ze=D,st=z;for(_c(S,D,I),V(S[z],Ye)>0&&_c(S,D,z);ze<st;){for(_c(S,ze,st),ze++,st--;V(S[ze],Ye)<0;)ze++;for(;V(S[st],Ye)>0;)st--}V(S[D],Ye)===0?_c(S,D,st):_c(S,++st,z),st<=I&&(D=st+1),I<=st&&(z=st-1)}})(t,o,u||0,p||t.length-1,y||Oh)}function _c(t,o,u){var p=t[o];t[o]=t[u],t[u]=p}function Oh(t,o){return t<o?-1:t>o?1:0}function $f(t,o){var u=t.length;if(u<=1)return[t];for(var p,y,b=[],S=0;S<u;S++){var I=Er(t[S]);I!==0&&(t[S].area=Math.abs(I),y===void 0&&(y=I<0),y===I<0?(p&&b.push(p),p=[t[S]]):p.push(t[S]))}if(p&&b.push(p),o>1)for(var D=0;D<b.length;D++)b[D].length<=o||(Ih(b[D],o,1,b[D].length-1,Qf),b[D]=b[D].slice(0,o));return b}function Qf(t,o){return o.area-t.area}function Sf(t,o,u){for(var p=u.patternDependencies,y=!1,b=0,S=o;b<S.length;b+=1){var I=S[b].paint.get(t+"-pattern");I.isConstant()||(y=!0);var D=I.constantOr(null);D&&(y=!0,p[D.to]=!0,p[D.from]=!0)}return y}function Kc(t,o,u,p,y){for(var b=y.patternDependencies,S=0,I=o;S<I.length;S+=1){var D=I[S],z=D.paint.get(t+"-pattern").value;if(z.kind!=="constant"){var V=z.evaluate({zoom:p-1},u,{},y.availableImages),W=z.evaluate({zoom:p},u,{},y.availableImages),ee=z.evaluate({zoom:p+1},u,{},y.availableImages);W=W&&W.name?W.name:W,ee=ee&&ee.name?ee.name:ee,b[V=V&&V.name?V.name:V]=!0,b[W]=!0,b[ee]=!0,u.patterns[D.id]={min:V,mid:W,max:ee}}}return u}Ah.deviation=function(t,o,u,p){var y=o&&o.length,b=Math.abs(Kf(t,0,y?o[0]*u:t.length,u));if(y)for(var S=0,I=o.length;S<I;S++)b-=Math.abs(Kf(t,o[S]*u,S<I-1?o[S+1]*u:t.length,u));var D=0;for(S=0;S<p.length;S+=3){var z=p[S]*u,V=p[S+1]*u,W=p[S+2]*u;D+=Math.abs((t[z]-t[W])*(t[V+1]-t[z+1])-(t[z]-t[V])*(t[W+1]-t[z+1]))}return b===0&&D===0?0:Math.abs((D-b)/b)},Ah.flatten=function(t){for(var o=t[0][0].length,u={vertices:[],holes:[],dimensions:o},p=0,y=0;y<t.length;y++){for(var b=0;b<t[y].length;b++)for(var S=0;S<o;S++)u.vertices.push(t[y][b][S]);y>0&&u.holes.push(p+=t[y-1].length)}return u},El.default=Xc;var Ns=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(o){return o.id}),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new yl,this.indexArray=new al,this.indexArray2=new _l,this.programConfigurations=new Kn(t.layers,t.zoom),this.segments=new he,this.segments2=new he,this.stateDependentLayerIds=this.layers.filter(function(o){return o.isStateDependent()}).map(function(o){return o.id})};Ns.prototype.populate=function(t,o,u){this.hasPattern=Sf("fill",this.layers,o);for(var p=this.layers[0].layout.get("fill-sort-key"),y=[],b=0,S=t;b<S.length;b+=1){var I=S[b],D=I.feature,z=I.id,V=I.index,W=I.sourceLayerIndex,ee=this.layers[0]._featureFilter.needGeometry,se=co(D,ee);if(this.layers[0]._featureFilter.filter(new Fi(this.zoom),se,u)){var Me=p?p.evaluate(se,{},u,o.availableImages):void 0,Oe={id:z,properties:D.properties,type:D.type,sourceLayerIndex:W,index:V,geometry:ee?se.geometry:za(D),patterns:{},sortKey:Me};y.push(Oe)}}p&&y.sort(function(Lr,$r){return Lr.sortKey-$r.sortKey});for(var Ye=0,ze=y;Ye<ze.length;Ye+=1){var st=ze[Ye],Tt=st.geometry,Vt=st.index,Xt=st.sourceLayerIndex;if(this.hasPattern){var lr=Kc("fill",this.layers,st,this.zoom,o);this.patternFeatures.push(lr)}else this.addFeature(st,Tt,Vt,u,{});o.featureIndex.insert(t[Vt].feature,Tt,Vt,Xt,this.index)}},Ns.prototype.update=function(t,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,u)},Ns.prototype.addFeatures=function(t,o,u){for(var p=0,y=this.patternFeatures;p<y.length;p+=1){var b=y[p];this.addFeature(b,b.geometry,b.index,o,u)}},Ns.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Ns.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Ns.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ch),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0},Ns.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},Ns.prototype.addFeature=function(t,o,u,p,y){for(var b=0,S=$f(o,500);b<S.length;b+=1){for(var I=S[b],D=0,z=0,V=I;z<V.length;z+=1)D+=V[z].length;for(var W=this.segments.prepareSegment(D,this.layoutVertexArray,this.indexArray),ee=W.vertexLength,se=[],Me=[],Oe=0,Ye=I;Oe<Ye.length;Oe+=1){var ze=Ye[Oe];if(ze.length!==0){ze!==I[0]&&Me.push(se.length/2);var st=this.segments2.prepareSegment(ze.length,this.layoutVertexArray,this.indexArray2),Tt=st.vertexLength;this.layoutVertexArray.emplaceBack(ze[0].x,ze[0].y),this.indexArray2.emplaceBack(Tt+ze.length-1,Tt),se.push(ze[0].x),se.push(ze[0].y);for(var Vt=1;Vt<ze.length;Vt++)this.layoutVertexArray.emplaceBack(ze[Vt].x,ze[Vt].y),this.indexArray2.emplaceBack(Tt+Vt-1,Tt+Vt),se.push(ze[Vt].x),se.push(ze[Vt].y);st.vertexLength+=ze.length,st.primitiveLength+=ze.length}}for(var Xt=El(se,Me),lr=0;lr<Xt.length;lr+=3)this.indexArray.emplaceBack(ee+Xt[lr],ee+Xt[lr+1],ee+Xt[lr+2]);W.vertexLength+=D,W.primitiveLength+=Xt.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,y,p)},yn("FillBucket",Ns,{omit:["layers","patternFeatures"]});var Jf=new ns({"fill-sort-key":new Cn(pe.layout_fill["fill-sort-key"])}),eh={paint:new ns({"fill-antialias":new Rn(pe.paint_fill["fill-antialias"]),"fill-opacity":new Cn(pe.paint_fill["fill-opacity"]),"fill-color":new Cn(pe.paint_fill["fill-color"]),"fill-outline-color":new Cn(pe.paint_fill["fill-outline-color"]),"fill-translate":new Rn(pe.paint_fill["fill-translate"]),"fill-translate-anchor":new Rn(pe.paint_fill["fill-translate-anchor"]),"fill-pattern":new df(pe.paint_fill["fill-pattern"])}),layout:Jf},th=function(t){function o(u){t.call(this,u,eh)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.recalculate=function(u,p){t.prototype.recalculate.call(this,u,p);var y=this.paint._values["fill-outline-color"];y.value.kind==="constant"&&y.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},o.prototype.createBucket=function(u){return new Ns(u)},o.prototype.queryRadius=function(){return So(this.paint.get("fill-translate"))},o.prototype.queryIntersectsFeature=function(u,p,y,b,S,I,D){return pu(ka(u,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),I.angle,D),b)},o.prototype.isTileClipped=function(){return!0},o}(Go),rh=Na([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,Rh=Cl;function Cl(t,o,u,p,y){this.properties={},this.extent=u,this.type=0,this._pbf=t,this._geometry=-1,this._keys=p,this._values=y,t.readFields(Yu,this,o)}function Yu(t,o,u){t==1?o.id=u.readVarint():t==2?function(p,y){for(var b=p.readVarint()+p.pos;p.pos<b;){var S=y._keys[p.readVarint()],I=y._values[p.readVarint()];y.properties[S]=I}}(u,o):t==3?o.type=u.readVarint():t==4&&(o._geometry=u.pos)}function Vp(t){for(var o,u,p=0,y=0,b=t.length,S=b-1;y<b;S=y++)p+=((u=t[S]).x-(o=t[y]).x)*(o.y+u.y);return p}Cl.types=["Unknown","Point","LineString","Polygon"],Cl.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var o,u=t.readVarint()+t.pos,p=1,y=0,b=0,S=0,I=[];t.pos<u;){if(y<=0){var D=t.readVarint();p=7&D,y=D>>3}if(y--,p===1||p===2)b+=t.readSVarint(),S+=t.readSVarint(),p===1&&(o&&I.push(o),o=[]),o.push(new fe(b,S));else{if(p!==7)throw new Error("unknown command "+p);o&&o.push(o[0].clone())}}return o&&I.push(o),I},Cl.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var o=t.readVarint()+t.pos,u=1,p=0,y=0,b=0,S=1/0,I=-1/0,D=1/0,z=-1/0;t.pos<o;){if(p<=0){var V=t.readVarint();u=7&V,p=V>>3}if(p--,u===1||u===2)(y+=t.readSVarint())<S&&(S=y),y>I&&(I=y),(b+=t.readSVarint())<D&&(D=b),b>z&&(z=b);else if(u!==7)throw new Error("unknown command "+u)}return[S,D,I,z]},Cl.prototype.toGeoJSON=function(t,o,u){var p,y,b=this.extent*Math.pow(2,u),S=this.extent*t,I=this.extent*o,D=this.loadGeometry(),z=Cl.types[this.type];function V(se){for(var Me=0;Me<se.length;Me++){var Oe=se[Me];se[Me]=[360*(Oe.x+S)/b-180,360/Math.PI*Math.atan(Math.exp((180-360*(Oe.y+I)/b)*Math.PI/180))-90]}}switch(this.type){case 1:var W=[];for(p=0;p<D.length;p++)W[p]=D[p][0];V(D=W);break;case 2:for(p=0;p<D.length;p++)V(D[p]);break;case 3:for(D=function(se){var Me=se.length;if(Me<=1)return[se];for(var Oe,Ye,ze=[],st=0;st<Me;st++){var Tt=Vp(se[st]);Tt!==0&&(Ye===void 0&&(Ye=Tt<0),Ye===Tt<0?(Oe&&ze.push(Oe),Oe=[se[st]]):Oe.push(se[st]))}return Oe&&ze.push(Oe),ze}(D),p=0;p<D.length;p++)for(y=0;y<D[p].length;y++)V(D[p][y])}D.length===1?D=D[0]:z="Multi"+z;var ee={type:"Feature",geometry:{type:z,coordinates:D},properties:this.properties};return"id"in this&&(ee.id=this.id),ee};var Lh=Gp;function Gp(t,o){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(Id,this,o),this.length=this._features.length}function Id(t,o,u){t===15?o.version=u.readVarint():t===1?o.name=u.readString():t===5?o.extent=u.readVarint():t===2?o._features.push(u.pos):t===3?o._keys.push(u.readString()):t===4&&o._values.push(function(p){for(var y=null,b=p.readVarint()+p.pos;p.pos<b;){var S=p.readVarint()>>3;y=S===1?p.readString():S===2?p.readFloat():S===3?p.readDouble():S===4?p.readVarint64():S===5?p.readVarint():S===6?p.readSVarint():S===7?p.readBoolean():null}return y}(u))}function Hp(t,o,u){if(t===3){var p=new Lh(u,u.readVarint()+u.pos);p.length&&(o[p.name]=p)}}Gp.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var o=this._pbf.readVarint()+this._pbf.pos;return new Rh(this._pbf,o,this.extent,this._keys,this._values)};var gu={VectorTile:function(t,o){this.layers=t.readFields(Hp,{},o)},VectorTileFeature:Rh,VectorTileLayer:Lh},Wp=gu.VectorTileFeature.types,kh=Math.pow(2,13);function $c(t,o,u,p,y,b,S,I){t.emplaceBack(o,u,2*Math.floor(p*kh)+S,y*kh*2,b*kh*2,Math.round(I))}var qu=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(o){return o.id}),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new cu,this.indexArray=new al,this.programConfigurations=new Kn(t.layers,t.zoom),this.segments=new he,this.stateDependentLayerIds=this.layers.filter(function(o){return o.isStateDependent()}).map(function(o){return o.id})};function Xp(t,o){return t.x===o.x&&(t.x<0||t.x>8192)||t.y===o.y&&(t.y<0||t.y>8192)}qu.prototype.populate=function(t,o,u){this.features=[],this.hasPattern=Sf("fill-extrusion",this.layers,o);for(var p=0,y=t;p<y.length;p+=1){var b=y[p],S=b.feature,I=b.id,D=b.index,z=b.sourceLayerIndex,V=this.layers[0]._featureFilter.needGeometry,W=co(S,V);if(this.layers[0]._featureFilter.filter(new Fi(this.zoom),W,u)){var ee={id:I,sourceLayerIndex:z,index:D,geometry:V?W.geometry:za(S),properties:S.properties,type:S.type,patterns:{}};this.hasPattern?this.features.push(Kc("fill-extrusion",this.layers,ee,this.zoom,o)):this.addFeature(ee,ee.geometry,D,u,{}),o.featureIndex.insert(S,ee.geometry,D,z,this.index,!0)}}},qu.prototype.addFeatures=function(t,o,u){for(var p=0,y=this.features;p<y.length;p+=1){var b=y[p];this.addFeature(b,b.geometry,b.index,o,u)}},qu.prototype.update=function(t,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,u)},qu.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},qu.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},qu.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,rh),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},qu.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},qu.prototype.addFeature=function(t,o,u,p,y){for(var b=0,S=$f(o,500);b<S.length;b+=1){for(var I=S[b],D=0,z=0,V=I;z<V.length;z+=1)D+=V[z].length;for(var W=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),ee=0,se=I;ee<se.length;ee+=1){var Me=se[ee];if(Me.length!==0&&!((Ai=Me).every(function(hi){return hi.x<0})||Ai.every(function(hi){return hi.x>8192})||Ai.every(function(hi){return hi.y<0})||Ai.every(function(hi){return hi.y>8192})))for(var Oe=0,Ye=0;Ye<Me.length;Ye++){var ze=Me[Ye];if(Ye>=1){var st=Me[Ye-1];if(!Xp(ze,st)){W.vertexLength+4>he.MAX_VERTEX_ARRAY_LENGTH&&(W=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var Tt=ze.sub(st)._perp()._unit(),Vt=st.dist(ze);Oe+Vt>32768&&(Oe=0),$c(this.layoutVertexArray,ze.x,ze.y,Tt.x,Tt.y,0,0,Oe),$c(this.layoutVertexArray,ze.x,ze.y,Tt.x,Tt.y,0,1,Oe),$c(this.layoutVertexArray,st.x,st.y,Tt.x,Tt.y,0,0,Oe+=Vt),$c(this.layoutVertexArray,st.x,st.y,Tt.x,Tt.y,0,1,Oe);var Xt=W.vertexLength;this.indexArray.emplaceBack(Xt,Xt+2,Xt+1),this.indexArray.emplaceBack(Xt+1,Xt+2,Xt+3),W.vertexLength+=4,W.primitiveLength+=2}}}}if(W.vertexLength+D>he.MAX_VERTEX_ARRAY_LENGTH&&(W=this.segments.prepareSegment(D,this.layoutVertexArray,this.indexArray)),Wp[t.type]==="Polygon"){for(var lr=[],Lr=[],$r=W.vertexLength,Zn=0,gn=I;Zn<gn.length;Zn+=1){var Yn=gn[Zn];if(Yn.length!==0){Yn!==I[0]&&Lr.push(lr.length/2);for(var hn=0;hn<Yn.length;hn++){var ki=Yn[hn];$c(this.layoutVertexArray,ki.x,ki.y,0,0,1,1,0),lr.push(ki.x),lr.push(ki.y)}}}for(var ai=El(lr,Lr),Pn=0;Pn<ai.length;Pn+=3)this.indexArray.emplaceBack($r+ai[Pn],$r+ai[Pn+2],$r+ai[Pn+1]);W.primitiveLength+=ai.length/3,W.vertexLength+=D}}var Ai;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,y,p)},yn("FillExtrusionBucket",qu,{omit:["layers","features"]});var Od={paint:new ns({"fill-extrusion-opacity":new Rn(pe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Cn(pe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Rn(pe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Rn(pe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new df(pe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Cn(pe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Cn(pe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Rn(pe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},Al=function(t){function o(u){t.call(this,u,Od)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.createBucket=function(u){return new qu(u)},o.prototype.queryRadius=function(){return So(this.paint.get("fill-extrusion-translate"))},o.prototype.is3D=function(){return!0},o.prototype.queryIntersectsFeature=function(u,p,y,b,S,I,D,z){var V=ka(u,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),I.angle,D),W=this.paint.get("fill-extrusion-height").evaluate(p,y),ee=this.paint.get("fill-extrusion-base").evaluate(p,y),se=function(Oe,Ye,ze,st){for(var Tt=[],Vt=0,Xt=Oe;Vt<Xt.length;Vt+=1){var lr=Xt[Vt],Lr=[lr.x,lr.y,0,1];xf(Lr,Lr,Ye),Tt.push(new fe(Lr[0]/Lr[3],Lr[1]/Lr[3]))}return Tt}(V,z),Me=function(Oe,Ye,ze,st){for(var Tt=[],Vt=[],Xt=st[8]*Ye,lr=st[9]*Ye,Lr=st[10]*Ye,$r=st[11]*Ye,Zn=st[8]*ze,gn=st[9]*ze,Yn=st[10]*ze,hn=st[11]*ze,ki=0,ai=Oe;ki<ai.length;ki+=1){for(var Pn=[],Ai=[],hi=0,ea=ai[ki];hi<ea.length;hi+=1){var Hn=ea[hi],la=Hn.x,Wa=Hn.y,yo=st[0]*la+st[4]*Wa+st[12],_o=st[1]*la+st[5]*Wa+st[13],ao=st[2]*la+st[6]*Wa+st[14],Mo=st[3]*la+st[7]*Wa+st[15],Po=ao+Lr,ma=Mo+$r,zs=yo+Zn,cs=_o+gn,Us=ao+Yn,xo=Mo+hn,fs=new fe((yo+Xt)/ma,(_o+lr)/ma);fs.z=Po/ma,Pn.push(fs);var Yi=new fe(zs/xo,cs/xo);Yi.z=Us/xo,Ai.push(Yi)}Tt.push(Pn),Vt.push(Ai)}return[Tt,Vt]}(b,ee,W,z);return function(Oe,Ye,ze){var st=1/0;pu(ze,Ye)&&(st=Vl(ze,Ye[0]));for(var Tt=0;Tt<Ye.length;Tt++)for(var Vt=Ye[Tt],Xt=Oe[Tt],lr=0;lr<Vt.length-1;lr++){var Lr=Vt[lr],$r=[Lr,Vt[lr+1],Xt[lr+1],Xt[lr],Lr];Hu(ze,$r)&&(st=Math.min(st,Vl(ze,$r)))}return st!==1/0&&st}(Me[0],Me[1],se)},o}(Go);function Cf(t,o){return t.x*o.x+t.y*o.y}function Vl(t,o){if(t.length===1){for(var u,p=0,y=o[p++];!u||y.equals(u);)if(!(u=o[p++]))return 1/0;for(;p<o.length;p++){var b=o[p],S=t[0],I=u.sub(y),D=b.sub(y),z=S.sub(y),V=Cf(I,I),W=Cf(I,D),ee=Cf(D,D),se=Cf(z,I),Me=Cf(z,D),Oe=V*ee-W*W,Ye=(ee*se-W*Me)/Oe,ze=(V*Me-W*se)/Oe,st=y.z*(1-Ye-ze)+u.z*Ye+b.z*ze;if(isFinite(st))return st}return 1/0}for(var Tt=1/0,Vt=0,Xt=o;Vt<Xt.length;Vt+=1)Tt=Math.min(Tt,Xt[Vt].z);return Tt}var Qc=Na([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,Wr=Na([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,op=gu.VectorTileFeature.types,Ht=Math.cos(Math.PI/180*37.5),sp=Math.pow(2,14)/.5,va=function(t){var o=this;this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(u){return u.id}),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(u){o.gradients[u.id]={}}),this.layoutVertexArray=new Fo,this.layoutVertexArray2=new il,this.indexArray=new al,this.programConfigurations=new Kn(t.layers,t.zoom),this.segments=new he,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(u){return u.isStateDependent()}).map(function(u){return u.id})};va.prototype.populate=function(t,o,u){this.hasPattern=Sf("line",this.layers,o);for(var p=this.layers[0].layout.get("line-sort-key"),y=[],b=0,S=t;b<S.length;b+=1){var I=S[b],D=I.feature,z=I.id,V=I.index,W=I.sourceLayerIndex,ee=this.layers[0]._featureFilter.needGeometry,se=co(D,ee);if(this.layers[0]._featureFilter.filter(new Fi(this.zoom),se,u)){var Me=p?p.evaluate(se,{},u):void 0,Oe={id:z,properties:D.properties,type:D.type,sourceLayerIndex:W,index:V,geometry:ee?se.geometry:za(D),patterns:{},sortKey:Me};y.push(Oe)}}p&&y.sort(function(Lr,$r){return Lr.sortKey-$r.sortKey});for(var Ye=0,ze=y;Ye<ze.length;Ye+=1){var st=ze[Ye],Tt=st.geometry,Vt=st.index,Xt=st.sourceLayerIndex;if(this.hasPattern){var lr=Kc("line",this.layers,st,this.zoom,o);this.patternFeatures.push(lr)}else this.addFeature(st,Tt,Vt,u,{});o.featureIndex.insert(t[Vt].feature,Tt,Vt,Xt,this.index)}},va.prototype.update=function(t,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,u)},va.prototype.addFeatures=function(t,o,u){for(var p=0,y=this.patternFeatures;p<y.length;p+=1){var b=y[p];this.addFeature(b,b.geometry,b.index,o,u)}},va.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},va.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},va.prototype.upload=function(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Wr)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Qc),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},va.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},va.prototype.lineFeatureClips=function(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}},va.prototype.addFeature=function(t,o,u,p,y){var b=this.layers[0].layout,S=b.get("line-join").evaluate(t,{}),I=b.get("line-cap"),D=b.get("line-miter-limit"),z=b.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(var V=0,W=o;V<W.length;V+=1)this.addLine(W[V],t,S,I,D,z);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,y,p)},va.prototype.addLine=function(t,o,u,p,y,b){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var S=0;S<t.length-1;S++)this.totalDistance+=t[S].dist(t[S+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var I=op[o.type]==="Polygon",D=t.length;D>=2&&t[D-1].equals(t[D-2]);)D--;for(var z=0;z<D-1&&t[z].equals(t[z+1]);)z++;if(!(D<(I?3:2))){u==="bevel"&&(y=1.05);var V,W=this.overscaling<=16?122880/(512*this.overscaling):0,ee=this.segments.prepareSegment(10*D,this.layoutVertexArray,this.indexArray),se=void 0,Me=void 0,Oe=void 0,Ye=void 0;this.e1=this.e2=-1,I&&(Ye=t[z].sub(V=t[D-2])._unit()._perp());for(var ze=z;ze<D;ze++)if(!(Me=ze===D-1?I?t[z+1]:void 0:t[ze+1])||!t[ze].equals(Me)){Ye&&(Oe=Ye),V&&(se=V),V=t[ze],Ye=Me?Me.sub(V)._unit()._perp():Oe;var st=(Oe=Oe||Ye).add(Ye);st.x===0&&st.y===0||st._unit();var Tt=Oe.x*Ye.x+Oe.y*Ye.y,Vt=st.x*Ye.x+st.y*Ye.y,Xt=Vt!==0?1/Vt:1/0,lr=2*Math.sqrt(2-2*Vt),Lr=Vt<Ht&&se&&Me,$r=Oe.x*Ye.y-Oe.y*Ye.x>0;if(Lr&&ze>z){var Zn=V.dist(se);if(Zn>2*W){var gn=V.sub(V.sub(se)._mult(W/Zn)._round());this.updateDistance(se,gn),this.addCurrentVertex(gn,Oe,0,0,ee),se=gn}}var Yn=se&&Me,hn=Yn?u:I?"butt":p;if(Yn&&hn==="round"&&(Xt<b?hn="miter":Xt<=2&&(hn="fakeround")),hn==="miter"&&Xt>y&&(hn="bevel"),hn==="bevel"&&(Xt>2&&(hn="flipbevel"),Xt<y&&(hn="miter")),se&&this.updateDistance(se,V),hn==="miter")st._mult(Xt),this.addCurrentVertex(V,st,0,0,ee);else if(hn==="flipbevel"){if(Xt>100)st=Ye.mult(-1);else{var ki=Xt*Oe.add(Ye).mag()/Oe.sub(Ye).mag();st._perp()._mult(ki*($r?-1:1))}this.addCurrentVertex(V,st,0,0,ee),this.addCurrentVertex(V,st.mult(-1),0,0,ee)}else if(hn==="bevel"||hn==="fakeround"){var ai=-Math.sqrt(Xt*Xt-1),Pn=$r?ai:0,Ai=$r?0:ai;if(se&&this.addCurrentVertex(V,Oe,Pn,Ai,ee),hn==="fakeround")for(var hi=Math.round(180*lr/Math.PI/20),ea=1;ea<hi;ea++){var Hn=ea/hi;if(Hn!==.5){var la=Hn-.5;Hn+=Hn*la*(Hn-1)*((1.0904+Tt*(Tt*(3.55645-1.43519*Tt)-3.2452))*la*la+(.848013+Tt*(.215638*Tt-1.06021)))}var Wa=Ye.sub(Oe)._mult(Hn)._add(Oe)._unit()._mult($r?-1:1);this.addHalfVertex(V,Wa.x,Wa.y,!1,$r,0,ee)}Me&&this.addCurrentVertex(V,Ye,-Pn,-Ai,ee)}else if(hn==="butt")this.addCurrentVertex(V,st,0,0,ee);else if(hn==="square"){var yo=se?1:-1;this.addCurrentVertex(V,st,yo,yo,ee)}else hn==="round"&&(se&&(this.addCurrentVertex(V,Oe,0,0,ee),this.addCurrentVertex(V,Oe,1,1,ee,!0)),Me&&(this.addCurrentVertex(V,Ye,-1,-1,ee,!0),this.addCurrentVertex(V,Ye,0,0,ee)));if(Lr&&ze<D-1){var _o=V.dist(Me);if(_o>2*W){var ao=V.add(Me.sub(V)._mult(W/_o)._round());this.updateDistance(V,ao),this.addCurrentVertex(ao,Ye,0,0,ee),V=ao}}}}},va.prototype.addCurrentVertex=function(t,o,u,p,y,b){b===void 0&&(b=!1);var S=o.y*p-o.x,I=-o.y-o.x*p;this.addHalfVertex(t,o.x+o.y*u,o.y-o.x*u,b,!1,u,y),this.addHalfVertex(t,S,I,b,!0,-p,y),this.distance>sp/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(t,o,u,p,y,b))},va.prototype.addHalfVertex=function(t,o,u,p,y,b,S){var I=.5*(this.lineClips?this.scaledDistance*(sp-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t.x<<1)+(p?1:0),(t.y<<1)+(y?1:0),Math.round(63*o)+128,Math.round(63*u)+128,1+(b===0?0:b<0?-1:1)|(63&I)<<2,I>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var D=S.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,D),S.primitiveLength++),y?this.e2=D:this.e1=D},va.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},va.prototype.updateDistance=function(t,o){this.distance+=t.dist(o),this.updateScaledDistance()},yn("LineBucket",va,{omit:["layers","patternFeatures"]});var Gl=new ns({"line-cap":new Rn(pe.layout_line["line-cap"]),"line-join":new Cn(pe.layout_line["line-join"]),"line-miter-limit":new Rn(pe.layout_line["line-miter-limit"]),"line-round-limit":new Rn(pe.layout_line["line-round-limit"]),"line-sort-key":new Cn(pe.layout_line["line-sort-key"])}),Ao={paint:new ns({"line-opacity":new Cn(pe.paint_line["line-opacity"]),"line-color":new Cn(pe.paint_line["line-color"]),"line-translate":new Rn(pe.paint_line["line-translate"]),"line-translate-anchor":new Rn(pe.paint_line["line-translate-anchor"]),"line-width":new Cn(pe.paint_line["line-width"]),"line-gap-width":new Cn(pe.paint_line["line-gap-width"]),"line-offset":new Cn(pe.paint_line["line-offset"]),"line-blur":new Cn(pe.paint_line["line-blur"]),"line-dasharray":new ys(pe.paint_line["line-dasharray"]),"line-pattern":new df(pe.paint_line["line-pattern"]),"line-gradient":new lu(pe.paint_line["line-gradient"])}),layout:Gl},Ys=new(function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.possiblyEvaluate=function(u,p){return p=new Fi(Math.floor(p.zoom),{now:p.now,fadeDuration:p.fadeDuration,zoomHistory:p.zoomHistory,transition:p.transition}),t.prototype.possiblyEvaluate.call(this,u,p)},o.prototype.evaluate=function(u,p,y,b){return p=xt({},p,{zoom:Math.floor(p.zoom)}),t.prototype.evaluate.call(this,u,p,y,b)},o}(Cn))(Ao.paint.properties["line-width"].specification);Ys.useIntegerZoom=!0;var Yp=function(t){function o(u){t.call(this,u,Ao),this.gradientVersion=0}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._handleSpecialPaintPropertyUpdate=function(u){u==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof ds,this.gradientVersion=(this.gradientVersion+1)%Xe)},o.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},o.prototype.recalculate=function(u,p){t.prototype.recalculate.call(this,u,p),this.paint._values["line-floorwidth"]=Ys.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,u)},o.prototype.createBucket=function(u){return new va(u)},o.prototype.queryRadius=function(u){var p=u,y=up(Ou("line-width",this,p),Ou("line-gap-width",this,p)),b=Ou("line-offset",this,p);return y/2+Math.abs(b)+So(this.paint.get("line-translate"))},o.prototype.queryIntersectsFeature=function(u,p,y,b,S,I,D){var z=ka(u,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),I.angle,D),V=D/2*up(this.paint.get("line-width").evaluate(p,y),this.paint.get("line-gap-width").evaluate(p,y)),W=this.paint.get("line-offset").evaluate(p,y);return W&&(b=function(ee,se){for(var Me=[],Oe=new fe(0,0),Ye=0;Ye<ee.length;Ye++){for(var ze=ee[Ye],st=[],Tt=0;Tt<ze.length;Tt++){var Vt=ze[Tt],Xt=ze[Tt+1],lr=Tt===0?Oe:Vt.sub(ze[Tt-1])._unit()._perp(),Lr=Tt===ze.length-1?Oe:Xt.sub(Vt)._unit()._perp(),$r=lr._add(Lr)._unit();$r._mult(1/($r.x*Lr.x+$r.y*Lr.y)),st.push($r._mult(se)._add(Vt))}Me.push(st)}return Me}(b,W*D)),function(ee,se,Me){for(var Oe=0;Oe<se.length;Oe++){var Ye=se[Oe];if(ee.length>=3){for(var ze=0;ze<Ye.length;ze++)if(vu(ee,Ye[ze]))return!0}if(vo(ee,Ye,Me))return!0}return!1}(z,b,V)},o.prototype.isTileClipped=function(){return!0},o}(Go);function up(t,o){return o>0?o+2*t:t}var nh=Na([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Rd=Na([{name:"a_projected_pos",components:3,type:"Float32"}],4),Ld=(Na([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),Na([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),Dh=(Na([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),Na([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),qp=Na([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Kp(t,o,u){return t.sections.forEach(function(p){p.text=function(y,b,S){var I=b.layout.get("text-transform").evaluate(S,{});return I==="uppercase"?y=y.toLocaleUpperCase():I==="lowercase"&&(y=y.toLocaleLowerCase()),Fs.applyArabicShaping&&(y=Fs.applyArabicShaping(y)),y}(p.text,o,u)}),t}Na([{name:"triangle",components:3,type:"Uint16"}]),Na([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Na([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Na([{type:"Float32",name:"offsetX"}]),Na([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Af={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},lp=function(t,o,u,p,y){var b,S,I=8*y-p-1,D=(1<<I)-1,z=D>>1,V=-7,W=u?y-1:0,ee=u?-1:1,se=t[o+W];for(W+=ee,b=se&(1<<-V)-1,se>>=-V,V+=I;V>0;b=256*b+t[o+W],W+=ee,V-=8);for(S=b&(1<<-V)-1,b>>=-V,V+=p;V>0;S=256*S+t[o+W],W+=ee,V-=8);if(b===0)b=1-z;else{if(b===D)return S?NaN:1/0*(se?-1:1);S+=Math.pow(2,p),b-=z}return(se?-1:1)*S*Math.pow(2,b-p)},$p=function(t,o,u,p,y,b){var S,I,D,z=8*b-y-1,V=(1<<z)-1,W=V>>1,ee=y===23?Math.pow(2,-24)-Math.pow(2,-77):0,se=p?0:b-1,Me=p?1:-1,Oe=o<0||o===0&&1/o<0?1:0;for(o=Math.abs(o),isNaN(o)||o===1/0?(I=isNaN(o)?1:0,S=V):(S=Math.floor(Math.log(o)/Math.LN2),o*(D=Math.pow(2,-S))<1&&(S--,D*=2),(o+=S+W>=1?ee/D:ee*Math.pow(2,1-W))*D>=2&&(S++,D/=2),S+W>=V?(I=0,S=V):S+W>=1?(I=(o*D-1)*Math.pow(2,y),S+=W):(I=o*Math.pow(2,W-1)*Math.pow(2,y),S=0));y>=8;t[u+se]=255&I,se+=Me,I/=256,y-=8);for(S=S<<y|I,z+=y;z>0;t[u+se]=255&S,se+=Me,S/=256,z-=8);t[u+se-Me]|=128*Oe},wf=Sa;function Sa(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Sa.Varint=0,Sa.Fixed64=1,Sa.Bytes=2,Sa.Fixed32=5;var ih=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function Hl(t){return t.type===Sa.Bytes?t.readVarint()+t.pos:t.pos+1}function Tf(t,o,u){return u?4294967296*o+(t>>>0):4294967296*(o>>>0)+(t>>>0)}function cp(t,o,u){var p=o<=16383?1:o<=2097151?2:o<=268435455?3:Math.floor(Math.log(o)/(7*Math.LN2));u.realloc(p);for(var y=u.pos-1;y>=t;y--)u.buf[y+p]=u.buf[y]}function kd(t,o){for(var u=0;u<t.length;u++)o.writeVarint(t[u])}function B(t,o){for(var u=0;u<t.length;u++)o.writeSVarint(t[u])}function ge(t,o){for(var u=0;u<t.length;u++)o.writeFloat(t[u])}function Be(t,o){for(var u=0;u<t.length;u++)o.writeDouble(t[u])}function Dt(t,o){for(var u=0;u<t.length;u++)o.writeBoolean(t[u])}function sr(t,o){for(var u=0;u<t.length;u++)o.writeFixed32(t[u])}function kt(t,o){for(var u=0;u<t.length;u++)o.writeSFixed32(t[u])}function er(t,o){for(var u=0;u<t.length;u++)o.writeFixed64(t[u])}function hr(t,o){for(var u=0;u<t.length;u++)o.writeSFixed64(t[u])}function mr(t,o){return(t[o]|t[o+1]<<8|t[o+2]<<16)+16777216*t[o+3]}function xr(t,o,u){t[u]=o,t[u+1]=o>>>8,t[u+2]=o>>>16,t[u+3]=o>>>24}function Tr(t,o){return(t[o]|t[o+1]<<8|t[o+2]<<16)+(t[o+3]<<24)}function Rr(t,o,u){t===1&&u.readMessage(Gr,o)}function Gr(t,o,u){if(t===3){var p=u.readMessage(_r,{}),y=p.width,b=p.height,S=p.left,I=p.top,D=p.advance;o.push({id:p.id,bitmap:new nu({width:y+6,height:b+6},p.bitmap),metrics:{width:y,height:b,left:S,top:I,advance:D}})}}function _r(t,o,u){t===1?o.id=u.readVarint():t===2?o.bitmap=u.readBytes():t===3?o.width=u.readVarint():t===4?o.height=u.readVarint():t===5?o.left=u.readSVarint():t===6?o.top=u.readSVarint():t===7&&(o.advance=u.readVarint())}function Mr(t){for(var o=0,u=0,p=0,y=t;p<y.length;p+=1){var b=y[p];o+=b.w*b.h,u=Math.max(u,b.w)}t.sort(function(Oe,Ye){return Ye.h-Oe.h});for(var S=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(o/.95)),u),h:1/0}],I=0,D=0,z=0,V=t;z<V.length;z+=1)for(var W=V[z],ee=S.length-1;ee>=0;ee--){var se=S[ee];if(!(W.w>se.w||W.h>se.h)){if(W.x=se.x,W.y=se.y,D=Math.max(D,W.y+W.h),I=Math.max(I,W.x+W.w),W.w===se.w&&W.h===se.h){var Me=S.pop();ee<S.length&&(S[ee]=Me)}else W.h===se.h?(se.x+=W.w,se.w-=W.w):W.w===se.w?(se.y+=W.h,se.h-=W.h):(S.push({x:se.x+W.w,y:se.y,w:se.w-W.w,h:W.h}),se.y+=W.h,se.h-=W.h);break}}return{w:I,h:D,fill:o/(I*D)||0}}Sa.prototype={destroy:function(){this.buf=null},readFields:function(t,o,u){for(u=u||this.length;this.pos<u;){var p=this.readVarint(),y=p>>3,b=this.pos;this.type=7&p,t(y,o,this),this.pos===b&&this.skip(p)}return o},readMessage:function(t,o){return this.readFields(t,o,this.readVarint()+this.pos)},readFixed32:function(){var t=mr(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=Tr(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=mr(this.buf,this.pos)+4294967296*mr(this.buf,this.pos+4);return this.pos+=8,t},readSFixed64:function(){var t=mr(this.buf,this.pos)+4294967296*Tr(this.buf,this.pos+4);return this.pos+=8,t},readFloat:function(){var t=lp(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=lp(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var o,u,p=this.buf;return o=127&(u=p[this.pos++]),u<128?o:(o|=(127&(u=p[this.pos++]))<<7,u<128?o:(o|=(127&(u=p[this.pos++]))<<14,u<128?o:(o|=(127&(u=p[this.pos++]))<<21,u<128?o:function(y,b,S){var I,D,z=S.buf;if(I=(112&(D=z[S.pos++]))>>4,D<128||(I|=(127&(D=z[S.pos++]))<<3,D<128)||(I|=(127&(D=z[S.pos++]))<<10,D<128)||(I|=(127&(D=z[S.pos++]))<<17,D<128)||(I|=(127&(D=z[S.pos++]))<<24,D<128)||(I|=(1&(D=z[S.pos++]))<<31,D<128))return Tf(y,I,b);throw new Error("Expected varint not more than 10 bytes")}(o|=(15&(u=p[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,o=this.pos;return this.pos=t,t-o>=12&&ih?function(u,p,y){return ih.decode(u.subarray(p,y))}(this.buf,o,t):function(u,p,y){for(var b="",S=p;S<y;){var I,D,z,V=u[S],W=null,ee=V>239?4:V>223?3:V>191?2:1;if(S+ee>y)break;ee===1?V<128&&(W=V):ee===2?(192&(I=u[S+1]))==128&&(W=(31&V)<<6|63&I)<=127&&(W=null):ee===3?(D=u[S+2],(192&(I=u[S+1]))==128&&(192&D)==128&&((W=(15&V)<<12|(63&I)<<6|63&D)<=2047||W>=55296&&W<=57343)&&(W=null)):ee===4&&(D=u[S+2],z=u[S+3],(192&(I=u[S+1]))==128&&(192&D)==128&&(192&z)==128&&((W=(15&V)<<18|(63&I)<<12|(63&D)<<6|63&z)<=65535||W>=1114112)&&(W=null)),W===null?(W=65533,ee=1):W>65535&&(W-=65536,b+=String.fromCharCode(W>>>10&1023|55296),W=56320|1023&W),b+=String.fromCharCode(W),S+=ee}return b}(this.buf,o,t)},readBytes:function(){var t=this.readVarint()+this.pos,o=this.buf.subarray(this.pos,t);return this.pos=t,o},readPackedVarint:function(t,o){if(this.type!==Sa.Bytes)return t.push(this.readVarint(o));var u=Hl(this);for(t=t||[];this.pos<u;)t.push(this.readVarint(o));return t},readPackedSVarint:function(t){if(this.type!==Sa.Bytes)return t.push(this.readSVarint());var o=Hl(this);for(t=t||[];this.pos<o;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Sa.Bytes)return t.push(this.readBoolean());var o=Hl(this);for(t=t||[];this.pos<o;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Sa.Bytes)return t.push(this.readFloat());var o=Hl(this);for(t=t||[];this.pos<o;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Sa.Bytes)return t.push(this.readDouble());var o=Hl(this);for(t=t||[];this.pos<o;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Sa.Bytes)return t.push(this.readFixed32());var o=Hl(this);for(t=t||[];this.pos<o;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Sa.Bytes)return t.push(this.readSFixed32());var o=Hl(this);for(t=t||[];this.pos<o;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Sa.Bytes)return t.push(this.readFixed64());var o=Hl(this);for(t=t||[];this.pos<o;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Sa.Bytes)return t.push(this.readSFixed64());var o=Hl(this);for(t=t||[];this.pos<o;)t.push(this.readSFixed64());return t},skip:function(t){var o=7&t;if(o===Sa.Varint)for(;this.buf[this.pos++]>127;);else if(o===Sa.Bytes)this.pos=this.readVarint()+this.pos;else if(o===Sa.Fixed32)this.pos+=4;else{if(o!==Sa.Fixed64)throw new Error("Unimplemented type: "+o);this.pos+=8}},writeTag:function(t,o){this.writeVarint(t<<3|o)},realloc:function(t){for(var o=this.length||16;o<this.pos+t;)o*=2;if(o!==this.length){var u=new Uint8Array(o);u.set(this.buf),this.buf=u,this.length=o}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),xr(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),xr(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),xr(this.buf,-1&t,this.pos),xr(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),xr(this.buf,-1&t,this.pos),xr(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(o,u){var p,y;if(o>=0?(p=o%4294967296|0,y=o/4294967296|0):(y=~(-o/4294967296),4294967295^(p=~(-o%4294967296))?p=p+1|0:(p=0,y=y+1|0)),o>=18446744073709552e3||o<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");u.realloc(10),function(b,S,I){I.buf[I.pos++]=127&b|128,b>>>=7,I.buf[I.pos++]=127&b|128,b>>>=7,I.buf[I.pos++]=127&b|128,b>>>=7,I.buf[I.pos++]=127&b|128,I.buf[I.pos]=127&(b>>>=7)}(p,0,u),function(b,S){var I=(7&b)<<4;S.buf[S.pos++]|=I|((b>>>=3)?128:0),b&&(S.buf[S.pos++]=127&b|((b>>>=7)?128:0),b&&(S.buf[S.pos++]=127&b|((b>>>=7)?128:0),b&&(S.buf[S.pos++]=127&b|((b>>>=7)?128:0),b&&(S.buf[S.pos++]=127&b|((b>>>=7)?128:0),b&&(S.buf[S.pos++]=127&b)))))}(y,u)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var o=this.pos;this.pos=function(p,y,b){for(var S,I,D=0;D<y.length;D++){if((S=y.charCodeAt(D))>55295&&S<57344){if(!I){S>56319||D+1===y.length?(p[b++]=239,p[b++]=191,p[b++]=189):I=S;continue}if(S<56320){p[b++]=239,p[b++]=191,p[b++]=189,I=S;continue}S=I-55296<<10|S-56320|65536,I=null}else I&&(p[b++]=239,p[b++]=191,p[b++]=189,I=null);S<128?p[b++]=S:(S<2048?p[b++]=S>>6|192:(S<65536?p[b++]=S>>12|224:(p[b++]=S>>18|240,p[b++]=S>>12&63|128),p[b++]=S>>6&63|128),p[b++]=63&S|128)}return b}(this.buf,t,this.pos);var u=this.pos-o;u>=128&&cp(o,u,this),this.pos=o-1,this.writeVarint(u),this.pos+=u},writeFloat:function(t){this.realloc(4),$p(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),$p(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var o=t.length;this.writeVarint(o),this.realloc(o);for(var u=0;u<o;u++)this.buf[this.pos++]=t[u]},writeRawMessage:function(t,o){this.pos++;var u=this.pos;t(o,this);var p=this.pos-u;p>=128&&cp(u,p,this),this.pos=u-1,this.writeVarint(p),this.pos+=p},writeMessage:function(t,o,u){this.writeTag(t,Sa.Bytes),this.writeRawMessage(o,u)},writePackedVarint:function(t,o){o.length&&this.writeMessage(t,kd,o)},writePackedSVarint:function(t,o){o.length&&this.writeMessage(t,B,o)},writePackedBoolean:function(t,o){o.length&&this.writeMessage(t,Dt,o)},writePackedFloat:function(t,o){o.length&&this.writeMessage(t,ge,o)},writePackedDouble:function(t,o){o.length&&this.writeMessage(t,Be,o)},writePackedFixed32:function(t,o){o.length&&this.writeMessage(t,sr,o)},writePackedSFixed32:function(t,o){o.length&&this.writeMessage(t,kt,o)},writePackedFixed64:function(t,o){o.length&&this.writeMessage(t,er,o)},writePackedSFixed64:function(t,o){o.length&&this.writeMessage(t,hr,o)},writeBytesField:function(t,o){this.writeTag(t,Sa.Bytes),this.writeBytes(o)},writeFixed32Field:function(t,o){this.writeTag(t,Sa.Fixed32),this.writeFixed32(o)},writeSFixed32Field:function(t,o){this.writeTag(t,Sa.Fixed32),this.writeSFixed32(o)},writeFixed64Field:function(t,o){this.writeTag(t,Sa.Fixed64),this.writeFixed64(o)},writeSFixed64Field:function(t,o){this.writeTag(t,Sa.Fixed64),this.writeSFixed64(o)},writeVarintField:function(t,o){this.writeTag(t,Sa.Varint),this.writeVarint(o)},writeSVarintField:function(t,o){this.writeTag(t,Sa.Varint),this.writeSVarint(o)},writeStringField:function(t,o){this.writeTag(t,Sa.Bytes),this.writeString(o)},writeFloatField:function(t,o){this.writeTag(t,Sa.Fixed32),this.writeFloat(o)},writeDoubleField:function(t,o){this.writeTag(t,Sa.Fixed64),this.writeDouble(o)},writeBooleanField:function(t,o){this.writeVarintField(t,Boolean(o))}};var ut=function(t,o){var u=o.pixelRatio,p=o.version,y=o.stretchX,b=o.stretchY,S=o.content;this.paddedRect=t,this.pixelRatio=u,this.stretchX=y,this.stretchY=b,this.content=S,this.version=p},Gt={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};Gt.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},Gt.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},Gt.tlbr.get=function(){return this.tl.concat(this.br)},Gt.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(ut.prototype,Gt);var br=function(t,o){var u={},p={};this.haveRenderCallbacks=[];var y=[];this.addImages(t,u,y),this.addImages(o,p,y);var b=Mr(y),S=new go({width:b.w||1,height:b.h||1});for(var I in t){var D=t[I],z=u[I].paddedRect;go.copy(D.data,S,{x:0,y:0},{x:z.x+1,y:z.y+1},D.data)}for(var V in o){var W=o[V],ee=p[V].paddedRect,se=ee.x+1,Me=ee.y+1,Oe=W.data.width,Ye=W.data.height;go.copy(W.data,S,{x:0,y:0},{x:se,y:Me},W.data),go.copy(W.data,S,{x:0,y:Ye-1},{x:se,y:Me-1},{width:Oe,height:1}),go.copy(W.data,S,{x:0,y:0},{x:se,y:Me+Ye},{width:Oe,height:1}),go.copy(W.data,S,{x:Oe-1,y:0},{x:se-1,y:Me},{width:1,height:Ye}),go.copy(W.data,S,{x:0,y:0},{x:se+Oe,y:Me},{width:1,height:Ye})}this.image=S,this.iconPositions=u,this.patternPositions=p};br.prototype.addImages=function(t,o,u){for(var p in t){var y=t[p],b={x:0,y:0,w:y.data.width+2,h:y.data.height+2};u.push(b),o[p]=new ut(b,y),y.hasRenderCallback&&this.haveRenderCallbacks.push(p)}},br.prototype.patchUpdatedImages=function(t,o){for(var u in t.dispatchRenderCallbacks(this.haveRenderCallbacks),t.updatedImages)this.patchUpdatedImage(this.iconPositions[u],t.getImage(u),o),this.patchUpdatedImage(this.patternPositions[u],t.getImage(u),o)},br.prototype.patchUpdatedImage=function(t,o,u){if(t&&o&&t.version!==o.version){t.version=o.version;var p=t.tl;u.update(o.data,void 0,{x:p[0],y:p[1]})}},yn("ImagePosition",ut),yn("ImageAtlas",br);var Br={horizontal:1,vertical:2,horizontalOnly:3},cr=function(){this.scale=1,this.fontStack="",this.imageName=null};cr.forText=function(t,o){var u=new cr;return u.scale=t||1,u.fontStack=o,u},cr.forImage=function(t){var o=new cr;return o.imageName=t,o};var or=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function zr(t,o,u,p,y,b,S,I,D,z,V,W,ee,se,Me,Oe){var Ye,ze=or.fromFeature(t,y);W===Br.vertical&&ze.verticalizePunctuation();var st=Fs.processBidirectionalText,Tt=Fs.processStyledBidirectionalText;if(st&&ze.sections.length===1){Ye=[];for(var Vt=0,Xt=st(ze.toString(),Hr(ze,z,b,o,p,se,Me));Vt<Xt.length;Vt+=1){var lr=Xt[Vt],Lr=new or;Lr.text=lr,Lr.sections=ze.sections;for(var $r=0;$r<lr.length;$r++)Lr.sectionIndex.push(0);Ye.push(Lr)}}else if(Tt){Ye=[];for(var Zn=0,gn=Tt(ze.text,ze.sectionIndex,Hr(ze,z,b,o,p,se,Me));Zn<gn.length;Zn+=1){var Yn=gn[Zn],hn=new or;hn.text=Yn[0],hn.sectionIndex=Yn[1],hn.sections=ze.sections,Ye.push(hn)}}else Ye=function(Pn,Ai){for(var hi=[],ea=Pn.text,Hn=0,la=0,Wa=Ai;la<Wa.length;la+=1){var yo=Wa[la];hi.push(Pn.substring(Hn,yo)),Hn=yo}return Hn<ea.length&&hi.push(Pn.substring(Hn,ea.length)),hi}(ze,Hr(ze,z,b,o,p,se,Me));var ki=[],ai={positionedLines:ki,text:ze.toString(),top:V[1],bottom:V[1],left:V[0],right:V[0],writingMode:W,iconsInText:!1,verticalizable:!1};return function(Pn,Ai,hi,ea,Hn,la,Wa,yo,_o,ao,Mo,Po){for(var ma=0,zs=-17,cs=0,Us=0,xo=yo==="right"?1:yo==="left"?0:.5,fs=0,Yi=0,Da=Hn;Yi<Da.length;Yi+=1){var Ca=Da[Yi];Ca.trim();var ia=Ca.getMaxScale(),iu=24*(ia-1),Zs={positionedGlyphs:[],lineOffset:0};Pn.positionedLines[fs]=Zs;var $a=Zs.positionedGlyphs,G=0;if(Ca.length()){for(var Rs=0;Rs<Ca.length();Rs++){var ca=Ca.getSection(Rs),Wl=Ca.getSectionIndex(Rs),ku=Ca.getCharCode(Rs),Xl=0,Io=null,Yl=null,qs=null,uh=24,If=!(_o===Br.horizontal||!Mo&&!pf(ku)||Mo&&(Un[ku]||(Ec=ku,Kr.Arabic(Ec)||Kr["Arabic Supplement"](Ec)||Kr["Arabic Extended-A"](Ec)||Kr["Arabic Presentation Forms-A"](Ec)||Kr["Arabic Presentation Forms-B"](Ec))));if(ca.imageName){var lh=ea[ca.imageName];if(!lh)continue;qs=ca.imageName,Pn.iconsInText=Pn.iconsInText||!0,Yl=lh.paddedRect;var bc=lh.displaySize;ca.scale=24*ca.scale/Po,Xl=iu+(24-bc[1]*ca.scale),uh=(Io={width:bc[0],height:bc[1],left:1,top:-3,advance:If?bc[1]:bc[0]}).advance;var ch=If?bc[0]*ca.scale-24*ia:bc[1]*ca.scale-24*ia;ch>0&&ch>G&&(G=ch)}else{var hp=hi[ca.fontStack],Jc=hp&&hp[ku];if(Jc&&Jc.rect)Yl=Jc.rect,Io=Jc.metrics;else{var pp=Ai[ca.fontStack],Jp=pp&&pp[ku];if(!Jp)continue;Io=Jp.metrics}Xl=24*(ia-ca.scale)}If?(Pn.verticalizable=!0,$a.push({glyph:ku,imageName:qs,x:ma,y:zs+Xl,vertical:If,scale:ca.scale,fontStack:ca.fontStack,sectionIndex:Wl,metrics:Io,rect:Yl}),ma+=uh*ca.scale+ao):($a.push({glyph:ku,imageName:qs,x:ma,y:zs+Xl,vertical:If,scale:ca.scale,fontStack:ca.fontStack,sectionIndex:Wl,metrics:Io,rect:Yl}),ma+=Io.advance*ca.scale+ao)}$a.length!==0&&(cs=Math.max(ma-ao,cs),Ei($a,0,$a.length-1,xo,G)),ma=0;var dp=la*ia+G;Zs.lineOffset=Math.max(G,iu),zs+=dp,Us=Math.max(dp,Us),++fs}else zs+=la,++fs}var Ec,Bh=zs- -17,fh=Jr(Wa),ef=fh.horizontalAlign,Sc=fh.verticalAlign;(function(vp,mp,Nh,gp,ed,zh,yp,Cc,td){var $u,rd=(mp-Nh)*ed;$u=zh!==yp?-Cc*gp- -17:(-gp*td+.5)*yp;for(var Uh=0,_p=vp;Uh<_p.length;Uh+=1)for(var ql=0,Zh=_p[Uh].positionedGlyphs;ql<Zh.length;ql+=1){var hh=Zh[ql];hh.x+=rd,hh.y+=$u}})(Pn.positionedLines,xo,ef,Sc,cs,Us,la,Bh,Hn.length),Pn.top+=-Sc*Bh,Pn.bottom=Pn.top+Bh,Pn.left+=-ef*cs,Pn.right=Pn.left+cs}(ai,o,u,p,Ye,S,I,D,W,z,ee,Oe),!function(Pn){for(var Ai=0,hi=Pn;Ai<hi.length;Ai+=1)if(hi[Ai].positionedGlyphs.length!==0)return!1;return!0}(ki)&&ai}or.fromFeature=function(t,o){for(var u=new or,p=0;p<t.sections.length;p++){var y=t.sections[p];y.image?u.addImageSection(y):u.addTextSection(y,o)}return u},or.prototype.length=function(){return this.text.length},or.prototype.getSection=function(t){return this.sections[this.sectionIndex[t]]},or.prototype.getSectionIndex=function(t){return this.sectionIndex[t]},or.prototype.getCharCode=function(t){return this.text.charCodeAt(t)},or.prototype.verticalizePunctuation=function(){this.text=function(t){for(var o="",u=0;u<t.length;u++){var p=t.charCodeAt(u+1)||null,y=t.charCodeAt(u-1)||null;o+=p&&gl(p)&&!Af[t[u+1]]||y&&gl(y)&&!Af[t[u-1]]||!Af[t[u]]?t[u]:Af[t[u]]}return o}(this.text)},or.prototype.trim=function(){for(var t=0,o=0;o<this.text.length&&Un[this.text.charCodeAt(o)];o++)t++;for(var u=this.text.length,p=this.text.length-1;p>=0&&p>=t&&Un[this.text.charCodeAt(p)];p--)u--;this.text=this.text.substring(t,u),this.sectionIndex=this.sectionIndex.slice(t,u)},or.prototype.substring=function(t,o){var u=new or;return u.text=this.text.substring(t,o),u.sectionIndex=this.sectionIndex.slice(t,o),u.sections=this.sections,u},or.prototype.toString=function(){return this.text},or.prototype.getMaxScale=function(){var t=this;return this.sectionIndex.reduce(function(o,u){return Math.max(o,t.sections[u].scale)},0)},or.prototype.addTextSection=function(t,o){this.text+=t.text,this.sections.push(cr.forText(t.scale,t.fontStack||o));for(var u=this.sections.length-1,p=0;p<t.text.length;++p)this.sectionIndex.push(u)},or.prototype.addImageSection=function(t){var o=t.image?t.image.name:"";if(o.length!==0){var u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCharCode(u),this.sections.push(cr.forImage(o)),this.sectionIndex.push(this.sections.length-1)):Qe("Reached maximum number of images 6401")}else Qe("Can't add FormattedSection with an empty image.")},or.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var Un={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},tr={};function ir(t,o,u,p,y,b){if(o.imageName){var S=p[o.imageName];return S?S.displaySize[0]*o.scale*24/b+y:0}var I=u[o.fontStack],D=I&&I[t];return D?D.metrics.advance*o.scale+y:0}function Sn(t,o,u,p){var y=Math.pow(t-o,2);return p?t<o?y/2:2*y:y+Math.abs(u)*u}function Xr(t,o,u){var p=0;return t===10&&(p-=1e4),u&&(p+=150),t!==40&&t!==65288||(p+=50),o!==41&&o!==65289||(p+=50),p}function Sr(t,o,u,p,y,b){for(var S=null,I=Sn(o,u,y,b),D=0,z=p;D<z.length;D+=1){var V=z[D],W=Sn(o-V.x,u,y,b)+V.badness;W<=I&&(S=V,I=W)}return{index:t,x:o,priorBreak:S,badness:I}}function Hr(t,o,u,p,y,b,S){if(b!=="point")return[];if(!t)return[];for(var I,D=[],z=function(Ye,ze,st,Tt,Vt,Xt){for(var lr=0,Lr=0;Lr<Ye.length();Lr++){var $r=Ye.getSection(Lr);lr+=ir(Ye.getCharCode(Lr),$r,Tt,Vt,ze,Xt)}return lr/Math.max(1,Math.ceil(lr/st))}(t,o,u,p,y,S),V=t.text.indexOf("\u200B")>=0,W=0,ee=0;ee<t.length();ee++){var se=t.getSection(ee),Me=t.getCharCode(ee);if(Un[Me]||(W+=ir(Me,se,p,y,o,S)),ee<t.length()-1){var Oe=!((I=Me)<11904||!(Kr["Bopomofo Extended"](I)||Kr.Bopomofo(I)||Kr["CJK Compatibility Forms"](I)||Kr["CJK Compatibility Ideographs"](I)||Kr["CJK Compatibility"](I)||Kr["CJK Radicals Supplement"](I)||Kr["CJK Strokes"](I)||Kr["CJK Symbols and Punctuation"](I)||Kr["CJK Unified Ideographs Extension A"](I)||Kr["CJK Unified Ideographs"](I)||Kr["Enclosed CJK Letters and Months"](I)||Kr["Halfwidth and Fullwidth Forms"](I)||Kr.Hiragana(I)||Kr["Ideographic Description Characters"](I)||Kr["Kangxi Radicals"](I)||Kr["Katakana Phonetic Extensions"](I)||Kr.Katakana(I)||Kr["Vertical Forms"](I)||Kr["Yi Radicals"](I)||Kr["Yi Syllables"](I)));(tr[Me]||Oe||se.imageName)&&D.push(Sr(ee+1,W,z,D,Xr(Me,t.getCharCode(ee+1),Oe&&V),!1))}}return function Ye(ze){return ze?Ye(ze.priorBreak).concat(ze.index):[]}(Sr(t.length(),W,z,D,0,!0))}function Jr(t){var o=.5,u=.5;switch(t){case"right":case"top-right":case"bottom-right":o=1;break;case"left":case"top-left":case"bottom-left":o=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":u=1;break;case"top":case"top-right":case"top-left":u=0}return{horizontalAlign:o,verticalAlign:u}}function Ei(t,o,u,p,y){if(p||y)for(var b=t[u],S=(t[u].x+b.metrics.advance*b.scale)*p,I=o;I<=u;I++)t[I].x-=S,t[I].y+=y}function Gn(t,o,u,p,y,b){var S,I=t.image;if(I.content){var D=I.content,z=I.pixelRatio||1;S=[D[0]/z,D[1]/z,I.displaySize[0]-D[2]/z,I.displaySize[1]-D[3]/z]}var V,W,ee,se,Me=o.left*b,Oe=o.right*b;u==="width"||u==="both"?(se=y[0]+Me-p[3],W=y[0]+Oe+p[1]):W=(se=y[0]+(Me+Oe-I.displaySize[0])/2)+I.displaySize[0];var Ye=o.top*b,ze=o.bottom*b;return u==="height"||u==="both"?(V=y[1]+Ye-p[0],ee=y[1]+ze+p[2]):ee=(V=y[1]+(Ye+ze-I.displaySize[1])/2)+I.displaySize[1],{image:I,top:V,right:W,bottom:ee,left:se,collisionPadding:S}}tr[10]=!0,tr[32]=!0,tr[38]=!0,tr[40]=!0,tr[41]=!0,tr[43]=!0,tr[45]=!0,tr[47]=!0,tr[173]=!0,tr[183]=!0,tr[8203]=!0,tr[8208]=!0,tr[8211]=!0,tr[8231]=!0;var jr=function(t){function o(u,p,y,b){t.call(this,u,p),this.angle=y,b!==void 0&&(this.segment=b)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.clone=function(){return new o(this.x,this.y,this.angle,this.segment)},o}(fe);function en(t,o){var u=o.expression;if(u.kind==="constant")return{kind:"constant",layoutSize:u.evaluate(new Fi(t+1))};if(u.kind==="source")return{kind:"source"};for(var p=u.zoomStops,y=u.interpolationType,b=0;b<p.length&&p[b]<=t;)b++;for(var S=b=Math.max(0,b-1);S<p.length&&p[S]<t+1;)S++;S=Math.min(p.length-1,S);var I=p[b],D=p[S];return u.kind==="composite"?{kind:"composite",minZoom:I,maxZoom:D,interpolationType:y}:{kind:"camera",minZoom:I,maxZoom:D,minSize:u.evaluate(new Fi(I)),maxSize:u.evaluate(new Fi(D)),interpolationType:y}}function ni(t,o,u){var p=o.uSize,y=u.lowerSize;return t.kind==="source"?y/128:t.kind==="composite"?ga(y/128,u.upperSize/128,o.uSizeT):p}function ui(t,o){var u=0,p=0;if(t.kind==="constant")p=t.layoutSize;else if(t.kind!=="source"){var y=t.interpolationType,b=y?gt(_e.interpolationFactor(y,o,t.minZoom,t.maxZoom),0,1):0;t.kind==="camera"?p=ga(t.minSize,t.maxSize,b):u=b}return{uSizeT:u,uSize:p}}yn("Anchor",jr);var Ni=Object.freeze({__proto__:null,getSizeData:en,evaluateSizeForFeature:ni,evaluateSizeForZoom:ui,SIZE_PACK_FACTOR:128});function Ga(t,o,u,p,y){if(o.segment===void 0)return!0;for(var b=o,S=o.segment+1,I=0;I>-u/2;){if(--S<0)return!1;I-=t[S].dist(b),b=t[S]}I+=t[S].dist(t[S+1]),S++;for(var D=[],z=0;I<u/2;){var V=t[S],W=t[S+1];if(!W)return!1;var ee=t[S-1].angleTo(V)-V.angleTo(W);for(ee=Math.abs((ee+3*Math.PI)%(2*Math.PI)-Math.PI),D.push({distance:I,angleDelta:ee}),z+=ee;I-D[0].distance>p;)z-=D.shift().angleDelta;if(z>y)return!1;S++,I+=V.dist(W)}return!0}function no(t){for(var o=0,u=0;u<t.length-1;u++)o+=t[u].dist(t[u+1]);return o}function Zi(t,o,u){return t?.6*o*u:0}function ss(t,o){return Math.max(t?t.right-t.left:0,o?o.right-o.left:0)}function Ha(t,o,u,p,y,b){for(var S=Zi(u,y,b),I=ss(u,p)*b,D=0,z=no(t)/2,V=0;V<t.length-1;V++){var W=t[V],ee=t[V+1],se=W.dist(ee);if(D+se>z){var Me=(z-D)/se,Oe=ga(W.x,ee.x,Me),Ye=ga(W.y,ee.y,Me),ze=new jr(Oe,Ye,ee.angleTo(W),V);return ze._round(),!S||Ga(t,ze,I,S,o)?ze:void 0}D+=se}}function as(t,o,u,p,y,b,S,I,D){var z=Zi(p,b,S),V=ss(p,y),W=V*S,ee=t[0].x===0||t[0].x===D||t[0].y===0||t[0].y===D;return o-W<o/4&&(o=W+o/4),function se(Me,Oe,Ye,ze,st,Tt,Vt,Xt,lr){for(var Lr=Tt/2,$r=no(Me),Zn=0,gn=Oe-Ye,Yn=[],hn=0;hn<Me.length-1;hn++){for(var ki=Me[hn],ai=Me[hn+1],Pn=ki.dist(ai),Ai=ai.angleTo(ki);gn+Ye<Zn+Pn;){var hi=((gn+=Ye)-Zn)/Pn,ea=ga(ki.x,ai.x,hi),Hn=ga(ki.y,ai.y,hi);if(ea>=0&&ea<lr&&Hn>=0&&Hn<lr&&gn-Lr>=0&&gn+Lr<=$r){var la=new jr(ea,Hn,Ai,hn);la._round(),ze&&!Ga(Me,la,Tt,ze,st)||Yn.push(la)}}Zn+=Pn}return Xt||Yn.length||Vt||(Yn=se(Me,Zn/2,Ye,ze,st,Tt,Vt,!0,lr)),Yn}(t,ee?o/2*I%o:(V/2+2*b)*S*I%o,o,z,u,W,ee,!1,D)}function wo(t,o,u,p,y){for(var b=[],S=0;S<t.length;S++)for(var I=t[S],D=void 0,z=0;z<I.length-1;z++){var V=I[z],W=I[z+1];V.x<o&&W.x<o||(V.x<o?V=new fe(o,V.y+(o-V.x)/(W.x-V.x)*(W.y-V.y))._round():W.x<o&&(W=new fe(o,V.y+(o-V.x)/(W.x-V.x)*(W.y-V.y))._round()),V.y<u&&W.y<u||(V.y<u?V=new fe(V.x+(u-V.y)/(W.y-V.y)*(W.x-V.x),u)._round():W.y<u&&(W=new fe(V.x+(u-V.y)/(W.y-V.y)*(W.x-V.x),u)._round()),V.x>=p&&W.x>=p||(V.x>=p?V=new fe(p,V.y+(p-V.x)/(W.x-V.x)*(W.y-V.y))._round():W.x>=p&&(W=new fe(p,V.y+(p-V.x)/(W.x-V.x)*(W.y-V.y))._round()),V.y>=y&&W.y>=y||(V.y>=y?V=new fe(V.x+(y-V.y)/(W.y-V.y)*(W.x-V.x),y)._round():W.y>=y&&(W=new fe(V.x+(y-V.y)/(W.y-V.y)*(W.x-V.x),y)._round()),D&&V.equals(D[D.length-1])||b.push(D=[V]),D.push(W)))))}return b}function Wo(t,o,u,p){var y=[],b=t.image,S=b.pixelRatio,I=b.paddedRect.w-2,D=b.paddedRect.h-2,z=t.right-t.left,V=t.bottom-t.top,W=b.stretchX||[[0,I]],ee=b.stretchY||[[0,D]],se=function(ea,Hn){return ea+Hn[1]-Hn[0]},Me=W.reduce(se,0),Oe=ee.reduce(se,0),Ye=I-Me,ze=D-Oe,st=0,Tt=Me,Vt=0,Xt=Oe,lr=0,Lr=Ye,$r=0,Zn=ze;if(b.content&&p){var gn=b.content;st=Xo(W,0,gn[0]),Vt=Xo(ee,0,gn[1]),Tt=Xo(W,gn[0],gn[2]),Xt=Xo(ee,gn[1],gn[3]),lr=gn[0]-st,$r=gn[1]-Vt,Lr=gn[2]-gn[0]-Tt,Zn=gn[3]-gn[1]-Xt}var Yn=function(ea,Hn,la,Wa){var yo=io(ea.stretch-st,Tt,z,t.left),_o=Si(ea.fixed-lr,Lr,ea.stretch,Me),ao=io(Hn.stretch-Vt,Xt,V,t.top),Mo=Si(Hn.fixed-$r,Zn,Hn.stretch,Oe),Po=io(la.stretch-st,Tt,z,t.left),ma=Si(la.fixed-lr,Lr,la.stretch,Me),zs=io(Wa.stretch-Vt,Xt,V,t.top),cs=Si(Wa.fixed-$r,Zn,Wa.stretch,Oe),Us=new fe(yo,ao),xo=new fe(Po,ao),fs=new fe(Po,zs),Yi=new fe(yo,zs),Da=new fe(_o/S,Mo/S),Ca=new fe(ma/S,cs/S),ia=o*Math.PI/180;if(ia){var iu=Math.sin(ia),Zs=Math.cos(ia),$a=[Zs,-iu,iu,Zs];Us._matMult($a),xo._matMult($a),Yi._matMult($a),fs._matMult($a)}var G=ea.stretch+ea.fixed,Rs=Hn.stretch+Hn.fixed;return{tl:Us,tr:xo,bl:Yi,br:fs,tex:{x:b.paddedRect.x+1+G,y:b.paddedRect.y+1+Rs,w:la.stretch+la.fixed-G,h:Wa.stretch+Wa.fixed-Rs},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Da,pixelOffsetBR:Ca,minFontScaleX:Lr/S/z,minFontScaleY:Zn/S/V,isSDF:u}};if(p&&(b.stretchX||b.stretchY))for(var hn=bs(W,Ye,Me),ki=bs(ee,ze,Oe),ai=0;ai<hn.length-1;ai++)for(var Pn=hn[ai],Ai=hn[ai+1],hi=0;hi<ki.length-1;hi++)y.push(Yn(Pn,ki[hi],Ai,ki[hi+1]));else y.push(Yn({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:I+1},{fixed:0,stretch:D+1}));return y}function Xo(t,o,u){for(var p=0,y=0,b=t;y<b.length;y+=1){var S=b[y];p+=Math.max(o,Math.min(u,S[1]))-Math.max(o,Math.min(u,S[0]))}return p}function bs(t,o,u){for(var p=[{fixed:-1,stretch:0}],y=0,b=t;y<b.length;y+=1){var S=b[y],I=S[0],D=S[1],z=p[p.length-1];p.push({fixed:I-z.stretch,stretch:z.stretch}),p.push({fixed:I-z.stretch,stretch:z.stretch+(D-I)})}return p.push({fixed:o+1,stretch:u}),p}function io(t,o,u,p){return t/o*u+p}function Si(t,o,u,p){return t-o*u/p}var Yo=function(t,o,u,p,y,b,S,I,D,z){if(this.boxStartIndex=t.length,D){var V=b.top,W=b.bottom,ee=b.collisionPadding;ee&&(V-=ee[1],W+=ee[3]);var se=W-V;se>0&&(se=Math.max(10,se),this.circleDiameter=se)}else{var Me=b.top*S-I,Oe=b.bottom*S+I,Ye=b.left*S-I,ze=b.right*S+I,st=b.collisionPadding;if(st&&(Ye-=st[0]*S,Me-=st[1]*S,ze+=st[2]*S,Oe+=st[3]*S),z){var Tt=new fe(Ye,Me),Vt=new fe(ze,Me),Xt=new fe(Ye,Oe),lr=new fe(ze,Oe),Lr=z*Math.PI/180;Tt._rotate(Lr),Vt._rotate(Lr),Xt._rotate(Lr),lr._rotate(Lr),Ye=Math.min(Tt.x,Vt.x,Xt.x,lr.x),ze=Math.max(Tt.x,Vt.x,Xt.x,lr.x),Me=Math.min(Tt.y,Vt.y,Xt.y,lr.y),Oe=Math.max(Tt.y,Vt.y,Xt.y,lr.y)}t.emplaceBack(o.x,o.y,Ye,Me,ze,Oe,u,p,y)}this.boxEndIndex=t.length},ra=function(t,o){if(t===void 0&&(t=[]),o===void 0&&(o=us),this.data=t,this.length=this.data.length,this.compare=o,this.length>0)for(var u=(this.length>>1)-1;u>=0;u--)this._down(u)};function us(t,o){return t<o?-1:t>o?1:0}function oi(t,o,u){o===void 0&&(o=1),u===void 0&&(u=!1);for(var p=1/0,y=1/0,b=-1/0,S=-1/0,I=t[0],D=0;D<I.length;D++){var z=I[D];(!D||z.x<p)&&(p=z.x),(!D||z.y<y)&&(y=z.y),(!D||z.x>b)&&(b=z.x),(!D||z.y>S)&&(S=z.y)}var V=Math.min(b-p,S-y),W=V/2,ee=new ra([],zi);if(V===0)return new fe(p,y);for(var se=p;se<b;se+=V)for(var Me=y;Me<S;Me+=V)ee.push(new ua(se+W,Me+W,W,t));for(var Oe=function(st){for(var Tt=0,Vt=0,Xt=0,lr=st[0],Lr=0,$r=lr.length,Zn=$r-1;Lr<$r;Zn=Lr++){var gn=lr[Lr],Yn=lr[Zn],hn=gn.x*Yn.y-Yn.x*gn.y;Vt+=(gn.x+Yn.x)*hn,Xt+=(gn.y+Yn.y)*hn,Tt+=3*hn}return new ua(Vt/Tt,Xt/Tt,0,st)}(t),Ye=ee.length;ee.length;){var ze=ee.pop();(ze.d>Oe.d||!Oe.d)&&(Oe=ze,u&&console.log("found best %d after %d probes",Math.round(1e4*ze.d)/1e4,Ye)),ze.max-Oe.d<=o||(ee.push(new ua(ze.p.x-(W=ze.h/2),ze.p.y-W,W,t)),ee.push(new ua(ze.p.x+W,ze.p.y-W,W,t)),ee.push(new ua(ze.p.x-W,ze.p.y+W,W,t)),ee.push(new ua(ze.p.x+W,ze.p.y+W,W,t)),Ye+=4)}return u&&(console.log("num probes: "+Ye),console.log("best distance: "+Oe.d)),Oe.p}function zi(t,o){return o.max-t.max}function ua(t,o,u,p){this.p=new fe(t,o),this.h=u,this.d=function(y,b){for(var S=!1,I=1/0,D=0;D<b.length;D++)for(var z=b[D],V=0,W=z.length,ee=W-1;V<W;ee=V++){var se=z[V],Me=z[ee];se.y>y.y!=Me.y>y.y&&y.x<(Me.x-se.x)*(y.y-se.y)/(Me.y-se.y)+se.x&&(S=!S),I=Math.min(I,du(y,se,Me))}return(S?1:-1)*Math.sqrt(I)}(this.p,p),this.max=this.d+this.h*Math.SQRT2}ra.prototype.push=function(t){this.data.push(t),this.length++,this._up(this.length-1)},ra.prototype.pop=function(){if(this.length!==0){var t=this.data[0],o=this.data.pop();return this.length--,this.length>0&&(this.data[0]=o,this._down(0)),t}},ra.prototype.peek=function(){return this.data[0]},ra.prototype._up=function(t){for(var o=this.data,u=this.compare,p=o[t];t>0;){var y=t-1>>1,b=o[y];if(u(p,b)>=0)break;o[t]=b,t=y}o[t]=p},ra.prototype._down=function(t){for(var o=this.data,u=this.compare,p=this.length>>1,y=o[t];t<p;){var b=1+(t<<1),S=o[b],I=b+1;if(I<this.length&&u(o[I],S)<0&&(b=I,S=o[I]),u(S,y)>=0)break;o[t]=S,t=b}o[t]=y};var To=Number.POSITIVE_INFINITY;function wl(t,o){return o[1]!==To?function(u,p,y){var b=0,S=0;switch(p=Math.abs(p),y=Math.abs(y),u){case"top-right":case"top-left":case"top":S=y-7;break;case"bottom-right":case"bottom-left":case"bottom":S=7-y}switch(u){case"top-right":case"bottom-right":case"right":b=-p;break;case"top-left":case"bottom-left":case"left":b=p}return[b,S]}(t,o[0],o[1]):function(u,p){var y=0,b=0;p<0&&(p=0);var S=p/Math.sqrt(2);switch(u){case"top-right":case"top-left":b=S-7;break;case"bottom-right":case"bottom-left":b=7-S;break;case"bottom":b=7-p;break;case"top":b=p-7}switch(u){case"top-right":case"bottom-right":y=-S;break;case"top-left":case"bottom-left":y=S;break;case"left":y=p;break;case"right":y=-p}return[y,b]}(t,o[0])}function Te(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Ut(t,o,u,p,y,b,S,I,D,z,V,W,ee,se,Me){var Oe=function(Vt,Xt,lr,Lr,$r,Zn,gn,Yn){for(var hn=Lr.layout.get("text-rotate").evaluate(Zn,{})*Math.PI/180,ki=[],ai=0,Pn=Xt.positionedLines;ai<Pn.length;ai+=1)for(var Ai=Pn[ai],hi=0,ea=Ai.positionedGlyphs;hi<ea.length;hi+=1){var Hn=ea[hi];if(Hn.rect){var la=Hn.rect||{},Wa=4,yo=!0,_o=1,ao=0,Mo=($r||Yn)&&Hn.vertical,Po=Hn.metrics.advance*Hn.scale/2;if(Yn&&Xt.verticalizable&&(ao=Ai.lineOffset/2-(Hn.imageName?-(24-Hn.metrics.width*Hn.scale)/2:24*(Hn.scale-1))),Hn.imageName){var ma=gn[Hn.imageName];yo=ma.sdf,Wa=1/(_o=ma.pixelRatio)}var zs=$r?[Hn.x+Po,Hn.y]:[0,0],cs=$r?[0,0]:[Hn.x+Po+lr[0],Hn.y+lr[1]-ao],Us=[0,0];Mo&&(Us=cs,cs=[0,0]);var xo=(Hn.metrics.left-Wa)*Hn.scale-Po+cs[0],fs=(-Hn.metrics.top-Wa)*Hn.scale+cs[1],Yi=xo+la.w*Hn.scale/_o,Da=fs+la.h*Hn.scale/_o,Ca=new fe(xo,fs),ia=new fe(Yi,fs),iu=new fe(xo,Da),Zs=new fe(Yi,Da);if(Mo){var $a=new fe(-Po,Po- -17),G=-Math.PI/2,Rs=12-Po,ca=new fe(22-Rs,-(Hn.imageName?Rs:0)),Wl=new(Function.prototype.bind.apply(fe,[null].concat(Us)));Ca._rotateAround(G,$a)._add(ca)._add(Wl),ia._rotateAround(G,$a)._add(ca)._add(Wl),iu._rotateAround(G,$a)._add(ca)._add(Wl),Zs._rotateAround(G,$a)._add(ca)._add(Wl)}if(hn){var ku=Math.sin(hn),Xl=Math.cos(hn),Io=[Xl,-ku,ku,Xl];Ca._matMult(Io),ia._matMult(Io),iu._matMult(Io),Zs._matMult(Io)}var Yl=new fe(0,0),qs=new fe(0,0);ki.push({tl:Ca,tr:ia,bl:iu,br:Zs,tex:la,writingMode:Xt.writingMode,glyphOffset:zs,sectionIndex:Hn.sectionIndex,isSDF:yo,pixelOffsetTL:Yl,pixelOffsetBR:qs,minFontScaleX:0,minFontScaleY:0})}}return ki}(0,u,I,y,b,S,p,t.allowVerticalPlacement),Ye=t.textSizeData,ze=null;Ye.kind==="source"?(ze=[128*y.layout.get("text-size").evaluate(S,{})])[0]>32640&&Qe(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):Ye.kind==="composite"&&((ze=[128*se.compositeTextSizes[0].evaluate(S,{},Me),128*se.compositeTextSizes[1].evaluate(S,{},Me)])[0]>32640||ze[1]>32640)&&Qe(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),t.addSymbols(t.text,Oe,ze,I,b,S,z,o,D.lineStartIndex,D.lineLength,ee,Me);for(var st=0,Tt=V;st<Tt.length;st+=1)W[Tt[st]]=t.text.placedSymbolArray.length-1;return 4*Oe.length}function St(t){for(var o in t)return t[o];return null}function mn(t,o,u,p){var y=t.compareText;if(o in y){for(var b=y[o],S=b.length-1;S>=0;S--)if(p.dist(b[S])<u)return!0}else y[o]=[];return y[o].push(p),!1}var Hi=gu.VectorTileFeature.types,Se=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ue(t,o,u,p,y,b,S,I,D,z,V,W,ee){var se=I?Math.min(32640,Math.round(I[0])):0,Me=I?Math.min(32640,Math.round(I[1])):0;t.emplaceBack(o,u,Math.round(32*p),Math.round(32*y),b,S,(se<<1)+(D?1:0),Me,16*z,16*V,256*W,256*ee)}function Ge(t,o,u){t.emplaceBack(o.x,o.y,u),t.emplaceBack(o.x,o.y,u),t.emplaceBack(o.x,o.y,u),t.emplaceBack(o.x,o.y,u)}function lt(t){for(var o=0,u=t.sections;o<u.length;o+=1)if(Uc(u[o].text))return!0;return!1}var Lt=function(t){this.layoutVertexArray=new mf,this.indexArray=new al,this.programConfigurations=t,this.segments=new he,this.dynamicLayoutVertexArray=new Nl,this.opacityVertexArray=new jc,this.placedSymbolArray=new d};Lt.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},Lt.prototype.upload=function(t,o,u,p){this.isEmpty()||(u&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,nh.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,o),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Rd.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,Se,!0),this.opacityVertexBuffer.itemSize=1),(u||p)&&this.programConfigurations.upload(t))},Lt.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},yn("SymbolBuffers",Lt);var Ke=function(t,o,u){this.layoutVertexArray=new t,this.layoutAttributes=o,this.indexArray=new u,this.segments=new he,this.collisionVertexArray=new Vc};Ke.prototype.upload=function(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Ld.members,!0)},Ke.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},yn("CollisionBuffers",Ke);var Fe=function(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(b){return b.id}),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=is([]),this.placementViewportMatrix=is([]);var o=this.layers[0]._unevaluatedLayout._values;this.textSizeData=en(this.zoom,o["text-size"]),this.iconSizeData=en(this.zoom,o["icon-size"]);var u=this.layers[0].layout,p=u.get("symbol-sort-key"),y=u.get("symbol-z-order");this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey=y!=="viewport-y"&&p.constantOr(1)!==void 0,this.sortFeaturesByY=(y==="viewport-y"||y==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,u.get("symbol-placement")==="point"&&(this.writingModes=u.get("text-writing-mode").map(function(b){return Br[b]})),this.stateDependentLayerIds=this.layers.filter(function(b){return b.isStateDependent()}).map(function(b){return b.id}),this.sourceID=t.sourceID};Fe.prototype.createArrays=function(){this.text=new Lt(new Kn(this.layers,this.zoom,function(t){return/^text/.test(t)})),this.icon=new Lt(new Kn(this.layers,this.zoom,function(t){return/^icon/.test(t)})),this.glyphOffsetArray=new P,this.lineVertexArray=new L,this.symbolInstances=new w},Fe.prototype.calculateGlyphDependencies=function(t,o,u,p,y){for(var b=0;b<t.length;b++)if(o[t.charCodeAt(b)]=!0,(u||p)&&y){var S=Af[t.charAt(b)];S&&(o[S.charCodeAt(0)]=!0)}},Fe.prototype.populate=function(t,o,u){var p=this.layers[0],y=p.layout,b=y.get("text-font"),S=y.get("text-field"),I=y.get("icon-image"),D=(S.value.kind!=="constant"||S.value.value instanceof Ir&&!S.value.value.isEmpty()||S.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),z=I.value.kind!=="constant"||!!I.value.value||Object.keys(I.parameters).length>0,V=y.get("symbol-sort-key");if(this.features=[],D||z){for(var W=o.iconDependencies,ee=o.glyphDependencies,se=o.availableImages,Me=new Fi(this.zoom),Oe=0,Ye=t;Oe<Ye.length;Oe+=1){var ze=Ye[Oe],st=ze.feature,Tt=ze.id,Vt=ze.index,Xt=ze.sourceLayerIndex,lr=p._featureFilter.needGeometry,Lr=co(st,lr);if(p._featureFilter.filter(Me,Lr,u)){lr||(Lr.geometry=za(st));var $r=void 0;if(D){var Zn=p.getValueAndResolveTokens("text-field",Lr,u,se),gn=Ir.factory(Zn);lt(gn)&&(this.hasRTLText=!0),(!this.hasRTLText||Hf()==="unavailable"||this.hasRTLText&&Fs.isParsed())&&($r=Kp(gn,p,Lr))}var Yn=void 0;if(z){var hn=p.getValueAndResolveTokens("icon-image",Lr,u,se);Yn=hn instanceof wr?hn:wr.fromString(hn)}if($r||Yn){var ki=this.sortFeaturesByKey?V.evaluate(Lr,{},u):void 0;if(this.features.push({id:Tt,text:$r,icon:Yn,index:Vt,sourceLayerIndex:Xt,geometry:Lr.geometry,properties:st.properties,type:Hi[st.type],sortKey:ki}),Yn&&(W[Yn.name]=!0),$r){var ai=b.evaluate(Lr,{},u).join(","),Pn=y.get("text-rotation-alignment")==="map"&&y.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Br.vertical)>=0;for(var Ai=0,hi=$r.sections;Ai<hi.length;Ai+=1){var ea=hi[Ai];if(ea.image)W[ea.image.name]=!0;else{var Hn=zc($r.toString()),la=ea.fontStack||ai,Wa=ee[la]=ee[la]||{};this.calculateGlyphDependencies(ea.text,Wa,Pn,this.allowVerticalPlacement,Hn)}}}}}}y.get("symbol-placement")==="line"&&(this.features=function(yo){var _o={},ao={},Mo=[],Po=0;function ma($a){Mo.push(yo[$a]),Po++}function zs($a,G,Rs){var ca=ao[$a];return delete ao[$a],ao[G]=ca,Mo[ca].geometry[0].pop(),Mo[ca].geometry[0]=Mo[ca].geometry[0].concat(Rs[0]),ca}function cs($a,G,Rs){var ca=_o[G];return delete _o[G],_o[$a]=ca,Mo[ca].geometry[0].shift(),Mo[ca].geometry[0]=Rs[0].concat(Mo[ca].geometry[0]),ca}function Us($a,G,Rs){var ca=Rs?G[0][G[0].length-1]:G[0][0];return $a+":"+ca.x+":"+ca.y}for(var xo=0;xo<yo.length;xo++){var fs=yo[xo],Yi=fs.geometry,Da=fs.text?fs.text.toString():null;if(Da){var Ca=Us(Da,Yi),ia=Us(Da,Yi,!0);if(Ca in ao&&ia in _o&&ao[Ca]!==_o[ia]){var iu=cs(Ca,ia,Yi),Zs=zs(Ca,ia,Mo[iu].geometry);delete _o[Ca],delete ao[ia],ao[Us(Da,Mo[Zs].geometry,!0)]=Zs,Mo[iu].geometry=null}else Ca in ao?zs(Ca,ia,Yi):ia in _o?cs(Ca,ia,Yi):(ma(xo),_o[Ca]=Po-1,ao[ia]=Po-1)}else ma(xo)}return Mo.filter(function($a){return $a.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(yo,_o){return yo.sortKey-_o.sortKey})}},Fe.prototype.update=function(t,o,u){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,o,this.layers,u),this.icon.programConfigurations.updatePaintArrays(t,o,this.layers,u))},Fe.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},Fe.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},Fe.prototype.upload=function(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},Fe.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},Fe.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},Fe.prototype.addToLineVertexArray=function(t,o){var u=this.lineVertexArray.length;if(t.segment!==void 0){for(var p=t.dist(o[t.segment+1]),y=t.dist(o[t.segment]),b={},S=t.segment+1;S<o.length;S++)b[S]={x:o[S].x,y:o[S].y,tileUnitDistanceFromAnchor:p},S<o.length-1&&(p+=o[S+1].dist(o[S]));for(var I=t.segment||0;I>=0;I--)b[I]={x:o[I].x,y:o[I].y,tileUnitDistanceFromAnchor:y},I>0&&(y+=o[I-1].dist(o[I]));for(var D=0;D<o.length;D++){var z=b[D];this.lineVertexArray.emplaceBack(z.x,z.y,z.tileUnitDistanceFromAnchor)}}return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}},Fe.prototype.addSymbols=function(t,o,u,p,y,b,S,I,D,z,V,W){for(var ee=t.indexArray,se=t.layoutVertexArray,Me=t.segments.prepareSegment(4*o.length,se,ee,this.canOverlap?b.sortKey:void 0),Oe=this.glyphOffsetArray.length,Ye=Me.vertexLength,ze=this.allowVerticalPlacement&&S===Br.vertical?Math.PI/2:0,st=b.text&&b.text.sections,Tt=0;Tt<o.length;Tt++){var Vt=o[Tt],Xt=Vt.tl,lr=Vt.tr,Lr=Vt.bl,$r=Vt.br,Zn=Vt.tex,gn=Vt.pixelOffsetTL,Yn=Vt.pixelOffsetBR,hn=Vt.minFontScaleX,ki=Vt.minFontScaleY,ai=Vt.glyphOffset,Pn=Vt.isSDF,Ai=Vt.sectionIndex,hi=Me.vertexLength,ea=ai[1];ue(se,I.x,I.y,Xt.x,ea+Xt.y,Zn.x,Zn.y,u,Pn,gn.x,gn.y,hn,ki),ue(se,I.x,I.y,lr.x,ea+lr.y,Zn.x+Zn.w,Zn.y,u,Pn,Yn.x,gn.y,hn,ki),ue(se,I.x,I.y,Lr.x,ea+Lr.y,Zn.x,Zn.y+Zn.h,u,Pn,gn.x,Yn.y,hn,ki),ue(se,I.x,I.y,$r.x,ea+$r.y,Zn.x+Zn.w,Zn.y+Zn.h,u,Pn,Yn.x,Yn.y,hn,ki),Ge(t.dynamicLayoutVertexArray,I,ze),ee.emplaceBack(hi,hi+1,hi+2),ee.emplaceBack(hi+1,hi+2,hi+3),Me.vertexLength+=4,Me.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ai[0]),Tt!==o.length-1&&Ai===o[Tt+1].sectionIndex||t.programConfigurations.populatePaintArrays(se.length,b,b.index,{},W,st&&st[Ai])}t.placedSymbolArray.emplaceBack(I.x,I.y,Oe,this.glyphOffsetArray.length-Oe,Ye,D,z,I.segment,u?u[0]:0,u?u[1]:0,p[0],p[1],S,0,!1,0,V)},Fe.prototype._addCollisionDebugVertex=function(t,o,u,p,y,b){return o.emplaceBack(0,0),t.emplaceBack(u.x,u.y,p,y,Math.round(b.x),Math.round(b.y))},Fe.prototype.addCollisionDebugVertices=function(t,o,u,p,y,b,S){var I=y.segments.prepareSegment(4,y.layoutVertexArray,y.indexArray),D=I.vertexLength,z=y.layoutVertexArray,V=y.collisionVertexArray,W=S.anchorX,ee=S.anchorY;this._addCollisionDebugVertex(z,V,b,W,ee,new fe(t,o)),this._addCollisionDebugVertex(z,V,b,W,ee,new fe(u,o)),this._addCollisionDebugVertex(z,V,b,W,ee,new fe(u,p)),this._addCollisionDebugVertex(z,V,b,W,ee,new fe(t,p)),I.vertexLength+=4;var se=y.indexArray;se.emplaceBack(D,D+1),se.emplaceBack(D+1,D+2),se.emplaceBack(D+2,D+3),se.emplaceBack(D+3,D),I.primitiveLength+=4},Fe.prototype.addDebugCollisionBoxes=function(t,o,u,p){for(var y=t;y<o;y++){var b=this.collisionBoxArray.get(y);this.addCollisionDebugVertices(b.x1,b.y1,b.x2,b.y2,p?this.textCollisionBox:this.iconCollisionBox,b.anchorPoint,u)}},Fe.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Ke(Iu,Dh.members,_l),this.iconCollisionBox=new Ke(Iu,Dh.members,_l);for(var t=0;t<this.symbolInstances.length;t++){var o=this.symbolInstances.get(t);this.addDebugCollisionBoxes(o.textBoxStartIndex,o.textBoxEndIndex,o,!0),this.addDebugCollisionBoxes(o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o,!0),this.addDebugCollisionBoxes(o.iconBoxStartIndex,o.iconBoxEndIndex,o,!1),this.addDebugCollisionBoxes(o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o,!1)}},Fe.prototype._deserializeCollisionBoxesForSymbol=function(t,o,u,p,y,b,S,I,D){for(var z={},V=o;V<u;V++){var W=t.get(V);z.textBox={x1:W.x1,y1:W.y1,x2:W.x2,y2:W.y2,anchorPointX:W.anchorPointX,anchorPointY:W.anchorPointY},z.textFeatureIndex=W.featureIndex;break}for(var ee=p;ee<y;ee++){var se=t.get(ee);z.verticalTextBox={x1:se.x1,y1:se.y1,x2:se.x2,y2:se.y2,anchorPointX:se.anchorPointX,anchorPointY:se.anchorPointY},z.verticalTextFeatureIndex=se.featureIndex;break}for(var Me=b;Me<S;Me++){var Oe=t.get(Me);z.iconBox={x1:Oe.x1,y1:Oe.y1,x2:Oe.x2,y2:Oe.y2,anchorPointX:Oe.anchorPointX,anchorPointY:Oe.anchorPointY},z.iconFeatureIndex=Oe.featureIndex;break}for(var Ye=I;Ye<D;Ye++){var ze=t.get(Ye);z.verticalIconBox={x1:ze.x1,y1:ze.y1,x2:ze.x2,y2:ze.y2,anchorPointX:ze.anchorPointX,anchorPointY:ze.anchorPointY},z.verticalIconFeatureIndex=ze.featureIndex;break}return z},Fe.prototype.deserializeCollisionBoxes=function(t){this.collisionArrays=[];for(var o=0;o<this.symbolInstances.length;o++){var u=this.symbolInstances.get(o);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}},Fe.prototype.hasTextData=function(){return this.text.segments.get().length>0},Fe.prototype.hasIconData=function(){return this.icon.segments.get().length>0},Fe.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},Fe.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},Fe.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},Fe.prototype.addIndicesForPlacedSymbol=function(t,o){for(var u=t.placedSymbolArray.get(o),p=u.vertexStartIndex+4*u.numGlyphs,y=u.vertexStartIndex;y<p;y+=4)t.indexArray.emplaceBack(y,y+1,y+2),t.indexArray.emplaceBack(y+1,y+2,y+3)},Fe.prototype.getSortedSymbolIndexes=function(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var o=Math.sin(t),u=Math.cos(t),p=[],y=[],b=[],S=0;S<this.symbolInstances.length;++S){b.push(S);var I=this.symbolInstances.get(S);p.push(0|Math.round(o*I.anchorX+u*I.anchorY)),y.push(I.featureIndex)}return b.sort(function(D,z){return p[D]-p[z]||y[z]-y[D]}),b},Fe.prototype.addToSortKeyRanges=function(t,o){var u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===o?u.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:o,symbolInstanceStart:t,symbolInstanceEnd:t+1})},Fe.prototype.sortFeatures=function(t){var o=this;if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var u=0,p=this.symbolInstanceIndexes;u<p.length;u+=1){var y=this.symbolInstances.get(p[u]);this.featureSortOrder.push(y.featureIndex),[y.rightJustifiedTextSymbolIndex,y.centerJustifiedTextSymbolIndex,y.leftJustifiedTextSymbolIndex].forEach(function(b,S,I){b>=0&&I.indexOf(b)===S&&o.addIndicesForPlacedSymbol(o.text,b)}),y.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,y.verticalPlacedTextSymbolIndex),y.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,y.placedIconSymbolIndex),y.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,y.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},yn("SymbolBucket",Fe,{omit:["layers","collisionBoxArray","features","compareText"]}),Fe.MAX_GLYPHS=65535,Fe.addDynamicAttributes=Ge;var nt=new ns({"symbol-placement":new Rn(pe.layout_symbol["symbol-placement"]),"symbol-spacing":new Rn(pe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Rn(pe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Cn(pe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Rn(pe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Rn(pe.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Rn(pe.layout_symbol["icon-ignore-placement"]),"icon-optional":new Rn(pe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Rn(pe.layout_symbol["icon-rotation-alignment"]),"icon-size":new Cn(pe.layout_symbol["icon-size"]),"icon-text-fit":new Rn(pe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Rn(pe.layout_symbol["icon-text-fit-padding"]),"icon-image":new Cn(pe.layout_symbol["icon-image"]),"icon-rotate":new Cn(pe.layout_symbol["icon-rotate"]),"icon-padding":new Rn(pe.layout_symbol["icon-padding"]),"icon-keep-upright":new Rn(pe.layout_symbol["icon-keep-upright"]),"icon-offset":new Cn(pe.layout_symbol["icon-offset"]),"icon-anchor":new Cn(pe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Rn(pe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Rn(pe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Rn(pe.layout_symbol["text-rotation-alignment"]),"text-field":new Cn(pe.layout_symbol["text-field"]),"text-font":new Cn(pe.layout_symbol["text-font"]),"text-size":new Cn(pe.layout_symbol["text-size"]),"text-max-width":new Cn(pe.layout_symbol["text-max-width"]),"text-line-height":new Rn(pe.layout_symbol["text-line-height"]),"text-letter-spacing":new Cn(pe.layout_symbol["text-letter-spacing"]),"text-justify":new Cn(pe.layout_symbol["text-justify"]),"text-radial-offset":new Cn(pe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Rn(pe.layout_symbol["text-variable-anchor"]),"text-anchor":new Cn(pe.layout_symbol["text-anchor"]),"text-max-angle":new Rn(pe.layout_symbol["text-max-angle"]),"text-writing-mode":new Rn(pe.layout_symbol["text-writing-mode"]),"text-rotate":new Cn(pe.layout_symbol["text-rotate"]),"text-padding":new Rn(pe.layout_symbol["text-padding"]),"text-keep-upright":new Rn(pe.layout_symbol["text-keep-upright"]),"text-transform":new Cn(pe.layout_symbol["text-transform"]),"text-offset":new Cn(pe.layout_symbol["text-offset"]),"text-allow-overlap":new Rn(pe.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Rn(pe.layout_symbol["text-ignore-placement"]),"text-optional":new Rn(pe.layout_symbol["text-optional"])}),xe={paint:new ns({"icon-opacity":new Cn(pe.paint_symbol["icon-opacity"]),"icon-color":new Cn(pe.paint_symbol["icon-color"]),"icon-halo-color":new Cn(pe.paint_symbol["icon-halo-color"]),"icon-halo-width":new Cn(pe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Cn(pe.paint_symbol["icon-halo-blur"]),"icon-translate":new Rn(pe.paint_symbol["icon-translate"]),"icon-translate-anchor":new Rn(pe.paint_symbol["icon-translate-anchor"]),"text-opacity":new Cn(pe.paint_symbol["text-opacity"]),"text-color":new Cn(pe.paint_symbol["text-color"],{runtimeType:Yr,getOverride:function(t){return t.textColor},hasOverride:function(t){return!!t.textColor}}),"text-halo-color":new Cn(pe.paint_symbol["text-halo-color"]),"text-halo-width":new Cn(pe.paint_symbol["text-halo-width"]),"text-halo-blur":new Cn(pe.paint_symbol["text-halo-blur"]),"text-translate":new Rn(pe.paint_symbol["text-translate"]),"text-translate-anchor":new Rn(pe.paint_symbol["text-translate-anchor"])}),layout:nt},Ze=function(t){this.type=t.property.overrides?t.property.overrides.runtimeType:pn,this.defaultValue=t};Ze.prototype.evaluate=function(t){if(t.formattedSection){var o=this.defaultValue.property.overrides;if(o&&o.hasOverride(t.formattedSection))return o.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default},Ze.prototype.eachChild=function(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)},Ze.prototype.outputDefined=function(){return!1},Ze.prototype.serialize=function(){return null},yn("FormatSectionOverride",Ze,{omit:["defaultValue"]});var Ae=function(t){function o(u){t.call(this,u,xe)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.recalculate=function(u,p){if(t.prototype.recalculate.call(this,u,p),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var y=this.layout.get("text-writing-mode");if(y){for(var b=[],S=0,I=y;S<I.length;S+=1){var D=I[S];b.indexOf(D)<0&&b.push(D)}this.layout._values["text-writing-mode"]=b}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},o.prototype.getValueAndResolveTokens=function(u,p,y,b){var S=this.layout.get(u).evaluate(p,{},y,b),I=this._unevaluatedLayout._values[u];return I.isDataDriven()||oc(I.value)||!S?S:function(D,z){return z.replace(/{([^{}]+)}/g,function(V,W){return W in D?String(D[W]):""})}(p.properties,S)},o.prototype.createBucket=function(u){return new Fe(u)},o.prototype.queryRadius=function(){return 0},o.prototype.queryIntersectsFeature=function(){return!1},o.prototype._setPaintOverrides=function(){for(var u=0,p=xe.paint.overridableProperties;u<p.length;u+=1){var y=p[u];if(o.hasPaintOverride(this.layout,y)){var b,S=this.paint.get(y),I=new Ze(S),D=new ac(I,S.property.specification);b=S.value.kind==="constant"||S.value.kind==="source"?new uc("source",D):new Rl("composite",D,S.value.zoomStops,S.value._interpolationType),this.paint._values[y]=new gs(S.property,b,S.parameters)}}},o.prototype._handleOverridablePaintPropertyUpdate=function(u,p,y){return!(!this.layout||p.isDataDriven()||y.isDataDriven())&&o.hasPaintOverride(this.layout,u)},o.hasPaintOverride=function(u,p){var y=u.get("text-field"),b=xe.paint.properties[p],S=!1,I=function(V){for(var W=0,ee=V;W<ee.length;W+=1)if(b.overrides&&b.overrides.hasOverride(ee[W]))return void(S=!0)};if(y.value.kind==="constant"&&y.value.value instanceof Ir)I(y.value.value.sections);else if(y.value.kind==="source"){var D=function(V){S||(V instanceof oo&&ne(V.value)===Xi?I(V.value.sections):V instanceof Uo?I(V.sections):V.eachChild(D))},z=y.value;z._styleExpression&&D(z._styleExpression.expression)}return S},o}(Go),ct={paint:new ns({"background-color":new Rn(pe.paint_background["background-color"]),"background-pattern":new ys(pe.paint_background["background-pattern"]),"background-opacity":new Rn(pe.paint_background["background-opacity"])})},Ct=function(t){function o(u){t.call(this,u,ct)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(Go),fr={paint:new ns({"raster-opacity":new Rn(pe.paint_raster["raster-opacity"]),"raster-hue-rotate":new Rn(pe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Rn(pe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Rn(pe.paint_raster["raster-brightness-max"]),"raster-saturation":new Rn(pe.paint_raster["raster-saturation"]),"raster-contrast":new Rn(pe.paint_raster["raster-contrast"]),"raster-resampling":new Rn(pe.paint_raster["raster-resampling"]),"raster-fade-duration":new Rn(pe.paint_raster["raster-fade-duration"])})},Ur=function(t){function o(u){t.call(this,u,fr)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(Go),Vr=function(t){function o(u){t.call(this,u,{}),this.implementation=u}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},o.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},o.prototype.recalculate=function(){},o.prototype.updateTransitions=function(){},o.prototype.hasTransition=function(){},o.prototype.serialize=function(){},o.prototype.onAdd=function(u){this.implementation.onAdd&&this.implementation.onAdd(u,u.painter.context.gl)},o.prototype.onRemove=function(u){this.implementation.onRemove&&this.implementation.onRemove(u,u.painter.context.gl)},o}(Go),sn={circle:Gc,heatmap:Wc,hillshade:Sh,fill:th,"fill-extrusion":Al,line:Yp,symbol:Ae,background:Ct,raster:Ur},Dr=J.HTMLImageElement,An=J.HTMLCanvasElement,cn=J.HTMLVideoElement,xn=J.ImageData,bn=J.ImageBitmap,dn=function(t,o,u,p){this.context=t,this.format=u,this.texture=t.gl.createTexture(),this.update(o,p)};dn.prototype.update=function(t,o,u){var p=t.width,y=t.height,b=!(this.size&&this.size[0]===p&&this.size[1]===y||u),S=this.context,I=S.gl;if(this.useMipmap=Boolean(o&&o.useMipmap),I.bindTexture(I.TEXTURE_2D,this.texture),S.pixelStoreUnpackFlipY.set(!1),S.pixelStoreUnpack.set(1),S.pixelStoreUnpackPremultiplyAlpha.set(this.format===I.RGBA&&(!o||o.premultiply!==!1)),b)this.size=[p,y],t instanceof Dr||t instanceof An||t instanceof cn||t instanceof xn||bn&&t instanceof bn?I.texImage2D(I.TEXTURE_2D,0,this.format,this.format,I.UNSIGNED_BYTE,t):I.texImage2D(I.TEXTURE_2D,0,this.format,p,y,0,this.format,I.UNSIGNED_BYTE,t.data);else{var D=u||{x:0,y:0},z=D.x,V=D.y;t instanceof Dr||t instanceof An||t instanceof cn||t instanceof xn||bn&&t instanceof bn?I.texSubImage2D(I.TEXTURE_2D,0,z,V,I.RGBA,I.UNSIGNED_BYTE,t):I.texSubImage2D(I.TEXTURE_2D,0,z,V,p,y,I.RGBA,I.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&I.generateMipmap(I.TEXTURE_2D)},dn.prototype.bind=function(t,o,u){var p=this.context.gl;p.bindTexture(p.TEXTURE_2D,this.texture),u!==p.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(u=p.LINEAR),t!==this.filter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,t),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,u||t),this.filter=t),o!==this.wrap&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,o),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,o),this.wrap=o)},dn.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},dn.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var Jn=function(t){var o=this;this._callback=t,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){o._triggered=!1,o._callback()})};Jn.prototype.trigger=function(){var t=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){t._triggered=!1,t._callback()},0))},Jn.prototype.remove=function(){delete this._channel,this._callback=function(){}};var _a=function(t,o,u){this.target=t,this.parent=o,this.mapId=u,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},Zt(["receive","process"],this),this.invoker=new Jn(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Nr()?t:J};function ls(t,o,u){var p=2*Math.PI*6378137/256/Math.pow(2,u);return[t*p-2*Math.PI*6378137/2,o*p-2*Math.PI*6378137/2]}_a.prototype.send=function(t,o,u,p,y){var b=this;y===void 0&&(y=!1);var S=Math.round(1e18*Math.random()).toString(36).substring(0,10);u&&(this.callbacks[S]=u);var I=Ce(this.globalScope)?void 0:[];return this.target.postMessage({id:S,type:t,hasCallback:!!u,targetMapId:p,mustQueue:y,sourceMapId:this.mapId,data:uu(o,I)},I),{cancel:function(){u&&delete b.callbacks[S],b.target.postMessage({id:S,type:"<cancel>",targetMapId:p,sourceMapId:b.mapId})}}},_a.prototype.receive=function(t){var o=t.data,u=o.id;if(u&&(!o.targetMapId||this.mapId===o.targetMapId))if(o.type==="<cancel>"){delete this.tasks[u];var p=this.cancelCallbacks[u];delete this.cancelCallbacks[u],p&&p()}else Nr()||o.mustQueue?(this.tasks[u]=o,this.taskQueue.push(u),this.invoker.trigger()):this.processTask(u,o)},_a.prototype.process=function(){if(this.taskQueue.length){var t=this.taskQueue.shift(),o=this.tasks[t];delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),o&&this.processTask(t,o)}},_a.prototype.processTask=function(t,o){var u=this;if(o.type==="<response>"){var p=this.callbacks[t];delete this.callbacks[t],p&&(o.error?p(na(o.error)):p(null,na(o.data)))}else{var y=!1,b=Ce(this.globalScope)?void 0:[],S=o.hasCallback?function(V,W){y=!0,delete u.cancelCallbacks[t],u.target.postMessage({id:t,type:"<response>",sourceMapId:u.mapId,error:V?uu(V):null,data:uu(W,b)},b)}:function(V){y=!0},I=null,D=na(o.data);if(this.parent[o.type])I=this.parent[o.type](o.sourceMapId,D,S);else if(this.parent.getWorkerSource){var z=o.type.split(".");I=this.parent.getWorkerSource(o.sourceMapId,z[0],D.source)[z[1]](D,S)}else S(new Error("Could not find function "+o.type));!y&&I&&I.cancel&&(this.cancelCallbacks[t]=I.cancel)}},_a.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var Ia=function(t,o){t&&(o?this.setSouthWest(t).setNorthEast(o):t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))};Ia.prototype.setNorthEast=function(t){return this._ne=t instanceof pa?new pa(t.lng,t.lat):pa.convert(t),this},Ia.prototype.setSouthWest=function(t){return this._sw=t instanceof pa?new pa(t.lng,t.lat):pa.convert(t),this},Ia.prototype.extend=function(t){var o,u,p=this._sw,y=this._ne;if(t instanceof pa)o=t,u=t;else{if(!(t instanceof Ia))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(Ia.convert(t)):this.extend(pa.convert(t)):this;if(u=t._ne,!(o=t._sw)||!u)return this}return p||y?(p.lng=Math.min(o.lng,p.lng),p.lat=Math.min(o.lat,p.lat),y.lng=Math.max(u.lng,y.lng),y.lat=Math.max(u.lat,y.lat)):(this._sw=new pa(o.lng,o.lat),this._ne=new pa(u.lng,u.lat)),this},Ia.prototype.getCenter=function(){return new pa((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},Ia.prototype.getSouthWest=function(){return this._sw},Ia.prototype.getNorthEast=function(){return this._ne},Ia.prototype.getNorthWest=function(){return new pa(this.getWest(),this.getNorth())},Ia.prototype.getSouthEast=function(){return new pa(this.getEast(),this.getSouth())},Ia.prototype.getWest=function(){return this._sw.lng},Ia.prototype.getSouth=function(){return this._sw.lat},Ia.prototype.getEast=function(){return this._ne.lng},Ia.prototype.getNorth=function(){return this._ne.lat},Ia.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},Ia.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},Ia.prototype.isEmpty=function(){return!(this._sw&&this._ne)},Ia.prototype.contains=function(t){var o=pa.convert(t),u=o.lng,p=o.lat,y=this._sw.lng<=u&&u<=this._ne.lng;return this._sw.lng>this._ne.lng&&(y=this._sw.lng>=u&&u>=this._ne.lng),this._sw.lat<=p&&p<=this._ne.lat&&y},Ia.convert=function(t){return!t||t instanceof Ia?t:new Ia(t)};var pa=function(t,o){if(isNaN(t)||isNaN(o))throw new Error("Invalid LngLat object: ("+t+", "+o+")");if(this.lng=+t,this.lat=+o,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};pa.prototype.wrap=function(){return new pa(rr(this.lng,-180,180),this.lat)},pa.prototype.toArray=function(){return[this.lng,this.lat]},pa.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},pa.prototype.distanceTo=function(t){var o=Math.PI/180,u=this.lat*o,p=t.lat*o,y=Math.sin(u)*Math.sin(p)+Math.cos(u)*Math.cos(p)*Math.cos((t.lng-this.lng)*o);return 63710088e-1*Math.acos(Math.min(y,1))},pa.prototype.toBounds=function(t){t===void 0&&(t=0);var o=360*t/40075017,u=o/Math.cos(Math.PI/180*this.lat);return new Ia(new pa(this.lng-u,this.lat-o),new pa(this.lng+u,this.lat+o))},pa.convert=function(t){if(t instanceof pa)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new pa(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new pa(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var Tl=2*Math.PI*63710088e-1;function Is(t){return Tl*Math.cos(t*Math.PI/180)}function Ku(t){return(180+t)/360}function yu(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function ah(t,o){return t/Is(o)}function Lu(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}var xc=function(t,o,u){u===void 0&&(u=0),this.x=+t,this.y=+o,this.z=+u};xc.fromLngLat=function(t,o){o===void 0&&(o=0);var u=pa.convert(t);return new xc(Ku(u.lng),yu(u.lat),ah(o,u.lat))},xc.prototype.toLngLat=function(){return new pa(360*this.x-180,Lu(this.y))},xc.prototype.toAltitude=function(){return this.z*Is(Lu(this.y))},xc.prototype.meterInMercatorCoordinateUnits=function(){return 1/Tl*(t=Lu(this.y),1/Math.cos(t*Math.PI/180));var t};var oh=function(t,o,u){this.z=t,this.x=o,this.y=u,this.key=Fh(0,t,t,o,u)};oh.prototype.equals=function(t){return this.z===t.z&&this.x===t.x&&this.y===t.y},oh.prototype.url=function(t,o){var u,p,y,b,S,I=(p=this.y,y=this.z,b=ls(256*(u=this.x),256*(p=Math.pow(2,y)-p-1),y),S=ls(256*(u+1),256*(p+1),y),b[0]+","+b[1]+","+S[0]+","+S[1]),D=function(z,V,W){for(var ee,se="",Me=z;Me>0;Me--)se+=(V&(ee=1<<Me-1)?1:0)+(W&ee?2:0);return se}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",D).replace("{bbox-epsg-3857}",I)},oh.prototype.getTilePoint=function(t){var o=Math.pow(2,this.z);return new fe(8192*(t.x*o-this.x),8192*(t.y*o-this.y))},oh.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var Ui=function(t,o){this.wrap=t,this.canonical=o,this.key=Fh(t,o.z,o.z,o.x,o.y)},jn=function(t,o,u,p,y){this.overscaledZ=t,this.wrap=o,this.canonical=new oh(u,+p,+y),this.key=Fh(o,t,u,p,y)};function Fh(t,o,u,p,y){(t*=2)<0&&(t=-1*t-1);var b=1<<u;return(b*b*t+b*y+p).toString(36)+u.toString(36)+o.toString(36)}jn.prototype.equals=function(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)},jn.prototype.scaledTo=function(t){var o=this.canonical.z-t;return t>this.canonical.z?new jn(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new jn(t,this.wrap,t,this.canonical.x>>o,this.canonical.y>>o)},jn.prototype.calculateScaledKey=function(t,o){var u=this.canonical.z-t;return t>this.canonical.z?Fh(this.wrap*+o,t,this.canonical.z,this.canonical.x,this.canonical.y):Fh(this.wrap*+o,t,t,this.canonical.x>>u,this.canonical.y>>u)},jn.prototype.isChildOf=function(t){if(t.wrap!==this.wrap)return!1;var o=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>o&&t.canonical.y===this.canonical.y>>o},jn.prototype.children=function(t){if(this.overscaledZ>=t)return[new jn(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var o=this.canonical.z+1,u=2*this.canonical.x,p=2*this.canonical.y;return[new jn(o,this.wrap,o,u,p),new jn(o,this.wrap,o,u+1,p),new jn(o,this.wrap,o,u,p+1),new jn(o,this.wrap,o,u+1,p+1)]},jn.prototype.isLessThan=function(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))},jn.prototype.wrapped=function(){return new jn(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},jn.prototype.unwrapTo=function(t){return new jn(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)},jn.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},jn.prototype.toUnwrapped=function(){return new Ui(this.wrap,this.canonical)},jn.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},jn.prototype.getTilePoint=function(t){return this.canonical.getTilePoint(new xc(t.x-this.wrap,t.y))},yn("CanonicalTileID",oh),yn("OverscaledTileID",jn,{omit:["posMatrix"]});var Mf=function(t,o,u){if(this.uid=t,o.height!==o.width)throw new RangeError("DEM tiles must be square");if(u&&u!=="mapbox"&&u!=="terrarium")return Qe('"'+u+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=o.height;var p=this.dim=o.height-2;this.data=new Uint32Array(o.data.buffer),this.encoding=u||"mapbox";for(var y=0;y<p;y++)this.data[this._idx(-1,y)]=this.data[this._idx(0,y)],this.data[this._idx(p,y)]=this.data[this._idx(p-1,y)],this.data[this._idx(y,-1)]=this.data[this._idx(y,0)],this.data[this._idx(y,p)]=this.data[this._idx(y,p-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(p,-1)]=this.data[this._idx(p-1,0)],this.data[this._idx(-1,p)]=this.data[this._idx(0,p-1)],this.data[this._idx(p,p)]=this.data[this._idx(p-1,p-1)]};Mf.prototype.get=function(t,o){var u=new Uint8Array(this.data.buffer),p=4*this._idx(t,o);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(u[p],u[p+1],u[p+2])},Mf.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},Mf.prototype._idx=function(t,o){if(t<-1||t>=this.dim+1||o<-1||o>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(o+1)*this.stride+(t+1)},Mf.prototype._unpackMapbox=function(t,o,u){return(256*t*256+256*o+u)/10-1e4},Mf.prototype._unpackTerrarium=function(t,o,u){return 256*t+o+u/256-32768},Mf.prototype.getPixels=function(){return new go({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},Mf.prototype.backfillBorder=function(t,o,u){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");var p=o*this.dim,y=o*this.dim+this.dim,b=u*this.dim,S=u*this.dim+this.dim;switch(o){case-1:p=y-1;break;case 1:y=p+1}switch(u){case-1:b=S-1;break;case 1:S=b+1}for(var I=-o*this.dim,D=-u*this.dim,z=b;z<S;z++)for(var V=p;V<y;V++)this.data[this._idx(V,z)]=t.data[this._idx(V+I,z+D)]},yn("DEMData",Mf);var Qp=function(t){this._stringToNumber={},this._numberToString=[];for(var o=0;o<t.length;o++){var u=t[o];this._stringToNumber[u]=o,this._numberToString[o]=u}};Qp.prototype.encode=function(t){return this._stringToNumber[t]},Qp.prototype.decode=function(t){return this._numberToString[t]};var Dd=function(t,o,u,p,y){this.type="Feature",this._vectorTileFeature=t,t._z=o,t._x=u,t._y=p,this.properties=t.properties,this.id=y},wv={geometry:{configurable:!0}};wv.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},wv.geometry.set=function(t){this._geometry=t},Dd.prototype.toJSON=function(){var t={geometry:this.geometry};for(var o in this)o!=="_geometry"&&o!=="_vectorTileFeature"&&(t[o]=this[o]);return t},Object.defineProperties(Dd.prototype,wv);var fp=function(){this.state={},this.stateChanges={},this.deletedStates={}};fp.prototype.updateState=function(t,o,u){var p=String(o);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][p]=this.stateChanges[t][p]||{},xt(this.stateChanges[t][p],u),this.deletedStates[t]===null)for(var y in this.deletedStates[t]={},this.state[t])y!==p&&(this.deletedStates[t][y]=null);else if(this.deletedStates[t]&&this.deletedStates[t][p]===null)for(var b in this.deletedStates[t][p]={},this.state[t][p])u[b]||(this.deletedStates[t][p][b]=null);else for(var S in u)this.deletedStates[t]&&this.deletedStates[t][p]&&this.deletedStates[t][p][S]===null&&delete this.deletedStates[t][p][S]},fp.prototype.removeFeatureState=function(t,o,u){if(this.deletedStates[t]!==null){var p=String(o);if(this.deletedStates[t]=this.deletedStates[t]||{},u&&o!==void 0)this.deletedStates[t][p]!==null&&(this.deletedStates[t][p]=this.deletedStates[t][p]||{},this.deletedStates[t][p][u]=null);else if(o!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][p])for(u in this.deletedStates[t][p]={},this.stateChanges[t][p])this.deletedStates[t][p][u]=null;else this.deletedStates[t][p]=null;else this.deletedStates[t]=null}},fp.prototype.getState=function(t,o){var u=String(o),p=xt({},(this.state[t]||{})[u],(this.stateChanges[t]||{})[u]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){var y=this.deletedStates[t][o];if(y===null)return{};for(var b in y)delete p[b]}return p},fp.prototype.initializeTileState=function(t,o){t.setFeatureState(this.state,o)},fp.prototype.coalesceChanges=function(t,o){var u={};for(var p in this.stateChanges){this.state[p]=this.state[p]||{};var y={};for(var b in this.stateChanges[p])this.state[p][b]||(this.state[p][b]={}),xt(this.state[p][b],this.stateChanges[p][b]),y[b]=this.state[p][b];u[p]=y}for(var S in this.deletedStates){this.state[S]=this.state[S]||{};var I={};if(this.deletedStates[S]===null)for(var D in this.state[S])I[D]={},this.state[S][D]={};else for(var z in this.deletedStates[S]){if(this.deletedStates[S][z]===null)this.state[S][z]={};else for(var V=0,W=Object.keys(this.deletedStates[S][z]);V<W.length;V+=1)delete this.state[S][z][W[V]];I[z]=this.state[S][z]}u[S]=u[S]||{},xt(u[S],I)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(var ee in t)t[ee].setFeatureState(u,o)};var Pf=function(t,o){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new tu(8192,16,0),this.grid3D=new tu(8192,16,0),this.featureIndexArray=new q,this.promoteId=o};function y0(t,o,u,p,y){return $t(t,function(b,S){var I=o instanceof Mu?o.get(S):null;return I&&I.evaluate?I.evaluate(u,p,y):I})}function _0(t){for(var o=1/0,u=1/0,p=-1/0,y=-1/0,b=0,S=t;b<S.length;b+=1){var I=S[b];o=Math.min(o,I.x),u=Math.min(u,I.y),p=Math.max(p,I.x),y=Math.max(y,I.y)}return{minX:o,minY:u,maxX:p,maxY:y}}function ym(t,o){return o-t}Pf.prototype.insert=function(t,o,u,p,y,b){var S=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,p,y);for(var I=b?this.grid3D:this.grid,D=0;D<o.length;D++){for(var z=o[D],V=[1/0,1/0,-1/0,-1/0],W=0;W<z.length;W++){var ee=z[W];V[0]=Math.min(V[0],ee.x),V[1]=Math.min(V[1],ee.y),V[2]=Math.max(V[2],ee.x),V[3]=Math.max(V[3],ee.y)}V[0]<8192&&V[1]<8192&&V[2]>=0&&V[3]>=0&&I.insert(S,V[0],V[1],V[2],V[3])}},Pf.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new gu.VectorTile(new wf(this.rawTileData)).layers,this.sourceLayerCoder=new Qp(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},Pf.prototype.query=function(t,o,u,p){var y=this;this.loadVTLayers();for(var b=t.params||{},S=8192/t.tileSize/t.scale,I=Dc(b.filter),D=t.queryGeometry,z=t.queryPadding*S,V=_0(D),W=this.grid.query(V.minX-z,V.minY-z,V.maxX+z,V.maxY+z),ee=_0(t.cameraQueryGeometry),se=this.grid3D.query(ee.minX-z,ee.minY-z,ee.maxX+z,ee.maxY+z,function(Vt,Xt,lr,Lr){return function($r,Zn,gn,Yn,hn){for(var ki=0,ai=$r;ki<ai.length;ki+=1){var Pn=ai[ki];if(Zn<=Pn.x&&gn<=Pn.y&&Yn>=Pn.x&&hn>=Pn.y)return!0}var Ai=[new fe(Zn,gn),new fe(Zn,hn),new fe(Yn,hn),new fe(Yn,gn)];if($r.length>2){for(var hi=0,ea=Ai;hi<ea.length;hi+=1)if(vu($r,ea[hi]))return!0}for(var Hn=0;Hn<$r.length-1;Hn++)if(Ul($r[Hn],$r[Hn+1],Ai))return!0;return!1}(t.cameraQueryGeometry,Vt-z,Xt-z,lr+z,Lr+z)}),Me=0,Oe=se;Me<Oe.length;Me+=1)W.push(Oe[Me]);W.sort(ym);for(var Ye,ze={},st=function(Vt){var Xt=W[Vt];if(Xt!==Ye){Ye=Xt;var lr=y.featureIndexArray.get(Xt),Lr=null;y.loadMatchingFeature(ze,lr.bucketIndex,lr.sourceLayerIndex,lr.featureIndex,I,b.layers,b.availableImages,o,u,p,function($r,Zn,gn){return Lr||(Lr=za($r)),Zn.queryIntersectsFeature(D,$r,gn,Lr,y.z,t.transform,S,t.pixelPosMatrix)})}},Tt=0;Tt<W.length;Tt++)st(Tt);return ze},Pf.prototype.loadMatchingFeature=function(t,o,u,p,y,b,S,I,D,z,V){var W=this.bucketLayerIDs[o];if(!b||function($r,Zn){for(var gn=0;gn<$r.length;gn++)if(Zn.indexOf($r[gn])>=0)return!0;return!1}(b,W)){var ee=this.sourceLayerCoder.decode(u),se=this.vtLayers[ee].feature(p);if(y.needGeometry){var Me=co(se,!0);if(!y.filter(new Fi(this.tileID.overscaledZ),Me,this.tileID.canonical))return}else if(!y.filter(new Fi(this.tileID.overscaledZ),se))return;for(var Oe=this.getId(se,ee),Ye=0;Ye<W.length;Ye++){var ze=W[Ye];if(!(b&&b.indexOf(ze)<0)){var st=I[ze];if(st){var Tt={};Oe!==void 0&&z&&(Tt=z.getState(st.sourceLayer||"_geojsonTileLayer",Oe));var Vt=xt({},D[ze]);Vt.paint=y0(Vt.paint,st.paint,se,Tt,S),Vt.layout=y0(Vt.layout,st.layout,se,Tt,S);var Xt=!V||V(se,st,Tt);if(Xt){var lr=new Dd(se,this.z,this.x,this.y,Oe);lr.layer=Vt;var Lr=t[ze];Lr===void 0&&(Lr=t[ze]=[]),Lr.push({featureIndex:p,feature:lr,intersectionZ:Xt})}}}}}},Pf.prototype.lookupSymbolFeatures=function(t,o,u,p,y,b,S,I){var D={};this.loadVTLayers();for(var z=Dc(y),V=0,W=t;V<W.length;V+=1)this.loadMatchingFeature(D,u,p,W[V],z,b,S,I,o);return D},Pf.prototype.hasLayer=function(t){for(var o=0,u=this.bucketLayerIDs;o<u.length;o+=1)for(var p=0,y=u[o];p<y.length;p+=1)if(t===y[p])return!0;return!1},Pf.prototype.getId=function(t,o){var u=t.id;return this.promoteId&&typeof(u=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[o]])=="boolean"&&(u=Number(u)),u},yn("FeatureIndex",Pf,{omit:["rawTileData","sourceLayerCoder"]});var Os=function(t,o){this.tileID=t,this.uid=Et(),this.uses=0,this.tileSize=o,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};Os.prototype.registerFadeDuration=function(t){var o=t+this.timeAdded;o<di.now()||this.fadeEndTime&&o<this.fadeEndTime||(this.fadeEndTime=o)},Os.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},Os.prototype.loadVectorData=function(t,o,u){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){for(var p in t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(z,V){var W={};if(!V)return W;for(var ee=function(){var Oe=Me[se],Ye=Oe.layerIds.map(function(Tt){return V.getLayer(Tt)}).filter(Boolean);if(Ye.length!==0){Oe.layers=Ye,Oe.stateDependentLayerIds&&(Oe.stateDependentLayers=Oe.stateDependentLayerIds.map(function(Tt){return Ye.filter(function(Vt){return Vt.id===Tt})[0]}));for(var ze=0,st=Ye;ze<st.length;ze+=1)W[st[ze].id]=Oe}},se=0,Me=z;se<Me.length;se+=1)ee();return W}(t.buckets,o.style),this.hasSymbolBuckets=!1,this.buckets){var y=this.buckets[p];if(y instanceof Fe){if(this.hasSymbolBuckets=!0,!u)break;y.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var b in this.buckets){var S=this.buckets[b];if(S instanceof Fe&&S.hasRTLText){this.hasRTLText=!0,Fs.isLoading()||Fs.isLoaded()||Hf()!=="deferred"||Ds();break}}for(var I in this.queryPadding=0,this.buckets){var D=this.buckets[I];this.queryPadding=Math.max(this.queryPadding,o.style.getLayer(I).queryRadius(D))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new h},Os.prototype.unloadVectorData=function(){for(var t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},Os.prototype.getBucket=function(t){return this.buckets[t.id]},Os.prototype.upload=function(t){for(var o in this.buckets){var u=this.buckets[o];u.uploadPending()&&u.upload(t)}var p=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new dn(t,this.imageAtlas.image,p.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new dn(t,this.glyphAtlasImage,p.ALPHA),this.glyphAtlasImage=null)},Os.prototype.prepare=function(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)},Os.prototype.queryRenderedFeatures=function(t,o,u,p,y,b,S,I,D,z){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:p,cameraQueryGeometry:y,scale:b,tileSize:this.tileSize,pixelPosMatrix:z,transform:I,params:S,queryPadding:this.queryPadding*D},t,o,u):{}},Os.prototype.querySourceFeatures=function(t,o){var u=this.latestFeatureIndex;if(u&&u.rawTileData){var p=u.loadVTLayers(),y=o?o.sourceLayer:"",b=p._geojsonTileLayer||p[y];if(b)for(var S=Dc(o&&o.filter),I=this.tileID.canonical,D=I.z,z=I.x,V=I.y,W={z:D,x:z,y:V},ee=0;ee<b.length;ee++){var se=b.feature(ee);if(S.needGeometry){var Me=co(se,!0);if(!S.filter(new Fi(this.tileID.overscaledZ),Me,this.tileID.canonical))continue}else if(!S.filter(new Fi(this.tileID.overscaledZ),se))continue;var Oe=u.getId(se,y),Ye=new Dd(se,D,z,V,Oe);Ye.tile=W,t.push(Ye)}}},Os.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},Os.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},Os.prototype.setExpiryData=function(t){var o=this.expirationTime;if(t.cacheControl){var u=tn(t.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){var p=Date.now(),y=!1;if(this.expirationTime>p)y=!1;else if(o)if(this.expirationTime<o)y=!0;else{var b=this.expirationTime-o;b?this.expirationTime=p+Math.max(b,3e4):y=!0}else y=!0;y?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},Os.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},Os.prototype.setFeatureState=function(t,o){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(t).length!==0){var u=this.latestFeatureIndex.loadVTLayers();for(var p in this.buckets)if(o.style.hasLayer(p)){var y=this.buckets[p],b=y.layers[0].sourceLayer||"_geojsonTileLayer",S=u[b],I=t[b];if(S&&I&&Object.keys(I).length!==0){y.update(I,S,this.imageAtlas&&this.imageAtlas.patternPositions||{});var D=o&&o.style&&o.style.getLayer(p);D&&(this.queryPadding=Math.max(this.queryPadding,D.queryRadius(y)))}}}},Os.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},Os.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<di.now()},Os.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},Os.prototype.setHoldDuration=function(t){this.symbolFadeHoldUntil=di.now()+t},Os.prototype.setDependencies=function(t,o){for(var u={},p=0,y=o;p<y.length;p+=1)u[y[p]]=!0;this.dependencies[t]=u},Os.prototype.hasDependency=function(t,o){for(var u=0,p=t;u<p.length;u+=1){var y=this.dependencies[p[u]];if(y){for(var b=0,S=o;b<S.length;b+=1)if(y[S[b]])return!0}}return!1};var sh=J.performance,x0=function(t){this._marks={start:[t.url,"start"].join("#"),end:[t.url,"end"].join("#"),measure:t.url.toString()},sh.mark(this._marks.start)};x0.prototype.finish=function(){sh.mark(this._marks.end);var t=sh.getEntriesByName(this._marks.measure);return t.length===0&&(sh.measure(this._marks.measure,this._marks.start,this._marks.end),t=sh.getEntriesByName(this._marks.measure),sh.clearMarks(this._marks.start),sh.clearMarks(this._marks.end),sh.clearMeasures(this._marks.measure)),t},m.Actor=_a,m.AlphaImage=nu,m.CanonicalTileID=oh,m.CollisionBoxArray=h,m.Color=pi,m.DEMData=Mf,m.DataConstantProperty=Rn,m.DictionaryCoder=Qp,m.EXTENT=8192,m.ErrorEvent=He,m.EvaluationParameters=Fi,m.Event=Pe,m.Evented=rt,m.FeatureIndex=Pf,m.FillBucket=Ns,m.FillExtrusionBucket=qu,m.ImageAtlas=br,m.ImagePosition=ut,m.LineBucket=va,m.LngLat=pa,m.LngLatBounds=Ia,m.MercatorCoordinate=xc,m.ONE_EM=24,m.OverscaledTileID=jn,m.Point=fe,m.Point$1=fe,m.Properties=ns,m.Protobuf=wf,m.RGBAImage=go,m.RequestManager=Wi,m.RequestPerformance=x0,m.ResourceType=fn,m.SegmentVector=he,m.SourceFeatureState=fp,m.StructArrayLayout1ui2=yf,m.StructArrayLayout2f1f2i16=vc,m.StructArrayLayout2i4=yl,m.StructArrayLayout3ui6=al,m.StructArrayLayout4i8=Pu,m.SymbolBucket=Fe,m.Texture=dn,m.Tile=Os,m.Transitionable=rs,m.Uniform1f=Fr,m.Uniform1i=dr,m.Uniform2f=kr,m.Uniform3f=ln,m.Uniform4f=Nn,m.UniformColor=zn,m.UniformMatrix4f=Bi,m.UnwrappedTileID=Ui,m.ValidationError=ke,m.WritingMode=Br,m.ZoomHistory=hf,m.add=function(t,o,u){return t[0]=o[0]+u[0],t[1]=o[1]+u[1],t[2]=o[2]+u[2],t},m.addDynamicAttributes=Ge,m.asyncAll=function(t,o,u){if(!t.length)return u(null,[]);var p=t.length,y=new Array(t.length),b=null;t.forEach(function(S,I){o(S,function(D,z){D&&(b=D),y[I]=z,--p==0&&u(b,y)})})},m.bezier=et,m.bindAll=Zt,m.browser=di,m.cacheEntryPossiblyAdded=function(t){++gi>Ar&&(t.getActor().send("enforceCacheSizeLimit",nr),gi=0)},m.clamp=gt,m.clearTileCache=function(t){var o=J.caches.delete("mapbox-tiles");t&&o.catch(t).then(function(){return t()})},m.clipLine=wo,m.clone=function(t){var o=new ta(16);return o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[4]=t[4],o[5]=t[5],o[6]=t[6],o[7]=t[7],o[8]=t[8],o[9]=t[9],o[10]=t[10],o[11]=t[11],o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15],o},m.clone$1=Je,m.clone$2=function(t){var o=new ta(3);return o[0]=t[0],o[1]=t[1],o[2]=t[2],o},m.collisionCircleLayout=qp,m.config=Wn,m.create=function(){var t=new ta(16);return ta!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},m.create$1=function(){var t=new ta(9);return ta!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},m.create$2=function(){var t=new ta(4);return ta!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},m.createCommonjsModule=ve,m.createExpression=sc,m.createLayout=Na,m.createStyleLayer=function(t){return t.type==="custom"?new Vr(t):new sn[t.type](t)},m.cross=function(t,o,u){var p=o[0],y=o[1],b=o[2],S=u[0],I=u[1],D=u[2];return t[0]=y*D-b*I,t[1]=b*S-p*D,t[2]=p*I-y*S,t},m.deepEqual=function t(o,u){if(Array.isArray(o)){if(!Array.isArray(u)||o.length!==u.length)return!1;for(var p=0;p<o.length;p++)if(!t(o[p],u[p]))return!1;return!0}if(typeof o=="object"&&o!==null&&u!==null){if(typeof u!="object"||Object.keys(o).length!==Object.keys(u).length)return!1;for(var y in o)if(!t(o[y],u[y]))return!1;return!0}return o===u},m.dot=function(t,o){return t[0]*o[0]+t[1]*o[1]+t[2]*o[2]},m.dot$1=function(t,o){return t[0]*o[0]+t[1]*o[1]+t[2]*o[2]+t[3]*o[3]},m.ease=Ue,m.emitValidationErrors=Su,m.endsWith=Y,m.enforceCacheSizeLimit=function(t){rn(),$i&&$i.then(function(o){o.keys().then(function(u){for(var p=0;p<u.length-t;p++)o.delete(u[p])})})},m.evaluateSizeForFeature=ni,m.evaluateSizeForZoom=ui,m.evaluateVariableOffset=wl,m.evented=Gf,m.extend=xt,m.featureFilter=Dc,m.filterObject=ft,m.fromRotation=function(t,o){var u=Math.sin(o),p=Math.cos(o);return t[0]=p,t[1]=u,t[2]=0,t[3]=-u,t[4]=p,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},m.getAnchorAlignment=Jr,m.getAnchorJustification=Te,m.getArrayBuffer=Ba,m.getImage=Q,m.getJSON=function(t,o){return Ko(xt(t,{type:"json"}),o)},m.getRTLTextPluginStatus=Hf,m.getReferrer=Ri,m.getVideo=function(t,o){var u,p,y=J.document.createElement("video");y.muted=!0,y.onloadstart=function(){o(null,y)};for(var b=0;b<t.length;b++){var S=J.document.createElement("source");u=t[b],p=void 0,(p=J.document.createElement("a")).href=u,(p.protocol!==J.document.location.protocol||p.host!==J.document.location.host)&&(y.crossOrigin="Anonymous"),S.src=t[b],y.appendChild(S)}return{cancel:function(){}}},m.identity=is,m.invert=function(t,o){var u=o[0],p=o[1],y=o[2],b=o[3],S=o[4],I=o[5],D=o[6],z=o[7],V=o[8],W=o[9],ee=o[10],se=o[11],Me=o[12],Oe=o[13],Ye=o[14],ze=o[15],st=u*I-p*S,Tt=u*D-y*S,Vt=u*z-b*S,Xt=p*D-y*I,lr=p*z-b*I,Lr=y*z-b*D,$r=V*Oe-W*Me,Zn=V*Ye-ee*Me,gn=V*ze-se*Me,Yn=W*Ye-ee*Oe,hn=W*ze-se*Oe,ki=ee*ze-se*Ye,ai=st*ki-Tt*hn+Vt*Yn+Xt*gn-lr*Zn+Lr*$r;return ai?(t[0]=(I*ki-D*hn+z*Yn)*(ai=1/ai),t[1]=(y*hn-p*ki-b*Yn)*ai,t[2]=(Oe*Lr-Ye*lr+ze*Xt)*ai,t[3]=(ee*lr-W*Lr-se*Xt)*ai,t[4]=(D*gn-S*ki-z*Zn)*ai,t[5]=(u*ki-y*gn+b*Zn)*ai,t[6]=(Ye*Vt-Me*Lr-ze*Tt)*ai,t[7]=(V*Lr-ee*Vt+se*Tt)*ai,t[8]=(S*hn-I*gn+z*$r)*ai,t[9]=(p*gn-u*hn-b*$r)*ai,t[10]=(Me*lr-Oe*Vt+ze*st)*ai,t[11]=(W*Vt-V*lr-se*st)*ai,t[12]=(I*Zn-S*Yn-D*$r)*ai,t[13]=(u*Yn-p*Zn+y*$r)*ai,t[14]=(Oe*Tt-Me*Xt-Ye*st)*ai,t[15]=(V*Xt-W*Tt+ee*st)*ai,t):null},m.isChar=Kr,m.isMapboxURL=Oi,m.keysDifference=function(t,o){var u=[];for(var p in t)p in o||u.push(p);return u},m.makeRequest=Ko,m.mapObject=$t,m.mercatorXfromLng=Ku,m.mercatorYfromLat=yu,m.mercatorZfromAltitude=ah,m.mul=_f,m.multiply=Ms,m.mvt=gu,m.nextPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},m.normalize=function(t,o){var u=o[0],p=o[1],y=o[2],b=u*u+p*p+y*y;return b>0&&(b=1/Math.sqrt(b)),t[0]=o[0]*b,t[1]=o[1]*b,t[2]=o[2]*b,t},m.number=ga,m.offscreenCanvasSupported=ti,m.ortho=function(t,o,u,p,y,b,S){var I=1/(o-u),D=1/(p-y),z=1/(b-S);return t[0]=-2*I,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*D,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*z,t[11]=0,t[12]=(o+u)*I,t[13]=(y+p)*D,t[14]=(S+b)*z,t[15]=1,t},m.parseGlyphPBF=function(t){return new wf(t).readFields(Rr,[])},m.pbf=wf,m.performSymbolLayout=function(t,o,u,p,y,b,S){t.createArrays(),t.tilePixelRatio=8192/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;var I=t.layers[0].layout,D=t.layers[0]._unevaluatedLayout._values,z={};if(t.textSizeData.kind==="composite"){var V=t.textSizeData,W=V.maxZoom;z.compositeTextSizes=[D["text-size"].possiblyEvaluate(new Fi(V.minZoom),S),D["text-size"].possiblyEvaluate(new Fi(W),S)]}if(t.iconSizeData.kind==="composite"){var ee=t.iconSizeData,se=ee.maxZoom;z.compositeIconSizes=[D["icon-size"].possiblyEvaluate(new Fi(ee.minZoom),S),D["icon-size"].possiblyEvaluate(new Fi(se),S)]}z.layoutTextSize=D["text-size"].possiblyEvaluate(new Fi(t.zoom+1),S),z.layoutIconSize=D["icon-size"].possiblyEvaluate(new Fi(t.zoom+1),S),z.textMaxSize=D["text-size"].possiblyEvaluate(new Fi(18));for(var Me=24*I.get("text-line-height"),Oe=I.get("text-rotation-alignment")==="map"&&I.get("symbol-placement")!=="point",Ye=I.get("text-keep-upright"),ze=I.get("text-size"),st=function(){var Xt=Vt[Tt],lr=I.get("text-font").evaluate(Xt,{},S).join(","),Lr=ze.evaluate(Xt,{},S),$r=z.layoutTextSize.evaluate(Xt,{},S),Zn=z.layoutIconSize.evaluate(Xt,{},S),gn={horizontal:{},vertical:void 0},Yn=Xt.text,hn=[0,0];if(Yn){var ki=Yn.toString(),ai=24*I.get("text-letter-spacing").evaluate(Xt,{},S),Pn=function(Yi){for(var Da=0,Ca=Yi;Da<Ca.length;Da+=1)if(ia=Ca[Da].charCodeAt(0),Kr.Arabic(ia)||Kr["Arabic Supplement"](ia)||Kr["Arabic Extended-A"](ia)||Kr["Arabic Presentation Forms-A"](ia)||Kr["Arabic Presentation Forms-B"](ia))return!1;var ia;return!0}(ki)?ai:0,Ai=I.get("text-anchor").evaluate(Xt,{},S),hi=I.get("text-variable-anchor");if(!hi){var ea=I.get("text-radial-offset").evaluate(Xt,{},S);hn=ea?wl(Ai,[24*ea,To]):I.get("text-offset").evaluate(Xt,{},S).map(function(Yi){return 24*Yi})}var Hn=Oe?"center":I.get("text-justify").evaluate(Xt,{},S),la=I.get("symbol-placement"),Wa=la==="point"?24*I.get("text-max-width").evaluate(Xt,{},S):0,yo=function(){t.allowVerticalPlacement&&zc(ki)&&(gn.vertical=zr(Yn,o,u,y,lr,Wa,Me,Ai,"left",Pn,hn,Br.vertical,!0,la,$r,Lr))};if(!Oe&&hi){for(var _o=Hn==="auto"?hi.map(function(Yi){return Te(Yi)}):[Hn],ao=!1,Mo=0;Mo<_o.length;Mo++){var Po=_o[Mo];if(!gn.horizontal[Po])if(ao)gn.horizontal[Po]=gn.horizontal[0];else{var ma=zr(Yn,o,u,y,lr,Wa,Me,"center",Po,Pn,hn,Br.horizontal,!1,la,$r,Lr);ma&&(gn.horizontal[Po]=ma,ao=ma.positionedLines.length===1)}}yo()}else{Hn==="auto"&&(Hn=Te(Ai));var zs=zr(Yn,o,u,y,lr,Wa,Me,Ai,Hn,Pn,hn,Br.horizontal,!1,la,$r,Lr);zs&&(gn.horizontal[Hn]=zs),yo(),zc(ki)&&Oe&&Ye&&(gn.vertical=zr(Yn,o,u,y,lr,Wa,Me,Ai,Hn,Pn,hn,Br.vertical,!1,la,$r,Lr))}}var cs=void 0,Us=!1;if(Xt.icon&&Xt.icon.name){var xo=p[Xt.icon.name];xo&&(cs=function(Yi,Da,Ca){var ia=Jr(Ca),iu=Da[0]-Yi.displaySize[0]*ia.horizontalAlign,Zs=Da[1]-Yi.displaySize[1]*ia.verticalAlign;return{image:Yi,top:Zs,bottom:Zs+Yi.displaySize[1],left:iu,right:iu+Yi.displaySize[0]}}(y[Xt.icon.name],I.get("icon-offset").evaluate(Xt,{},S),I.get("icon-anchor").evaluate(Xt,{},S)),Us=xo.sdf,t.sdfIcons===void 0?t.sdfIcons=xo.sdf:t.sdfIcons!==xo.sdf&&Qe("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(xo.pixelRatio!==t.pixelRatio||I.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}var fs=St(gn.horizontal)||gn.vertical;t.iconsInText=!!fs&&fs.iconsInText,(fs||cs)&&function(Yi,Da,Ca,ia,iu,Zs,$a,G,Rs,ca,Wl){var ku=Zs.textMaxSize.evaluate(Da,{});ku===void 0&&(ku=$a);var Xl,Io=Yi.layers[0].layout,Yl=Io.get("icon-offset").evaluate(Da,{},Wl),qs=St(Ca.horizontal),uh=$a/24,If=Yi.tilePixelRatio*uh,lh=Yi.tilePixelRatio*ku/24,bc=Yi.tilePixelRatio*G,ch=Yi.tilePixelRatio*Io.get("symbol-spacing"),hp=Io.get("text-padding")*Yi.tilePixelRatio,Jc=Io.get("icon-padding")*Yi.tilePixelRatio,pp=Io.get("text-max-angle")/180*Math.PI,Jp=Io.get("text-rotation-alignment")==="map"&&Io.get("symbol-placement")!=="point",dp=Io.get("icon-rotation-alignment")==="map"&&Io.get("symbol-placement")!=="point",Ec=Io.get("symbol-placement"),Bh=ch/2,fh=Io.get("icon-text-fit");ia&&fh!=="none"&&(Yi.allowVerticalPlacement&&Ca.vertical&&(Xl=Gn(ia,Ca.vertical,fh,Io.get("icon-text-fit-padding"),Yl,uh)),qs&&(ia=Gn(ia,qs,fh,Io.get("icon-text-fit-padding"),Yl,uh)));var ef=function(_m,xp){xp.x<0||xp.x>=8192||xp.y<0||xp.y>=8192||function(No,Ml,b0,tf,od,Bd,bp,Kl,Ep,Vh,Sp,Cp,sd,Nd,Gh,zd,Ud,Zd,jd,Vd,Qa,Ap,Gd,$l,Tv){var Hd,Of,ph,dh,vh,mh=No.addToLineVertexArray(Ml,b0),Wd=0,Xd=0,Yd=0,qd=0,ud=-1,Kd=-1,rf={},Mv=we(""),$d=0,ld=0;if(Kl._unevaluatedLayout.getValue("text-radial-offset")===void 0?($d=(Hd=Kl.layout.get("text-offset").evaluate(Qa,{},$l).map(function(wp){return 24*wp}))[0],ld=Hd[1]):($d=24*Kl.layout.get("text-radial-offset").evaluate(Qa,{},$l),ld=To),No.allowVerticalPlacement&&tf.vertical){var Pv=Kl.layout.get("text-rotate").evaluate(Qa,{},$l)+90;dh=new Yo(Ep,Ml,Vh,Sp,Cp,tf.vertical,sd,Nd,Gh,Pv),bp&&(vh=new Yo(Ep,Ml,Vh,Sp,Cp,bp,Ud,Zd,Gh,Pv))}if(od){var Qd=Kl.layout.get("icon-rotate").evaluate(Qa,{}),Jd=Kl.layout.get("icon-text-fit")!=="none",ev=Wo(od,Qd,Gd,Jd),cd=bp?Wo(bp,Qd,Gd,Jd):void 0;ph=new Yo(Ep,Ml,Vh,Sp,Cp,od,Ud,Zd,!1,Qd),Wd=4*ev.length;var tv=No.iconSizeData,nf=null;tv.kind==="source"?(nf=[128*Kl.layout.get("icon-size").evaluate(Qa,{})])[0]>32640&&Qe(No.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):tv.kind==="composite"&&((nf=[128*Ap.compositeIconSizes[0].evaluate(Qa,{},$l),128*Ap.compositeIconSizes[1].evaluate(Qa,{},$l)])[0]>32640||nf[1]>32640)&&Qe(No.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),No.addSymbols(No.icon,ev,nf,Vd,jd,Qa,!1,Ml,mh.lineStartIndex,mh.lineLength,-1,$l),ud=No.icon.placedSymbolArray.length-1,cd&&(Xd=4*cd.length,No.addSymbols(No.icon,cd,nf,Vd,jd,Qa,Br.vertical,Ml,mh.lineStartIndex,mh.lineLength,-1,$l),Kd=No.icon.placedSymbolArray.length-1)}for(var rv in tf.horizontal){var fd=tf.horizontal[rv];if(!Of){Mv=we(fd.text);var E0=Kl.layout.get("text-rotate").evaluate(Qa,{},$l);Of=new Yo(Ep,Ml,Vh,Sp,Cp,fd,sd,Nd,Gh,E0)}var Iv=fd.positionedLines.length===1;if(Yd+=Ut(No,Ml,fd,Bd,Kl,Gh,Qa,zd,mh,tf.vertical?Br.horizontal:Br.horizontalOnly,Iv?Object.keys(tf.horizontal):[rv],rf,ud,Ap,$l),Iv)break}tf.vertical&&(qd+=Ut(No,Ml,tf.vertical,Bd,Kl,Gh,Qa,zd,mh,Br.vertical,["vertical"],rf,Kd,Ap,$l));var S0=Of?Of.boxStartIndex:No.collisionBoxArray.length,C0=Of?Of.boxEndIndex:No.collisionBoxArray.length,A0=dh?dh.boxStartIndex:No.collisionBoxArray.length,w0=dh?dh.boxEndIndex:No.collisionBoxArray.length,T0=ph?ph.boxStartIndex:No.collisionBoxArray.length,M0=ph?ph.boxEndIndex:No.collisionBoxArray.length,P0=vh?vh.boxStartIndex:No.collisionBoxArray.length,I0=vh?vh.boxEndIndex:No.collisionBoxArray.length,Ac=-1,hd=function(wp,Rv){return wp&&wp.circleDiameter?Math.max(wp.circleDiameter,Rv):Rv};Ac=hd(Of,Ac),Ac=hd(dh,Ac),Ac=hd(ph,Ac);var Ov=(Ac=hd(vh,Ac))>-1?1:0;Ov&&(Ac*=Tv/24),No.glyphOffsetArray.length>=Fe.MAX_GLYPHS&&Qe("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Qa.sortKey!==void 0&&No.addToSortKeyRanges(No.symbolInstances.length,Qa.sortKey),No.symbolInstances.emplaceBack(Ml.x,Ml.y,rf.right>=0?rf.right:-1,rf.center>=0?rf.center:-1,rf.left>=0?rf.left:-1,rf.vertical||-1,ud,Kd,Mv,S0,C0,A0,w0,T0,M0,P0,I0,Vh,Yd,qd,Wd,Xd,Ov,0,sd,$d,ld,Ac)}(Yi,xp,_m,Ca,ia,iu,Xl,Yi.layers[0],Yi.collisionBoxArray,Da.index,Da.sourceLayerIndex,Yi.index,If,hp,Jp,Rs,bc,Jc,dp,Yl,Da,Zs,ca,Wl,$a)};if(Ec==="line")for(var Sc=0,vp=wo(Da.geometry,0,0,8192,8192);Sc<vp.length;Sc+=1)for(var mp=vp[Sc],Nh=0,gp=as(mp,ch,pp,Ca.vertical||qs,ia,24,lh,Yi.overscaling,8192);Nh<gp.length;Nh+=1){var ed=gp[Nh];qs&&mn(Yi,qs.text,Bh,ed)||ef(mp,ed)}else if(Ec==="line-center")for(var zh=0,yp=Da.geometry;zh<yp.length;zh+=1){var Cc=yp[zh];if(Cc.length>1){var td=Ha(Cc,pp,Ca.vertical||qs,ia,24,lh);td&&ef(Cc,td)}}else if(Da.type==="Polygon")for(var $u=0,rd=$f(Da.geometry,0);$u<rd.length;$u+=1){var Uh=rd[$u],_p=oi(Uh,16);ef(Uh[0],new jr(_p.x,_p.y,0))}else if(Da.type==="LineString")for(var ql=0,Zh=Da.geometry;ql<Zh.length;ql+=1){var hh=Zh[ql];ef(hh,new jr(hh[0].x,hh[0].y,0))}else if(Da.type==="Point")for(var nd=0,id=Da.geometry;nd<id.length;nd+=1)for(var ad=0,Fd=id[nd];ad<Fd.length;ad+=1){var jh=Fd[ad];ef([jh],new jr(jh.x,jh.y,0))}}(t,Xt,gn,cs,p,z,$r,Zn,hn,Us,S)},Tt=0,Vt=t.features;Tt<Vt.length;Tt+=1)st();b&&t.generateCollisionDebugBuffers()},m.perspective=function(t,o,u,p,y){var b,S=1/Math.tan(o/2);return t[0]=S/u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=S,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,y!=null&&y!==1/0?(t[10]=(y+p)*(b=1/(p-y)),t[14]=2*y*p*b):(t[10]=-1,t[14]=-2*p),t},m.pick=function(t,o){for(var u={},p=0;p<o.length;p++){var y=o[p];y in t&&(u[y]=t[y])}return u},m.plugin=Fs,m.polygonIntersectsPolygon=Hu,m.postMapLoadEvent=Nt,m.postTurnstileEvent=Za,m.potpack=Mr,m.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],m.register=yn,m.registerForPluginStateChange=function(t){return t({pluginStatus:ks,pluginURL:Vu}),Gf.on("pluginStateChange",t),t},m.renderColorRamp=bf,m.rotate=function(t,o,u){var p=o[0],y=o[1],b=o[2],S=o[3],I=Math.sin(u),D=Math.cos(u);return t[0]=p*D+b*I,t[1]=y*D+S*I,t[2]=p*-I+b*D,t[3]=y*-I+S*D,t},m.rotateX=function(t,o,u){var p=Math.sin(u),y=Math.cos(u),b=o[4],S=o[5],I=o[6],D=o[7],z=o[8],V=o[9],W=o[10],ee=o[11];return o!==t&&(t[0]=o[0],t[1]=o[1],t[2]=o[2],t[3]=o[3],t[12]=o[12],t[13]=o[13],t[14]=o[14],t[15]=o[15]),t[4]=b*y+z*p,t[5]=S*y+V*p,t[6]=I*y+W*p,t[7]=D*y+ee*p,t[8]=z*y-b*p,t[9]=V*y-S*p,t[10]=W*y-I*p,t[11]=ee*y-D*p,t},m.rotateZ=function(t,o,u){var p=Math.sin(u),y=Math.cos(u),b=o[0],S=o[1],I=o[2],D=o[3],z=o[4],V=o[5],W=o[6],ee=o[7];return o!==t&&(t[8]=o[8],t[9]=o[9],t[10]=o[10],t[11]=o[11],t[12]=o[12],t[13]=o[13],t[14]=o[14],t[15]=o[15]),t[0]=b*y+z*p,t[1]=S*y+V*p,t[2]=I*y+W*p,t[3]=D*y+ee*p,t[4]=z*y-b*p,t[5]=V*y-S*p,t[6]=W*y-I*p,t[7]=ee*y-D*p,t},m.scale=function(t,o,u){var p=u[0],y=u[1],b=u[2];return t[0]=o[0]*p,t[1]=o[1]*p,t[2]=o[2]*p,t[3]=o[3]*p,t[4]=o[4]*y,t[5]=o[5]*y,t[6]=o[6]*y,t[7]=o[7]*y,t[8]=o[8]*b,t[9]=o[9]*b,t[10]=o[10]*b,t[11]=o[11]*b,t[12]=o[12],t[13]=o[13],t[14]=o[14],t[15]=o[15],t},m.scale$1=function(t,o,u){return t[0]=o[0]*u,t[1]=o[1]*u,t[2]=o[2]*u,t[3]=o[3]*u,t},m.scale$2=function(t,o,u){return t[0]=o[0]*u,t[1]=o[1]*u,t[2]=o[2]*u,t},m.setCacheLimits=function(t,o){nr=t,Ar=o},m.setRTLTextPlugin=function(t,o,u){if(u===void 0&&(u=!1),ks==="deferred"||ks==="loading"||ks==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");Vu=di.resolveURL(t),ks="deferred",Cu=o,Bl(),u||Ds()},m.sphericalToCartesian=function(t){var o=t[0],u=t[1],p=t[2];return u+=90,u*=Math.PI/180,p*=Math.PI/180,{x:o*Math.cos(u)*Math.sin(p),y:o*Math.sin(u)*Math.sin(p),z:o*Math.cos(p)}},m.sqrLen=function(t){var o=t[0],u=t[1];return o*o+u*u},m.styleSpec=pe,m.sub=function(t,o,u){return t[0]=o[0]-u[0],t[1]=o[1]-u[1],t[2]=o[2]-u[2],t},m.symbolSize=Ni,m.transformMat3=function(t,o,u){var p=o[0],y=o[1],b=o[2];return t[0]=p*u[0]+y*u[3]+b*u[6],t[1]=p*u[1]+y*u[4]+b*u[7],t[2]=p*u[2]+y*u[5]+b*u[8],t},m.transformMat4=xf,m.translate=function(t,o,u){var p,y,b,S,I,D,z,V,W,ee,se,Me,Oe=u[0],Ye=u[1],ze=u[2];return o===t?(t[12]=o[0]*Oe+o[4]*Ye+o[8]*ze+o[12],t[13]=o[1]*Oe+o[5]*Ye+o[9]*ze+o[13],t[14]=o[2]*Oe+o[6]*Ye+o[10]*ze+o[14],t[15]=o[3]*Oe+o[7]*Ye+o[11]*ze+o[15]):(y=o[1],b=o[2],S=o[3],I=o[4],D=o[5],z=o[6],V=o[7],W=o[8],ee=o[9],se=o[10],Me=o[11],t[0]=p=o[0],t[1]=y,t[2]=b,t[3]=S,t[4]=I,t[5]=D,t[6]=z,t[7]=V,t[8]=W,t[9]=ee,t[10]=se,t[11]=Me,t[12]=p*Oe+I*Ye+W*ze+o[12],t[13]=y*Oe+D*Ye+ee*ze+o[13],t[14]=b*Oe+z*Ye+se*ze+o[14],t[15]=S*Oe+V*Ye+Me*ze+o[15]),t},m.triggerPluginCompletionEvent=Zc,m.uniqueId=Et,m.validateCustomStyleLayer=function(t){var o=[],u=t.id;return u===void 0&&o.push({message:"layers."+u+': missing required property "id"'}),t.render===void 0&&o.push({message:"layers."+u+': missing required method "render"'}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&o.push({message:"layers."+u+': property "renderingMode" must be either "2d" or "3d"'}),o},m.validateLight=rp,m.validateStyle=Nc,m.values=function(t){var o=[];for(var u in t)o.push(t[u]);return o},m.vectorTile=gu,m.version="1.13.2",m.warnOnce=Qe,m.webpSupported=si,m.window=J,m.wrap=rr}),re(["./shared"],function(m){"use strict";function ve(H){var Q=typeof H;if(Q==="number"||Q==="boolean"||Q==="string"||H==null)return JSON.stringify(H);if(Array.isArray(H)){for(var oe="[",ye=0,Pe=H;ye<Pe.length;ye+=1)oe+=ve(Pe[ye])+",";return oe+"]"}for(var He=Object.keys(H).sort(),rt="{",pe=0;pe<He.length;pe++)rt+=JSON.stringify(He[pe])+":"+ve(H[He[pe]])+",";return rt+"}"}function Z(H){for(var Q="",oe=0,ye=m.refProperties;oe<ye.length;oe+=1)Q+="/"+ve(H[ye[oe]]);return Q}var le=function(H){this.keyCache={},H&&this.replace(H)};le.prototype.replace=function(H){this._layerConfigs={},this._layers={},this.update(H,[])},le.prototype.update=function(H,Q){for(var oe=this,ye=0,Pe=H;ye<Pe.length;ye+=1){var He=Pe[ye];this._layerConfigs[He.id]=He;var rt=this._layers[He.id]=m.createStyleLayer(He);rt._featureFilter=m.featureFilter(rt.filter),this.keyCache[He.id]&&delete this.keyCache[He.id]}for(var pe=0,ke=Q;pe<ke.length;pe+=1){var vt=ke[pe];delete this.keyCache[vt],delete this._layerConfigs[vt],delete this._layers[vt]}this.familiesBySource={};for(var pr=0,Ft=function(Zr,Yr){for(var _i={},an=0;an<Zr.length;an++){var on=Yr&&Yr[Zr[an].id]||Z(Zr[an]);Yr&&(Yr[Zr[an].id]=on);var Xi=_i[on];Xi||(Xi=_i[on]=[]),Xi.push(Zr[an])}var yi=[];for(var Pi in _i)yi.push(_i[Pi]);return yi}(m.values(this._layerConfigs),this.keyCache);pr<Ft.length;pr+=1){var zt=Ft[pr].map(function(Zr){return oe._layers[Zr.id]}),vr=zt[0];if(vr.visibility!=="none"){var En=vr.source||"",pn=this.familiesBySource[En];pn||(pn=this.familiesBySource[En]={});var Ot=vr.sourceLayer||"_geojsonTileLayer",nn=pn[Ot];nn||(nn=pn[Ot]=[]),nn.push(zt)}}};var fe=function(H){var Q={},oe=[];for(var ye in H){var Pe=H[ye],He=Q[ye]={};for(var rt in Pe){var pe=Pe[+rt];if(pe&&pe.bitmap.width!==0&&pe.bitmap.height!==0){var ke={x:0,y:0,w:pe.bitmap.width+2,h:pe.bitmap.height+2};oe.push(ke),He[rt]={rect:ke,metrics:pe.metrics}}}}var vt=m.potpack(oe),pr=new m.AlphaImage({width:vt.w||1,height:vt.h||1});for(var Ft in H){var zt=H[Ft];for(var vr in zt){var En=zt[+vr];if(En&&En.bitmap.width!==0&&En.bitmap.height!==0){var pn=Q[Ft][vr].rect;m.AlphaImage.copy(En.bitmap,pr,{x:0,y:0},{x:pn.x+1,y:pn.y+1},En.bitmap)}}}this.image=pr,this.positions=Q};m.register("GlyphAtlas",fe);var Le=function(H){this.tileID=new m.OverscaledTileID(H.tileID.overscaledZ,H.tileID.wrap,H.tileID.canonical.z,H.tileID.canonical.x,H.tileID.canonical.y),this.uid=H.uid,this.zoom=H.zoom,this.pixelRatio=H.pixelRatio,this.tileSize=H.tileSize,this.source=H.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=H.showCollisionBoxes,this.collectResourceTiming=!!H.collectResourceTiming,this.returnDependencies=!!H.returnDependencies,this.promoteId=H.promoteId};function J(H,Q,oe){for(var ye=new m.EvaluationParameters(Q),Pe=0,He=H;Pe<He.length;Pe+=1)He[Pe].recalculate(ye,oe)}function Xe(H,Q){var oe=m.getArrayBuffer(H.request,function(ye,Pe,He,rt){ye?Q(ye):Pe&&Q(null,{vectorTile:new m.vectorTile.VectorTile(new m.pbf(Pe)),rawData:Pe,cacheControl:He,expires:rt})});return function(){oe.cancel(),Q()}}Le.prototype.parse=function(H,Q,oe,ye,Pe){var He=this;this.status="parsing",this.data=H,this.collisionBoxArray=new m.CollisionBoxArray;var rt=new m.DictionaryCoder(Object.keys(H.layers).sort()),pe=new m.FeatureIndex(this.tileID,this.promoteId);pe.bucketLayerIDs=[];var ke,vt,pr,Ft,zt={},vr={featureIndex:pe,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:oe},En=Q.familiesBySource[this.source];for(var pn in En){var Ot=H.layers[pn];if(Ot){Ot.version===1&&m.warnOnce('Vector tile source "'+this.source+'" layer "'+pn+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var nn=rt.encode(pn),Zr=[],Yr=0;Yr<Ot.length;Yr++){var _i=Ot.feature(Yr),an=pe.getId(_i,pn);Zr.push({feature:_i,id:an,index:Yr,sourceLayerIndex:nn})}for(var on=0,Xi=En[pn];on<Xi.length;on+=1){var yi=Xi[on],Pi=yi[0];Pi.minzoom&&this.zoom<Math.floor(Pi.minzoom)||Pi.maxzoom&&this.zoom>=Pi.maxzoom||Pi.visibility!=="none"&&(J(yi,this.zoom,oe),(zt[Pi.id]=Pi.createBucket({index:pe.bucketLayerIDs.length,layers:yi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:nn,sourceID:this.source})).populate(Zr,vr,this.tileID.canonical),pe.bucketLayerIDs.push(yi.map(function(qi){return qi.id})))}}}var bi=m.mapObject(vr.glyphDependencies,function(qi){return Object.keys(qi).map(Number)});Object.keys(bi).length?ye.send("getGlyphs",{uid:this.uid,stacks:bi},function(qi,Ii){ke||(ke=qi,vt=Ii,Aa.call(He))}):vt={};var ht=Object.keys(vr.iconDependencies);ht.length?ye.send("getImages",{icons:ht,source:this.source,tileID:this.tileID,type:"icons"},function(qi,Ii){ke||(ke=qi,pr=Ii,Aa.call(He))}):pr={};var Pt=Object.keys(vr.patternDependencies);function Aa(){if(ke)return Pe(ke);if(vt&&pr&&Ft){var qi=new fe(vt),Ii=new m.ImageAtlas(pr,Ft);for(var pi in zt){var wa=zt[pi];wa instanceof m.SymbolBucket?(J(wa.layers,this.zoom,oe),m.performSymbolLayout(wa,vt,qi.positions,pr,Ii.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):wa.hasPattern&&(wa instanceof m.LineBucket||wa instanceof m.FillBucket||wa instanceof m.FillExtrusionBucket)&&(J(wa.layers,this.zoom,oe),wa.addFeatures(vr,this.tileID.canonical,Ii.patternPositions))}this.status="done",Pe(null,{buckets:m.values(zt).filter(function($s){return!$s.isEmpty()}),featureIndex:pe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:qi.image,imageAtlas:Ii,glyphMap:this.returnDependencies?vt:null,iconMap:this.returnDependencies?pr:null,glyphPositions:this.returnDependencies?qi.positions:null})}}Pt.length?ye.send("getImages",{icons:Pt,source:this.source,tileID:this.tileID,type:"patterns"},function(qi,Ii){ke||(ke=qi,Ft=Ii,Aa.call(He))}):Ft={},Aa.call(this)};var et=function(H,Q,oe,ye){this.actor=H,this.layerIndex=Q,this.availableImages=oe,this.loadVectorData=ye||Xe,this.loading={},this.loaded={}};et.prototype.loadTile=function(H,Q){var oe=this,ye=H.uid;this.loading||(this.loading={});var Pe=!!(H&&H.request&&H.request.collectResourceTiming)&&new m.RequestPerformance(H.request),He=this.loading[ye]=new Le(H);He.abort=this.loadVectorData(H,function(rt,pe){if(delete oe.loading[ye],rt||!pe)return He.status="done",oe.loaded[ye]=He,Q(rt);var ke=pe.rawData,vt={};pe.expires&&(vt.expires=pe.expires),pe.cacheControl&&(vt.cacheControl=pe.cacheControl);var pr={};if(Pe){var Ft=Pe.finish();Ft&&(pr.resourceTiming=JSON.parse(JSON.stringify(Ft)))}He.vectorTile=pe.vectorTile,He.parse(pe.vectorTile,oe.layerIndex,oe.availableImages,oe.actor,function(zt,vr){if(zt||!vr)return Q(zt);Q(null,m.extend({rawTileData:ke.slice(0)},vr,vt,pr))}),oe.loaded=oe.loaded||{},oe.loaded[ye]=He})},et.prototype.reloadTile=function(H,Q){var oe=this,ye=this.loaded,Pe=H.uid,He=this;if(ye&&ye[Pe]){var rt=ye[Pe];rt.showCollisionBoxes=H.showCollisionBoxes;var pe=function(ke,vt){var pr=rt.reloadCallback;pr&&(delete rt.reloadCallback,rt.parse(rt.vectorTile,He.layerIndex,oe.availableImages,He.actor,pr)),Q(ke,vt)};rt.status==="parsing"?rt.reloadCallback=pe:rt.status==="done"&&(rt.vectorTile?rt.parse(rt.vectorTile,this.layerIndex,this.availableImages,this.actor,pe):pe())}},et.prototype.abortTile=function(H,Q){var oe=this.loading,ye=H.uid;oe&&oe[ye]&&oe[ye].abort&&(oe[ye].abort(),delete oe[ye]),Q()},et.prototype.removeTile=function(H,Q){var oe=this.loaded,ye=H.uid;oe&&oe[ye]&&delete oe[ye],Q()};var Ue=m.window.ImageBitmap,gt=function(){this.loaded={}};function rr(H,Q){if(H.length!==0){xt(H[0],Q);for(var oe=1;oe<H.length;oe++)xt(H[oe],!Q)}}function xt(H,Q){for(var oe=0,ye=0,Pe=H.length,He=Pe-1;ye<Pe;He=ye++)oe+=(H[ye][0]-H[He][0])*(H[He][1]+H[ye][1]);oe>=0!=!!Q&&H.reverse()}gt.prototype.loadTile=function(H,Q){var oe=H.uid,ye=H.encoding,Pe=H.rawImageData,He=Ue&&Pe instanceof Ue?this.getImageData(Pe):Pe,rt=new m.DEMData(oe,He,ye);this.loaded=this.loaded||{},this.loaded[oe]=rt,Q(null,rt)},gt.prototype.getImageData=function(H){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(H.width,H.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=H.width,this.offscreenCanvas.height=H.height,this.offscreenCanvasContext.drawImage(H,0,0,H.width,H.height);var Q=this.offscreenCanvasContext.getImageData(-1,-1,H.width+2,H.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new m.RGBAImage({width:Q.width,height:Q.height},Q.data)},gt.prototype.removeTile=function(H){var Q=this.loaded,oe=H.uid;Q&&Q[oe]&&delete Q[oe]};var Yt=m.vectorTile.VectorTileFeature.prototype.toGeoJSON,Et=function(H){this._feature=H,this.extent=m.EXTENT,this.type=H.type,this.properties=H.tags,"id"in H&&!isNaN(H.id)&&(this.id=parseInt(H.id,10))};Et.prototype.loadGeometry=function(){if(this._feature.type===1){for(var H=[],Q=0,oe=this._feature.geometry;Q<oe.length;Q+=1){var ye=oe[Q];H.push([new m.Point$1(ye[0],ye[1])])}return H}for(var Pe=[],He=0,rt=this._feature.geometry;He<rt.length;He+=1){for(var pe=[],ke=0,vt=rt[He];ke<vt.length;ke+=1){var pr=vt[ke];pe.push(new m.Point$1(pr[0],pr[1]))}Pe.push(pe)}return Pe},Et.prototype.toGeoJSON=function(H,Q,oe){return Yt.call(this,H,Q,oe)};var at=function(H){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=m.EXTENT,this.length=H.length,this._features=H};at.prototype.feature=function(H){return new Et(this._features[H])};var it=m.vectorTile.VectorTileFeature,Zt=Y;function Y(H,Q){this.options=Q||{},this.features=H,this.length=H.length}function $t(H,Q){this.id=typeof H.id=="number"?H.id:void 0,this.type=H.type,this.rawGeometry=H.type===1?[H.geometry]:H.geometry,this.properties=H.tags,this.extent=Q||4096}Y.prototype.feature=function(H){return new $t(this.features[H],this.options.extent)},$t.prototype.loadGeometry=function(){var H=this.rawGeometry;this.geometry=[];for(var Q=0;Q<H.length;Q++){for(var oe=H[Q],ye=[],Pe=0;Pe<oe.length;Pe++)ye.push(new m.Point$1(oe[Pe][0],oe[Pe][1]));this.geometry.push(ye)}return this.geometry},$t.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var H=this.geometry,Q=1/0,oe=-1/0,ye=1/0,Pe=-1/0,He=0;He<H.length;He++)for(var rt=H[He],pe=0;pe<rt.length;pe++){var ke=rt[pe];Q=Math.min(Q,ke.x),oe=Math.max(oe,ke.x),ye=Math.min(ye,ke.y),Pe=Math.max(Pe,ke.y)}return[Q,ye,oe,Pe]},$t.prototype.toGeoJSON=it.prototype.toGeoJSON;var ft=At,Je=Zt;function At(H){var Q=new m.pbf;return function(oe,ye){for(var Pe in oe.layers)ye.writeMessage(3,Qe,oe.layers[Pe])}(H,Q),Q.finish()}function Qe(H,Q){var oe;Q.writeVarintField(15,H.version||1),Q.writeStringField(1,H.name||""),Q.writeVarintField(5,H.extent||4096);var ye={keys:[],values:[],keycache:{},valuecache:{}};for(oe=0;oe<H.length;oe++)ye.feature=H.feature(oe),Q.writeMessage(2,Qt,ye);var Pe=ye.keys;for(oe=0;oe<Pe.length;oe++)Q.writeStringField(3,Pe[oe]);var He=ye.values;for(oe=0;oe<He.length;oe++)Q.writeMessage(4,Ce,He[oe])}function Qt(H,Q){var oe=H.feature;oe.id!==void 0&&Q.writeVarintField(1,oe.id),Q.writeMessage(2,Er,H),Q.writeVarintField(3,oe.type),Q.writeMessage(4,A,oe)}function Er(H,Q){var oe=H.feature,ye=H.keys,Pe=H.values,He=H.keycache,rt=H.valuecache;for(var pe in oe.properties){var ke=He[pe];ke===void 0&&(ye.push(pe),He[pe]=ke=ye.length-1),Q.writeVarint(ke);var vt=oe.properties[pe],pr=typeof vt;pr!=="string"&&pr!=="boolean"&&pr!=="number"&&(vt=JSON.stringify(vt));var Ft=pr+":"+vt,zt=rt[Ft];zt===void 0&&(Pe.push(vt),rt[Ft]=zt=Pe.length-1),Q.writeVarint(zt)}}function Nr(H,Q){return(Q<<3)+(7&H)}function tn(H){return H<<1^H>>31}function A(H,Q){for(var oe=H.loadGeometry(),ye=H.type,Pe=0,He=0,rt=oe.length,pe=0;pe<rt;pe++){var ke=oe[pe],vt=1;ye===1&&(vt=ke.length),Q.writeVarint(Nr(1,vt));for(var pr=ye===3?ke.length-1:ke.length,Ft=0;Ft<pr;Ft++){Ft===1&&ye!==1&&Q.writeVarint(Nr(2,pr-1));var zt=ke[Ft].x-Pe,vr=ke[Ft].y-He;Q.writeVarint(tn(zt)),Q.writeVarint(tn(vr)),Pe+=zt,He+=vr}ye===3&&Q.writeVarint(Nr(7,1))}}function Ce(H,Q){var oe=typeof H;oe==="string"?Q.writeStringField(1,H):oe==="boolean"?Q.writeBooleanField(7,H):oe==="number"&&(H%1!=0?Q.writeDoubleField(3,H):H<0?Q.writeSVarintField(6,H):Q.writeVarintField(5,H))}function De(H,Q,oe,ye){wt(H,oe,ye),wt(Q,2*oe,2*ye),wt(Q,2*oe+1,2*ye+1)}function wt(H,Q,oe){var ye=H[Q];H[Q]=H[oe],H[oe]=ye}function mt(H,Q,oe,ye){var Pe=H-oe,He=Q-ye;return Pe*Pe+He*He}ft.fromVectorTileJs=At,ft.fromGeojsonVt=function(H,Q){Q=Q||{};var oe={};for(var ye in H)oe[ye]=new Zt(H[ye].features,Q),oe[ye].name=ye,oe[ye].version=Q.version,oe[ye].extent=Q.extent;return At({layers:oe})},ft.GeoJSONWrapper=Je;var Bt=function(H){return H[0]},Kt=function(H){return H[1]},Cr=function(H,Q,oe,ye,Pe){Q===void 0&&(Q=Bt),oe===void 0&&(oe=Kt),ye===void 0&&(ye=64),Pe===void 0&&(Pe=Float64Array),this.nodeSize=ye,this.points=H;for(var He=H.length<65536?Uint16Array:Uint32Array,rt=this.ids=new He(H.length),pe=this.coords=new Pe(2*H.length),ke=0;ke<H.length;ke++)rt[ke]=ke,pe[2*ke]=Q(H[ke]),pe[2*ke+1]=oe(H[ke]);(function vt(pr,Ft,zt,vr,En,pn){if(!(En-vr<=zt)){var Ot=vr+En>>1;(function nn(Zr,Yr,_i,an,on,Xi){for(;on>an;){if(on-an>600){var yi=on-an+1,Pi=_i-an+1,bi=Math.log(yi),ht=.5*Math.exp(2*bi/3),Pt=.5*Math.sqrt(bi*ht*(yi-ht)/yi)*(Pi-yi/2<0?-1:1);nn(Zr,Yr,_i,Math.max(an,Math.floor(_i-Pi*ht/yi+Pt)),Math.min(on,Math.floor(_i+(yi-Pi)*ht/yi+Pt)),Xi)}var Aa=Yr[2*_i+Xi],qi=an,Ii=on;for(De(Zr,Yr,an,_i),Yr[2*on+Xi]>Aa&&De(Zr,Yr,an,on);qi<Ii;){for(De(Zr,Yr,qi,Ii),qi++,Ii--;Yr[2*qi+Xi]<Aa;)qi++;for(;Yr[2*Ii+Xi]>Aa;)Ii--}Yr[2*an+Xi]===Aa?De(Zr,Yr,an,Ii):De(Zr,Yr,++Ii,on),Ii<=_i&&(an=Ii+1),_i<=Ii&&(on=Ii-1)}})(pr,Ft,Ot,vr,En,pn%2),vt(pr,Ft,zt,vr,Ot-1,pn+1),vt(pr,Ft,zt,Ot+1,En,pn+1)}})(rt,pe,ye,0,rt.length-1,0)};Cr.prototype.range=function(H,Q,oe,ye){return function(Pe,He,rt,pe,ke,vt,pr){for(var Ft,zt,vr=[0,Pe.length-1,0],En=[];vr.length;){var pn=vr.pop(),Ot=vr.pop(),nn=vr.pop();if(Ot-nn<=pr)for(var Zr=nn;Zr<=Ot;Zr++)zt=He[2*Zr+1],(Ft=He[2*Zr])>=rt&&Ft<=ke&&zt>=pe&&zt<=vt&&En.push(Pe[Zr]);else{var Yr=Math.floor((nn+Ot)/2);zt=He[2*Yr+1],(Ft=He[2*Yr])>=rt&&Ft<=ke&&zt>=pe&&zt<=vt&&En.push(Pe[Yr]);var _i=(pn+1)%2;(pn===0?rt<=Ft:pe<=zt)&&(vr.push(nn),vr.push(Yr-1),vr.push(_i)),(pn===0?ke>=Ft:vt>=zt)&&(vr.push(Yr+1),vr.push(Ot),vr.push(_i))}}return En}(this.ids,this.coords,H,Q,oe,ye,this.nodeSize)},Cr.prototype.within=function(H,Q,oe){return function(ye,Pe,He,rt,pe,ke){for(var vt=[0,ye.length-1,0],pr=[],Ft=pe*pe;vt.length;){var zt=vt.pop(),vr=vt.pop(),En=vt.pop();if(vr-En<=ke)for(var pn=En;pn<=vr;pn++)mt(Pe[2*pn],Pe[2*pn+1],He,rt)<=Ft&&pr.push(ye[pn]);else{var Ot=Math.floor((En+vr)/2),nn=Pe[2*Ot],Zr=Pe[2*Ot+1];mt(nn,Zr,He,rt)<=Ft&&pr.push(ye[Ot]);var Yr=(zt+1)%2;(zt===0?He-pe<=nn:rt-pe<=Zr)&&(vt.push(En),vt.push(Ot-1),vt.push(Yr)),(zt===0?He+pe>=nn:rt+pe>=Zr)&&(vt.push(Ot+1),vt.push(vr),vt.push(Yr))}}return pr}(this.ids,this.coords,H,Q,oe,this.nodeSize)};var ei={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(H){return H}},vn=function(H){this.options=aa(Object.create(ei),H),this.trees=new Array(this.options.maxZoom+1)};function di(H,Q,oe,ye,Pe){return{x:H,y:Q,zoom:1/0,id:oe,parentId:-1,numPoints:ye,properties:Pe}}function Wn(H,Q){var oe=H.geometry.coordinates,ye=oe[1];return{x:qn(oe[0]),y:mi(ye),zoom:1/0,index:Q,parentId:-1}}function si(H){return{type:"Feature",id:H.id,properties:vi(H),geometry:{type:"Point",coordinates:[(ye=H.x,360*(ye-.5)),(Q=H.y,oe=(180-360*Q)*Math.PI/180,360*Math.atan(Math.exp(oe))/Math.PI-90)]}};var Q,oe,ye}function vi(H){var Q=H.numPoints,oe=Q>=1e4?Math.round(Q/1e3)+"k":Q>=1e3?Math.round(Q/100)/10+"k":Q;return aa(aa({},H.properties),{cluster:!0,cluster_id:H.id,point_count:Q,point_count_abbreviated:oe})}function qn(H){return H/360+.5}function mi(H){var Q=Math.sin(H*Math.PI/180),oe=.5-.25*Math.log((1+Q)/(1-Q))/Math.PI;return oe<0?0:oe>1?1:oe}function aa(H,Q){for(var oe in Q)H[oe]=Q[oe];return H}function Wi(H){return H.x}function Oi(H){return H.y}function Ki(H,Q,oe,ye,Pe,He){var rt=Pe-oe,pe=He-ye;if(rt!==0||pe!==0){var ke=((H-oe)*rt+(Q-ye)*pe)/(rt*rt+pe*pe);ke>1?(oe=Pe,ye=He):ke>0&&(oe+=rt*ke,ye+=pe*ke)}return(rt=H-oe)*rt+(pe=Q-ye)*pe}function oa(H,Q,oe,ye){var Pe={id:H===void 0?null:H,type:Q,geometry:oe,tags:ye,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(He){var rt=He.geometry,pe=He.type;if(pe==="Point"||pe==="MultiPoint"||pe==="LineString")Mi(He,rt);else if(pe==="Polygon"||pe==="MultiLineString")for(var ke=0;ke<rt.length;ke++)Mi(He,rt[ke]);else if(pe==="MultiPolygon")for(ke=0;ke<rt.length;ke++)for(var vt=0;vt<rt[ke].length;vt++)Mi(He,rt[ke][vt])}(Pe),Pe}function Mi(H,Q){for(var oe=0;oe<Q.length;oe+=3)H.minX=Math.min(H.minX,Q[oe]),H.minY=Math.min(H.minY,Q[oe+1]),H.maxX=Math.max(H.maxX,Q[oe]),H.maxY=Math.max(H.maxY,Q[oe+1])}function da(H,Q,oe,ye){if(Q.geometry){var Pe=Q.geometry.coordinates,He=Q.geometry.type,rt=Math.pow(oe.tolerance/((1<<oe.maxZoom)*oe.extent),2),pe=[],ke=Q.id;if(oe.promoteId?ke=Q.properties[oe.promoteId]:oe.generateId&&(ke=ye||0),He==="Point")$n(Pe,pe);else if(He==="MultiPoint")for(var vt=0;vt<Pe.length;vt++)$n(Pe[vt],pe);else if(He==="LineString")wi(Pe,pe,rt,!1);else if(He==="MultiLineString"){if(oe.lineMetrics){for(vt=0;vt<Pe.length;vt++)wi(Pe[vt],pe=[],rt,!1),H.push(oa(ke,"LineString",pe,Q.properties));return}ji(Pe,pe,rt,!1)}else if(He==="Polygon")ji(Pe,pe,rt,!0);else{if(He!=="MultiPolygon"){if(He==="GeometryCollection"){for(vt=0;vt<Q.geometry.geometries.length;vt++)da(H,{id:ke,geometry:Q.geometry.geometries[vt],properties:Q.properties},oe,ye);return}throw new Error("Input data is not a valid GeoJSON object.")}for(vt=0;vt<Pe.length;vt++){var pr=[];ji(Pe[vt],pr,rt,!0),pe.push(pr)}}H.push(oa(ke,He,pe,Q.properties))}}function $n(H,Q){Q.push($i(H[0])),Q.push(zo(H[1])),Q.push(0)}function wi(H,Q,oe,ye){for(var Pe,He,rt=0,pe=0;pe<H.length;pe++){var ke=$i(H[pe][0]),vt=zo(H[pe][1]);Q.push(ke),Q.push(vt),Q.push(0),pe>0&&(rt+=ye?(Pe*vt-ke*He)/2:Math.sqrt(Math.pow(ke-Pe,2)+Math.pow(vt-He,2))),Pe=ke,He=vt}var pr=Q.length-3;Q[2]=1,function Ft(zt,vr,En,pn){for(var Ot,nn=pn,Zr=En-vr>>1,Yr=En-vr,_i=zt[vr],an=zt[vr+1],on=zt[En],Xi=zt[En+1],yi=vr+3;yi<En;yi+=3){var Pi=Ki(zt[yi],zt[yi+1],_i,an,on,Xi);if(Pi>nn)Ot=yi,nn=Pi;else if(Pi===nn){var bi=Math.abs(yi-Zr);bi<Yr&&(Ot=yi,Yr=bi)}}nn>pn&&(Ot-vr>3&&Ft(zt,vr,Ot,pn),zt[Ot+2]=nn,En-Ot>3&&Ft(zt,Ot,En,pn))}(Q,0,pr,oe),Q[pr+2]=1,Q.size=Math.abs(rt),Q.start=0,Q.end=Q.size}function ji(H,Q,oe,ye){for(var Pe=0;Pe<H.length;Pe++){var He=[];wi(H[Pe],He,oe,ye),Q.push(He)}}function $i(H){return H/360+.5}function zo(H){var Q=Math.sin(H*Math.PI/180),oe=.5-.25*Math.log((1+Q)/(1-Q))/Math.PI;return oe<0?0:oe>1?1:oe}function me(H,Q,oe,ye,Pe,He,rt,pe){if(ye/=Q,He>=(oe/=Q)&&rt<ye)return H;if(rt<oe||He>=ye)return null;for(var ke=[],vt=0;vt<H.length;vt++){var pr=H[vt],Ft=pr.geometry,zt=pr.type,vr=Pe===0?pr.minX:pr.minY,En=Pe===0?pr.maxX:pr.maxY;if(vr>=oe&&En<ye)ke.push(pr);else if(!(En<oe||vr>=ye)){var pn=[];if(zt==="Point"||zt==="MultiPoint")Dn(Ft,pn,oe,ye,Pe);else if(zt==="LineString")Za(Ft,pn,oe,ye,Pe,!1,pe.lineMetrics);else if(zt==="MultiLineString")Nt(Ft,pn,oe,ye,Pe,!1);else if(zt==="Polygon")Nt(Ft,pn,oe,ye,Pe,!0);else if(zt==="MultiPolygon")for(var Ot=0;Ot<Ft.length;Ot++){var nn=[];Nt(Ft[Ot],nn,oe,ye,Pe,!0),nn.length&&pn.push(nn)}if(pn.length){if(pe.lineMetrics&&zt==="LineString"){for(Ot=0;Ot<pn.length;Ot++)ke.push(oa(pr.id,zt,pn[Ot],pr.tags));continue}zt!=="LineString"&&zt!=="MultiLineString"||(pn.length===1?(zt="LineString",pn=pn[0]):zt="MultiLineString"),zt!=="Point"&&zt!=="MultiPoint"||(zt=pn.length===3?"Point":"MultiPoint"),ke.push(oa(pr.id,zt,pn,pr.tags))}}}return ke.length?ke:null}function Dn(H,Q,oe,ye,Pe){for(var He=0;He<H.length;He+=3){var rt=H[He+Pe];rt>=oe&&rt<=ye&&(Q.push(H[He]),Q.push(H[He+1]),Q.push(H[He+2]))}}function Za(H,Q,oe,ye,Pe,He,rt){for(var pe,ke,vt=hs(H),pr=Pe===0?Ar:rn,Ft=H.start,zt=0;zt<H.length-3;zt+=3){var vr=H[zt],En=H[zt+1],pn=H[zt+2],Ot=H[zt+3],nn=H[zt+4],Zr=Pe===0?vr:En,Yr=Pe===0?Ot:nn,_i=!1;rt&&(pe=Math.sqrt(Math.pow(vr-Ot,2)+Math.pow(En-nn,2))),Zr<oe?Yr>oe&&(ke=pr(vt,vr,En,Ot,nn,oe),rt&&(vt.start=Ft+pe*ke)):Zr>ye?Yr<ye&&(ke=pr(vt,vr,En,Ot,nn,ye),rt&&(vt.start=Ft+pe*ke)):nr(vt,vr,En,pn),Yr<oe&&Zr>=oe&&(ke=pr(vt,vr,En,Ot,nn,oe),_i=!0),Yr>ye&&Zr<=ye&&(ke=pr(vt,vr,En,Ot,nn,ye),_i=!0),!He&&_i&&(rt&&(vt.end=Ft+pe*ke),Q.push(vt),vt=hs(H)),rt&&(Ft+=pe)}var an=H.length-3;vr=H[an],En=H[an+1],pn=H[an+2],(Zr=Pe===0?vr:En)>=oe&&Zr<=ye&&nr(vt,vr,En,pn),an=vt.length-3,He&&an>=3&&(vt[an]!==vt[0]||vt[an+1]!==vt[1])&&nr(vt,vt[0],vt[1],vt[2]),vt.length&&Q.push(vt)}function hs(H){var Q=[];return Q.size=H.size,Q.start=H.start,Q.end=H.end,Q}function Nt(H,Q,oe,ye,Pe,He){for(var rt=0;rt<H.length;rt++)Za(H[rt],Q,oe,ye,Pe,He,!1)}function nr(H,Q,oe,ye){H.push(Q),H.push(oe),H.push(ye)}function Ar(H,Q,oe,ye,Pe,He){var rt=(He-Q)/(ye-Q);return H.push(He),H.push(oe+(Pe-oe)*rt),H.push(1),rt}function rn(H,Q,oe,ye,Pe,He){var rt=(He-oe)/(Pe-oe);return H.push(Q+(ye-Q)*rt),H.push(He),H.push(1),rt}function wn(H,Q){for(var oe=[],ye=0;ye<H.length;ye++){var Pe,He=H[ye],rt=He.type;if(rt==="Point"||rt==="MultiPoint"||rt==="LineString")Pe=Fn(He.geometry,Q);else if(rt==="MultiLineString"||rt==="Polygon"){Pe=[];for(var pe=0;pe<He.geometry.length;pe++)Pe.push(Fn(He.geometry[pe],Q))}else if(rt==="MultiPolygon")for(Pe=[],pe=0;pe<He.geometry.length;pe++){for(var ke=[],vt=0;vt<He.geometry[pe].length;vt++)ke.push(Fn(He.geometry[pe][vt],Q));Pe.push(ke)}oe.push(oa(He.id,rt,Pe,He.tags))}return oe}function Fn(H,Q){var oe=[];oe.size=H.size,H.start!==void 0&&(oe.start=H.start,oe.end=H.end);for(var ye=0;ye<H.length;ye+=3)oe.push(H[ye]+Q,H[ye+1],H[ye+2]);return oe}function gi(H,Q){if(H.transformed)return H;var oe,ye,Pe,He=1<<H.z,rt=H.x,pe=H.y;for(oe=0;oe<H.features.length;oe++){var ke=H.features[oe],vt=ke.geometry,pr=ke.type;if(ke.geometry=[],pr===1)for(ye=0;ye<vt.length;ye+=2)ke.geometry.push(ti(vt[ye],vt[ye+1],Q,He,rt,pe));else for(ye=0;ye<vt.length;ye++){var Ft=[];for(Pe=0;Pe<vt[ye].length;Pe+=2)Ft.push(ti(vt[ye][Pe],vt[ye][Pe+1],Q,He,rt,pe));ke.geometry.push(Ft)}}return H.transformed=!0,H}function ti(H,Q,oe,ye,Pe,He){return[Math.round(oe*(H*ye-Pe)),Math.round(oe*(Q*ye-He))]}function fn(H,Q,oe,ye,Pe){for(var He=Q===Pe.maxZoom?0:Pe.tolerance/((1<<Q)*Pe.extent),rt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:oe,y:ye,z:Q,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},pe=0;pe<H.length;pe++){rt.numFeatures++,Di(rt,H[pe],He,Pe);var ke=H[pe].minX,vt=H[pe].minY,pr=H[pe].maxX,Ft=H[pe].maxY;ke<rt.minX&&(rt.minX=ke),vt<rt.minY&&(rt.minY=vt),pr>rt.maxX&&(rt.maxX=pr),Ft>rt.maxY&&(rt.maxY=Ft)}return rt}function Di(H,Q,oe,ye){var Pe=Q.geometry,He=Q.type,rt=[];if(He==="Point"||He==="MultiPoint")for(var pe=0;pe<Pe.length;pe+=3)rt.push(Pe[pe]),rt.push(Pe[pe+1]),H.numPoints++,H.numSimplified++;else if(He==="LineString")Ri(rt,Pe,H,oe,!1,!1);else if(He==="MultiLineString"||He==="Polygon")for(pe=0;pe<Pe.length;pe++)Ri(rt,Pe[pe],H,oe,He==="Polygon",pe===0);else if(He==="MultiPolygon")for(var ke=0;ke<Pe.length;ke++){var vt=Pe[ke];for(pe=0;pe<vt.length;pe++)Ri(rt,vt[pe],H,oe,!0,pe===0)}if(rt.length){var pr=Q.tags||null;if(He==="LineString"&&ye.lineMetrics){for(var Ft in pr={},Q.tags)pr[Ft]=Q.tags[Ft];pr.mapbox_clip_start=Pe.start/Pe.size,pr.mapbox_clip_end=Pe.end/Pe.size}var zt={geometry:rt,type:He==="Polygon"||He==="MultiPolygon"?3:He==="LineString"||He==="MultiLineString"?2:1,tags:pr};Q.id!==null&&(zt.id=Q.id),H.features.push(zt)}}function Ri(H,Q,oe,ye,Pe,He){var rt=ye*ye;if(ye>0&&Q.size<(Pe?rt:ye))oe.numPoints+=Q.length/3;else{for(var pe=[],ke=0;ke<Q.length;ke+=3)(ye===0||Q[ke+2]>rt)&&(oe.numSimplified++,pe.push(Q[ke]),pe.push(Q[ke+1])),oe.numPoints++;Pe&&function(vt,pr){for(var Ft=0,zt=0,vr=vt.length,En=vr-2;zt<vr;En=zt,zt+=2)Ft+=(vt[zt]-vt[En])*(vt[zt+1]+vt[En+1]);if(Ft>0===pr)for(zt=0,vr=vt.length;zt<vr/2;zt+=2){var pn=vt[zt],Ot=vt[zt+1];vt[zt]=vt[vr-2-zt],vt[zt+1]=vt[vr-1-zt],vt[vr-2-zt]=pn,vt[vr-1-zt]=Ot}}(pe,He),H.push(pe)}}function to(H,Q){var oe=(Q=this.options=function(Pe,He){for(var rt in He)Pe[rt]=He[rt];return Pe}(Object.create(this.options),Q)).debug;if(oe&&console.time("preprocess data"),Q.maxZoom<0||Q.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Q.promoteId&&Q.generateId)throw new Error("promoteId and generateId cannot be used together.");var ye=function(Pe,He){var rt=[];if(Pe.type==="FeatureCollection")for(var pe=0;pe<Pe.features.length;pe++)da(rt,Pe.features[pe],He,pe);else da(rt,Pe.type==="Feature"?Pe:{geometry:Pe},He);return rt}(H,Q);this.tiles={},this.tileCoords=[],oe&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Q.indexMaxZoom,Q.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(ye=function(Pe,He){var rt=He.buffer/He.extent,pe=Pe,ke=me(Pe,1,-1-rt,rt,0,-1,2,He),vt=me(Pe,1,1-rt,2+rt,0,-1,2,He);return(ke||vt)&&(pe=me(Pe,1,-rt,1+rt,0,-1,2,He)||[],ke&&(pe=wn(ke,1).concat(pe)),vt&&(pe=pe.concat(wn(vt,-1)))),pe}(ye,Q)).length&&this.splitTile(ye,0,0,0),oe&&(ye.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Es(H,Q,oe){return 32*((1<<H)*oe+Q)+H}function Ko(H,Q){var oe=H.tileID.canonical;if(!this._geoJSONIndex)return Q(null,null);var ye=this._geoJSONIndex.getTile(oe.z,oe.x,oe.y);if(!ye)return Q(null,null);var Pe=new at(ye.features),He=ft(Pe);He.byteOffset===0&&He.byteLength===He.buffer.byteLength||(He=new Uint8Array(He)),Q(null,{vectorTile:Pe,rawData:He.buffer})}vn.prototype.load=function(H){var Q=this.options,oe=Q.log,ye=Q.minZoom,Pe=Q.maxZoom,He=Q.nodeSize;oe&&console.time("total time");var rt="prepare "+H.length+" points";oe&&console.time(rt),this.points=H;for(var pe=[],ke=0;ke<H.length;ke++)H[ke].geometry&&pe.push(Wn(H[ke],ke));this.trees[Pe+1]=new Cr(pe,Wi,Oi,He,Float32Array),oe&&console.timeEnd(rt);for(var vt=Pe;vt>=ye;vt--){var pr=+Date.now();pe=this._cluster(pe,vt),this.trees[vt]=new Cr(pe,Wi,Oi,He,Float32Array),oe&&console.log("z%d: %d clusters in %dms",vt,pe.length,+Date.now()-pr)}return oe&&console.timeEnd("total time"),this},vn.prototype.getClusters=function(H,Q){var oe=((H[0]+180)%360+360)%360-180,ye=Math.max(-90,Math.min(90,H[1])),Pe=H[2]===180?180:((H[2]+180)%360+360)%360-180,He=Math.max(-90,Math.min(90,H[3]));if(H[2]-H[0]>=360)oe=-180,Pe=180;else if(oe>Pe){var rt=this.getClusters([oe,ye,180,He],Q),pe=this.getClusters([-180,ye,Pe,He],Q);return rt.concat(pe)}for(var ke=this.trees[this._limitZoom(Q)],vt=[],pr=0,Ft=ke.range(qn(oe),mi(He),qn(Pe),mi(ye));pr<Ft.length;pr+=1){var zt=ke.points[Ft[pr]];vt.push(zt.numPoints?si(zt):this.points[zt.index])}return vt},vn.prototype.getChildren=function(H){var Q=this._getOriginId(H),oe=this._getOriginZoom(H),ye="No cluster with the specified id.",Pe=this.trees[oe];if(!Pe)throw new Error(ye);var He=Pe.points[Q];if(!He)throw new Error(ye);for(var rt=this.options.radius/(this.options.extent*Math.pow(2,oe-1)),pe=[],ke=0,vt=Pe.within(He.x,He.y,rt);ke<vt.length;ke+=1){var pr=Pe.points[vt[ke]];pr.parentId===H&&pe.push(pr.numPoints?si(pr):this.points[pr.index])}if(pe.length===0)throw new Error(ye);return pe},vn.prototype.getLeaves=function(H,Q,oe){var ye=[];return this._appendLeaves(ye,H,Q=Q||10,oe=oe||0,0),ye},vn.prototype.getTile=function(H,Q,oe){var ye=this.trees[this._limitZoom(H)],Pe=Math.pow(2,H),He=this.options,rt=He.radius/He.extent,pe=(oe-rt)/Pe,ke=(oe+1+rt)/Pe,vt={features:[]};return this._addTileFeatures(ye.range((Q-rt)/Pe,pe,(Q+1+rt)/Pe,ke),ye.points,Q,oe,Pe,vt),Q===0&&this._addTileFeatures(ye.range(1-rt/Pe,pe,1,ke),ye.points,Pe,oe,Pe,vt),Q===Pe-1&&this._addTileFeatures(ye.range(0,pe,rt/Pe,ke),ye.points,-1,oe,Pe,vt),vt.features.length?vt:null},vn.prototype.getClusterExpansionZoom=function(H){for(var Q=this._getOriginZoom(H)-1;Q<=this.options.maxZoom;){var oe=this.getChildren(H);if(Q++,oe.length!==1)break;H=oe[0].properties.cluster_id}return Q},vn.prototype._appendLeaves=function(H,Q,oe,ye,Pe){for(var He=0,rt=this.getChildren(Q);He<rt.length;He+=1){var pe=rt[He],ke=pe.properties;if(ke&&ke.cluster?Pe+ke.point_count<=ye?Pe+=ke.point_count:Pe=this._appendLeaves(H,ke.cluster_id,oe,ye,Pe):Pe<ye?Pe++:H.push(pe),H.length===oe)break}return Pe},vn.prototype._addTileFeatures=function(H,Q,oe,ye,Pe,He){for(var rt=0,pe=H;rt<pe.length;rt+=1){var ke=Q[pe[rt]],vt=ke.numPoints,pr={type:1,geometry:[[Math.round(this.options.extent*(ke.x*Pe-oe)),Math.round(this.options.extent*(ke.y*Pe-ye))]],tags:vt?vi(ke):this.points[ke.index].properties},Ft=void 0;vt?Ft=ke.id:this.options.generateId?Ft=ke.index:this.points[ke.index].id&&(Ft=this.points[ke.index].id),Ft!==void 0&&(pr.id=Ft),He.features.push(pr)}},vn.prototype._limitZoom=function(H){return Math.max(this.options.minZoom,Math.min(+H,this.options.maxZoom+1))},vn.prototype._cluster=function(H,Q){for(var oe=[],ye=this.options,Pe=ye.reduce,He=ye.minPoints,rt=ye.radius/(ye.extent*Math.pow(2,Q)),pe=0;pe<H.length;pe++){var ke=H[pe];if(!(ke.zoom<=Q)){ke.zoom=Q;for(var vt=this.trees[Q+1],pr=vt.within(ke.x,ke.y,rt),Ft=ke.numPoints||1,zt=Ft,vr=0,En=pr;vr<En.length;vr+=1){var pn=vt.points[En[vr]];pn.zoom>Q&&(zt+=pn.numPoints||1)}if(zt>=He){for(var Ot=ke.x*Ft,nn=ke.y*Ft,Zr=Pe&&Ft>1?this._map(ke,!0):null,Yr=(pe<<5)+(Q+1)+this.points.length,_i=0,an=pr;_i<an.length;_i+=1){var on=vt.points[an[_i]];if(!(on.zoom<=Q)){on.zoom=Q;var Xi=on.numPoints||1;Ot+=on.x*Xi,nn+=on.y*Xi,on.parentId=Yr,Pe&&(Zr||(Zr=this._map(ke,!0)),Pe(Zr,this._map(on)))}}ke.parentId=Yr,oe.push(di(Ot/zt,nn/zt,Yr,zt,Zr))}else if(oe.push(ke),zt>1)for(var yi=0,Pi=pr;yi<Pi.length;yi+=1){var bi=vt.points[Pi[yi]];bi.zoom<=Q||(bi.zoom=Q,oe.push(bi))}}}return oe},vn.prototype._getOriginId=function(H){return H-this.points.length>>5},vn.prototype._getOriginZoom=function(H){return(H-this.points.length)%32},vn.prototype._map=function(H,Q){if(H.numPoints)return Q?aa({},H.properties):H.properties;var oe=this.points[H.index].properties,ye=this.options.map(oe);return Q&&ye===oe?aa({},ye):ye},to.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},to.prototype.splitTile=function(H,Q,oe,ye,Pe,He,rt){for(var pe=[H,Q,oe,ye],ke=this.options,vt=ke.debug;pe.length;){ye=pe.pop(),oe=pe.pop(),Q=pe.pop(),H=pe.pop();var pr=1<<Q,Ft=Es(Q,oe,ye),zt=this.tiles[Ft];if(!zt&&(vt>1&&console.time("creation"),zt=this.tiles[Ft]=fn(H,Q,oe,ye,ke),this.tileCoords.push({z:Q,x:oe,y:ye}),vt)){vt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Q,oe,ye,zt.numFeatures,zt.numPoints,zt.numSimplified),console.timeEnd("creation"));var vr="z"+Q;this.stats[vr]=(this.stats[vr]||0)+1,this.total++}if(zt.source=H,Pe){if(Q===ke.maxZoom||Q===Pe)continue;var En=1<<Pe-Q;if(oe!==Math.floor(He/En)||ye!==Math.floor(rt/En))continue}else if(Q===ke.indexMaxZoom||zt.numPoints<=ke.indexMaxPoints)continue;if(zt.source=null,H.length!==0){vt>1&&console.time("clipping");var pn,Ot,nn,Zr,Yr,_i,an=.5*ke.buffer/ke.extent,on=.5-an,Xi=.5+an,yi=1+an;pn=Ot=nn=Zr=null,Yr=me(H,pr,oe-an,oe+Xi,0,zt.minX,zt.maxX,ke),_i=me(H,pr,oe+on,oe+yi,0,zt.minX,zt.maxX,ke),H=null,Yr&&(pn=me(Yr,pr,ye-an,ye+Xi,1,zt.minY,zt.maxY,ke),Ot=me(Yr,pr,ye+on,ye+yi,1,zt.minY,zt.maxY,ke),Yr=null),_i&&(nn=me(_i,pr,ye-an,ye+Xi,1,zt.minY,zt.maxY,ke),Zr=me(_i,pr,ye+on,ye+yi,1,zt.minY,zt.maxY,ke),_i=null),vt>1&&console.timeEnd("clipping"),pe.push(pn||[],Q+1,2*oe,2*ye),pe.push(Ot||[],Q+1,2*oe,2*ye+1),pe.push(nn||[],Q+1,2*oe+1,2*ye),pe.push(Zr||[],Q+1,2*oe+1,2*ye+1)}}},to.prototype.getTile=function(H,Q,oe){var ye=this.options,Pe=ye.extent,He=ye.debug;if(H<0||H>24)return null;var rt=1<<H,pe=Es(H,Q=(Q%rt+rt)%rt,oe);if(this.tiles[pe])return gi(this.tiles[pe],Pe);He>1&&console.log("drilling down to z%d-%d-%d",H,Q,oe);for(var ke,vt=H,pr=Q,Ft=oe;!ke&&vt>0;)vt--,pr=Math.floor(pr/2),Ft=Math.floor(Ft/2),ke=this.tiles[Es(vt,pr,Ft)];return ke&&ke.source?(He>1&&console.log("found parent tile z%d-%d-%d",vt,pr,Ft),He>1&&console.time("drilling down"),this.splitTile(ke.source,vt,pr,Ft,H,Q,oe),He>1&&console.timeEnd("drilling down"),this.tiles[pe]?gi(this.tiles[pe],Pe):null):null};var Ba=function(H){function Q(oe,ye,Pe,He){H.call(this,oe,ye,Pe,Ko),He&&(this.loadGeoJSON=He)}return H&&(Q.__proto__=H),(Q.prototype=Object.create(H&&H.prototype)).constructor=Q,Q.prototype.loadData=function(oe,ye){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=ye,this._pendingLoadDataParams=oe,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},Q.prototype._loadData=function(){var oe=this;if(this._pendingCallback&&this._pendingLoadDataParams){var ye=this._pendingCallback,Pe=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var He=!!(Pe&&Pe.request&&Pe.request.collectResourceTiming)&&new m.RequestPerformance(Pe.request);this.loadGeoJSON(Pe,function(rt,pe){if(rt||!pe)return ye(rt);if(typeof pe!="object")return ye(new Error("Input data given to '"+Pe.source+"' is not a valid GeoJSON object."));(function zt(vr,En){var pn,Ot=vr&&vr.type;if(Ot==="FeatureCollection")for(pn=0;pn<vr.features.length;pn++)zt(vr.features[pn],En);else if(Ot==="GeometryCollection")for(pn=0;pn<vr.geometries.length;pn++)zt(vr.geometries[pn],En);else if(Ot==="Feature")zt(vr.geometry,En);else if(Ot==="Polygon")rr(vr.coordinates,En);else if(Ot==="MultiPolygon")for(pn=0;pn<vr.coordinates.length;pn++)rr(vr.coordinates[pn],En);return vr})(pe,!0);try{if(Pe.filter){var ke=m.createExpression(Pe.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ke.result==="error")throw new Error(ke.value.map(function(zt){return zt.key+": "+zt.message}).join(", "));var vt=pe.features.filter(function(zt){return ke.value.evaluate({zoom:0},zt)});pe={type:"FeatureCollection",features:vt}}oe._geoJSONIndex=Pe.cluster?new vn(function(zt){var vr=zt.superclusterOptions,En=zt.clusterProperties;if(!En||!vr)return vr;for(var pn={},Ot={},nn={accumulated:null,zoom:0},Zr={properties:null},Yr=Object.keys(En),_i=0,an=Yr;_i<an.length;_i+=1){var on=an[_i],Xi=En[on],yi=Xi[0],Pi=m.createExpression(Xi[1]),bi=m.createExpression(typeof yi=="string"?[yi,["accumulated"],["get",on]]:yi);pn[on]=Pi.value,Ot[on]=bi.value}return vr.map=function(ht){Zr.properties=ht;for(var Pt={},Aa=0,qi=Yr;Aa<qi.length;Aa+=1){var Ii=qi[Aa];Pt[Ii]=pn[Ii].evaluate(nn,Zr)}return Pt},vr.reduce=function(ht,Pt){Zr.properties=Pt;for(var Aa=0,qi=Yr;Aa<qi.length;Aa+=1){var Ii=qi[Aa];nn.accumulated=ht[Ii],ht[Ii]=Ot[Ii].evaluate(nn,Zr)}},vr}(Pe)).load(pe.features):function(zt,vr){return new to(zt,vr)}(pe,Pe.geojsonVtOptions)}catch(zt){return ye(zt)}oe.loaded={};var pr={};if(He){var Ft=He.finish();Ft&&(pr.resourceTiming={},pr.resourceTiming[Pe.source]=JSON.parse(JSON.stringify(Ft)))}ye(null,pr)})}},Q.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},Q.prototype.reloadTile=function(oe,ye){var Pe=this.loaded;return Pe&&Pe[oe.uid]?H.prototype.reloadTile.call(this,oe,ye):this.loadTile(oe,ye)},Q.prototype.loadGeoJSON=function(oe,ye){if(oe.request)m.getJSON(oe.request,ye);else{if(typeof oe.data!="string")return ye(new Error("Input data given to '"+oe.source+"' is not a valid GeoJSON object."));try{return ye(null,JSON.parse(oe.data))}catch(Pe){return ye(new Error("Input data given to '"+oe.source+"' is not a valid GeoJSON object."))}}},Q.prototype.removeSource=function(oe,ye){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),ye()},Q.prototype.getClusterExpansionZoom=function(oe,ye){try{ye(null,this._geoJSONIndex.getClusterExpansionZoom(oe.clusterId))}catch(Pe){ye(Pe)}},Q.prototype.getClusterChildren=function(oe,ye){try{ye(null,this._geoJSONIndex.getChildren(oe.clusterId))}catch(Pe){ye(Pe)}},Q.prototype.getClusterLeaves=function(oe,ye){try{ye(null,this._geoJSONIndex.getLeaves(oe.clusterId,oe.limit,oe.offset))}catch(Pe){ye(Pe)}},Q}(et),xa=function(H){var Q=this;this.self=H,this.actor=new m.Actor(H,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:et,geojson:Ba},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(oe,ye){if(Q.workerSourceTypes[oe])throw new Error('Worker source with name "'+oe+'" already registered.');Q.workerSourceTypes[oe]=ye},this.self.registerRTLTextPlugin=function(oe){if(m.plugin.isParsed())throw new Error("RTL text plugin already registered.");m.plugin.applyArabicShaping=oe.applyArabicShaping,m.plugin.processBidirectionalText=oe.processBidirectionalText,m.plugin.processStyledBidirectionalText=oe.processStyledBidirectionalText}};return xa.prototype.setReferrer=function(H,Q){this.referrer=Q},xa.prototype.setImages=function(H,Q,oe){for(var ye in this.availableImages[H]=Q,this.workerSources[H]){var Pe=this.workerSources[H][ye];for(var He in Pe)Pe[He].availableImages=Q}oe()},xa.prototype.setLayers=function(H,Q,oe){this.getLayerIndex(H).replace(Q),oe()},xa.prototype.updateLayers=function(H,Q,oe){this.getLayerIndex(H).update(Q.layers,Q.removedIds),oe()},xa.prototype.loadTile=function(H,Q,oe){this.getWorkerSource(H,Q.type,Q.source).loadTile(Q,oe)},xa.prototype.loadDEMTile=function(H,Q,oe){this.getDEMWorkerSource(H,Q.source).loadTile(Q,oe)},xa.prototype.reloadTile=function(H,Q,oe){this.getWorkerSource(H,Q.type,Q.source).reloadTile(Q,oe)},xa.prototype.abortTile=function(H,Q,oe){this.getWorkerSource(H,Q.type,Q.source).abortTile(Q,oe)},xa.prototype.removeTile=function(H,Q,oe){this.getWorkerSource(H,Q.type,Q.source).removeTile(Q,oe)},xa.prototype.removeDEMTile=function(H,Q){this.getDEMWorkerSource(H,Q.source).removeTile(Q)},xa.prototype.removeSource=function(H,Q,oe){if(this.workerSources[H]&&this.workerSources[H][Q.type]&&this.workerSources[H][Q.type][Q.source]){var ye=this.workerSources[H][Q.type][Q.source];delete this.workerSources[H][Q.type][Q.source],ye.removeSource!==void 0?ye.removeSource(Q,oe):oe()}},xa.prototype.loadWorkerSource=function(H,Q,oe){try{this.self.importScripts(Q.url),oe()}catch(ye){oe(ye.toString())}},xa.prototype.syncRTLPluginState=function(H,Q,oe){try{m.plugin.setState(Q);var ye=m.plugin.getPluginURL();if(m.plugin.isLoaded()&&!m.plugin.isParsed()&&ye!=null){this.self.importScripts(ye);var Pe=m.plugin.isParsed();oe(Pe?void 0:new Error("RTL Text Plugin failed to import scripts from "+ye),Pe)}}catch(He){oe(He.toString())}},xa.prototype.getAvailableImages=function(H){var Q=this.availableImages[H];return Q||(Q=[]),Q},xa.prototype.getLayerIndex=function(H){var Q=this.layerIndexes[H];return Q||(Q=this.layerIndexes[H]=new le),Q},xa.prototype.getWorkerSource=function(H,Q,oe){var ye=this;return this.workerSources[H]||(this.workerSources[H]={}),this.workerSources[H][Q]||(this.workerSources[H][Q]={}),this.workerSources[H][Q][oe]||(this.workerSources[H][Q][oe]=new this.workerSourceTypes[Q]({send:function(Pe,He,rt){ye.actor.send(Pe,He,rt,H)}},this.getLayerIndex(H),this.getAvailableImages(H))),this.workerSources[H][Q][oe]},xa.prototype.getDEMWorkerSource=function(H,Q){return this.demWorkerSources[H]||(this.demWorkerSources[H]={}),this.demWorkerSources[H][Q]||(this.demWorkerSources[H][Q]=new gt),this.demWorkerSources[H][Q]},xa.prototype.enforceCacheSizeLimit=function(H,Q){m.enforceCacheSizeLimit(Q)},typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new xa(self)),xa}),re(["./shared"],function(m){"use strict";var ve=m.createCommonjsModule(function(l){function h(E){return!c(E)}function c(E){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var P,L,N=new Blob([""],{type:"text/javascript"}),q=URL.createObjectURL(N);try{L=new Worker(q),P=!0}catch(ce){P=!1}return L&&L.terminate(),URL.revokeObjectURL(q),P}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var P=document.createElement("canvas");P.width=P.height=1;var L=P.getContext("2d");if(!L)return!1;var N=L.getImageData(0,0,1,1);return N&&N.width===P.width}()?(d[w=E&&E.failIfMajorPerformanceCaveat]===void 0&&(d[w]=function(P){var L=function(q){var ce=document.createElement("canvas"),he=Object.create(h.webGLContextAttributes);return he.failIfMajorPerformanceCaveat=q,ce.probablySupportsContext?ce.probablySupportsContext("webgl",he)||ce.probablySupportsContext("experimental-webgl",he):ce.supportsContext?ce.supportsContext("webgl",he)||ce.supportsContext("experimental-webgl",he):ce.getContext("webgl",he)||ce.getContext("experimental-webgl",he)}(P);if(!L)return!1;var N=L.createShader(L.VERTEX_SHADER);return!(!N||L.isContextLost())&&(L.shaderSource(N,"void main() {}"),L.compileShader(N),L.getShaderParameter(N,L.COMPILE_STATUS)===!0)}(w)),d[w]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var w}l.exports?l.exports=h:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=h,window.mapboxgl.notSupportedReason=c);var d={};h.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),Z={create:function(l,h,c){var d=m.window.document.createElement(l);return h!==void 0&&(d.className=h),c&&c.appendChild(d),d},createNS:function(l,h){return m.window.document.createElementNS(l,h)}},le=m.window.document&&m.window.document.documentElement.style;function fe(l){if(!le)return l[0];for(var h=0;h<l.length;h++)if(l[h]in le)return l[h];return l[0]}var Le,J=fe(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);Z.disableDrag=function(){le&&J&&(Le=le[J],le[J]="none")},Z.enableDrag=function(){le&&J&&(le[J]=Le)};var Xe=fe(["transform","WebkitTransform"]);Z.setTransform=function(l,h){l.style[Xe]=h};var et=!1;try{var Ue=Object.defineProperty({},"passive",{get:function(){et=!0}});m.window.addEventListener("test",Ue,Ue),m.window.removeEventListener("test",Ue,Ue)}catch(l){et=!1}Z.addEventListener=function(l,h,c,d){d===void 0&&(d={}),l.addEventListener(h,c,"passive"in d&&et?d:d.capture)},Z.removeEventListener=function(l,h,c,d){d===void 0&&(d={}),l.removeEventListener(h,c,"passive"in d&&et?d:d.capture)};var gt=function(l){l.preventDefault(),l.stopPropagation(),m.window.removeEventListener("click",gt,!0)};function rr(l){var h=l.userImage;return!!(h&&h.render&&h.render())&&(l.data.replace(new Uint8Array(h.data.buffer)),!0)}Z.suppressClick=function(){m.window.addEventListener("click",gt,!0),m.window.setTimeout(function(){m.window.removeEventListener("click",gt,!0)},0)},Z.mousePos=function(l,h){var c=l.getBoundingClientRect();return new m.Point(h.clientX-c.left-l.clientLeft,h.clientY-c.top-l.clientTop)},Z.touchPos=function(l,h){for(var c=l.getBoundingClientRect(),d=[],E=0;E<h.length;E++)d.push(new m.Point(h[E].clientX-c.left-l.clientLeft,h[E].clientY-c.top-l.clientTop));return d},Z.mouseButton=function(l){return m.window.InstallTrigger!==void 0&&l.button===2&&l.ctrlKey&&m.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:l.button},Z.remove=function(l){l.parentNode&&l.parentNode.removeChild(l)};var xt=function(l){function h(){l.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new m.RGBAImage({width:1,height:1}),this.dirty=!0}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.isLoaded=function(){return this.loaded},h.prototype.setLoaded=function(c){if(this.loaded!==c&&(this.loaded=c,c)){for(var d=0,E=this.requestors;d<E.length;d+=1){var w=E[d];this._notify(w.ids,w.callback)}this.requestors=[]}},h.prototype.getImage=function(c){return this.images[c]},h.prototype.addImage=function(c,d){this._validate(c,d)&&(this.images[c]=d)},h.prototype._validate=function(c,d){var E=!0;return this._validateStretch(d.stretchX,d.data&&d.data.width)||(this.fire(new m.ErrorEvent(new Error('Image "'+c+'" has invalid "stretchX" value'))),E=!1),this._validateStretch(d.stretchY,d.data&&d.data.height)||(this.fire(new m.ErrorEvent(new Error('Image "'+c+'" has invalid "stretchY" value'))),E=!1),this._validateContent(d.content,d)||(this.fire(new m.ErrorEvent(new Error('Image "'+c+'" has invalid "content" value'))),E=!1),E},h.prototype._validateStretch=function(c,d){if(!c)return!0;for(var E=0,w=0,P=c;w<P.length;w+=1){var L=P[w];if(L[0]<E||L[1]<L[0]||d<L[1])return!1;E=L[1]}return!0},h.prototype._validateContent=function(c,d){return!(c&&(c.length!==4||c[0]<0||d.data.width<c[0]||c[1]<0||d.data.height<c[1]||c[2]<0||d.data.width<c[2]||c[3]<0||d.data.height<c[3]||c[2]<c[0]||c[3]<c[1]))},h.prototype.updateImage=function(c,d){d.version=this.images[c].version+1,this.images[c]=d,this.updatedImages[c]=!0},h.prototype.removeImage=function(c){var d=this.images[c];delete this.images[c],delete this.patterns[c],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()},h.prototype.listImages=function(){return Object.keys(this.images)},h.prototype.getImages=function(c,d){var E=!0;if(!this.isLoaded())for(var w=0,P=c;w<P.length;w+=1)this.images[P[w]]||(E=!1);this.isLoaded()||E?this._notify(c,d):this.requestors.push({ids:c,callback:d})},h.prototype._notify=function(c,d){for(var E={},w=0,P=c;w<P.length;w+=1){var L=P[w];this.images[L]||this.fire(new m.Event("styleimagemissing",{id:L}));var N=this.images[L];N?E[L]={data:N.data.clone(),pixelRatio:N.pixelRatio,sdf:N.sdf,version:N.version,stretchX:N.stretchX,stretchY:N.stretchY,content:N.content,hasRenderCallback:Boolean(N.userImage&&N.userImage.render)}:m.warnOnce('Image "'+L+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}d(null,E)},h.prototype.getPixelSize=function(){var c=this.atlasImage;return{width:c.width,height:c.height}},h.prototype.getPattern=function(c){var d=this.patterns[c],E=this.getImage(c);if(!E)return null;if(d&&d.position.version===E.version)return d.position;if(d)d.position.version=E.version;else{var w={w:E.data.width+2,h:E.data.height+2,x:0,y:0},P=new m.ImagePosition(w,E);this.patterns[c]={bin:w,position:P}}return this._updatePatternAtlas(),this.patterns[c].position},h.prototype.bind=function(c){var d=c.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new m.Texture(c,this.atlasImage,d.RGBA),this.atlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE)},h.prototype._updatePatternAtlas=function(){var c=[];for(var d in this.patterns)c.push(this.patterns[d].bin);var E=m.potpack(c),w=E.w,P=E.h,L=this.atlasImage;for(var N in L.resize({width:w||1,height:P||1}),this.patterns){var q=this.patterns[N].bin,ce=q.x+1,he=q.y+1,de=this.images[N].data,Re=de.width,Ie=de.height;m.RGBAImage.copy(de,L,{x:0,y:0},{x:ce,y:he},{width:Re,height:Ie}),m.RGBAImage.copy(de,L,{x:0,y:Ie-1},{x:ce,y:he-1},{width:Re,height:1}),m.RGBAImage.copy(de,L,{x:0,y:0},{x:ce,y:he+Ie},{width:Re,height:1}),m.RGBAImage.copy(de,L,{x:Re-1,y:0},{x:ce-1,y:he},{width:1,height:Ie}),m.RGBAImage.copy(de,L,{x:0,y:0},{x:ce+Re,y:he},{width:1,height:Ie})}this.dirty=!0},h.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},h.prototype.dispatchRenderCallbacks=function(c){for(var d=0,E=c;d<E.length;d+=1){var w=E[d];if(!this.callbackDispatchedThisFrame[w]){this.callbackDispatchedThisFrame[w]=!0;var P=this.images[w];rr(P)&&this.updateImage(w,P)}}},h}(m.Evented),Yt=it,Et=it,at=1e20;function it(l,h,c,d,E,w){this.fontSize=l||24,this.buffer=h===void 0?3:h,this.cutoff=d||.25,this.fontFamily=E||"sans-serif",this.fontWeight=w||"normal",this.radius=c||8;var P=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=P,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(P*P),this.gridInner=new Float64Array(P*P),this.f=new Float64Array(P),this.d=new Float64Array(P),this.z=new Float64Array(P+1),this.v=new Int16Array(P),this.middle=Math.round(P/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Zt(l,h,c,d,E,w,P){for(var L=0;L<h;L++){for(var N=0;N<c;N++)d[N]=l[N*h+L];for(Y(d,E,w,P,c),N=0;N<c;N++)l[N*h+L]=E[N]}for(N=0;N<c;N++){for(L=0;L<h;L++)d[L]=l[N*h+L];for(Y(d,E,w,P,h),L=0;L<h;L++)l[N*h+L]=Math.sqrt(E[L])}}function Y(l,h,c,d,E){c[0]=0,d[0]=-at,d[1]=+at;for(var w=1,P=0;w<E;w++){for(var L=(l[w]+w*w-(l[c[P]]+c[P]*c[P]))/(2*w-2*c[P]);L<=d[P];)P--,L=(l[w]+w*w-(l[c[P]]+c[P]*c[P]))/(2*w-2*c[P]);c[++P]=w,d[P]=L,d[P+1]=+at}for(w=0,P=0;w<E;w++){for(;d[P+1]<w;)P++;h[w]=(w-c[P])*(w-c[P])+l[c[P]]}}it.prototype.draw=function(l){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(l,this.buffer,this.middle);for(var h=this.ctx.getImageData(0,0,this.size,this.size),c=new Uint8ClampedArray(this.size*this.size),d=0;d<this.size*this.size;d++){var E=h.data[4*d+3]/255;this.gridOuter[d]=E===1?0:E===0?at:Math.pow(Math.max(0,.5-E),2),this.gridInner[d]=E===1?at:E===0?0:Math.pow(Math.max(0,E-.5),2)}for(Zt(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),Zt(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),d=0;d<this.size*this.size;d++)c[d]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[d]-this.gridInner[d])/this.radius+this.cutoff))));return c},Yt.default=Et;var $t=function(l,h){this.requestManager=l,this.localIdeographFontFamily=h,this.entries={}};$t.prototype.setURL=function(l){this.url=l},$t.prototype.getGlyphs=function(l,h){var c=this,d=[];for(var E in l)for(var w=0,P=l[E];w<P.length;w+=1)d.push({stack:E,id:P[w]});m.asyncAll(d,function(L,N){var q=L.stack,ce=L.id,he=c.entries[q];he||(he=c.entries[q]={glyphs:{},requests:{},ranges:{}});var de=he.glyphs[ce];if(de===void 0){if(de=c._tinySDF(he,q,ce))return he.glyphs[ce]=de,void N(null,{stack:q,id:ce,glyph:de});var Re=Math.floor(ce/256);if(256*Re>65535)N(new Error("glyphs > 65535 not supported"));else if(he.ranges[Re])N(null,{stack:q,id:ce,glyph:de});else{var Ie=he.requests[Re];Ie||(Ie=he.requests[Re]=[],$t.loadGlyphRange(q,Re,c.url,c.requestManager,function(We,we){if(we){for(var Ve in we)c._doesCharSupportLocalGlyph(+Ve)||(he.glyphs[+Ve]=we[+Ve]);he.ranges[Re]=!0}for(var tt=0,yt=Ie;tt<yt.length;tt+=1)(0,yt[tt])(We,we);delete he.requests[Re]})),Ie.push(function(We,we){We?N(We):we&&N(null,{stack:q,id:ce,glyph:we[ce]||null})})}}else N(null,{stack:q,id:ce,glyph:de})},function(L,N){if(L)h(L);else if(N){for(var q={},ce=0,he=N;ce<he.length;ce+=1){var de=he[ce],Re=de.stack,Ie=de.id,We=de.glyph;(q[Re]||(q[Re]={}))[Ie]=We&&{id:We.id,bitmap:We.bitmap.clone(),metrics:We.metrics}}h(null,q)}})},$t.prototype._doesCharSupportLocalGlyph=function(l){return!!this.localIdeographFontFamily&&(m.isChar["CJK Unified Ideographs"](l)||m.isChar["Hangul Syllables"](l)||m.isChar.Hiragana(l)||m.isChar.Katakana(l))},$t.prototype._tinySDF=function(l,h,c){var d=this.localIdeographFontFamily;if(d&&this._doesCharSupportLocalGlyph(c)){var E=l.tinySDF;if(!E){var w="400";/bold/i.test(h)?w="900":/medium/i.test(h)?w="500":/light/i.test(h)&&(w="200"),E=l.tinySDF=new $t.TinySDF(24,3,8,.25,d,w)}return{id:c,bitmap:new m.AlphaImage({width:30,height:30},E.draw(String.fromCharCode(c))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},$t.loadGlyphRange=function(l,h,c,d,E){var w=256*h,P=w+255,L=d.transformRequest(d.normalizeGlyphsURL(c).replace("{fontstack}",l).replace("{range}",w+"-"+P),m.ResourceType.Glyphs);m.getArrayBuffer(L,function(N,q){if(N)E(N);else if(q){for(var ce={},he=0,de=m.parseGlyphPBF(q);he<de.length;he+=1){var Re=de[he];ce[Re.id]=Re}E(null,ce)}})},$t.TinySDF=Yt;var ft=function(){this.specification=m.styleSpec.light.position};ft.prototype.possiblyEvaluate=function(l,h){return m.sphericalToCartesian(l.expression.evaluate(h))},ft.prototype.interpolate=function(l,h,c){return{x:m.number(l.x,h.x,c),y:m.number(l.y,h.y,c),z:m.number(l.z,h.z,c)}};var Je=new m.Properties({anchor:new m.DataConstantProperty(m.styleSpec.light.anchor),position:new ft,color:new m.DataConstantProperty(m.styleSpec.light.color),intensity:new m.DataConstantProperty(m.styleSpec.light.intensity)}),At=function(l){function h(c){l.call(this),this._transitionable=new m.Transitionable(Je),this.setLight(c),this._transitioning=this._transitionable.untransitioned()}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getLight=function(){return this._transitionable.serialize()},h.prototype.setLight=function(c,d){if(d===void 0&&(d={}),!this._validate(m.validateLight,c,d))for(var E in c){var w=c[E];m.endsWith(E,"-transition")?this._transitionable.setTransition(E.slice(0,-"-transition".length),w):this._transitionable.setValue(E,w)}},h.prototype.updateTransitions=function(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)},h.prototype.hasTransition=function(){return this._transitioning.hasTransition()},h.prototype.recalculate=function(c){this.properties=this._transitioning.possiblyEvaluate(c)},h.prototype._validate=function(c,d,E){return(!E||E.validate!==!1)&&m.emitValidationErrors(this,c.call(m.validateStyle,m.extend({value:d,style:{glyphs:!0,sprite:!0},styleSpec:m.styleSpec})))},h}(m.Evented),Qe=function(l,h){this.width=l,this.height=h,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};Qe.prototype.getDash=function(l,h){var c=l.join(",")+String(h);return this.dashEntry[c]||(this.dashEntry[c]=this.addDash(l,h)),this.dashEntry[c]},Qe.prototype.getDashRanges=function(l,h,c){var d=[],E=l.length%2==1?-l[l.length-1]*c:0,w=l[0]*c,P=!0;d.push({left:E,right:w,isDash:P,zeroLength:l[0]===0});for(var L=l[0],N=1;N<l.length;N++){var q=l[N];d.push({left:E=L*c,right:w=(L+=q)*c,isDash:P=!P,zeroLength:q===0})}return d},Qe.prototype.addRoundDash=function(l,h,c){for(var d=h/2,E=-c;E<=c;E++)for(var w=this.width*(this.nextRow+c+E),P=0,L=l[P],N=0;N<this.width;N++){N/L.right>1&&(L=l[++P]);var q=Math.abs(N-L.left),ce=Math.abs(N-L.right),he=Math.min(q,ce),de=void 0,Re=E/c*(d+1);if(L.isDash){var Ie=d-Math.abs(Re);de=Math.sqrt(he*he+Ie*Ie)}else de=d-Math.sqrt(he*he+Re*Re);this.data[w+N]=Math.max(0,Math.min(255,de+128))}},Qe.prototype.addRegularDash=function(l){for(var h=l.length-1;h>=0;--h){var c=l[h],d=l[h+1];c.zeroLength?l.splice(h,1):d&&d.isDash===c.isDash&&(d.left=c.left,l.splice(h,1))}var E=l[0],w=l[l.length-1];E.isDash===w.isDash&&(E.left=w.left-this.width,w.right=E.right+this.width);for(var P=this.width*this.nextRow,L=0,N=l[L],q=0;q<this.width;q++){q/N.right>1&&(N=l[++L]);var ce=Math.abs(q-N.left),he=Math.abs(q-N.right),de=Math.min(ce,he);this.data[P+q]=Math.max(0,Math.min(255,(N.isDash?de:-de)+128))}},Qe.prototype.addDash=function(l,h){var c=h?7:0,d=2*c+1;if(this.nextRow+d>this.height)return m.warnOnce("LineAtlas out of space"),null;for(var E=0,w=0;w<l.length;w++)E+=l[w];if(E!==0){var P=this.width/E,L=this.getDashRanges(l,this.width,P);h?this.addRoundDash(L,P,c):this.addRegularDash(L)}var N={y:(this.nextRow+c+.5)/this.height,height:2*c/this.height,width:E};return this.nextRow+=d,this.dirty=!0,N},Qe.prototype.bind=function(l){var h=l.gl;this.texture?(h.bindTexture(h.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,h.texSubImage2D(h.TEXTURE_2D,0,0,0,this.width,this.height,h.ALPHA,h.UNSIGNED_BYTE,this.data))):(this.texture=h.createTexture(),h.bindTexture(h.TEXTURE_2D,this.texture),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texImage2D(h.TEXTURE_2D,0,h.ALPHA,this.width,this.height,0,h.ALPHA,h.UNSIGNED_BYTE,this.data))};var Qt=function l(h,c){this.workerPool=h,this.actors=[],this.currentActor=0,this.id=m.uniqueId();for(var d=this.workerPool.acquire(this.id),E=0;E<d.length;E++){var w=new l.Actor(d[E],c,this.id);w.name="Worker "+E,this.actors.push(w)}};function Er(l,h,c){var d=function(E,w){if(E)return c(E);if(w){var P=m.pick(m.extend(w,l),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);w.vector_layers&&(P.vectorLayers=w.vector_layers,P.vectorLayerIds=P.vectorLayers.map(function(L){return L.id})),P.tiles=h.canonicalizeTileset(P,l.url),c(null,P)}};return l.url?m.getJSON(h.transformRequest(h.normalizeSourceURL(l.url),m.ResourceType.Source),d):m.browser.frame(function(){return d(null,l)})}Qt.prototype.broadcast=function(l,h,c){m.asyncAll(this.actors,function(d,E){d.send(l,h,E)},c=c||function(){})},Qt.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},Qt.prototype.remove=function(){this.actors.forEach(function(l){l.remove()}),this.actors=[],this.workerPool.release(this.id)},Qt.Actor=m.Actor;var Nr=function(l,h,c){this.bounds=m.LngLatBounds.convert(this.validateBounds(l)),this.minzoom=h||0,this.maxzoom=c||24};Nr.prototype.validateBounds=function(l){return Array.isArray(l)&&l.length===4?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]},Nr.prototype.contains=function(l){var h=Math.pow(2,l.z),c=Math.floor(m.mercatorXfromLng(this.bounds.getWest())*h),d=Math.floor(m.mercatorYfromLat(this.bounds.getNorth())*h),E=Math.ceil(m.mercatorXfromLng(this.bounds.getEast())*h),w=Math.ceil(m.mercatorYfromLat(this.bounds.getSouth())*h);return l.x>=c&&l.x<E&&l.y>=d&&l.y<w};var tn=function(l){function h(c,d,E,w){if(l.call(this),this.id=c,this.dispatcher=E,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,m.extend(this,m.pick(d,["url","scheme","tileSize","promoteId"])),this._options=m.extend({type:"vector"},d),this._collectResourceTiming=d.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(w)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.load=function(){var c=this;this._loaded=!1,this.fire(new m.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Er(this._options,this.map._requestManager,function(d,E){c._tileJSONRequest=null,c._loaded=!0,d?c.fire(new m.ErrorEvent(d)):E&&(m.extend(c,E),E.bounds&&(c.tileBounds=new Nr(E.bounds,c.minzoom,c.maxzoom)),m.postTurnstileEvent(E.tiles,c.map._requestManager._customAccessToken),m.postMapLoadEvent(E.tiles,c.map._getMapId(),c.map._requestManager._skuToken,c.map._requestManager._customAccessToken),c.fire(new m.Event("data",{dataType:"source",sourceDataType:"metadata"})),c.fire(new m.Event("data",{dataType:"source",sourceDataType:"content"})))})},h.prototype.loaded=function(){return this._loaded},h.prototype.hasTile=function(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)},h.prototype.onAdd=function(c){this.map=c,this.load()},h.prototype.setSourceProperty=function(c){this._tileJSONRequest&&this._tileJSONRequest.cancel(),c(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},h.prototype.setTiles=function(c){var d=this;return this.setSourceProperty(function(){d._options.tiles=c}),this},h.prototype.setUrl=function(c){var d=this;return this.setSourceProperty(function(){d.url=c,d._options.url=c}),this},h.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},h.prototype.serialize=function(){return m.extend({},this._options)},h.prototype.loadTile=function(c,d){var E=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme)),w={request:this.map._requestManager.transformRequest(E,m.ResourceType.Tile),uid:c.uid,tileID:c.tileID,zoom:c.tileID.overscaledZ,tileSize:this.tileSize*c.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:m.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function P(L,N){return delete c.request,c.aborted?d(null):L&&L.status!==404?d(L):(N&&N.resourceTiming&&(c.resourceTiming=N.resourceTiming),this.map._refreshExpiredTiles&&N&&c.setExpiryData(N),c.loadVectorData(N,this.map.painter),m.cacheEntryPossiblyAdded(this.dispatcher),d(null),void(c.reloadCallback&&(this.loadTile(c,c.reloadCallback),c.reloadCallback=null)))}w.request.collectResourceTiming=this._collectResourceTiming,c.actor&&c.state!=="expired"?c.state==="loading"?c.reloadCallback=d:c.request=c.actor.send("reloadTile",w,P.bind(this)):(c.actor=this.dispatcher.getActor(),c.request=c.actor.send("loadTile",w,P.bind(this)))},h.prototype.abortTile=function(c){c.request&&(c.request.cancel(),delete c.request),c.actor&&c.actor.send("abortTile",{uid:c.uid,type:this.type,source:this.id},void 0)},h.prototype.unloadTile=function(c){c.unloadVectorData(),c.actor&&c.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id},void 0)},h.prototype.hasTransition=function(){return!1},h}(m.Evented),A=function(l){function h(c,d,E,w){l.call(this),this.id=c,this.dispatcher=E,this.setEventedParent(w),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=m.extend({type:"raster"},d),m.extend(this,m.pick(d,["url","scheme","tileSize"]))}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.load=function(){var c=this;this._loaded=!1,this.fire(new m.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Er(this._options,this.map._requestManager,function(d,E){c._tileJSONRequest=null,c._loaded=!0,d?c.fire(new m.ErrorEvent(d)):E&&(m.extend(c,E),E.bounds&&(c.tileBounds=new Nr(E.bounds,c.minzoom,c.maxzoom)),m.postTurnstileEvent(E.tiles),m.postMapLoadEvent(E.tiles,c.map._getMapId(),c.map._requestManager._skuToken),c.fire(new m.Event("data",{dataType:"source",sourceDataType:"metadata"})),c.fire(new m.Event("data",{dataType:"source",sourceDataType:"content"})))})},h.prototype.loaded=function(){return this._loaded},h.prototype.onAdd=function(c){this.map=c,this.load()},h.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},h.prototype.serialize=function(){return m.extend({},this._options)},h.prototype.hasTile=function(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)},h.prototype.loadTile=function(c,d){var E=this,w=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);c.request=m.getImage(this.map._requestManager.transformRequest(w,m.ResourceType.Tile),function(P,L){if(delete c.request,c.aborted)c.state="unloaded",d(null);else if(P)c.state="errored",d(P);else if(L){E.map._refreshExpiredTiles&&c.setExpiryData(L),delete L.cacheControl,delete L.expires;var N=E.map.painter.context,q=N.gl;c.texture=E.map.painter.getTileTexture(L.width),c.texture?c.texture.update(L,{useMipmap:!0}):(c.texture=new m.Texture(N,L,q.RGBA,{useMipmap:!0}),c.texture.bind(q.LINEAR,q.CLAMP_TO_EDGE,q.LINEAR_MIPMAP_NEAREST),N.extTextureFilterAnisotropic&&q.texParameterf(q.TEXTURE_2D,N.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,N.extTextureFilterAnisotropicMax)),c.state="loaded",m.cacheEntryPossiblyAdded(E.dispatcher),d(null)}})},h.prototype.abortTile=function(c,d){c.request&&(c.request.cancel(),delete c.request),d()},h.prototype.unloadTile=function(c,d){c.texture&&this.map.painter.saveTileTexture(c.texture),d()},h.prototype.hasTransition=function(){return!1},h}(m.Evented),Ce=function(l){function h(c,d,E,w){l.call(this,c,d,E,w),this.type="raster-dem",this.maxzoom=22,this._options=m.extend({type:"raster-dem"},d),this.encoding=d.encoding||"mapbox"}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},h.prototype.loadTile=function(c,d){var E=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function w(P,L){P&&(c.state="errored",d(P)),L&&(c.dem=L,c.needsHillshadePrepare=!0,c.state="loaded",d(null))}c.request=m.getImage(this.map._requestManager.transformRequest(E,m.ResourceType.Tile),function(P,L){if(delete c.request,c.aborted)c.state="unloaded",d(null);else if(P)c.state="errored",d(P);else if(L){this.map._refreshExpiredTiles&&c.setExpiryData(L),delete L.cacheControl,delete L.expires;var N=m.window.ImageBitmap&&L instanceof m.window.ImageBitmap&&m.offscreenCanvasSupported()?L:m.browser.getImageData(L,1),q={uid:c.uid,coord:c.tileID,source:this.id,rawImageData:N,encoding:this.encoding};c.actor&&c.state!=="expired"||(c.actor=this.dispatcher.getActor(),c.actor.send("loadDEMTile",q,w.bind(this)))}}.bind(this)),c.neighboringTiles=this._getNeighboringTiles(c.tileID)},h.prototype._getNeighboringTiles=function(c){var d=c.canonical,E=Math.pow(2,d.z),w=(d.x-1+E)%E,P=d.x===0?c.wrap-1:c.wrap,L=(d.x+1+E)%E,N=d.x+1===E?c.wrap+1:c.wrap,q={};return q[new m.OverscaledTileID(c.overscaledZ,P,d.z,w,d.y).key]={backfilled:!1},q[new m.OverscaledTileID(c.overscaledZ,N,d.z,L,d.y).key]={backfilled:!1},d.y>0&&(q[new m.OverscaledTileID(c.overscaledZ,P,d.z,w,d.y-1).key]={backfilled:!1},q[new m.OverscaledTileID(c.overscaledZ,c.wrap,d.z,d.x,d.y-1).key]={backfilled:!1},q[new m.OverscaledTileID(c.overscaledZ,N,d.z,L,d.y-1).key]={backfilled:!1}),d.y+1<E&&(q[new m.OverscaledTileID(c.overscaledZ,P,d.z,w,d.y+1).key]={backfilled:!1},q[new m.OverscaledTileID(c.overscaledZ,c.wrap,d.z,d.x,d.y+1).key]={backfilled:!1},q[new m.OverscaledTileID(c.overscaledZ,N,d.z,L,d.y+1).key]={backfilled:!1}),q},h.prototype.unloadTile=function(c){c.demTexture&&this.map.painter.saveTileTexture(c.demTexture),c.fbo&&(c.fbo.destroy(),delete c.fbo),c.dem&&delete c.dem,delete c.neighboringTiles,c.state="unloaded",c.actor&&c.actor.send("removeDEMTile",{uid:c.uid,source:this.id})},h}(A),De=function(l){function h(c,d,E,w){l.call(this),this.id=c,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=E.getActor(),this.setEventedParent(w),this._data=d.data,this._options=m.extend({},d),this._collectResourceTiming=d.collectResourceTiming,this._resourceTiming=[],d.maxzoom!==void 0&&(this.maxzoom=d.maxzoom),d.type&&(this.type=d.type),d.attribution&&(this.attribution=d.attribution),this.promoteId=d.promoteId;var P=m.EXTENT/this.tileSize;this.workerOptions=m.extend({source:this.id,cluster:d.cluster||!1,geojsonVtOptions:{buffer:(d.buffer!==void 0?d.buffer:128)*P,tolerance:(d.tolerance!==void 0?d.tolerance:.375)*P,extent:m.EXTENT,maxZoom:this.maxzoom,lineMetrics:d.lineMetrics||!1,generateId:d.generateId||!1},superclusterOptions:{maxZoom:d.clusterMaxZoom!==void 0?Math.min(d.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,d.clusterMinPoints||2),extent:m.EXTENT,radius:(d.clusterRadius||50)*P,log:!1,generateId:d.generateId||!1},clusterProperties:d.clusterProperties,filter:d.filter},d.workerOptions)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.load=function(){var c=this;this.fire(new m.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(d){if(d)c.fire(new m.ErrorEvent(d));else{var E={dataType:"source",sourceDataType:"metadata"};c._collectResourceTiming&&c._resourceTiming&&c._resourceTiming.length>0&&(E.resourceTiming=c._resourceTiming,c._resourceTiming=[]),c.fire(new m.Event("data",E))}})},h.prototype.onAdd=function(c){this.map=c,this.load()},h.prototype.setData=function(c){var d=this;return this._data=c,this.fire(new m.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(E){if(E)d.fire(new m.ErrorEvent(E));else{var w={dataType:"source",sourceDataType:"content"};d._collectResourceTiming&&d._resourceTiming&&d._resourceTiming.length>0&&(w.resourceTiming=d._resourceTiming,d._resourceTiming=[]),d.fire(new m.Event("data",w))}}),this},h.prototype.getClusterExpansionZoom=function(c,d){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:c,source:this.id},d),this},h.prototype.getClusterChildren=function(c,d){return this.actor.send("geojson.getClusterChildren",{clusterId:c,source:this.id},d),this},h.prototype.getClusterLeaves=function(c,d,E,w){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:c,limit:d,offset:E},w),this},h.prototype._updateWorkerData=function(c){var d=this;this._loaded=!1;var E=m.extend({},this.workerOptions),w=this._data;typeof w=="string"?(E.request=this.map._requestManager.transformRequest(m.browser.resolveURL(w),m.ResourceType.Source),E.request.collectResourceTiming=this._collectResourceTiming):E.data=JSON.stringify(w),this.actor.send(this.type+".loadData",E,function(P,L){d._removed||L&&L.abandoned||(d._loaded=!0,L&&L.resourceTiming&&L.resourceTiming[d.id]&&(d._resourceTiming=L.resourceTiming[d.id].slice(0)),d.actor.send(d.type+".coalesce",{source:E.source},null),c(P))})},h.prototype.loaded=function(){return this._loaded},h.prototype.loadTile=function(c,d){var E=this,w=c.actor?"reloadTile":"loadTile";c.actor=this.actor,c.request=this.actor.send(w,{type:this.type,uid:c.uid,tileID:c.tileID,zoom:c.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:m.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(P,L){return delete c.request,c.unloadVectorData(),c.aborted?d(null):P?d(P):(c.loadVectorData(L,E.map.painter,w==="reloadTile"),d(null))})},h.prototype.abortTile=function(c){c.request&&(c.request.cancel(),delete c.request),c.aborted=!0},h.prototype.unloadTile=function(c){c.unloadVectorData(),this.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id})},h.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},h.prototype.serialize=function(){return m.extend({},this._options,{type:this.type,data:this._data})},h.prototype.hasTransition=function(){return!1},h}(m.Evented),wt=m.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),mt=function(l){function h(c,d,E,w){l.call(this),this.id=c,this.dispatcher=E,this.coordinates=d.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(w),this.options=d}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.load=function(c,d){var E=this;this._loaded=!1,this.fire(new m.Event("dataloading",{dataType:"source"})),this.url=this.options.url,m.getImage(this.map._requestManager.transformRequest(this.url,m.ResourceType.Image),function(w,P){E._loaded=!0,w?E.fire(new m.ErrorEvent(w)):P&&(E.image=P,c&&(E.coordinates=c),d&&d(),E._finishLoading())})},h.prototype.loaded=function(){return this._loaded},h.prototype.updateImage=function(c){var d=this;return this.image&&c.url?(this.options.url=c.url,this.load(c.coordinates,function(){d.texture=null}),this):this},h.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new m.Event("data",{dataType:"source",sourceDataType:"metadata"})))},h.prototype.onAdd=function(c){this.map=c,this.load()},h.prototype.setCoordinates=function(c){var d=this;this.coordinates=c;var E=c.map(m.MercatorCoordinate.fromLngLat);this.tileID=function(P){for(var L=1/0,N=1/0,q=-1/0,ce=-1/0,he=0,de=P;he<de.length;he+=1){var Re=de[he];L=Math.min(L,Re.x),N=Math.min(N,Re.y),q=Math.max(q,Re.x),ce=Math.max(ce,Re.y)}var Ie=Math.max(q-L,ce-N),We=Math.max(0,Math.floor(-Math.log(Ie)/Math.LN2)),we=Math.pow(2,We);return new m.CanonicalTileID(We,Math.floor((L+q)/2*we),Math.floor((N+ce)/2*we))}(E),this.minzoom=this.maxzoom=this.tileID.z;var w=E.map(function(P){return d.tileID.getTilePoint(P)._round()});return this._boundsArray=new m.StructArrayLayout4i8,this._boundsArray.emplaceBack(w[0].x,w[0].y,0,0),this._boundsArray.emplaceBack(w[1].x,w[1].y,m.EXTENT,0),this._boundsArray.emplaceBack(w[3].x,w[3].y,0,m.EXTENT),this._boundsArray.emplaceBack(w[2].x,w[2].y,m.EXTENT,m.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new m.Event("data",{dataType:"source",sourceDataType:"content"})),this},h.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var c=this.map.painter.context,d=c.gl;for(var E in this.boundsBuffer||(this.boundsBuffer=c.createVertexBuffer(this._boundsArray,wt.members)),this.boundsSegments||(this.boundsSegments=m.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new m.Texture(c,this.image,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE)),this.tiles){var w=this.tiles[E];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture)}}},h.prototype.loadTile=function(c,d){this.tileID&&this.tileID.equals(c.tileID.canonical)?(this.tiles[String(c.tileID.wrap)]=c,c.buckets={},d(null)):(c.state="errored",d(null))},h.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},h.prototype.hasTransition=function(){return!1},h}(m.Evented),Bt=function(l){function h(c,d,E,w){l.call(this,c,d,E,w),this.roundZoom=!0,this.type="video",this.options=d}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.load=function(){var c=this;this._loaded=!1;var d=this.options;this.urls=[];for(var E=0,w=d.urls;E<w.length;E+=1)this.urls.push(this.map._requestManager.transformRequest(w[E],m.ResourceType.Source).url);m.getVideo(this.urls,function(P,L){c._loaded=!0,P?c.fire(new m.ErrorEvent(P)):L&&(c.video=L,c.video.loop=!0,c.video.addEventListener("playing",function(){c.map.triggerRepaint()}),c.map&&c.video.play(),c._finishLoading())})},h.prototype.pause=function(){this.video&&this.video.pause()},h.prototype.play=function(){this.video&&this.video.play()},h.prototype.seek=function(c){if(this.video){var d=this.video.seekable;c<d.start(0)||c>d.end(0)?this.fire(new m.ErrorEvent(new m.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+d.start(0)+" and "+d.end(0)+"-second mark."))):this.video.currentTime=c}},h.prototype.getVideo=function(){return this.video},h.prototype.onAdd=function(c){this.map||(this.map=c,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},h.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var c=this.map.painter.context,d=c.gl;for(var E in this.boundsBuffer||(this.boundsBuffer=c.createVertexBuffer(this._boundsArray,wt.members)),this.boundsSegments||(this.boundsSegments=m.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE),d.texSubImage2D(d.TEXTURE_2D,0,0,0,d.RGBA,d.UNSIGNED_BYTE,this.video)):(this.texture=new m.Texture(c,this.video,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE)),this.tiles){var w=this.tiles[E];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture)}}},h.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},h.prototype.hasTransition=function(){return this.video&&!this.video.paused},h}(mt),Kt=function(l){function h(c,d,E,w){l.call(this,c,d,E,w),d.coordinates?Array.isArray(d.coordinates)&&d.coordinates.length===4&&!d.coordinates.some(function(P){return!Array.isArray(P)||P.length!==2||P.some(function(L){return typeof L!="number"})})||this.fire(new m.ErrorEvent(new m.ValidationError("sources."+c,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new m.ErrorEvent(new m.ValidationError("sources."+c,null,'missing required property "coordinates"'))),d.animate&&typeof d.animate!="boolean"&&this.fire(new m.ErrorEvent(new m.ValidationError("sources."+c,null,'optional "animate" property must be a boolean value'))),d.canvas?typeof d.canvas=="string"||d.canvas instanceof m.window.HTMLCanvasElement||this.fire(new m.ErrorEvent(new m.ValidationError("sources."+c,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new m.ErrorEvent(new m.ValidationError("sources."+c,null,'missing required property "canvas"'))),this.options=d,this.animate=d.animate===void 0||d.animate}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof m.window.HTMLCanvasElement?this.options.canvas:m.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new m.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},h.prototype.getCanvas=function(){return this.canvas},h.prototype.onAdd=function(c){this.map=c,this.load(),this.canvas&&this.animate&&this.play()},h.prototype.onRemove=function(){this.pause()},h.prototype.prepare=function(){var c=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,c=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,c=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var d=this.map.painter.context,E=d.gl;for(var w in this.boundsBuffer||(this.boundsBuffer=d.createVertexBuffer(this._boundsArray,wt.members)),this.boundsSegments||(this.boundsSegments=m.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(c||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new m.Texture(d,this.canvas,E.RGBA,{premultiply:!0}),this.tiles){var P=this.tiles[w];P.state!=="loaded"&&(P.state="loaded",P.texture=this.texture)}}},h.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},h.prototype.hasTransition=function(){return this._playing},h.prototype._hasInvalidDimensions=function(){for(var c=0,d=[this.canvas.width,this.canvas.height];c<d.length;c+=1){var E=d[c];if(isNaN(E)||E<=0)return!0}return!1},h}(mt),Cr={vector:tn,raster:A,"raster-dem":Ce,geojson:De,video:Bt,image:mt,canvas:Kt};function ei(l,h){var c=m.identity([]);return m.translate(c,c,[1,1,0]),m.scale(c,c,[.5*l.width,.5*l.height,1]),m.multiply(c,c,l.calculatePosMatrix(h.toUnwrapped()))}function vn(l,h,c,d,E,w){var P=function(We,we,Ve){if(We)for(var tt=0,yt=We;tt<yt.length;tt+=1){var Wt=we[yt[tt]];if(Wt&&Wt.source===Ve&&Wt.type==="fill-extrusion")return!0}else for(var jt in we){var Jt=we[jt];if(Jt.source===Ve&&Jt.type==="fill-extrusion")return!0}return!1}(E&&E.layers,h,l.id),L=w.maxPitchScaleFactor(),N=l.tilesIn(d,L,P);N.sort(di);for(var q=[],ce=0,he=N;ce<he.length;ce+=1){var de=he[ce];q.push({wrappedTileID:de.tileID.wrapped().key,queryResults:de.tile.queryRenderedFeatures(h,c,l._state,de.queryGeometry,de.cameraQueryGeometry,de.scale,E,w,L,ei(l.transform,de.tileID))})}var Re=function(We){for(var we={},Ve={},tt=0,yt=We;tt<yt.length;tt+=1){var Wt=yt[tt],jt=Wt.queryResults,Jt=Wt.wrappedTileID,dr=Ve[Jt]=Ve[Jt]||{};for(var Fr in jt)for(var kr=jt[Fr],ln=dr[Fr]=dr[Fr]||{},Nn=we[Fr]=we[Fr]||[],zn=0,Mn=kr;zn<Mn.length;zn+=1){var Bi=Mn[zn];ln[Bi.featureIndex]||(ln[Bi.featureIndex]=!0,Nn.push(Bi))}}return we}(q);for(var Ie in Re)Re[Ie].forEach(function(We){var we=We.feature,Ve=l.getFeatureState(we.layer["source-layer"],we.id);we.source=we.layer.source,we.layer["source-layer"]&&(we.sourceLayer=we.layer["source-layer"]),we.state=Ve});return Re}function di(l,h){var c=l.tileID,d=h.tileID;return c.overscaledZ-d.overscaledZ||c.canonical.y-d.canonical.y||c.wrap-d.wrap||c.canonical.x-d.canonical.x}var Wn=function(l,h){this.max=l,this.onRemove=h,this.reset()};Wn.prototype.reset=function(){for(var l in this.data)for(var h=0,c=this.data[l];h<c.length;h+=1){var d=c[h];d.timeout&&clearTimeout(d.timeout),this.onRemove(d.value)}return this.data={},this.order=[],this},Wn.prototype.add=function(l,h,c){var d=this,E=l.wrapped().key;this.data[E]===void 0&&(this.data[E]=[]);var w={value:h,timeout:void 0};if(c!==void 0&&(w.timeout=setTimeout(function(){d.remove(l,w)},c)),this.data[E].push(w),this.order.push(E),this.order.length>this.max){var P=this._getAndRemoveByKey(this.order[0]);P&&this.onRemove(P)}return this},Wn.prototype.has=function(l){return l.wrapped().key in this.data},Wn.prototype.getAndRemove=function(l){return this.has(l)?this._getAndRemoveByKey(l.wrapped().key):null},Wn.prototype._getAndRemoveByKey=function(l){var h=this.data[l].shift();return h.timeout&&clearTimeout(h.timeout),this.data[l].length===0&&delete this.data[l],this.order.splice(this.order.indexOf(l),1),h.value},Wn.prototype.getByKey=function(l){var h=this.data[l];return h?h[0].value:null},Wn.prototype.get=function(l){return this.has(l)?this.data[l.wrapped().key][0].value:null},Wn.prototype.remove=function(l,h){if(!this.has(l))return this;var c=l.wrapped().key,d=h===void 0?0:this.data[c].indexOf(h),E=this.data[c][d];return this.data[c].splice(d,1),E.timeout&&clearTimeout(E.timeout),this.data[c].length===0&&delete this.data[c],this.onRemove(E.value),this.order.splice(this.order.indexOf(c),1),this},Wn.prototype.setMaxSize=function(l){for(this.max=l;this.order.length>this.max;){var h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this},Wn.prototype.filter=function(l){var h=[];for(var c in this.data)for(var d=0,E=this.data[c];d<E.length;d+=1){var w=E[d];l(w.value)||h.push(w)}for(var P=0,L=h;P<L.length;P+=1){var N=L[P];this.remove(N.value.tileID,N)}};var si=function(l,h,c){this.context=l;var d=l.gl;this.buffer=d.createBuffer(),this.dynamicDraw=Boolean(c),this.context.unbindVAO(),l.bindElementBuffer.set(this.buffer),d.bufferData(d.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer};si.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},si.prototype.updateData=function(l){var h=this.context.gl;this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,l.arrayBuffer)},si.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var vi={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},qn=function(l,h,c,d){this.length=h.length,this.attributes=c,this.itemSize=h.bytesPerElement,this.dynamicDraw=d,this.context=l;var E=l.gl;this.buffer=E.createBuffer(),l.bindVertexBuffer.set(this.buffer),E.bufferData(E.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?E.DYNAMIC_DRAW:E.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer};qn.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},qn.prototype.updateData=function(l){var h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,l.arrayBuffer)},qn.prototype.enableAttributes=function(l,h){for(var c=0;c<this.attributes.length;c++){var d=h.attributes[this.attributes[c].name];d!==void 0&&l.enableVertexAttribArray(d)}},qn.prototype.setVertexAttribPointers=function(l,h,c){for(var d=0;d<this.attributes.length;d++){var E=this.attributes[d],w=h.attributes[E.name];w!==void 0&&l.vertexAttribPointer(w,E.components,l[vi[E.type]],!1,this.itemSize,E.offset+this.itemSize*(c||0))}},qn.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var mi=function(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};mi.prototype.get=function(){return this.current},mi.prototype.set=function(l){},mi.prototype.getDefault=function(){return this.default},mi.prototype.setDefault=function(){this.set(this.default)};var aa=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return m.Color.transparent},h.prototype.set=function(c){var d=this.current;(c.r!==d.r||c.g!==d.g||c.b!==d.b||c.a!==d.a||this.dirty)&&(this.gl.clearColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)},h}(mi),Wi=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return 1},h.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.clearDepth(c),this.current=c,this.dirty=!1)},h}(mi),Oi=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return 0},h.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.clearStencil(c),this.current=c,this.dirty=!1)},h}(mi),Ki=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return[!0,!0,!0,!0]},h.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||c[3]!==d[3]||this.dirty)&&(this.gl.colorMask(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)},h}(mi),oa=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return!0},h.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.depthMask(c),this.current=c,this.dirty=!1)},h}(mi),Mi=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return 255},h.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.stencilMask(c),this.current=c,this.dirty=!1)},h}(mi),da=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},h.prototype.set=function(c){var d=this.current;(c.func!==d.func||c.ref!==d.ref||c.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(c.func,c.ref,c.mask),this.current=c,this.dirty=!1)},h}(mi),$n=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){var c=this.gl;return[c.KEEP,c.KEEP,c.KEEP]},h.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(c[0],c[1],c[2]),this.current=c,this.dirty=!1)},h}(mi),wi=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return!1},h.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=c,this.dirty=!1}},h}(mi),ji=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return[0,1]},h.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||this.dirty)&&(this.gl.depthRange(c[0],c[1]),this.current=c,this.dirty=!1)},h}(mi),$i=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return!1},h.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=c,this.dirty=!1}},h}(mi),zo=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return this.gl.LESS},h.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.depthFunc(c),this.current=c,this.dirty=!1)},h}(mi),me=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return!1},h.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.BLEND):d.disable(d.BLEND),this.current=c,this.dirty=!1}},h}(mi),Dn=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){var c=this.gl;return[c.ONE,c.ZERO]},h.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||this.dirty)&&(this.gl.blendFunc(c[0],c[1]),this.current=c,this.dirty=!1)},h}(mi),Za=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return m.Color.transparent},h.prototype.set=function(c){var d=this.current;(c.r!==d.r||c.g!==d.g||c.b!==d.b||c.a!==d.a||this.dirty)&&(this.gl.blendColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)},h}(mi),hs=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return this.gl.FUNC_ADD},h.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.blendEquation(c),this.current=c,this.dirty=!1)},h}(mi),Nt=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return!1},h.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=c,this.dirty=!1}},h}(mi),nr=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return this.gl.BACK},h.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.cullFace(c),this.current=c,this.dirty=!1)},h}(mi),Ar=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return this.gl.CCW},h.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.frontFace(c),this.current=c,this.dirty=!1)},h}(mi),rn=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.useProgram(c),this.current=c,this.dirty=!1)},h}(mi),wn=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return this.gl.TEXTURE0},h.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.activeTexture(c),this.current=c,this.dirty=!1)},h}(mi),Fn=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){var c=this.gl;return[0,0,c.drawingBufferWidth,c.drawingBufferHeight]},h.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||c[3]!==d[3]||this.dirty)&&(this.gl.viewport(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)},h}(mi),gi=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,c),this.current=c,this.dirty=!1}},h}(mi),ti=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,c),this.current=c,this.dirty=!1}},h}(mi),fn=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindTexture(d.TEXTURE_2D,c),this.current=c,this.dirty=!1}},h}(mi),Di=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,c),this.current=c,this.dirty=!1}},h}(mi),Ri=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(c){var d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,c),this.current=c,this.dirty=!1},h}(mi),to=function(l){function h(c){l.call(this,c),this.vao=c.extVertexArrayObject}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(c){this.vao&&(c!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(c),this.current=c,this.dirty=!1)},h}(mi),Es=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return 4},h.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,c),this.current=c,this.dirty=!1}},h}(mi),Ko=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return!1},h.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,c),this.current=c,this.dirty=!1}},h}(mi),Ba=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return!1},h.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,c),this.current=c,this.dirty=!1}},h}(mi),xa=function(l){function h(c,d){l.call(this,c),this.context=c,this.parent=d}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h}(mi),H=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.setDirty=function(){this.dirty=!0},h.prototype.set=function(c){if(c!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,c,0),this.current=c,this.dirty=!1}},h}(xa),Q=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.set=function(c){if(c!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT,d.RENDERBUFFER,c),this.current=c,this.dirty=!1}},h}(xa),oe=function(l,h,c,d){this.context=l,this.width=h,this.height=c;var E=this.framebuffer=l.gl.createFramebuffer();this.colorAttachment=new H(l,E),d&&(this.depthAttachment=new Q(l,E))};oe.prototype.destroy=function(){var l=this.context.gl,h=this.colorAttachment.get();if(h&&l.deleteTexture(h),this.depthAttachment){var c=this.depthAttachment.get();c&&l.deleteRenderbuffer(c)}l.deleteFramebuffer(this.framebuffer)};var ye=function(l,h,c){this.func=l,this.mask=h,this.range=c};ye.ReadOnly=!1,ye.ReadWrite=!0,ye.disabled=new ye(519,ye.ReadOnly,[0,1]);var Pe=function(l,h,c,d,E,w){this.test=l,this.ref=h,this.mask=c,this.fail=d,this.depthFail=E,this.pass=w};Pe.disabled=new Pe({func:519,mask:0},0,0,7680,7680,7680);var He=function(l,h,c){this.blendFunction=l,this.blendColor=h,this.mask=c};He.disabled=new He(He.Replace=[1,0],m.Color.transparent,[!1,!1,!1,!1]),He.unblended=new He(He.Replace,m.Color.transparent,[!0,!0,!0,!0]),He.alphaBlended=new He([1,771],m.Color.transparent,[!0,!0,!0,!0]);var rt=function(l,h,c){this.enable=l,this.mode=h,this.frontFace=c};rt.disabled=new rt(!1,1029,2305),rt.backCCW=new rt(!0,1029,2305);var pe=function(l){this.gl=l,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new aa(this),this.clearDepth=new Wi(this),this.clearStencil=new Oi(this),this.colorMask=new Ki(this),this.depthMask=new oa(this),this.stencilMask=new Mi(this),this.stencilFunc=new da(this),this.stencilOp=new $n(this),this.stencilTest=new wi(this),this.depthRange=new ji(this),this.depthTest=new $i(this),this.depthFunc=new zo(this),this.blend=new me(this),this.blendFunc=new Dn(this),this.blendColor=new Za(this),this.blendEquation=new hs(this),this.cullFace=new Nt(this),this.cullFaceSide=new nr(this),this.frontFace=new Ar(this),this.program=new rn(this),this.activeTexture=new wn(this),this.viewport=new Fn(this),this.bindFramebuffer=new gi(this),this.bindRenderbuffer=new ti(this),this.bindTexture=new fn(this),this.bindVertexBuffer=new Di(this),this.bindElementBuffer=new Ri(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new to(this),this.pixelStoreUnpack=new Es(this),this.pixelStoreUnpackPremultiplyAlpha=new Ko(this),this.pixelStoreUnpackFlipY=new Ba(this),this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=l.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(l.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=l.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=l.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE)};pe.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},pe.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},pe.prototype.createIndexBuffer=function(l,h){return new si(this,l,h)},pe.prototype.createVertexBuffer=function(l,h,c){return new qn(this,l,h,c)},pe.prototype.createRenderbuffer=function(l,h,c){var d=this.gl,E=d.createRenderbuffer();return this.bindRenderbuffer.set(E),d.renderbufferStorage(d.RENDERBUFFER,l,h,c),this.bindRenderbuffer.set(null),E},pe.prototype.createFramebuffer=function(l,h,c){return new oe(this,l,h,c)},pe.prototype.clear=function(l){var h=l.color,c=l.depth,d=this.gl,E=0;h&&(E|=d.COLOR_BUFFER_BIT,this.clearColor.set(h),this.colorMask.set([!0,!0,!0,!0])),c!==void 0&&(E|=d.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),d.clear(E)},pe.prototype.setCullFace=function(l){l.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))},pe.prototype.setDepthMode=function(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)},pe.prototype.setStencilMode=function(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)},pe.prototype.setColorMode=function(l){m.deepEqual(l.blendFunction,He.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor)),this.colorMask.set(l.mask)},pe.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var ke=function(l){function h(c,d,E){var w=this;l.call(this),this.id=c,this.dispatcher=E,this.on("data",function(P){P.dataType==="source"&&P.sourceDataType==="metadata"&&(w._sourceLoaded=!0),w._sourceLoaded&&!w._paused&&P.dataType==="source"&&P.sourceDataType==="content"&&(w.reload(),w.transform&&w.update(w.transform))}),this.on("error",function(){w._sourceErrored=!0}),this._source=function(P,L,N,q){var ce=new Cr[L.type](P,L,N,q);if(ce.id!==P)throw new Error("Expected Source id to be "+P+" instead of "+ce.id);return m.bindAll(["load","abort","unload","serialize","prepare"],ce),ce}(c,d,E,this),this._tiles={},this._cache=new Wn(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new m.SourceFeatureState}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.onAdd=function(c){this.map=c,this._maxTileCacheSize=c?c._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(c)},h.prototype.onRemove=function(c){this._source&&this._source.onRemove&&this._source.onRemove(c)},h.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var c in this._tiles){var d=this._tiles[c];if(d.state!=="loaded"&&d.state!=="errored")return!1}return!0},h.prototype.getSource=function(){return this._source},h.prototype.pause=function(){this._paused=!0},h.prototype.resume=function(){if(this._paused){var c=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,c&&this.reload(),this.transform&&this.update(this.transform)}},h.prototype._loadTile=function(c,d){return this._source.loadTile(c,d)},h.prototype._unloadTile=function(c){if(this._source.unloadTile)return this._source.unloadTile(c,function(){})},h.prototype._abortTile=function(c){if(this._source.abortTile)return this._source.abortTile(c,function(){})},h.prototype.serialize=function(){return this._source.serialize()},h.prototype.prepare=function(c){for(var d in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var E=this._tiles[d];E.upload(c),E.prepare(this.map.style.imageManager)}},h.prototype.getIds=function(){return m.values(this._tiles).map(function(c){return c.tileID}).sort(vt).map(function(c){return c.key})},h.prototype.getRenderableIds=function(c){var d=this,E=[];for(var w in this._tiles)this._isIdRenderable(w,c)&&E.push(this._tiles[w]);return c?E.sort(function(P,L){var N=P.tileID,q=L.tileID,ce=new m.Point(N.canonical.x,N.canonical.y)._rotate(d.transform.angle),he=new m.Point(q.canonical.x,q.canonical.y)._rotate(d.transform.angle);return N.overscaledZ-q.overscaledZ||he.y-ce.y||he.x-ce.x}).map(function(P){return P.tileID.key}):E.map(function(P){return P.tileID}).sort(vt).map(function(P){return P.key})},h.prototype.hasRenderableParent=function(c){var d=this.findLoadedParent(c,0);return!!d&&this._isIdRenderable(d.tileID.key)},h.prototype._isIdRenderable=function(c,d){return this._tiles[c]&&this._tiles[c].hasData()&&!this._coveredTiles[c]&&(d||!this._tiles[c].holdingForFade())},h.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var c in this._cache.reset(),this._tiles)this._tiles[c].state!=="errored"&&this._reloadTile(c,"reloading")},h.prototype._reloadTile=function(c,d){var E=this._tiles[c];E&&(E.state!=="loading"&&(E.state=d),this._loadTile(E,this._tileLoaded.bind(this,E,c,d)))},h.prototype._tileLoaded=function(c,d,E,w){if(w)return c.state="errored",void(w.status!==404?this._source.fire(new m.ErrorEvent(w,{tile:c})):this.update(this.transform));c.timeAdded=m.browser.now(),E==="expired"&&(c.refreshedUponExpiration=!0),this._setTileReloadTimer(d,c),this.getSource().type==="raster-dem"&&c.dem&&this._backfillDEM(c),this._state.initializeTileState(c,this.map?this.map.painter:null),this._source.fire(new m.Event("data",{dataType:"source",tile:c,coord:c.tileID}))},h.prototype._backfillDEM=function(c){for(var d=this.getRenderableIds(),E=0;E<d.length;E++){var w=d[E];if(c.neighboringTiles&&c.neighboringTiles[w]){var P=this.getTileByID(w);L(c,P),L(P,c)}}function L(N,q){N.needsHillshadePrepare=!0;var ce=q.tileID.canonical.x-N.tileID.canonical.x,he=q.tileID.canonical.y-N.tileID.canonical.y,de=Math.pow(2,N.tileID.canonical.z),Re=q.tileID.key;ce===0&&he===0||Math.abs(he)>1||(Math.abs(ce)>1&&(Math.abs(ce+de)===1?ce+=de:Math.abs(ce-de)===1&&(ce-=de)),q.dem&&N.dem&&(N.dem.backfillBorder(q.dem,ce,he),N.neighboringTiles&&N.neighboringTiles[Re]&&(N.neighboringTiles[Re].backfilled=!0)))}},h.prototype.getTile=function(c){return this.getTileByID(c.key)},h.prototype.getTileByID=function(c){return this._tiles[c]},h.prototype._retainLoadedChildren=function(c,d,E,w){for(var P in this._tiles){var L=this._tiles[P];if(!(w[P]||!L.hasData()||L.tileID.overscaledZ<=d||L.tileID.overscaledZ>E)){for(var N=L.tileID;L&&L.tileID.overscaledZ>d+1;){var q=L.tileID.scaledTo(L.tileID.overscaledZ-1);(L=this._tiles[q.key])&&L.hasData()&&(N=q)}for(var ce=N;ce.overscaledZ>d;)if(c[(ce=ce.scaledTo(ce.overscaledZ-1)).key]){w[N.key]=N;break}}}},h.prototype.findLoadedParent=function(c,d){if(c.key in this._loadedParentTiles){var E=this._loadedParentTiles[c.key];return E&&E.tileID.overscaledZ>=d?E:null}for(var w=c.overscaledZ-1;w>=d;w--){var P=c.scaledTo(w),L=this._getLoadedTile(P);if(L)return L}},h.prototype._getLoadedTile=function(c){var d=this._tiles[c.key];return d&&d.hasData()?d:this._cache.getByKey(c.wrapped().key)},h.prototype.updateCacheSize=function(c){var d=Math.ceil(c.width/this._source.tileSize)+1,E=Math.ceil(c.height/this._source.tileSize)+1,w=Math.floor(d*E*5),P=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,w):w;this._cache.setMaxSize(P)},h.prototype.handleWrapJump=function(c){var d=Math.round((c-(this._prevLng===void 0?c:this._prevLng))/360);if(this._prevLng=c,d){var E={};for(var w in this._tiles){var P=this._tiles[w];P.tileID=P.tileID.unwrapTo(P.tileID.wrap+d),E[P.tileID.key]=P}for(var L in this._tiles=E,this._timers)clearTimeout(this._timers[L]),delete this._timers[L];for(var N in this._tiles)this._setTileReloadTimer(N,this._tiles[N])}},h.prototype.update=function(c){var d=this;if(this.transform=c,this._sourceLoaded&&!this._paused){var E;this.updateCacheSize(c),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?E=c.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(dr){return new m.OverscaledTileID(dr.canonical.z,dr.wrap,dr.canonical.z,dr.canonical.x,dr.canonical.y)}):(E=c.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(E=E.filter(function(dr){return d._source.hasTile(dr)}))):E=[];var w=c.coveringZoomLevel(this._source),P=Math.max(w-h.maxOverzooming,this._source.minzoom),L=Math.max(w+h.maxUnderzooming,this._source.minzoom),N=this._updateRetainedTiles(E,w);if(pr(this._source.type)){for(var q={},ce={},he=0,de=Object.keys(N);he<de.length;he+=1){var Re=de[he],Ie=N[Re],We=this._tiles[Re];if(We&&!(We.fadeEndTime&&We.fadeEndTime<=m.browser.now())){var we=this.findLoadedParent(Ie,P);we&&(this._addTile(we.tileID),q[we.tileID.key]=we.tileID),ce[Re]=Ie}}for(var Ve in this._retainLoadedChildren(ce,w,L,N),q)N[Ve]||(this._coveredTiles[Ve]=!0,N[Ve]=q[Ve])}for(var tt in N)this._tiles[tt].clearFadeHold();for(var yt=0,Wt=m.keysDifference(this._tiles,N);yt<Wt.length;yt+=1){var jt=Wt[yt],Jt=this._tiles[jt];Jt.hasSymbolBuckets&&!Jt.holdingForFade()?Jt.setHoldDuration(this.map._fadeDuration):Jt.hasSymbolBuckets&&!Jt.symbolFadeFinished()||this._removeTile(jt)}this._updateLoadedParentTileCache()}},h.prototype.releaseSymbolFadeTiles=function(){for(var c in this._tiles)this._tiles[c].holdingForFade()&&this._removeTile(c)},h.prototype._updateRetainedTiles=function(c,d){for(var E={},w={},P=Math.max(d-h.maxOverzooming,this._source.minzoom),L=Math.max(d+h.maxUnderzooming,this._source.minzoom),N={},q=0,ce=c;q<ce.length;q+=1){var he=ce[q],de=this._addTile(he);E[he.key]=he,de.hasData()||d<this._source.maxzoom&&(N[he.key]=he)}this._retainLoadedChildren(N,d,L,E);for(var Re=0,Ie=c;Re<Ie.length;Re+=1){var We=Ie[Re],we=this._tiles[We.key];if(!we.hasData()){if(d+1>this._source.maxzoom){var Ve=We.children(this._source.maxzoom)[0],tt=this.getTile(Ve);if(tt&&tt.hasData()){E[Ve.key]=Ve;continue}}else{var yt=We.children(this._source.maxzoom);if(E[yt[0].key]&&E[yt[1].key]&&E[yt[2].key]&&E[yt[3].key])continue}for(var Wt=we.wasRequested(),jt=We.overscaledZ-1;jt>=P;--jt){var Jt=We.scaledTo(jt);if(w[Jt.key]||(w[Jt.key]=!0,!(we=this.getTile(Jt))&&Wt&&(we=this._addTile(Jt)),we&&(E[Jt.key]=Jt,Wt=we.wasRequested(),we.hasData())))break}}}return E},h.prototype._updateLoadedParentTileCache=function(){for(var c in this._loadedParentTiles={},this._tiles){for(var d=[],E=void 0,w=this._tiles[c].tileID;w.overscaledZ>0;){if(w.key in this._loadedParentTiles){E=this._loadedParentTiles[w.key];break}d.push(w.key);var P=w.scaledTo(w.overscaledZ-1);if(E=this._getLoadedTile(P))break;w=P}for(var L=0,N=d;L<N.length;L+=1)this._loadedParentTiles[N[L]]=E}},h.prototype._addTile=function(c){var d=this._tiles[c.key];if(d)return d;(d=this._cache.getAndRemove(c))&&(this._setTileReloadTimer(c.key,d),d.tileID=c,this._state.initializeTileState(d,this.map?this.map.painter:null),this._cacheTimers[c.key]&&(clearTimeout(this._cacheTimers[c.key]),delete this._cacheTimers[c.key],this._setTileReloadTimer(c.key,d)));var E=Boolean(d);return E||(d=new m.Tile(c,this._source.tileSize*c.overscaleFactor()),this._loadTile(d,this._tileLoaded.bind(this,d,c.key,d.state))),d?(d.uses++,this._tiles[c.key]=d,E||this._source.fire(new m.Event("dataloading",{tile:d,coord:d.tileID,dataType:"source"})),d):null},h.prototype._setTileReloadTimer=function(c,d){var E=this;c in this._timers&&(clearTimeout(this._timers[c]),delete this._timers[c]);var w=d.getExpiryTimeout();w&&(this._timers[c]=setTimeout(function(){E._reloadTile(c,"expired"),delete E._timers[c]},w))},h.prototype._removeTile=function(c){var d=this._tiles[c];d&&(d.uses--,delete this._tiles[c],this._timers[c]&&(clearTimeout(this._timers[c]),delete this._timers[c]),d.uses>0||(d.hasData()&&d.state!=="reloading"?this._cache.add(d.tileID,d,d.getExpiryTimeout()):(d.aborted=!0,this._abortTile(d),this._unloadTile(d))))},h.prototype.clearTiles=function(){for(var c in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(c);this._cache.reset()},h.prototype.tilesIn=function(c,d,E){var w=this,P=[],L=this.transform;if(!L)return P;for(var N=E?L.getCameraQueryGeometry(c):c,q=c.map(function(jt){return L.pointCoordinate(jt)}),ce=N.map(function(jt){return L.pointCoordinate(jt)}),he=this.getIds(),de=1/0,Re=1/0,Ie=-1/0,We=-1/0,we=0,Ve=ce;we<Ve.length;we+=1){var tt=Ve[we];de=Math.min(de,tt.x),Re=Math.min(Re,tt.y),Ie=Math.max(Ie,tt.x),We=Math.max(We,tt.y)}for(var yt=function(jt){var Jt=w._tiles[he[jt]];if(!Jt.holdingForFade()){var dr=Jt.tileID,Fr=Math.pow(2,L.zoom-Jt.tileID.overscaledZ),kr=d*Jt.queryPadding*m.EXTENT/Jt.tileSize/Fr,ln=[dr.getTilePoint(new m.MercatorCoordinate(de,Re)),dr.getTilePoint(new m.MercatorCoordinate(Ie,We))];if(ln[0].x-kr<m.EXTENT&&ln[0].y-kr<m.EXTENT&&ln[1].x+kr>=0&&ln[1].y+kr>=0){var Nn=q.map(function(Mn){return dr.getTilePoint(Mn)}),zn=ce.map(function(Mn){return dr.getTilePoint(Mn)});P.push({tile:Jt,tileID:dr,queryGeometry:Nn,cameraQueryGeometry:zn,scale:Fr})}}},Wt=0;Wt<he.length;Wt++)yt(Wt);return P},h.prototype.getVisibleCoordinates=function(c){for(var d=this,E=this.getRenderableIds(c).map(function(N){return d._tiles[N].tileID}),w=0,P=E;w<P.length;w+=1){var L=P[w];L.posMatrix=this.transform.calculatePosMatrix(L.toUnwrapped())}return E},h.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(pr(this._source.type))for(var c in this._tiles){var d=this._tiles[c];if(d.fadeEndTime!==void 0&&d.fadeEndTime>=m.browser.now())return!0}return!1},h.prototype.setFeatureState=function(c,d,E){this._state.updateState(c=c||"_geojsonTileLayer",d,E)},h.prototype.removeFeatureState=function(c,d,E){this._state.removeFeatureState(c=c||"_geojsonTileLayer",d,E)},h.prototype.getFeatureState=function(c,d){return this._state.getState(c=c||"_geojsonTileLayer",d)},h.prototype.setDependencies=function(c,d,E){var w=this._tiles[c];w&&w.setDependencies(d,E)},h.prototype.reloadTilesForDependencies=function(c,d){for(var E in this._tiles)this._tiles[E].hasDependency(c,d)&&this._reloadTile(E,"reloading");this._cache.filter(function(w){return!w.hasDependency(c,d)})},h}(m.Evented);function vt(l,h){var c=Math.abs(2*l.wrap)-+(l.wrap<0),d=Math.abs(2*h.wrap)-+(h.wrap<0);return l.overscaledZ-h.overscaledZ||d-c||h.canonical.y-l.canonical.y||h.canonical.x-l.canonical.x}function pr(l){return l==="raster"||l==="image"||l==="video"}function Ft(){return new m.window.Worker(Pa.workerUrl)}ke.maxOverzooming=10,ke.maxUnderzooming=3;var zt="mapboxgl_preloaded_worker_pool",vr=function(){this.active={}};vr.prototype.acquire=function(l){if(!this.workers)for(this.workers=[];this.workers.length<vr.workerCount;)this.workers.push(new Ft);return this.active[l]=!0,this.workers.slice()},vr.prototype.release=function(l){delete this.active[l],this.numActive()===0&&(this.workers.forEach(function(h){h.terminate()}),this.workers=null)},vr.prototype.isPreloaded=function(){return!!this.active[zt]},vr.prototype.numActive=function(){return Object.keys(this.active).length};var En,pn=Math.floor(m.browser.hardwareConcurrency/2);function Ot(){return En||(En=new vr),En}function nn(l,h){var c={};for(var d in l)d!=="ref"&&(c[d]=l[d]);return m.refProperties.forEach(function(E){E in h&&(c[E]=h[E])}),c}function Zr(l){l=l.slice();for(var h=Object.create(null),c=0;c<l.length;c++)h[l[c].id]=l[c];for(var d=0;d<l.length;d++)"ref"in l[d]&&(l[d]=nn(l[d],h[l[d].ref]));return l}vr.workerCount=Math.max(Math.min(pn,6),1);var Yr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function _i(l,h,c){c.push({command:Yr.addSource,args:[l,h[l]]})}function an(l,h,c){h.push({command:Yr.removeSource,args:[l]}),c[l]=!0}function on(l,h,c,d){an(l,c,d),_i(l,h,c)}function Xi(l,h,c){var d;for(d in l[c])if(l[c].hasOwnProperty(d)&&d!=="data"&&!m.deepEqual(l[c][d],h[c][d]))return!1;for(d in h[c])if(h[c].hasOwnProperty(d)&&d!=="data"&&!m.deepEqual(l[c][d],h[c][d]))return!1;return!0}function yi(l,h,c,d,E,w){var P;for(P in h=h||{},l=l||{})l.hasOwnProperty(P)&&(m.deepEqual(l[P],h[P])||c.push({command:w,args:[d,P,h[P],E]}));for(P in h)h.hasOwnProperty(P)&&!l.hasOwnProperty(P)&&(m.deepEqual(l[P],h[P])||c.push({command:w,args:[d,P,h[P],E]}))}function Pi(l){return l.id}function bi(l,h){return l[h.id]=h,l}var ht=function(l,h){this.reset(l,h)};ht.prototype.reset=function(l,h){this.points=l||[],this._distances=[0];for(var c=1;c<this.points.length;c++)this._distances[c]=this._distances[c-1]+this.points[c].dist(this.points[c-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding},ht.prototype.lerp=function(l){if(this.points.length===1)return this.points[0];l=m.clamp(l,0,1);for(var h=1,c=this._distances[h],d=l*this.paddedLength+this.padding;c<d&&h<this._distances.length;)c=this._distances[++h];var E=h-1,w=this._distances[E],P=c-w,L=P>0?(d-w)/P:0;return this.points[E].mult(1-L).add(this.points[h].mult(L))};var Pt=function(l,h,c){var d=this.boxCells=[],E=this.circleCells=[];this.xCellCount=Math.ceil(l/c),this.yCellCount=Math.ceil(h/c);for(var w=0;w<this.xCellCount*this.yCellCount;w++)d.push([]),E.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=h,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0};function Aa(l,h,c,d,E){var w=m.create();return h?(m.scale(w,w,[1/E,1/E,1]),c||m.rotateZ(w,w,d.angle)):m.multiply(w,d.labelPlaneMatrix,l),w}function qi(l,h,c,d,E){if(h){var w=m.clone(l);return m.scale(w,w,[E,E,1]),c||m.rotateZ(w,w,-d.angle),w}return d.glCoordMatrix}function Ii(l,h){var c=[l.x,l.y,0,1];Ra(c,c,h);var d=c[3];return{point:new m.Point(c[0]/d,c[1]/d),signedDistanceFromCamera:d}}function pi(l,h){return .5+l/h*.5}function wa(l,h){var c=l[0]/l[3],d=l[1]/l[3];return c>=-h[0]&&c<=h[0]&&d>=-h[1]&&d<=h[1]}function $s(l,h,c,d,E,w,P,L){var N=d?l.textSizeData:l.iconSizeData,q=m.evaluateSizeForZoom(N,c.transform.zoom),ce=[256/c.width*2+1,256/c.height*2+1],he=d?l.text.dynamicLayoutVertexArray:l.icon.dynamicLayoutVertexArray;he.clear();for(var de=l.lineVertexArray,Re=d?l.text.placedSymbolArray:l.icon.placedSymbolArray,Ie=c.transform.width/c.transform.height,We=!1,we=0;we<Re.length;we++){var Ve=Re.get(we);if(Ve.hidden||Ve.writingMode===m.WritingMode.vertical&&!We)oo(Ve.numGlyphs,he);else{We=!1;var tt=[Ve.anchorX,Ve.anchorY,0,1];if(m.transformMat4(tt,tt,h),wa(tt,ce)){var yt=pi(c.transform.cameraToCenterDistance,tt[3]),Wt=m.evaluateSizeForFeature(N,q,Ve),jt=P?Wt/yt:Wt*yt,Jt=new m.Point(Ve.anchorX,Ve.anchorY),dr=Ii(Jt,E).point,Fr={},kr=Mt(Ve,jt,!1,L,h,E,w,l.glyphOffsetArray,de,he,dr,Jt,Fr,Ie);We=kr.useVertical,(kr.notEnoughRoom||We||kr.needsFlipping&&Mt(Ve,jt,!0,L,h,E,w,l.glyphOffsetArray,de,he,dr,Jt,Fr,Ie).notEnoughRoom)&&oo(Ve.numGlyphs,he)}else oo(Ve.numGlyphs,he)}}d?l.text.dynamicLayoutVertexBuffer.updateData(he):l.icon.dynamicLayoutVertexBuffer.updateData(he)}function Ir(l,h,c,d,E,w,P,L,N,q,ce){var he=L.glyphStartIndex+L.numGlyphs,de=L.lineStartIndex,Re=L.lineStartIndex+L.lineLength,Ie=h.getoffsetX(L.glyphStartIndex),We=h.getoffsetX(he-1),we=ne(l*Ie,c,d,E,w,P,L.segment,de,Re,N,q,ce);if(!we)return null;var Ve=ne(l*We,c,d,E,w,P,L.segment,de,Re,N,q,ce);return Ve?{first:we,last:Ve}:null}function wr(l,h,c,d){return l===m.WritingMode.horizontal&&Math.abs(c.y-h.y)>Math.abs(c.x-h.x)*d?{useVertical:!0}:(l===m.WritingMode.vertical?h.y<c.y:h.x>c.x)?{needsFlipping:!0}:null}function Mt(l,h,c,d,E,w,P,L,N,q,ce,he,de,Re){var Ie,We=h/24,we=l.lineOffsetX*We,Ve=l.lineOffsetY*We;if(l.numGlyphs>1){var tt=l.glyphStartIndex+l.numGlyphs,yt=l.lineStartIndex,Wt=l.lineStartIndex+l.lineLength,jt=Ir(We,L,we,Ve,c,ce,he,l,N,w,de);if(!jt)return{notEnoughRoom:!0};var Jt=Ii(jt.first.point,P).point,dr=Ii(jt.last.point,P).point;if(d&&!c){var Fr=wr(l.writingMode,Jt,dr,Re);if(Fr)return Fr}Ie=[jt.first];for(var kr=l.glyphStartIndex+1;kr<tt-1;kr++)Ie.push(ne(We*L.getoffsetX(kr),we,Ve,c,ce,he,l.segment,yt,Wt,N,w,de));Ie.push(jt.last)}else{if(d&&!c){var ln=Ii(he,E).point,Nn=l.lineStartIndex+l.segment+1,zn=new m.Point(N.getx(Nn),N.gety(Nn)),Mn=Ii(zn,E),Bi=Mn.signedDistanceFromCamera>0?Mn.point:bo(he,zn,ln,1,E),Qr=wr(l.writingMode,ln,Bi,Re);if(Qr)return Qr}var li=ne(We*L.getoffsetX(l.glyphStartIndex),we,Ve,c,ce,he,l.segment,l.lineStartIndex,l.lineStartIndex+l.lineLength,N,w,de);if(!li)return{notEnoughRoom:!0};Ie=[li]}for(var fi=0,ii=Ie;fi<ii.length;fi+=1){var Xn=ii[fi];m.addDynamicAttributes(q,Xn.point,Xn.angle)}return{}}function bo(l,h,c,d,E){var w=Ii(l.add(l.sub(h)._unit()),E).point,P=c.sub(w);return c.add(P._mult(d/P.mag()))}function ne(l,h,c,d,E,w,P,L,N,q,ce,he){var de=d?l-h:l+h,Re=de>0?1:-1,Ie=0;d&&(Re*=-1,Ie=Math.PI),Re<0&&(Ie+=Math.PI);for(var We=Re>0?L+P:L+P+1,we=E,Ve=E,tt=0,yt=0,Wt=Math.abs(de),jt=[];tt+yt<=Wt;){if((We+=Re)<L||We>=N)return null;if(Ve=we,jt.push(we),(we=he[We])===void 0){var Jt=new m.Point(q.getx(We),q.gety(We)),dr=Ii(Jt,ce);if(dr.signedDistanceFromCamera>0)we=he[We]=dr.point;else{var Fr=We-Re;we=bo(tt===0?w:new m.Point(q.getx(Fr),q.gety(Fr)),Jt,Ve,Wt-tt+1,ce)}}tt+=yt,yt=Ve.dist(we)}var kr=(Wt-tt)/yt,ln=we.sub(Ve),Nn=ln.mult(kr)._add(Ve);Nn._add(ln._unit()._perp()._mult(c*Re));var zn=Ie+Math.atan2(we.y-Ve.y,we.x-Ve.x);return jt.push(Nn),{point:Nn,angle:zn,path:jt}}Pt.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Pt.prototype.insert=function(l,h,c,d,E){this._forEachCell(h,c,d,E,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(h),this.bboxes.push(c),this.bboxes.push(d),this.bboxes.push(E)},Pt.prototype.insertCircle=function(l,h,c,d){this._forEachCell(h-d,c-d,h+d,c+d,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(h),this.circles.push(c),this.circles.push(d)},Pt.prototype._insertBoxCell=function(l,h,c,d,E,w){this.boxCells[E].push(w)},Pt.prototype._insertCircleCell=function(l,h,c,d,E,w){this.circleCells[E].push(w)},Pt.prototype._query=function(l,h,c,d,E,w){if(c<0||l>this.width||d<0||h>this.height)return!E&&[];var P=[];if(l<=0&&h<=0&&this.width<=c&&this.height<=d){if(E)return!0;for(var L=0;L<this.boxKeys.length;L++)P.push({key:this.boxKeys[L],x1:this.bboxes[4*L],y1:this.bboxes[4*L+1],x2:this.bboxes[4*L+2],y2:this.bboxes[4*L+3]});for(var N=0;N<this.circleKeys.length;N++){var q=this.circles[3*N],ce=this.circles[3*N+1],he=this.circles[3*N+2];P.push({key:this.circleKeys[N],x1:q-he,y1:ce-he,x2:q+he,y2:ce+he})}return w?P.filter(w):P}return this._forEachCell(l,h,c,d,this._queryCell,P,{hitTest:E,seenUids:{box:{},circle:{}}},w),E?P.length>0:P},Pt.prototype._queryCircle=function(l,h,c,d,E){var w=l-c,P=l+c,L=h-c,N=h+c;if(P<0||w>this.width||N<0||L>this.height)return!d&&[];var q=[];return this._forEachCell(w,L,P,N,this._queryCellCircle,q,{hitTest:d,circle:{x:l,y:h,radius:c},seenUids:{box:{},circle:{}}},E),d?q.length>0:q},Pt.prototype.query=function(l,h,c,d,E){return this._query(l,h,c,d,!1,E)},Pt.prototype.hitTest=function(l,h,c,d,E){return this._query(l,h,c,d,!0,E)},Pt.prototype.hitTestCircle=function(l,h,c,d){return this._queryCircle(l,h,c,!0,d)},Pt.prototype._queryCell=function(l,h,c,d,E,w,P,L){var N=P.seenUids,q=this.boxCells[E];if(q!==null)for(var ce=this.bboxes,he=0,de=q;he<de.length;he+=1){var Re=de[he];if(!N.box[Re]){N.box[Re]=!0;var Ie=4*Re;if(l<=ce[Ie+2]&&h<=ce[Ie+3]&&c>=ce[Ie+0]&&d>=ce[Ie+1]&&(!L||L(this.boxKeys[Re]))){if(P.hitTest)return w.push(!0),!0;w.push({key:this.boxKeys[Re],x1:ce[Ie],y1:ce[Ie+1],x2:ce[Ie+2],y2:ce[Ie+3]})}}}var We=this.circleCells[E];if(We!==null)for(var we=this.circles,Ve=0,tt=We;Ve<tt.length;Ve+=1){var yt=tt[Ve];if(!N.circle[yt]){N.circle[yt]=!0;var Wt=3*yt;if(this._circleAndRectCollide(we[Wt],we[Wt+1],we[Wt+2],l,h,c,d)&&(!L||L(this.circleKeys[yt]))){if(P.hitTest)return w.push(!0),!0;var jt=we[Wt],Jt=we[Wt+1],dr=we[Wt+2];w.push({key:this.circleKeys[yt],x1:jt-dr,y1:Jt-dr,x2:jt+dr,y2:Jt+dr})}}}},Pt.prototype._queryCellCircle=function(l,h,c,d,E,w,P,L){var N=P.circle,q=P.seenUids,ce=this.boxCells[E];if(ce!==null)for(var he=this.bboxes,de=0,Re=ce;de<Re.length;de+=1){var Ie=Re[de];if(!q.box[Ie]){q.box[Ie]=!0;var We=4*Ie;if(this._circleAndRectCollide(N.x,N.y,N.radius,he[We+0],he[We+1],he[We+2],he[We+3])&&(!L||L(this.boxKeys[Ie])))return w.push(!0),!0}}var we=this.circleCells[E];if(we!==null)for(var Ve=this.circles,tt=0,yt=we;tt<yt.length;tt+=1){var Wt=yt[tt];if(!q.circle[Wt]){q.circle[Wt]=!0;var jt=3*Wt;if(this._circlesCollide(Ve[jt],Ve[jt+1],Ve[jt+2],N.x,N.y,N.radius)&&(!L||L(this.circleKeys[Wt])))return w.push(!0),!0}}},Pt.prototype._forEachCell=function(l,h,c,d,E,w,P,L){for(var N=this._convertToXCellCoord(l),q=this._convertToYCellCoord(h),ce=this._convertToXCellCoord(c),he=this._convertToYCellCoord(d),de=N;de<=ce;de++)for(var Re=q;Re<=he;Re++)if(E.call(this,l,h,c,d,this.xCellCount*Re+de,w,P,L))return},Pt.prototype._convertToXCellCoord=function(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))},Pt.prototype._convertToYCellCoord=function(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))},Pt.prototype._circlesCollide=function(l,h,c,d,E,w){var P=d-l,L=E-h,N=c+w;return N*N>P*P+L*L},Pt.prototype._circleAndRectCollide=function(l,h,c,d,E,w,P){var L=(w-d)/2,N=Math.abs(l-(d+L));if(N>L+c)return!1;var q=(P-E)/2,ce=Math.abs(h-(E+q));if(ce>q+c)return!1;if(N<=L||ce<=q)return!0;var he=N-L,de=ce-q;return he*he+de*de<=c*c};var Fu=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function oo(l,h){for(var c=0;c<l;c++){var d=h.length;h.resize(d+4),h.float32.set(Fu,3*d)}}function Ra(l,h,c){var d=h[0],E=h[1];return l[0]=c[0]*d+c[4]*E+c[12],l[1]=c[1]*d+c[5]*E+c[13],l[3]=c[3]*d+c[7]*E+c[15],l}var Ta=function(l,h,c){h===void 0&&(h=new Pt(l.width+200,l.height+200,25)),c===void 0&&(c=new Pt(l.width+200,l.height+200,25)),this.transform=l,this.grid=h,this.ignoredGrid=c,this.pitchfactor=Math.cos(l._pitch)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+100,this.screenBottomBoundary=l.height+100,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200};function Qi(l,h,c){return h*(m.EXTENT/(l.tileSize*Math.pow(2,c-l.tileID.overscaledZ)))}Ta.prototype.placeCollisionBox=function(l,h,c,d,E){var w=this.projectAndGetPerspectiveRatio(d,l.anchorPointX,l.anchorPointY),P=c*w.perspectiveRatio,L=l.x1*P+w.point.x,N=l.y1*P+w.point.y,q=l.x2*P+w.point.x,ce=l.y2*P+w.point.y;return!this.isInsideGrid(L,N,q,ce)||!h&&this.grid.hitTest(L,N,q,ce,E)?{box:[],offscreen:!1}:{box:[L,N,q,ce],offscreen:this.isOffscreen(L,N,q,ce)}},Ta.prototype.placeCollisionCircles=function(l,h,c,d,E,w,P,L,N,q,ce,he,de){var Re=[],Ie=new m.Point(h.anchorX,h.anchorY),We=Ii(Ie,w),we=pi(this.transform.cameraToCenterDistance,We.signedDistanceFromCamera),Ve=(q?E/we:E*we)/m.ONE_EM,tt=Ii(Ie,P).point,yt=Ir(Ve,d,h.lineOffsetX*Ve,h.lineOffsetY*Ve,!1,tt,Ie,h,c,P,{}),Wt=!1,jt=!1,Jt=!0;if(yt){for(var dr=.5*he*we+de,Fr=new m.Point(-100,-100),kr=new m.Point(this.screenRightBoundary,this.screenBottomBoundary),ln=new ht,Nn=yt.first,zn=yt.last,Mn=[],Bi=Nn.path.length-1;Bi>=1;Bi--)Mn.push(Nn.path[Bi]);for(var Qr=1;Qr<zn.path.length;Qr++)Mn.push(zn.path[Qr]);var li=2.5*dr;if(L){var fi=Mn.map(function(vo){return Ii(vo,L)});Mn=fi.some(function(vo){return vo.signedDistanceFromCamera<=0})?[]:fi.map(function(vo){return vo.point})}var ii=[];if(Mn.length>0){for(var Xn=Mn[0].clone(),xi=Mn[0].clone(),ri=1;ri<Mn.length;ri++)Xn.x=Math.min(Xn.x,Mn[ri].x),Xn.y=Math.min(Xn.y,Mn[ri].y),xi.x=Math.max(xi.x,Mn[ri].x),xi.y=Math.max(xi.y,Mn[ri].y);ii=Xn.x>=Fr.x&&xi.x<=kr.x&&Xn.y>=Fr.y&&xi.y<=kr.y?[Mn]:xi.x<Fr.x||Xn.x>kr.x||xi.y<Fr.y||Xn.y>kr.y?[]:m.clipLine([Mn],Fr.x,Fr.y,kr.x,kr.y)}for(var Kn=0,po=ii;Kn<po.length;Kn+=1){var Ka;ln.reset(po[Kn],.25*dr),Ka=ln.length<=.5*dr?1:Math.ceil(ln.paddedLength/li)+1;for(var Ho=0;Ho<Ka;Ho++){var Bo=Ho/Math.max(Ka-1,1),za=ln.lerp(Bo),co=za.x+100,Bs=za.y+100;Re.push(co,Bs,dr,0);var _s=co-dr,Hu=Bs-dr,xs=co+dr,pu=Bs+dr;if(Jt=Jt&&this.isOffscreen(_s,Hu,xs,pu),jt=jt||this.isInsideGrid(_s,Hu,xs,pu),!l&&this.grid.hitTestCircle(co,Bs,dr,ce)&&(Wt=!0,!N))return{circles:[],offscreen:!1,collisionDetected:Wt}}}}return{circles:!N&&Wt||!jt?[]:Re,offscreen:Jt,collisionDetected:Wt}},Ta.prototype.queryRenderedSymbols=function(l){if(l.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var h=[],c=1/0,d=1/0,E=-1/0,w=-1/0,P=0,L=l;P<L.length;P+=1){var N=L[P],q=new m.Point(N.x+100,N.y+100);c=Math.min(c,q.x),d=Math.min(d,q.y),E=Math.max(E,q.x),w=Math.max(w,q.y),h.push(q)}for(var ce={},he={},de=0,Re=this.grid.query(c,d,E,w).concat(this.ignoredGrid.query(c,d,E,w));de<Re.length;de+=1){var Ie=Re[de],We=Ie.key;if(ce[We.bucketInstanceId]===void 0&&(ce[We.bucketInstanceId]={}),!ce[We.bucketInstanceId][We.featureIndex]){var we=[new m.Point(Ie.x1,Ie.y1),new m.Point(Ie.x2,Ie.y1),new m.Point(Ie.x2,Ie.y2),new m.Point(Ie.x1,Ie.y2)];m.polygonIntersectsPolygon(h,we)&&(ce[We.bucketInstanceId][We.featureIndex]=!0,he[We.bucketInstanceId]===void 0&&(he[We.bucketInstanceId]=[]),he[We.bucketInstanceId].push(We.featureIndex))}}return he},Ta.prototype.insertCollisionBox=function(l,h,c,d,E){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:c,featureIndex:d,collisionGroupID:E},l[0],l[1],l[2],l[3])},Ta.prototype.insertCollisionCircles=function(l,h,c,d,E){for(var w=h?this.ignoredGrid:this.grid,P={bucketInstanceId:c,featureIndex:d,collisionGroupID:E},L=0;L<l.length;L+=4)w.insertCircle(P,l[L],l[L+1],l[L+2])},Ta.prototype.projectAndGetPerspectiveRatio=function(l,h,c){var d=[h,c,0,1];return Ra(d,d,l),{point:new m.Point((d[0]/d[3]+1)/2*this.transform.width+100,(-d[1]/d[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/d[3]*.5}},Ta.prototype.isOffscreen=function(l,h,c,d){return c<100||l>=this.screenRightBoundary||d<100||h>this.screenBottomBoundary},Ta.prototype.isInsideGrid=function(l,h,c,d){return c>=0&&l<this.gridRightBoundary&&d>=0&&h<this.gridBottomBoundary},Ta.prototype.getViewportMatrix=function(){var l=m.identity([]);return m.translate(l,l,[-100,-100,0]),l};var Uo=function(l,h,c,d){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?h:-h))):d&&c?1:0,this.placed=c};Uo.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var $o=function(l,h,c,d,E){this.text=new Uo(l?l.text:null,h,c,E),this.icon=new Uo(l?l.icon:null,h,d,E)};$o.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var xu=function(l,h,c){this.text=l,this.icon=h,this.skipFade=c},Eo=function(){this.invProjMatrix=m.create(),this.viewportMatrix=m.create(),this.circles=[]},Zo=function(l,h,c,d,E){this.bucketInstanceId=l,this.featureIndex=h,this.sourceLayerIndex=c,this.bucketIndex=d,this.tileID=E},sa=function(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}};function so(l,h,c,d,E){var w=m.getAnchorAlignment(l),P=-(w.horizontalAlign-.5)*h,L=-(w.verticalAlign-.5)*c,N=m.evaluateVariableOffset(l,d);return new m.Point(P+N[0]*E,L+N[1]*E)}function jo(l,h,c,d,E,w){var P=l.x1,L=l.x2,N=l.y1,q=l.y2,ce=l.anchorPointX,he=l.anchorPointY,de=new m.Point(h,c);return d&&de._rotate(E?w:-w),{x1:P+de.x,y1:N+de.y,x2:L+de.x,y2:q+de.y,anchorPointX:ce,anchorPointY:he}}sa.prototype.get=function(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){var h=++this.maxGroupID;this.collisionGroups[l]={ID:h,predicate:function(c){return c.collisionGroupID===h}}}return this.collisionGroups[l]};var Ya=function(l,h,c,d){this.transform=l.clone(),this.collisionIndex=new Ta(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new sa(c),this.collisionCircleArrays={},this.prevPlacement=d,d&&(d.prevPlacement=void 0),this.placedOrientations={}};function Gs(l,h,c,d,E){l.emplaceBack(h?1:0,c?1:0,d||0,E||0),l.emplaceBack(h?1:0,c?1:0,d||0,E||0),l.emplaceBack(h?1:0,c?1:0,d||0,E||0),l.emplaceBack(h?1:0,c?1:0,d||0,E||0)}Ya.prototype.getBucketParts=function(l,h,c,d){var E=c.getBucket(h),w=c.latestFeatureIndex;if(E&&w&&h.id===E.layerIds[0]){var P=c.collisionBoxArray,L=E.layers[0].layout,N=Math.pow(2,this.transform.zoom-c.tileID.overscaledZ),q=c.tileSize/m.EXTENT,ce=this.transform.calculatePosMatrix(c.tileID.toUnwrapped()),he=L.get("text-pitch-alignment")==="map",de=L.get("text-rotation-alignment")==="map",Re=Qi(c,1,this.transform.zoom),Ie=Aa(ce,he,de,this.transform,Re),We=null;if(he){var we=qi(ce,he,de,this.transform,Re);We=m.multiply([],this.transform.labelPlaneMatrix,we)}this.retainedQueryData[E.bucketInstanceId]=new Zo(E.bucketInstanceId,w,E.sourceLayerIndex,E.index,c.tileID);var Ve={bucket:E,layout:L,posMatrix:ce,textLabelPlaneMatrix:Ie,labelToScreenMatrix:We,scale:N,textPixelRatio:q,holdingForFade:c.holdingForFade(),collisionBoxArray:P,partiallyEvaluatedTextSize:m.evaluateSizeForZoom(E.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(E.sourceID)};if(d)for(var tt=0,yt=E.sortKeyRanges;tt<yt.length;tt+=1){var Wt=yt[tt];l.push({sortKey:Wt.sortKey,symbolInstanceStart:Wt.symbolInstanceStart,symbolInstanceEnd:Wt.symbolInstanceEnd,parameters:Ve})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:E.symbolInstances.length,parameters:Ve})}},Ya.prototype.attemptAnchorPlacement=function(l,h,c,d,E,w,P,L,N,q,ce,he,de,Re,Ie){var We,we=[he.textOffset0,he.textOffset1],Ve=so(l,c,d,we,E),tt=this.collisionIndex.placeCollisionBox(jo(h,Ve.x,Ve.y,w,P,this.transform.angle),ce,L,N,q.predicate);if(!Ie||this.collisionIndex.placeCollisionBox(jo(Ie,Ve.x,Ve.y,w,P,this.transform.angle),ce,L,N,q.predicate).box.length!==0)return tt.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[he.crossTileID]&&this.prevPlacement.placements[he.crossTileID]&&this.prevPlacement.placements[he.crossTileID].text&&(We=this.prevPlacement.variableOffsets[he.crossTileID].anchor),this.variableOffsets[he.crossTileID]={textOffset:we,width:c,height:d,anchor:l,textBoxScale:E,prevAnchor:We},this.markUsedJustification(de,l,he,Re),de.allowVerticalPlacement&&(this.markUsedOrientation(de,Re,he),this.placedOrientations[he.crossTileID]=Re),{shift:Ve,placedGlyphBoxes:tt}):void 0},Ya.prototype.placeLayerBucketPart=function(l,h,c){var d=this,E=l.parameters,w=E.bucket,P=E.layout,L=E.posMatrix,N=E.textLabelPlaneMatrix,q=E.labelToScreenMatrix,ce=E.textPixelRatio,he=E.holdingForFade,de=E.collisionBoxArray,Re=E.partiallyEvaluatedTextSize,Ie=E.collisionGroup,We=P.get("text-optional"),we=P.get("icon-optional"),Ve=P.get("text-allow-overlap"),tt=P.get("icon-allow-overlap"),yt=P.get("text-rotation-alignment")==="map",Wt=P.get("text-pitch-alignment")==="map",jt=P.get("icon-text-fit")!=="none",Jt=P.get("symbol-z-order")==="viewport-y",dr=Ve&&(tt||!w.hasIconData()||we),Fr=tt&&(Ve||!w.hasTextData()||We);!w.collisionArrays&&de&&w.deserializeCollisionBoxes(de);var kr=function(Qr,li){if(!h[Qr.crossTileID])if(he)d.placements[Qr.crossTileID]=new xu(!1,!1,!1);else{var fi,ii=!1,Xn=!1,xi=!0,ri=null,Kn={box:null,offscreen:null},po={box:null,offscreen:null},Ka=null,Ho=null,Bo=0,za=0,co=0;li.textFeatureIndex?Bo=li.textFeatureIndex:Qr.useRuntimeCollisionCircles&&(Bo=Qr.featureIndex),li.verticalTextFeatureIndex&&(za=li.verticalTextFeatureIndex);var Bs=li.textBox;if(Bs){var _s=function(ta){var is=m.WritingMode.horizontal;if(w.allowVerticalPlacement&&!ta&&d.prevPlacement){var Ms=d.prevPlacement.placedOrientations[Qr.crossTileID];Ms&&(d.placedOrientations[Qr.crossTileID]=Ms,d.markUsedOrientation(w,is=Ms,Qr))}return is},Hu=function(ta,is){if(w.allowVerticalPlacement&&Qr.numVerticalGlyphVertices>0&&li.verticalTextBox)for(var Ms=0,bl=w.writingModes;Ms<bl.length&&(bl[Ms]===m.WritingMode.vertical?(Kn=is(),po=Kn):Kn=ta(),!(Kn&&Kn.box&&Kn.box.length));Ms+=1);else Kn=ta()};if(P.get("text-variable-anchor")){var xs=P.get("text-variable-anchor");if(d.prevPlacement&&d.prevPlacement.variableOffsets[Qr.crossTileID]){var pu=d.prevPlacement.variableOffsets[Qr.crossTileID];xs.indexOf(pu.anchor)>0&&(xs=xs.filter(function(ta){return ta!==pu.anchor})).unshift(pu.anchor)}var vo=function(ta,is,Ms){for(var bl=ta.x2-ta.x1,_f=ta.y2-ta.y1,xf=Qr.textBoxScale,Gc=jt&&!tt?is:null,mo={box:[],offscreen:!1},Hc=Ve?2*xs.length:xs.length,Ru=0;Ru<Hc;++Ru){var Zl=d.attemptAnchorPlacement(xs[Ru%xs.length],ta,bl,_f,xf,yt,Wt,ce,L,Ie,Ru>=xs.length,Qr,w,Ms,Gc);if(Zl&&(mo=Zl.placedGlyphBoxes)&&mo.box&&mo.box.length){ii=!0,ri=Zl.shift;break}}return mo};Hu(function(){return vo(Bs,li.iconBox,m.WritingMode.horizontal)},function(){var ta=li.verticalTextBox;return w.allowVerticalPlacement&&!(Kn&&Kn.box&&Kn.box.length)&&Qr.numVerticalGlyphVertices>0&&ta?vo(ta,li.verticalIconBox,m.WritingMode.vertical):{box:null,offscreen:null}}),Kn&&(ii=Kn.box,xi=Kn.offscreen);var mc=_s(Kn&&Kn.box);if(!ii&&d.prevPlacement){var ru=d.prevPlacement.variableOffsets[Qr.crossTileID];ru&&(d.variableOffsets[Qr.crossTileID]=ru,d.markUsedJustification(w,ru.anchor,Qr,mc))}}else{var Wu=function(ta,is){var Ms=d.collisionIndex.placeCollisionBox(ta,Ve,ce,L,Ie.predicate);return Ms&&Ms.box&&Ms.box.length&&(d.markUsedOrientation(w,is,Qr),d.placedOrientations[Qr.crossTileID]=is),Ms};Hu(function(){return Wu(Bs,m.WritingMode.horizontal)},function(){var ta=li.verticalTextBox;return w.allowVerticalPlacement&&Qr.numVerticalGlyphVertices>0&&ta?Wu(ta,m.WritingMode.vertical):{box:null,offscreen:null}}),_s(Kn&&Kn.box&&Kn.box.length)}}if(ii=(fi=Kn)&&fi.box&&fi.box.length>0,xi=fi&&fi.offscreen,Qr.useRuntimeCollisionCircles){var du=w.text.placedSymbolArray.get(Qr.centerJustifiedTextSymbolIndex),xl=m.evaluateSizeForFeature(w.textSizeData,Re,du),vu=P.get("text-padding");Ka=d.collisionIndex.placeCollisionCircles(Ve,du,w.lineVertexArray,w.glyphOffsetArray,xl,L,N,q,c,Wt,Ie.predicate,Qr.collisionCircleDiameter,vu),ii=Ve||Ka.circles.length>0&&!Ka.collisionDetected,xi=xi&&Ka.offscreen}if(li.iconFeatureIndex&&(co=li.iconFeatureIndex),li.iconBox){var Ul=function(ta){var is=jt&&ri?jo(ta,ri.x,ri.y,yt,Wt,d.transform.angle):ta;return d.collisionIndex.placeCollisionBox(is,tt,ce,L,Ie.predicate)};Xn=po&&po.box&&po.box.length&&li.verticalIconBox?(Ho=Ul(li.verticalIconBox)).box.length>0:(Ho=Ul(li.iconBox)).box.length>0,xi=xi&&Ho.offscreen}var Ou=We||Qr.numHorizontalGlyphVertices===0&&Qr.numVerticalGlyphVertices===0,So=we||Qr.numIconVertices===0;if(Ou||So?So?Ou||(Xn=Xn&&ii):ii=Xn&&ii:Xn=ii=Xn&&ii,ii&&fi&&fi.box&&d.collisionIndex.insertCollisionBox(fi.box,P.get("text-ignore-placement"),w.bucketInstanceId,po&&po.box&&za?za:Bo,Ie.ID),Xn&&Ho&&d.collisionIndex.insertCollisionBox(Ho.box,P.get("icon-ignore-placement"),w.bucketInstanceId,co,Ie.ID),Ka&&(ii&&d.collisionIndex.insertCollisionCircles(Ka.circles,P.get("text-ignore-placement"),w.bucketInstanceId,Bo,Ie.ID),c)){var ka=w.bucketInstanceId,Ua=d.collisionCircleArrays[ka];Ua===void 0&&(Ua=d.collisionCircleArrays[ka]=new Eo);for(var mu=0;mu<Ka.circles.length;mu+=4)Ua.circles.push(Ka.circles[mu+0]),Ua.circles.push(Ka.circles[mu+1]),Ua.circles.push(Ka.circles[mu+2]),Ua.circles.push(Ka.collisionDetected?1:0)}d.placements[Qr.crossTileID]=new xu(ii||dr,Xn||Fr,xi||w.justReloaded),h[Qr.crossTileID]=!0}};if(Jt)for(var ln=w.getSortedSymbolIndexes(this.transform.angle),Nn=ln.length-1;Nn>=0;--Nn){var zn=ln[Nn];kr(w.symbolInstances.get(zn),w.collisionArrays[zn])}else for(var Mn=l.symbolInstanceStart;Mn<l.symbolInstanceEnd;Mn++)kr(w.symbolInstances.get(Mn),w.collisionArrays[Mn]);if(c&&w.bucketInstanceId in this.collisionCircleArrays){var Bi=this.collisionCircleArrays[w.bucketInstanceId];m.invert(Bi.invProjMatrix,L),Bi.viewportMatrix=this.collisionIndex.getViewportMatrix()}w.justReloaded=!1},Ya.prototype.markUsedJustification=function(l,h,c,d){var E;E=d===m.WritingMode.vertical?c.verticalPlacedTextSymbolIndex:{left:c.leftJustifiedTextSymbolIndex,center:c.centerJustifiedTextSymbolIndex,right:c.rightJustifiedTextSymbolIndex}[m.getAnchorJustification(h)];for(var w=0,P=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex,c.verticalPlacedTextSymbolIndex];w<P.length;w+=1){var L=P[w];L>=0&&(l.text.placedSymbolArray.get(L).crossTileID=E>=0&&L!==E?0:c.crossTileID)}},Ya.prototype.markUsedOrientation=function(l,h,c){for(var d=h===m.WritingMode.horizontal||h===m.WritingMode.horizontalOnly?h:0,E=h===m.WritingMode.vertical?h:0,w=0,P=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex];w<P.length;w+=1)l.text.placedSymbolArray.get(P[w]).placedOrientation=d;c.verticalPlacedTextSymbolIndex&&(l.text.placedSymbolArray.get(c.verticalPlacedTextSymbolIndex).placedOrientation=E)},Ya.prototype.commit=function(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;var h=this.prevPlacement,c=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;var d=h?h.symbolFadeChange(l):1,E=h?h.opacities:{},w=h?h.variableOffsets:{},P=h?h.placedOrientations:{};for(var L in this.placements){var N=this.placements[L],q=E[L];q?(this.opacities[L]=new $o(q,d,N.text,N.icon),c=c||N.text!==q.text.placed||N.icon!==q.icon.placed):(this.opacities[L]=new $o(null,d,N.text,N.icon,N.skipFade),c=c||N.text||N.icon)}for(var ce in E){var he=E[ce];if(!this.opacities[ce]){var de=new $o(he,d,!1,!1);de.isHidden()||(this.opacities[ce]=de,c=c||he.text.placed||he.icon.placed)}}for(var Re in w)this.variableOffsets[Re]||!this.opacities[Re]||this.opacities[Re].isHidden()||(this.variableOffsets[Re]=w[Re]);for(var Ie in P)this.placedOrientations[Ie]||!this.opacities[Ie]||this.opacities[Ie].isHidden()||(this.placedOrientations[Ie]=P[Ie]);c?this.lastPlacementChangeTime=l:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:l)},Ya.prototype.updateLayerOpacities=function(l,h){for(var c={},d=0,E=h;d<E.length;d+=1){var w=E[d],P=w.getBucket(l);P&&w.latestFeatureIndex&&l.id===P.layerIds[0]&&this.updateBucketOpacities(P,c,w.collisionBoxArray)}},Ya.prototype.updateBucketOpacities=function(l,h,c){var d=this;l.hasTextData()&&l.text.opacityVertexArray.clear(),l.hasIconData()&&l.icon.opacityVertexArray.clear(),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();var E=l.layers[0].layout,w=new $o(null,0,!1,!1,!0),P=E.get("text-allow-overlap"),L=E.get("icon-allow-overlap"),N=E.get("text-variable-anchor"),q=E.get("text-rotation-alignment")==="map",ce=E.get("text-pitch-alignment")==="map",he=E.get("icon-text-fit")!=="none",de=new $o(null,0,P&&(L||!l.hasIconData()||E.get("icon-optional")),L&&(P||!l.hasTextData()||E.get("text-optional")),!0);!l.collisionArrays&&c&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(c);for(var Re=function(Ve,tt,yt){for(var Wt=0;Wt<tt/4;Wt++)Ve.opacityVertexArray.emplaceBack(yt)},Ie=function(Ve){var tt=l.symbolInstances.get(Ve),yt=tt.numHorizontalGlyphVertices,Wt=tt.numVerticalGlyphVertices,jt=tt.crossTileID,Jt=d.opacities[jt];h[jt]?Jt=w:Jt||(d.opacities[jt]=Jt=de),h[jt]=!0;var dr=tt.numIconVertices>0,Fr=d.placedOrientations[tt.crossTileID],kr=Fr===m.WritingMode.vertical,ln=Fr===m.WritingMode.horizontal||Fr===m.WritingMode.horizontalOnly;if(yt>0||Wt>0){var Nn=Tn(Jt.text);Re(l.text,yt,kr?Ti:Nn),Re(l.text,Wt,ln?Ti:Nn);var zn=Jt.text.isHidden();[tt.rightJustifiedTextSymbolIndex,tt.centerJustifiedTextSymbolIndex,tt.leftJustifiedTextSymbolIndex].forEach(function(Kn){Kn>=0&&(l.text.placedSymbolArray.get(Kn).hidden=zn||kr?1:0)}),tt.verticalPlacedTextSymbolIndex>=0&&(l.text.placedSymbolArray.get(tt.verticalPlacedTextSymbolIndex).hidden=zn||ln?1:0);var Mn=d.variableOffsets[tt.crossTileID];Mn&&d.markUsedJustification(l,Mn.anchor,tt,Fr);var Bi=d.placedOrientations[tt.crossTileID];Bi&&(d.markUsedJustification(l,"left",tt,Bi),d.markUsedOrientation(l,Bi,tt))}if(dr){var Qr=Tn(Jt.icon),li=!(he&&tt.verticalPlacedIconSymbolIndex&&kr);tt.placedIconSymbolIndex>=0&&(Re(l.icon,tt.numIconVertices,li?Qr:Ti),l.icon.placedSymbolArray.get(tt.placedIconSymbolIndex).hidden=Jt.icon.isHidden()),tt.verticalPlacedIconSymbolIndex>=0&&(Re(l.icon,tt.numVerticalIconVertices,li?Ti:Qr),l.icon.placedSymbolArray.get(tt.verticalPlacedIconSymbolIndex).hidden=Jt.icon.isHidden())}if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){var fi=l.collisionArrays[Ve];if(fi){var ii=new m.Point(0,0);if(fi.textBox||fi.verticalTextBox){var Xn=!0;if(N){var xi=d.variableOffsets[jt];xi?(ii=so(xi.anchor,xi.width,xi.height,xi.textOffset,xi.textBoxScale),q&&ii._rotate(ce?d.transform.angle:-d.transform.angle)):Xn=!1}fi.textBox&&Gs(l.textCollisionBox.collisionVertexArray,Jt.text.placed,!Xn||kr,ii.x,ii.y),fi.verticalTextBox&&Gs(l.textCollisionBox.collisionVertexArray,Jt.text.placed,!Xn||ln,ii.x,ii.y)}var ri=Boolean(!ln&&fi.verticalIconBox);fi.iconBox&&Gs(l.iconCollisionBox.collisionVertexArray,Jt.icon.placed,ri,he?ii.x:0,he?ii.y:0),fi.verticalIconBox&&Gs(l.iconCollisionBox.collisionVertexArray,Jt.icon.placed,!ri,he?ii.x:0,he?ii.y:0)}}},We=0;We<l.symbolInstances.length;We++)Ie(We);if(l.sortFeatures(this.transform.angle),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.bucketInstanceId in this.collisionCircleArrays){var we=this.collisionCircleArrays[l.bucketInstanceId];l.placementInvProjMatrix=we.invProjMatrix,l.placementViewportMatrix=we.viewportMatrix,l.collisionCircleArray=we.circles,delete this.collisionCircleArrays[l.bucketInstanceId]}},Ya.prototype.symbolFadeChange=function(l){return this.fadeDuration===0?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},Ya.prototype.zoomAdjustment=function(l){return Math.max(0,(this.transform.zoom-l)/1.5)},Ya.prototype.hasTransitions=function(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration},Ya.prototype.stillRecent=function(l,h){var c=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*c>l},Ya.prototype.setStale=function(){this.stale=!0};var ll=Math.pow(2,25),os=Math.pow(2,24),ie=Math.pow(2,17),Ee=Math.pow(2,16),qe=Math.pow(2,9),Rt=Math.pow(2,8),Or=Math.pow(2,1);function Tn(l){if(l.opacity===0&&!l.placed)return 0;if(l.opacity===1&&l.placed)return 4294967295;var h=l.placed?1:0,c=Math.floor(127*l.opacity);return c*ll+h*os+c*ie+h*Ee+c*qe+h*Rt+c*Or+h}var Ti=0,ro=function(l){this._sortAcrossTiles=l.layout.get("symbol-z-order")!=="viewport-y"&&l.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};ro.prototype.continuePlacement=function(l,h,c,d,E){for(var w=this._bucketParts;this._currentTileIndex<l.length;)if(h.getBucketParts(w,d,l[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,E())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,w.sort(function(P,L){return P.sortKey-L.sortKey}));this._currentPartIndex<w.length;)if(h.placeLayerBucketPart(w[this._currentPartIndex],this._seenCrossTileIDs,c),this._currentPartIndex++,E())return!0;return!1};var La=function(l,h,c,d,E,w,P){this.placement=new Ya(l,E,w,P),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=c,this._showCollisionBoxes=d,this._done=!1};La.prototype.isDone=function(){return this._done},La.prototype.continuePlacement=function(l,h,c){for(var d=this,E=m.browser.now(),w=function(){var N=m.browser.now()-E;return!d._forceFullPlacement&&N>2};this._currentPlacementIndex>=0;){var P=h[l[this._currentPlacementIndex]],L=this.placement.collisionIndex.transform.zoom;if(P.type==="symbol"&&(!P.minzoom||P.minzoom<=L)&&(!P.maxzoom||P.maxzoom>L)){if(this._inProgressLayer||(this._inProgressLayer=new ro(P)),this._inProgressLayer.continuePlacement(c[P.source],this.placement,this._showCollisionBoxes,P,w))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},La.prototype.commit=function(l){return this.placement.commit(l),this.placement};var ja=512/m.EXTENT/2,Qo=function(l,h,c){this.tileID=l,this.indexedSymbolInstances={},this.bucketInstanceId=c;for(var d=0;d<h.length;d++){var E=h.get(d),w=E.key;this.indexedSymbolInstances[w]||(this.indexedSymbolInstances[w]=[]),this.indexedSymbolInstances[w].push({crossTileID:E.crossTileID,coord:this.getScaledCoordinates(E,l)})}};Qo.prototype.getScaledCoordinates=function(l,h){var c=ja/Math.pow(2,h.canonical.z-this.tileID.canonical.z);return{x:Math.floor((h.canonical.x*m.EXTENT+l.anchorX)*c),y:Math.floor((h.canonical.y*m.EXTENT+l.anchorY)*c)}},Qo.prototype.findMatches=function(l,h,c){for(var d=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z),E=0;E<l.length;E++){var w=l.get(E);if(!w.crossTileID){var P=this.indexedSymbolInstances[w.key];if(P)for(var L=this.getScaledCoordinates(w,h),N=0,q=P;N<q.length;N+=1){var ce=q[N];if(Math.abs(ce.coord.x-L.x)<=d&&Math.abs(ce.coord.y-L.y)<=d&&!c[ce.crossTileID]){c[ce.crossTileID]=!0,w.crossTileID=ce.crossTileID;break}}}}};var ps=function(){this.maxCrossTileID=0};ps.prototype.generate=function(){return++this.maxCrossTileID};var Jo=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};Jo.prototype.handleWrapJump=function(l){var h=Math.round((l-this.lng)/360);if(h!==0)for(var c in this.indexes){var d=this.indexes[c],E={};for(var w in d){var P=d[w];P.tileID=P.tileID.unwrapTo(P.tileID.wrap+h),E[P.tileID.key]=P}this.indexes[c]=E}this.lng=l},Jo.prototype.addBucket=function(l,h,c){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(var d=0;d<h.symbolInstances.length;d++)h.symbolInstances.get(d).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]={});var E=this.usedCrossTileIDs[l.overscaledZ];for(var w in this.indexes){var P=this.indexes[w];if(Number(w)>l.overscaledZ)for(var L in P){var N=P[L];N.tileID.isChildOf(l)&&N.findMatches(h.symbolInstances,l,E)}else{var q=P[l.scaledTo(Number(w)).key];q&&q.findMatches(h.symbolInstances,l,E)}}for(var ce=0;ce<h.symbolInstances.length;ce++){var he=h.symbolInstances.get(ce);he.crossTileID||(he.crossTileID=c.generate(),E[he.crossTileID]=!0)}return this.indexes[l.overscaledZ]===void 0&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new Qo(l,h.symbolInstances,h.bucketInstanceId),!0},Jo.prototype.removeBucketCrossTileIDs=function(l,h){for(var c in h.indexedSymbolInstances)for(var d=0,E=h.indexedSymbolInstances[c];d<E.length;d+=1)delete this.usedCrossTileIDs[l][E[d].crossTileID]},Jo.prototype.removeStaleBuckets=function(l){var h=!1;for(var c in this.indexes){var d=this.indexes[c];for(var E in d)l[d[E].bucketInstanceId]||(this.removeBucketCrossTileIDs(c,d[E]),delete d[E],h=!0)}return h};var Ss=function(){this.layerIndexes={},this.crossTileIDs=new ps,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};Ss.prototype.addLayer=function(l,h,c){var d=this.layerIndexes[l.id];d===void 0&&(d=this.layerIndexes[l.id]=new Jo);var E=!1,w={};d.handleWrapJump(c);for(var P=0,L=h;P<L.length;P+=1){var N=L[P],q=N.getBucket(l);q&&l.id===q.layerIds[0]&&(q.bucketInstanceId||(q.bucketInstanceId=++this.maxBucketInstanceId),d.addBucket(N.tileID,q,this.crossTileIDs)&&(E=!0),w[q.bucketInstanceId]=!0)}return d.removeStaleBuckets(w)&&(E=!0),E},Ss.prototype.pruneUnusedLayers=function(l){var h={};for(var c in l.forEach(function(d){h[d]=!0}),this.layerIndexes)h[c]||delete this.layerIndexes[c]};var Lo=function(l,h){return m.emitValidationErrors(l,h&&h.filter(function(c){return c.identifier!=="source.canvas"}))},Vo=m.pick(Yr,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Qs=m.pick(Yr,["setCenter","setZoom","setBearing","setPitch"]),ou=function(){var l={},h=m.styleSpec.$version;for(var c in m.styleSpec.$root){var d,E=m.styleSpec.$root[c];E.required&&(d=c==="version"?h:E.type==="array"?[]:{})!=null&&(l[c]=d)}return l}(),ds=function(l){function h(c,d){var E=this;d===void 0&&(d={}),l.call(this),this.map=c,this.dispatcher=new Qt(Ot(),this),this.imageManager=new xt,this.imageManager.setEventedParent(this),this.glyphManager=new $t(c._requestManager,d.localIdeographFontFamily),this.lineAtlas=new Qe(256,512),this.crossTileSymbolIndex=new Ss,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new m.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",m.getReferrer());var w=this;this._rtlTextPluginCallback=h.registerForPluginStateChange(function(P){w.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:P.pluginStatus,pluginURL:P.pluginURL},function(L,N){if(m.triggerPluginCompletionEvent(L),N&&N.every(function(ce){return ce}))for(var q in w.sourceCaches)w.sourceCaches[q].reload()})}),this.on("data",function(P){if(P.dataType==="source"&&P.sourceDataType==="metadata"){var L=E.sourceCaches[P.sourceId];if(L){var N=L.getSource();if(N&&N.vectorLayerIds)for(var q in E._layers){var ce=E._layers[q];ce.source===N.id&&E._validateLayer(ce)}}}})}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.loadURL=function(c,d){var E=this;d===void 0&&(d={}),this.fire(new m.Event("dataloading",{dataType:"style"}));var w=typeof d.validate=="boolean"?d.validate:!m.isMapboxURL(c);c=this.map._requestManager.normalizeStyleURL(c,d.accessToken);var P=this.map._requestManager.transformRequest(c,m.ResourceType.Style);this._request=m.getJSON(P,function(L,N){E._request=null,L?E.fire(new m.ErrorEvent(L)):N&&E._load(N,w)})},h.prototype.loadJSON=function(c,d){var E=this;d===void 0&&(d={}),this.fire(new m.Event("dataloading",{dataType:"style"})),this._request=m.browser.frame(function(){E._request=null,E._load(c,d.validate!==!1)})},h.prototype.loadEmpty=function(){this.fire(new m.Event("dataloading",{dataType:"style"})),this._load(ou,!1)},h.prototype._load=function(c,d){if(!d||!Lo(this,m.validateStyle(c))){for(var E in this._loaded=!0,this.stylesheet=c,c.sources)this.addSource(E,c.sources[E],{validate:!1});c.sprite?this._loadSprite(c.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(c.glyphs);var w=Zr(this.stylesheet.layers);this._order=w.map(function(q){return q.id}),this._layers={},this._serializedLayers={};for(var P=0,L=w;P<L.length;P+=1){var N=L[P];(N=m.createStyleLayer(N)).setEventedParent(this,{layer:{id:N.id}}),this._layers[N.id]=N,this._serializedLayers[N.id]=N.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new At(this.stylesheet.light),this.fire(new m.Event("data",{dataType:"style"})),this.fire(new m.Event("style.load"))}},h.prototype._loadSprite=function(c){var d=this;this._spriteRequest=function(E,w,P){var L,N,q,ce=m.browser.devicePixelRatio>1?"@2x":"",he=m.getJSON(w.transformRequest(w.normalizeSpriteURL(E,ce,".json"),m.ResourceType.SpriteJSON),function(Ie,We){he=null,q||(q=Ie,L=We,Re())}),de=m.getImage(w.transformRequest(w.normalizeSpriteURL(E,ce,".png"),m.ResourceType.SpriteImage),function(Ie,We){de=null,q||(q=Ie,N=We,Re())});function Re(){if(q)P(q);else if(L&&N){var Ie=m.browser.getImageData(N),We={};for(var we in L){var Ve=L[we],tt=Ve.width,yt=Ve.height,Wt=Ve.x,jt=Ve.y,Jt=Ve.sdf,dr=Ve.pixelRatio,Fr=Ve.stretchX,kr=Ve.stretchY,ln=Ve.content,Nn=new m.RGBAImage({width:tt,height:yt});m.RGBAImage.copy(Ie,Nn,{x:Wt,y:jt},{x:0,y:0},{width:tt,height:yt}),We[we]={data:Nn,pixelRatio:dr,sdf:Jt,stretchX:Fr,stretchY:kr,content:ln}}P(null,We)}}return{cancel:function(){he&&(he.cancel(),he=null),de&&(de.cancel(),de=null)}}}(c,this.map._requestManager,function(E,w){if(d._spriteRequest=null,E)d.fire(new m.ErrorEvent(E));else if(w)for(var P in w)d.imageManager.addImage(P,w[P]);d.imageManager.setLoaded(!0),d._availableImages=d.imageManager.listImages(),d.dispatcher.broadcast("setImages",d._availableImages),d.fire(new m.Event("data",{dataType:"style"}))})},h.prototype._validateLayer=function(c){var d=this.sourceCaches[c.source];if(d){var E=c.sourceLayer;if(E){var w=d.getSource();(w.type==="geojson"||w.vectorLayerIds&&w.vectorLayerIds.indexOf(E)===-1)&&this.fire(new m.ErrorEvent(new Error('Source layer "'+E+'" does not exist on source "'+w.id+'" as specified by style layer "'+c.id+'"')))}}},h.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var c in this.sourceCaches)if(!this.sourceCaches[c].loaded())return!1;return!!this.imageManager.isLoaded()},h.prototype._serializeLayers=function(c){for(var d=[],E=0,w=c;E<w.length;E+=1){var P=this._layers[w[E]];P.type!=="custom"&&d.push(P.serialize())}return d},h.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var c in this.sourceCaches)if(this.sourceCaches[c].hasTransition())return!0;for(var d in this._layers)if(this._layers[d].hasTransition())return!0;return!1},h.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},h.prototype.update=function(c){if(this._loaded){var d=this._changed;if(this._changed){var E=Object.keys(this._updatedLayers),w=Object.keys(this._removedLayers);for(var P in(E.length||w.length)&&this._updateWorkerLayers(E,w),this._updatedSources){var L=this._updatedSources[P];L==="reload"?this._reloadSource(P):L==="clear"&&this._clearSource(P)}for(var N in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[N].updateTransitions(c);this.light.updateTransitions(c),this._resetUpdates()}var q={};for(var ce in this.sourceCaches){var he=this.sourceCaches[ce];q[ce]=he.used,he.used=!1}for(var de=0,Re=this._order;de<Re.length;de+=1){var Ie=this._layers[Re[de]];Ie.recalculate(c,this._availableImages),!Ie.isHidden(c.zoom)&&Ie.source&&(this.sourceCaches[Ie.source].used=!0)}for(var We in q){var we=this.sourceCaches[We];q[We]!==we.used&&we.fire(new m.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:We}))}this.light.recalculate(c),this.z=c.zoom,d&&this.fire(new m.Event("data",{dataType:"style"}))}},h.prototype._updateTilesForChangedImages=function(){var c=Object.keys(this._changedImages);if(c.length){for(var d in this.sourceCaches)this.sourceCaches[d].reloadTilesForDependencies(["icons","patterns"],c);this._changedImages={}}},h.prototype._updateWorkerLayers=function(c,d){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(c),removedIds:d})},h.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},h.prototype.setState=function(c){var d=this;if(this._checkLoaded(),Lo(this,m.validateStyle(c)))return!1;(c=m.clone$1(c)).layers=Zr(c.layers);var E=function(P,L){if(!P)return[{command:Yr.setStyle,args:[L]}];var N=[];try{if(!m.deepEqual(P.version,L.version))return[{command:Yr.setStyle,args:[L]}];m.deepEqual(P.center,L.center)||N.push({command:Yr.setCenter,args:[L.center]}),m.deepEqual(P.zoom,L.zoom)||N.push({command:Yr.setZoom,args:[L.zoom]}),m.deepEqual(P.bearing,L.bearing)||N.push({command:Yr.setBearing,args:[L.bearing]}),m.deepEqual(P.pitch,L.pitch)||N.push({command:Yr.setPitch,args:[L.pitch]}),m.deepEqual(P.sprite,L.sprite)||N.push({command:Yr.setSprite,args:[L.sprite]}),m.deepEqual(P.glyphs,L.glyphs)||N.push({command:Yr.setGlyphs,args:[L.glyphs]}),m.deepEqual(P.transition,L.transition)||N.push({command:Yr.setTransition,args:[L.transition]}),m.deepEqual(P.light,L.light)||N.push({command:Yr.setLight,args:[L.light]});var q={},ce=[];(function(de,Re,Ie,We){var we;for(we in Re=Re||{},de=de||{})de.hasOwnProperty(we)&&(Re.hasOwnProperty(we)||an(we,Ie,We));for(we in Re)Re.hasOwnProperty(we)&&(de.hasOwnProperty(we)?m.deepEqual(de[we],Re[we])||(de[we].type==="geojson"&&Re[we].type==="geojson"&&Xi(de,Re,we)?Ie.push({command:Yr.setGeoJSONSourceData,args:[we,Re[we].data]}):on(we,Re,Ie,We)):_i(we,Re,Ie))})(P.sources,L.sources,ce,q);var he=[];P.layers&&P.layers.forEach(function(de){q[de.source]?N.push({command:Yr.removeLayer,args:[de.id]}):he.push(de)}),N=N.concat(ce),function(de,Re,Ie){Re=Re||[];var We,we,Ve,tt,yt,Wt,jt,Jt=(de=de||[]).map(Pi),dr=Re.map(Pi),Fr=de.reduce(bi,{}),kr=Re.reduce(bi,{}),ln=Jt.slice(),Nn=Object.create(null);for(We=0,we=0;We<Jt.length;We++)kr.hasOwnProperty(Ve=Jt[We])?we++:(Ie.push({command:Yr.removeLayer,args:[Ve]}),ln.splice(ln.indexOf(Ve,we),1));for(We=0,we=0;We<dr.length;We++)ln[ln.length-1-We]!==(Ve=dr[dr.length-1-We])&&(Fr.hasOwnProperty(Ve)?(Ie.push({command:Yr.removeLayer,args:[Ve]}),ln.splice(ln.lastIndexOf(Ve,ln.length-we),1)):we++,Ie.push({command:Yr.addLayer,args:[kr[Ve],Wt=ln[ln.length-We]]}),ln.splice(ln.length-We,0,Ve),Nn[Ve]=!0);for(We=0;We<dr.length;We++)if(tt=Fr[Ve=dr[We]],yt=kr[Ve],!Nn[Ve]&&!m.deepEqual(tt,yt))if(m.deepEqual(tt.source,yt.source)&&m.deepEqual(tt["source-layer"],yt["source-layer"])&&m.deepEqual(tt.type,yt.type)){for(jt in yi(tt.layout,yt.layout,Ie,Ve,null,Yr.setLayoutProperty),yi(tt.paint,yt.paint,Ie,Ve,null,Yr.setPaintProperty),m.deepEqual(tt.filter,yt.filter)||Ie.push({command:Yr.setFilter,args:[Ve,yt.filter]}),m.deepEqual(tt.minzoom,yt.minzoom)&&m.deepEqual(tt.maxzoom,yt.maxzoom)||Ie.push({command:Yr.setLayerZoomRange,args:[Ve,yt.minzoom,yt.maxzoom]}),tt)tt.hasOwnProperty(jt)&&jt!=="layout"&&jt!=="paint"&&jt!=="filter"&&jt!=="metadata"&&jt!=="minzoom"&&jt!=="maxzoom"&&(jt.indexOf("paint.")===0?yi(tt[jt],yt[jt],Ie,Ve,jt.slice(6),Yr.setPaintProperty):m.deepEqual(tt[jt],yt[jt])||Ie.push({command:Yr.setLayerProperty,args:[Ve,jt,yt[jt]]}));for(jt in yt)yt.hasOwnProperty(jt)&&!tt.hasOwnProperty(jt)&&jt!=="layout"&&jt!=="paint"&&jt!=="filter"&&jt!=="metadata"&&jt!=="minzoom"&&jt!=="maxzoom"&&(jt.indexOf("paint.")===0?yi(tt[jt],yt[jt],Ie,Ve,jt.slice(6),Yr.setPaintProperty):m.deepEqual(tt[jt],yt[jt])||Ie.push({command:Yr.setLayerProperty,args:[Ve,jt,yt[jt]]}))}else Ie.push({command:Yr.removeLayer,args:[Ve]}),Wt=ln[ln.lastIndexOf(Ve)+1],Ie.push({command:Yr.addLayer,args:[yt,Wt]})}(he,L.layers,N)}catch(de){console.warn("Unable to compute style diff:",de),N=[{command:Yr.setStyle,args:[L]}]}return N}(this.serialize(),c).filter(function(P){return!(P.command in Qs)});if(E.length===0)return!1;var w=E.filter(function(P){return!(P.command in Vo)});if(w.length>0)throw new Error("Unimplemented: "+w.map(function(P){return P.command}).join(", ")+".");return E.forEach(function(P){P.command!=="setTransition"&&d[P.command].apply(d,P.args)}),this.stylesheet=c,!0},h.prototype.addImage=function(c,d){if(this.getImage(c))return this.fire(new m.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(c,d),this._afterImageUpdated(c)},h.prototype.updateImage=function(c,d){this.imageManager.updateImage(c,d)},h.prototype.getImage=function(c){return this.imageManager.getImage(c)},h.prototype.removeImage=function(c){if(!this.getImage(c))return this.fire(new m.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(c),this._afterImageUpdated(c)},h.prototype._afterImageUpdated=function(c){this._availableImages=this.imageManager.listImages(),this._changedImages[c]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new m.Event("data",{dataType:"style"}))},h.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},h.prototype.addSource=function(c,d,E){var w=this;if(E===void 0&&(E={}),this._checkLoaded(),this.sourceCaches[c]!==void 0)throw new Error("There is already a source with this ID");if(!d.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(d).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(m.validateStyle.source,"sources."+c,d,null,E))){this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);var P=this.sourceCaches[c]=new ke(c,d,this.dispatcher);P.style=this,P.setEventedParent(this,function(){return{isSourceLoaded:w.loaded(),source:P.serialize(),sourceId:c}}),P.onAdd(this.map),this._changed=!0}},h.prototype.removeSource=function(c){if(this._checkLoaded(),this.sourceCaches[c]===void 0)throw new Error("There is no source with this ID");for(var d in this._layers)if(this._layers[d].source===c)return this.fire(new m.ErrorEvent(new Error('Source "'+c+'" cannot be removed while layer "'+d+'" is using it.')));var E=this.sourceCaches[c];delete this.sourceCaches[c],delete this._updatedSources[c],E.fire(new m.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:c})),E.setEventedParent(null),E.clearTiles(),E.onRemove&&E.onRemove(this.map),this._changed=!0},h.prototype.setGeoJSONSourceData=function(c,d){this._checkLoaded(),this.sourceCaches[c].getSource().setData(d),this._changed=!0},h.prototype.getSource=function(c){return this.sourceCaches[c]&&this.sourceCaches[c].getSource()},h.prototype.addLayer=function(c,d,E){E===void 0&&(E={}),this._checkLoaded();var w=c.id;if(this.getLayer(w))this.fire(new m.ErrorEvent(new Error('Layer with id "'+w+'" already exists on this map')));else{var P;if(c.type==="custom"){if(Lo(this,m.validateCustomStyleLayer(c)))return;P=m.createStyleLayer(c)}else{if(typeof c.source=="object"&&(this.addSource(w,c.source),c=m.clone$1(c),c=m.extend(c,{source:w})),this._validate(m.validateStyle.layer,"layers."+w,c,{arrayIndex:-1},E))return;P=m.createStyleLayer(c),this._validateLayer(P),P.setEventedParent(this,{layer:{id:w}}),this._serializedLayers[P.id]=P.serialize()}var L=d?this._order.indexOf(d):this._order.length;if(d&&L===-1)this.fire(new m.ErrorEvent(new Error('Layer with id "'+d+'" does not exist on this map.')));else{if(this._order.splice(L,0,w),this._layerOrderChanged=!0,this._layers[w]=P,this._removedLayers[w]&&P.source&&P.type!=="custom"){var N=this._removedLayers[w];delete this._removedLayers[w],N.type!==P.type?this._updatedSources[P.source]="clear":(this._updatedSources[P.source]="reload",this.sourceCaches[P.source].pause())}this._updateLayer(P),P.onAdd&&P.onAdd(this.map)}}},h.prototype.moveLayer=function(c,d){if(this._checkLoaded(),this._changed=!0,this._layers[c]){if(c!==d){var E=this._order.indexOf(c);this._order.splice(E,1);var w=d?this._order.indexOf(d):this._order.length;d&&w===-1?this.fire(new m.ErrorEvent(new Error('Layer with id "'+d+'" does not exist on this map.'))):(this._order.splice(w,0,c),this._layerOrderChanged=!0)}}else this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be moved.")))},h.prototype.removeLayer=function(c){this._checkLoaded();var d=this._layers[c];if(d){d.setEventedParent(null);var E=this._order.indexOf(c);this._order.splice(E,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[c]=d,delete this._layers[c],delete this._serializedLayers[c],delete this._updatedLayers[c],delete this._updatedPaintProps[c],d.onRemove&&d.onRemove(this.map)}else this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be removed.")))},h.prototype.getLayer=function(c){return this._layers[c]},h.prototype.hasLayer=function(c){return c in this._layers},h.prototype.setLayerZoomRange=function(c,d,E){this._checkLoaded();var w=this.getLayer(c);w?w.minzoom===d&&w.maxzoom===E||(d!=null&&(w.minzoom=d),E!=null&&(w.maxzoom=E),this._updateLayer(w)):this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot have zoom extent.")))},h.prototype.setFilter=function(c,d,E){E===void 0&&(E={}),this._checkLoaded();var w=this.getLayer(c);if(w){if(!m.deepEqual(w.filter,d))return d==null?(w.filter=void 0,void this._updateLayer(w)):void(this._validate(m.validateStyle.filter,"layers."+w.id+".filter",d,null,E)||(w.filter=m.clone$1(d),this._updateLayer(w)))}else this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be filtered.")))},h.prototype.getFilter=function(c){return m.clone$1(this.getLayer(c).filter)},h.prototype.setLayoutProperty=function(c,d,E,w){w===void 0&&(w={}),this._checkLoaded();var P=this.getLayer(c);P?m.deepEqual(P.getLayoutProperty(d),E)||(P.setLayoutProperty(d,E,w),this._updateLayer(P)):this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be styled.")))},h.prototype.getLayoutProperty=function(c,d){var E=this.getLayer(c);if(E)return E.getLayoutProperty(d);this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style.")))},h.prototype.setPaintProperty=function(c,d,E,w){w===void 0&&(w={}),this._checkLoaded();var P=this.getLayer(c);P?m.deepEqual(P.getPaintProperty(d),E)||(P.setPaintProperty(d,E,w)&&this._updateLayer(P),this._changed=!0,this._updatedPaintProps[c]=!0):this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be styled.")))},h.prototype.getPaintProperty=function(c,d){return this.getLayer(c).getPaintProperty(d)},h.prototype.setFeatureState=function(c,d){this._checkLoaded();var E=c.source,w=c.sourceLayer,P=this.sourceCaches[E];if(P!==void 0){var L=P.getSource().type;L==="geojson"&&w?this.fire(new m.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):L!=="vector"||w?(c.id===void 0&&this.fire(new m.ErrorEvent(new Error("The feature id parameter must be provided."))),P.setFeatureState(w,c.id,d)):this.fire(new m.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new m.ErrorEvent(new Error("The source '"+E+"' does not exist in the map's style.")))},h.prototype.removeFeatureState=function(c,d){this._checkLoaded();var E=c.source,w=this.sourceCaches[E];if(w!==void 0){var P=w.getSource().type,L=P==="vector"?c.sourceLayer:void 0;P!=="vector"||L?d&&typeof c.id!="string"&&typeof c.id!="number"?this.fire(new m.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):w.removeFeatureState(L,c.id,d):this.fire(new m.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new m.ErrorEvent(new Error("The source '"+E+"' does not exist in the map's style.")))},h.prototype.getFeatureState=function(c){this._checkLoaded();var d=c.source,E=c.sourceLayer,w=this.sourceCaches[d];if(w!==void 0){if(w.getSource().type!=="vector"||E)return c.id===void 0&&this.fire(new m.ErrorEvent(new Error("The feature id parameter must be provided."))),w.getFeatureState(E,c.id);this.fire(new m.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new m.ErrorEvent(new Error("The source '"+d+"' does not exist in the map's style.")))},h.prototype.getTransition=function(){return m.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},h.prototype.serialize=function(){return m.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:m.mapObject(this.sourceCaches,function(c){return c.serialize()}),layers:this._serializeLayers(this._order)},function(c){return c!==void 0})},h.prototype._updateLayer=function(c){this._updatedLayers[c.id]=!0,c.source&&!this._updatedSources[c.source]&&this.sourceCaches[c.source].getSource().type!=="raster"&&(this._updatedSources[c.source]="reload",this.sourceCaches[c.source].pause()),this._changed=!0},h.prototype._flattenAndSortRenderedFeatures=function(c){for(var d=this,E=function(Fr){return d._layers[Fr].type==="fill-extrusion"},w={},P=[],L=this._order.length-1;L>=0;L--){var N=this._order[L];if(E(N)){w[N]=L;for(var q=0,ce=c;q<ce.length;q+=1){var he=ce[q][N];if(he)for(var de=0,Re=he;de<Re.length;de+=1)P.push(Re[de])}}}P.sort(function(Fr,kr){return kr.intersectionZ-Fr.intersectionZ});for(var Ie=[],We=this._order.length-1;We>=0;We--){var we=this._order[We];if(E(we))for(var Ve=P.length-1;Ve>=0;Ve--){var tt=P[Ve].feature;if(w[tt.layer.id]<We)break;Ie.push(tt),P.pop()}else for(var yt=0,Wt=c;yt<Wt.length;yt+=1){var jt=Wt[yt][we];if(jt)for(var Jt=0,dr=jt;Jt<dr.length;Jt+=1)Ie.push(dr[Jt].feature)}}return Ie},h.prototype.queryRenderedFeatures=function(c,d,E){d&&d.filter&&this._validate(m.validateStyle.filter,"queryRenderedFeatures.filter",d.filter,null,d);var w={};if(d&&d.layers){if(!Array.isArray(d.layers))return this.fire(new m.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var P=0,L=d.layers;P<L.length;P+=1){var N=L[P],q=this._layers[N];if(!q)return this.fire(new m.ErrorEvent(new Error("The layer '"+N+"' does not exist in the map's style and cannot be queried for features."))),[];w[q.source]=!0}}var ce=[];for(var he in d.availableImages=this._availableImages,this.sourceCaches)d.layers&&!w[he]||ce.push(vn(this.sourceCaches[he],this._layers,this._serializedLayers,c,d,E));return this.placement&&ce.push(function(de,Re,Ie,We,we,Ve,tt){for(var yt={},Wt=Ve.queryRenderedSymbols(We),jt=[],Jt=0,dr=Object.keys(Wt).map(Number);Jt<dr.length;Jt+=1)jt.push(tt[dr[Jt]]);jt.sort(di);for(var Fr=function(){var Mn=ln[kr],Bi=Mn.featureIndex.lookupSymbolFeatures(Wt[Mn.bucketInstanceId],Re,Mn.bucketIndex,Mn.sourceLayerIndex,we.filter,we.layers,we.availableImages,de);for(var Qr in Bi){var li=yt[Qr]=yt[Qr]||[],fi=Bi[Qr];fi.sort(function(xi,ri){var Kn=Mn.featureSortOrder;if(Kn){var po=Kn.indexOf(xi.featureIndex);return Kn.indexOf(ri.featureIndex)-po}return ri.featureIndex-xi.featureIndex});for(var ii=0,Xn=fi;ii<Xn.length;ii+=1)li.push(Xn[ii])}},kr=0,ln=jt;kr<ln.length;kr+=1)Fr();var Nn=function(Mn){yt[Mn].forEach(function(Bi){var Qr=Bi.feature,li=Ie[de[Mn].source].getFeatureState(Qr.layer["source-layer"],Qr.id);Qr.source=Qr.layer.source,Qr.layer["source-layer"]&&(Qr.sourceLayer=Qr.layer["source-layer"]),Qr.state=li})};for(var zn in yt)Nn(zn);return yt}(this._layers,this._serializedLayers,this.sourceCaches,c,d,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(ce)},h.prototype.querySourceFeatures=function(c,d){d&&d.filter&&this._validate(m.validateStyle.filter,"querySourceFeatures.filter",d.filter,null,d);var E=this.sourceCaches[c];return E?function(w,P){for(var L=w.getRenderableIds().map(function(Re){return w.getTileByID(Re)}),N=[],q={},ce=0;ce<L.length;ce++){var he=L[ce],de=he.tileID.canonical.key;q[de]||(q[de]=!0,he.querySourceFeatures(N,P))}return N}(E,d):[]},h.prototype.addSourceType=function(c,d,E){return h.getSourceType(c)?E(new Error('A source type called "'+c+'" already exists.')):(h.setSourceType(c,d),d.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:c,url:d.workerSourceURL},E):E(null,null))},h.prototype.getLight=function(){return this.light.getLight()},h.prototype.setLight=function(c,d){d===void 0&&(d={}),this._checkLoaded();var E=this.light.getLight(),w=!1;for(var P in c)if(!m.deepEqual(c[P],E[P])){w=!0;break}if(w){var L={now:m.browser.now(),transition:m.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(c,d),this.light.updateTransitions(L)}},h.prototype._validate=function(c,d,E,w,P){return P===void 0&&(P={}),(!P||P.validate!==!1)&&Lo(this,c.call(m.validateStyle,m.extend({key:d,style:this.serialize(),value:E,styleSpec:m.styleSpec},w)))},h.prototype._remove=function(){for(var c in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),m.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[c].setEventedParent(null);for(var d in this.sourceCaches)this.sourceCaches[d].clearTiles(),this.sourceCaches[d].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},h.prototype._clearSource=function(c){this.sourceCaches[c].clearTiles()},h.prototype._reloadSource=function(c){this.sourceCaches[c].resume(),this.sourceCaches[c].reload()},h.prototype._updateSources=function(c){for(var d in this.sourceCaches)this.sourceCaches[d].update(c)},h.prototype._generateCollisionBoxes=function(){for(var c in this.sourceCaches)this._reloadSource(c)},h.prototype._updatePlacement=function(c,d,E,w,P){P===void 0&&(P=!1);for(var L=!1,N=!1,q={},ce=0,he=this._order;ce<he.length;ce+=1){var de=this._layers[he[ce]];if(de.type==="symbol"){if(!q[de.source]){var Re=this.sourceCaches[de.source];q[de.source]=Re.getRenderableIds(!0).map(function(tt){return Re.getTileByID(tt)}).sort(function(tt,yt){return yt.tileID.overscaledZ-tt.tileID.overscaledZ||(tt.tileID.isLessThan(yt.tileID)?-1:1)})}var Ie=this.crossTileSymbolIndex.addLayer(de,q[de.source],c.center.lng);L=L||Ie}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((P=P||this._layerOrderChanged||E===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(m.browser.now(),c.zoom))&&(this.pauseablePlacement=new La(c,this._order,P,d,E,w,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,q),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(m.browser.now()),N=!0),L&&this.pauseablePlacement.placement.setStale()),N||L)for(var We=0,we=this._order;We<we.length;We+=1){var Ve=this._layers[we[We]];Ve.type==="symbol"&&this.placement.updateLayerOpacities(Ve,q[Ve.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(m.browser.now())},h.prototype._releaseSymbolFadeTiles=function(){for(var c in this.sourceCaches)this.sourceCaches[c].releaseSymbolFadeTiles()},h.prototype.getImages=function(c,d,E){this.imageManager.getImages(d.icons,E),this._updateTilesForChangedImages();var w=this.sourceCaches[d.source];w&&w.setDependencies(d.tileID.key,d.type,d.icons)},h.prototype.getGlyphs=function(c,d,E){this.glyphManager.getGlyphs(d.stacks,E)},h.prototype.getResource=function(c,d,E){return m.makeRequest(d,E)},h}(m.Evented);ds.getSourceType=function(l){return Cr[l]},ds.setSourceType=function(l,h){Cr[l]=h},ds.registerForPluginStateChange=m.registerForPluginStateChange;var ga=m.createLayout([{name:"a_pos",type:"Int16",components:2}]),ko=Gi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),Il=Gi(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),vs=Gi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),es=Gi(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),of=Gi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),rc=Gi(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),Cs=Gi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),bu=Gi("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),cl=Gi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),_=Gi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),M=Gi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),F=Gi(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),R=Gi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),K=Gi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),_e=Gi(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),je=Gi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),pt=Gi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),dt=Gi(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),ur=Gi(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),yr=Gi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),In=Gi(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),Bn=Gi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),Qn=Gi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),Vi=Gi(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),Li=Gi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),ba=Gi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function Gi(l,h){var c=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,d=h.match(/attribute ([\w]+) ([\w]+)/g),E=l.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),w=h.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),P=w?w.concat(E):E,L={};return{fragmentSource:l=l.replace(c,function(N,q,ce,he,de){return L[de]=!0,q==="define"?`
#ifndef HAS_UNIFORM_u_`+de+`
varying `+ce+" "+he+" "+de+`;
#else
uniform `+ce+" "+he+" u_"+de+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+de+`
    `+ce+" "+he+" "+de+" = u_"+de+`;
#endif
`}),vertexSource:h=h.replace(c,function(N,q,ce,he,de){var Re=he==="float"?"vec2":"vec4",Ie=de.match(/color/)?"color":Re;return L[de]?q==="define"?`
#ifndef HAS_UNIFORM_u_`+de+`
uniform lowp float u_`+de+`_t;
attribute `+ce+" "+Re+" a_"+de+`;
varying `+ce+" "+he+" "+de+`;
#else
uniform `+ce+" "+he+" u_"+de+`;
#endif
`:Ie==="vec4"?`
#ifndef HAS_UNIFORM_u_`+de+`
    `+de+" = a_"+de+`;
#else
    `+ce+" "+he+" "+de+" = u_"+de+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+de+`
    `+de+" = unpack_mix_"+Ie+"(a_"+de+", u_"+de+`_t);
#else
    `+ce+" "+he+" "+de+" = u_"+de+`;
#endif
`:q==="define"?`
#ifndef HAS_UNIFORM_u_`+de+`
uniform lowp float u_`+de+`_t;
attribute `+ce+" "+Re+" a_"+de+`;
#else
uniform `+ce+" "+he+" u_"+de+`;
#endif
`:Ie==="vec4"?`
#ifndef HAS_UNIFORM_u_`+de+`
    `+ce+" "+he+" "+de+" = a_"+de+`;
#else
    `+ce+" "+he+" "+de+" = u_"+de+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+de+`
    `+ce+" "+he+" "+de+" = unpack_mix_"+Ie+"(a_"+de+", u_"+de+`_t);
#else
    `+ce+" "+he+" "+de+" = u_"+de+`;
#endif
`}),staticAttributes:d,staticUniforms:P}}var As=Object.freeze({__proto__:null,prelude:ko,background:Il,backgroundPattern:vs,circle:es,clippingMask:of,heatmap:rc,heatmapTexture:Cs,collisionBox:bu,collisionCircle:cl,debug:_,fill:M,fillOutline:F,fillOutlinePattern:R,fillPattern:K,fillExtrusion:_e,fillExtrusionPattern:je,hillshadePrepare:pt,hillshade:dt,line:ur,lineGradient:yr,linePattern:In,lineSDF:Bn,raster:Qn,symbolIcon:Vi,symbolSDF:Li,symbolTextAndIcon:ba}),Eu=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function fl(l){for(var h=[],c=0;c<l.length;c++)if(l[c]!==null){var d=l[c].split(" ");h.push(d.pop())}return h}Eu.prototype.bind=function(l,h,c,d,E,w,P,L){this.context=l;for(var N=this.boundPaintVertexBuffers.length!==d.length,q=0;!N&&q<d.length;q++)this.boundPaintVertexBuffers[q]!==d[q]&&(N=!0);l.extVertexArrayObject&&this.vao&&this.boundProgram===h&&this.boundLayoutVertexBuffer===c&&!N&&this.boundIndexBuffer===E&&this.boundVertexOffset===w&&this.boundDynamicVertexBuffer===P&&this.boundDynamicVertexBuffer2===L?(l.bindVertexArrayOES.set(this.vao),P&&P.bind(),E&&E.dynamicDraw&&E.bind(),L&&L.bind()):this.freshBind(h,c,d,E,w,P,L)},Eu.prototype.freshBind=function(l,h,c,d,E,w,P){var L,N=l.numAttributes,q=this.context,ce=q.gl;if(q.extVertexArrayObject)this.vao&&this.destroy(),this.vao=q.extVertexArrayObject.createVertexArrayOES(),q.bindVertexArrayOES.set(this.vao),L=0,this.boundProgram=l,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=c,this.boundIndexBuffer=d,this.boundVertexOffset=E,this.boundDynamicVertexBuffer=w,this.boundDynamicVertexBuffer2=P;else{L=q.currentNumAttributes||0;for(var he=N;he<L;he++)ce.disableVertexAttribArray(he)}h.enableAttributes(ce,l);for(var de=0,Re=c;de<Re.length;de+=1)Re[de].enableAttributes(ce,l);w&&w.enableAttributes(ce,l),P&&P.enableAttributes(ce,l),h.bind(),h.setVertexAttribPointers(ce,l,E);for(var Ie=0,We=c;Ie<We.length;Ie+=1){var we=We[Ie];we.bind(),we.setVertexAttribPointers(ce,l,E)}w&&(w.bind(),w.setVertexAttribPointers(ce,l,E)),d&&d.bind(),P&&(P.bind(),P.setVertexAttribPointers(ce,l,E)),q.currentNumAttributes=N},Eu.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var Rc=function(l,h,c,d,E,w){var P=l.gl;this.program=P.createProgram();for(var L=fl(c.staticAttributes),N=d?d.getBinderAttributes():[],q=L.concat(N),ce=c.staticUniforms?fl(c.staticUniforms):[],he=d?d.getBinderUniforms():[],de=[],Re=0,Ie=ce.concat(he);Re<Ie.length;Re+=1){var We=Ie[Re];de.indexOf(We)<0&&de.push(We)}var we=d?d.defines():[];w&&we.push("#define OVERDRAW_INSPECTOR;");var Ve=we.concat(ko.fragmentSource,c.fragmentSource).join(`
`),tt=we.concat(ko.vertexSource,c.vertexSource).join(`
`),yt=P.createShader(P.FRAGMENT_SHADER);if(P.isContextLost())this.failedToCreate=!0;else{P.shaderSource(yt,Ve),P.compileShader(yt),P.attachShader(this.program,yt);var Wt=P.createShader(P.VERTEX_SHADER);if(P.isContextLost())this.failedToCreate=!0;else{P.shaderSource(Wt,tt),P.compileShader(Wt),P.attachShader(this.program,Wt),this.attributes={};var jt={};this.numAttributes=q.length;for(var Jt=0;Jt<this.numAttributes;Jt++)q[Jt]&&(P.bindAttribLocation(this.program,Jt,q[Jt]),this.attributes[q[Jt]]=Jt);P.linkProgram(this.program),P.deleteShader(Wt),P.deleteShader(yt);for(var dr=0;dr<de.length;dr++){var Fr=de[dr];if(Fr&&!jt[Fr]){var kr=P.getUniformLocation(this.program,Fr);kr&&(jt[Fr]=kr)}}this.fixedUniforms=E(l,jt),this.binderUniforms=d?d.getUniforms(l,jt):[]}}};function tl(l,h,c){var d=1/Qi(c,1,h.transform.tileZoom),E=Math.pow(2,c.tileID.overscaledZ),w=c.tileSize*Math.pow(2,h.transform.tileZoom)/E,P=w*(c.tileID.canonical.x+c.tileID.wrap*E),L=w*c.tileID.canonical.y;return{u_image:0,u_texsize:c.imageAtlasTexture.size,u_scale:[d,l.fromScale,l.toScale],u_fade:l.t,u_pixel_coord_upper:[P>>16,L>>16],u_pixel_coord_lower:[65535&P,65535&L]}}Rc.prototype.draw=function(l,h,c,d,E,w,P,L,N,q,ce,he,de,Re,Ie,We){var we,Ve=l.gl;if(!this.failedToCreate){for(var tt in l.program.set(this.program),l.setDepthMode(c),l.setStencilMode(d),l.setColorMode(E),l.setCullFace(w),this.fixedUniforms)this.fixedUniforms[tt].set(P[tt]);Re&&Re.setUniforms(l,this.binderUniforms,he,{zoom:de});for(var yt=(we={},we[Ve.LINES]=2,we[Ve.TRIANGLES]=3,we[Ve.LINE_STRIP]=1,we)[h],Wt=0,jt=ce.get();Wt<jt.length;Wt+=1){var Jt=jt[Wt],dr=Jt.vaos||(Jt.vaos={});(dr[L]||(dr[L]=new Eu)).bind(l,this,N,Re?Re.getPaintVertexBuffers():[],q,Jt.vertexOffset,Ie,We),Ve.drawElements(h,Jt.primitiveLength*yt,Ve.UNSIGNED_SHORT,Jt.primitiveOffset*yt*2)}}};var Lc=function(l,h,c,d){var E=h.style.light,w=E.properties.get("position"),P=[w.x,w.y,w.z],L=m.create$1();E.properties.get("anchor")==="viewport"&&m.fromRotation(L,-h.transform.angle),m.transformMat3(P,P,L);var N=E.properties.get("color");return{u_matrix:l,u_lightpos:P,u_lightintensity:E.properties.get("intensity"),u_lightcolor:[N.r,N.g,N.b],u_vertical_gradient:+c,u_opacity:d}},Bu=function(l,h,c,d,E,w,P){return m.extend(Lc(l,h,c,d),tl(w,h,P),{u_height_factor:-Math.pow(2,E.overscaledZ)/P.tileSize/8})},Nu=function(l){return{u_matrix:l}},zu=function(l,h,c,d){return m.extend(Nu(l),tl(c,h,d))},uo=function(l,h){return{u_matrix:l,u_world:h}},Bf=function(l,h,c,d,E){return m.extend(zu(l,h,c,d),{u_world:E})},Nf=function(l,h,c,d){var E,w,P=l.transform;if(d.paint.get("circle-pitch-alignment")==="map"){var L=Qi(c,1,P.zoom);E=!0,w=[L,L]}else E=!1,w=P.pixelsToGLUnits;return{u_camera_to_center_distance:P.cameraToCenterDistance,u_scale_with_map:+(d.paint.get("circle-pitch-scale")==="map"),u_matrix:l.translatePosMatrix(h.posMatrix,c,d.paint.get("circle-translate"),d.paint.get("circle-translate-anchor")),u_pitch_with_map:+E,u_device_pixel_ratio:m.browser.devicePixelRatio,u_extrude_scale:w}},ws=function(l,h,c){var d=Qi(c,1,h.zoom),E=Math.pow(2,h.zoom-c.tileID.overscaledZ),w=c.tileID.overscaleFactor();return{u_matrix:l,u_camera_to_center_distance:h.cameraToCenterDistance,u_pixels_to_tile_units:d,u_extrude_scale:[h.pixelsToGLUnits[0]/(d*E),h.pixelsToGLUnits[1]/(d*E)],u_overscale_factor:w}},sf=function(l,h,c){return{u_matrix:l,u_inv_matrix:h,u_camera_to_center_distance:c.cameraToCenterDistance,u_viewport_size:[c.width,c.height]}},su=function(l,h,c){return c===void 0&&(c=1),{u_matrix:l,u_color:h,u_overlay:0,u_overlay_scale:c}},Hs=function(l){return{u_matrix:l}},uf=function(l,h,c,d){return{u_matrix:l,u_extrude_scale:Qi(h,1,c),u_intensity:d}},Ol=function(l,h,c){var d=l.transform;return{u_matrix:zf(l,h,c),u_ratio:1/Qi(h,1,d.zoom),u_device_pixel_ratio:m.browser.devicePixelRatio,u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]]}},ya=function(l,h,c,d){return m.extend(Ol(l,h,c),{u_image:0,u_image_height:d})},nc=function(l,h,c,d){var E=l.transform,w=hl(h,E);return{u_matrix:zf(l,h,c),u_texsize:h.imageAtlasTexture.size,u_ratio:1/Qi(h,1,E.zoom),u_device_pixel_ratio:m.browser.devicePixelRatio,u_image:0,u_scale:[w,d.fromScale,d.toScale],u_fade:d.t,u_units_to_pixels:[1/E.pixelsToGLUnits[0],1/E.pixelsToGLUnits[1]]}},Js=function(l,h,c,d,E){var w=l.lineAtlas,P=hl(h,l.transform),L=c.layout.get("line-cap")==="round",N=w.getDash(d.from,L),q=w.getDash(d.to,L),ce=N.width*E.fromScale,he=q.width*E.toScale;return m.extend(Ol(l,h,c),{u_patternscale_a:[P/ce,-N.height/2],u_patternscale_b:[P/he,-q.height/2],u_sdfgamma:w.width/(256*Math.min(ce,he)*m.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:N.y,u_tex_y_b:q.y,u_mix:E.t})};function hl(l,h){return 1/Qi(l,1,h.tileZoom)}function zf(l,h,c){return l.translatePosMatrix(h.tileID.posMatrix,h,c.paint.get("line-translate"),c.paint.get("line-translate-anchor"))}var ep=function(l,h,c,d,E){return{u_matrix:l,u_tl_parent:h,u_scale_parent:c,u_buffer_scale:1,u_fade_t:d.mix,u_opacity:d.opacity*E.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:E.paint.get("raster-brightness-min"),u_brightness_high:E.paint.get("raster-brightness-max"),u_saturation_factor:(P=E.paint.get("raster-saturation"),P>0?1-1/(1.001-P):-P),u_contrast_factor:(w=E.paint.get("raster-contrast"),w>0?1/(1-w):1+w),u_spin_weights:lf(E.paint.get("raster-hue-rotate"))};var w,P};function lf(l){l*=Math.PI/180;var h=Math.sin(l),c=Math.cos(l);return[(2*c+1)/3,(-Math.sqrt(3)*h-c+1)/3,(Math.sqrt(3)*h-c+1)/3]}var ic,ac=function(l,h,c,d,E,w,P,L,N,q){var ce=E.transform;return{u_is_size_zoom_constant:+(l==="constant"||l==="source"),u_is_size_feature_constant:+(l==="constant"||l==="camera"),u_size_t:h?h.uSizeT:0,u_size:h?h.uSize:0,u_camera_to_center_distance:ce.cameraToCenterDistance,u_pitch:ce.pitch/360*2*Math.PI,u_rotate_symbol:+c,u_aspect_ratio:ce.width/ce.height,u_fade_change:E.options.fadeDuration?E.symbolFadeChange:1,u_matrix:w,u_label_plane_matrix:P,u_coord_matrix:L,u_is_text:+N,u_pitch_with_map:+d,u_texsize:q,u_texture:0}},oc=function(l,h,c,d,E,w,P,L,N,q,ce){var he=E.transform;return m.extend(ac(l,h,c,d,E,w,P,L,N,q),{u_gamma_scale:d?Math.cos(he._pitch)*he.cameraToCenterDistance:1,u_device_pixel_ratio:m.browser.devicePixelRatio,u_is_halo:+ce})},sc=function(l,h,c,d,E,w,P,L,N,q){return m.extend(oc(l,h,c,d,E,w,P,L,!0,N,!0),{u_texsize_icon:q,u_texture_icon:1})},uc=function(l,h,c){return{u_matrix:l,u_opacity:h,u_color:c}},Rl=function(l,h,c,d,E,w){return m.extend(function(P,L,N,q){var ce=N.imageManager.getPattern(P.from.toString()),he=N.imageManager.getPattern(P.to.toString()),de=N.imageManager.getPixelSize(),Re=de.width,Ie=de.height,We=Math.pow(2,q.tileID.overscaledZ),we=q.tileSize*Math.pow(2,N.transform.tileZoom)/We,Ve=we*(q.tileID.canonical.x+q.tileID.wrap*We),tt=we*q.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:ce.tl,u_pattern_br_a:ce.br,u_pattern_tl_b:he.tl,u_pattern_br_b:he.br,u_texsize:[Re,Ie],u_mix:L.t,u_pattern_size_a:ce.displaySize,u_pattern_size_b:he.displaySize,u_scale_a:L.fromScale,u_scale_b:L.toScale,u_tile_units_to_pixels:1/Qi(q,1,N.transform.tileZoom),u_pixel_coord_upper:[Ve>>16,tt>>16],u_pixel_coord_lower:[65535&Ve,65535&tt]}}(d,w,c,E),{u_matrix:l,u_opacity:h})},Ll={fillExtrusion:function(l,h){return{u_matrix:new m.UniformMatrix4f(l,h.u_matrix),u_lightpos:new m.Uniform3f(l,h.u_lightpos),u_lightintensity:new m.Uniform1f(l,h.u_lightintensity),u_lightcolor:new m.Uniform3f(l,h.u_lightcolor),u_vertical_gradient:new m.Uniform1f(l,h.u_vertical_gradient),u_opacity:new m.Uniform1f(l,h.u_opacity)}},fillExtrusionPattern:function(l,h){return{u_matrix:new m.UniformMatrix4f(l,h.u_matrix),u_lightpos:new m.Uniform3f(l,h.u_lightpos),u_lightintensity:new m.Uniform1f(l,h.u_lightintensity),u_lightcolor:new m.Uniform3f(l,h.u_lightcolor),u_vertical_gradient:new m.Uniform1f(l,h.u_vertical_gradient),u_height_factor:new m.Uniform1f(l,h.u_height_factor),u_image:new m.Uniform1i(l,h.u_image),u_texsize:new m.Uniform2f(l,h.u_texsize),u_pixel_coord_upper:new m.Uniform2f(l,h.u_pixel_coord_upper),u_pixel_coord_lower:new m.Uniform2f(l,h.u_pixel_coord_lower),u_scale:new m.Uniform3f(l,h.u_scale),u_fade:new m.Uniform1f(l,h.u_fade),u_opacity:new m.Uniform1f(l,h.u_opacity)}},fill:function(l,h){return{u_matrix:new m.UniformMatrix4f(l,h.u_matrix)}},fillPattern:function(l,h){return{u_matrix:new m.UniformMatrix4f(l,h.u_matrix),u_image:new m.Uniform1i(l,h.u_image),u_texsize:new m.Uniform2f(l,h.u_texsize),u_pixel_coord_upper:new m.Uniform2f(l,h.u_pixel_coord_upper),u_pixel_coord_lower:new m.Uniform2f(l,h.u_pixel_coord_lower),u_scale:new m.Uniform3f(l,h.u_scale),u_fade:new m.Uniform1f(l,h.u_fade)}},fillOutline:function(l,h){return{u_matrix:new m.UniformMatrix4f(l,h.u_matrix),u_world:new m.Uniform2f(l,h.u_world)}},fillOutlinePattern:function(l,h){return{u_matrix:new m.UniformMatrix4f(l,h.u_matrix),u_world:new m.Uniform2f(l,h.u_world),u_image:new m.Uniform1i(l,h.u_image),u_texsize:new m.Uniform2f(l,h.u_texsize),u_pixel_coord_upper:new m.Uniform2f(l,h.u_pixel_coord_upper),u_pixel_coord_lower:new m.Uniform2f(l,h.u_pixel_coord_lower),u_scale:new m.Uniform3f(l,h.u_scale),u_fade:new m.Uniform1f(l,h.u_fade)}},circle:function(l,h){return{u_camera_to_center_distance:new m.Uniform1f(l,h.u_camera_to_center_distance),u_scale_with_map:new m.Uniform1i(l,h.u_scale_with_map),u_pitch_with_map:new m.Uniform1i(l,h.u_pitch_with_map),u_extrude_scale:new m.Uniform2f(l,h.u_extrude_scale),u_device_pixel_ratio:new m.Uniform1f(l,h.u_device_pixel_ratio),u_matrix:new m.UniformMatrix4f(l,h.u_matrix)}},collisionBox:function(l,h){return{u_matrix:new m.UniformMatrix4f(l,h.u_matrix),u_camera_to_center_distance:new m.Uniform1f(l,h.u_camera_to_center_distance),u_pixels_to_tile_units:new m.Uniform1f(l,h.u_pixels_to_tile_units),u_extrude_scale:new m.Uniform2f(l,h.u_extrude_scale),u_overscale_factor:new m.Uniform1f(l,h.u_overscale_factor)}},collisionCircle:function(l,h){return{u_matrix:new m.UniformMatrix4f(l,h.u_matrix),u_inv_matrix:new m.UniformMatrix4f(l,h.u_inv_matrix),u_camera_to_center_distance:new m.Uniform1f(l,h.u_camera_to_center_distance),u_viewport_size:new m.Uniform2f(l,h.u_viewport_size)}},debug:function(l,h){return{u_color:new m.UniformColor(l,h.u_color),u_matrix:new m.UniformMatrix4f(l,h.u_matrix),u_overlay:new m.Uniform1i(l,h.u_overlay),u_overlay_scale:new m.Uniform1f(l,h.u_overlay_scale)}},clippingMask:function(l,h){return{u_matrix:new m.UniformMatrix4f(l,h.u_matrix)}},heatmap:function(l,h){return{u_extrude_scale:new m.Uniform1f(l,h.u_extrude_scale),u_intensity:new m.Uniform1f(l,h.u_intensity),u_matrix:new m.UniformMatrix4f(l,h.u_matrix)}},heatmapTexture:function(l,h){return{u_matrix:new m.UniformMatrix4f(l,h.u_matrix),u_world:new m.Uniform2f(l,h.u_world),u_image:new m.Uniform1i(l,h.u_image),u_color_ramp:new m.Uniform1i(l,h.u_color_ramp),u_opacity:new m.Uniform1f(l,h.u_opacity)}},hillshade:function(l,h){return{u_matrix:new m.UniformMatrix4f(l,h.u_matrix),u_image:new m.Uniform1i(l,h.u_image),u_latrange:new m.Uniform2f(l,h.u_latrange),u_light:new m.Uniform2f(l,h.u_light),u_shadow:new m.UniformColor(l,h.u_shadow),u_highlight:new m.UniformColor(l,h.u_highlight),u_accent:new m.UniformColor(l,h.u_accent)}},hillshadePrepare:function(l,h){return{u_matrix:new m.UniformMatrix4f(l,h.u_matrix),u_image:new m.Uniform1i(l,h.u_image),u_dimension:new m.Uniform2f(l,h.u_dimension),u_zoom:new m.Uniform1f(l,h.u_zoom),u_unpack:new m.Uniform4f(l,h.u_unpack)}},line:function(l,h){return{u_matrix:new m.UniformMatrix4f(l,h.u_matrix),u_ratio:new m.Uniform1f(l,h.u_ratio),u_device_pixel_ratio:new m.Uniform1f(l,h.u_device_pixel_ratio),u_units_to_pixels:new m.Uniform2f(l,h.u_units_to_pixels)}},lineGradient:function(l,h){return{u_matrix:new m.UniformMatrix4f(l,h.u_matrix),u_ratio:new m.Uniform1f(l,h.u_ratio),u_device_pixel_ratio:new m.Uniform1f(l,h.u_device_pixel_ratio),u_units_to_pixels:new m.Uniform2f(l,h.u_units_to_pixels),u_image:new m.Uniform1i(l,h.u_image),u_image_height:new m.Uniform1f(l,h.u_image_height)}},linePattern:function(l,h){return{u_matrix:new m.UniformMatrix4f(l,h.u_matrix),u_texsize:new m.Uniform2f(l,h.u_texsize),u_ratio:new m.Uniform1f(l,h.u_ratio),u_device_pixel_ratio:new m.Uniform1f(l,h.u_device_pixel_ratio),u_image:new m.Uniform1i(l,h.u_image),u_units_to_pixels:new m.Uniform2f(l,h.u_units_to_pixels),u_scale:new m.Uniform3f(l,h.u_scale),u_fade:new m.Uniform1f(l,h.u_fade)}},lineSDF:function(l,h){return{u_matrix:new m.UniformMatrix4f(l,h.u_matrix),u_ratio:new m.Uniform1f(l,h.u_ratio),u_device_pixel_ratio:new m.Uniform1f(l,h.u_device_pixel_ratio),u_units_to_pixels:new m.Uniform2f(l,h.u_units_to_pixels),u_patternscale_a:new m.Uniform2f(l,h.u_patternscale_a),u_patternscale_b:new m.Uniform2f(l,h.u_patternscale_b),u_sdfgamma:new m.Uniform1f(l,h.u_sdfgamma),u_image:new m.Uniform1i(l,h.u_image),u_tex_y_a:new m.Uniform1f(l,h.u_tex_y_a),u_tex_y_b:new m.Uniform1f(l,h.u_tex_y_b),u_mix:new m.Uniform1f(l,h.u_mix)}},raster:function(l,h){return{u_matrix:new m.UniformMatrix4f(l,h.u_matrix),u_tl_parent:new m.Uniform2f(l,h.u_tl_parent),u_scale_parent:new m.Uniform1f(l,h.u_scale_parent),u_buffer_scale:new m.Uniform1f(l,h.u_buffer_scale),u_fade_t:new m.Uniform1f(l,h.u_fade_t),u_opacity:new m.Uniform1f(l,h.u_opacity),u_image0:new m.Uniform1i(l,h.u_image0),u_image1:new m.Uniform1i(l,h.u_image1),u_brightness_low:new m.Uniform1f(l,h.u_brightness_low),u_brightness_high:new m.Uniform1f(l,h.u_brightness_high),u_saturation_factor:new m.Uniform1f(l,h.u_saturation_factor),u_contrast_factor:new m.Uniform1f(l,h.u_contrast_factor),u_spin_weights:new m.Uniform3f(l,h.u_spin_weights)}},symbolIcon:function(l,h){return{u_is_size_zoom_constant:new m.Uniform1i(l,h.u_is_size_zoom_constant),u_is_size_feature_constant:new m.Uniform1i(l,h.u_is_size_feature_constant),u_size_t:new m.Uniform1f(l,h.u_size_t),u_size:new m.Uniform1f(l,h.u_size),u_camera_to_center_distance:new m.Uniform1f(l,h.u_camera_to_center_distance),u_pitch:new m.Uniform1f(l,h.u_pitch),u_rotate_symbol:new m.Uniform1i(l,h.u_rotate_symbol),u_aspect_ratio:new m.Uniform1f(l,h.u_aspect_ratio),u_fade_change:new m.Uniform1f(l,h.u_fade_change),u_matrix:new m.UniformMatrix4f(l,h.u_matrix),u_label_plane_matrix:new m.UniformMatrix4f(l,h.u_label_plane_matrix),u_coord_matrix:new m.UniformMatrix4f(l,h.u_coord_matrix),u_is_text:new m.Uniform1i(l,h.u_is_text),u_pitch_with_map:new m.Uniform1i(l,h.u_pitch_with_map),u_texsize:new m.Uniform2f(l,h.u_texsize),u_texture:new m.Uniform1i(l,h.u_texture)}},symbolSDF:function(l,h){return{u_is_size_zoom_constant:new m.Uniform1i(l,h.u_is_size_zoom_constant),u_is_size_feature_constant:new m.Uniform1i(l,h.u_is_size_feature_constant),u_size_t:new m.Uniform1f(l,h.u_size_t),u_size:new m.Uniform1f(l,h.u_size),u_camera_to_center_distance:new m.Uniform1f(l,h.u_camera_to_center_distance),u_pitch:new m.Uniform1f(l,h.u_pitch),u_rotate_symbol:new m.Uniform1i(l,h.u_rotate_symbol),u_aspect_ratio:new m.Uniform1f(l,h.u_aspect_ratio),u_fade_change:new m.Uniform1f(l,h.u_fade_change),u_matrix:new m.UniformMatrix4f(l,h.u_matrix),u_label_plane_matrix:new m.UniformMatrix4f(l,h.u_label_plane_matrix),u_coord_matrix:new m.UniformMatrix4f(l,h.u_coord_matrix),u_is_text:new m.Uniform1i(l,h.u_is_text),u_pitch_with_map:new m.Uniform1i(l,h.u_pitch_with_map),u_texsize:new m.Uniform2f(l,h.u_texsize),u_texture:new m.Uniform1i(l,h.u_texture),u_gamma_scale:new m.Uniform1f(l,h.u_gamma_scale),u_device_pixel_ratio:new m.Uniform1f(l,h.u_device_pixel_ratio),u_is_halo:new m.Uniform1i(l,h.u_is_halo)}},symbolTextAndIcon:function(l,h){return{u_is_size_zoom_constant:new m.Uniform1i(l,h.u_is_size_zoom_constant),u_is_size_feature_constant:new m.Uniform1i(l,h.u_is_size_feature_constant),u_size_t:new m.Uniform1f(l,h.u_size_t),u_size:new m.Uniform1f(l,h.u_size),u_camera_to_center_distance:new m.Uniform1f(l,h.u_camera_to_center_distance),u_pitch:new m.Uniform1f(l,h.u_pitch),u_rotate_symbol:new m.Uniform1i(l,h.u_rotate_symbol),u_aspect_ratio:new m.Uniform1f(l,h.u_aspect_ratio),u_fade_change:new m.Uniform1f(l,h.u_fade_change),u_matrix:new m.UniformMatrix4f(l,h.u_matrix),u_label_plane_matrix:new m.UniformMatrix4f(l,h.u_label_plane_matrix),u_coord_matrix:new m.UniformMatrix4f(l,h.u_coord_matrix),u_is_text:new m.Uniform1i(l,h.u_is_text),u_pitch_with_map:new m.Uniform1i(l,h.u_pitch_with_map),u_texsize:new m.Uniform2f(l,h.u_texsize),u_texsize_icon:new m.Uniform2f(l,h.u_texsize_icon),u_texture:new m.Uniform1i(l,h.u_texture),u_texture_icon:new m.Uniform1i(l,h.u_texture_icon),u_gamma_scale:new m.Uniform1f(l,h.u_gamma_scale),u_device_pixel_ratio:new m.Uniform1f(l,h.u_device_pixel_ratio),u_is_halo:new m.Uniform1i(l,h.u_is_halo)}},background:function(l,h){return{u_matrix:new m.UniformMatrix4f(l,h.u_matrix),u_opacity:new m.Uniform1f(l,h.u_opacity),u_color:new m.UniformColor(l,h.u_color)}},backgroundPattern:function(l,h){return{u_matrix:new m.UniformMatrix4f(l,h.u_matrix),u_opacity:new m.Uniform1f(l,h.u_opacity),u_image:new m.Uniform1i(l,h.u_image),u_pattern_tl_a:new m.Uniform2f(l,h.u_pattern_tl_a),u_pattern_br_a:new m.Uniform2f(l,h.u_pattern_br_a),u_pattern_tl_b:new m.Uniform2f(l,h.u_pattern_tl_b),u_pattern_br_b:new m.Uniform2f(l,h.u_pattern_br_b),u_texsize:new m.Uniform2f(l,h.u_texsize),u_mix:new m.Uniform1f(l,h.u_mix),u_pattern_size_a:new m.Uniform2f(l,h.u_pattern_size_a),u_pattern_size_b:new m.Uniform2f(l,h.u_pattern_size_b),u_scale_a:new m.Uniform1f(l,h.u_scale_a),u_scale_b:new m.Uniform1f(l,h.u_scale_b),u_pixel_coord_upper:new m.Uniform2f(l,h.u_pixel_coord_upper),u_pixel_coord_lower:new m.Uniform2f(l,h.u_pixel_coord_lower),u_tile_units_to_pixels:new m.Uniform1f(l,h.u_tile_units_to_pixels)}}};function pl(l,h,c,d,E,w,P){for(var L=l.context,N=L.gl,q=l.useProgram("collisionBox"),ce=[],he=0,de=0,Re=0;Re<d.length;Re++){var Ie=d[Re],We=h.getTile(Ie),we=We.getBucket(c);if(we){var Ve=Ie.posMatrix;E[0]===0&&E[1]===0||(Ve=l.translatePosMatrix(Ie.posMatrix,We,E,w));var tt=P?we.textCollisionBox:we.iconCollisionBox,yt=we.collisionCircleArray;if(yt.length>0){var Wt=m.create(),jt=Ve;m.mul(Wt,we.placementInvProjMatrix,l.transform.glCoordMatrix),m.mul(Wt,Wt,we.placementViewportMatrix),ce.push({circleArray:yt,circleOffset:de,transform:jt,invTransform:Wt}),de=he+=yt.length/4}tt&&q.draw(L,N.LINES,ye.disabled,Pe.disabled,l.colorModeForRenderPass(),rt.disabled,ws(Ve,l.transform,We),c.id,tt.layoutVertexBuffer,tt.indexBuffer,tt.segments,null,l.transform.zoom,null,null,tt.collisionVertexBuffer)}}if(P&&ce.length){var Jt=l.useProgram("collisionCircle"),dr=new m.StructArrayLayout2f1f2i16;dr.resize(4*he),dr._trim();for(var Fr=0,kr=0,ln=ce;kr<ln.length;kr+=1)for(var Nn=ln[kr],zn=0;zn<Nn.circleArray.length/4;zn++){var Mn=4*zn,Bi=Nn.circleArray[Mn+0],Qr=Nn.circleArray[Mn+1],li=Nn.circleArray[Mn+2],fi=Nn.circleArray[Mn+3];dr.emplace(Fr++,Bi,Qr,li,fi,0),dr.emplace(Fr++,Bi,Qr,li,fi,1),dr.emplace(Fr++,Bi,Qr,li,fi,2),dr.emplace(Fr++,Bi,Qr,li,fi,3)}(!ic||ic.length<2*he)&&(ic=function(Ka){var Ho=2*Ka,Bo=new m.StructArrayLayout3ui6;Bo.resize(Ho),Bo._trim();for(var za=0;za<Ho;za++){var co=6*za;Bo.uint16[co+0]=4*za+0,Bo.uint16[co+1]=4*za+1,Bo.uint16[co+2]=4*za+2,Bo.uint16[co+3]=4*za+2,Bo.uint16[co+4]=4*za+3,Bo.uint16[co+5]=4*za+0}return Bo}(he));for(var ii=L.createIndexBuffer(ic,!0),Xn=L.createVertexBuffer(dr,m.collisionCircleLayout.members,!0),xi=0,ri=ce;xi<ri.length;xi+=1){var Kn=ri[xi],po=sf(Kn.transform,Kn.invTransform,l.transform);Jt.draw(L,N.TRIANGLES,ye.disabled,Pe.disabled,l.colorModeForRenderPass(),rt.disabled,po,c.id,Xn,ii,m.SegmentVector.simpleSegment(0,2*Kn.circleOffset,Kn.circleArray.length,Kn.circleArray.length/2),null,l.transform.zoom,null,null,null)}Xn.destroy(),ii.destroy()}}var eu=m.identity(new Float32Array(16));function kc(l,h,c,d,E,w){var P=m.getAnchorAlignment(l),L=-(P.horizontalAlign-.5)*h,N=-(P.verticalAlign-.5)*c,q=m.evaluateVariableOffset(l,d);return new m.Point((L/E+q[0])*w,(N/E+q[1])*w)}function cf(l,h,c,d,E,w,P,L,N,q,ce){var he=l.text.placedSymbolArray,de=l.text.dynamicLayoutVertexArray,Re=l.icon.dynamicLayoutVertexArray,Ie={};de.clear();for(var We=0;We<he.length;We++){var we=he.get(We),Ve=we.hidden||!we.crossTileID||l.allowVerticalPlacement&&!we.placedOrientation?null:d[we.crossTileID];if(Ve){var tt=new m.Point(we.anchorX,we.anchorY),yt=Ii(tt,c?L:P),Wt=pi(w.cameraToCenterDistance,yt.signedDistanceFromCamera),jt=E.evaluateSizeForFeature(l.textSizeData,q,we)*Wt/m.ONE_EM;c&&(jt*=l.tilePixelRatio/N);for(var Jt=kc(Ve.anchor,Ve.width,Ve.height,Ve.textOffset,Ve.textBoxScale,jt),dr=c?Ii(tt.add(Jt),P).point:yt.point.add(h?Jt.rotate(-w.angle):Jt),Fr=l.allowVerticalPlacement&&we.placedOrientation===m.WritingMode.vertical?Math.PI/2:0,kr=0;kr<we.numGlyphs;kr++)m.addDynamicAttributes(de,dr,Fr);ce&&we.associatedIconIndex>=0&&(Ie[we.associatedIconIndex]={shiftedAnchor:dr,angle:Fr})}else oo(we.numGlyphs,de)}if(ce){Re.clear();for(var ln=l.icon.placedSymbolArray,Nn=0;Nn<ln.length;Nn++){var zn=ln.get(Nn);if(zn.hidden)oo(zn.numGlyphs,Re);else{var Mn=Ie[Nn];if(Mn)for(var Bi=0;Bi<zn.numGlyphs;Bi++)m.addDynamicAttributes(Re,Mn.shiftedAnchor,Mn.angle);else oo(zn.numGlyphs,Re)}}l.icon.dynamicLayoutVertexBuffer.updateData(Re)}l.text.dynamicLayoutVertexBuffer.updateData(de)}function Uf(l,h,c){return c.iconsInText&&h?"symbolTextAndIcon":l?"symbolSDF":"symbolIcon"}function dl(l,h,c,d,E,w,P,L,N,q,ce,he){for(var de=l.context,Re=de.gl,Ie=l.transform,We=L==="map",we=N==="map",Ve=We&&c.layout.get("symbol-placement")!=="point",tt=We&&!we&&!Ve,yt=c.layout.get("symbol-sort-key").constantOr(1)!==void 0,Wt=!1,jt=l.depthModeForSublayer(0,ye.ReadOnly),Jt=c.layout.get("text-variable-anchor"),dr=[],Fr=0,kr=d;Fr<kr.length;Fr+=1){var ln=kr[Fr],Nn=h.getTile(ln),zn=Nn.getBucket(c);if(zn){var Mn=E?zn.text:zn.icon;if(Mn&&Mn.segments.get().length){var Bi=Mn.programConfigurations.get(c.id),Qr=E||zn.sdfIcons,li=E?zn.textSizeData:zn.iconSizeData,fi=we||Ie.pitch!==0,ii=l.useProgram(Uf(Qr,E,zn),Bi),Xn=m.evaluateSizeForZoom(li,Ie.zoom),xi=void 0,ri=[0,0],Kn=void 0,po=void 0,Ka=null,Ho=void 0;if(E)Kn=Nn.glyphAtlasTexture,po=Re.LINEAR,xi=Nn.glyphAtlasTexture.size,zn.iconsInText&&(ri=Nn.imageAtlasTexture.size,Ka=Nn.imageAtlasTexture,Ho=fi||l.options.rotating||l.options.zooming||li.kind==="composite"||li.kind==="camera"?Re.LINEAR:Re.NEAREST);else{var Bo=c.layout.get("icon-size").constantOr(0)!==1||zn.iconsNeedLinear;Kn=Nn.imageAtlasTexture,po=Qr||l.options.rotating||l.options.zooming||Bo||fi?Re.LINEAR:Re.NEAREST,xi=Nn.imageAtlasTexture.size}var za=Qi(Nn,1,l.transform.zoom),co=Aa(ln.posMatrix,we,We,l.transform,za),Bs=qi(ln.posMatrix,we,We,l.transform,za),_s=Jt&&zn.hasTextData(),Hu=c.layout.get("icon-text-fit")!=="none"&&_s&&zn.hasIconData();Ve&&$s(zn,ln.posMatrix,l,E,co,Bs,we,q);var xs=l.translatePosMatrix(ln.posMatrix,Nn,w,P),pu=Ve||E&&Jt||Hu?eu:co,vo=l.translatePosMatrix(Bs,Nn,w,P,!0),mc=Qr&&c.paint.get(E?"text-halo-width":"icon-halo-width").constantOr(1)!==0,ru={program:ii,buffers:Mn,uniformValues:Qr?zn.iconsInText?sc(li.kind,Xn,tt,we,l,xs,pu,vo,xi,ri):oc(li.kind,Xn,tt,we,l,xs,pu,vo,E,xi,!0):ac(li.kind,Xn,tt,we,l,xs,pu,vo,E,xi),atlasTexture:Kn,atlasTextureIcon:Ka,atlasInterpolation:po,atlasInterpolationIcon:Ho,isSDF:Qr,hasHalo:mc};if(yt&&zn.canOverlap){Wt=!0;for(var Wu=0,du=Mn.segments.get();Wu<du.length;Wu+=1){var xl=du[Wu];dr.push({segments:new m.SegmentVector([xl]),sortKey:xl.sortKey,state:ru})}}else dr.push({segments:Mn.segments,sortKey:0,state:ru})}}}Wt&&dr.sort(function(Ua,mu){return Ua.sortKey-mu.sortKey});for(var vu=0,Ul=dr;vu<Ul.length;vu+=1){var Ou=Ul[vu],So=Ou.state;if(de.activeTexture.set(Re.TEXTURE0),So.atlasTexture.bind(So.atlasInterpolation,Re.CLAMP_TO_EDGE),So.atlasTextureIcon&&(de.activeTexture.set(Re.TEXTURE1),So.atlasTextureIcon&&So.atlasTextureIcon.bind(So.atlasInterpolationIcon,Re.CLAMP_TO_EDGE)),So.isSDF){var ka=So.uniformValues;So.hasHalo&&(ka.u_is_halo=1,lc(So.buffers,Ou.segments,c,l,So.program,jt,ce,he,ka)),ka.u_is_halo=0}lc(So.buffers,Ou.segments,c,l,So.program,jt,ce,he,So.uniformValues)}}function lc(l,h,c,d,E,w,P,L,N){var q=d.context;E.draw(q,q.gl.TRIANGLES,w,P,L,rt.disabled,N,c.id,l.layoutVertexBuffer,l.indexBuffer,h,c.paint,d.transform.zoom,l.programConfigurations.get(c.id),l.dynamicLayoutVertexBuffer,l.opacityVertexBuffer)}function rl(l,h,c,d,E,w,P){var L,N,q,ce,he,de=l.context.gl,Re=c.paint.get("fill-pattern"),Ie=Re&&Re.constantOr(1),We=c.getCrossfadeParameters();P?(N=Ie&&!c.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",L=de.LINES):(N=Ie?"fillPattern":"fill",L=de.TRIANGLES);for(var we=0,Ve=d;we<Ve.length;we+=1){var tt=Ve[we],yt=h.getTile(tt);if(!Ie||yt.patternsLoaded()){var Wt=yt.getBucket(c);if(Wt){var jt=Wt.programConfigurations.get(c.id),Jt=l.useProgram(N,jt);Ie&&(l.context.activeTexture.set(de.TEXTURE0),yt.imageAtlasTexture.bind(de.LINEAR,de.CLAMP_TO_EDGE),jt.updatePaintBuffers(We));var dr=Re.constantOr(null);if(dr&&yt.imageAtlas){var Fr=yt.imageAtlas,kr=Fr.patternPositions[dr.to.toString()],ln=Fr.patternPositions[dr.from.toString()];kr&&ln&&jt.setConstantPatternPositions(kr,ln)}var Nn=l.translatePosMatrix(tt.posMatrix,yt,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));if(P){ce=Wt.indexBuffer2,he=Wt.segments2;var zn=[de.drawingBufferWidth,de.drawingBufferHeight];q=N==="fillOutlinePattern"&&Ie?Bf(Nn,l,We,yt,zn):uo(Nn,zn)}else ce=Wt.indexBuffer,he=Wt.segments,q=Ie?zu(Nn,l,We,yt):Nu(Nn);Jt.draw(l.context,L,E,l.stencilModeForClipping(tt),w,rt.disabled,q,c.id,Wt.layoutVertexBuffer,ce,he,c.paint,l.transform.zoom,jt)}}}}function ff(l,h,c,d,E,w,P){for(var L=l.context,N=L.gl,q=c.paint.get("fill-extrusion-pattern"),ce=q.constantOr(1),he=c.getCrossfadeParameters(),de=c.paint.get("fill-extrusion-opacity"),Re=0,Ie=d;Re<Ie.length;Re+=1){var We=Ie[Re],we=h.getTile(We),Ve=we.getBucket(c);if(Ve){var tt=Ve.programConfigurations.get(c.id),yt=l.useProgram(ce?"fillExtrusionPattern":"fillExtrusion",tt);ce&&(l.context.activeTexture.set(N.TEXTURE0),we.imageAtlasTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),tt.updatePaintBuffers(he));var Wt=q.constantOr(null);if(Wt&&we.imageAtlas){var jt=we.imageAtlas,Jt=jt.patternPositions[Wt.to.toString()],dr=jt.patternPositions[Wt.from.toString()];Jt&&dr&&tt.setConstantPatternPositions(Jt,dr)}var Fr=l.translatePosMatrix(We.posMatrix,we,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),kr=c.paint.get("fill-extrusion-vertical-gradient"),ln=ce?Bu(Fr,l,kr,de,We,he,we):Lc(Fr,l,kr,de);yt.draw(L,L.gl.TRIANGLES,E,w,P,rt.backCCW,ln,c.id,Ve.layoutVertexBuffer,Ve.indexBuffer,Ve.segments,c.paint,l.transform.zoom,tt)}}}function Dc(l,h,c,d,E,w){var P=l.context,L=P.gl,N=h.fbo;if(N){var q=l.useProgram("hillshade");P.activeTexture.set(L.TEXTURE0),L.bindTexture(L.TEXTURE_2D,N.colorAttachment.get());var ce=function(he,de,Re){var Ie=Re.paint.get("hillshade-shadow-color"),We=Re.paint.get("hillshade-highlight-color"),we=Re.paint.get("hillshade-accent-color"),Ve=Re.paint.get("hillshade-illumination-direction")*(Math.PI/180);Re.paint.get("hillshade-illumination-anchor")==="viewport"&&(Ve-=he.transform.angle);var tt,yt,Wt,jt=!he.options.moving;return{u_matrix:he.transform.calculatePosMatrix(de.tileID.toUnwrapped(),jt),u_image:0,u_latrange:(tt=de.tileID,yt=Math.pow(2,tt.canonical.z),Wt=tt.canonical.y,[new m.MercatorCoordinate(0,Wt/yt).toLngLat().lat,new m.MercatorCoordinate(0,(Wt+1)/yt).toLngLat().lat]),u_light:[Re.paint.get("hillshade-exaggeration"),Ve],u_shadow:Ie,u_highlight:We,u_accent:we}}(l,h,c);q.draw(P,L.TRIANGLES,d,E,w,rt.disabled,ce,c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments)}}function bh(l,h,c,d,E,w){var P=l.context,L=P.gl,N=h.dem;if(N&&N.data){var q=N.dim,ce=N.stride,he=N.getPixels();if(P.activeTexture.set(L.TEXTURE1),P.pixelStoreUnpackPremultiplyAlpha.set(!1),h.demTexture=h.demTexture||l.getTileTexture(ce),h.demTexture){var de=h.demTexture;de.update(he,{premultiply:!1}),de.bind(L.NEAREST,L.CLAMP_TO_EDGE)}else h.demTexture=new m.Texture(P,he,L.RGBA,{premultiply:!1}),h.demTexture.bind(L.NEAREST,L.CLAMP_TO_EDGE);P.activeTexture.set(L.TEXTURE0);var Re=h.fbo;if(!Re){var Ie=new m.Texture(P,{width:q,height:q,data:null},L.RGBA);Ie.bind(L.LINEAR,L.CLAMP_TO_EDGE),(Re=h.fbo=P.createFramebuffer(q,q,!0)).colorAttachment.set(Ie.texture)}P.bindFramebuffer.set(Re.framebuffer),P.viewport.set([0,0,q,q]),l.useProgram("hillshadePrepare").draw(P,L.TRIANGLES,d,E,w,rt.disabled,function(We,we){var Ve=we.stride,tt=m.create();return m.ortho(tt,0,m.EXTENT,-m.EXTENT,0,0,1),m.translate(tt,tt,[0,-m.EXTENT,0]),{u_matrix:tt,u_image:1,u_dimension:[Ve,Ve],u_zoom:We.overscaledZ,u_unpack:we.getUnpackVector()}}(h.tileID,N),c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments),h.needsHillshadePrepare=!1}}function kl(l,h,c,d,E){var w=d.paint.get("raster-fade-duration");if(w>0){var P=m.browser.now(),L=(P-l.timeAdded)/w,N=h?(P-h.timeAdded)/w:-1,q=c.getSource(),ce=E.coveringZoomLevel({tileSize:q.tileSize,roundZoom:q.roundZoom}),he=!h||Math.abs(h.tileID.overscaledZ-ce)>Math.abs(l.tileID.overscaledZ-ce),de=he&&l.refreshedUponExpiration?1:m.clamp(he?L:1-N,0,1);return l.refreshedUponExpiration&&L>=1&&(l.refreshedUponExpiration=!1),h?{opacity:1,mix:1-de}:{opacity:de,mix:0}}return{opacity:1,mix:0}}var Dl=new m.Color(1,0,0,1),Zf=new m.Color(0,1,0,1),jf=new m.Color(0,0,1,1),vl=new m.Color(1,0,1,1),Vf=new m.Color(0,1,1,1);function Eh(l,h,c,d){cc(l,0,h+c/2,l.transform.width,c,d)}function Fc(l,h,c,d){cc(l,h-c/2,0,c,l.transform.height,d)}function cc(l,h,c,d,E,w){var P=l.context,L=P.gl;L.enable(L.SCISSOR_TEST),L.scissor(h*m.browser.devicePixelRatio,c*m.browser.devicePixelRatio,d*m.browser.devicePixelRatio,E*m.browser.devicePixelRatio),P.clear({color:w}),L.disable(L.SCISSOR_TEST)}function tp(l,h,c){var d=l.context,E=d.gl,w=c.posMatrix,P=l.useProgram("debug"),L=ye.disabled,N=Pe.disabled,q=l.colorModeForRenderPass();d.activeTexture.set(E.TEXTURE0),l.emptyTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),P.draw(d,E.LINE_STRIP,L,N,q,rt.disabled,su(w,m.Color.red),"$debug",l.debugBuffer,l.tileBorderIndexBuffer,l.debugSegments);var ce=h.getTileByID(c.key).latestRawTileData,he=Math.floor((ce&&ce.byteLength||0)/1024),de=h.getTile(c).tileSize,Re=512/Math.min(de,512)*(c.overscaledZ/l.transform.zoom)*.5,Ie=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(Ie+=" => "+c.overscaledZ),function(We,we){We.initDebugOverlayCanvas();var Ve=We.debugOverlayCanvas,tt=We.context.gl,yt=We.debugOverlayCanvas.getContext("2d");yt.clearRect(0,0,Ve.width,Ve.height),yt.shadowColor="white",yt.shadowBlur=2,yt.lineWidth=1.5,yt.strokeStyle="white",yt.textBaseline="top",yt.font="bold 36px Open Sans, sans-serif",yt.fillText(we,5,5),yt.strokeText(we,5,5),We.debugOverlayTexture.update(Ve),We.debugOverlayTexture.bind(tt.LINEAR,tt.CLAMP_TO_EDGE)}(l,Ie+" "+he+"kb"),P.draw(d,E.TRIANGLES,L,N,He.alphaBlended,rt.disabled,su(w,m.Color.transparent,Re),"$debug",l.debugBuffer,l.quadTriangleIndexBuffer,l.debugSegments)}var fc={symbol:function(l,h,c,d,E){if(l.renderPass==="translucent"){var w=Pe.disabled,P=l.colorModeForRenderPass();c.layout.get("text-variable-anchor")&&function(L,N,q,ce,he,de,Re){for(var Ie=N.transform,We=he==="map",we=de==="map",Ve=0,tt=L;Ve<tt.length;Ve+=1){var yt=tt[Ve],Wt=ce.getTile(yt),jt=Wt.getBucket(q);if(jt&&jt.text&&jt.text.segments.get().length){var Jt=m.evaluateSizeForZoom(jt.textSizeData,Ie.zoom),dr=Qi(Wt,1,N.transform.zoom),Fr=Aa(yt.posMatrix,we,We,N.transform,dr),kr=q.layout.get("icon-text-fit")!=="none"&&jt.hasIconData();if(Jt){var ln=Math.pow(2,Ie.zoom-Wt.tileID.overscaledZ);cf(jt,We,we,Re,m.symbolSize,Ie,Fr,yt.posMatrix,ln,Jt,kr)}}}}(d,l,c,h,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),E),c.paint.get("icon-opacity").constantOr(1)!==0&&dl(l,h,c,d,!1,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),c.layout.get("icon-rotation-alignment"),c.layout.get("icon-pitch-alignment"),c.layout.get("icon-keep-upright"),w,P),c.paint.get("text-opacity").constantOr(1)!==0&&dl(l,h,c,d,!0,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),c.layout.get("text-keep-upright"),w,P),h.map.showCollisionBoxes&&(pl(l,h,c,d,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),pl(l,h,c,d,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))}},circle:function(l,h,c,d){if(l.renderPass==="translucent"){var E=c.paint.get("circle-opacity"),w=c.paint.get("circle-stroke-width"),P=c.paint.get("circle-stroke-opacity"),L=c.layout.get("circle-sort-key").constantOr(1)!==void 0;if(E.constantOr(1)!==0||w.constantOr(1)!==0&&P.constantOr(1)!==0){for(var N=l.context,q=N.gl,ce=l.depthModeForSublayer(0,ye.ReadOnly),he=Pe.disabled,de=l.colorModeForRenderPass(),Re=[],Ie=0;Ie<d.length;Ie++){var We=d[Ie],we=h.getTile(We),Ve=we.getBucket(c);if(Ve){var tt=Ve.programConfigurations.get(c.id),yt={programConfiguration:tt,program:l.useProgram("circle",tt),layoutVertexBuffer:Ve.layoutVertexBuffer,indexBuffer:Ve.indexBuffer,uniformValues:Nf(l,We,we,c)};if(L)for(var Wt=0,jt=Ve.segments.get();Wt<jt.length;Wt+=1){var Jt=jt[Wt];Re.push({segments:new m.SegmentVector([Jt]),sortKey:Jt.sortKey,state:yt})}else Re.push({segments:Ve.segments,sortKey:0,state:yt})}}L&&Re.sort(function(Nn,zn){return Nn.sortKey-zn.sortKey});for(var dr=0,Fr=Re;dr<Fr.length;dr+=1){var kr=Fr[dr],ln=kr.state;ln.program.draw(N,q.TRIANGLES,ce,he,de,rt.disabled,ln.uniformValues,c.id,ln.layoutVertexBuffer,ln.indexBuffer,kr.segments,c.paint,l.transform.zoom,ln.programConfiguration)}}}},heatmap:function(l,h,c,d){if(c.paint.get("heatmap-opacity")!==0)if(l.renderPass==="offscreen"){var E=l.context,w=E.gl,P=Pe.disabled,L=new He([w.ONE,w.ONE],m.Color.transparent,[!0,!0,!0,!0]);(function(Re,Ie,We){var we=Re.gl;Re.activeTexture.set(we.TEXTURE1),Re.viewport.set([0,0,Ie.width/4,Ie.height/4]);var Ve=We.heatmapFbo;if(Ve)we.bindTexture(we.TEXTURE_2D,Ve.colorAttachment.get()),Re.bindFramebuffer.set(Ve.framebuffer);else{var tt=we.createTexture();we.bindTexture(we.TEXTURE_2D,tt),we.texParameteri(we.TEXTURE_2D,we.TEXTURE_WRAP_S,we.CLAMP_TO_EDGE),we.texParameteri(we.TEXTURE_2D,we.TEXTURE_WRAP_T,we.CLAMP_TO_EDGE),we.texParameteri(we.TEXTURE_2D,we.TEXTURE_MIN_FILTER,we.LINEAR),we.texParameteri(we.TEXTURE_2D,we.TEXTURE_MAG_FILTER,we.LINEAR),Ve=We.heatmapFbo=Re.createFramebuffer(Ie.width/4,Ie.height/4,!1),function(yt,Wt,jt,Jt){var dr=yt.gl;dr.texImage2D(dr.TEXTURE_2D,0,dr.RGBA,Wt.width/4,Wt.height/4,0,dr.RGBA,yt.extRenderToTextureHalfFloat?yt.extTextureHalfFloat.HALF_FLOAT_OES:dr.UNSIGNED_BYTE,null),Jt.colorAttachment.set(jt)}(Re,Ie,tt,Ve)}})(E,l,c),E.clear({color:m.Color.transparent});for(var N=0;N<d.length;N++){var q=d[N];if(!h.hasRenderableParent(q)){var ce=h.getTile(q),he=ce.getBucket(c);if(he){var de=he.programConfigurations.get(c.id);l.useProgram("heatmap",de).draw(E,w.TRIANGLES,ye.disabled,P,L,rt.disabled,uf(q.posMatrix,ce,l.transform.zoom,c.paint.get("heatmap-intensity")),c.id,he.layoutVertexBuffer,he.indexBuffer,he.segments,c.paint,l.transform.zoom,de)}}}E.viewport.set([0,0,l.width,l.height])}else l.renderPass==="translucent"&&(l.context.setColorMode(l.colorModeForRenderPass()),function(Re,Ie){var We=Re.context,we=We.gl,Ve=Ie.heatmapFbo;if(Ve){We.activeTexture.set(we.TEXTURE0),we.bindTexture(we.TEXTURE_2D,Ve.colorAttachment.get()),We.activeTexture.set(we.TEXTURE1);var tt=Ie.colorRampTexture;tt||(tt=Ie.colorRampTexture=new m.Texture(We,Ie.colorRamp,we.RGBA)),tt.bind(we.LINEAR,we.CLAMP_TO_EDGE),Re.useProgram("heatmapTexture").draw(We,we.TRIANGLES,ye.disabled,Pe.disabled,Re.colorModeForRenderPass(),rt.disabled,function(yt,Wt,jt,Jt){var dr=m.create();m.ortho(dr,0,yt.width,yt.height,0,0,1);var Fr=yt.context.gl;return{u_matrix:dr,u_world:[Fr.drawingBufferWidth,Fr.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:Wt.paint.get("heatmap-opacity")}}(Re,Ie),Ie.id,Re.viewportBuffer,Re.quadTriangleIndexBuffer,Re.viewportSegments,Ie.paint,Re.transform.zoom)}}(l,c))},line:function(l,h,c,d){if(l.renderPass==="translucent"){var E=c.paint.get("line-opacity"),w=c.paint.get("line-width");if(E.constantOr(1)!==0&&w.constantOr(1)!==0)for(var P=l.depthModeForSublayer(0,ye.ReadOnly),L=l.colorModeForRenderPass(),N=c.paint.get("line-dasharray"),q=c.paint.get("line-pattern"),ce=q.constantOr(1),he=c.paint.get("line-gradient"),de=c.getCrossfadeParameters(),Re=ce?"linePattern":N?"lineSDF":he?"lineGradient":"line",Ie=l.context,We=Ie.gl,we=!0,Ve=0,tt=d;Ve<tt.length;Ve+=1){var yt=tt[Ve],Wt=h.getTile(yt);if(!ce||Wt.patternsLoaded()){var jt=Wt.getBucket(c);if(jt){var Jt=jt.programConfigurations.get(c.id),dr=l.context.program.get(),Fr=l.useProgram(Re,Jt),kr=we||Fr.program!==dr,ln=q.constantOr(null);if(ln&&Wt.imageAtlas){var Nn=Wt.imageAtlas,zn=Nn.patternPositions[ln.to.toString()],Mn=Nn.patternPositions[ln.from.toString()];zn&&Mn&&Jt.setConstantPatternPositions(zn,Mn)}var Bi=ce?nc(l,Wt,c,de):N?Js(l,Wt,c,N,de):he?ya(l,Wt,c,jt.lineClipsArray.length):Ol(l,Wt,c);if(ce)Ie.activeTexture.set(We.TEXTURE0),Wt.imageAtlasTexture.bind(We.LINEAR,We.CLAMP_TO_EDGE),Jt.updatePaintBuffers(de);else if(N&&(kr||l.lineAtlas.dirty))Ie.activeTexture.set(We.TEXTURE0),l.lineAtlas.bind(Ie);else if(he){var Qr=jt.gradients[c.id],li=Qr.texture;if(c.gradientVersion!==Qr.version){var fi=256;if(c.stepInterpolant){var ii=h.getSource().maxzoom,Xn=yt.canonical.z===ii?Math.ceil(1<<l.transform.maxZoom-yt.canonical.z):1;fi=m.clamp(m.nextPowerOfTwo(jt.maxLineLength/m.EXTENT*1024*Xn),256,Ie.maxTextureSize)}Qr.gradient=m.renderColorRamp({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:fi,image:Qr.gradient||void 0,clips:jt.lineClipsArray}),Qr.texture?Qr.texture.update(Qr.gradient):Qr.texture=new m.Texture(Ie,Qr.gradient,We.RGBA),Qr.version=c.gradientVersion,li=Qr.texture}Ie.activeTexture.set(We.TEXTURE0),li.bind(c.stepInterpolant?We.NEAREST:We.LINEAR,We.CLAMP_TO_EDGE)}Fr.draw(Ie,We.TRIANGLES,P,l.stencilModeForClipping(yt),L,rt.disabled,Bi,c.id,jt.layoutVertexBuffer,jt.indexBuffer,jt.segments,c.paint,l.transform.zoom,Jt,jt.layoutVertexBuffer2),we=!1}}}}},fill:function(l,h,c,d){var E=c.paint.get("fill-color"),w=c.paint.get("fill-opacity");if(w.constantOr(1)!==0){var P=l.colorModeForRenderPass(),L=c.paint.get("fill-pattern"),N=l.opaquePassEnabledForLayer()&&!L.constantOr(1)&&E.constantOr(m.Color.transparent).a===1&&w.constantOr(0)===1?"opaque":"translucent";if(l.renderPass===N){var q=l.depthModeForSublayer(1,l.renderPass==="opaque"?ye.ReadWrite:ye.ReadOnly);rl(l,h,c,d,q,P,!1)}if(l.renderPass==="translucent"&&c.paint.get("fill-antialias")){var ce=l.depthModeForSublayer(c.getPaintProperty("fill-outline-color")?2:0,ye.ReadOnly);rl(l,h,c,d,ce,P,!0)}}},"fill-extrusion":function(l,h,c,d){var E=c.paint.get("fill-extrusion-opacity");if(E!==0&&l.renderPass==="translucent"){var w=new ye(l.context.gl.LEQUAL,ye.ReadWrite,l.depthRangeFor3D);if(E!==1||c.paint.get("fill-extrusion-pattern").constantOr(1))ff(l,h,c,d,w,Pe.disabled,He.disabled),ff(l,h,c,d,w,l.stencilModeFor3D(),l.colorModeForRenderPass());else{var P=l.colorModeForRenderPass();ff(l,h,c,d,w,Pe.disabled,P)}}},hillshade:function(l,h,c,d){if(l.renderPass==="offscreen"||l.renderPass==="translucent"){for(var E=l.context,w=l.depthModeForSublayer(0,ye.ReadOnly),P=l.colorModeForRenderPass(),L=l.renderPass==="translucent"?l.stencilConfigForOverlap(d):[{},d],N=L[0],q=0,ce=L[1];q<ce.length;q+=1){var he=ce[q],de=h.getTile(he);de.needsHillshadePrepare&&l.renderPass==="offscreen"?bh(l,de,c,w,Pe.disabled,P):l.renderPass==="translucent"&&Dc(l,de,c,w,N[he.overscaledZ],P)}E.viewport.set([0,0,l.width,l.height])}},raster:function(l,h,c,d){if(l.renderPass==="translucent"&&c.paint.get("raster-opacity")!==0&&d.length)for(var E=l.context,w=E.gl,P=h.getSource(),L=l.useProgram("raster"),N=l.colorModeForRenderPass(),q=P instanceof mt?[{},d]:l.stencilConfigForOverlap(d),ce=q[0],he=q[1],de=he[he.length-1].overscaledZ,Re=!l.options.moving,Ie=0,We=he;Ie<We.length;Ie+=1){var we=We[Ie],Ve=l.depthModeForSublayer(we.overscaledZ-de,c.paint.get("raster-opacity")===1?ye.ReadWrite:ye.ReadOnly,w.LESS),tt=h.getTile(we),yt=l.transform.calculatePosMatrix(we.toUnwrapped(),Re);tt.registerFadeDuration(c.paint.get("raster-fade-duration"));var Wt=h.findLoadedParent(we,0),jt=kl(tt,Wt,h,c,l.transform),Jt=void 0,dr=void 0,Fr=c.paint.get("raster-resampling")==="nearest"?w.NEAREST:w.LINEAR;E.activeTexture.set(w.TEXTURE0),tt.texture.bind(Fr,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST),E.activeTexture.set(w.TEXTURE1),Wt?(Wt.texture.bind(Fr,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST),Jt=Math.pow(2,Wt.tileID.overscaledZ-tt.tileID.overscaledZ),dr=[tt.tileID.canonical.x*Jt%1,tt.tileID.canonical.y*Jt%1]):tt.texture.bind(Fr,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST);var kr=ep(yt,dr||[0,0],Jt||1,jt,c);P instanceof mt?L.draw(E,w.TRIANGLES,Ve,Pe.disabled,N,rt.disabled,kr,c.id,P.boundsBuffer,l.quadTriangleIndexBuffer,P.boundsSegments):L.draw(E,w.TRIANGLES,Ve,ce[we.overscaledZ],N,rt.disabled,kr,c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments)}},background:function(l,h,c){var d=c.paint.get("background-color"),E=c.paint.get("background-opacity");if(E!==0){var w=l.context,P=w.gl,L=l.transform,N=L.tileSize,q=c.paint.get("background-pattern");if(!l.isPatternMissing(q)){var ce=!q&&d.a===1&&E===1&&l.opaquePassEnabledForLayer()?"opaque":"translucent";if(l.renderPass===ce){var he=Pe.disabled,de=l.depthModeForSublayer(0,ce==="opaque"?ye.ReadWrite:ye.ReadOnly),Re=l.colorModeForRenderPass(),Ie=l.useProgram(q?"backgroundPattern":"background"),We=L.coveringTiles({tileSize:N});q&&(w.activeTexture.set(P.TEXTURE0),l.imageManager.bind(l.context));for(var we=c.getCrossfadeParameters(),Ve=0,tt=We;Ve<tt.length;Ve+=1){var yt=tt[Ve],Wt=l.transform.calculatePosMatrix(yt.toUnwrapped()),jt=q?Rl(Wt,E,l,q,{tileID:yt,tileSize:N},we):uc(Wt,E,d);Ie.draw(w,P.TRIANGLES,de,he,Re,rt.disabled,jt,c.id,l.tileExtentBuffer,l.quadTriangleIndexBuffer,l.tileExtentSegments)}}}}},debug:function(l,h,c){for(var d=0;d<c.length;d++)tp(l,h,c[d])},custom:function(l,h,c){var d=l.context,E=c.implementation;if(l.renderPass==="offscreen"){var w=E.prerender;w&&(l.setCustomLayerDefaults(),d.setColorMode(l.colorModeForRenderPass()),w.call(E,d.gl,l.transform.customLayerMatrix()),d.setDirty(),l.setBaseState())}else if(l.renderPass==="translucent"){l.setCustomLayerDefaults(),d.setColorMode(l.colorModeForRenderPass()),d.setStencilMode(Pe.disabled);var P=E.renderingMode==="3d"?new ye(l.context.gl.LEQUAL,ye.ReadWrite,l.depthRangeFor3D):l.depthModeForSublayer(0,ye.ReadOnly);d.setDepthMode(P),E.render(d.gl,l.transform.customLayerMatrix()),d.setDirty(),l.setBaseState(),d.bindFramebuffer.set(null)}}},Va=function(l,h){this.context=new pe(l),this.transform=h,this._tileTextures={},this.setup(),this.numSublayers=ke.maxUnderzooming+ke.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Ss,this.gpuTimers={}};Va.prototype.resize=function(l,h){if(this.width=l*m.browser.devicePixelRatio,this.height=h*m.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var c=0,d=this.style._order;c<d.length;c+=1)this.style._layers[d[c]].resize()},Va.prototype.setup=function(){var l=this.context,h=new m.StructArrayLayout2i4;h.emplaceBack(0,0),h.emplaceBack(m.EXTENT,0),h.emplaceBack(0,m.EXTENT),h.emplaceBack(m.EXTENT,m.EXTENT),this.tileExtentBuffer=l.createVertexBuffer(h,ga.members),this.tileExtentSegments=m.SegmentVector.simpleSegment(0,0,4,2);var c=new m.StructArrayLayout2i4;c.emplaceBack(0,0),c.emplaceBack(m.EXTENT,0),c.emplaceBack(0,m.EXTENT),c.emplaceBack(m.EXTENT,m.EXTENT),this.debugBuffer=l.createVertexBuffer(c,ga.members),this.debugSegments=m.SegmentVector.simpleSegment(0,0,4,5);var d=new m.StructArrayLayout4i8;d.emplaceBack(0,0,0,0),d.emplaceBack(m.EXTENT,0,m.EXTENT,0),d.emplaceBack(0,m.EXTENT,0,m.EXTENT),d.emplaceBack(m.EXTENT,m.EXTENT,m.EXTENT,m.EXTENT),this.rasterBoundsBuffer=l.createVertexBuffer(d,wt.members),this.rasterBoundsSegments=m.SegmentVector.simpleSegment(0,0,4,2);var E=new m.StructArrayLayout2i4;E.emplaceBack(0,0),E.emplaceBack(1,0),E.emplaceBack(0,1),E.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(E,ga.members),this.viewportSegments=m.SegmentVector.simpleSegment(0,0,4,2);var w=new m.StructArrayLayout1ui2;w.emplaceBack(0),w.emplaceBack(1),w.emplaceBack(3),w.emplaceBack(2),w.emplaceBack(0),this.tileBorderIndexBuffer=l.createIndexBuffer(w);var P=new m.StructArrayLayout3ui6;P.emplaceBack(0,1,2),P.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(P),this.emptyTexture=new m.Texture(l,{width:1,height:1,data:new Uint8Array([0,0,0,0])},l.gl.RGBA);var L=this.context.gl;this.stencilClearMode=new Pe({func:L.ALWAYS,mask:0},0,255,L.ZERO,L.ZERO,L.ZERO)},Va.prototype.clearStencil=function(){var l=this.context,h=l.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var c=m.create();m.ortho(c,0,this.width,this.height,0,0,1),m.scale(c,c,[h.drawingBufferWidth,h.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(l,h.TRIANGLES,ye.disabled,this.stencilClearMode,He.disabled,rt.disabled,Hs(c),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},Va.prototype._renderTileClippingMasks=function(l,h){if(this.currentStencilSource!==l.source&&l.isTileClipped()&&h&&h.length){this.currentStencilSource=l.source;var c=this.context,d=c.gl;this.nextStencilID+h.length>256&&this.clearStencil(),c.setColorMode(He.disabled),c.setDepthMode(ye.disabled);var E=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var w=0,P=h;w<P.length;w+=1){var L=P[w],N=this._tileClippingMaskIDs[L.key]=this.nextStencilID++;E.draw(c,d.TRIANGLES,ye.disabled,new Pe({func:d.ALWAYS,mask:0},N,255,d.KEEP,d.KEEP,d.REPLACE),He.disabled,rt.disabled,Hs(L.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},Va.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var l=this.nextStencilID++,h=this.context.gl;return new Pe({func:h.NOTEQUAL,mask:255},l,255,h.KEEP,h.KEEP,h.REPLACE)},Va.prototype.stencilModeForClipping=function(l){var h=this.context.gl;return new Pe({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,h.KEEP,h.KEEP,h.REPLACE)},Va.prototype.stencilConfigForOverlap=function(l){var h,c=this.context.gl,d=l.sort(function(N,q){return q.overscaledZ-N.overscaledZ}),E=d[d.length-1].overscaledZ,w=d[0].overscaledZ-E+1;if(w>1){this.currentStencilSource=void 0,this.nextStencilID+w>256&&this.clearStencil();for(var P={},L=0;L<w;L++)P[L+E]=new Pe({func:c.GEQUAL,mask:255},L+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=w,[P,d]}return[(h={},h[E]=Pe.disabled,h),d]},Va.prototype.colorModeForRenderPass=function(){var l=this.context.gl;return this._showOverdrawInspector?new He([l.CONSTANT_COLOR,l.ONE],new m.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?He.unblended:He.alphaBlended},Va.prototype.depthModeForSublayer=function(l,h,c){if(!this.opaquePassEnabledForLayer())return ye.disabled;var d=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new ye(c||this.context.gl.LEQUAL,h,[d,d])},Va.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},Va.prototype.render=function(l,h){var c=this;this.style=l,this.options=h,this.lineAtlas=l.lineAtlas,this.imageManager=l.imageManager,this.glyphManager=l.glyphManager,this.symbolFadeChange=l.placement.symbolFadeChange(m.browser.now()),this.imageManager.beginFrame();var d=this.style._order,E=this.style.sourceCaches;for(var w in E){var P=E[w];P.used&&P.prepare(this.context)}var L,N,q={},ce={},he={};for(var de in E){var Re=E[de];q[de]=Re.getVisibleCoordinates(),ce[de]=q[de].slice().reverse(),he[de]=Re.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var Ie=0;Ie<d.length;Ie++)if(this.style._layers[d[Ie]].is3D()){this.opaquePassCutoff=Ie;break}this.renderPass="offscreen";for(var We=0,we=d;We<we.length;We+=1){var Ve=this.style._layers[we[We]];if(Ve.hasOffscreenPass()&&!Ve.isHidden(this.transform.zoom)){var tt=ce[Ve.source];(Ve.type==="custom"||tt.length)&&this.renderLayer(this,E[Ve.source],Ve,tt)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:h.showOverdrawInspector?m.Color.black:m.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.depthRangeFor3D=[0,1-(l._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=d.length-1;this.currentLayer>=0;this.currentLayer--){var yt=this.style._layers[d[this.currentLayer]],Wt=E[yt.source],jt=q[yt.source];this._renderTileClippingMasks(yt,jt),this.renderLayer(this,Wt,yt,jt)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<d.length;this.currentLayer++){var Jt=this.style._layers[d[this.currentLayer]],dr=E[Jt.source],Fr=(Jt.type==="symbol"?he:ce)[Jt.source];this._renderTileClippingMasks(Jt,q[Jt.source]),this.renderLayer(this,dr,Jt,Fr)}this.options.showTileBoundaries&&(m.values(this.style._layers).forEach(function(kr){kr.source&&!kr.isHidden(c.transform.zoom)&&(kr.source!==(N&&N.id)&&(N=c.style.sourceCaches[kr.source]),(!L||L.getSource().maxzoom<N.getSource().maxzoom)&&(L=N))}),L&&fc.debug(this,L,L.getVisibleCoordinates())),this.options.showPadding&&function(kr){var ln=kr.transform.padding;Eh(kr,kr.transform.height-(ln.top||0),3,Dl),Eh(kr,ln.bottom||0,3,Zf),Fc(kr,ln.left||0,3,jf),Fc(kr,kr.transform.width-(ln.right||0),3,vl);var Nn=kr.transform.centerPoint;(function(zn,Mn,Bi,Qr){cc(zn,Mn-1,Bi-10,2,20,Qr),cc(zn,Mn-10,Bi-1,20,2,Qr)})(kr,Nn.x,kr.transform.height-Nn.y,Vf)}(this),this.context.setDefault()},Va.prototype.renderLayer=function(l,h,c,d){c.isHidden(this.transform.zoom)||(c.type==="background"||c.type==="custom"||d.length)&&(this.id=c.id,this.gpuTimingStart(c),fc[c.type](l,h,c,d,this.style.placement.variableOffsets),this.gpuTimingEnd())},Va.prototype.gpuTimingStart=function(l){if(this.options.gpuTiming){var h=this.context.extTimerQuery,c=this.gpuTimers[l.id];c||(c=this.gpuTimers[l.id]={calls:0,cpuTime:0,query:h.createQueryEXT()}),c.calls++,h.beginQueryEXT(h.TIME_ELAPSED_EXT,c.query)}},Va.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var l=this.context.extTimerQuery;l.endQueryEXT(l.TIME_ELAPSED_EXT)}},Va.prototype.collectGpuTimers=function(){var l=this.gpuTimers;return this.gpuTimers={},l},Va.prototype.queryGpuTimers=function(l){var h={};for(var c in l){var d=l[c],E=this.context.extTimerQuery,w=E.getQueryObjectEXT(d.query,E.QUERY_RESULT_EXT)/1e6;E.deleteQueryEXT(d.query),h[c]=w}return h},Va.prototype.translatePosMatrix=function(l,h,c,d,E){if(!c[0]&&!c[1])return l;var w=E?d==="map"?this.transform.angle:0:d==="viewport"?-this.transform.angle:0;if(w){var P=Math.sin(w),L=Math.cos(w);c=[c[0]*L-c[1]*P,c[0]*P+c[1]*L]}var N=[E?c[0]:Qi(h,c[0],this.transform.zoom),E?c[1]:Qi(h,c[1],this.transform.zoom),0],q=new Float32Array(16);return m.translate(q,l,N),q},Va.prototype.saveTileTexture=function(l){var h=this._tileTextures[l.size[0]];h?h.push(l):this._tileTextures[l.size[0]]=[l]},Va.prototype.getTileTexture=function(l){var h=this._tileTextures[l];return h&&h.length>0?h.pop():null},Va.prototype.isPatternMissing=function(l){if(!l)return!1;if(!l.from||!l.to)return!0;var h=this.imageManager.getPattern(l.from.toString()),c=this.imageManager.getPattern(l.to.toString());return!h||!c},Va.prototype.useProgram=function(l,h){this.cache=this.cache||{};var c=""+l+(h?h.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[c]||(this.cache[c]=new Rc(this.context,l,As[l],h,Ll[l],this._showOverdrawInspector)),this.cache[c]},Va.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},Va.prototype.setBaseState=function(){var l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)},Va.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=m.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new m.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},Va.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var hc=function(l,h){this.points=l,this.planes=h};hc.fromInvProjectionMatrix=function(l,h,c){var d=Math.pow(2,c),E=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(P){return m.transformMat4([],P,l)}).map(function(P){return m.scale$1([],P,1/P[3]/h*d)}),w=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(P){var L=m.sub([],E[P[0]],E[P[1]]),N=m.sub([],E[P[2]],E[P[1]]),q=m.normalize([],m.cross([],L,N)),ce=-m.dot(q,E[P[1]]);return q.concat(ce)});return new hc(E,w)};var ts=function(l,h){this.min=l,this.max=h,this.center=m.scale$2([],m.add([],this.min,this.max),.5)};ts.prototype.quadrant=function(l){for(var h=[l%2==0,l<2],c=m.clone$2(this.min),d=m.clone$2(this.max),E=0;E<h.length;E++)c[E]=h[E]?this.min[E]:this.center[E],d[E]=h[E]?this.center[E]:this.max[E];return d[2]=this.max[2],new ts(c,d)},ts.prototype.distanceX=function(l){return Math.max(Math.min(this.max[0],l[0]),this.min[0])-l[0]},ts.prototype.distanceY=function(l){return Math.max(Math.min(this.max[1],l[1]),this.min[1])-l[1]},ts.prototype.intersects=function(l){for(var h=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],c=!0,d=0;d<l.planes.length;d++){for(var E=l.planes[d],w=0,P=0;P<h.length;P++)w+=m.dot$1(E,h[P])>=0;if(w===0)return 0;w!==h.length&&(c=!1)}if(c)return 2;for(var L=0;L<3;L++){for(var N=Number.MAX_VALUE,q=-Number.MAX_VALUE,ce=0;ce<l.points.length;ce++){var he=l.points[ce][L]-this.min[L];N=Math.min(N,he),q=Math.max(q,he)}if(q<0||N>this.max[L]-this.min[L])return 0}return 1};var Uu=function(l,h,c,d){if(l===void 0&&(l=0),h===void 0&&(h=0),c===void 0&&(c=0),d===void 0&&(d=0),isNaN(l)||l<0||isNaN(h)||h<0||isNaN(c)||c<0||isNaN(d)||d<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=h,this.left=c,this.right=d};Uu.prototype.interpolate=function(l,h,c){return h.top!=null&&l.top!=null&&(this.top=m.number(l.top,h.top,c)),h.bottom!=null&&l.bottom!=null&&(this.bottom=m.number(l.bottom,h.bottom,c)),h.left!=null&&l.left!=null&&(this.left=m.number(l.left,h.left,c)),h.right!=null&&l.right!=null&&(this.right=m.number(l.right,h.right,c)),this},Uu.prototype.getCenter=function(l,h){var c=m.clamp((this.left+l-this.right)/2,0,l),d=m.clamp((this.top+h-this.bottom)/2,0,h);return new m.Point(c,d)},Uu.prototype.equals=function(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right},Uu.prototype.clone=function(){return new Uu(this.top,this.bottom,this.left,this.right)},Uu.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var kn=function(l,h,c,d,E){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=E===void 0||E,this._minZoom=l||0,this._maxZoom=h||22,this._minPitch=c==null?0:c,this._maxPitch=d==null?60:d,this.setMaxBounds(),this.width=0,this.height=0,this._center=new m.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Uu,this._posMatrixCache={},this._alignedPosMatrixCache={}},Ma={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};kn.prototype.clone=function(){var l=new kn(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return l.tileSize=this.tileSize,l.latRange=this.latRange,l.width=this.width,l.height=this.height,l._center=this._center,l.zoom=this.zoom,l.angle=this.angle,l._fov=this._fov,l._pitch=this._pitch,l._unmodified=this._unmodified,l._edgeInsets=this._edgeInsets.clone(),l._calcMatrices(),l},Ma.minZoom.get=function(){return this._minZoom},Ma.minZoom.set=function(l){this._minZoom!==l&&(this._minZoom=l,this.zoom=Math.max(this.zoom,l))},Ma.maxZoom.get=function(){return this._maxZoom},Ma.maxZoom.set=function(l){this._maxZoom!==l&&(this._maxZoom=l,this.zoom=Math.min(this.zoom,l))},Ma.minPitch.get=function(){return this._minPitch},Ma.minPitch.set=function(l){this._minPitch!==l&&(this._minPitch=l,this.pitch=Math.max(this.pitch,l))},Ma.maxPitch.get=function(){return this._maxPitch},Ma.maxPitch.set=function(l){this._maxPitch!==l&&(this._maxPitch=l,this.pitch=Math.min(this.pitch,l))},Ma.renderWorldCopies.get=function(){return this._renderWorldCopies},Ma.renderWorldCopies.set=function(l){l===void 0?l=!0:l===null&&(l=!1),this._renderWorldCopies=l},Ma.worldSize.get=function(){return this.tileSize*this.scale},Ma.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},Ma.size.get=function(){return new m.Point(this.width,this.height)},Ma.bearing.get=function(){return-this.angle/Math.PI*180},Ma.bearing.set=function(l){var h=-m.wrap(l,-180,180)*Math.PI/180;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=m.create$2(),m.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},Ma.pitch.get=function(){return this._pitch/Math.PI*180},Ma.pitch.set=function(l){var h=m.clamp(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())},Ma.fov.get=function(){return this._fov/Math.PI*180},Ma.fov.set=function(l){l=Math.max(.01,Math.min(60,l)),this._fov!==l&&(this._unmodified=!1,this._fov=l/180*Math.PI,this._calcMatrices())},Ma.zoom.get=function(){return this._zoom},Ma.zoom.set=function(l){var h=Math.min(Math.max(l,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._zoom=h,this.scale=this.zoomScale(h),this.tileZoom=Math.floor(h),this.zoomFraction=h-this.tileZoom,this._constrain(),this._calcMatrices())},Ma.center.get=function(){return this._center},Ma.center.set=function(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this._constrain(),this._calcMatrices())},Ma.padding.get=function(){return this._edgeInsets.toJSON()},Ma.padding.set=function(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())},Ma.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},kn.prototype.isPaddingEqual=function(l){return this._edgeInsets.equals(l)},kn.prototype.interpolatePadding=function(l,h,c){this._unmodified=!1,this._edgeInsets.interpolate(l,h,c),this._constrain(),this._calcMatrices()},kn.prototype.coveringZoomLevel=function(l){var h=(l.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/l.tileSize));return Math.max(0,h)},kn.prototype.getVisibleUnwrappedCoordinates=function(l){var h=[new m.UnwrappedTileID(0,l)];if(this._renderWorldCopies)for(var c=this.pointCoordinate(new m.Point(0,0)),d=this.pointCoordinate(new m.Point(this.width,0)),E=this.pointCoordinate(new m.Point(this.width,this.height)),w=this.pointCoordinate(new m.Point(0,this.height)),P=Math.floor(Math.min(c.x,d.x,E.x,w.x)),L=Math.floor(Math.max(c.x,d.x,E.x,w.x)),N=P-1;N<=L+1;N++)N!==0&&h.push(new m.UnwrappedTileID(N,l));return h},kn.prototype.coveringTiles=function(l){var h=this.coveringZoomLevel(l),c=h;if(l.minzoom!==void 0&&h<l.minzoom)return[];l.maxzoom!==void 0&&h>l.maxzoom&&(h=l.maxzoom);var d=m.MercatorCoordinate.fromLngLat(this.center),E=Math.pow(2,h),w=[E*d.x,E*d.y,0],P=hc.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,h),L=l.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(L=h);var N=function(kr){return{aabb:new ts([kr*E,0,0],[(kr+1)*E,E,0]),zoom:0,x:0,y:0,wrap:kr,fullyVisible:!1}},q=[],ce=[],he=h,de=l.reparseOverscaled?c:h;if(this._renderWorldCopies)for(var Re=1;Re<=3;Re++)q.push(N(-Re)),q.push(N(Re));for(q.push(N(0));q.length>0;){var Ie=q.pop(),We=Ie.x,we=Ie.y,Ve=Ie.fullyVisible;if(!Ve){var tt=Ie.aabb.intersects(P);if(tt===0)continue;Ve=tt===2}var yt=Ie.aabb.distanceX(w),Wt=Ie.aabb.distanceY(w),jt=Math.max(Math.abs(yt),Math.abs(Wt));if(Ie.zoom===he||jt>3+(1<<he-Ie.zoom)-2&&Ie.zoom>=L)ce.push({tileID:new m.OverscaledTileID(Ie.zoom===he?de:Ie.zoom,Ie.wrap,Ie.zoom,We,we),distanceSq:m.sqrLen([w[0]-.5-We,w[1]-.5-we])});else for(var Jt=0;Jt<4;Jt++){var dr=(We<<1)+Jt%2,Fr=(we<<1)+(Jt>>1);q.push({aabb:Ie.aabb.quadrant(Jt),zoom:Ie.zoom+1,x:dr,y:Fr,wrap:Ie.wrap,fullyVisible:Ve})}}return ce.sort(function(kr,ln){return kr.distanceSq-ln.distanceSq}).map(function(kr){return kr.tileID})},kn.prototype.resize=function(l,h){this.width=l,this.height=h,this.pixelsToGLUnits=[2/l,-2/h],this._constrain(),this._calcMatrices()},Ma.unmodified.get=function(){return this._unmodified},kn.prototype.zoomScale=function(l){return Math.pow(2,l)},kn.prototype.scaleZoom=function(l){return Math.log(l)/Math.LN2},kn.prototype.project=function(l){var h=m.clamp(l.lat,-this.maxValidLatitude,this.maxValidLatitude);return new m.Point(m.mercatorXfromLng(l.lng)*this.worldSize,m.mercatorYfromLat(h)*this.worldSize)},kn.prototype.unproject=function(l){return new m.MercatorCoordinate(l.x/this.worldSize,l.y/this.worldSize).toLngLat()},Ma.point.get=function(){return this.project(this.center)},kn.prototype.setLocationAtPoint=function(l,h){var c=this.pointCoordinate(h),d=this.pointCoordinate(this.centerPoint),E=this.locationCoordinate(l),w=new m.MercatorCoordinate(E.x-(c.x-d.x),E.y-(c.y-d.y));this.center=this.coordinateLocation(w),this._renderWorldCopies&&(this.center=this.center.wrap())},kn.prototype.locationPoint=function(l){return this.coordinatePoint(this.locationCoordinate(l))},kn.prototype.pointLocation=function(l){return this.coordinateLocation(this.pointCoordinate(l))},kn.prototype.locationCoordinate=function(l){return m.MercatorCoordinate.fromLngLat(l)},kn.prototype.coordinateLocation=function(l){return l.toLngLat()},kn.prototype.pointCoordinate=function(l){var h=[l.x,l.y,0,1],c=[l.x,l.y,1,1];m.transformMat4(h,h,this.pixelMatrixInverse),m.transformMat4(c,c,this.pixelMatrixInverse);var d=h[3],E=c[3],w=h[1]/d,P=c[1]/E,L=h[2]/d,N=c[2]/E,q=L===N?0:(0-L)/(N-L);return new m.MercatorCoordinate(m.number(h[0]/d,c[0]/E,q)/this.worldSize,m.number(w,P,q)/this.worldSize)},kn.prototype.coordinatePoint=function(l){var h=[l.x*this.worldSize,l.y*this.worldSize,0,1];return m.transformMat4(h,h,this.pixelMatrix),new m.Point(h[0]/h[3],h[1]/h[3])},kn.prototype.getBounds=function(){return new m.LngLatBounds().extend(this.pointLocation(new m.Point(0,0))).extend(this.pointLocation(new m.Point(this.width,0))).extend(this.pointLocation(new m.Point(this.width,this.height))).extend(this.pointLocation(new m.Point(0,this.height)))},kn.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new m.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},kn.prototype.setMaxBounds=function(l){l?(this.lngRange=[l.getWest(),l.getEast()],this.latRange=[l.getSouth(),l.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},kn.prototype.calculatePosMatrix=function(l,h){h===void 0&&(h=!1);var c=l.key,d=h?this._alignedPosMatrixCache:this._posMatrixCache;if(d[c])return d[c];var E=l.canonical,w=this.worldSize/this.zoomScale(E.z),P=E.x+Math.pow(2,E.z)*l.wrap,L=m.identity(new Float64Array(16));return m.translate(L,L,[P*w,E.y*w,0]),m.scale(L,L,[w/m.EXTENT,w/m.EXTENT,1]),m.multiply(L,h?this.alignedProjMatrix:this.projMatrix,L),d[c]=new Float32Array(L),d[c]},kn.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},kn.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var l,h,c,d,E=-90,w=90,P=-180,L=180,N=this.size,q=this._unmodified;if(this.latRange){var ce=this.latRange;E=m.mercatorYfromLat(ce[1])*this.worldSize,l=(w=m.mercatorYfromLat(ce[0])*this.worldSize)-E<N.y?N.y/(w-E):0}if(this.lngRange){var he=this.lngRange;P=m.mercatorXfromLng(he[0])*this.worldSize,h=(L=m.mercatorXfromLng(he[1])*this.worldSize)-P<N.x?N.x/(L-P):0}var de=this.point,Re=Math.max(h||0,l||0);if(Re)return this.center=this.unproject(new m.Point(h?(L+P)/2:de.x,l?(w+E)/2:de.y)),this.zoom+=this.scaleZoom(Re),this._unmodified=q,void(this._constraining=!1);if(this.latRange){var Ie=de.y,We=N.y/2;Ie-We<E&&(d=E+We),Ie+We>w&&(d=w-We)}if(this.lngRange){var we=de.x,Ve=N.x/2;we-Ve<P&&(c=P+Ve),we+Ve>L&&(c=L-Ve)}c===void 0&&d===void 0||(this.center=this.unproject(new m.Point(c!==void 0?c:de.x,d!==void 0?d:de.y))),this._unmodified=q,this._constraining=!1}},kn.prototype._calcMatrices=function(){if(this.height){var l=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var h=Math.PI/2+this._pitch,c=this._fov*(.5+l.y/this.height),d=Math.sin(c)*this.cameraToCenterDistance/Math.sin(m.clamp(Math.PI-h-c,.01,Math.PI-.01)),E=this.point,w=E.x,P=E.y,L=1.01*(Math.cos(Math.PI/2-this._pitch)*d+this.cameraToCenterDistance),N=this.height/50,q=new Float64Array(16);m.perspective(q,this._fov,this.width/this.height,N,L),q[8]=2*-l.x/this.width,q[9]=2*l.y/this.height,m.scale(q,q,[1,-1,1]),m.translate(q,q,[0,0,-this.cameraToCenterDistance]),m.rotateX(q,q,this._pitch),m.rotateZ(q,q,this.angle),m.translate(q,q,[-w,-P,0]),this.mercatorMatrix=m.scale([],q,[this.worldSize,this.worldSize,this.worldSize]),m.scale(q,q,[1,1,m.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=q,this.invProjMatrix=m.invert([],this.projMatrix);var ce=this.width%2/2,he=this.height%2/2,de=Math.cos(this.angle),Re=Math.sin(this.angle),Ie=w-Math.round(w)+de*ce+Re*he,We=P-Math.round(P)+de*he+Re*ce,we=new Float64Array(q);if(m.translate(we,we,[Ie>.5?Ie-1:Ie,We>.5?We-1:We,0]),this.alignedProjMatrix=we,q=m.create(),m.scale(q,q,[this.width/2,-this.height/2,1]),m.translate(q,q,[1,-1,0]),this.labelPlaneMatrix=q,q=m.create(),m.scale(q,q,[1,-1,1]),m.translate(q,q,[-1,-1,0]),m.scale(q,q,[2/this.width,2/this.height,1]),this.glCoordMatrix=q,this.pixelMatrix=m.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(q=m.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=q,this._posMatrixCache={},this._alignedPosMatrixCache={}}},kn.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var l=this.pointCoordinate(new m.Point(0,0)),h=[l.x*this.worldSize,l.y*this.worldSize,0,1];return m.transformMat4(h,h,this.pixelMatrix)[3]/this.cameraToCenterDistance},kn.prototype.getCameraPoint=function(){var l=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new m.Point(0,l))},kn.prototype.getCameraQueryGeometry=function(l){var h=this.getCameraPoint();if(l.length===1)return[l[0],h];for(var c=h.x,d=h.y,E=h.x,w=h.y,P=0,L=l;P<L.length;P+=1){var N=L[P];c=Math.min(c,N.x),d=Math.min(d,N.y),E=Math.max(E,N.x),w=Math.max(w,N.y)}return[new m.Point(c,d),new m.Point(E,d),new m.Point(E,w),new m.Point(c,w),new m.Point(c,d)]},Object.defineProperties(kn.prototype,Ma);var Ws=function(l){var h,c,d,E;this._hashName=l&&encodeURIComponent(l),m.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(h=this._updateHashUnthrottled.bind(this),c=!1,d=null,E=function(){d=null,c&&(h(),d=setTimeout(E,300),c=!1)},function(){return c=!0,d||E(),d})};Ws.prototype.addTo=function(l){return this._map=l,m.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},Ws.prototype.remove=function(){return m.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},Ws.prototype.getHashString=function(l){var h=this._map.getCenter(),c=Math.round(100*this._map.getZoom())/100,d=Math.ceil((c*Math.LN2+Math.log(512/360/.5))/Math.LN10),E=Math.pow(10,d),w=Math.round(h.lng*E)/E,P=Math.round(h.lat*E)/E,L=this._map.getBearing(),N=this._map.getPitch(),q="";if(q+=l?"/"+w+"/"+P+"/"+c:c+"/"+P+"/"+w,(L||N)&&(q+="/"+Math.round(10*L)/10),N&&(q+="/"+Math.round(N)),this._hashName){var ce=this._hashName,he=!1,de=m.window.location.hash.slice(1).split("&").map(function(Re){var Ie=Re.split("=")[0];return Ie===ce?(he=!0,Ie+"="+q):Re}).filter(function(Re){return Re});return he||de.push(ce+"="+q),"#"+de.join("&")}return"#"+q},Ws.prototype._getCurrentHash=function(){var l,h=this,c=m.window.location.hash.replace("#","");return this._hashName?(c.split("&").map(function(d){return d.split("=")}).forEach(function(d){d[0]===h._hashName&&(l=d)}),(l&&l[1]||"").split("/")):c.split("/")},Ws.prototype._onHashChange=function(){var l=this._getCurrentHash();if(l.length>=3&&!l.some(function(c){return isNaN(c)})){var h=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(l[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:h,pitch:+(l[4]||0)}),!0}return!1},Ws.prototype._updateHashUnthrottled=function(){var l=m.window.location.href.replace(/(#.+)?$/,this.getHashString());try{m.window.history.replaceState(m.window.history.state,null,l)}catch(h){}};var Bc={linearity:.3,easing:m.bezier(0,0,.3,1)},Zu=m.extend({deceleration:2500,maxSpeed:1400},Bc),Nc=m.extend({deceleration:20,maxSpeed:1400},Bc),rp=m.extend({deceleration:1e3,maxSpeed:360},Bc),lo=m.extend({deceleration:1e3,maxSpeed:90},Bc),ju=function(l){this._map=l,this.clear()};function Su(l,h){(!l.duration||l.duration<h.duration)&&(l.duration=h.duration,l.easing=h.easing)}function tu(l,h,c){var d=c.maxSpeed,E=c.linearity,w=c.deceleration,P=m.clamp(l*E/(h/1e3),-d,d),L=Math.abs(P)/(w*E);return{easing:c.easing,duration:1e3*L,amount:P*(L/2)}}ju.prototype.clear=function(){this._inertiaBuffer=[]},ju.prototype.record=function(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:m.browser.now(),settings:l})},ju.prototype._drainInertiaBuffer=function(){for(var l=this._inertiaBuffer,h=m.browser.now();l.length>0&&h-l[0].time>160;)l.shift()},ju.prototype._onMoveEnd=function(l){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var h={zoom:0,bearing:0,pitch:0,pan:new m.Point(0,0),pinchAround:void 0,around:void 0},c=0,d=this._inertiaBuffer;c<d.length;c+=1){var E=d[c].settings;h.zoom+=E.zoomDelta||0,h.bearing+=E.bearingDelta||0,h.pitch+=E.pitchDelta||0,E.panDelta&&h.pan._add(E.panDelta),E.around&&(h.around=E.around),E.pinchAround&&(h.pinchAround=E.pinchAround)}var w=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,P={};if(h.pan.mag()){var L=tu(h.pan.mag(),w,m.extend({},Zu,l||{}));P.offset=h.pan.mult(L.amount/h.pan.mag()),P.center=this._map.transform.center,Su(P,L)}if(h.zoom){var N=tu(h.zoom,w,Nc);P.zoom=this._map.transform.zoom+N.amount,Su(P,N)}if(h.bearing){var q=tu(h.bearing,w,rp);P.bearing=this._map.transform.bearing+m.clamp(q.amount,-179,179),Su(P,q)}if(h.pitch){var ce=tu(h.pitch,w,lo);P.pitch=this._map.transform.pitch+ce.amount,Su(P,ce)}if(P.zoom||P.bearing){var he=h.pinchAround===void 0?h.around:h.pinchAround;P.around=he?this._map.unproject(he):this._map.getCenter()}return this.clear(),m.extend(P,{noMoveStart:!0})}};var Do=function(l){function h(d,E,w,P){P===void 0&&(P={});var L=Z.mousePos(E.getCanvasContainer(),w),N=E.unproject(L);l.call(this,d,m.extend({point:L,lngLat:N,originalEvent:w},P)),this._defaultPrevented=!1,this.target=E}l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h;var c={defaultPrevented:{configurable:!0}};return h.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(h.prototype,c),h}(m.Event),Fl=function(l){function h(d,E,w){var P=d==="touchend"?w.changedTouches:w.touches,L=Z.touchPos(E.getCanvasContainer(),P),N=L.map(function(he){return E.unproject(he)}),q=L.reduce(function(he,de,Re,Ie){return he.add(de.div(Ie.length))},new m.Point(0,0)),ce=E.unproject(q);l.call(this,d,{points:L,point:q,lngLats:N,lngLat:ce,originalEvent:w}),this._defaultPrevented=!1}l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h;var c={defaultPrevented:{configurable:!0}};return h.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(h.prototype,c),h}(m.Event),ml=function(l){function h(d,E,w){l.call(this,d,{originalEvent:w}),this._defaultPrevented=!1}l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h;var c={defaultPrevented:{configurable:!0}};return h.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(h.prototype,c),h}(m.Event),ho=function(l,h){this._map=l,this._clickTolerance=h.clickTolerance};ho.prototype.reset=function(){delete this._mousedownPos},ho.prototype.wheel=function(l){return this._firePreventable(new ml(l.type,this._map,l))},ho.prototype.mousedown=function(l,h){return this._mousedownPos=h,this._firePreventable(new Do(l.type,this._map,l))},ho.prototype.mouseup=function(l){this._map.fire(new Do(l.type,this._map,l))},ho.prototype.click=function(l,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||this._map.fire(new Do(l.type,this._map,l))},ho.prototype.dblclick=function(l){return this._firePreventable(new Do(l.type,this._map,l))},ho.prototype.mouseover=function(l){this._map.fire(new Do(l.type,this._map,l))},ho.prototype.mouseout=function(l){this._map.fire(new Do(l.type,this._map,l))},ho.prototype.touchstart=function(l){return this._firePreventable(new Fl(l.type,this._map,l))},ho.prototype.touchmove=function(l){this._map.fire(new Fl(l.type,this._map,l))},ho.prototype.touchend=function(l){this._map.fire(new Fl(l.type,this._map,l))},ho.prototype.touchcancel=function(l){this._map.fire(new Fl(l.type,this._map,l))},ho.prototype._firePreventable=function(l){if(this._map.fire(l),l.defaultPrevented)return{}},ho.prototype.isEnabled=function(){return!0},ho.prototype.isActive=function(){return!1},ho.prototype.enable=function(){},ho.prototype.disable=function(){};var yn=function(l){this._map=l};yn.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},yn.prototype.mousemove=function(l){this._map.fire(new Do(l.type,this._map,l))},yn.prototype.mousedown=function(){this._delayContextMenu=!0},yn.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Do("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},yn.prototype.contextmenu=function(l){this._delayContextMenu?this._contextMenuEvent=l:this._map.fire(new Do(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()},yn.prototype.isEnabled=function(){return!0},yn.prototype.isActive=function(){return!1},yn.prototype.enable=function(){},yn.prototype.disable=function(){};var qa=function(l,h){this._map=l,this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=h.clickTolerance||1};function nl(l,h){for(var c={},d=0;d<l.length;d++)c[l[d].identifier]=h[d];return c}qa.prototype.isEnabled=function(){return!!this._enabled},qa.prototype.isActive=function(){return!!this._active},qa.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},qa.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},qa.prototype.mousedown=function(l,h){this.isEnabled()&&l.shiftKey&&l.button===0&&(Z.disableDrag(),this._startPos=this._lastPos=h,this._active=!0)},qa.prototype.mousemoveWindow=function(l,h){if(this._active){var c=h;if(!(this._lastPos.equals(c)||!this._box&&c.dist(this._startPos)<this._clickTolerance)){var d=this._startPos;this._lastPos=c,this._box||(this._box=Z.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",l));var E=Math.min(d.x,c.x),w=Math.max(d.x,c.x),P=Math.min(d.y,c.y),L=Math.max(d.y,c.y);Z.setTransform(this._box,"translate("+E+"px,"+P+"px)"),this._box.style.width=w-E+"px",this._box.style.height=L-P+"px"}}},qa.prototype.mouseupWindow=function(l,h){var c=this;if(this._active&&l.button===0){var d=this._startPos,E=h;if(this.reset(),Z.suppressClick(),d.x!==E.x||d.y!==E.y)return this._map.fire(new m.Event("boxzoomend",{originalEvent:l})),{cameraAnimation:function(w){return w.fitScreenCoordinates(d,E,c._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",l)}},qa.prototype.keydown=function(l){this._active&&l.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",l))},qa.prototype.blur=function(){this.reset()},qa.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(Z.remove(this._box),this._box=null),Z.enableDrag(),delete this._startPos,delete this._lastPos},qa.prototype._fireEvent=function(l,h){return this._map.fire(new m.Event(l,{originalEvent:h}))};var pc=function(l){this.reset(),this.numTouches=l.numTouches};pc.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},pc.prototype.touchstart=function(l,h,c){(this.centroid||c.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=l.timeStamp),c.length===this.numTouches&&(this.centroid=function(d){for(var E=new m.Point(0,0),w=0,P=d;w<P.length;w+=1)E._add(P[w]);return E.div(d.length)}(h),this.touches=nl(c,h)))},pc.prototype.touchmove=function(l,h,c){if(!this.aborted&&this.centroid){var d=nl(c,h);for(var E in this.touches){var w=d[E];(!w||w.dist(this.touches[E])>30)&&(this.aborted=!0)}}},pc.prototype.touchend=function(l,h,c){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),c.length===0){var d=!this.aborted&&this.centroid;if(this.reset(),d)return d}};var uu=function(l){this.singleTap=new pc(l),this.numTaps=l.numTaps,this.reset()};uu.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},uu.prototype.touchstart=function(l,h,c){this.singleTap.touchstart(l,h,c)},uu.prototype.touchmove=function(l,h,c){this.singleTap.touchmove(l,h,c)},uu.prototype.touchend=function(l,h,c){var d=this.singleTap.touchend(l,h,c);if(d){var E=l.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(d)<30;if(E&&w||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=d,this.count===this.numTaps)return this.reset(),d}};var na=function(){this._zoomIn=new uu({numTouches:1,numTaps:2}),this._zoomOut=new uu({numTouches:2,numTaps:1}),this.reset()};na.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},na.prototype.touchstart=function(l,h,c){this._zoomIn.touchstart(l,h,c),this._zoomOut.touchstart(l,h,c)},na.prototype.touchmove=function(l,h,c){this._zoomIn.touchmove(l,h,c),this._zoomOut.touchmove(l,h,c)},na.prototype.touchend=function(l,h,c){var d=this,E=this._zoomIn.touchend(l,h,c),w=this._zoomOut.touchend(l,h,c);return E?(this._active=!0,l.preventDefault(),setTimeout(function(){return d.reset()},0),{cameraAnimation:function(P){return P.easeTo({duration:300,zoom:P.getZoom()+1,around:P.unproject(E)},{originalEvent:l})}}):w?(this._active=!0,l.preventDefault(),setTimeout(function(){return d.reset()},0),{cameraAnimation:function(P){return P.easeTo({duration:300,zoom:P.getZoom()-1,around:P.unproject(w)},{originalEvent:l})}}):void 0},na.prototype.touchcancel=function(){this.reset()},na.prototype.enable=function(){this._enabled=!0},na.prototype.disable=function(){this._enabled=!1,this.reset()},na.prototype.isEnabled=function(){return this._enabled},na.prototype.isActive=function(){return this._active};var hf={0:1,2:2},Kr=function(l){this.reset(),this._clickTolerance=l.clickTolerance||1};Kr.prototype.blur=function(){this.reset()},Kr.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},Kr.prototype._correctButton=function(l,h){return!1},Kr.prototype._move=function(l,h){return{}},Kr.prototype.mousedown=function(l,h){if(!this._lastPoint){var c=Z.mouseButton(l);this._correctButton(l,c)&&(this._lastPoint=h,this._eventButton=c)}},Kr.prototype.mousemoveWindow=function(l,h){var c=this._lastPoint;if(c){if(l.preventDefault(),function(d,E){var w=hf[E];return d.buttons===void 0||(d.buttons&w)!==w}(l,this._eventButton))this.reset();else if(this._moved||!(h.dist(c)<this._clickTolerance))return this._moved=!0,this._lastPoint=h,this._move(c,h)}},Kr.prototype.mouseupWindow=function(l){this._lastPoint&&Z.mouseButton(l)===this._eventButton&&(this._moved&&Z.suppressClick(),this.reset())},Kr.prototype.enable=function(){this._enabled=!0},Kr.prototype.disable=function(){this._enabled=!1,this.reset()},Kr.prototype.isEnabled=function(){return this._enabled},Kr.prototype.isActive=function(){return this._active};var zc=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.mousedown=function(c,d){l.prototype.mousedown.call(this,c,d),this._lastPoint&&(this._active=!0)},h.prototype._correctButton=function(c,d){return d===0&&!c.ctrlKey},h.prototype._move=function(c,d){return{around:d,panDelta:d.sub(c)}},h}(Kr),pf=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype._correctButton=function(c,d){return d===0&&c.ctrlKey||d===2},h.prototype._move=function(c,d){var E=.8*(d.x-c.x);if(E)return this._active=!0,{bearingDelta:E}},h.prototype.contextmenu=function(c){c.preventDefault()},h}(Kr),gl=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype._correctButton=function(c,d){return d===0&&c.ctrlKey||d===2},h.prototype._move=function(c,d){var E=-.5*(d.y-c.y);if(E)return this._active=!0,{pitchDelta:E}},h.prototype.contextmenu=function(c){c.preventDefault()},h}(Kr),Ea=function(l){this._minTouches=1,this._clickTolerance=l.clickTolerance||1,this.reset()};Ea.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new m.Point(0,0)},Ea.prototype.touchstart=function(l,h,c){return this._calculateTransform(l,h,c)},Ea.prototype.touchmove=function(l,h,c){if(this._active&&!(c.length<this._minTouches))return l.preventDefault(),this._calculateTransform(l,h,c)},Ea.prototype.touchend=function(l,h,c){this._calculateTransform(l,h,c),this._active&&c.length<this._minTouches&&this.reset()},Ea.prototype.touchcancel=function(){this.reset()},Ea.prototype._calculateTransform=function(l,h,c){c.length>0&&(this._active=!0);var d=nl(c,h),E=new m.Point(0,0),w=new m.Point(0,0),P=0;for(var L in d){var N=d[L],q=this._touches[L];q&&(E._add(N),w._add(N.sub(q)),P++,d[L]=N)}if(this._touches=d,!(P<this._minTouches)&&w.mag()){var ce=w.div(P);if(this._sum._add(ce),!(this._sum.mag()<this._clickTolerance))return{around:E.div(P),panDelta:ce}}},Ea.prototype.enable=function(){this._enabled=!0},Ea.prototype.disable=function(){this._enabled=!1,this.reset()},Ea.prototype.isEnabled=function(){return this._enabled},Ea.prototype.isActive=function(){return this._active};var ms=function(){this.reset()};function Uc(l,h,c){for(var d=0;d<l.length;d++)if(l[d].identifier===c)return h[d]}function Cu(l,h){return Math.log(l/h)/Math.LN2}ms.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},ms.prototype._start=function(l){},ms.prototype._move=function(l,h,c){return{}},ms.prototype.touchstart=function(l,h,c){this._firstTwoTouches||c.length<2||(this._firstTwoTouches=[c[0].identifier,c[1].identifier],this._start([h[0],h[1]]))},ms.prototype.touchmove=function(l,h,c){if(this._firstTwoTouches){l.preventDefault();var d=this._firstTwoTouches,E=d[1],w=Uc(c,h,d[0]),P=Uc(c,h,E);if(w&&P){var L=this._aroundCenter?null:w.add(P).div(2);return this._move([w,P],L,l)}}},ms.prototype.touchend=function(l,h,c){if(this._firstTwoTouches){var d=this._firstTwoTouches,E=d[1],w=Uc(c,h,d[0]),P=Uc(c,h,E);w&&P||(this._active&&Z.suppressClick(),this.reset())}},ms.prototype.touchcancel=function(){this.reset()},ms.prototype.enable=function(l){this._enabled=!0,this._aroundCenter=!!l&&l.around==="center"},ms.prototype.disable=function(){this._enabled=!1,this.reset()},ms.prototype.isEnabled=function(){return this._enabled},ms.prototype.isActive=function(){return this._active};var ks=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.reset=function(){l.prototype.reset.call(this),delete this._distance,delete this._startDistance},h.prototype._start=function(c){this._startDistance=this._distance=c[0].dist(c[1])},h.prototype._move=function(c,d){var E=this._distance;if(this._distance=c[0].dist(c[1]),this._active||!(Math.abs(Cu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Cu(this._distance,E),pinchAround:d}},h}(ms);function Vu(l,h){return 180*l.angleWith(h)/Math.PI}var Zc=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.reset=function(){l.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},h.prototype._start=function(c){this._startVector=this._vector=c[0].sub(c[1]),this._minDiameter=c[0].dist(c[1])},h.prototype._move=function(c,d){var E=this._vector;if(this._vector=c[0].sub(c[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Vu(this._vector,E),pinchAround:d}},h.prototype._isBelowThreshold=function(c){this._minDiameter=Math.min(this._minDiameter,c.mag());var d=25/(Math.PI*this._minDiameter)*360,E=Vu(c,this._startVector);return Math.abs(E)<d},h}(ms);function Bl(l){return Math.abs(l.y)>Math.abs(l.x)}var Gf=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.reset=function(){l.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},h.prototype._start=function(c){this._lastPoints=c,Bl(c[0].sub(c[1]))&&(this._valid=!1)},h.prototype._move=function(c,d,E){var w=c[0].sub(this._lastPoints[0]),P=c[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(w,P,E.timeStamp),this._valid)return this._lastPoints=c,this._active=!0,{pitchDelta:(w.y+P.y)/2*-.5}},h.prototype.gestureBeginsVertically=function(c,d,E){if(this._valid!==void 0)return this._valid;var w=c.mag()>=2,P=d.mag()>=2;if(w||P){if(!w||!P)return this._firstMove===void 0&&(this._firstMove=E),E-this._firstMove<100&&void 0;var L=c.y>0==d.y>0;return Bl(c)&&Bl(d)&&L}},h}(ms),Hf={panStep:100,bearingStep:15,pitchStep:10},Ds=function(){var l=Hf;this._panStep=l.panStep,this._bearingStep=l.bearingStep,this._pitchStep=l.pitchStep,this._rotationDisabled=!1};function Fs(l){return l*(2-l)}Ds.prototype.blur=function(){this.reset()},Ds.prototype.reset=function(){this._active=!1},Ds.prototype.keydown=function(l){var h=this;if(!(l.altKey||l.ctrlKey||l.metaKey)){var c=0,d=0,E=0,w=0,P=0;switch(l.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:l.shiftKey?d=-1:(l.preventDefault(),w=-1);break;case 39:l.shiftKey?d=1:(l.preventDefault(),w=1);break;case 38:l.shiftKey?E=1:(l.preventDefault(),P=-1);break;case 40:l.shiftKey?E=-1:(l.preventDefault(),P=1);break;default:return}return this._rotationDisabled&&(d=0,E=0),{cameraAnimation:function(L){var N=L.getZoom();L.easeTo({duration:300,easeId:"keyboardHandler",easing:Fs,zoom:c?Math.round(N)+c*(l.shiftKey?2:1):N,bearing:L.getBearing()+d*h._bearingStep,pitch:L.getPitch()+E*h._pitchStep,offset:[-w*h._panStep,-P*h._panStep],center:L.getCenter()},{originalEvent:l})}}}},Ds.prototype.enable=function(){this._enabled=!0},Ds.prototype.disable=function(){this._enabled=!1,this.reset()},Ds.prototype.isEnabled=function(){return this._enabled},Ds.prototype.isActive=function(){return this._active},Ds.prototype.disableRotation=function(){this._rotationDisabled=!0},Ds.prototype.enableRotation=function(){this._rotationDisabled=!1};var Fi=function(l,h){this._map=l,this._el=l.getCanvasContainer(),this._handler=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,m.bindAll(["_onTimeout"],this)};Fi.prototype.setZoomRate=function(l){this._defaultZoomRate=l},Fi.prototype.setWheelZoomRate=function(l){this._wheelZoomRate=l},Fi.prototype.isEnabled=function(){return!!this._enabled},Fi.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},Fi.prototype.isZooming=function(){return!!this._zooming},Fi.prototype.enable=function(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=l&&l.around==="center")},Fi.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Fi.prototype.wheel=function(l){if(this.isEnabled()){var h=l.deltaMode===m.window.WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY,c=m.browser.now(),d=c-(this._lastWheelEventTime||0);this._lastWheelEventTime=c,h!==0&&h%4.000244140625==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":d>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(d*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),l.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=l,this._delta-=h,this._active||this._start(l)),l.preventDefault()}},Fi.prototype._onTimeout=function(l){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},Fi.prototype._start=function(l){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var h=Z.mousePos(this._el,l);this._around=m.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(h)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},Fi.prototype.renderFrame=function(){var l=this;if(this._frameId&&(this._frameId=null,this.isActive())){var h=this._map.transform;if(this._delta!==0){var c=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,d=2/(1+Math.exp(-Math.abs(this._delta*c)));this._delta<0&&d!==0&&(d=1/d);var E=typeof this._targetZoom=="number"?h.zoomScale(this._targetZoom):h.scale;this._targetZoom=Math.min(h.maxZoom,Math.max(h.minZoom,h.scaleZoom(E*d))),this._type==="wheel"&&(this._startZoom=h.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var w,P=typeof this._targetZoom=="number"?this._targetZoom:h.zoom,L=this._startZoom,N=this._easing,q=!1;if(this._type==="wheel"&&L&&N){var ce=Math.min((m.browser.now()-this._lastWheelEventTime)/200,1),he=N(ce);w=m.number(L,P,he),ce<1?this._frameId||(this._frameId=!0):q=!0}else w=P,q=!0;return this._active=!0,q&&(this._active=!1,this._finishTimeout=setTimeout(function(){l._zooming=!1,l._handler._triggerRenderFrame(),delete l._targetZoom,delete l._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!q,zoomDelta:w-h.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},Fi.prototype._smoothOutEasing=function(l){var h=m.ease;if(this._prevEase){var c=this._prevEase,d=(m.browser.now()-c.start)/c.duration,E=c.easing(d+.01)-c.easing(d),w=.27/Math.sqrt(E*E+1e-4)*.01,P=Math.sqrt(.0729-w*w);h=m.bezier(w,P,.25,1)}return this._prevEase={start:m.browser.now(),duration:l,easing:h},h},Fi.prototype.blur=function(){this.reset()},Fi.prototype.reset=function(){this._active=!1};var Au=function(l,h){this._clickZoom=l,this._tapZoom=h};Au.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},Au.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},Au.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},Au.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var wu=function(){this.reset()};wu.prototype.reset=function(){this._active=!1},wu.prototype.blur=function(){this.reset()},wu.prototype.dblclick=function(l,h){return l.preventDefault(),{cameraAnimation:function(c){c.easeTo({duration:300,zoom:c.getZoom()+(l.shiftKey?-1:1),around:c.unproject(h)},{originalEvent:l})}}},wu.prototype.enable=function(){this._enabled=!0},wu.prototype.disable=function(){this._enabled=!1,this.reset()},wu.prototype.isEnabled=function(){return this._enabled},wu.prototype.isActive=function(){return this._active};var rs=function(){this._tap=new uu({numTouches:1,numTaps:1}),this.reset()};rs.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},rs.prototype.touchstart=function(l,h,c){this._swipePoint||(this._tapTime&&l.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?c.length>0&&(this._swipePoint=h[0],this._swipeTouch=c[0].identifier):this._tap.touchstart(l,h,c))},rs.prototype.touchmove=function(l,h,c){if(this._tapTime){if(this._swipePoint){if(c[0].identifier!==this._swipeTouch)return;var d=h[0],E=d.y-this._swipePoint.y;return this._swipePoint=d,l.preventDefault(),this._active=!0,{zoomDelta:E/128}}}else this._tap.touchmove(l,h,c)},rs.prototype.touchend=function(l,h,c){this._tapTime?this._swipePoint&&c.length===0&&this.reset():this._tap.touchend(l,h,c)&&(this._tapTime=l.timeStamp)},rs.prototype.touchcancel=function(){this.reset()},rs.prototype.enable=function(){this._enabled=!0},rs.prototype.disable=function(){this._enabled=!1,this.reset()},rs.prototype.isEnabled=function(){return this._enabled},rs.prototype.isActive=function(){return this._active};var Gu=function(l,h,c){this._el=l,this._mousePan=h,this._touchPan=c};Gu.prototype.enable=function(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},Gu.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},Gu.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},Gu.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var Tu=function(l,h,c){this._pitchWithRotate=l.pitchWithRotate,this._mouseRotate=h,this._mousePitch=c};Tu.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},Tu.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},Tu.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},Tu.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var Xs=function(l,h,c,d){this._el=l,this._touchZoom=h,this._touchRotate=c,this._tapDragZoom=d,this._rotationDisabled=!1,this._enabled=!0};Xs.prototype.enable=function(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},Xs.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},Xs.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},Xs.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},Xs.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},Xs.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var gs=function(l){return l.zoom||l.drag||l.pitch||l.rotate},Mu=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h}(m.Event);function Rn(l){return l.panDelta&&l.panDelta.mag()||l.zoomDelta||l.bearingDelta||l.pitchDelta}var Cn=function(l,h){this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new ju(l),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(h),m.bindAll(["handleEvent","handleWindowEvent"],this);var c=this._el;this._listeners=[[c,"touchstart",{passive:!0}],[c,"touchmove",{passive:!1}],[c,"touchend",void 0],[c,"touchcancel",void 0],[c,"mousedown",void 0],[c,"mousemove",void 0],[c,"mouseup",void 0],[m.window.document,"mousemove",{capture:!0}],[m.window.document,"mouseup",void 0],[c,"mouseover",void 0],[c,"mouseout",void 0],[c,"dblclick",void 0],[c,"click",void 0],[c,"keydown",{capture:!1}],[c,"keyup",void 0],[c,"wheel",{passive:!1}],[c,"contextmenu",void 0],[m.window,"blur",void 0]];for(var d=0,E=this._listeners;d<E.length;d+=1){var w=E[d],P=w[0];Z.addEventListener(P,w[1],P===m.window.document?this.handleWindowEvent:this.handleEvent,w[2])}};Cn.prototype.destroy=function(){for(var l=0,h=this._listeners;l<h.length;l+=1){var c=h[l],d=c[0];Z.removeEventListener(d,c[1],d===m.window.document?this.handleWindowEvent:this.handleEvent,c[2])}},Cn.prototype._addDefaultHandlers=function(l){var h=this._map,c=h.getCanvasContainer();this._add("mapEvent",new ho(h,l));var d=h.boxZoom=new qa(h,l);this._add("boxZoom",d);var E=new na,w=new wu;h.doubleClickZoom=new Au(w,E),this._add("tapZoom",E),this._add("clickZoom",w);var P=new rs;this._add("tapDragZoom",P);var L=h.touchPitch=new Gf;this._add("touchPitch",L);var N=new pf(l),q=new gl(l);h.dragRotate=new Tu(l,N,q),this._add("mouseRotate",N,["mousePitch"]),this._add("mousePitch",q,["mouseRotate"]);var ce=new zc(l),he=new Ea(l);h.dragPan=new Gu(c,ce,he),this._add("mousePan",ce),this._add("touchPan",he,["touchZoom","touchRotate"]);var de=new Zc,Re=new ks;h.touchZoomRotate=new Xs(c,Re,de,P),this._add("touchRotate",de,["touchPan","touchZoom"]),this._add("touchZoom",Re,["touchPan","touchRotate"]);var Ie=h.scrollZoom=new Fi(h,this);this._add("scrollZoom",Ie,["mousePan"]);var We=h.keyboard=new Ds;this._add("keyboard",We),this._add("blockableMapEvent",new yn(h));for(var we=0,Ve=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];we<Ve.length;we+=1){var tt=Ve[we];l.interactive&&l[tt]&&h[tt].enable(l[tt])}},Cn.prototype._add=function(l,h,c){this._handlers.push({handlerName:l,handler:h,allowed:c}),this._handlersById[l]=h},Cn.prototype.stop=function(l){if(!this._updatingCamera){for(var h=0,c=this._handlers;h<c.length;h+=1)c[h].handler.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[]}},Cn.prototype.isActive=function(){for(var l=0,h=this._handlers;l<h.length;l+=1)if(h[l].handler.isActive())return!0;return!1},Cn.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},Cn.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},Cn.prototype.isMoving=function(){return Boolean(gs(this._eventsInProgress))||this.isZooming()},Cn.prototype._blockedByActive=function(l,h,c){for(var d in l)if(d!==c&&(!h||h.indexOf(d)<0))return!0;return!1},Cn.prototype.handleWindowEvent=function(l){this.handleEvent(l,l.type+"Window")},Cn.prototype._getMapTouches=function(l){for(var h=[],c=0,d=l;c<d.length;c+=1){var E=d[c];this._el.contains(E.target)&&h.push(E)}return h},Cn.prototype.handleEvent=function(l,h){this._updatingCamera=!0;for(var c=l.type==="renderFrame"?void 0:l,d={needsRenderFrame:!1},E={},w={},P=l.touches?this._getMapTouches(l.touches):void 0,L=P?Z.touchPos(this._el,P):Z.mousePos(this._el,l),N=0,q=this._handlers;N<q.length;N+=1){var ce=q[N],he=ce.handlerName,de=ce.handler,Re=ce.allowed;if(de.isEnabled()){var Ie=void 0;this._blockedByActive(w,Re,he)?de.reset():de[h||l.type]&&(Ie=de[h||l.type](l,L,P),this.mergeHandlerResult(d,E,Ie,he,c),Ie&&Ie.needsRenderFrame&&this._triggerRenderFrame()),(Ie||de.isActive())&&(w[he]=de)}}var We={};for(var we in this._previousActiveHandlers)w[we]||(We[we]=c);this._previousActiveHandlers=w,(Object.keys(We).length||Rn(d))&&(this._changes.push([d,E,We]),this._triggerRenderFrame()),(Object.keys(w).length||Rn(d))&&this._map._stop(!0),this._updatingCamera=!1;var Ve=d.cameraAnimation;Ve&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Ve(this._map))},Cn.prototype.mergeHandlerResult=function(l,h,c,d,E){if(c){m.extend(l,c);var w={handlerName:d,originalEvent:c.originalEvent||E};c.zoomDelta!==void 0&&(h.zoom=w),c.panDelta!==void 0&&(h.drag=w),c.pitchDelta!==void 0&&(h.pitch=w),c.bearingDelta!==void 0&&(h.rotate=w)}},Cn.prototype._applyChanges=function(){for(var l={},h={},c={},d=0,E=this._changes;d<E.length;d+=1){var w=E[d],P=w[0],L=w[1],N=w[2];P.panDelta&&(l.panDelta=(l.panDelta||new m.Point(0,0))._add(P.panDelta)),P.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+P.zoomDelta),P.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+P.bearingDelta),P.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+P.pitchDelta),P.around!==void 0&&(l.around=P.around),P.pinchAround!==void 0&&(l.pinchAround=P.pinchAround),P.noInertia&&(l.noInertia=P.noInertia),m.extend(h,L),m.extend(c,N)}this._updateMapTransform(l,h,c),this._changes=[]},Cn.prototype._updateMapTransform=function(l,h,c){var d=this._map,E=d.transform;if(!Rn(l))return this._fireEvents(h,c,!0);var w=l.panDelta,P=l.zoomDelta,L=l.bearingDelta,N=l.pitchDelta,q=l.around,ce=l.pinchAround;ce!==void 0&&(q=ce),d._stop(!0),q=q||d.transform.centerPoint;var he=E.pointLocation(w?q.sub(w):q);L&&(E.bearing+=L),N&&(E.pitch+=N),P&&(E.zoom+=P),E.setLocationAtPoint(he,q),this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(h,c,!0)},Cn.prototype._fireEvents=function(l,h,c){var d=this,E=gs(this._eventsInProgress),w=gs(l),P={};for(var L in l)this._eventsInProgress[L]||(P[L+"start"]=l[L].originalEvent),this._eventsInProgress[L]=l[L];for(var N in!E&&w&&this._fireEvent("movestart",w.originalEvent),P)this._fireEvent(N,P[N]);for(var q in w&&this._fireEvent("move",w.originalEvent),l)this._fireEvent(q,l[q].originalEvent);var ce,he={};for(var de in this._eventsInProgress){var Re=this._eventsInProgress[de],Ie=Re.handlerName,We=Re.originalEvent;this._handlersById[Ie].isActive()||(delete this._eventsInProgress[de],he[de+"end"]=ce=h[Ie]||We)}for(var we in he)this._fireEvent(we,he[we]);var Ve=gs(this._eventsInProgress);if(c&&(E||w)&&!Ve){this._updatingCamera=!0;var tt=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),yt=function(Wt){return Wt!==0&&-d._bearingSnap<Wt&&Wt<d._bearingSnap};tt?(yt(tt.bearing||this._map.getBearing())&&(tt.bearing=0),this._map.easeTo(tt,{originalEvent:ce})):(this._map.fire(new m.Event("moveend",{originalEvent:ce})),yt(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},Cn.prototype._fireEvent=function(l,h){this._map.fire(new m.Event(l,h?{originalEvent:h}:{}))},Cn.prototype._requestFrame=function(){var l=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(h){delete l._frameId,l.handleEvent(new Mu("renderFrame",{timeStamp:h})),l._applyChanges()})},Cn.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var df=function(l){function h(c,d){l.call(this),this._moving=!1,this._zooming=!1,this.transform=c,this._bearingSnap=d.bearingSnap,m.bindAll(["_renderFrameCallback"],this)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getCenter=function(){return new m.LngLat(this.transform.center.lng,this.transform.center.lat)},h.prototype.setCenter=function(c,d){return this.jumpTo({center:c},d)},h.prototype.panBy=function(c,d,E){return c=m.Point.convert(c).mult(-1),this.panTo(this.transform.center,m.extend({offset:c},d),E)},h.prototype.panTo=function(c,d,E){return this.easeTo(m.extend({center:c},d),E)},h.prototype.getZoom=function(){return this.transform.zoom},h.prototype.setZoom=function(c,d){return this.jumpTo({zoom:c},d),this},h.prototype.zoomTo=function(c,d,E){return this.easeTo(m.extend({zoom:c},d),E)},h.prototype.zoomIn=function(c,d){return this.zoomTo(this.getZoom()+1,c,d),this},h.prototype.zoomOut=function(c,d){return this.zoomTo(this.getZoom()-1,c,d),this},h.prototype.getBearing=function(){return this.transform.bearing},h.prototype.setBearing=function(c,d){return this.jumpTo({bearing:c},d),this},h.prototype.getPadding=function(){return this.transform.padding},h.prototype.setPadding=function(c,d){return this.jumpTo({padding:c},d),this},h.prototype.rotateTo=function(c,d,E){return this.easeTo(m.extend({bearing:c},d),E)},h.prototype.resetNorth=function(c,d){return this.rotateTo(0,m.extend({duration:1e3},c),d),this},h.prototype.resetNorthPitch=function(c,d){return this.easeTo(m.extend({bearing:0,pitch:0,duration:1e3},c),d),this},h.prototype.snapToNorth=function(c,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(c,d):this},h.prototype.getPitch=function(){return this.transform.pitch},h.prototype.setPitch=function(c,d){return this.jumpTo({pitch:c},d),this},h.prototype.cameraForBounds=function(c,d){c=m.LngLatBounds.convert(c);var E=d&&d.bearing||0;return this._cameraForBoxAndBearing(c.getNorthWest(),c.getSouthEast(),E,d)},h.prototype._cameraForBoxAndBearing=function(c,d,E,w){var P={top:0,bottom:0,right:0,left:0};if(typeof(w=m.extend({padding:P,offset:[0,0],maxZoom:this.transform.maxZoom},w)).padding=="number"){var L=w.padding;w.padding={top:L,bottom:L,right:L,left:L}}w.padding=m.extend(P,w.padding);var N=this.transform,q=N.padding,ce=N.project(m.LngLat.convert(c)),he=N.project(m.LngLat.convert(d)),de=ce.rotate(-E*Math.PI/180),Re=he.rotate(-E*Math.PI/180),Ie=new m.Point(Math.max(de.x,Re.x),Math.max(de.y,Re.y)),We=new m.Point(Math.min(de.x,Re.x),Math.min(de.y,Re.y)),we=Ie.sub(We),Ve=(N.width-(q.left+q.right+w.padding.left+w.padding.right))/we.x,tt=(N.height-(q.top+q.bottom+w.padding.top+w.padding.bottom))/we.y;if(!(tt<0||Ve<0)){var yt=Math.min(N.scaleZoom(N.scale*Math.min(Ve,tt)),w.maxZoom),Wt=typeof w.offset.x=="number"?new m.Point(w.offset.x,w.offset.y):m.Point.convert(w.offset),jt=new m.Point((w.padding.left-w.padding.right)/2,(w.padding.top-w.padding.bottom)/2).rotate(E*Math.PI/180),Jt=Wt.add(jt).mult(N.scale/N.zoomScale(yt));return{center:N.unproject(ce.add(he).div(2).sub(Jt)),zoom:yt,bearing:E}}m.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},h.prototype.fitBounds=function(c,d,E){return this._fitInternal(this.cameraForBounds(c,d),d,E)},h.prototype.fitScreenCoordinates=function(c,d,E,w,P){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(m.Point.convert(c)),this.transform.pointLocation(m.Point.convert(d)),E,w),w,P)},h.prototype._fitInternal=function(c,d,E){return c?(delete(d=m.extend(c,d)).padding,d.linear?this.easeTo(d,E):this.flyTo(d,E)):this},h.prototype.jumpTo=function(c,d){this.stop();var E=this.transform,w=!1,P=!1,L=!1;return"zoom"in c&&E.zoom!==+c.zoom&&(w=!0,E.zoom=+c.zoom),c.center!==void 0&&(E.center=m.LngLat.convert(c.center)),"bearing"in c&&E.bearing!==+c.bearing&&(P=!0,E.bearing=+c.bearing),"pitch"in c&&E.pitch!==+c.pitch&&(L=!0,E.pitch=+c.pitch),c.padding==null||E.isPaddingEqual(c.padding)||(E.padding=c.padding),this.fire(new m.Event("movestart",d)).fire(new m.Event("move",d)),w&&this.fire(new m.Event("zoomstart",d)).fire(new m.Event("zoom",d)).fire(new m.Event("zoomend",d)),P&&this.fire(new m.Event("rotatestart",d)).fire(new m.Event("rotate",d)).fire(new m.Event("rotateend",d)),L&&this.fire(new m.Event("pitchstart",d)).fire(new m.Event("pitch",d)).fire(new m.Event("pitchend",d)),this.fire(new m.Event("moveend",d))},h.prototype.easeTo=function(c,d){var E=this;this._stop(!1,c.easeId),((c=m.extend({offset:[0,0],duration:500,easing:m.ease},c)).animate===!1||!c.essential&&m.browser.prefersReducedMotion)&&(c.duration=0);var w=this.transform,P=this.getZoom(),L=this.getBearing(),N=this.getPitch(),q=this.getPadding(),ce="zoom"in c?+c.zoom:P,he="bearing"in c?this._normalizeBearing(c.bearing,L):L,de="pitch"in c?+c.pitch:N,Re="padding"in c?c.padding:w.padding,Ie=m.Point.convert(c.offset),We=w.centerPoint.add(Ie),we=w.pointLocation(We),Ve=m.LngLat.convert(c.center||we);this._normalizeCenter(Ve);var tt,yt,Wt=w.project(we),jt=w.project(Ve).sub(Wt),Jt=w.zoomScale(ce-P);c.around&&(tt=m.LngLat.convert(c.around),yt=w.locationPoint(tt));var dr={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||ce!==P,this._rotating=this._rotating||L!==he,this._pitching=this._pitching||de!==N,this._padding=!w.isPaddingEqual(Re),this._easeId=c.easeId,this._prepareEase(d,c.noMoveStart,dr),this._ease(function(Fr){if(E._zooming&&(w.zoom=m.number(P,ce,Fr)),E._rotating&&(w.bearing=m.number(L,he,Fr)),E._pitching&&(w.pitch=m.number(N,de,Fr)),E._padding&&(w.interpolatePadding(q,Re,Fr),We=w.centerPoint.add(Ie)),tt)w.setLocationAtPoint(tt,yt);else{var kr=w.zoomScale(w.zoom-P),ln=ce>P?Math.min(2,Jt):Math.max(.5,Jt),Nn=Math.pow(ln,1-Fr),zn=w.unproject(Wt.add(jt.mult(Fr*Nn)).mult(kr));w.setLocationAtPoint(w.renderWorldCopies?zn.wrap():zn,We)}E._fireMoveEvents(d)},function(Fr){E._afterEase(d,Fr)},c),this},h.prototype._prepareEase=function(c,d,E){E===void 0&&(E={}),this._moving=!0,d||E.moving||this.fire(new m.Event("movestart",c)),this._zooming&&!E.zooming&&this.fire(new m.Event("zoomstart",c)),this._rotating&&!E.rotating&&this.fire(new m.Event("rotatestart",c)),this._pitching&&!E.pitching&&this.fire(new m.Event("pitchstart",c))},h.prototype._fireMoveEvents=function(c){this.fire(new m.Event("move",c)),this._zooming&&this.fire(new m.Event("zoom",c)),this._rotating&&this.fire(new m.Event("rotate",c)),this._pitching&&this.fire(new m.Event("pitch",c))},h.prototype._afterEase=function(c,d){if(!this._easeId||!d||this._easeId!==d){delete this._easeId;var E=this._zooming,w=this._rotating,P=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,E&&this.fire(new m.Event("zoomend",c)),w&&this.fire(new m.Event("rotateend",c)),P&&this.fire(new m.Event("pitchend",c)),this.fire(new m.Event("moveend",c))}},h.prototype.flyTo=function(c,d){var E=this;if(!c.essential&&m.browser.prefersReducedMotion){var w=m.pick(c,["center","zoom","bearing","pitch","around"]);return this.jumpTo(w,d)}this.stop(),c=m.extend({offset:[0,0],speed:1.2,curve:1.42,easing:m.ease},c);var P=this.transform,L=this.getZoom(),N=this.getBearing(),q=this.getPitch(),ce=this.getPadding(),he="zoom"in c?m.clamp(+c.zoom,P.minZoom,P.maxZoom):L,de="bearing"in c?this._normalizeBearing(c.bearing,N):N,Re="pitch"in c?+c.pitch:q,Ie="padding"in c?c.padding:P.padding,We=P.zoomScale(he-L),we=m.Point.convert(c.offset),Ve=P.centerPoint.add(we),tt=P.pointLocation(Ve),yt=m.LngLat.convert(c.center||tt);this._normalizeCenter(yt);var Wt=P.project(tt),jt=P.project(yt).sub(Wt),Jt=c.curve,dr=Math.max(P.width,P.height),Fr=dr/We,kr=jt.mag();if("minZoom"in c){var ln=m.clamp(Math.min(c.minZoom,L,he),P.minZoom,P.maxZoom),Nn=dr/P.zoomScale(ln-L);Jt=Math.sqrt(Nn/kr*2)}var zn=Jt*Jt;function Mn(ri){var Kn=(Fr*Fr-dr*dr+(ri?-1:1)*zn*zn*kr*kr)/(2*(ri?Fr:dr)*zn*kr);return Math.log(Math.sqrt(Kn*Kn+1)-Kn)}function Bi(ri){return(Math.exp(ri)-Math.exp(-ri))/2}function Qr(ri){return(Math.exp(ri)+Math.exp(-ri))/2}var li=Mn(0),fi=function(ri){return Qr(li)/Qr(li+Jt*ri)},ii=function(ri){return dr*((Qr(li)*(Bi(Kn=li+Jt*ri)/Qr(Kn))-Bi(li))/zn)/kr;var Kn},Xn=(Mn(1)-li)/Jt;if(Math.abs(kr)<1e-6||!isFinite(Xn)){if(Math.abs(dr-Fr)<1e-6)return this.easeTo(c,d);var xi=Fr<dr?-1:1;Xn=Math.abs(Math.log(Fr/dr))/Jt,ii=function(){return 0},fi=function(ri){return Math.exp(xi*Jt*ri)}}return c.duration="duration"in c?+c.duration:1e3*Xn/("screenSpeed"in c?+c.screenSpeed/Jt:+c.speed),c.maxDuration&&c.duration>c.maxDuration&&(c.duration=0),this._zooming=!0,this._rotating=N!==de,this._pitching=Re!==q,this._padding=!P.isPaddingEqual(Ie),this._prepareEase(d,!1),this._ease(function(ri){var Kn=ri*Xn,po=1/fi(Kn);P.zoom=ri===1?he:L+P.scaleZoom(po),E._rotating&&(P.bearing=m.number(N,de,ri)),E._pitching&&(P.pitch=m.number(q,Re,ri)),E._padding&&(P.interpolatePadding(ce,Ie,ri),Ve=P.centerPoint.add(we));var Ka=ri===1?yt:P.unproject(Wt.add(jt.mult(ii(Kn))).mult(po));P.setLocationAtPoint(P.renderWorldCopies?Ka.wrap():Ka,Ve),E._fireMoveEvents(d)},function(){return E._afterEase(d)},c),this},h.prototype.isEasing=function(){return!!this._easeFrameId},h.prototype.stop=function(){return this._stop()},h.prototype._stop=function(c,d){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var E=this._onEaseEnd;delete this._onEaseEnd,E.call(this,d)}if(!c){var w=this.handlers;w&&w.stop(!1)}return this},h.prototype._ease=function(c,d,E){E.animate===!1||E.duration===0?(c(1),d()):(this._easeStart=m.browser.now(),this._easeOptions=E,this._onEaseFrame=c,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},h.prototype._renderFrameCallback=function(){var c=Math.min((m.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(c)),c<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},h.prototype._normalizeBearing=function(c,d){c=m.wrap(c,-180,180);var E=Math.abs(c-d);return Math.abs(c-360-d)<E&&(c-=360),Math.abs(c+360-d)<E&&(c+=360),c},h.prototype._normalizeCenter=function(c){var d=this.transform;if(d.renderWorldCopies&&!d.lngRange){var E=c.lng-d.center.lng;c.lng+=E>180?-360:E<-180?360:0}},h}(m.Evented),ys=function(l){l===void 0&&(l={}),this.options=l,m.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};ys.prototype.getDefaultPosition=function(){return"bottom-right"},ys.prototype.onAdd=function(l){var h=this.options&&this.options.compact;return this._map=l,this._container=Z.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Z.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Z.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),h&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),h===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},ys.prototype.onRemove=function(){Z.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},ys.prototype._setElementTitle=function(l,h){var c=this._map._getUIString("AttributionControl."+h);l.title=c,l.setAttribute("aria-label",c)},ys.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},ys.prototype._updateEditLink=function(){var l=this._editLink;l||(l=this._editLink=this._container.querySelector(".mapbox-improve-map"));var h=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||m.config.ACCESS_TOKEN}];if(l){var c=h.reduce(function(d,E,w){return E.value&&(d+=E.key+"="+E.value+(w<h.length-1?"&":"")),d},"?");l.href=m.config.FEEDBACK_URL+"/"+c+(this._map._hash?this._map._hash.getHashString(!0):""),l.rel="noopener nofollow",this._setElementTitle(l,"MapFeedback")}},ys.prototype._updateData=function(l){!l||l.sourceDataType!=="metadata"&&l.sourceDataType!=="visibility"&&l.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},ys.prototype._updateAttributions=function(){if(this._map.style){var l=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=l.concat(this.options.customAttribution.map(function(L){return typeof L!="string"?"":L})):typeof this.options.customAttribution=="string"&&l.push(this.options.customAttribution)),this._map.style.stylesheet){var h=this._map.style.stylesheet;this.styleOwner=h.owner,this.styleId=h.id}var c=this._map.style.sourceCaches;for(var d in c){var E=c[d];if(E.used){var w=E.getSource();w.attribution&&l.indexOf(w.attribution)<0&&l.push(w.attribution)}}l.sort(function(L,N){return L.length-N.length});var P=(l=l.filter(function(L,N){for(var q=N+1;q<l.length;q++)if(l[q].indexOf(L)>=0)return!1;return!0})).join(" | ");P!==this._attribHTML&&(this._attribHTML=P,l.length?(this._innerContainer.innerHTML=P,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},ys.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var lu=function(){m.bindAll(["_updateLogo"],this),m.bindAll(["_updateCompact"],this)};lu.prototype.onAdd=function(l){this._map=l,this._container=Z.create("div","mapboxgl-ctrl");var h=Z.create("a","mapboxgl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://www.mapbox.com/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},lu.prototype.onRemove=function(){Z.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},lu.prototype.getDefaultPosition=function(){return"bottom-left"},lu.prototype._updateLogo=function(l){l&&l.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},lu.prototype._logoRequired=function(){if(this._map.style){var l=this._map.style.sourceCaches;for(var h in l)if(l[h].getSource().mapbox_logo)return!0;return!1}},lu.prototype._updateCompact=function(){var l=this._container.children;if(l.length){var h=l[0];this._map.getCanvasContainer().offsetWidth<250?h.classList.add("mapboxgl-compact"):h.classList.remove("mapboxgl-compact")}};var ns=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};ns.prototype.add=function(l){var h=++this._id;return this._queue.push({callback:l,id:h,cancelled:!1}),h},ns.prototype.remove=function(l){for(var h=this._currentlyRunning,c=0,d=h?this._queue.concat(h):this._queue;c<d.length;c+=1){var E=d[c];if(E.id===l)return void(E.cancelled=!0)}},ns.prototype.run=function(l){l===void 0&&(l=0);var h=this._currentlyRunning=this._queue;this._queue=[];for(var c=0,d=h;c<d.length;c+=1){var E=d[c];if(!E.cancelled&&(E.callback(l),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},ns.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var Go={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},Wf=m.window.HTMLImageElement,vf=m.window.HTMLElement,ha=m.window.ImageBitmap,Na={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},dc=function(l){function h(d){var E=this;if((d=m.extend({},Na,d)).minZoom!=null&&d.maxZoom!=null&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(d.minPitch!=null&&d.maxPitch!=null&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(d.minPitch!=null&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(d.maxPitch!=null&&d.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var w=new kn(d.minZoom,d.maxZoom,d.minPitch,d.maxPitch,d.renderWorldCopies);if(l.call(this,w,d),this._interactive=d.interactive,this._maxTileCacheSize=d.maxTileCacheSize,this._failIfMajorPerformanceCaveat=d.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=d.preserveDrawingBuffer,this._antialias=d.antialias,this._trackResize=d.trackResize,this._bearingSnap=d.bearingSnap,this._refreshExpiredTiles=d.refreshExpiredTiles,this._fadeDuration=d.fadeDuration,this._crossSourceCollisions=d.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=d.collectResourceTiming,this._renderTaskQueue=new ns,this._controls=[],this._mapId=m.uniqueId(),this._locale=m.extend({},Go,d.locale),this._clickTolerance=d.clickTolerance,this._requestManager=new m.RequestManager(d.transformRequest,d.accessToken),typeof d.container=="string"){if(this._container=m.window.document.getElementById(d.container),!this._container)throw new Error("Container '"+d.container+"' not found.")}else{if(!(d.container instanceof vf))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(d.maxBounds&&this.setMaxBounds(d.maxBounds),m.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return E._update(!1)}),this.on("moveend",function(){return E._update(!1)}),this.on("zoom",function(){return E._update(!0)}),m.window!==void 0&&(m.window.addEventListener("online",this._onWindowOnline,!1),m.window.addEventListener("resize",this._onWindowResize,!1),m.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new Cn(this,d),this._hash=d.hash&&new Ws(typeof d.hash=="string"&&d.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch}),d.bounds&&(this.resize(),this.fitBounds(d.bounds,m.extend({},d.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=d.localIdeographFontFamily,d.style&&this.setStyle(d.style,{localIdeographFontFamily:d.localIdeographFontFamily}),d.attributionControl&&this.addControl(new ys({customAttribution:d.customAttribution})),this.addControl(new lu,d.logoPosition),this.on("style.load",function(){E.transform.unmodified&&E.jumpTo(E.style.stylesheet)}),this.on("data",function(P){E._update(P.dataType==="style"),E.fire(new m.Event(P.dataType+"data",P))}),this.on("dataloading",function(P){E.fire(new m.Event(P.dataType+"dataloading",P))})}l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h;var c={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return h.prototype._getMapId=function(){return this._mapId},h.prototype.addControl=function(d,E){if(E===void 0&&(E=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new m.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var w=d.onAdd(this);this._controls.push(d);var P=this._controlPositions[E];return E.indexOf("bottom")!==-1?P.insertBefore(w,P.firstChild):P.appendChild(w),this},h.prototype.removeControl=function(d){if(!d||!d.onRemove)return this.fire(new m.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var E=this._controls.indexOf(d);return E>-1&&this._controls.splice(E,1),d.onRemove(this),this},h.prototype.hasControl=function(d){return this._controls.indexOf(d)>-1},h.prototype.resize=function(d){var E=this._containerDimensions(),w=E[0],P=E[1];if(w===this.transform.width&&P===this.transform.height)return this;this._resizeCanvas(w,P),this.transform.resize(w,P),this.painter.resize(w,P);var L=!this._moving;return L&&this.fire(new m.Event("movestart",d)).fire(new m.Event("move",d)),this.fire(new m.Event("resize",d)),L&&this.fire(new m.Event("moveend",d)),this},h.prototype.getBounds=function(){return this.transform.getBounds()},h.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},h.prototype.setMaxBounds=function(d){return this.transform.setMaxBounds(m.LngLatBounds.convert(d)),this._update()},h.prototype.setMinZoom=function(d){if((d=d==null?-2:d)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d&&this.setZoom(d),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},h.prototype.getMinZoom=function(){return this.transform.minZoom},h.prototype.setMaxZoom=function(d){if((d=d==null?22:d)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d&&this.setZoom(d),this;throw new Error("maxZoom must be greater than the current minZoom")},h.prototype.getMaxZoom=function(){return this.transform.maxZoom},h.prototype.setMinPitch=function(d){if((d=d==null?0:d)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d&&this.setPitch(d),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},h.prototype.getMinPitch=function(){return this.transform.minPitch},h.prototype.setMaxPitch=function(d){if((d=d==null?60:d)>60)throw new Error("maxPitch must be less than or equal to 60");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d&&this.setPitch(d),this;throw new Error("maxPitch must be greater than the current minPitch")},h.prototype.getMaxPitch=function(){return this.transform.maxPitch},h.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},h.prototype.setRenderWorldCopies=function(d){return this.transform.renderWorldCopies=d,this._update()},h.prototype.project=function(d){return this.transform.locationPoint(m.LngLat.convert(d))},h.prototype.unproject=function(d){return this.transform.pointLocation(m.Point.convert(d))},h.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},h.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},h.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},h.prototype._createDelegatedListener=function(d,E,w){var P,L=this;if(d==="mouseenter"||d==="mouseover"){var N=!1;return{layer:E,listener:w,delegates:{mousemove:function(ce){var he=L.getLayer(E)?L.queryRenderedFeatures(ce.point,{layers:[E]}):[];he.length?N||(N=!0,w.call(L,new Do(d,L,ce.originalEvent,{features:he}))):N=!1},mouseout:function(){N=!1}}}}if(d==="mouseleave"||d==="mouseout"){var q=!1;return{layer:E,listener:w,delegates:{mousemove:function(ce){(L.getLayer(E)?L.queryRenderedFeatures(ce.point,{layers:[E]}):[]).length?q=!0:q&&(q=!1,w.call(L,new Do(d,L,ce.originalEvent)))},mouseout:function(ce){q&&(q=!1,w.call(L,new Do(d,L,ce.originalEvent)))}}}}return{layer:E,listener:w,delegates:(P={},P[d]=function(ce){var he=L.getLayer(E)?L.queryRenderedFeatures(ce.point,{layers:[E]}):[];he.length&&(ce.features=he,w.call(L,ce),delete ce.features)},P)}},h.prototype.on=function(d,E,w){if(w===void 0)return l.prototype.on.call(this,d,E);var P=this._createDelegatedListener(d,E,w);for(var L in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(P),P.delegates)this.on(L,P.delegates[L]);return this},h.prototype.once=function(d,E,w){if(w===void 0)return l.prototype.once.call(this,d,E);var P=this._createDelegatedListener(d,E,w);for(var L in P.delegates)this.once(L,P.delegates[L]);return this},h.prototype.off=function(d,E,w){var P=this;return w===void 0?l.prototype.off.call(this,d,E):(this._delegatedListeners&&this._delegatedListeners[d]&&function(L){for(var N=L[d],q=0;q<N.length;q++){var ce=N[q];if(ce.layer===E&&ce.listener===w){for(var he in ce.delegates)P.off(he,ce.delegates[he]);return N.splice(q,1),P}}}(this._delegatedListeners),this)},h.prototype.queryRenderedFeatures=function(d,E){if(!this.style)return[];var w;if(E!==void 0||d===void 0||d instanceof m.Point||Array.isArray(d)||(E=d,d=void 0),E=E||{},(d=d||[[0,0],[this.transform.width,this.transform.height]])instanceof m.Point||typeof d[0]=="number")w=[m.Point.convert(d)];else{var P=m.Point.convert(d[0]),L=m.Point.convert(d[1]);w=[P,new m.Point(L.x,P.y),L,new m.Point(P.x,L.y),P]}return this.style.queryRenderedFeatures(w,E,this.transform)},h.prototype.querySourceFeatures=function(d,E){return this.style.querySourceFeatures(d,E)},h.prototype.setStyle=function(d,E){return(E=m.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},E)).diff!==!1&&E.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&d?(this._diffStyle(d,E),this):(this._localIdeographFontFamily=E.localIdeographFontFamily,this._updateStyle(d,E))},h.prototype._getUIString=function(d){var E=this._locale[d];if(E==null)throw new Error("Missing UI string '"+d+"'");return E},h.prototype._updateStyle=function(d,E){return this.style&&(this.style.setEventedParent(null),this.style._remove()),d?(this.style=new ds(this,E||{}),this.style.setEventedParent(this,{style:this.style}),typeof d=="string"?this.style.loadURL(d):this.style.loadJSON(d),this):(delete this.style,this)},h.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new ds(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},h.prototype._diffStyle=function(d,E){var w=this;if(typeof d=="string"){var P=this._requestManager.normalizeStyleURL(d),L=this._requestManager.transformRequest(P,m.ResourceType.Style);m.getJSON(L,function(N,q){N?w.fire(new m.ErrorEvent(N)):q&&w._updateDiff(q,E)})}else typeof d=="object"&&this._updateDiff(d,E)},h.prototype._updateDiff=function(d,E){try{this.style.setState(d)&&this._update(!0)}catch(w){m.warnOnce("Unable to perform style diff: "+(w.message||w.error||w)+".  Rebuilding the style from scratch."),this._updateStyle(d,E)}},h.prototype.getStyle=function(){if(this.style)return this.style.serialize()},h.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():m.warnOnce("There is no style added to the map.")},h.prototype.addSource=function(d,E){return this._lazyInitEmptyStyle(),this.style.addSource(d,E),this._update(!0)},h.prototype.isSourceLoaded=function(d){var E=this.style&&this.style.sourceCaches[d];if(E!==void 0)return E.loaded();this.fire(new m.ErrorEvent(new Error("There is no source with ID '"+d+"'")))},h.prototype.areTilesLoaded=function(){var d=this.style&&this.style.sourceCaches;for(var E in d){var w=d[E]._tiles;for(var P in w){var L=w[P];if(L.state!=="loaded"&&L.state!=="errored")return!1}}return!0},h.prototype.addSourceType=function(d,E,w){return this._lazyInitEmptyStyle(),this.style.addSourceType(d,E,w)},h.prototype.removeSource=function(d){return this.style.removeSource(d),this._update(!0)},h.prototype.getSource=function(d){return this.style.getSource(d)},h.prototype.addImage=function(d,E,w){w===void 0&&(w={});var P=w.pixelRatio;P===void 0&&(P=1);var L=w.sdf;L===void 0&&(L=!1);var N=w.stretchX,q=w.stretchY,ce=w.content;if(this._lazyInitEmptyStyle(),E instanceof Wf||ha&&E instanceof ha){var he=m.browser.getImageData(E);this.style.addImage(d,{data:new m.RGBAImage({width:he.width,height:he.height},he.data),pixelRatio:P,stretchX:N,stretchY:q,content:ce,sdf:L,version:0})}else{if(E.width===void 0||E.height===void 0)return this.fire(new m.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var de=E;this.style.addImage(d,{data:new m.RGBAImage({width:E.width,height:E.height},new Uint8Array(E.data)),pixelRatio:P,stretchX:N,stretchY:q,content:ce,sdf:L,version:0,userImage:de}),de.onAdd&&de.onAdd(this,d)}},h.prototype.updateImage=function(d,E){var w=this.style.getImage(d);if(!w)return this.fire(new m.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var P=E instanceof Wf||ha&&E instanceof ha?m.browser.getImageData(E):E,L=P.width,N=P.height,q=P.data;return L===void 0||N===void 0?this.fire(new m.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):L!==w.data.width||N!==w.data.height?this.fire(new m.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(w.data.replace(q,!(E instanceof Wf||ha&&E instanceof ha)),void this.style.updateImage(d,w))},h.prototype.hasImage=function(d){return d?!!this.style.getImage(d):(this.fire(new m.ErrorEvent(new Error("Missing required image id"))),!1)},h.prototype.removeImage=function(d){this.style.removeImage(d)},h.prototype.loadImage=function(d,E){m.getImage(this._requestManager.transformRequest(d,m.ResourceType.Image),E)},h.prototype.listImages=function(){return this.style.listImages()},h.prototype.addLayer=function(d,E){return this._lazyInitEmptyStyle(),this.style.addLayer(d,E),this._update(!0)},h.prototype.moveLayer=function(d,E){return this.style.moveLayer(d,E),this._update(!0)},h.prototype.removeLayer=function(d){return this.style.removeLayer(d),this._update(!0)},h.prototype.getLayer=function(d){return this.style.getLayer(d)},h.prototype.setLayerZoomRange=function(d,E,w){return this.style.setLayerZoomRange(d,E,w),this._update(!0)},h.prototype.setFilter=function(d,E,w){return w===void 0&&(w={}),this.style.setFilter(d,E,w),this._update(!0)},h.prototype.getFilter=function(d){return this.style.getFilter(d)},h.prototype.setPaintProperty=function(d,E,w,P){return P===void 0&&(P={}),this.style.setPaintProperty(d,E,w,P),this._update(!0)},h.prototype.getPaintProperty=function(d,E){return this.style.getPaintProperty(d,E)},h.prototype.setLayoutProperty=function(d,E,w,P){return P===void 0&&(P={}),this.style.setLayoutProperty(d,E,w,P),this._update(!0)},h.prototype.getLayoutProperty=function(d,E){return this.style.getLayoutProperty(d,E)},h.prototype.setLight=function(d,E){return E===void 0&&(E={}),this._lazyInitEmptyStyle(),this.style.setLight(d,E),this._update(!0)},h.prototype.getLight=function(){return this.style.getLight()},h.prototype.setFeatureState=function(d,E){return this.style.setFeatureState(d,E),this._update()},h.prototype.removeFeatureState=function(d,E){return this.style.removeFeatureState(d,E),this._update()},h.prototype.getFeatureState=function(d){return this.style.getFeatureState(d)},h.prototype.getContainer=function(){return this._container},h.prototype.getCanvasContainer=function(){return this._canvasContainer},h.prototype.getCanvas=function(){return this._canvas},h.prototype._containerDimensions=function(){var d=0,E=0;return this._container&&(d=this._container.clientWidth||400,E=this._container.clientHeight||300),[d,E]},h.prototype._detectMissingCSS=function(){m.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&m.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},h.prototype._setupContainer=function(){var d=this._container;d.classList.add("mapboxgl-map"),(this._missingCSSCanary=Z.create("div","mapboxgl-canary",d)).style.visibility="hidden",this._detectMissingCSS();var E=this._canvasContainer=Z.create("div","mapboxgl-canvas-container",d);this._interactive&&E.classList.add("mapboxgl-interactive"),this._canvas=Z.create("canvas","mapboxgl-canvas",E),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var w=this._containerDimensions();this._resizeCanvas(w[0],w[1]);var P=this._controlContainer=Z.create("div","mapboxgl-control-container",d),L=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(N){L[N]=Z.create("div","mapboxgl-ctrl-"+N,P)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},h.prototype._resizeCanvas=function(d,E){var w=m.browser.devicePixelRatio||1;this._canvas.width=w*d,this._canvas.height=w*E,this._canvas.style.width=d+"px",this._canvas.style.height=E+"px"},h.prototype._setupPainter=function(){var d=m.extend({},ve.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),E=this._canvas.getContext("webgl",d)||this._canvas.getContext("experimental-webgl",d);E?(this.painter=new Va(E,this.transform),m.webpSupported.testSupport(E)):this.fire(new m.ErrorEvent(new Error("Failed to initialize WebGL")))},h.prototype._contextLost=function(d){d.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new m.Event("webglcontextlost",{originalEvent:d}))},h.prototype._contextRestored=function(d){this._setupPainter(),this.resize(),this._update(),this.fire(new m.Event("webglcontextrestored",{originalEvent:d}))},h.prototype._onMapScroll=function(d){if(d.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},h.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},h.prototype._update=function(d){return this.style?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this},h.prototype._requestRenderFrame=function(d){return this._update(),this._renderTaskQueue.add(d)},h.prototype._cancelRenderFrame=function(d){this._renderTaskQueue.remove(d)},h.prototype._render=function(d){var E,w=this,P=0,L=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(E=L.createQueryEXT(),L.beginQueryEXT(L.TIME_ELAPSED_EXT,E),P=m.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(d),!this._removed){var N=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var q=this.transform.zoom,ce=m.browser.now();this.style.zoomHistory.update(q,ce);var he=new m.EvaluationParameters(q,{now:ce,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),de=he.crossFadingFactor();de===1&&de===this._crossFadingFactor||(N=!0,this._crossFadingFactor=de),this.style.update(he)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new m.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new m.Event("load"))),this.style&&(this.style.hasTransitions()||N)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var Re=m.browser.now()-P;L.endQueryEXT(L.TIME_ELAPSED_EXT,E),setTimeout(function(){var we=L.getQueryObjectEXT(E,L.QUERY_RESULT_EXT)/1e6;L.deleteQueryEXT(E),w.fire(new m.Event("gpu-timing-frame",{cpuTime:Re,gpuTime:we}))},50)}if(this.listens("gpu-timing-layer")){var Ie=this.painter.collectGpuTimers();setTimeout(function(){var we=w.painter.queryGpuTimers(Ie);w.fire(new m.Event("gpu-timing-layer",{layerTimes:we}))},50)}var We=this._sourcesDirty||this._styleDirty||this._placementDirty;return We||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new m.Event("idle")),!this._loaded||this._fullyLoaded||We||(this._fullyLoaded=!0),this}},h.prototype.remove=function(){this._hash&&this._hash.remove();for(var d=0,E=this._controls;d<E.length;d+=1)E[d].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),m.window!==void 0&&(m.window.removeEventListener("resize",this._onWindowResize,!1),m.window.removeEventListener("orientationchange",this._onWindowResize,!1),m.window.removeEventListener("online",this._onWindowOnline,!1));var w=this.painter.context.gl.getExtension("WEBGL_lose_context");w&&w.loseContext(),yl(this._canvasContainer),yl(this._controlContainer),yl(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new m.Event("remove"))},h.prototype.triggerRepaint=function(){var d=this;this.style&&!this._frame&&(this._frame=m.browser.frame(function(E){d._frame=null,d._render(E)}))},h.prototype._onWindowOnline=function(){this._update()},h.prototype._onWindowResize=function(d){this._trackResize&&this.resize({originalEvent:d})._update()},c.showTileBoundaries.get=function(){return!!this._showTileBoundaries},c.showTileBoundaries.set=function(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._update())},c.showPadding.get=function(){return!!this._showPadding},c.showPadding.set=function(d){this._showPadding!==d&&(this._showPadding=d,this._update())},c.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},c.showCollisionBoxes.set=function(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,d?this.style._generateCollisionBoxes():this._update())},c.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},c.showOverdrawInspector.set=function(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._update())},c.repaint.get=function(){return!!this._repaint},c.repaint.set=function(d){this._repaint!==d&&(this._repaint=d,this.triggerRepaint())},c.vertices.get=function(){return!!this._vertices},c.vertices.set=function(d){this._vertices=d,this._update()},h.prototype._setCacheLimits=function(d,E){m.setCacheLimits(d,E)},c.version.get=function(){return m.version},Object.defineProperties(h.prototype,c),h}(df);function yl(l){l.parentNode&&l.parentNode.removeChild(l)}var Pu={showCompass:!0,showZoom:!0,visualizePitch:!1},cu=function(l){var h=this;this.options=m.extend({},Pu,l),this._container=Z.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(c){return c.preventDefault()}),this.options.showZoom&&(m.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(c){return h._map.zoomIn({},{originalEvent:c})}),Z.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(c){return h._map.zoomOut({},{originalEvent:c})}),Z.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(m.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(c){h.options.visualizePitch?h._map.resetNorthPitch({},{originalEvent:c}):h._map.resetNorth({},{originalEvent:c})}),this._compassIcon=Z.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};cu.prototype._updateZoomButtons=function(){var l=this._map.getZoom(),h=l===this._map.getMaxZoom(),c=l===this._map.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())},cu.prototype._rotateCompassArrow=function(){var l=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=l},cu.prototype.onAdd=function(l){return this._map=l,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Fo(this._map,this._compass,this.options.visualizePitch)),this._container},cu.prototype.onRemove=function(){Z.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},cu.prototype._createButton=function(l,h){var c=Z.create("button",l,this._container);return c.type="button",c.addEventListener("click",h),c},cu.prototype._setButtonTitle=function(l,h){var c=this._map._getUIString("NavigationControl."+h);l.title=c,l.setAttribute("aria-label",c)};var Fo=function(l,h,c){c===void 0&&(c=!1),this._clickTolerance=10,this.element=h,this.mouseRotate=new pf({clickTolerance:l.dragRotate._mouseRotate._clickTolerance}),this.map=l,c&&(this.mousePitch=new gl({clickTolerance:l.dragRotate._mousePitch._clickTolerance})),m.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),Z.addEventListener(h,"mousedown",this.mousedown),Z.addEventListener(h,"touchstart",this.touchstart,{passive:!1}),Z.addEventListener(h,"touchmove",this.touchmove),Z.addEventListener(h,"touchend",this.touchend),Z.addEventListener(h,"touchcancel",this.reset)};function il(l,h,c){if(l=new m.LngLat(l.lng,l.lat),h){var d=new m.LngLat(l.lng-360,l.lat),E=new m.LngLat(l.lng+360,l.lat),w=c.locationPoint(l).distSqr(h);c.locationPoint(d).distSqr(h)<w?l=d:c.locationPoint(E).distSqr(h)<w&&(l=E)}for(;Math.abs(l.lng-c.center.lng)>180;){var P=c.locationPoint(l);if(P.x>=0&&P.y>=0&&P.x<=c.width&&P.y<=c.height)break;l.lng>c.center.lng?l.lng-=360:l.lng+=360}return l}Fo.prototype.down=function(l,h){this.mouseRotate.mousedown(l,h),this.mousePitch&&this.mousePitch.mousedown(l,h),Z.disableDrag()},Fo.prototype.move=function(l,h){var c=this.map,d=this.mouseRotate.mousemoveWindow(l,h);if(d&&d.bearingDelta&&c.setBearing(c.getBearing()+d.bearingDelta),this.mousePitch){var E=this.mousePitch.mousemoveWindow(l,h);E&&E.pitchDelta&&c.setPitch(c.getPitch()+E.pitchDelta)}},Fo.prototype.off=function(){var l=this.element;Z.removeEventListener(l,"mousedown",this.mousedown),Z.removeEventListener(l,"touchstart",this.touchstart,{passive:!1}),Z.removeEventListener(l,"touchmove",this.touchmove),Z.removeEventListener(l,"touchend",this.touchend),Z.removeEventListener(l,"touchcancel",this.reset),this.offTemp()},Fo.prototype.offTemp=function(){Z.enableDrag(),Z.removeEventListener(m.window,"mousemove",this.mousemove),Z.removeEventListener(m.window,"mouseup",this.mouseup)},Fo.prototype.mousedown=function(l){this.down(m.extend({},l,{ctrlKey:!0,preventDefault:function(){return l.preventDefault()}}),Z.mousePos(this.element,l)),Z.addEventListener(m.window,"mousemove",this.mousemove),Z.addEventListener(m.window,"mouseup",this.mouseup)},Fo.prototype.mousemove=function(l){this.move(l,Z.mousePos(this.element,l))},Fo.prototype.mouseup=function(l){this.mouseRotate.mouseupWindow(l),this.mousePitch&&this.mousePitch.mouseupWindow(l),this.offTemp()},Fo.prototype.touchstart=function(l){l.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Z.touchPos(this.element,l.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return l.preventDefault()}},this._startPos))},Fo.prototype.touchmove=function(l){l.targetTouches.length!==1?this.reset():(this._lastPos=Z.touchPos(this.element,l.targetTouches)[0],this.move({preventDefault:function(){return l.preventDefault()}},this._lastPos))},Fo.prototype.touchend=function(l){l.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},Fo.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var fu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function mf(l,h,c){var d=l.classList;for(var E in fu)d.remove("mapboxgl-"+c+"-anchor-"+E);d.add("mapboxgl-"+c+"-anchor-"+h)}var Nl,jc=function(l){function h(c,d){if(l.call(this),(c instanceof m.window.HTMLElement||d)&&(c=m.extend({element:c},d)),m.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=c&&c.anchor||"center",this._color=c&&c.color||"#3FB1CE",this._scale=c&&c.scale||1,this._draggable=c&&c.draggable||!1,this._clickTolerance=c&&c.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=c&&c.rotation||0,this._rotationAlignment=c&&c.rotationAlignment||"auto",this._pitchAlignment=c&&c.pitchAlignment&&c.pitchAlignment!=="auto"?c.pitchAlignment:this._rotationAlignment,c&&c.element)this._element=c.element,this._offset=m.Point.convert(c&&c.offset||[0,0]);else{this._defaultMarker=!0,this._element=Z.create("div"),this._element.setAttribute("aria-label","Map marker");var E=Z.createNS("http://www.w3.org/2000/svg","svg");E.setAttributeNS(null,"display","block"),E.setAttributeNS(null,"height","41px"),E.setAttributeNS(null,"width","27px"),E.setAttributeNS(null,"viewBox","0 0 27 41");var w=Z.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"stroke","none"),w.setAttributeNS(null,"stroke-width","1"),w.setAttributeNS(null,"fill","none"),w.setAttributeNS(null,"fill-rule","evenodd");var P=Z.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"fill-rule","nonzero");var L=Z.createNS("http://www.w3.org/2000/svg","g");L.setAttributeNS(null,"transform","translate(3.0, 29.0)"),L.setAttributeNS(null,"fill","#000000");for(var N=0,q=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];N<q.length;N+=1){var ce=q[N],he=Z.createNS("http://www.w3.org/2000/svg","ellipse");he.setAttributeNS(null,"opacity","0.04"),he.setAttributeNS(null,"cx","10.5"),he.setAttributeNS(null,"cy","5.80029008"),he.setAttributeNS(null,"rx",ce.rx),he.setAttributeNS(null,"ry",ce.ry),L.appendChild(he)}var de=Z.createNS("http://www.w3.org/2000/svg","g");de.setAttributeNS(null,"fill",this._color);var Re=Z.createNS("http://www.w3.org/2000/svg","path");Re.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),de.appendChild(Re);var Ie=Z.createNS("http://www.w3.org/2000/svg","g");Ie.setAttributeNS(null,"opacity","0.25"),Ie.setAttributeNS(null,"fill","#000000");var We=Z.createNS("http://www.w3.org/2000/svg","path");We.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Ie.appendChild(We);var we=Z.createNS("http://www.w3.org/2000/svg","g");we.setAttributeNS(null,"transform","translate(6.0, 7.0)"),we.setAttributeNS(null,"fill","#FFFFFF");var Ve=Z.createNS("http://www.w3.org/2000/svg","g");Ve.setAttributeNS(null,"transform","translate(8.0, 8.0)");var tt=Z.createNS("http://www.w3.org/2000/svg","circle");tt.setAttributeNS(null,"fill","#000000"),tt.setAttributeNS(null,"opacity","0.25"),tt.setAttributeNS(null,"cx","5.5"),tt.setAttributeNS(null,"cy","5.5"),tt.setAttributeNS(null,"r","5.4999962");var yt=Z.createNS("http://www.w3.org/2000/svg","circle");yt.setAttributeNS(null,"fill","#FFFFFF"),yt.setAttributeNS(null,"cx","5.5"),yt.setAttributeNS(null,"cy","5.5"),yt.setAttributeNS(null,"r","5.4999962"),Ve.appendChild(tt),Ve.appendChild(yt),P.appendChild(L),P.appendChild(de),P.appendChild(Ie),P.appendChild(we),P.appendChild(Ve),E.appendChild(P),E.setAttributeNS(null,"height",41*this._scale+"px"),E.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(E),this._offset=m.Point.convert(c&&c.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(Wt){Wt.preventDefault()}),this._element.addEventListener("mousedown",function(Wt){Wt.preventDefault()}),mf(this._element,this._anchor,"marker"),this._popup=null}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.addTo=function(c){return this.remove(),this._map=c,c.getCanvasContainer().appendChild(this._element),c.on("move",this._update),c.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},h.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),Z.remove(this._element),this._popup&&this._popup.remove(),this},h.prototype.getLngLat=function(){return this._lngLat},h.prototype.setLngLat=function(c){return this._lngLat=m.LngLat.convert(c),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},h.prototype.getElement=function(){return this._element},h.prototype.setPopup=function(c){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),c){if(!("offset"in c.options)){var d=Math.sqrt(Math.pow(13.5,2)/2);c.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[d,-1*(24.6+d)],"bottom-right":[-d,-1*(24.6+d)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=c,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},h.prototype._onKeyPress=function(c){var d=c.code,E=c.charCode||c.keyCode;d!=="Space"&&d!=="Enter"&&E!==32&&E!==13||this.togglePopup()},h.prototype._onMapClick=function(c){var d=c.originalEvent.target,E=this._element;this._popup&&(d===E||E.contains(d))&&this.togglePopup()},h.prototype.getPopup=function(){return this._popup},h.prototype.togglePopup=function(){var c=this._popup;return c?(c.isOpen()?c.remove():c.addTo(this._map),this):this},h.prototype._update=function(c){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=il(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var d="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?d="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(d="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var E="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?E="rotateX(0deg)":this._pitchAlignment==="map"&&(E="rotateX("+this._map.getPitch()+"deg)"),c&&c.type!=="moveend"||(this._pos=this._pos.round()),Z.setTransform(this._element,fu[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+E+" "+d)}},h.prototype.getOffset=function(){return this._offset},h.prototype.setOffset=function(c){return this._offset=m.Point.convert(c),this._update(),this},h.prototype._onMove=function(c){if(!this._isDragging){var d=this._clickTolerance||this._map._clickTolerance;this._isDragging=c.point.dist(this._pointerdownPos)>=d}this._isDragging&&(this._pos=c.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new m.Event("dragstart"))),this.fire(new m.Event("drag")))},h.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new m.Event("dragend")),this._state="inactive"},h.prototype._addDragHandler=function(c){this._element.contains(c.originalEvent.target)&&(c.preventDefault(),this._positionDelta=c.point.sub(this._pos).add(this._offset),this._pointerdownPos=c.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},h.prototype.setDraggable=function(c){return this._draggable=!!c,this._map&&(c?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},h.prototype.isDraggable=function(){return this._draggable},h.prototype.setRotation=function(c){return this._rotation=c||0,this._update(),this},h.prototype.getRotation=function(){return this._rotation},h.prototype.setRotationAlignment=function(c){return this._rotationAlignment=c||"auto",this._update(),this},h.prototype.getRotationAlignment=function(){return this._rotationAlignment},h.prototype.setPitchAlignment=function(c){return this._pitchAlignment=c&&c!=="auto"?c:this._rotationAlignment,this._update(),this},h.prototype.getPitchAlignment=function(){return this._pitchAlignment},h}(m.Evented),gf={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},Iu=0,vc=!1,Vc=function(l){function h(c){l.call(this),this.options=m.extend({},gf,c),m.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.onAdd=function(c){var d;return this._map=c,this._container=Z.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),d=this._setupUI,Nl!==void 0?d(Nl):m.window.navigator.permissions!==void 0?m.window.navigator.permissions.query({name:"geolocation"}).then(function(E){d(Nl=E.state!=="denied")}):d(Nl=!!m.window.navigator.geolocation),this._container},h.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(m.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),Z.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Iu=0,vc=!1},h.prototype._isOutOfMapMaxBounds=function(c){var d=this._map.getMaxBounds(),E=c.coords;return d&&(E.longitude<d.getWest()||E.longitude>d.getEast()||E.latitude<d.getSouth()||E.latitude>d.getNorth())},h.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},h.prototype._onSuccess=function(c){if(this._map){if(this._isOutOfMapMaxBounds(c))return this._setErrorState(),this.fire(new m.Event("outofmaxbounds",c)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=c,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(c),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(c),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new m.Event("geolocate",c)),this._finish()}},h.prototype._updateCamera=function(c){var d=new m.LngLat(c.coords.longitude,c.coords.latitude),E=c.coords.accuracy,w=this._map.getBearing(),P=m.extend({bearing:w},this.options.fitBoundsOptions);this._map.fitBounds(d.toBounds(E),P,{geolocateSource:!0})},h.prototype._updateMarker=function(c){if(c){var d=new m.LngLat(c.coords.longitude,c.coords.latitude);this._accuracyCircleMarker.setLngLat(d).addTo(this._map),this._userLocationDotMarker.setLngLat(d).addTo(this._map),this._accuracy=c.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},h.prototype._updateCircleRadius=function(){var c=this._map._container.clientHeight/2,d=this._map.unproject([0,c]),E=this._map.unproject([1,c]),w=d.distanceTo(E),P=Math.ceil(2*this._accuracy/w);this._circleElement.style.width=P+"px",this._circleElement.style.height=P+"px"},h.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},h.prototype._onError=function(c){if(this._map){if(this.options.trackUserLocation)if(c.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(c.code===3&&vc)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new m.Event("error",c)),this._finish()}},h.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},h.prototype._setupUI=function(c){var d=this;if(this._container.addEventListener("contextmenu",function(P){return P.preventDefault()}),this._geolocateButton=Z.create("button","mapboxgl-ctrl-geolocate",this._container),Z.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",c===!1){m.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var E=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=E,this._geolocateButton.setAttribute("aria-label",E)}else{var w=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=w,this._geolocateButton.setAttribute("aria-label",w)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Z.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new jc(this._dotElement),this._circleElement=Z.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new jc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(P){P.geolocateSource||d._watchState!=="ACTIVE_LOCK"||P.originalEvent&&P.originalEvent.type==="resize"||(d._watchState="BACKGROUND",d._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),d._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),d.fire(new m.Event("trackuserlocationend")))})},h.prototype.trigger=function(){if(!this._setup)return m.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new m.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Iu--,vc=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new m.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new m.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var c;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++Iu>1?(c={maximumAge:6e5,timeout:0},vc=!0):(c=this.options.positionOptions,vc=!1),this._geolocationWatchID=m.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,c)}}else m.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},h.prototype._clearWatch=function(){m.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},h}(m.Evented),al={maxWidth:100,unit:"metric"},Ji=function(l){this.options=m.extend({},al,l),m.bindAll(["_onMove","setUnit"],this)};function ol(l,h,c){var d=c&&c.maxWidth||100,E=l._container.clientHeight/2,w=l.unproject([0,E]),P=l.unproject([d,E]),L=w.distanceTo(P);if(c&&c.unit==="imperial"){var N=3.2808*L;N>5280?hu(h,d,N/5280,l._getUIString("ScaleControl.Miles")):hu(h,d,N,l._getUIString("ScaleControl.Feet"))}else c&&c.unit==="nautical"?hu(h,d,L/1852,l._getUIString("ScaleControl.NauticalMiles")):L>=1e3?hu(h,d,L/1e3,l._getUIString("ScaleControl.Kilometers")):hu(h,d,L,l._getUIString("ScaleControl.Meters"))}function hu(l,h,c,d){var E,w,P,L=(E=c,(w=Math.pow(10,(""+Math.floor(E)).length-1))*(P=(P=E/w)>=10?10:P>=5?5:P>=3?3:P>=2?2:P>=1?1:function(N){var q=Math.pow(10,Math.ceil(-Math.log(N)/Math.LN10));return Math.round(N*q)/q}(P)));l.style.width=h*(L/c)+"px",l.innerHTML=L+"&nbsp;"+d}Ji.prototype.getDefaultPosition=function(){return"bottom-left"},Ji.prototype._onMove=function(){ol(this._map,this._container,this.options)},Ji.prototype.onAdd=function(l){return this._map=l,this._container=Z.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",l.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},Ji.prototype.onRemove=function(){Z.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},Ji.prototype.setUnit=function(l){this.options.unit=l,ol(this._map,this._container,this.options)};var Ts=function(l){this._fullscreen=!1,l&&l.container&&(l.container instanceof m.window.HTMLElement?this._container=l.container:m.warnOnce("Full screen control 'container' must be a DOM element.")),m.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in m.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in m.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in m.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in m.window.document&&(this._fullscreenchange="MSFullscreenChange")};Ts.prototype.onAdd=function(l){return this._map=l,this._container||(this._container=this._map.getContainer()),this._controlContainer=Z.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",m.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},Ts.prototype.onRemove=function(){Z.remove(this._controlContainer),this._map=null,m.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},Ts.prototype._checkFullscreenSupport=function(){return!!(m.window.document.fullscreenEnabled||m.window.document.mozFullScreenEnabled||m.window.document.msFullscreenEnabled||m.window.document.webkitFullscreenEnabled)},Ts.prototype._setupUI=function(){var l=this._fullscreenButton=Z.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Z.create("span","mapboxgl-ctrl-icon",l).setAttribute("aria-hidden",!0),l.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),m.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},Ts.prototype._updateTitle=function(){var l=this._getTitle();this._fullscreenButton.setAttribute("aria-label",l),this._fullscreenButton.title=l},Ts.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},Ts.prototype._isFullscreen=function(){return this._fullscreen},Ts.prototype._changeIcon=function(){(m.window.document.fullscreenElement||m.window.document.mozFullScreenElement||m.window.document.webkitFullscreenElement||m.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},Ts.prototype._onClickFullscreen=function(){this._isFullscreen()?m.window.document.exitFullscreen?m.window.document.exitFullscreen():m.window.document.mozCancelFullScreen?m.window.document.mozCancelFullScreen():m.window.document.msExitFullscreen?m.window.document.msExitFullscreen():m.window.document.webkitCancelFullScreen&&m.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var zl={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},_l=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),yf=function(l){function h(c){l.call(this),this.options=m.extend(Object.create(zl),c),m.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.addTo=function(c){return this._map&&this.remove(),this._map=c,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new m.Event("open")),this},h.prototype.isOpen=function(){return!!this._map},h.prototype.remove=function(){return this._content&&Z.remove(this._content),this._container&&(Z.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new m.Event("close")),this},h.prototype.getLngLat=function(){return this._lngLat},h.prototype.setLngLat=function(c){return this._lngLat=m.LngLat.convert(c),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},h.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},h.prototype.getElement=function(){return this._container},h.prototype.setText=function(c){return this.setDOMContent(m.window.document.createTextNode(c))},h.prototype.setHTML=function(c){var d,E=m.window.document.createDocumentFragment(),w=m.window.document.createElement("body");for(w.innerHTML=c;d=w.firstChild;)E.appendChild(d);return this.setDOMContent(E)},h.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},h.prototype.setMaxWidth=function(c){return this.options.maxWidth=c,this._update(),this},h.prototype.setDOMContent=function(c){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=Z.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(c),this._createCloseButton(),this._update(),this._focusFirstElement(),this},h.prototype.addClassName=function(c){this._container&&this._container.classList.add(c)},h.prototype.removeClassName=function(c){this._container&&this._container.classList.remove(c)},h.prototype.setOffset=function(c){return this.options.offset=c,this._update(),this},h.prototype.toggleClassName=function(c){if(this._container)return this._container.classList.toggle(c)},h.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=Z.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},h.prototype._onMouseUp=function(c){this._update(c.point)},h.prototype._onMouseMove=function(c){this._update(c.point)},h.prototype._onDrag=function(c){this._update(c.point)},h.prototype._update=function(c){var d=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=Z.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=Z.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(he){return d._container.classList.add(he)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=il(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||c)){var E=this._pos=this._trackPointer&&c?c:this._map.project(this._lngLat),w=this.options.anchor,P=function he(de){if(de){if(typeof de=="number"){var Re=Math.round(Math.sqrt(.5*Math.pow(de,2)));return{center:new m.Point(0,0),top:new m.Point(0,de),"top-left":new m.Point(Re,Re),"top-right":new m.Point(-Re,Re),bottom:new m.Point(0,-de),"bottom-left":new m.Point(Re,-Re),"bottom-right":new m.Point(-Re,-Re),left:new m.Point(de,0),right:new m.Point(-de,0)}}if(de instanceof m.Point||Array.isArray(de)){var Ie=m.Point.convert(de);return{center:Ie,top:Ie,"top-left":Ie,"top-right":Ie,bottom:Ie,"bottom-left":Ie,"bottom-right":Ie,left:Ie,right:Ie}}return{center:m.Point.convert(de.center||[0,0]),top:m.Point.convert(de.top||[0,0]),"top-left":m.Point.convert(de["top-left"]||[0,0]),"top-right":m.Point.convert(de["top-right"]||[0,0]),bottom:m.Point.convert(de.bottom||[0,0]),"bottom-left":m.Point.convert(de["bottom-left"]||[0,0]),"bottom-right":m.Point.convert(de["bottom-right"]||[0,0]),left:m.Point.convert(de.left||[0,0]),right:m.Point.convert(de.right||[0,0])}}return he(new m.Point(0,0))}(this.options.offset);if(!w){var L,N=this._container.offsetWidth,q=this._container.offsetHeight;L=E.y+P.bottom.y<q?["top"]:E.y>this._map.transform.height-q?["bottom"]:[],E.x<N/2?L.push("left"):E.x>this._map.transform.width-N/2&&L.push("right"),w=L.length===0?"bottom":L.join("-")}var ce=E.add(P[w]).round();Z.setTransform(this._container,fu[w]+" translate("+ce.x+"px,"+ce.y+"px)"),mf(this._container,w,"popup")}},h.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var c=this._container.querySelector(_l);c&&c.focus()}},h.prototype._onClose=function(){this.remove()},h}(m.Evented),Pa={version:m.version,supported:ve,setRTLTextPlugin:m.setRTLTextPlugin,getRTLTextPluginStatus:m.getRTLTextPluginStatus,Map:dc,NavigationControl:cu,GeolocateControl:Vc,AttributionControl:ys,ScaleControl:Ji,FullscreenControl:Ts,Popup:yf,Marker:jc,Style:ds,LngLat:m.LngLat,LngLatBounds:m.LngLatBounds,Point:m.Point,MercatorCoordinate:m.MercatorCoordinate,Evented:m.Evented,config:m.config,prewarm:function(){Ot().acquire(zt)},clearPrewarmedResources:function(){var l=En;l&&(l.isPreloaded()&&l.numActive()===1?(l.release(zt),En=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return m.config.ACCESS_TOKEN},set accessToken(l){m.config.ACCESS_TOKEN=l},get baseApiUrl(){return m.config.API_URL},set baseApiUrl(l){m.config.API_URL=l},get workerCount(){return vr.workerCount},set workerCount(l){vr.workerCount=l},get maxParallelImageRequests(){return m.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(l){m.config.MAX_PARALLEL_IMAGE_REQUESTS=l},clearStorage:function(l){m.clearTileCache(l)},workerUrl:""};return Pa}),ae})},28660:function(It,$,U){var ae=U(34155);/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var re;(function(m){(function(ve){var Z=typeof U.g=="object"?U.g:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),le=fe(m);typeof Z.Reflect=="undefined"?Z.Reflect=m:le=fe(Z.Reflect,le),ve(le);function fe(Le,J){return function(Xe,et){typeof Le[Xe]!="function"&&Object.defineProperty(Le,Xe,{configurable:!0,writable:!0,value:et}),J&&J(Xe,et)}}})(function(ve){var Z=Object.prototype.hasOwnProperty,le=typeof Symbol=="function",fe=le&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",Le=le&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",J=typeof Object.create=="function",Xe={__proto__:[]}instanceof Array,et=!J&&!Xe,Ue={create:J?function(){return hs(Object.create(null))}:Xe?function(){return hs({__proto__:null})}:function(){return hs({})},has:et?function(Nt,nr){return Z.call(Nt,nr)}:function(Nt,nr){return nr in Nt},get:et?function(Nt,nr){return Z.call(Nt,nr)?Nt[nr]:void 0}:function(Nt,nr){return Nt[nr]}},gt=Object.getPrototypeOf(Function),rr=typeof ae=="object"&&{NODE_ENV:"production"}&&{NODE_ENV:"production"}.REFLECT_METADATA_USE_MAP_POLYFILL==="true",xt=!rr&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:me(),Yt=!rr&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Dn(),Et=!rr&&typeof WeakMap=="function"?WeakMap:Za(),at=new Et;function it(Nt,nr,Ar,rn){if(vn(Ar)){if(!Oi(Nt))throw new TypeError;if(!oa(nr))throw new TypeError;return Nr(Nt,nr)}else{if(!Oi(Nt))throw new TypeError;if(!si(nr))throw new TypeError;if(!si(rn)&&!vn(rn)&&!di(rn))throw new TypeError;return di(rn)&&(rn=void 0),Ar=Wi(Ar),tn(Nt,nr,Ar,rn)}}ve("decorate",it);function Zt(Nt,nr){function Ar(rn,wn){if(!si(rn))throw new TypeError;if(!vn(wn)&&!Mi(wn))throw new TypeError;Bt(Nt,nr,rn,wn)}return Ar}ve("metadata",Zt);function Y(Nt,nr,Ar,rn){if(!si(Ar))throw new TypeError;return vn(rn)||(rn=Wi(rn)),Bt(Nt,nr,Ar,rn)}ve("defineMetadata",Y);function $t(Nt,nr,Ar){if(!si(nr))throw new TypeError;return vn(Ar)||(Ar=Wi(Ar)),Ce(Nt,nr,Ar)}ve("hasMetadata",$t);function ft(Nt,nr,Ar){if(!si(nr))throw new TypeError;return vn(Ar)||(Ar=Wi(Ar)),De(Nt,nr,Ar)}ve("hasOwnMetadata",ft);function Je(Nt,nr,Ar){if(!si(nr))throw new TypeError;return vn(Ar)||(Ar=Wi(Ar)),wt(Nt,nr,Ar)}ve("getMetadata",Je);function At(Nt,nr,Ar){if(!si(nr))throw new TypeError;return vn(Ar)||(Ar=Wi(Ar)),mt(Nt,nr,Ar)}ve("getOwnMetadata",At);function Qe(Nt,nr){if(!si(Nt))throw new TypeError;return vn(nr)||(nr=Wi(nr)),Kt(Nt,nr)}ve("getMetadataKeys",Qe);function Qt(Nt,nr){if(!si(Nt))throw new TypeError;return vn(nr)||(nr=Wi(nr)),Cr(Nt,nr)}ve("getOwnMetadataKeys",Qt);function Er(Nt,nr,Ar){if(!si(nr))throw new TypeError;vn(Ar)||(Ar=Wi(Ar));var rn=A(nr,Ar,!1);if(vn(rn)||!rn.delete(Nt))return!1;if(rn.size>0)return!0;var wn=at.get(nr);return wn.delete(Ar),wn.size>0||at.delete(nr),!0}ve("deleteMetadata",Er);function Nr(Nt,nr){for(var Ar=Nt.length-1;Ar>=0;--Ar){var rn=Nt[Ar],wn=rn(nr);if(!vn(wn)&&!di(wn)){if(!oa(wn))throw new TypeError;nr=wn}}return nr}function tn(Nt,nr,Ar,rn){for(var wn=Nt.length-1;wn>=0;--wn){var Fn=Nt[wn],gi=Fn(nr,Ar,rn);if(!vn(gi)&&!di(gi)){if(!si(gi))throw new TypeError;rn=gi}}return rn}function A(Nt,nr,Ar){var rn=at.get(Nt);if(vn(rn)){if(!Ar)return;rn=new xt,at.set(Nt,rn)}var wn=rn.get(nr);if(vn(wn)){if(!Ar)return;wn=new xt,rn.set(nr,wn)}return wn}function Ce(Nt,nr,Ar){var rn=De(Nt,nr,Ar);if(rn)return!0;var wn=zo(nr);return di(wn)?!1:Ce(Nt,wn,Ar)}function De(Nt,nr,Ar){var rn=A(nr,Ar,!1);return vn(rn)?!1:mi(rn.has(Nt))}function wt(Nt,nr,Ar){var rn=De(Nt,nr,Ar);if(rn)return mt(Nt,nr,Ar);var wn=zo(nr);if(!di(wn))return wt(Nt,wn,Ar)}function mt(Nt,nr,Ar){var rn=A(nr,Ar,!1);if(!vn(rn))return rn.get(Nt)}function Bt(Nt,nr,Ar,rn){var wn=A(Ar,rn,!0);wn.set(Nt,nr)}function Kt(Nt,nr){var Ar=Cr(Nt,nr),rn=zo(Nt);if(rn===null)return Ar;var wn=Kt(rn,nr);if(wn.length<=0)return Ar;if(Ar.length<=0)return wn;for(var Fn=new Yt,gi=[],ti=0,fn=Ar;ti<fn.length;ti++){var Di=fn[ti],Ri=Fn.has(Di);Ri||(Fn.add(Di),gi.push(Di))}for(var to=0,Es=wn;to<Es.length;to++){var Di=Es[to],Ri=Fn.has(Di);Ri||(Fn.add(Di),gi.push(Di))}return gi}function Cr(Nt,nr){var Ar=[],rn=A(Nt,nr,!1);if(vn(rn))return Ar;for(var wn=rn.keys(),Fn=$n(wn),gi=0;;){var ti=ji(Fn);if(!ti)return Ar.length=gi,Ar;var fn=wi(ti);try{Ar[gi]=fn}catch(Di){try{$i(Fn)}finally{throw Di}}gi++}}function ei(Nt){if(Nt===null)return 1;switch(typeof Nt){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return Nt===null?1:6;default:return 6}}function vn(Nt){return Nt===void 0}function di(Nt){return Nt===null}function Wn(Nt){return typeof Nt=="symbol"}function si(Nt){return typeof Nt=="object"?Nt!==null:typeof Nt=="function"}function vi(Nt,nr){switch(ei(Nt)){case 0:return Nt;case 1:return Nt;case 2:return Nt;case 3:return Nt;case 4:return Nt;case 5:return Nt}var Ar=nr===3?"string":nr===5?"number":"default",rn=da(Nt,fe);if(rn!==void 0){var wn=rn.call(Nt,Ar);if(si(wn))throw new TypeError;return wn}return qn(Nt,Ar==="default"?"number":Ar)}function qn(Nt,nr){if(nr==="string"){var Ar=Nt.toString;if(Ki(Ar)){var rn=Ar.call(Nt);if(!si(rn))return rn}var wn=Nt.valueOf;if(Ki(wn)){var rn=wn.call(Nt);if(!si(rn))return rn}}else{var wn=Nt.valueOf;if(Ki(wn)){var rn=wn.call(Nt);if(!si(rn))return rn}var Fn=Nt.toString;if(Ki(Fn)){var rn=Fn.call(Nt);if(!si(rn))return rn}}throw new TypeError}function mi(Nt){return!!Nt}function aa(Nt){return""+Nt}function Wi(Nt){var nr=vi(Nt,3);return Wn(nr)?nr:aa(nr)}function Oi(Nt){return Array.isArray?Array.isArray(Nt):Nt instanceof Object?Nt instanceof Array:Object.prototype.toString.call(Nt)==="[object Array]"}function Ki(Nt){return typeof Nt=="function"}function oa(Nt){return typeof Nt=="function"}function Mi(Nt){switch(ei(Nt)){case 3:return!0;case 4:return!0;default:return!1}}function da(Nt,nr){var Ar=Nt[nr];if(Ar!=null){if(!Ki(Ar))throw new TypeError;return Ar}}function $n(Nt){var nr=da(Nt,Le);if(!Ki(nr))throw new TypeError;var Ar=nr.call(Nt);if(!si(Ar))throw new TypeError;return Ar}function wi(Nt){return Nt.value}function ji(Nt){var nr=Nt.next();return nr.done?!1:nr}function $i(Nt){var nr=Nt.return;nr&&nr.call(Nt)}function zo(Nt){var nr=Object.getPrototypeOf(Nt);if(typeof Nt!="function"||Nt===gt||nr!==gt)return nr;var Ar=Nt.prototype,rn=Ar&&Object.getPrototypeOf(Ar);if(rn==null||rn===Object.prototype)return nr;var wn=rn.constructor;return typeof wn!="function"||wn===Nt?nr:wn}function me(){var Nt={},nr=[],Ar=function(){function gi(ti,fn,Di){this._index=0,this._keys=ti,this._values=fn,this._selector=Di}return gi.prototype["@@iterator"]=function(){return this},gi.prototype[Le]=function(){return this},gi.prototype.next=function(){var ti=this._index;if(ti>=0&&ti<this._keys.length){var fn=this._selector(this._keys[ti],this._values[ti]);return ti+1>=this._keys.length?(this._index=-1,this._keys=nr,this._values=nr):this._index++,{value:fn,done:!1}}return{value:void 0,done:!0}},gi.prototype.throw=function(ti){throw this._index>=0&&(this._index=-1,this._keys=nr,this._values=nr),ti},gi.prototype.return=function(ti){return this._index>=0&&(this._index=-1,this._keys=nr,this._values=nr),{value:ti,done:!0}},gi}();return function(){function gi(){this._keys=[],this._values=[],this._cacheKey=Nt,this._cacheIndex=-2}return Object.defineProperty(gi.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),gi.prototype.has=function(ti){return this._find(ti,!1)>=0},gi.prototype.get=function(ti){var fn=this._find(ti,!1);return fn>=0?this._values[fn]:void 0},gi.prototype.set=function(ti,fn){var Di=this._find(ti,!0);return this._values[Di]=fn,this},gi.prototype.delete=function(ti){var fn=this._find(ti,!1);if(fn>=0){for(var Di=this._keys.length,Ri=fn+1;Ri<Di;Ri++)this._keys[Ri-1]=this._keys[Ri],this._values[Ri-1]=this._values[Ri];return this._keys.length--,this._values.length--,ti===this._cacheKey&&(this._cacheKey=Nt,this._cacheIndex=-2),!0}return!1},gi.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=Nt,this._cacheIndex=-2},gi.prototype.keys=function(){return new Ar(this._keys,this._values,rn)},gi.prototype.values=function(){return new Ar(this._keys,this._values,wn)},gi.prototype.entries=function(){return new Ar(this._keys,this._values,Fn)},gi.prototype["@@iterator"]=function(){return this.entries()},gi.prototype[Le]=function(){return this.entries()},gi.prototype._find=function(ti,fn){return this._cacheKey!==ti&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=ti)),this._cacheIndex<0&&fn&&(this._cacheIndex=this._keys.length,this._keys.push(ti),this._values.push(void 0)),this._cacheIndex},gi}();function rn(gi,ti){return gi}function wn(gi,ti){return ti}function Fn(gi,ti){return[gi,ti]}}function Dn(){return function(){function Nt(){this._map=new xt}return Object.defineProperty(Nt.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),Nt.prototype.has=function(nr){return this._map.has(nr)},Nt.prototype.add=function(nr){return this._map.set(nr,nr),this},Nt.prototype.delete=function(nr){return this._map.delete(nr)},Nt.prototype.clear=function(){this._map.clear()},Nt.prototype.keys=function(){return this._map.keys()},Nt.prototype.values=function(){return this._map.values()},Nt.prototype.entries=function(){return this._map.entries()},Nt.prototype["@@iterator"]=function(){return this.keys()},Nt.prototype[Le]=function(){return this.keys()},Nt}()}function Za(){var Nt=16,nr=Ue.create(),Ar=rn();return function(){function fn(){this._key=rn()}return fn.prototype.has=function(Di){var Ri=wn(Di,!1);return Ri!==void 0?Ue.has(Ri,this._key):!1},fn.prototype.get=function(Di){var Ri=wn(Di,!1);return Ri!==void 0?Ue.get(Ri,this._key):void 0},fn.prototype.set=function(Di,Ri){var to=wn(Di,!0);return to[this._key]=Ri,this},fn.prototype.delete=function(Di){var Ri=wn(Di,!1);return Ri!==void 0?delete Ri[this._key]:!1},fn.prototype.clear=function(){this._key=rn()},fn}();function rn(){var fn;do fn="@@WeakMap@@"+ti();while(Ue.has(nr,fn));return nr[fn]=!0,fn}function wn(fn,Di){if(!Z.call(fn,Ar)){if(!Di)return;Object.defineProperty(fn,Ar,{value:Ue.create()})}return fn[Ar]}function Fn(fn,Di){for(var Ri=0;Ri<Di;++Ri)fn[Ri]=Math.random()*255|0;return fn}function gi(fn){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(fn)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(fn)):Fn(new Uint8Array(fn),fn):Fn(new Array(fn),fn)}function ti(){var fn=gi(Nt);fn[6]=fn[6]&79|64,fn[8]=fn[8]&191|128;for(var Di="",Ri=0;Ri<Nt;++Ri){var to=fn[Ri];(Ri===4||Ri===6||Ri===8)&&(Di+="-"),to<16&&(Di+="0"),Di+=to.toString(16).toLowerCase()}return Di}}function hs(Nt){return Nt.__=void 0,delete Nt.__,Nt}})})(re||(re={}))},69848:function(It){(function($,U){It.exports=U()})(this,function(){"use strict";function $(ft,Je,At,Qe,Qt,Er){if(!(Qt-Qe<=At)){var Nr=Qe+Qt>>1;U(ft,Je,Nr,Qe,Qt,Er%2),$(ft,Je,At,Qe,Nr-1,Er+1),$(ft,Je,At,Nr+1,Qt,Er+1)}}function U(ft,Je,At,Qe,Qt,Er){for(;Qt>Qe;){if(Qt-Qe>600){var Nr=Qt-Qe+1,tn=At-Qe+1,A=Math.log(Nr),Ce=.5*Math.exp(2*A/3),De=.5*Math.sqrt(A*Ce*(Nr-Ce)/Nr)*(tn-Nr/2<0?-1:1),wt=Math.max(Qe,Math.floor(At-tn*Ce/Nr+De)),mt=Math.min(Qt,Math.floor(At+(Nr-tn)*Ce/Nr+De));U(ft,Je,At,wt,mt,Er)}var Bt=Je[2*At+Er],Kt=Qe,Cr=Qt;for(ae(ft,Je,Qe,At),Je[2*Qt+Er]>Bt&&ae(ft,Je,Qe,Qt);Kt<Cr;){for(ae(ft,Je,Kt,Cr),Kt++,Cr--;Je[2*Kt+Er]<Bt;)Kt++;for(;Je[2*Cr+Er]>Bt;)Cr--}Je[2*Qe+Er]===Bt?ae(ft,Je,Qe,Cr):(Cr++,ae(ft,Je,Cr,Qt)),Cr<=At&&(Qe=Cr+1),At<=Cr&&(Qt=Cr-1)}}function ae(ft,Je,At,Qe){re(ft,At,Qe),re(Je,2*At,2*Qe),re(Je,2*At+1,2*Qe+1)}function re(ft,Je,At){var Qe=ft[Je];ft[Je]=ft[At],ft[At]=Qe}function m(ft,Je,At,Qe,Qt,Er,Nr){for(var tn=[0,ft.length-1,0],A=[],Ce,De;tn.length;){var wt=tn.pop(),mt=tn.pop(),Bt=tn.pop();if(mt-Bt<=Nr){for(var Kt=Bt;Kt<=mt;Kt++)Ce=Je[2*Kt],De=Je[2*Kt+1],Ce>=At&&Ce<=Qt&&De>=Qe&&De<=Er&&A.push(ft[Kt]);continue}var Cr=Math.floor((Bt+mt)/2);Ce=Je[2*Cr],De=Je[2*Cr+1],Ce>=At&&Ce<=Qt&&De>=Qe&&De<=Er&&A.push(ft[Cr]);var ei=(wt+1)%2;(wt===0?At<=Ce:Qe<=De)&&(tn.push(Bt),tn.push(Cr-1),tn.push(ei)),(wt===0?Qt>=Ce:Er>=De)&&(tn.push(Cr+1),tn.push(mt),tn.push(ei))}return A}function ve(ft,Je,At,Qe,Qt,Er){for(var Nr=[0,ft.length-1,0],tn=[],A=Qt*Qt;Nr.length;){var Ce=Nr.pop(),De=Nr.pop(),wt=Nr.pop();if(De-wt<=Er){for(var mt=wt;mt<=De;mt++)Z(Je[2*mt],Je[2*mt+1],At,Qe)<=A&&tn.push(ft[mt]);continue}var Bt=Math.floor((wt+De)/2),Kt=Je[2*Bt],Cr=Je[2*Bt+1];Z(Kt,Cr,At,Qe)<=A&&tn.push(ft[Bt]);var ei=(Ce+1)%2;(Ce===0?At-Qt<=Kt:Qe-Qt<=Cr)&&(Nr.push(wt),Nr.push(Bt-1),Nr.push(ei)),(Ce===0?At+Qt>=Kt:Qe+Qt>=Cr)&&(Nr.push(Bt+1),Nr.push(De),Nr.push(ei))}return tn}function Z(ft,Je,At,Qe){var Qt=ft-At,Er=Je-Qe;return Qt*Qt+Er*Er}var le=function(ft){return ft[0]},fe=function(ft){return ft[1]},Le=function(Je,At,Qe,Qt,Er){At===void 0&&(At=le),Qe===void 0&&(Qe=fe),Qt===void 0&&(Qt=64),Er===void 0&&(Er=Float64Array),this.nodeSize=Qt,this.points=Je;for(var Nr=Je.length<65536?Uint16Array:Uint32Array,tn=this.ids=new Nr(Je.length),A=this.coords=new Er(Je.length*2),Ce=0;Ce<Je.length;Ce++)tn[Ce]=Ce,A[2*Ce]=At(Je[Ce]),A[2*Ce+1]=Qe(Je[Ce]);$(tn,A,Qt,0,tn.length-1,0)};Le.prototype.range=function(Je,At,Qe,Qt){return m(this.ids,this.coords,Je,At,Qe,Qt,this.nodeSize)},Le.prototype.within=function(Je,At,Qe){return ve(this.ids,this.coords,Je,At,Qe,this.nodeSize)};var J={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(ft){return ft}},Xe=Math.fround||function(ft){return function(Je){return ft[0]=+Je,ft[0]}}(new Float32Array(1)),et=function(Je){this.options=Zt(Object.create(J),Je),this.trees=new Array(this.options.maxZoom+1)};et.prototype.load=function(Je){var At=this.options,Qe=At.log,Qt=At.minZoom,Er=At.maxZoom,Nr=At.nodeSize;Qe&&console.time("total time");var tn="prepare "+Je.length+" points";Qe&&console.time(tn),this.points=Je;for(var A=[],Ce=0;Ce<Je.length;Ce++)!Je[Ce].geometry||A.push(gt(Je[Ce],Ce));this.trees[Er+1]=new Le(A,Y,$t,Nr,Float32Array),Qe&&console.timeEnd(tn);for(var De=Er;De>=Qt;De--){var wt=+Date.now();A=this._cluster(A,De),this.trees[De]=new Le(A,Y,$t,Nr,Float32Array),Qe&&console.log("z%d: %d clusters in %dms",De,A.length,+Date.now()-wt)}return Qe&&console.timeEnd("total time"),this},et.prototype.getClusters=function(Je,At){var Qe=((Je[0]+180)%360+360)%360-180,Qt=Math.max(-90,Math.min(90,Je[1])),Er=Je[2]===180?180:((Je[2]+180)%360+360)%360-180,Nr=Math.max(-90,Math.min(90,Je[3]));if(Je[2]-Je[0]>=360)Qe=-180,Er=180;else if(Qe>Er){var tn=this.getClusters([Qe,Qt,180,Nr],At),A=this.getClusters([-180,Qt,Er,Nr],At);return tn.concat(A)}for(var Ce=this.trees[this._limitZoom(At)],De=Ce.range(Yt(Qe),Et(Nr),Yt(Er),Et(Qt)),wt=[],mt=0,Bt=De;mt<Bt.length;mt+=1){var Kt=Bt[mt],Cr=Ce.points[Kt];wt.push(Cr.numPoints?rr(Cr):this.points[Cr.index])}return wt},et.prototype.getChildren=function(Je){var At=this._getOriginId(Je),Qe=this._getOriginZoom(Je),Qt="No cluster with the specified id.",Er=this.trees[Qe];if(!Er)throw new Error(Qt);var Nr=Er.points[At];if(!Nr)throw new Error(Qt);for(var tn=this.options.radius/(this.options.extent*Math.pow(2,Qe-1)),A=Er.within(Nr.x,Nr.y,tn),Ce=[],De=0,wt=A;De<wt.length;De+=1){var mt=wt[De],Bt=Er.points[mt];Bt.parentId===Je&&Ce.push(Bt.numPoints?rr(Bt):this.points[Bt.index])}if(Ce.length===0)throw new Error(Qt);return Ce},et.prototype.getLeaves=function(Je,At,Qe){At=At||10,Qe=Qe||0;var Qt=[];return this._appendLeaves(Qt,Je,At,Qe,0),Qt},et.prototype.getTile=function(Je,At,Qe){var Qt=this.trees[this._limitZoom(Je)],Er=Math.pow(2,Je),Nr=this.options,tn=Nr.extent,A=Nr.radius,Ce=A/tn,De=(Qe-Ce)/Er,wt=(Qe+1+Ce)/Er,mt={features:[]};return this._addTileFeatures(Qt.range((At-Ce)/Er,De,(At+1+Ce)/Er,wt),Qt.points,At,Qe,Er,mt),At===0&&this._addTileFeatures(Qt.range(1-Ce/Er,De,1,wt),Qt.points,Er,Qe,Er,mt),At===Er-1&&this._addTileFeatures(Qt.range(0,De,Ce/Er,wt),Qt.points,-1,Qe,Er,mt),mt.features.length?mt:null},et.prototype.getClusterExpansionZoom=function(Je){for(var At=this._getOriginZoom(Je)-1;At<=this.options.maxZoom;){var Qe=this.getChildren(Je);if(At++,Qe.length!==1)break;Je=Qe[0].properties.cluster_id}return At},et.prototype._appendLeaves=function(Je,At,Qe,Qt,Er){for(var Nr=this.getChildren(At),tn=0,A=Nr;tn<A.length;tn+=1){var Ce=A[tn],De=Ce.properties;if(De&&De.cluster?Er+De.point_count<=Qt?Er+=De.point_count:Er=this._appendLeaves(Je,De.cluster_id,Qe,Qt,Er):Er<Qt?Er++:Je.push(Ce),Je.length===Qe)break}return Er},et.prototype._addTileFeatures=function(Je,At,Qe,Qt,Er,Nr){for(var tn=0,A=Je;tn<A.length;tn+=1){var Ce=A[tn],De=At[Ce],wt=De.numPoints,mt=void 0,Bt=void 0,Kt=void 0;if(wt)mt=xt(De),Bt=De.x,Kt=De.y;else{var Cr=this.points[De.index];mt=Cr.properties,Bt=Yt(Cr.geometry.coordinates[0]),Kt=Et(Cr.geometry.coordinates[1])}var ei={type:1,geometry:[[Math.round(this.options.extent*(Bt*Er-Qe)),Math.round(this.options.extent*(Kt*Er-Qt))]],tags:mt},vn=void 0;wt?vn=De.id:this.options.generateId?vn=De.index:this.points[De.index].id&&(vn=this.points[De.index].id),vn!==void 0&&(ei.id=vn),Nr.features.push(ei)}},et.prototype._limitZoom=function(Je){return Math.max(this.options.minZoom,Math.min(Math.floor(+Je),this.options.maxZoom+1))},et.prototype._cluster=function(Je,At){for(var Qe=[],Qt=this.options,Er=Qt.radius,Nr=Qt.extent,tn=Qt.reduce,A=Qt.minPoints,Ce=Er/(Nr*Math.pow(2,At)),De=0;De<Je.length;De++){var wt=Je[De];if(!(wt.zoom<=At)){wt.zoom=At;for(var mt=this.trees[At+1],Bt=mt.within(wt.x,wt.y,Ce),Kt=wt.numPoints||1,Cr=Kt,ei=0,vn=Bt;ei<vn.length;ei+=1){var di=vn[ei],Wn=mt.points[di];Wn.zoom>At&&(Cr+=Wn.numPoints||1)}if(Cr>Kt&&Cr>=A){for(var si=wt.x*Kt,vi=wt.y*Kt,qn=tn&&Kt>1?this._map(wt,!0):null,mi=(De<<5)+(At+1)+this.points.length,aa=0,Wi=Bt;aa<Wi.length;aa+=1){var Oi=Wi[aa],Ki=mt.points[Oi];if(!(Ki.zoom<=At)){Ki.zoom=At;var oa=Ki.numPoints||1;si+=Ki.x*oa,vi+=Ki.y*oa,Ki.parentId=mi,tn&&(qn||(qn=this._map(wt,!0)),tn(qn,this._map(Ki)))}}wt.parentId=mi,Qe.push(Ue(si/Cr,vi/Cr,mi,Cr,qn))}else if(Qe.push(wt),Cr>1)for(var Mi=0,da=Bt;Mi<da.length;Mi+=1){var $n=da[Mi],wi=mt.points[$n];wi.zoom<=At||(wi.zoom=At,Qe.push(wi))}}}return Qe},et.prototype._getOriginId=function(Je){return Je-this.points.length>>5},et.prototype._getOriginZoom=function(Je){return(Je-this.points.length)%32},et.prototype._map=function(Je,At){if(Je.numPoints)return At?Zt({},Je.properties):Je.properties;var Qe=this.points[Je.index].properties,Qt=this.options.map(Qe);return At&&Qt===Qe?Zt({},Qt):Qt};function Ue(ft,Je,At,Qe,Qt){return{x:Xe(ft),y:Xe(Je),zoom:Infinity,id:At,parentId:-1,numPoints:Qe,properties:Qt}}function gt(ft,Je){var At=ft.geometry.coordinates,Qe=At[0],Qt=At[1];return{x:Xe(Yt(Qe)),y:Xe(Et(Qt)),zoom:Infinity,index:Je,parentId:-1}}function rr(ft){return{type:"Feature",id:ft.id,properties:xt(ft),geometry:{type:"Point",coordinates:[at(ft.x),it(ft.y)]}}}function xt(ft){var Je=ft.numPoints,At=Je>=1e4?Math.round(Je/1e3)+"k":Je>=1e3?Math.round(Je/100)/10+"k":Je;return Zt(Zt({},ft.properties),{cluster:!0,cluster_id:ft.id,point_count:Je,point_count_abbreviated:At})}function Yt(ft){return ft/360+.5}function Et(ft){var Je=Math.sin(ft*Math.PI/180),At=.5-.25*Math.log((1+Je)/(1-Je))/Math.PI;return At<0?0:At>1?1:At}function at(ft){return(ft-.5)*360}function it(ft){var Je=(180-ft*360)*Math.PI/180;return 360*Math.atan(Math.exp(Je))/Math.PI-90}function Zt(ft,Je){for(var At in Je)ft[At]=Je[At];return ft}function Y(ft){return ft.x}function $t(ft){return ft.y}return et})},75752:function(It){It.exports.RADIUS=6378137,It.exports.FLATTENING=1/298.257223563,It.exports.POLAR_RADIUS=63567523142e-4}}]);
